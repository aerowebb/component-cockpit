(window.webpackJsonp=window.webpackJsonp||[]).push([[63],{"/mks":function(e,t,n){"use strict";n.d(t,"a",function(){return i}),n.d(t,"b",function(){return g});var r=n("CcnG"),s=(n("K8Pq"),n("Ip0R")),i=(n("gIcY"),r["\u0275crt"]({encapsulation:2,styles:[],data:{}}));function o(e){return r["\u0275vid"](0,[(e()(),r["\u0275eld"](0,0,null,null,2,"span",[["class","ui-slider-range ui-widget-header ui-corner-all"]],null,null,null,null,null)),r["\u0275did"](1,278528,null,0,s.NgStyle,[r.KeyValueDiffers,r.ElementRef,r.Renderer2],{ngStyle:[0,"ngStyle"]},null),r["\u0275pod"](2,{left:0,width:1})],function(e,t){var n=t.component,r=e(t,2,0,n.handleValues[0]+"%",n.handleValues[1]-n.handleValues[0]+"%");e(t,1,0,r)},null)}function a(e){return r["\u0275vid"](0,[(e()(),r["\u0275eld"](0,0,null,null,2,"span",[["class","ui-slider-range ui-widget-header ui-corner-all"]],null,null,null,null,null)),r["\u0275did"](1,278528,null,0,s.NgStyle,[r.KeyValueDiffers,r.ElementRef,r.Renderer2],{ngStyle:[0,"ngStyle"]},null),r["\u0275pod"](2,{bottom:0,height:1})],function(e,t){var n=t.component,r=e(t,2,0,n.handleValues[0]+"%",n.handleValues[1]-n.handleValues[0]+"%");e(t,1,0,r)},null)}function l(e){return r["\u0275vid"](0,[(e()(),r["\u0275eld"](0,0,null,null,2,"span",[["class","ui-slider-range ui-slider-range-min ui-widget-header ui-corner-all"]],null,null,null,null,null)),r["\u0275did"](1,278528,null,0,s.NgStyle,[r.KeyValueDiffers,r.ElementRef,r.Renderer2],{ngStyle:[0,"ngStyle"]},null),r["\u0275pod"](2,{height:0})],function(e,t){var n=e(t,2,0,t.component.handleValue+"%");e(t,1,0,n)},null)}function c(e){return r["\u0275vid"](0,[(e()(),r["\u0275eld"](0,0,null,null,2,"span",[["class","ui-slider-range ui-slider-range-min ui-widget-header ui-corner-all"]],null,null,null,null,null)),r["\u0275did"](1,278528,null,0,s.NgStyle,[r.KeyValueDiffers,r.ElementRef,r.Renderer2],{ngStyle:[0,"ngStyle"]},null),r["\u0275pod"](2,{width:0})],function(e,t){var n=e(t,2,0,t.component.handleValue+"%");e(t,1,0,n)},null)}function d(e){return r["\u0275vid"](0,[(e()(),r["\u0275eld"](0,0,null,null,2,"span",[["class","ui-slider-handle ui-state-default ui-corner-all ui-clickable"]],[[4,"transition",null]],[[null,"mousedown"],[null,"touchstart"],[null,"touchmove"],[null,"touchend"]],function(e,t,n){var r=!0,s=e.component;return"mousedown"===t&&(r=!1!==s.onMouseDown(n)&&r),"touchstart"===t&&(r=!1!==s.onTouchStart(n)&&r),"touchmove"===t&&(r=!1!==s.onTouchMove(n)&&r),"touchend"===t&&(r=!1!==s.onTouchEnd(n)&&r),r},null,null)),r["\u0275did"](1,278528,null,0,s.NgStyle,[r.KeyValueDiffers,r.ElementRef,r.Renderer2],{ngStyle:[0,"ngStyle"]},null),r["\u0275pod"](2,{left:0,bottom:1})],function(e,t){var n=t.component,r=e(t,2,0,"horizontal"==n.orientation?n.handleValue+"%":null,"vertical"==n.orientation?n.handleValue+"%":null);e(t,1,0,r)},function(e,t){e(t,0,0,t.component.dragging?"none":null)})}function u(e){return r["\u0275vid"](0,[(e()(),r["\u0275eld"](0,0,null,null,4,"span",[["class","ui-slider-handle ui-state-default ui-corner-all ui-clickable"]],[[4,"transition",null]],[[null,"mousedown"],[null,"touchstart"],[null,"touchmove"],[null,"touchend"]],function(e,t,n){var r=!0,s=e.component;return"mousedown"===t&&(r=!1!==s.onMouseDown(n,0)&&r),"touchstart"===t&&(r=!1!==s.onTouchStart(n,0)&&r),"touchmove"===t&&(r=!1!==s.onTouchMove(n,0)&&r),"touchend"===t&&(r=!1!==s.onTouchEnd(n)&&r),r},null,null)),r["\u0275did"](1,278528,null,0,s.NgClass,[r.IterableDiffers,r.KeyValueDiffers,r.ElementRef,r.Renderer2],{klass:[0,"klass"],ngClass:[1,"ngClass"]},null),r["\u0275pod"](2,{"ui-slider-handle-active":0}),r["\u0275did"](3,278528,null,0,s.NgStyle,[r.KeyValueDiffers,r.ElementRef,r.Renderer2],{ngStyle:[0,"ngStyle"]},null),r["\u0275pod"](4,{left:0,bottom:1})],function(e,t){var n=t.component,r=e(t,2,0,0==n.handleIndex);e(t,1,0,"ui-slider-handle ui-state-default ui-corner-all ui-clickable",r);var s=e(t,4,0,n.rangeStartLeft,n.rangeStartBottom);e(t,3,0,s)},function(e,t){e(t,0,0,t.component.dragging?"none":null)})}function h(e){return r["\u0275vid"](0,[(e()(),r["\u0275eld"](0,0,null,null,4,"span",[["class","ui-slider-handle ui-state-default ui-corner-all ui-clickable"]],[[4,"transition",null]],[[null,"mousedown"],[null,"touchstart"],[null,"touchmove"],[null,"touchend"]],function(e,t,n){var r=!0,s=e.component;return"mousedown"===t&&(r=!1!==s.onMouseDown(n,1)&&r),"touchstart"===t&&(r=!1!==s.onTouchStart(n,1)&&r),"touchmove"===t&&(r=!1!==s.onTouchMove(n,1)&&r),"touchend"===t&&(r=!1!==s.onTouchEnd(n)&&r),r},null,null)),r["\u0275did"](1,278528,null,0,s.NgClass,[r.IterableDiffers,r.KeyValueDiffers,r.ElementRef,r.Renderer2],{klass:[0,"klass"],ngClass:[1,"ngClass"]},null),r["\u0275pod"](2,{"ui-slider-handle-active":0}),r["\u0275did"](3,278528,null,0,s.NgStyle,[r.KeyValueDiffers,r.ElementRef,r.Renderer2],{ngStyle:[0,"ngStyle"]},null),r["\u0275pod"](4,{left:0,bottom:1})],function(e,t){var n=t.component,r=e(t,2,0,1==n.handleIndex);e(t,1,0,"ui-slider-handle ui-state-default ui-corner-all ui-clickable",r);var s=e(t,4,0,n.rangeEndLeft,n.rangeEndBottom);e(t,3,0,s)},function(e,t){e(t,0,0,t.component.dragging?"none":null)})}function g(e){return r["\u0275vid"](0,[(e()(),r["\u0275eld"](0,0,null,null,17,"div",[],null,[[null,"click"]],function(e,t,n){var r=!0;return"click"===t&&(r=!1!==e.component.onBarClick(n)&&r),r},null,null)),r["\u0275did"](1,278528,null,0,s.NgClass,[r.IterableDiffers,r.KeyValueDiffers,r.ElementRef,r.Renderer2],{klass:[0,"klass"],ngClass:[1,"ngClass"]},null),r["\u0275pod"](2,{"ui-slider ui-widget ui-widget-content ui-corner-all":0,"ui-state-disabled":1,"ui-slider-horizontal":2,"ui-slider-vertical":3,"ui-slider-animate":4}),r["\u0275did"](3,278528,null,0,s.NgStyle,[r.KeyValueDiffers,r.ElementRef,r.Renderer2],{ngStyle:[0,"ngStyle"]},null),(e()(),r["\u0275and"](16777216,null,null,1,null,o)),r["\u0275did"](5,16384,null,0,s.NgIf,[r.ViewContainerRef,r.TemplateRef],{ngIf:[0,"ngIf"]},null),(e()(),r["\u0275and"](16777216,null,null,1,null,a)),r["\u0275did"](7,16384,null,0,s.NgIf,[r.ViewContainerRef,r.TemplateRef],{ngIf:[0,"ngIf"]},null),(e()(),r["\u0275and"](16777216,null,null,1,null,l)),r["\u0275did"](9,16384,null,0,s.NgIf,[r.ViewContainerRef,r.TemplateRef],{ngIf:[0,"ngIf"]},null),(e()(),r["\u0275and"](16777216,null,null,1,null,c)),r["\u0275did"](11,16384,null,0,s.NgIf,[r.ViewContainerRef,r.TemplateRef],{ngIf:[0,"ngIf"]},null),(e()(),r["\u0275and"](16777216,null,null,1,null,d)),r["\u0275did"](13,16384,null,0,s.NgIf,[r.ViewContainerRef,r.TemplateRef],{ngIf:[0,"ngIf"]},null),(e()(),r["\u0275and"](16777216,null,null,1,null,u)),r["\u0275did"](15,16384,null,0,s.NgIf,[r.ViewContainerRef,r.TemplateRef],{ngIf:[0,"ngIf"]},null),(e()(),r["\u0275and"](16777216,null,null,1,null,h)),r["\u0275did"](17,16384,null,0,s.NgIf,[r.ViewContainerRef,r.TemplateRef],{ngIf:[0,"ngIf"]},null)],function(e,t){var n=t.component,r=n.styleClass,s=e(t,2,0,!0,n.disabled,"horizontal"==n.orientation,"vertical"==n.orientation,n.animate);e(t,1,0,r,s),e(t,3,0,n.style),e(t,5,0,n.range&&"horizontal"==n.orientation),e(t,7,0,n.range&&"vertical"==n.orientation),e(t,9,0,!n.range&&"vertical"==n.orientation),e(t,11,0,!n.range&&"horizontal"==n.orientation),e(t,13,0,!n.range),e(t,15,0,n.range),e(t,17,0,n.range)},null)}},"6/4J":function(e,t,n){"use strict";n.d(t,"a",function(){return i});var r=n("CcnG"),s=n("UMly"),i=function(){function e(e){this.featureInputs=["cellEdit","cellTooltip","columnDragToolbar","columnPicker","columnReorder","columnResize","contextMenu","filter","filterBar","group","groupSummary","headerContextMenu","labels","nonWorkingTime","pan","percentBar","projectLines","quickFind","regionResize","resourceTimeRanges","search","sort","stripe","summary","taskContextMenu","taskDrag","taskDragCreate","taskEdit","taskResize","taskTooltip","timeRanges","tree"],this.configInputs=["assignments","autoHeight","barMargin","calendars","cls","columnLines","columns","crudManager","dependencies","data","durationDisplayPrecision","emptyText","endDate","eventColor","eventStyle","fillLastColumn","ganttId","height","minWidth","minHeight","project","readOnly","ref","resources","responsiveLevels","rowHeight","scheduledEventName","snap","startDate","store","style","taskRenderer","tasks","tooltip","viewPreset","width"],this.onGanttEvents=new r.EventEmitter,this.elementRef=e}return e.prototype.ngOnInit=function(){var e=this,t={},n={appendTo:this.elementRef.nativeElement,listeners:{catchAll:function(e){this.onGanttEvents.emit(event)},thisObj:this},features:t};this.configInputs.forEach(function(t){"ganttId"===t&&e[t]?n.id=e[t]:void 0!==e[t]&&(n[t]=e[t])}),this.featureInputs.forEach(function(n){n in e&&(t[n]=e[n])});var r=this.ganttEngine=new s.b(n);r.eventStore.relayAll(r,"tasks"),r.resourceStore.relayAll(r,"resources")},e.prototype.ngOnChanges=function(e){var t=this;t.ganttEngine&&Object.entries(e).forEach(function(e){var n=function(t,n){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var s,i,o=r.call(e),a=[];try{for(;(void 0===n||n-- >0)&&!(s=o.next()).done;)a.push(s.value)}catch(l){i={error:l}}finally{try{s&&!s.done&&(r=o.return)&&r.call(o)}finally{if(i)throw i.error}}return a}(0,2),r=n[0],s=n[1].currentValue;t.configInputs.includes(r)&&(t.ganttEngine[r]=s),t.featureInputs.includes(r)&&(t.ganttEngine[r]=s)})},e}()},"7R3d":function(e,t,n){"use strict";n.d(t,"a",function(){return l});var r=n("wd/R"),s=n("BIm4"),i=n("LCkZ"),o=n("tZza"),a=n("CcnG"),l=function(){function e(e){this.dateService=e}return e.prototype.getFirstEventStartDate=function(e){var t=this.dateService.sort(e.map(function(e){return r(e.startDate)}));return i.a.isEmpty(t)?void 0:t[0].toDate()},e.prototype.getLastEventEndDate=function(e){var t=this.dateService.sort(e.map(function(e){return e.endDate}).filter(function(e){return o.a.isDefined(e)}).map(function(e){return r(e)}));return i.a.isEmpty(t)?void 0:t[t.length-1].toDate()},e.ngInjectableDef=a.defineInjectable({factory:function(){return new e(a.inject(s.a))},token:e,providedIn:"root"}),e}()},AiHu:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}(n("K8Pq"))},D7aD:function(e,t,n){"use strict";n.d(t,"a",function(){return i});var r=n("mrSG"),s=(n("CqHe"),n("/0yJ"),n("PJ3U"),n("OovH")),i=(n("2XxF"),function(e){function t(t,n,r,s,i){var o=e.call(this,t,n)||this;return o.aircraftMaintenanceApi=r,o.airworthinessManagementApi=s,o.taskManagementApi=i,o}return Object(r.__extends)(t,e),t.prototype.findWorkOrder=function(t){return e.prototype.post.call(this,this.aircraftMaintenanceApi.findBidmWorkOrder,t)},t.prototype.getBidmWorkOrdersByProject=function(t){return e.prototype.post.call(this,this.aircraftMaintenanceApi.getBidmWorkOrdersStructureByProject,{projectId:t})},t.prototype.updateBidmWorkOrders=function(t){return e.prototype.post.call(this,this.aircraftMaintenanceApi.updateBidmWorkOrders,t)},t.prototype.calculateWorkOrderStatus=function(t){return e.prototype.post.call(this,this.aircraftMaintenanceApi.calculateWorkOrderStatus,t)},t.prototype.findWorkOrderOriginDetails=function(t){return e.prototype.post.call(this,this.airworthinessManagementApi.findWorkOrderOriginDetails,t)},t.prototype.findBireTaskOperationsByTask=function(t){return e.prototype.post.call(this,this.taskManagementApi.findBireTaskOperationsByTask,t)},t.prototype.getOpreationDurationTotalWorkOrder=function(t){return e.prototype.post.call(this,this.aircraftMaintenanceApi.getOperationDurationTotalByWorkOrder,t)},t}(s.a))},GGqK:function(e,t,n){"use strict";n.d(t,"a",function(){return r}),n("AiHu"),n("r5xa"),n("J5+J"),n("YWPX"),n("D2Uw"),n("bOAy"),n("D7aD");var r=function(){return function(){}}()},"J5+J":function(e,t,n){"use strict";n.d(t,"a",function(){return r});var r=function(){return function(){}}()},N4yP:function(e,t,n){"use strict";var r=n("CcnG"),s=n("Ip0R"),i=n("6/4J"),o=r["\u0275crt"]({encapsulation:2,styles:[],data:{}});function a(e){return r["\u0275vid"](0,[],null,null)}var l=n("IlHg"),c=n("9yOm"),d=n("mZtN"),u=n("hFGf"),h=n("QLLi"),g=n("+Gaf"),m=n("tCJT"),p=n("0snz"),f=n("dkNy"),v=n("enDq"),y=n("v1eH"),b=n("A7o+"),C=n("bujt"),w=n("UodH"),S=n("dWZg"),D=n("lLAP"),E=n("wFw1"),x=n("/mks"),T=n("K8Pq"),R=n("gIcY"),k=n("bOAy"),M=n("nhdH"),I=n("cxgq"),A=n("UOq0"),F=n("60Vt"),O=n("D7aD"),L=n("7R3d");n.d(t,"a",function(){return N});var _=r["\u0275crt"]({encapsulation:0,styles:[["[_nghost-%COMP%]   .gantt-block[_ngcontent-%COMP%]   .gantt-wrap[_ngcontent-%COMP%]{height:86.2vh;width:100%}[_nghost-%COMP%]   .gantt-block.show[_ngcontent-%COMP%]{display:initial}[_nghost-%COMP%]   .gantt-block[_ngcontent-%COMP%]   .time-resolution[_ngcontent-%COMP%]{align-items:center;display:flex;flex-direction:row;margin:16px}[_nghost-%COMP%]   .gantt-block[_ngcontent-%COMP%]   .time-resolution[_ngcontent-%COMP%]   p-slider[_ngcontent-%COMP%]{width:10rem}[_nghost-%COMP%]   .gantt-block[_ngcontent-%COMP%]   .today-btn[_ngcontent-%COMP%]{align-items:center;display:flex;flex-direction:row}"]],data:{}});function P(e){return r["\u0275vid"](0,[(e()(),r["\u0275eld"](0,0,null,null,4,"div",[["class","gantt-wrap"]],null,null,null,null,null)),r["\u0275did"](1,278528,null,0,s.NgClass,[r.IterableDiffers,r.KeyValueDiffers,r.ElementRef,r.Renderer2],{klass:[0,"klass"],ngClass:[1,"ngClass"]},null),r["\u0275pod"](2,{show:0}),(e()(),r["\u0275eld"](3,0,null,null,1,"bry-gantt",[],null,null,null,a,o)),r["\u0275did"](4,638976,[[10,4],["gantt",4]],0,i.a,[r.ElementRef],{columns:[0,"columns"],project:[1,"project"],labels:[2,"labels"],projectLines:[3,"projectLines"],taskContextMenu:[4,"taskContextMenu"]},null)],function(e,t){var n=t.component,r=e(t,2,0,!n.ganttLoading);e(t,1,0,"gantt-wrap",r),e(t,4,0,n.ganttConfig.columns,n.ganttConfig.project,n.ganttConfig.labels,n.ganttConfig.projectLines,n.ganttConfig.taskContextMenu)},null)}function $(e){return r["\u0275vid"](0,[(e()(),r["\u0275eld"](0,0,null,null,1,"aw-dialog-work-order-edition",[],null,[[null,"displayChange"],[null,"onValidated"]],function(e,t,n){var r=!0,s=e.component;return"displayChange"===t&&(r=!1!==(s.showEditWorkOrder=n)&&r),"onValidated"===t&&(r=!1!==s.onAddWorkOrder(n)&&r),r},l.b,l.a)),r["\u0275did"](1,8896512,null,0,c.a,[d.a,u.a,h.a,g.a,m.a,p.a,f.a,v.a,y.a,b.j],{display:[0,"display"],workPackage:[1,"workPackage"],workOrderSelected:[2,"workOrderSelected"],workOrders:[3,"workOrders"]},{displayChange:"displayChange",onValidated:"onValidated"})],function(e,t){var n=t.component;e(t,1,0,n.showEditWorkOrder,n.workPackage,n.selectedWorkOrder,n.workOrderList)},null)}function j(e){return r["\u0275vid"](0,[r["\u0275qud"](402653184,1,{pageEltRef:0}),r["\u0275qud"](671088640,2,{dropdownList:1}),r["\u0275qud"](671088640,3,{checkboxList:1}),r["\u0275qud"](671088640,4,{checkboxElementRefList:1}),r["\u0275qud"](671088640,5,{calendarList:1}),r["\u0275qud"](671088640,6,{menuItemElementRefList:1}),r["\u0275qud"](671088640,7,{tabList:1}),r["\u0275qud"](671088640,8,{tabElementRefList:1}),r["\u0275qud"](671088640,9,{tabGroupList:1}),r["\u0275qud"](671088640,10,{gantt:0}),(e()(),r["\u0275eld"](10,0,null,null,7,"div",[["class","page-header"]],null,null,null,null,null)),(e()(),r["\u0275eld"](11,0,null,null,6,"div",[["class","page-info"]],null,null,null,null,null)),(e()(),r["\u0275eld"](12,0,null,null,4,"div",[],null,null,null,null,null)),(e()(),r["\u0275eld"](13,0,null,null,2,"h2",[["class","page-title"]],null,null,null,null,null)),(e()(),r["\u0275ted"](14,null,[" "," "])),r["\u0275pid"](131072,b.i,[b.j,r.ChangeDetectorRef]),(e()(),r["\u0275eld"](16,0,null,null,0,"div",[["class","page-subtitle"]],null,null,null,null,null)),(e()(),r["\u0275eld"](17,0,null,null,0,"div",[["class","page-actions"]],null,null,null,null,null)),(e()(),r["\u0275eld"](18,0,null,null,30,"div",[["class","page-wrapper"]],null,null,null,null,null)),(e()(),r["\u0275eld"](19,0,null,null,29,"div",[["class","page-container"]],null,null,null,null,null)),(e()(),r["\u0275eld"](20,0,null,null,28,"div",[["class","grid-row"]],null,null,null,null,null)),(e()(),r["\u0275eld"](21,0,null,null,27,"div",[["class","grid-cell--12"]],null,null,null,null,null)),(e()(),r["\u0275eld"](22,0,null,null,26,"div",[["class","grid-cell grid-cell--container gantt-block"]],null,null,null,null,null)),(e()(),r["\u0275eld"](23,0,null,null,4,"div",[["class","grid-cell-header"]],null,null,null,null,null)),(e()(),r["\u0275eld"](24,0,null,null,3,"div",[["class","grid-cell-title-container"]],null,null,null,null,null)),(e()(),r["\u0275eld"](25,0,null,null,2,"h3",[["class","grid-cell-title"]],null,null,null,null,null)),(e()(),r["\u0275ted"](26,null,[" "," "])),r["\u0275pid"](131072,b.i,[b.j,r.ChangeDetectorRef]),(e()(),r["\u0275eld"](28,0,null,null,20,"div",[["class","grid-cell-content"]],null,null,null,null,null)),r["\u0275did"](29,278528,null,0,s.NgClass,[r.IterableDiffers,r.KeyValueDiffers,r.ElementRef,r.Renderer2],{klass:[0,"klass"],ngClass:[1,"ngClass"]},null),r["\u0275pod"](30,{show:0}),(e()(),r["\u0275eld"](31,0,null,null,15,"div",[["class","scheduler-header"]],null,null,null,null,null)),r["\u0275did"](32,278528,null,0,s.NgClass,[r.IterableDiffers,r.KeyValueDiffers,r.ElementRef,r.Renderer2],{klass:[0,"klass"],ngClass:[1,"ngClass"]},null),r["\u0275pod"](33,{show:0}),(e()(),r["\u0275eld"](34,0,null,null,0,"div",[["class","grid-cell--10"]],null,null,null,null,null)),(e()(),r["\u0275eld"](35,0,null,null,4,"div",[["class","today-btn"]],null,null,null,null,null)),(e()(),r["\u0275eld"](36,0,null,null,3,"button",[["mat-raised-button",""]],[[8,"disabled",0],[2,"_mat-animation-noopable",null]],[[null,"click"]],function(e,t,n){var r=!0;return"click"===t&&(r=!1!==e.component.showToday()&&r),r},C.b,C.a)),r["\u0275did"](37,180224,null,0,w.b,[r.ElementRef,S.a,D.f,[2,E.a]],null,null),(e()(),r["\u0275ted"](38,0,[" "," "])),r["\u0275pid"](131072,b.i,[b.j,r.ChangeDetectorRef]),(e()(),r["\u0275eld"](40,0,null,null,6,"div",[["class","time-resolution"]],null,null,null,null,null)),(e()(),r["\u0275eld"](41,0,null,null,5,"p-slider",[],[[2,"ng-untouched",null],[2,"ng-touched",null],[2,"ng-pristine",null],[2,"ng-dirty",null],[2,"ng-valid",null],[2,"ng-invalid",null],[2,"ng-pending",null]],[[null,"ngModelChange"],[null,"onChange"]],function(e,t,n){var r=!0,s=e.component;return"ngModelChange"===t&&(r=!1!==(s.ganttZoomLevel=n)&&r),"onChange"===t&&(r=!1!==s.onChangeTimeResolution(n)&&r),r},x.b,x.a)),r["\u0275did"](42,180224,null,0,T.Slider,[r.ElementRef,r.Renderer2,r.NgZone,r.ChangeDetectorRef],{min:[0,"min"],max:[1,"max"]},{onChange:"onChange"}),r["\u0275prd"](1024,null,R.NG_VALUE_ACCESSOR,function(e){return[e]},[T.Slider]),r["\u0275did"](44,671744,null,0,R.NgModel,[[8,null],[8,null],[8,null],[6,R.NG_VALUE_ACCESSOR]],{model:[0,"model"]},{update:"ngModelChange"}),r["\u0275prd"](2048,null,R.NgControl,null,[R.NgModel]),r["\u0275did"](46,16384,null,0,R.NgControlStatus,[[4,R.NgControl]],null,null),(e()(),r["\u0275and"](16777216,null,null,1,null,P)),r["\u0275did"](48,16384,null,0,s.NgIf,[r.ViewContainerRef,r.TemplateRef],{ngIf:[0,"ngIf"]},null),(e()(),r["\u0275and"](16777216,null,null,1,null,$)),r["\u0275did"](50,16384,null,0,s.NgIf,[r.ViewContainerRef,r.TemplateRef],{ngIf:[0,"ngIf"]},null)],function(e,t){var n=t.component,r=e(t,30,0,!n.ganttLoading);e(t,29,0,"grid-cell-content",r);var s=e(t,33,0,!n.ganttLoading);e(t,32,0,"scheduler-header",s),e(t,42,0,n.TIME_RESOLUTION_MIN_ZOOM,n.TIME_RESOLUTION_MAX_ZOOM),e(t,44,0,n.ganttZoomLevel),e(t,48,0,n.ganttConfig),e(t,50,0,n.showEditWorkOrder)},function(e,t){var n=t.component;e(t,14,0,r["\u0275unv"](t,14,0,r["\u0275nov"](t,15).transform("transaction."+n.componentData.componentId))),e(t,26,0,r["\u0275unv"](t,26,0,r["\u0275nov"](t,27).transform(n.getComponentName()+".calendar"))),e(t,36,0,r["\u0275nov"](t,37).disabled||null,"NoopAnimations"===r["\u0275nov"](t,37)._animationMode),e(t,38,0,r["\u0275unv"](t,38,0,r["\u0275nov"](t,39).transform("today"))),e(t,41,0,r["\u0275nov"](t,46).ngClassUntouched,r["\u0275nov"](t,46).ngClassTouched,r["\u0275nov"](t,46).ngClassPristine,r["\u0275nov"](t,46).ngClassDirty,r["\u0275nov"](t,46).ngClassValid,r["\u0275nov"](t,46).ngClassInvalid,r["\u0275nov"](t,46).ngClassPending)})}function H(e){return r["\u0275vid"](0,[(e()(),r["\u0275eld"](0,0,null,null,1,"aw-work-orders-calendar-form",[],null,null,null,j,_)),r["\u0275did"](1,8896512,null,0,k.a,[M.a,I.a,h.a,A.a,F.a,O.a,L.a,g.a,b.j],null,null)],function(e,t){e(t,1,0)},null)}var N=r["\u0275ccf"]("aw-work-orders-calendar-form",k.a,H,{userWorkflow:"userWorkflow",componentData:"componentData"},{},[])},UMly:function(e,t,n){"use strict";n.d(t,"a",function(){return Kt}),n.d(t,"c",function(){return Lg}),n.d(t,"b",function(){return om});const r="gantt";var s={searchParams:"URLSearchParams"in self,iterable:"Symbol"in self&&"iterator"in Symbol,blob:"FileReader"in self&&"Blob"in self&&function(){try{return new Blob,!0}catch(e){return!1}}(),formData:"FormData"in self,arrayBuffer:"ArrayBuffer"in self};if(s.arrayBuffer)var i=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],o=ArrayBuffer.isView||function(e){return e&&i.indexOf(Object.prototype.toString.call(e))>-1};function a(e){if("string"!=typeof e&&(e=String(e)),/[^a-z0-9\-#$%&'*+.^_`|~]/i.test(e))throw new TypeError("Invalid character in header field name");return e.toLowerCase()}function l(e){return"string"!=typeof e&&(e=String(e)),e}function c(e){var t={next:function(){var t=e.shift();return{done:void 0===t,value:t}}};return s.iterable&&(t[Symbol.iterator]=function(){return t}),t}function d(e){this.map={},e instanceof d?e.forEach(function(e,t){this.append(t,e)},this):Array.isArray(e)?e.forEach(function(e){this.append(e[0],e[1])},this):e&&Object.getOwnPropertyNames(e).forEach(function(t){this.append(t,e[t])},this)}function u(e){if(e.bodyUsed)return Promise.reject(new TypeError("Already read"));e.bodyUsed=!0}function h(e){return new Promise(function(t,n){e.onload=function(){t(e.result)},e.onerror=function(){n(e.error)}})}function g(e){var t=new FileReader,n=h(t);return t.readAsArrayBuffer(e),n}function m(e){if(e.slice)return e.slice(0);var t=new Uint8Array(e.byteLength);return t.set(new Uint8Array(e)),t.buffer}function p(){return this.bodyUsed=!1,this._initBody=function(e){var t;this._bodyInit=e,e?"string"==typeof e?this._bodyText=e:s.blob&&Blob.prototype.isPrototypeOf(e)?this._bodyBlob=e:s.formData&&FormData.prototype.isPrototypeOf(e)?this._bodyFormData=e:s.searchParams&&URLSearchParams.prototype.isPrototypeOf(e)?this._bodyText=e.toString():s.arrayBuffer&&s.blob&&(t=e)&&DataView.prototype.isPrototypeOf(t)?(this._bodyArrayBuffer=m(e.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer])):s.arrayBuffer&&(ArrayBuffer.prototype.isPrototypeOf(e)||o(e))?this._bodyArrayBuffer=m(e):this._bodyText=e=Object.prototype.toString.call(e):this._bodyText="",this.headers.get("content-type")||("string"==typeof e?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):s.searchParams&&URLSearchParams.prototype.isPrototypeOf(e)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},s.blob&&(this.blob=function(){var e=u(this);if(e)return e;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){return this._bodyArrayBuffer?u(this)||Promise.resolve(this._bodyArrayBuffer):this.blob().then(g)}),this.text=function(){var e,t,n,r=u(this);if(r)return r;if(this._bodyBlob)return e=this._bodyBlob,n=h(t=new FileReader),t.readAsText(e),n;if(this._bodyArrayBuffer)return Promise.resolve(function(e){for(var t=new Uint8Array(e),n=new Array(t.length),r=0;r<t.length;r++)n[r]=String.fromCharCode(t[r]);return n.join("")}(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},s.formData&&(this.formData=function(){return this.text().then(y)}),this.json=function(){return this.text().then(JSON.parse)},this}d.prototype.append=function(e,t){e=a(e),t=l(t);var n=this.map[e];this.map[e]=n?n+", "+t:t},d.prototype.delete=function(e){delete this.map[a(e)]},d.prototype.get=function(e){return e=a(e),this.has(e)?this.map[e]:null},d.prototype.has=function(e){return this.map.hasOwnProperty(a(e))},d.prototype.set=function(e,t){this.map[a(e)]=l(t)},d.prototype.forEach=function(e,t){for(var n in this.map)this.map.hasOwnProperty(n)&&e.call(t,this.map[n],n,this)},d.prototype.keys=function(){var e=[];return this.forEach(function(t,n){e.push(n)}),c(e)},d.prototype.values=function(){var e=[];return this.forEach(function(t){e.push(t)}),c(e)},d.prototype.entries=function(){var e=[];return this.forEach(function(t,n){e.push([n,t])}),c(e)},s.iterable&&(d.prototype[Symbol.iterator]=d.prototype.entries);var f=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];function v(e,t){var n,r,s=(t=t||{}).body;if(e instanceof v){if(e.bodyUsed)throw new TypeError("Already read");this.url=e.url,this.credentials=e.credentials,t.headers||(this.headers=new d(e.headers)),this.method=e.method,this.mode=e.mode,this.signal=e.signal,s||null==e._bodyInit||(s=e._bodyInit,e.bodyUsed=!0)}else this.url=String(e);if(this.credentials=t.credentials||this.credentials||"same-origin",!t.headers&&this.headers||(this.headers=new d(t.headers)),this.method=(r=(n=t.method||this.method||"GET").toUpperCase(),f.indexOf(r)>-1?r:n),this.mode=t.mode||this.mode||null,this.signal=t.signal||this.signal,this.referrer=null,("GET"===this.method||"HEAD"===this.method)&&s)throw new TypeError("Body not allowed for GET or HEAD requests");this._initBody(s)}function y(e){var t=new FormData;return e.trim().split("&").forEach(function(e){if(e){var n=e.split("="),r=n.shift().replace(/\+/g," "),s=n.join("=").replace(/\+/g," ");t.append(decodeURIComponent(r),decodeURIComponent(s))}}),t}function b(e,t){t||(t={}),this.type="default",this.status=void 0===t.status?200:t.status,this.ok=this.status>=200&&this.status<300,this.statusText="statusText"in t?t.statusText:"OK",this.headers=new d(t.headers),this.url=t.url||"",this._initBody(e)}v.prototype.clone=function(){return new v(this,{body:this._bodyInit})},p.call(v.prototype),p.call(b.prototype),b.prototype.clone=function(){return new b(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new d(this.headers),url:this.url})},b.error=function(){var e=new b(null,{status:0,statusText:""});return e.type="error",e};var C=[301,302,303,307,308];b.redirect=function(e,t){if(-1===C.indexOf(t))throw new RangeError("Invalid status code");return new b(null,{status:t,headers:{location:e}})};var w=self.DOMException;try{new w}catch(dp){(w=function(e,t){this.message=e,this.name=t;var n=Error(e);this.stack=n.stack}).prototype=Object.create(Error.prototype),w.prototype.constructor=w}function S(e,t){return new Promise(function(n,r){var i=new v(e,t);if(i.signal&&i.signal.aborted)return r(new w("Aborted","AbortError"));var o=new XMLHttpRequest;function a(){o.abort()}o.onload=function(){var e,t,r={status:o.status,statusText:o.statusText,headers:(e=o.getAllResponseHeaders()||"",t=new d,e.replace(/\r?\n[\t ]+/g," ").split(/\r?\n/).forEach(function(e){var n=e.split(":"),r=n.shift().trim();if(r){var s=n.join(":").trim();t.append(r,s)}}),t)};r.url="responseURL"in o?o.responseURL:r.headers.get("X-Request-URL"),n(new b("response"in o?o.response:o.responseText,r))},o.onerror=function(){r(new TypeError("Network request failed"))},o.ontimeout=function(){r(new TypeError("Network request failed"))},o.onabort=function(){r(new w("Aborted","AbortError"))},o.open(i.method,i.url,!0),"include"===i.credentials?o.withCredentials=!0:"omit"===i.credentials&&(o.withCredentials=!1),"responseType"in o&&s.blob&&(o.responseType="blob"),i.headers.forEach(function(e,t){o.setRequestHeader(t,e)}),i.signal&&(i.signal.addEventListener("abort",a),o.onreadystatechange=function(){4===o.readyState&&i.signal.removeEventListener("abort",a)}),o.send(void 0===i._bodyInit?null:i._bodyInit)})}S.polyfill=!0,self.fetch||(self.fetch=S,self.Headers=d,self.Request=v,self.Response=b);var D="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};!function(){function e(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function t(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function n(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}function r(e){return(r=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function s(e,t){return(s=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function i(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function o(e,t,n){return(o="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var s=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=r(e)););return e}(e,t);if(s){var i=Object.getOwnPropertyDescriptor(s,t);return i.get?i.get.call(n):i.value}})(e,t,n||e)}var a=function(){function t(){e(this,t),Object.defineProperty(this,"listeners",{value:{},writable:!0,configurable:!0})}return n(t,[{key:"addEventListener",value:function(e,t){e in this.listeners||(this.listeners[e]=[]),this.listeners[e].push(t)}},{key:"removeEventListener",value:function(e,t){if(e in this.listeners)for(var n=this.listeners[e],r=0,s=n.length;r<s;r++)if(n[r]===t)return void n.splice(r,1)}},{key:"dispatchEvent",value:function(e){var t=this;if(e.type in this.listeners){for(var n=function(n){setTimeout(function(){return n.call(t,e)})},r=this.listeners[e.type],s=0,i=r.length;s<i;s++)n(r[s]);return!e.defaultPrevented}}}]),t}(),l=function(t){function l(){var t,n;return e(this,l),(n=r(l).call(this),t=!n||"object"!=typeof n&&"function"!=typeof n?i(this):n).listeners||a.call(i(t)),Object.defineProperty(i(t),"aborted",{value:!1,writable:!0,configurable:!0}),Object.defineProperty(i(t),"onabort",{value:null,writable:!0,configurable:!0}),t}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&s(e,t)}(l,a),n(l,[{key:"toString",value:function(){return"[object AbortSignal]"}},{key:"dispatchEvent",value:function(e){"abort"===e.type&&(this.aborted=!0,"function"==typeof this.onabort&&this.onabort.call(this,e)),o(r(l.prototype),"dispatchEvent",this).call(this,e)}}]),l}(),c=function(){function t(){e(this,t),Object.defineProperty(this,"signal",{value:new l,writable:!0,configurable:!0})}return n(t,[{key:"abort",value:function(){var e;try{e=new Event("abort")}catch(t){"undefined"!=typeof document?document.createEvent?(e=document.createEvent("Event")).initEvent("abort",!1,!1):(e=document.createEventObject()).type="abort":e={type:"abort",bubbles:!1,cancelable:!1}}this.signal.dispatchEvent(e)}},{key:"toString",value:function(){return"[object AbortController]"}}]),t}();function d(e){return e.__FORCE_INSTALL_ABORTCONTROLLER_POLYFILL?(console.log("__FORCE_INSTALL_ABORTCONTROLLER_POLYFILL=true is set, will force install polyfill"),!0):"function"==typeof e.Request&&!e.Request.prototype.hasOwnProperty("signal")||!e.AbortController}"undefined"!=typeof Symbol&&Symbol.toStringTag&&(c.prototype[Symbol.toStringTag]="AbortController",l.prototype[Symbol.toStringTag]="AbortSignal"),function(e){if(d(e))if(e.fetch){var t=function(e){"function"==typeof e&&(e={fetch:e});var t=e.fetch,n=e.Request,r=void 0===n?t.Request:n,s=e.__FORCE_INSTALL_ABORTCONTROLLER_POLYFILL,i=void 0!==s&&s;if(!d({fetch:t,Request:r,AbortController:e.AbortController,__FORCE_INSTALL_ABORTCONTROLLER_POLYFILL:i}))return{fetch:t,Request:o};var o=r;(o&&!o.prototype.hasOwnProperty("signal")||i)&&((o=function(e,t){var n;t&&t.signal&&(n=t.signal,delete t.signal);var s=new r(e,t);return n&&Object.defineProperty(s,"signal",{writable:!1,enumerable:!1,configurable:!0,value:n}),s}).prototype=r.prototype);var a=t;return{fetch:function(e,t){var n=o&&o.prototype.isPrototypeOf(e)?e.signal:t?t.signal:void 0;if(n){var r;try{r=new DOMException("Aborted","AbortError")}catch(dp){(r=new Error("Aborted")).name="AbortError"}if(n.aborted)return Promise.reject(r);var s=new Promise(function(e,t){n.addEventListener("abort",function(){return t(r)},{once:!0})});return t&&t.signal&&delete t.signal,Promise.race([s,a(e,t)])}return a(e,t)},Request:o}}(e),n=t.Request;e.fetch=t.fetch,e.Request=n,Object.defineProperty(e,"AbortController",{writable:!0,enumerable:!1,configurable:!0,value:c}),Object.defineProperty(e,"AbortSignal",{writable:!0,enumerable:!1,configurable:!0,value:l})}else console.warn("fetch() is not available, cannot install abortcontroller-polyfill")}("undefined"!=typeof self?self:D)}();const E=function(){class e{static register(e,t){const n=T[t];x[e]=t,n?n[e]=1:T[t]={[e]:1}}static getClass(e){return x[e]}static isType(e,t,n){for(let r=e.constructor;r;r=n&&Object.getPrototypeOf(r)){const e=T[r]||r.$name&&(T[r]={[r.$name.toLowerCase()]:1});if(e&&e[t])return!0}}static createWidget(e,t){const n=this.getClass(e);return n?new n(t):null}}return e._$name="BryntumWidgetAdapterRegister",e}(),x=E.widgetRegister={},T=E.widgetClassRegister={};function R(e,t){const n=e.classHierarchy();for(let r=0;r<n.length;r++)if(n[r].$name.toLowerCase()===t)return!0;return!1}const k=function(){class e{static generateId(t="generatedId"){return t+ ++e.idCounter}static register(t,n=""){let r=t.id;if(null==r&&(r=t.id=e.generateId(n),t.hasGeneratedId=!0),r in e.idMap&&!this.disableThrow)throw new Error("Id "+r+" already in use");e.idMap[r]=t}static unregister(t){e.idMap[t.id]&&delete e.idMap[t.id]}static get(t){return e.idMap[t]}static query(t,n=!1){const r=e.idMap;for(let e in r)if(M(r[e],t,n))return r[e];return null}static queryAll(t,n=!1){const r=e.idMap,s=[];for(let e in r)M(r[e],t,n)&&s.push(r[e]);return s}static fromElement(t,n,r){const s=typeof n;t&&t instanceof Event&&(t=t.target),("number"===s||n&&1===n.nodeType)&&(r=n,n=null);let i,o,a,l=t,c=e.idMap,d=0;for("number"!=typeof r&&(i=r,r=Number.MAX_VALUE),"string"===s&&(n=n.toLowerCase());l&&1===l.nodeType&&d<r&&l!==i;){if(o=l.dataset&&l.dataset.ownerCmp||l.id){if(a=c[o]){if(!n)return a;if("function"===s){if(n(a))return a}else if(M(a,n)||R(a,n))return a}d++}l=l.parentNode}return null}}return e.idCounter=0,e.idMap={},e._$name="IdHelper",e}();function M(e,t,n){return"*"===t||("function"==typeof t?t(e):E.isType(e,t,n))}(window.bryntum||(window.bryntum={})).get=k.get,window.bryntum.IdHelper=k,window.bryntum.query=k.query,window.bryntum.queryAll=k.queryAll,window.bryntum.fromElement=k.fromElement;const I=function(){class e{static set adapter(e){this._adapter=new e}static get adapter(){if(!this._adapter)throw new Error("No widget adapter set");return this._adapter}static get hasAdapter(){return!!this._adapter}static getById(e){return k.get(e)}static fromElement(e,t,n){return k.fromElement(e,t,n)}static createWidget(e={}){return this.adapter.createWidget(e)}static append(e,t){if(e=Array.isArray(e)&&e||[e],(t instanceof HTMLElement||"string"==typeof t)&&(t={appendTo:t}),t.insertFirst){const e="string"==typeof t.insertFirst?document.getElementById(t.insertFirst):t.insertFirst;e.firstChild?t.insertBefore=e.firstChild:t.appendTo=e}return this.adapter.appendWidgets(e,t)}static openPopup(e,t){return this.adapter.openPopup(e,t)}static showContextMenu(e,t){return this.adapter.showContextMenu(e,t)}static attachTooltip(e,t){return this.adapter.attachTooltip(e,t)}static hasTooltipAttached(e){return this.adapter.hasTooltipAttached(e)}static destroyTooltipAttached(e){return this.adapter.destroyTooltipAttached(e)}static mask(e,t){return this.adapter.mask(e,t)}static unmask(e,t=!0){this.adapter.unmask(e)}static toast(e){this.adapter.toast(e)}static set defaultStyle(e){this.adapter.defaultStyle=e}static get defaultStyle(){return this.adapter.defaultStyle}}return e._$name="WidgetHelper",e}(),A=/([a-z])([A-Z])/g,F=/[.*+?^${}()|[\]\\]/g,O=/(^[^a-z]+|[^\w]+)/gi,L=(e,t,n)=>t+"-"+n.toLowerCase(),_=e=>e?`_x${e.charCodeAt(0).toString(16)}`:"__blank__",P={},$=function(){class e{static capitalizeFirstLetter(e){return e?e[0].toUpperCase()+e.substr(1):null}static lowercaseFirstLetter(e){return e?e[0].toLowerCase()+e.substr(1):null}static hyphenate(e){return P[e]||(P[e]=e.replace(A,L))}static safeJsonParse(e){let t=null;try{t=JSON.parse(e)}catch(n){console.error(n)}return t}static safeJsonStringify(e){let t=null;try{t=JSON.stringify(e)}catch(n){console.error(n)}return t}static createId(e){return String(e).replace(O,_)}static escapeRegExp(e){return e.replace(F,"\\$&")}}return e._$name="StringHelper",e}(),j=Symbol("defaultConfig"),H=Symbol("propertyInitializers"),N=Symbol("classHierarchy"),z=Symbol("configuration"),B=Symbol("originalConfig"),V=Symbol("instanceProperties"),W=function(){class e{constructor(...e){this.construct(...e),this.afterConstruct()}construct(...e){null!==e[0]&&this.configure(...e),this.afterConfigure()}destroy(){const e=this;e.isDestroying=!0,e.doDestroy(),Object.setPrototypeOf(this,null);for(let t in e)delete e[t];delete e[B],e.isDestroyed=!0}_thisIsAUsedExpression(e){}static get $name(){return this.hasOwnProperty("_$name")&&this._$name||this.name}get $name(){return this.constructor.$name}startConfigure(e){}finishConfigure(e){}afterConfigure(){}afterConstruct(){}callback(e,t,n){"this"===t&&(t=this);const{handler:r,thisObj:s}=this.resolveCallback(e,t);return n?r.apply(s,n):r.call(s)}resolveCallback(e,t=this){if(e.substr){if(e.startsWith("up."))for(e=e.substr(3),t=this.owner;t&&!t[e];t=t.owner);else e.startsWith("this.")&&(t=this);e=t[e]}return{handler:e,thisObj:t}}doDestroy(){}destroyProperties(...e){const t=this;let n,r;for(n of e)!(n in t)||t[z]&&t[z][n]||((r=t[n])&&r.destroy&&r.destroy(),delete t[n])}configure(t={}){const n=this;n.initialConfig=t,n.isConfiguring=!0,Object.assign(n,n.getProperties()),n.setConfig(n[B]=e.assign(n.getDefaultConfiguration(),t),!0),n.isConfiguring=!1}setConfig(t,n){const r=this,s=r[z],i=s?r.configDone:r.configDone={},o=r[V]={};let a,l;for(a in r[z]=s?Object.setPrototypeOf(Object.assign({},t),s):t,t)null!=t[a]||t.hasOwnProperty(a)?(o[a]||!(l=Reflect.getOwnPropertyDescriptor(r,a))||"value"in l||(o[a]=l),Reflect.defineProperty(r,a,e.createPropInitializer(a)),n||(i[a]=!1)):i[a]=!0;for(a in n&&r.startConfigure(t),t)i[a]||(r[a]=t[a]);s?r[z]=s:delete r[z],n&&r.finishConfigure(t)}get config(){let e,t={},n=this[B];for(e in n)t[e]=n[e];return t}getDefaultConfiguration(){return this.constructor.getDefaultConfiguration()}static getDefaultConfiguration(){const e=this.getConfigDescriptor();return e.needsFork?this.fork(e.defaultConfig):Object.setPrototypeOf({},e.defaultConfig)}static getConfigDescriptor(t){const n=this;let r,s,i,o,a,l=!t&&n.hasOwnProperty(j)?n[j]:null;if(!l){for(s in l={defaultConfig:r=n.hasOwnProperty("defaultConfig")?n.defaultConfig:{},needsFork:0},t||(n[j]=l),r)if((o=r[s])&&(o.constructor===Object||Array.isArray(o))&&!Object.isFrozen(o)){l.needsFork=1;break}if(!t)for(i=n.superclass;i&&i!==e;i=i.superclass)a=i.getConfigDescriptor(!0),Object.keys(a.defaultConfig).length&&(l.needsFork|=a.needsFork,Object.setPrototypeOf(r,r=a.defaultConfig))}return l}static fork(e){var t,n,r;if(e&&e.constructor===Object&&!Object.isFrozen(e))for(n in t=Object.setPrototypeOf({},e),e)(r=e[n])&&(r.constructor===Object?t[n]=this.fork(r):r instanceof Array&&(t[n]=r.slice()));else t=e;return t}static assign(e,...t){for(var n,r,s=0,i=t.length;s<i;s++)for(r in n=t[s])e[r]=n[r];return e}getProperties(){const e=this.classHierarchy(),t=e.length;let n,r,s={};for(n=0;n<t;n++)(r=e[n]).hasOwnProperty("properties")&&Object.assign(s,r.properties);return s}static get superclass(){return Object.getPrototypeOf(this)}static createPropInitializer(e){var t=(this[H]||(this[H]={}))[e];if(!t){let n="initializing"+$.capitalizeFirstLetter(e);t=this[H][e]={configurable:!0,get(){const t=this,r=t[V][e];return r?Reflect.defineProperty(t,e,r):delete t[e],t[n]=!0,t[e]=t[z][e],t[n]=!1,t.configDone[e]=!0,t[e]},set(t){const n=this,r=n[V][e];r?Reflect.defineProperty(n,e,r):delete n[e],n.configDone[e]=!0,n[e]=t}}}return t}classHierarchy(t){let n,r=this.constructor,s=r.hasOwnProperty(N)?r[N]:null;if(!s){for(s=r[N]=[];r!==e;r=Object.getPrototypeOf(r))s.unshift(r);Object.freeze(s)}if(t)for(let e=0;!n&&e<s.length;e++)s[e]===t&&(n=s.slice(e));else n=s;return n}classNameHierarchy(e){return this.classHierarchy(e).map(e=>e.$name)}static isOfTypeName(e){return this.classNameHierarchy().includes(e)}}return e._$name="Base",e}();var U=e=>(class extends(e||W){doDestroy(){const e=this;e.timeoutIds&&(Object.keys(e.timeoutIds).forEach(t=>{"function"==typeof e.timeoutIds[t]&&e.timeoutIds[t](),clearTimeout(t)}),e.timeoutIds=null),e.timeoutMap&&(Object.values(e.timeoutMap).forEach(e=>clearTimeout(e)),e.timeoutMap=null),e.intervalIds&&(Object.keys(e.intervalIds).forEach(e=>clearInterval(e)),e.intervalIds=null),e.animationFrameIds&&(Object.keys(e.animationFrameIds).forEach(e=>cancelAnimationFrame(e)),e.animationFrameIds=null),super.doDestroy()}hasTimeout(e){return!(!this.timeoutMap||!this.timeoutMap[e])}setTimeout({fn:e,delay:t,name:n,runOnDestroy:r,cancelOutstanding:s}){(arguments.length>1||"function"==typeof arguments[0])&&([e,t,n,r]=arguments),"string"==typeof e?n=e:n||(n=e.name),s&&this.clearTimeout(n);const i=this,o=i.timeoutIds||(i.timeoutIds={}),a=i.timeoutMap||(i.timeoutMap={}),l=setTimeout(()=>{"string"==typeof e&&(e=i[n]),e.call(i),o&&l in o&&delete o[l],a&&n in a&&delete a[n]},t);return o[l]=!r||e,n&&(a[n]=l),l}clearTimeout(e){let t=e;if("string"==typeof t){if(!this.timeoutMap)return;t=this.timeoutMap[e],delete this.timeoutMap[e]}clearTimeout(t),this.timeoutIds&&delete this.timeoutIds[t]}clearInterval(e){clearInterval(e),this.intervalIds&&delete this.intervalIds[e]}setInterval(e,t){const n=setInterval(e,t);return this.intervalIds||(this.intervalIds={}),this.intervalIds[n]=!0,n}requestAnimationFrame(e,t,n){const r=requestAnimationFrame(t||n?()=>e.apply(n,t):e);return(this.animationFrameIds||(this.animationFrameIds={}))[r]=!0,r}createOnFrame(e,t=[],n=this,r){let s,i=this,o=(...o)=>{s&&r&&(i.cancelAnimationFrame(s),s=null),s||(s=this.requestAnimationFrame(()=>{"string"==typeof e&&(e=n[e]),s=null,o.push(...t),e.apply(n,o)}))};return o.cancel=(()=>i.cancelAnimationFrame(s)),o}cancelAnimationFrame(e){cancelAnimationFrame(e),this.animationFrameIds&&delete this.animationFrameIds[e]}buffer(e,t,n=this){let r=null;"string"==typeof e&&(e=n[e]);const s=(...i)=>{s.called=!1,null!==r&&this.clearTimeout(r),r=this.setTimeout(()=>{e.call(n,...i),s.called=!0},t)};return s}throttle(e,t){let n,r,s,i=this,o=0;const a=()=>{r=0,o=performance.now(),e.apply(i,n),s.called=!0};return(s=((...e)=>{let l=performance.now()-o;n=e,l>=t?(i.clearTimeout(r),a()):r||(r=i.setTimeout(a,t-l),s.called=!1)})).cancel=(()=>i.clearTimeout(r)),s}get widgetClass(){}});const G=function(){class e{static cacheFlags(e=navigator.platform,t=navigator.userAgent){const n=this;n._isLinux=Boolean(e.match(/Linux/)),n._isMac=Boolean(e.match(/Mac/)),n._isWindows=Boolean(e.match(/Win32/)),n._isIE11=Boolean(t.match(/rv:11/)),n._edgeVersion=n.getVersion(t,/Edge\/(\d+)\./),n._isEdge=n._edgeVersion>0,n._isWebkit=Boolean(t.match(/WebKit/))&&!n._isEdge,n._firefoxVersion=n.getVersion(t,/Firefox\/(\d+)\./),n._isFirefox=n._firefoxVersion>0,n._chromeVersion=n._isEdge?0:n.getVersion(t,/Chrom(?:e|ium)\/(\d+)\./),n._isChrome=n._chromeVersion>0,n._isSafari=Boolean(t.match(/Safari/))&&!n._isChrome&&!n._isEdge,n._isMobileSafari=Boolean(t.match(/Mobile.*Safari/));try{document.querySelector(":scope"),n.supportsQueryScope=!n._isFirefox}catch(r){n.supportsQueryScope=!1}n._supportsPassive=!1;try{document.addEventListener("__notvalid__",null,{get passive(){n._supportsPassive=!0}})}catch(r){}}static getVersion(e,t){const n=e.match(t);return n?parseInt(n[1]):0}static get isTouchDevice(){return"_isTouchDevice"in this?this._isTouchDevice:"ontouchstart"in window||!this.isEdge&&navigator.maxTouchPoints>0||this.isEdge&&window.TouchEvent||navigator.msMaxTouchPoints>0}static set isTouchDevice(e){this._isTouchDevice=e}static get isMac(){return this._isMac}static get isWindows(){return this._isWindows}static get isLinux(){return this._isLinux}static get isIE11(){return this._isIE11}static get isEdge(){return this._isEdge}static get edgeVersion(){return this._edgeVersion}static get isWebkit(){return this._isWebkit}static get isChrome(){return this._isChrome}static get chromeVersion(){return this._chromeVersion}static get isFirefox(){return this._isFirefox}static get firefoxVersion(){return this._firefoxVersion}static get isSafari(){return this._isSafari}static get isMobileSafari(){return this._isMobileSafari}static get supportsPassive(){return this._supportsPassive}static get storageAvailable(){let e,t;try{return(e=localStorage).setItem(t="__storage_test__",t),e.removeItem(t),!0}catch(n){return n instanceof DOMException&&(22===n.code||1014===n.code||"QuotaExceededError"===n.name||"NS_ERROR_DOM_QUOTA_REACHED"===n.name)&&0!==e.length}}static setLocalStorageItem(e,t){this.storageAvailable&&localStorage.setItem(e,t)}static getLocalStorageItem(e){return this.storageAvailable&&localStorage.getItem(e)}static removeLocalStorageItem(e){this.storageAvailable&&localStorage.removeItem(e)}}return e._$name="BrowserHelper",e}();G.cacheFlags();const Y=["border-top-width","border-right-width","border-bottom-width","border-left-width"],q=["padding-top","padding-right","padding-bottom","padding-left"],X={t:"border-top-width",r:"border-right-width",b:"border-bottom-width",l:"border-left-width"},K={t:"padding-top",r:"padding-right",b:"padding-bottom",l:"padding-left"},Z=Object.freeze({x:0,y:0}),J=/^([trblc])(\d*)-([trblc])(\d*)$/i,Q=/^([trblc])(\d*)$/i,ee=["top","right","bottom","left"],te={t:0,r:1,b:2,l:3},ne=["b-t","l-r","t-b","r-l"],re=Object.freeze([0,0]),se=["width","height"];function ie(e){return`${ee[(te[e.myEdge]+2)%4][0]}${e.myOffset}-${ee[(te[e.targetEdge]+2)%4][0]}${e.targetOffset}`}const oe=function(){class e{static from(t,n,r=!1){if(t instanceof e)return t;if(n){let{scrollLeft:t,scrollTop:r}=n;(G.isEdge||G.isSafari)&&n===document.body&&(t=r=0),n=e.from(n).translate(-t,-r)}else n=Z;const s=t===document||t===window,i=s?new e(0,0,window.innerWidth,window.innerHeight):t.getBoundingClientRect(),o=r||s?[0,0]:[window.pageXOffset,window.pageYOffset];return new e(i.left+o[0]-n.x,i.top+o[1]-n.y,i.width,i.height)}static inner(e,t,n=!1){const r=this.from(e,t,n);if(document.body.contains(e)){const t=yt.getStyleValue(e,Y);r.x+=parseInt(t[X.l]),r.y+=parseInt(t[X.t]),r.right-=parseInt(t[X.r]),r.bottom-=parseInt(t[X.b])}return r}static content(e,t,n=!1){const r=this.from(e,t,n);if(document.body.contains(e)){const t=yt.getStyleValue(e,Y),n=yt.getStyleValue(e,q);r.x+=parseInt(t[X.l])+parseInt(n[K.l]),r.y+=parseInt(t[X.t])+parseInt(n[K.t]),r.right-=parseInt(t[X.r])+parseInt(n[K.r]),r.bottom-=parseInt(t[X.b])+parseInt(n[K.b])}return r}static client(e,t,n=!1){let r,s=this.content(e,t,n),i=yt.scrollBarWidth;return i&&(e.scrollHeight>e.clientHeight&&(r=parseInt(yt.getStyleValue(e,"padding-right")),s.right+=r-Math.max(r,i)),e.scrollWidth>e.clientWidth&&(r=parseInt(yt.getStyleValue(e,"padding-bottom")),s.bottom+=r-Math.max(r,i))),s}static union(...t){let n,{x:r,y:s,right:i,bottom:o}=t[0];if(t.length>1)for(let e=1;e<t.length;e++)(n=t[e]).x<r&&(r=n.x),n.y<s&&(s=n.y),n.right>i&&(i=n.right),n.bottom>o&&(o=n.bottom);return new e(r,s,i-r,o-s)}static get $name(){return this.hasOwnProperty("_$name")&&this._$name||this.name}get $name(){return this.constructor.$name}constructor(e,t,n,r){this._x=e,this._y=t,this._width=n,this._height=r}clone(){const t=this,n=new e(t.x,t.y,t.width,t.height);return n.minHeight=t.minHeight,n.minWidth=t.minWidth,n}contains(t){return t instanceof e&&t._x>=this._x&&t._y>=this._y&&t.right<=this.right&&t.bottom<=this.bottom}intersect(t,n=!1){var r=Math.max(this.y,t.y),s=Math.min(this.right,t.right),i=Math.min(this.bottom,t.bottom),o=Math.max(this.x,t.x);return i>r&&s>o&&(!!n||new e(o,r,s-o,i-r))}equals(t,n=!1){const r=n?e=>Math.round(e):e=>e;return t instanceof e&&r(t.x)===r(this.x)&&r(t.y)===r(this.y)&&r(t.width)===r(this.width)&&r(t.height)===r(this.height)}translate(e,t){return this._x+=e||0,this._y+=t||0,this}moveTo(e,t){return null!=e&&(this._x=e),null!=t&&(this._y=t),this}getDelta(e){return[e.x-this.x,e.y-this.y]}get center(){return new e.Point(this.x+this.width/2,this.y+this.height/2)}set x(e){let t=e-this._x;this._x=e,this._width-=t}get x(){return this._x}set left(e){this.x=e}get left(){return this.x}set top(e){this.y=e}get top(){return this.y}set y(e){let t=e-this._y;this._y=e,this._height-=t}get y(){return this._y}set width(e){this._width=e}get width(){return this._width}set height(e){this._height=e}get height(){return this._height}set right(e){this._width=e-this._x}get right(){return this._x+this._width}set bottom(e){this._height=e-this._y}get bottom(){return this._y+this._height}get area(){return this.width*this.height}set minWidth(e){const t=this;isNaN(e)?t._minWidth=null:(t._minWidth=Number(e),t.width=Math.max(t.width,t._minWidth))}get minWidth(){return this._minWidth}set minHeight(e){const t=this;isNaN(e)?t._minHeight=null:(t._minHeight=Number(e),t.height=Math.max(t.height,t._minHeight))}get minHeight(){return this._minHeight}adjust(e,t,n,r){const s=this;return s.x+=e,s.y+=t,s.width+=n,s.height+=r,s}inflate(e){return this.adjust(-e,-e,e,e)}constrainTo(e,t){const n=this,r=n.height,s=n.y,i=n.minWidth||n.width;if(n.height>=e.height){if(t&&(n.minHeight||n.height)>e.height)return!1;n._y=e.y,n.height=e.height}if(n.width>=e.width){if(t&&i>e.width)return n.y=s,n.height=r,!1;n._x=e.x,n.width=e.width}let o=n.bottom-e.bottom;return o>0&&n.translate(0,-o),(o=n.right-e.right)>0&&n.translate(-o),(o=e.y-n.y)>0&&n.translate(0,o),(o=e.x-n.x)>0&&n.translate(o),n}alignTo(t){let n,r,s,i,o=this.clone(),a=t.target,l=t.constrainTo;!a||a instanceof e||(a=e.from(a.element?a.element:a)),!l||l instanceof e||(i=l===window||l===document,l=e.from(l.element?l.element:l,null,t.ignorePageScroll));const c=this,d=null==(S=t.offset)?re:"number"==typeof S?[S,S]:S,{align:u,axisLock:h,anchorSize:g,anchorPosition:m}=t,p=function(e){const t=J.exec(u),n=parseInt(t[2]||50),r=parseInt(t[4]||50);return{myAlignmentPoint:t[1]+n,myEdge:t[1],myOffset:n,targetAlignmentPoint:t[3]+r,targetEdge:t[3],targetOffset:r,startZone:te[t[3]]}}(),f=t.position||(a&&"Point"===a.$name?a:null),v=l&&l.clone(),y=[],b=[{zone:r=p.startZone,align:u}],C=t.matchSize&&se[1&p.startZone],w=c[C];var S;if(C&&h&&(o[C]=a[C]),l&&o.constrainTo(l),l&&null!=p.startZone)if(h)b.push({zone:r=(r+2)%4,align:ie(p)}),"flexible"===h&&(b.push({zone:r=(p.startZone+1)%4,align:ne[r]}),b.push({zone:r=(r+2)%4,align:ne[r]}));else for(let e=1;e<4;e++)b.push({zone:r=(r+1)%4,align:ne[r]});if(m){let e=1&p.startZone?"y":"x";n={[e]:m[e],edge:ee[(p.startZone+2)%4]}}if(v&&a&&(v.adjust(-a.width,-a.height,a.width,a.height),a.constrainTo(v)),o.minWidth=c.minWidth,o.minHeight=c.minHeight,f)o.moveTo(f.x,f.y),l&&o.constrainTo(l);else{const e=g?[g[1]+d[0],g[1]+d[1]]:d,t=a.getAlignmentPoint(p.targetAlignmentPoint,e),r=o.getAlignmentPoint(p.myAlignmentPoint);if(o.translate(t[0]-r[0],t[1]-r[1]),o.intersect(a,!0))l&&o.constrainTo(l),s=p.startZone;else if(l&&!l.contains(o)){let t,r,d=o.clone(),u=[];n=null,y[0]=t=l.clone(),t.bottom=a.y-e[1],y[1]=t=l.clone(),t.x=a.right+e[0],y[2]=t=l.clone(),t.y=a.bottom+e[1],y[3]=t=l.clone(),t.right=a.x-e[0];for(let n=0;n<b.length;n++){if(C&&2==n&&(o[C]=w),t=y[s=b[n].zone],(o=o.alignTo({target:a,offsets:e,align:b[n].align})).constrainTo(t,!0)&&(u.push({result:o,zone:s}),!r||o.width<c.width||o.height<c.height)){o.align=b[n].align;break}if(!r||t.area>r.area){const e=o.clone();switch(s){case 0:e.moveTo(null,t.bottom-e.height);break;case 1:e.moveTo(t.left);break;case 2:e.moveTo(null,t.top);break;case 3:e.moveTo(t.right-e.width)}r={area:t.area,result:e,zone:s}}}u.length?(u.length>1&&!h&&u.sort((e,t)=>Math.sqrt((d.x-e.result.x)**2+(d.y-e.result.y)**2)-Math.sqrt((d.x-t.result.x)**2+(d.y-t.result.y)**2)),o=u[0].result,s=u[0].zone):(o=r.result,s=r.zone,i&&o.constrainTo(l))}else s=p.startZone;if(o.zone=s,g){if(!n){let e=1&s,t=e?"y":"x",r=e?"bottom":"right",i=Math.max(a[t],o[t]),l=i+(Math.min(a[r],o[r])-i)/2-g[0]/2,c=l+g[0];c>o[r]&&(l-=c-o[r]),l<o[t]&&(l+=o[t]-l),n={[t]:l-o[t],edge:ee[(s+2)%4]}}o.anchor=n}}return o}getAlignmentPoint(e,t=re){const n=this,r=Q.exec(e),s=r[1].toLowerCase(),i=Math.min(Math.max(parseInt(r[2]||50),0),100)/100;switch(s){case"t":return[n.x+n.width*i,n.y-t[1]];case"r":return[n.right+t[0],n.y+n.height*i];case"b":return[n.x+n.width*i,n.bottom+t[1]];case"l":return[n.x-t[0],n.y+n.height*i];case"c":const e=n.center;return[e.x+t[0],e.y+t[1]]}}highlight(){const e=yt.createElement({parent:document.body,style:`position:absolute;z-index:9999999;pointer-events:none;\n                            left:${this.x}px;top:${this.y}px;width:${this.width}px;height:${this.height}px`});return yt.highlight(e).then(()=>e.remove())}}return e._$name="Rectangle",e}(),ae=function(){class e{static get(e,t){return this.fetch(e,t)}static post(e,t,n={}){return t instanceof FormData||"string"==typeof t||(t=JSON.stringify(t)),this.fetch(e,Object.assign({method:"POST",body:t},n))}static fetch(e,t={}){const n=new AbortController;if(t.signal=n.signal,"credentitals"in t||(t.credentials="include"),t.queryParams){const n=Object.entries(t.queryParams);n.length&&(e+="?"+n.map(([e,t])=>`${e}=${encodeURIComponent(t)}`).join("&"))}const r=new Promise((n,r)=>{fetch(e,t).then(e=>{t.parseJson?e.json().then(t=>{e.parsedJson=t,n(e)}).catch(t=>{e.parsedJson=null,e.error=t,r(e)}):n(e)}).catch(e=>{r(e)})});return r.abort=function(){n.abort()},r}}return e._$name="AjaxHelper",e}(),le=function(){class e{static clean(e){return e.reduce((e,t)=>(null==t||Array.isArray(t)&&0===t.length||""===t||e.push(t),e),[])}static remove(e,...t){let n,r,s=!1;for(let i=0;i<t.length;i++)-1!==(n=e.indexOf(r=t[i]))&&(e.splice(n,1),s=!0);return s}static findInsertionIndex(e,t,n=this.lexicalCompare,r){const s=t.length;let i,o;return r<s&&(i=r>0?n(t[r-1],e):0,o=r<s-1?n(e,t[r]):0,i<1&&o<1)?r:this.binarySearch(t,e,n)}static binarySearch(e,t,n=0,r=e.length,s=this.lexicalCompare){let i,o;for(n instanceof Function?(s=n,n=0):r instanceof Function&&(s=r,r=e.length),--r;n<=r;)(o=s(t,e[i=n+r>>1]))>=0?n=i+1:o<0&&(r=i-1);return n}magnitudeCompare(e,t){return e<t?-1:e>t?1:0}lexicalCompare(e,t){return(e=String(e))<(t=String(t))?-1:e>t?1:0}static fill(e,t={},n=null){const r=[],s=Array.isArray(t)?t:[t];for(let i=0;i<e;i++)for(let e of s){const t=Object.assign({},e);n&&n(t,i),r.push(t)}return r}static populate(e,t){const n=[];for(let r=0;r<e;r++)n.push(t(r));return n}static include(e,t){e.includes(t)||e.push(t)}static allowNegative(e){return new Proxy(e,{get(e,t,n){if("string"!=typeof t)return Reflect.get(e,t,n);const r=Number(t);return Number.isNaN(r)?Reflect.get(e,t,n):e[r<0?e.length+r:r]},set(e,t,n,r){if("string"!=typeof t)return Reflect.set(e,t,n,r);const s=Number(t);return Number.isNaN(s)?Reflect.set(e,t,n,r):(e[s<0?e.length+s:s]=n,!0)}})}}return e._$name="ArrayHelper",e}(),ce={thisObj:1,detachable:1,once:1,detacher:1,prio:1,args:1,_oldDestructor:1},de=(e,t)=>t.prio-e.prio;var ue=e=>(class extends(e||W){destroy(){this.trigger("beforeDestroy"),super.destroy()}construct(...e){super.construct(...e),this.processConfiguredListeners()}processConfiguredListeners(e=this.listeners){const t=this;if(t.listeners=e,t.listeners&&!t.defaultListenersInitialized){const e=t.addListener(t.listeners,t);!1!==t.listeners.detachable&&(t.listeners.detacher=e),t.defaultListenersInitialized=!0}}doDestroy(){const e=this;e.trigger("destroy"),e.listeners&&e.listeners.detacher&&e.listeners.detacher(),e.removeAllListeners(),super.doDestroy()}addListener(e,t,n){const r=this,s=r.eventListeners||(r.eventListeners={});if("string"==typeof e)return r.addListener({[e]:t,detachable:!1!==t.detachable,thisObj:n});t=void 0!==e.thisObj?e.thisObj:e.thisObj=t;for(const i in e)if(!ce[i]){const n=e[i],r={fn:"object"==typeof n?n.fn:n,thisObj:void 0!==n.thisObj?n.thisObj:t,args:n.args||e.args,prio:void 0!==n.prio?n.prio:void 0!==e.prio?e.prio:0,once:void 0!==n.once?n.once:void 0!==e.once&&e.once,catchAll:"catchAll"===i},o=i.toLowerCase(),a=s[o]||(s[o]=[]);a.splice(le.findInsertionIndex(r,a,de,a.length),0,r)}return e.relayAll&&r.relayAll(e.relayAll),t&&r.attachAutoDetacher(e),!1!==e.detachable?()=>r.removeListener(e):void 0}on(){return this.addListener(...arguments)}un(){this.removeListener(...arguments)}removeListener(e,t=e.thisObj,...n){const r=this;"string"!=typeof e?(Object.entries(e).forEach(([e,n])=>{if(ce[e])return;const s=e.toLowerCase(),i=r.eventListeners&&r.eventListeners[s];if(i){const e=i.findIndex(e=>!(e.fn!==n&&e.fn!==n.fn||e.thisObj!==t&&e.thisObj!==n.thisObj&&t));e>=0&&(i.splice(e,1),i.length||delete r.eventListeners[s])}}),e.thisObj&&!e.thisObj.isDestroyed&&r.detachAutoDetacher(e)):r.removeListener({[e]:t},!(n.length>0)||n[0])}hasListener(e){return Boolean(this.eventListeners&&this.eventListeners[e])}relayAll(e,t,n=!0){this.relayAllTargets||(this.relayAllTargets=[]),this.relayAllTargets.push({through:e,prefix:t,transformCase:n})}removeAllListeners(){const e=this,t=e.eventListeners||(e.eventListeners={});for(let n in t)t[n].forEach(t=>e.removeListener(n,t))}relayEvents(e,t,n){const r=this,s={detachable:!0};return t.forEach(e=>{s[e]=((...t)=>(function(e,...t){return r.trigger((n||"")+e,...t)})(e,...t))}),e.on(s)}attachAutoDetacher(e){const t=e.thisObj,n="doDestroy"in t?"doDestroy":"destroy";n in t?(e._oldDestructor=t[n],t[n]=(()=>{this.isDestroyed||this.removeListener(e),e._oldDestructor.call(t)})):t[n]=(()=>{this.removeListener(e)})}detachAutoDetacher(e){const t=e.thisObj;e._oldDestructor&&(t["doDestroy"in t?"doDestroy":"destroy"]=e._oldDestructor)}await(e,t={checkLog:!0,resetLog:!0}){const n=this;return new Promise(r=>{t.checkLog&&n._triggered&&n._triggered[e]&&(r(),t.resetLog&&n.clearLog(e)),n.on({[e]:(...s)=>{r(...s),t.resetLog&&n.clearLog(e)},prio:-1e4,once:!0})})}clearLog(e){this._triggered&&(e?delete this._triggered[e]:this._triggered={})}callPreventable(e,t,n,r=[],s=!1){if(!s&&!1===this.trigger("before"+$.capitalizeFirstLetter(e),t))return!1;const i=n(t,...r);return s||this.trigger(e,t),i}trigger(e,t){const n=this,r=e.toLowerCase(),{eventsSuspended:s,relayAllTargets:i,callOnFunctions:o}=n;let a=n.eventListeners&&n.eventListeners[r],l=!0;if(n._triggered||(n._triggered={}),n._triggered[e]=!0,s)return s.shouldQueue&&s.queue.push(arguments),!0;if(n.eventListeners&&n.eventListeners.catchall&&((a=a?a.slice():[]).push(...n.eventListeners.catchall),a.sort(de),l=!1),!a&&!i&&!o)return!0;if(t?"source"in t||(Object.isExtensible(t)?t.source=n:t=Object.setPrototypeOf({source:n},t)):t={source:n},t.type!==r&&(t.constructor!==Object?Reflect.defineProperty(t,"type",{get:()=>r}):t.type=r),o){const r="on"+$.capitalizeFirstLetter(e);if(r in n&&(n.callback(n[r],n,[t]),!n.isDestroyed&&n.hasOwnProperty(r))){const e=Object.getPrototypeOf(n);if(r in e&&(e[r].call(n,t),n.isDestroyed))return}}if(a){let e,s,i=0;for(l&&(a=a.slice());i<a.length&&!n.isDestroyed;i++){let o=(e=a[i]).thisObj;if(!o||!o.isDestroyed){if(e.once&&n.removeListener(r,e),"string"==typeof e.fn){if(o&&(s=o[e.fn]),!s){const t=n.resolveCallback(e.fn);s=t.handler,o=t.thisObj}}else s=e.fn;if(e.args){if(!1===s.call(o||n,...e.args,t))return!1}else if(!1===s.call(o||n,t))return!1}}}if(i&&i.forEach(n=>{let r=e;if(n.transformCase&&(r=$.capitalizeFirstLetter(r)),n.prefix&&(r=n.prefix+r),!1===n.through.trigger(r,t))return!1}),t.bubbles){const r=n.owner;if(r)return r.trigger(e,t)}return!0}suspendEvents(e=!1){(this.eventsSuspended||(this.eventsSuspended={shouldQueue:e,queue:[],count:0})).count++}resumeEvents(){const e=this.eventsSuspended;if(e&&0==--e.count&&(this.eventsSuspended=null,e.shouldQueue))for(let t of e.queue)this.trigger(...t);return!Boolean(this.eventsSuspended)}});let he=new class extends(ue(W)){static get defaultConfig(){return{locales:{}}}construct(...e){const t=this;super.construct(...e);let n=document.querySelector("script[data-default-locale]");n&&(t.defaultLocaleName=n.dataset.defaultLocale),window.bryntum&&window.bryntum.locales&&(Object.keys(window.bryntum.locales).forEach(e=>{if(!e.startsWith("moment")){let n=window.bryntum.locales[e];n.extends?t.extendLocale(n.extends,n):t.registerLocale(n.localeName,{desc:n.localeDesc,locale:n})}}),t.locale||"En"!==t.defaultLocaleName&&t.applyLocale(t.defaultLocaleName||Object.keys(t.locales)[0]))}set locales(e){this._locales=e}get locales(){return this._locales}set locale(e){"string"==typeof e?this.applyLocale(e):(e.locale||(e={locale:e,localeName:e.localeName||"custom"}),this.registerLocale(e.localeName,e),this.applyLocale(e.localeName))}get locale(){return this._locale}registerLocale(e,t){const n=this,r=n.defaultLocaleName===e,s=n.locale&&n.locale.localeName===e,i=0===Object.keys(n.locales).length;n.locales[e]=t,(r||!n.defaultLocaleName&&(i||s))&&n.internalApplyLocale(t)}extendLocale(e,t){const n=this.locales[e];return!!n&&(Object.keys(t).forEach(e=>{n.locale[e]?Object.assign(n.locale[e],t[e]):n.locale[e]=t[e]}),delete n.locale.extends,!0)}internalApplyLocale(e){this._locale=e.locale,this.trigger("locale",e)}applyLocale(e,t=!1,n=!1){const r=this,s=r.locales[e];if(s&&s.locale&&r._locale===s.locale&&!t)return!0;if(!s){if(n)return!0;throw new Error(`Locale ${e} not registered`)}function i(){r.internalApplyLocale(s)}return s.locale?(i(),!0):new Promise((t,n)=>{r.loadLocale(s.path).then(n=>{n.text().then(n=>{new Function(n)(),s.locale=window.bryntum.locales[e],i(),t(s)})}).catch(e=>n(e))})}loadLocale(e){return ae.get(e)}};var ge=e=>(class t extends(e||W){static get defaultConfig(){return{localeClass:null,localizableProperties:[]}}static get inTextLocaleRegExp(){return/L\{([^}]+)\}/g}static parseText(e){const t=this.inTextLocaleRegExp.exec(e);return t?t[1]:e}construct(e={},...t){super.construct(e,...t),he.on("locale",this.updateLocalization,this),this.updateLocalization()}get localeClass(){return this._localeClass||this.parent&&this.parent.localeClass||null}set localeClass(e){this._localeClass=e}updateLocalization(){const e=this;e.localizableProperties&&e.localizableProperties.forEach(n=>{void 0!==e[n]&&(e.originalLocales=e.originalLocales||{},e.originalLocales[n]=e.originalLocales[n]||e[n],e.originalLocales[n]&&(e[n]=t.L.call(e,e.originalLocales[n])))})}static L(e,n,r=this.localeClass||this){if(he.locale)for(;r;){const s=he.locale[r.$name||r.name],i=s&&s[t.parseText(e)];if(i)return"function"==typeof i&&null!=n?i(n):i;r=Object.getPrototypeOf(r)}return e}L(e,n){return t.L(e,n,this.constructor)}get localeManager(){return he}});const me=e=>e+({1:"st",2:"nd",3:"rd"}[e[e.length-1]]||"th"),pe=new RegExp("\u200e");let fe="en-US",ve=me,ye={},be={},Ce={};function we(e,t,n){let r=(be[e]||(be[e]=new Intl.DateTimeFormat(fe,t))).format(n);return G.isIE11&&(r=r.replace(pe,"")),r}const Se="YYYY-MM-DDTHH:mm:ss.SSSZ",De={M:e=>e.getMonth()+1,Mo:e=>ve(De.M(e).toString()),MM:e=>(e.getMonth()+1).toString().padStart(2,"0"),MMM:e=>we("MMM",{month:"short"},e),MMMM:e=>we("MMMM",{month:"long"},e),Q:e=>Math.ceil((e.getMonth()+1)/4),Qo:e=>ve(De.Q(e).toString()),D:e=>e.getDate(),Do:e=>ve(De.D(e).toString()),DD:e=>e.getDate().toString().padStart(2,"0"),DDD:e=>Math.ceil((new Date(e.getFullYear(),e.getMonth(),e.getDate(),12,0,0)-new Date(e.getFullYear(),0,0,12,0,0))/864e5),DDDo:e=>ve(De.DDD(e).toString()),DDDD:e=>De.DDD(e).toString().padStart(3,"0"),d:e=>e.getDay(),do:e=>ve(e.getDay().toString()),dd:e=>De.ddd(e).substring(0,2),ddd:e=>we("ddd",{weekday:"short"},e),dddd:e=>we("dddd",{weekday:"long"},e),e:e=>e.getDay(),E:e=>e.getDay()+1,W:e=>{const t=new Date(e.valueOf());t.setDate(t.getDate()-(e.getDay()+6)%7+3);const n=t.valueOf();return t.setMonth(0,1),4!==t.getDay()&&t.setMonth(0,1+(4-t.getDay()+7)%7),1+Math.ceil((n-t)/6048e5)},Wo:e=>ve(De.W(e).toString()),WW:e=>De.W(e).toString().padStart(2,"0"),Y:e=>e.getFullYear(),YY:e=>e.getFullYear()%100,YYYY:e=>e.getFullYear(),A:e=>e.getHours()<12?"AM":"PM",a:e=>e.getHours()<12?"am":"pm",H:e=>e.getHours(),HH:e=>e.getHours().toString().padStart(2,"0"),h:e=>e.getHours()%12||12,hh:e=>De.h(e).toString().padStart(2,"0"),k:e=>e.getHours()+1,kk:e=>De.k(e).toString().padStart(2,"0"),K:e=>we("K",{hour:"numeric"},e),KK:e=>we("KK",{hour:"2-digit"},e),m:e=>e.getMinutes(),mm:e=>De.m(e).toString().padStart(2,"0"),s:e=>e.getSeconds(),ss:e=>De.s(e).toString().padStart(2,"0"),S:e=>e.getMilliseconds().toString().substr(0,1),SS:e=>e.getMilliseconds().toString().substr(0,2).padEnd(2,"0"),SSS:e=>e.getMilliseconds().toString().substr(0,3).padEnd(3,"0"),z:e=>we("z",{timeZoneName:"short"},e),zz:e=>we("zz",{timeZoneName:"long"},e),LT:e=>we("LT",{hour:"2-digit",minute:"2-digit"},e),LTS:e=>we("LTS",{hour:"2-digit",minute:"2-digit",second:"2-digit"},e),L:e=>we("L",{year:"numeric",month:"2-digit",day:"2-digit"},e),l:e=>we("l",{year:"numeric",month:"numeric",day:"numeric"},e),LL:e=>we("LL",{year:"numeric",month:"long",day:"numeric"},e),ll:e=>we("ll",{year:"numeric",month:"short",day:"numeric"},e),LLL:e=>we("LLL",{year:"numeric",month:"long",day:"numeric",hour:"numeric",minute:"2-digit"},e),lll:e=>we("lll",{year:"numeric",month:"short",day:"numeric",hour:"numeric",minute:"2-digit"},e),LLLL:e=>we("LLLL",{year:"numeric",month:"long",day:"numeric",hour:"numeric",minute:"2-digit",weekday:"long"},e),llll:e=>we("llll",{year:"numeric",month:"short",day:"numeric",hour:"numeric",minute:"2-digit",weekday:"short"},e)},Ee=`^(?:${Object.keys(De).sort((e,t)=>t.length-e.length).join("|")})`,xe=()=>({}),Te={YYYY:e=>({year:parseInt(e)}),Y:e=>({year:parseInt(e)}),YY:e=>{const t=parseInt(e);return{year:t+(t>1968?1900:2e3)}},MM:e=>({month:parseInt(e)-1}),Mo:e=>({month:parseInt(e)-1}),DD:e=>({date:parseInt(e)}),M:e=>({month:parseInt(e)-1}),D:e=>({date:parseInt(e)}),Do:e=>({date:parseInt(e)}),DDD:xe,MMM:xe,MMMM:xe,DDDo:xe,DDDD:xe,d:xe,do:xe,dd:xe,ddd:xe,dddd:xe,Q:xe,Qo:xe,W:xe,Wo:xe,WW:xe,e:xe,E:xe,HH:e=>({hours:parseInt(e)}),mm:e=>({minutes:parseInt(e)}),H:e=>({hours:parseInt(e)}),m:e=>({minutes:parseInt(e)}),ss:e=>({seconds:parseInt(e)}),s:e=>({seconds:parseInt(e)}),S:e=>({milliseconds:parseInt(e)}),SS:e=>({milliseconds:parseInt(e)}),SSS:e=>({milliseconds:parseInt(e)}),A:e=>({amPm:e.toLowerCase()}),a:e=>({amPm:e.toLowerCase()}),L:"MM/DD/YYYY",LT:"HH:mm A",Z:e=>{if(!e)return{};let t=0;if(!e.endsWith("Z")){const n=je.exec(e);t=n?("+"===n[1]?1:-1)*(60*(parseInt(n[2])||0)+(parseInt(n[3])||0)):-1*(new Date).getTimezoneOffset()}return{timeZone:t}}},Re=Object.keys(Te).sort((e,t)=>t.length-e.length),ke=new RegExp(`(${Re.join("|")})`),Me=new RegExp("(l|LL|ll|LLL|lll|LLLL|llll)"),Ie={year:{year:1,quarter:4,month:12,week:52,day:365,hour:8760,minute:525600,second:31536e3,millisecond:31536e6},quarter:{year:.25,quarter:1,month:3,week:4,day:91,hour:2184,minute:131040,second:7862400,millisecond:78624e5},month:{year:1/12,quarter:1/3,month:1,week:4,day:-30,hour:-720,minute:-43200,second:-2592e3,millisecond:-2592e6},week:{year:-1/52,quarter:-1/13,month:-.25,day:7,hour:168,minute:10080,second:604800,millisecond:6048e5},day:{year:-1/365,quarter:-1/91,month:-1/30,week:1/7,hour:24,minute:1440,second:86400,millisecond:864e5},hour:{year:-1/8760,quarter:-1/2184,month:-1/720,week:1/168,day:1/24,minute:60,second:3600,millisecond:36e5},minute:{year:-1/525600,quarter:-1/131040,month:-1/43200,week:1/10080,day:1/1440,hour:1/60,second:60,millisecond:6e4},second:{year:-1/31536e3,quarter:-1/7862400,month:-1/2592e3,week:1/604800,day:1/86400,hour:1/3600,minute:1/60,millisecond:1e3},millisecond:{year:-1/31536e6,quarter:-1/78624e5,month:-1/2592e6,week:1/6048e5,day:1/864e5,hour:1/36e5,minute:1/6e4,second:.001}},Ae={ms:"millisecond",milliseconds:"millisecond",s:"second",seconds:"second",m:"minute",minutes:"minute",h:"hour",hours:"hour",d:"day",days:"day",w:"week",weeks:"week",M:"month",months:"month",q:"quarter",quarters:"quarter",y:"year",years:"year"},Fe=/^\s*([-+]?\d+(?:[.,]\d*)?|[-+]?(?:[.,]\d+))\s*([^\s]+)?/i,Oe=/^\s*([-+]?\d+)(?![.,])\s*([^\s]+)?/i,Le=["millisecond","second","minute","hour","day","week","month","quarter","year"],_e=["year","month","week","day","hour","minute","second","millisecond"],Pe=["milliseconds","seconds","minutes","hours","date","month","year"],$e=e=>{const t=parseFloat(e);return isNaN(t)?null:t},je=/([+-])(\d\d):*(\d\d)*$/,He={millisecond:0,second:1,minute:2,hour:3,day:4,week:5,month:6,quarter:7,year:8},Ne=function(){class e extends(ge()){static buildParser(t){const n=t.split(ke),r=[];return 1===n.length||Me.test(t)?[]:(n.reduce((n,s,i,o)=>{if(0!==i||""!==s)if(ke.test(s)){const a=("parsers"!==this.L("parsers")&&this.L("parsers")||{})[s]||Te[s];if("Z"===s&&i<o.length-2)throw new Error(`Invalid format ${t} TimeZone (Z) must be last token`);if("string"==typeof a){const t=e.buildParser(a),s=t.pop();delete s.last,r.push(...t),n=s}else n.pattern=s,n.fn=Te[s]}else n.splitter=s,r.push(n),n={};else n.hasOwnProperty("pattern")&&r.push(n);return n},{}),r[r.length-1].last=!0,r)}static parse(t,n=Se){if(!t)return null;if(t instanceof Date)return t;let r={year:0,month:0,date:0,hours:0,minutes:0,seconds:0,milliseconds:0},s=Ce[n];return s||(s=Ce[n]=e.buildParser(n)),s.reduce((e,t)=>{if(!t.last){let n,s,i;if(-1===(n="T"===t.splitter&&-1===e.indexOf("T")?e.indexOf(" "):e.indexOf(t.splitter))||""===t.splitter){let t=e.split(/([Z\-+])/);1===t.length?(s=e,i=""):(s=t[0],i=`${t[1]}${t[2]}`)}else s=e.substring(0,n)||e,i=e.substring(n+t.splitter.length);return t.fn&&Object.assign(r,t.fn(s)),i}Object.assign(r,t.fn(e))},t),this.create(r)||new Date(t)}static create(e){const t=Object.assign({},e);let n=!0,r=!1;if(Pe.forEach(e=>{e in t&&!isNaN(t[e])||(t[e]=0),t[e]>0&&(n=!1)}),"pm"===t.amPm&&(t.hours=t.hours%12+12),"timeZone"in t&&(r=!0,t.minutes-=t.timeZone),n)return null;const s=[t.year,t.month,t.date,t.hours,t.minutes,t.seconds,t.milliseconds];return r?new Date(Date.UTC(...s)):new Date(...s)}static format(e,t=Se){if(!e)return null;let n=ye[t],r="";if(!n){n=ye[t]=[];for(let e=0;e<t.length;e++){const r=t.substr(e).match(Ee),s=r&&r[0];if(s){const t="formats"!==this.L("formats")&&this.L("formats")||{};n.push(t[s]||De[s]),e+=s.length-1}else if("{"===t[e]){const r=t.indexOf("}",e+1);-1===r?(n.push(t.substr(e+1)),e=t.length):(n.push(t.substring(e+1,r)),e=r)}else n.push(t[e])}}return n.forEach(t=>{r+="string"==typeof t?t:t(e)}),(G.isEdge||G.isIE11)&&(r=r.replace(/\u200E/g,"")),r}static asMilliseconds(e,t=null){return"string"==typeof e&&(t=e,e=1),this.as("millisecond",e,t)}static formatDelta(e,t=!1){const n=[],r=t?this.getShortNameOfUnit:this.getLocalizedNameOfUnit,s=t?"":" ";for(const i of _e){const t=Math.floor(this.as(i,e));if(t&&(n.push(`${t}${s}${r.call(this,i,t>1)}`),e-=this.as("ms",t,i)),!e)break}return n.join(", ")}static as(e,t,n="ms"){return e===n?t:(e=this.normalizeUnit(e),n=this.normalizeUnit(n),He[n]>He[e]?t*Math.abs(Ie[n][e]):t/Math.abs(Ie[e][n]))}formatContainsHourInfo(e){return e.match(/[Hhk]/)}static is24HourFormat(e){return this.format(new Date(1970,0,0,13,0,0),e).includes("13")}static add(t,n,r="ms"){const s=this;let i;if(i="string"==typeof t?s.parse(t):new Date(t.getTime()),!r||0===n)return i;switch(r=e.normalizeUnit(r)){case"millisecond":i=new Date(i.getTime()+n);break;case"second":i=new Date(i.getTime()+1e3*n);break;case"minute":i=new Date(i.getTime()+6e4*n);break;case"hour":i=new Date(i.getTime()+36e5*n);break;case"day":n%1==0?i.setDate(i.getDate()+n):i=new Date(i.getTime()+864e5*n),23===i.getHours()&&0===i.getHours()&&(i=s.add(i,1,"hour"));break;case"week":i.setDate(i.getDate()+7*n);break;case"month":let t=i.getDate();t>28&&(t=Math.min(t,s.getLastDateOfMonth(s.add(s.getFirstDateOfMonth(i),n,"month")).getDate())),i.setDate(t),i.setMonth(i.getMonth()+n);break;case"quarter":i=s.add(i,3*n,"month");break;case"year":i.setFullYear(i.getFullYear()+n)}return i}static diff(t,n,r="ms",s=!0){if(r=e.normalizeUnit(r),!t||!n)return 0;let i;switch(r){case"year":i=this.diff(t,n,"month")/12;break;case"quarter":i=this.diff(t,n,"month")/3;break;case"month":i=12*(n.getFullYear()-t.getFullYear())+(n.getMonth()-t.getMonth());break;case"week":i=this.diff(t,n,"day")/7;break;case"day":const e=t.getTimezoneOffset()-n.getTimezoneOffset();i=(n-t+60*e*1e3)/864e5;break;case"hour":i=(n-t)/36e5;break;case"minute":i=(n-t)/6e4;break;case"second":i=(n-t)/1e3;break;case"millisecond":i=n-t}return s?i:Math.round(i)}static startOf(e,t="day",n=!0){if(!e)return null;t=this.normalizeUnit(t),n&&(e=this.clone(e));const r={},s=Le.indexOf(t);for(let i=0;i<s;i++){const e=Le[i];"quarter"!==e&&"week"!==e&&(r[e]="day"===e?1:0)}if("quarter"===t)r.month=3*(this.get(e,"quarter")-1);else if("week"===t){const t=e.getDay()-this.weekStartDay;r.day=e.getDate()-t}return this.set(e,r)}static clone(e){return new Date(e.getTime())}static clearTime(t,n=!0){return e.startOf(t,"day",n)}static set(e,t,n){if(!t)return e;if("string"==typeof t)switch(this.normalizeUnit(t)){case"millisecond":(0!==n||e.getMilliseconds()>0)&&e.setMilliseconds(n);break;case"second":(0!==n||e.getSeconds()>0)&&e.setSeconds(n);break;case"minute":(0!==n||e.getMinutes()>0)&&e.setMinutes(n);break;case"hour":e.setHours(n);break;case"day":case"date":e.setDate(n);break;case"week":throw new Error("week not implemented");case"month":e.setMonth(n);break;case"quarter":e.setDate(1),e.setMonth(3*(n-1));break;case"year":e.setFullYear(n)}else Object.entries(t).sort((e,t)=>Le.indexOf(e[0])-Le.indexOf(t[0])).forEach(([t,n])=>{this.set(e,t,n)});return e}static constrain(e,t,n){return this.min(this.max(e,t),n)}static getTime(e,t=0,n=0){return new Date(1970,0,1,e,t,n)}static isDST(e){const t=new Date(e.getFullYear(),0,1),n=new Date(e.getFullYear(),6,1);return e.getTimezoneOffset()<Math.max(t.getTimezoneOffset(),n.getTimezoneOffset())}static isBefore(e,t){return e<t}static isAfter(e,t){return e>t}static isEqual(e,t,n=null){return null===n?e-t==0:this.startOf(e,n)-this.startOf(t,n)==0}static compare(e,t,n=null){return n&&(e=this.startOf(e,n),t=this.startOf(t,n)),this.isBefore(e,t)?-1:this.isAfter(e,t)?1:0}static isStartOf(e,t){return this.isEqual(e,this.startOf(e,t))}static betweenLesser(e,t,n){return t.getTime()<=e.getTime()&&e.getTime()<n.getTime()}static betweenLesserEqual(e,t,n){return t.getTime()<=e.getTime()&&e.getTime()<=n.getTime()}static intersectSpans(e,t,n,r){return this.betweenLesser(e,n,r)||this.betweenLesser(n,e,t)}static compareUnits(e,t){const n=Le.indexOf(e),r=Le.indexOf(t);return Math.sign(n-r)}static timeSpanContains(e,t,n,r){return n-e>=0&&t-r>=0}static get weekStartDay(){let e=this.L("weekStartDay");return"weekStartDay"!==e?e:0}static get(e,t){switch(this.normalizeUnit(t)){case"millisecond":return e.getMilliseconds();case"second":return e.getSeconds();case"minute":return e.getMinutes();case"hour":return e.getHours();case"date":case"day":return e.getDate();case"week":return De.W(e);case"month":return e.getMonth();case"quarter":return Math.floor(e.getMonth()/3)+1;case"year":return e.getFullYear()}return null}static daysInMonth(e){const t=this.clone(e);return t.setDate(1),t.setMonth(e.getMonth()+1),t.setDate(0),t.getDate()}static getFirstDateOfMonth(e){return new Date(e.getFullYear(),e.getMonth(),1)}static getLastDateOfMonth(e){return new Date(e.getFullYear(),e.getMonth()+1,0)}static min(e,t){return e.getTime()<t.getTime()?e:t}static max(e,t){return e.getTime()>t.getTime()?e:t}static getNext(e,t,n=1,r=this.weekStartDay){const s=this;if("week"===t){let t=s.clone(e),i=t.getDay();return t=s.startOf(t,"day"),(t=s.add(t,r-i+7*(n-(r<=i?0:1)),"day")).getDay()!==r&&s.add(t,1,"hour"),t}return s.startOf(s.add(e,n,t),t)}static getStartOfNextDay(t,n,r){let s=e.add(r?t:e.clearTime(t,n),1,"day");if(s.getDate()==t.getDate()){let r=e.add(e.clearTime(t,n),"day",2).getTimezoneOffset(),i=t.getTimezoneOffset();s=e.add(s,i-r,"minute")}return s}static getEndOfPreviousDay(t,n){let r=n?t:e.clearTime(t,!0);return r-t?r:this.add(r,-1,"day")}static formatCount(t,n){return n=e.normalizeUnit(n),1!==t&&(n+="s"),t+" "+n}static getUnitToBaseUnitRatio(t,n,r=!1){return(t=e.normalizeUnit(t))===(n=e.normalizeUnit(n))?1:Ie[t]&&Ie[t][n]&&(r||Ie[t][n]>0)?1/e.as(n,1,t):Ie[n]&&Ie[n][t]&&(r||Ie[n][t]>0)?e.as(t,1,n):-1}static getMeasuringUnit(e){return"week"===e?"day":e}static getShortNameOfUnit(e){return e=this.parseTimeUnit(e),this.unitLookup[e].abbrev}static getLocalizedNameOfUnit(e,t){return e=this.normalizeUnit(e),e=this.parseTimeUnit(e),this.unitLookup[e][t?"plural":"single"]}static normalizeUnit(e){return e?"date"===e.toLowerCase()?e.toLowerCase():Le.includes(e.toLowerCase())?e.toLowerCase():Ae[e]||Ae[e.toLowerCase()]:null}static getUnitByName(t){return e.normalizeUnit(t)||e.normalizeUnit(this.parseTimeUnit(t))}static getDurationInUnit(e,t,n,r){return this.diff(e,t,n,r)}static doesUnitsAlign(e,t){return e===t||"week"!==t}static getSmallerUnit(e){return Le[He[this.normalizeUnit(e)]-1]||null}static getLargerUnit(e){return Le[He[this.normalizeUnit(e)]+1]||null}static parseDuration(e,t=!0,n){const r=(t?Fe:Oe).exec(e);if(null==e||!r)return null;const s=$e(r[1]),i=this.parseTimeUnit(r[2])||n;return i?{magnitude:s,unit:i}:null}static parseTimeUnit(e){const t=null==e?null:this.durationRegEx.exec(e.toLowerCase());if(!t)return null;for(let n=0;n<Le.length;n++)if(t[n+1])return Le[n]}static set locale(e){fe=e}static get locale(){return fe}static applyLocale(){const e=this,t=e.L("unitAbbreviations"),n=e.unitNames=e.L("unitNames");if("unitNames"===n)return;"en-US"===(fe=e.L("locale")||"en-US")?ve=me:"ordinalSuffix"!==e.L("ordinalSuffix")&&(ve=e.L("ordinalSuffix")),ye={},Ce={},be={};let r="";e.unitLookup={};for(let s=0;s<t.length;s++){const i=t[s],o=n[s];o.canonicalUnitName=Le[s],e.unitLookup[o.single]=e.unitLookup[o.single.toUpperCase()]=e.unitLookup[o.canonicalUnitName]=e.unitLookup[o.canonicalUnitName.toUpperCase()]=o,r+=`${s?"|":""}(`;for(let e=0;e<i.length;e++)r+=`${i[e]}|`;r+=`${o.single}|${o.plural}|${o.canonicalUnitName})`}e.durationRegEx=new RegExp(`^(?:${r})$`)}}return e._$name="DateHelper",e._$name="DateHelper",e}();he.on({locale:"applyLocale",thisObj:Ne}),he.locale&&Ne.applyLocale();const ze=/\s+/,Be=e=>{const t=typeof e;if("object"===t){if(null===e)return"null";if("[object Date]"===Object.prototype.toString.call(e))return"date"}return t},Ve="1.01"===1.005.toFixed(2)?null:function(e,t){const n=e.toString().split("."),r=+(n[1]?n.join(".")+"1":n[0]);return e.toFixed.call(r,t)},We=function(){class e{static isEqual(e,t,n=!1){if(null===e&&null!==t||void 0===e&&void 0!==t||null===t&&null!==e||void 0===t&&void 0!==e)return!1;if(null==e&&null==t)return!0;const r=typeof e;if(r===typeof t){switch(r){case"number":case"string":case"boolean":return e===t}switch(!0){case e instanceof Date&&t instanceof Date:return e-t==0;case Array.isArray(e)&&Array.isArray(t):return e.length===t.length&&e.every((e,r)=>this.isEqual(e,t[r],n));case"object"===r&&e.constructor.prototype===t.constructor.prototype:return n?this.isDeeplyEqual(e,t,n):JSON.stringify(e)===JSON.stringify(t)}}return String(e)===String(t)}static isDeeplyEqual(e,t,n={}){if(e===t)return!0;if(!e||!t)return!1;const r=this.keys(e,n.ignore),s=this.keys(t,n.ignore);if(r.length!==s.length)return!1;for(let i=0;i<r.length;i++){const o=r[i],a=s[i];if(o!==a)return!1;const l=e[o],c=t[a];if(!n.shouldEvaluate||!1!==n.shouldEvaluate(o,{value:l,object:e},{value:c,object:t})){if(n.evaluate){const r=n.evaluate(o,{value:l,object:e},{value:c,object:t});if(!1===r)return!1;if(!0===r)continue}if(!this.isEqual(l,c,n))return!1}}return!0}static isPartial(e,t){return e=String(e).toLowerCase(),t=String(t).toLowerCase(),-1!=e.indexOf(t)}static isLessThan(e,t){return e instanceof Date&&t instanceof Date?Ne.isBefore(e,t):e<t}static isMoreThan(e,t){return e instanceof Date&&t instanceof Date?Ne.isAfter(e,t):e>t}static fork(e){var t,n,r;if(e&&e.constructor===Object)for(n in t=Object.setPrototypeOf({},e),e)(r=e[n])&&(r.constructor===Object?t[n]=this.fork(r):r instanceof Array&&(t[n]=r.slice()));else t=e;return t}static assign(e,...t){for(var n,r,s=0,i=t.length;s<i;s++)for(r in n=t[s])e[r]=n[r];return e}static clone(e){if(null==e)return e;var t,n,r=e.constructor.name,s=e;if("Date"===r)return new Date(e.getTime());if("Array"===r)for(t=e.length,s=[];t--;)s[t]=this.clone(e[t]);else if("Object"===r)for(n in s={},e)s[n]=this.clone(e[n]);return s}static merge(e,...t){for(var n,r,s,i,o=0,a=t.length;o<a;o++)for(r in n=t[o])(s=n[r])&&s.constructor===Object?(i=e[r])&&"Object"===i.constructor.name?this.merge(i,s):e[r]=this.clone(s):e[r]=s;return e}static copyProperties(e,t,n){let r,s;for(s=0;s<n.length;s++)(r=n[s])in t&&(e[r]=t[r]);return e}static copyPropertiesIf(e,t,n){for(const r of n)r in e||(e[r]=t[r]);return e}static keys(e,t=null){const n=[];for(const r in e)t&&t[r]||n.push(r);return n}static isEmpty(e){for(const t in e)return!1;return!0}static getTruthyKeys(e){const t=Object.keys(e);for(let n=0;n<t.length;)e[t[n]]?n++:t.splice(n,1);return t}static getTruthyValues(e){const t=Object.keys(e);for(let n=0;n<t.length;)e[t[n]]?t[n]=e[t[n++]]:t.splice(n,1);return t}static createTruthyKeys(e){"string"==typeof e&&(e=e.split(ze));const t={};for(const n of e)n.length&&(t[n]=1);return t}static allKeys(e){const t=[];for(;e;e=Object.getPrototypeOf(e))t.push(...Object.keys(e));return t}static pathExists(e,t){return t.split(".").every(t=>t in e&&(e=e[t],!0))}static getPath(e,t){return t.split(".").reduce((e,t)=>(e||{})[t],e)}static setPath(e,t,n){t.split(".").reduce((e,t,r,s)=>r===s.length-1?e[t]=n:(e[t]instanceof Object||(e[t]={}),e[t]),e)}static coerce(e,t){var n=Be(e),r=Be(t),s="string"==typeof e;if(n!==r)switch(r){case"string":return String(e);case"number":return Number(e);case"boolean":return!(s&&(!e||"false"===e||"0"===e))&&Boolean(e);case"null":return!(!s||e&&"null"!==e)&&null;case"undefined":return!(!s||e&&"undefined"!==e)&&void 0;case"date":return s&&isNaN(e)?Ne.parse(e):Date(Number(e))}return e}static wrapProperty(e,t,n,r,s=!0){const i={};let o=Object.getPrototypeOf(e),a=Object.getOwnPropertyDescriptor(o,t);for(;!a&&o&&s;)(o=Object.getPrototypeOf(o))&&(a=Object.getOwnPropertyDescriptor(o,t));a?(i.set=a.set?t=>{a.set.call(e,t),r&&r.call(e,a.get.call(e))}:r,i.get=a.get?()=>{let t=a.get.call(e);return n&&(t=n.call(e,t)),t}:n):(i.set=(n=>{e[`_${t}`]=n,r&&r.call(e,n)}),i.get=(()=>{let r=e[`_${t}`];return n&&(r=n.call(e,r)),r})),Object.defineProperty(e,t,i)}static getPropertyDescriptor(e,t){let n=null;for(let r=e;!n&&r!==W;r=Object.getPrototypeOf(r))n=Object.getOwnPropertyDescriptor(r,t);return n}static cleanupProperties(e){return Object.entries(e).forEach(([t,n])=>null==n&&delete e[t]),e}static assertType(e,t,n){if(null!=e&&typeof e!==t)throw new Error(`Incorrect type "${typeof e}" for ${n}, expected "${t}"`)}static assertNumber(e,t){this.assertType(e,"number",t)}static assertBoolean(e,t){this.assertType(e,"boolean",t)}static toFixed(e,t){return Ve?Ve(e,t):e.toFixed(t)}}return e._$name="ObjectHelper",e}(),Ue=14,Ge={align:"t0-t0"};let Ye=null,qe=0,Xe=null;const Ke=/(?:matrix\((?:-?\d*\.?[0-9]*),\s?(?:-?\d*\.?[0-9]*),\s?(?:-?\d*\.?[0-9]*),\s?(?:-?\d*\.?[0-9]*),\s?(-?\d*\.?[0-9]*),\s?(-?\d*\.?[0-9]*))|(?:matrix3d\((?:-?\d*),\s?(?:-?\d*),\s?(?:-?\d*),\s?(?:-?\d*),\s?(?:-?\d*),\s?(?:-?\d*),\s?(?:-?\d*),\s?(?:-?\d*),\s?(?:-?\d*),\s?(?:-?\d*),\s?(?:-?\d*),\s?(?:-?\d*),\s?(-?\d*),\s?(-?\d*))/,Ze=/translate(3d|X)?\((-?\d*\.?[0-9]*)px(?:,\s?(-?\d*\.?[0-9]*)px)?/,Je=/translate(3d|Y)?\((-?\d*\.?[0-9]*)px(?:,\s?(-?\d*\.?[0-9]*)px)?/,Qe=/^[^a-z]+|[^\w:.-]+/gi,et=/\s+/,tt={tag:1,html:1,children:1,tooltip:1,style:1,dataset:1,parent:1,nextSibling:1,ns:1,reference:1,unmatched:1,_element:1,onlyChildren:1,elementData:1,compareHtml:1},nt={tag:1,html:1,children:1,tooltip:1,parent:1,nextSibling:1,ns:1,reference:1,_element:1,elementData:1,retainElement:1,compareHtml:1},rt={length:1,parentRule:1},st={width:1,height:1,top:1,left:1,minWidth:1,minHeight:1,maxWidth:1,maxHeight:1,fontSize:1},it={BUTTON:1,IFRAME:1,EMBED:1,INPUT:1,OBJECT:1,SELECT:1,TEXTAREA:1,HTML:G.isIE11?1:0,BODY:G.isIE11?0:1},ot=window,at=document,lt={},ct=[],dt=Array.prototype.slice,ut=new Promise(e=>e()),ht=window.devicePixelRatio||1,gt=1===ht?Math.round:e=>Math.round(e*ht)/ht,mt=["font-size","font-size-adjust","font-style","font-weight","font-family","font-kerning","font-stretch","line-height","text-transform","text-decoration","letter-spacing","word-break"],pt={ignore:{_element:1,parent:1,elementData:1,ns:1},evaluate(e,t,n){if("html"===e&&"string"!=typeof t.value)return t.object.compareHtml===n.object.compareHtml}};let ft,vt;const yt=function(){class e{static isFocusable(e,t=!1){if(!t&&e!==document.body&&!e.offsetParent)return!1;const n=e.nodeName;return it[n]||("A"===n||"LINK"===n)&&!!e.href||null!=e.getAttribute("tabIndex")||"true"===e.contentEditable}static isInView(e,t=!0){let n=oe.from(e),r=!0;const s=n.height,i=n.width;for(;r&&e.parentElement;)r=(n=n.intersect(oe.from(e=e.parentElement)))&&(!t||n.height>=s&&n.width>=i);return r}static isCustomElement(e){return e&&e.shadowRoot}static elementFromPoint(t,n){let r=document.elementFromPoint(t,n);return e.isCustomElement(r)&&(r=r.shadowRoot.elementFromPoint(t,n)||r),r}static get activeElement(){let e=document.activeElement;for(;e.shadowRoot;)e=e.shadowRoot.activeElement;return e}static getId(e){return e.id||(e.id="b-element-"+ ++qe)}static getElement(e){return e instanceof Element?e:at.querySelector(e)}static setAttributes(e,t){const n=this.getElement(e);Object.entries(t).forEach(([e,t])=>n.setAttribute(e,t))}static setLength(e,t,n){return 1===arguments.length?"number"==typeof e?`${e}px`:e:(e=this.getElement(e)).style[t]="number"==typeof n?`${n}px`:n}static getChild(e,t){return t=G.supportsQueryScope?":scope>"+t:`#${e.id||(e.id="b-element-"+ ++qe)} > ${t}`,e.querySelector(t)}static hasChild(t,n){return null!=e.getChild(t,n)}static children(e,t){return Array.from(e.querySelectorAll(t))}static down(e,t){return e?e.matches&&e.matches(t)?e:(t=G.supportsQueryScope?":scope "+t:`#${e.id||(e.id="b-element-"+ ++qe)} ${t}`,e.querySelector(t)):null}static isDescendant(e,t){return e.contains||(e=e.body),e.contains(t)}static forEachSelector(e,t,n){"string"==typeof e&&(n=t,t=e,e=at),this.children(e,t).forEach(n)}static forEachChild(e,t){Array.from(e.children).forEach(t)}static removeEachSelector(e,t){this.forEachSelector(e,t,e=>e.remove())}static removeClsGlobally(e,...t){t.forEach(t=>this.forEachSelector(e,"."+t,e=>e.classList.remove(t)))}static up(e,t){return e&&e.closest(t)}static getAncestor(e,t,n=null){let r,s=!1,i=e;for(Array.isArray(t)||(t=[t]);i=i.parentElement;){if(t.includes(i)){s=!0;break}if(n&&i===n)break;r=i}return s?r||e:null}static makeValidId(e){return null==e?null:String(e).replace(Qe,"")}static createElement(t={},n=!1,r=null,s=null){"string"==typeof t.parent&&(t.parent=document.getElementById(t.parent));const i=t.parent||t.nextSibling&&t.nextSibling.parentNode;let o;o=t.ns?at.createElementNS(t.ns,t.tag||"svg"):at.createElement(t.tag||"div"),t.html&&(t.html instanceof DocumentFragment?o.appendChild(t.html):o.innerHTML=t.html),t.tooltip&&I.attachTooltip(o,t.tooltip),t.style&&this.applyStyle(o,t.style),t.dataset&&Object.assign(o.dataset,t.dataset),i&&i.insertBefore(o,t.nextSibling),t.reference&&((r||(r={}))[t.reference]=o,o.setAttribute("reference",t.reference)),t.elementData&&(o.elementData=t.elementData);for(const e of Object.keys(t))tt[e]||(t.ns?o.setAttribute(e,t[e]):o[e]=t[e]);return!0===n?n=[o]:Array.isArray(n)&&n.push(o),t.children&&(s&&(o.syncIdMap={}),t.children.forEach(i=>{if("string"==typeof i)o.appendChild(document.createTextNode(i));else if(isNaN(i.nodeType)){i.parent=o,i.ns||(i.ns=t.ns);const a=e.createElement(i,n,r,s),l=i.dataset&&i.dataset[s];null!=l&&(o.syncIdMap[l]=a),delete i.parent}else o.appendChild(i)})),s&&(o.lastConfig=t),r||n||o}static createElementFromTemplate(t,n=lt){const{array:r,raw:s,fragment:i}=n;let o;if(e.supportsTemplate){if((ft||(ft=at.createElement("template"))).innerHTML=t,o=ft.content,i)return o.cloneNode(!0)}else{if((vt||(vt=new DOMParser)).parseFromString(t,"text/html"),o=vt.parseFromString(t,"text/html").body,i){const e=o?o.childNodes:ct;for(o=document.createDocumentFragment();e.length;)o.appendChild(e[0]);return o}o||(o={children:[],childNodes:[]})}return 1!==(o=s?o.childNodes:o.children).length||r?dt.call(o):o[0]}static insertFirst(t,n){return n&&n.nodeType!==Node.ELEMENT_NODE&&n.tag&&(n=e.createElement(n)),t.insertBefore(n,t.firstElementChild)}static insertBefore(t,n,r){return n&&n.nodeType!==Node.ELEMENT_NODE&&n.tag&&(n=e.createElement(n)),r?t.insertBefore(n,r):e.insertFirst(t,n)}static append(t,n){return n&&("string"==typeof n?n=e.createElementFromTemplate(n):n.nodeType!==Node.ELEMENT_NODE&&n.tag&&(n=e.createElement(n))),Array.isArray(n)?n.map(e=>t.appendChild(e)):t.appendChild(n)}static getTranslateX(e){let t=e.style.transform,n=Ze.exec(t);return n?parseInt(n[2]):(n=Ke.exec(t)||Ke.exec(this.getStyleValue(this.getElement(e),"transform")))?parseInt(n[1]||n[3]):0}static getTranslateY(e){let t=e.style.transform,n=Je.exec(t);if(n){const e=parseInt(n["Y"===n[1]?2:3]);return isNaN(e)?0:e}return(n=Ke.exec(t)||Ke.exec(this.getStyleValue(this.getElement(e),"transform")))?parseInt(n[2]||n[4]):0}static getTranslateXY(e){return[this.getTranslateX(e),this.getTranslateY(e)]}static getOffsetX(e,t=null){return t?e.getBoundingClientRect().left-t.getBoundingClientRect().left:e.offsetLeft}static getOffsetY(e,t=null){return t?e.getBoundingClientRect().top-t.getBoundingClientRect().top:e.offsetTop}static getOffsetXY(e,t=null){return[this.getOffsetX(e,t),this.getOffsetY(e,t)]}static focusWithoutScrolling(e){if(G.chromeVersion>=64||G.fireFoxVersion>=68)e.focus({preventScroll:!0});else{const t=[];let n=e.parentNode;for(;n&&null!=n.scrollLeft;)t.push({element:n,scrollLeft:n.scrollLeft,scrollTop:n.scrollTop}),n=n.parentNode;e.focus(),t.forEach(({element:e,scrollLeft:t,scrollTop:n})=>{e.scrollLeft!==t&&(e.scrollLeft=t),e.scrollTop!==n&&(e.scrollTop=n)})}}static getPageX(e){return e.getBoundingClientRect().left+ot.pageXOffset}static getPageY(e){return e.getBoundingClientRect().top+ot.pageYOffset}static getExtremalSizePX(e,t){let n=$.hyphenate(t),r=n.split("-")[1],s=this.getStyleValue(e,n);return/%/.test(s)?e.parentElement?parseInt(this.getStyleValue(e.parentElement,r),10):NaN:parseInt(s,10)}static setTranslateX(t,n){const r=e.getStyleValue(t,"transform").split(/,\s*/);n=gt(n),r.length>1?(r[r[0].startsWith("matrix3d")?12:4]=n,t.style.transform=r.join(",")):t.style.transform=`translateX(${n}px)`}static setTranslateY(t,n){const r=e.getStyleValue(t,"transform").split(/,\s*/);n=gt(n),r.length>1?(r[r[0].startsWith("matrix3d")?13:5]=n,t.style.transform=r.join(",")+")"):t.style.transform=`translateY(${n}px)`}static setTop(e,t){this.setLength(e,"top",t)}static setLeft(e,t){this.setLength(e,"left",t)}static setTranslateXY(t,n,r){if(null==n)return this.setTranslateY(t,r);if(null==r)return this.setTranslateX(t,n);n=gt(n),r=gt(r);const s=e.getStyleValue(t,"transform").split(/,\s*/),i=s[0].startsWith("matrix3d");s.length>1?(s[i?12:4]=n,s[i?13:5]=r,t.style.transform=s.join(",")+")"):t.style.transform=`translateX(${n}px) translateY(${r}px)`}static addTranslateX(t,n){e.setTranslateX(t,e.getTranslateX(t)+n)}static addTranslateY(t,n){e.setTranslateY(t,e.getTranslateY(t)+n)}static addLeft(t,n){e.setLeft(t,e.getOffsetX(t)+n)}static addTop(t,n){e.setTop(t,e.getOffsetY(t)+n)}static alignTo(e,t,n=Ge){t=t instanceof oe?t:oe.from(t,null,!0);const r=this.getTranslateXY(e),s=oe.from(e,null,!0),i=s.alignTo(Object.assign(n,{target:t}));this.setTranslateXY(e,r[0]+i.x-s.x,r[1]+i.y-s.y)}static getStyleValue(e,t,n,r){const s=n?e.style:e.ownerDocument.defaultView.getComputedStyle(e,r);if(Array.isArray(t)){let e={};for(let n of t)e[n]=s.getPropertyValue($.hyphenate(n));return e}return s.getPropertyValue($.hyphenate(t))}static applyStyle(e,t,n=!1){if("string"==typeof t)n?(t.length||e.style.cssText.length)&&(e.style.cssText=t):e.style.cssText+=t;else{n&&(e.style.cssText="");for(let n in t)rt[n]||(e.style[$.hyphenate(n)]=st[n]&&"number"==typeof t[n]?t[n]+"px":t[n])}}static getCSSText(e){if("string"==typeof e)return e;let t="";for(let n in e)rt[n]||(t+=`${$.hyphenate(n)}:${e[n]};`);return t}static addClasses(e,t){t.forEach(t=>e.classList.add(t))}static removeClasses(e,t){t.forEach(t=>e.classList.remove(t))}static toggleClasses(e,t,n=null){Array.isArray(t)||(t=[t]),!0===n?this.addClasses(e,t):!1===n?this.removeClasses(e,t):t.forEach(t=>e.classList.toggle(t))}static addTemporaryClass(e,t,n){n>0&&(e.classList.add(t),setTimeout(()=>{e&&e.classList.remove(t)},n))}static highlight(e){return e instanceof oe?e.highlight():new Promise(t=>{setTimeout(()=>{e.classList.add("b-fx-highlight"),setTimeout(()=>{e.classList.remove("b-fx-highlight"),t()},1e3)},0)})}static get scrollBarWidth(){if(null===Ye&&at.body){const t=e.createElement({parent:at.body,style:"position:absolute;top:-999px;width:100px;height:100px;overflow:scroll"});Ye=t.offsetWidth-t.clientWidth,t.remove()}return Ye}static resetScrollBarWidth(){Ye=null}static measureText(e,t,n,r){const s=this.getMeasureElement(t,r);s[n?"innerHTML":"innerText"]=e;const i=s.clientWidth;return s.className="",i}static measureSize(t,n){if(!t)return 0;if("number"==typeof t)return t;if(!t.length)return 0;if(/^\d+(px)?$/.test(t))return parseInt(t);if(n){const r=this.getMeasureElement(n);r.innerHTML="",r.style.width=e.setLength(t);const s=r.offsetWidth;return r.style.width=r.className="",s}return/^\d+em$/.test(t)?parseInt(t)*Ue:isNaN(t)?0:parseInt(t)}static getMeasureElement(t,n=at.body){const r=ot.getComputedStyle(t),s=n.offScreenDiv=n.offScreenDiv||e.createElement({parent:n,style:"position:fixed;top:-10000px;left:-10000px;visibility:hidden;contain:strict",className:"b-measure-element",children:[{style:"white-space:nowrap;display:inline-block;will-change:contents;width:auto;contain:none"}]},!0)[1];return mt.forEach(e=>{s.style[e]!==r[e]&&(s.style[e]=r[e])}),s.className=t.className,s.parentElement.parentElement!==n&&n.appendChild(s.parentElement),s}static sync(e,t){let n=e,r=!1;if(!(e instanceof HTMLElement)&&"string"!=typeof e){e.sourceElement?n=e.sourceElement:e.html?n=e.html:e.elementConfig&&(n=e.elementConfig),e.targetElement&&(t=e.targetElement);const s=(e.elementConfig?e.elementConfig.useSyncId:null)||e.useSyncId;if((r=!0===s?"syncId":s)&&!e.elementConfig)throw new Error("syncId can only be used in combination with elementConfig")}return"string"==typeof n&&(n=this.createElementFromTemplate(n)),this.performSync(n,t,r,e.callback),t}static performSync(e,t,n,r){const s=e instanceof HTMLElement,i=!s&&e.onlyChildren;return s&&e.outerHTML!==t.outerHTML||!s&&(!n||!We.isDeeplyEqual(e,t.lastConfig,pt))?(i||(this.syncAttributes(e,t),this.syncContent(e,t)),this.syncChildren(e,t,n,r),s||(t.lastConfig=e),!0):(s||r&&r({action:"none",config:e,element:t}),!1)}static getSyncAttributes(e){const t={},n=[];if(e instanceof HTMLElement)for(let r=0;r<e.attributes.length;r++){const s=e.attributes[r];if(s.specified){const e=s.name.toLowerCase();t[e]=s.value,n.push(e)}}else Object.keys(e).forEach(r=>{if(!nt[r]){const s=r;"className"===r&&(r="class");const i=r.toLowerCase();t[i]=e[s],n.push(i)}});return{attributes:t,names:n}}static syncAttributes(e,t){const{attributes:n,names:r}=this.getSyncAttributes(e),{attributes:s,names:i}=this.getSyncAttributes(t),o=r.includes("dataset"),a=r.filter(e=>!i.includes(e)),l=i.filter(e=>!(r.includes(e)||o&&e.startsWith("data-"))),c=r.filter(e=>i.includes(e));if(a.length>0)for(let d=0;d<a.length;d++){const e=a[d];"style"===e?this.applyStyle(t,n.style,!0):"dataset"===e?Object.assign(t.dataset,n.dataset):t.setAttribute(e,n[e])}if(l.length>0)for(let d=0;d<l.length;d++)t.removeAttribute(l[d]);if(c.length>0)for(let d=0;d<c.length;d++){const e=c[d];"style"===e?this.applyStyle(t,n.style,!0):"dataset"===e?Object.assign(t.dataset,n.dataset):"class"===e&&n[e].isDomClassList?n.class.isEqual(s.class)||t.setAttribute("class",n.class):s[e]!==n[e]&&t.setAttribute(e,n[e])}}static syncContent(e,t){let n,r=null;e instanceof HTMLElement?n=e.childElementCount:(n=e.children?e.children.length:0,r=e.html,e.elementData&&(t.elementData=e.elementData)),0===n&&t.childElementCount>0&&!r?t.innerHTML="":r&&(r instanceof DocumentFragment?1===t.childNodes.length&&0===t.childElementCount&&1===r.childNodes.length&&0===r.childElementCount?this.setInnerText(t,r.firstChild.data):(t.innerHTML="",t.appendChild(r)):r.includes("<")?t.innerHTML=r:this.setInnerText(t,r))}static setInnerText(e,t){const n=e.firstChild;n?n.data=t:e.textContent=t}static syncChildrenElement(e,t){const n=this,r=dt.call(e.childNodes),s=dt.call(t.childNodes);for(;r.length;){const e=r.shift(),i=s.shift();if(e&&e.nodeType!==Node.TEXT_NODE&&e.nodeType!==Node.ELEMENT_NODE)throw new Error(`Source node type ${e.nodeType} not supported by DomHelper.sync()`);if(i&&i.nodeType!==Node.TEXT_NODE&&i.nodeType!==Node.ELEMENT_NODE)throw new Error(`Target node type ${i.nodeType} not supported by DomHelper.sync()`);if(i)if(e.nodeType===i.nodeType)e.nodeType===Node.TEXT_NODE?i.data=e.data:e.tagName===i.tagName?n.performSync(e,i):(t.insertBefore(e,i),i.remove());else{if(e.nodeType!==Node.TEXT_NODE||i.nodeType!==Node.ELEMENT_NODE)throw new Error("Currently no support for transforming nodeType");t.innerText=e.data.trim()}else t.appendChild(e)}s.forEach(e=>{e.remove()})}static syncChildrenConfig(t,n,r,s){if(t.html)return;const i=this,o=dt.call(t.children||[]),a=dt.call(n.children),l=n.syncIdMap||{};let c;for(r&&(n.syncIdMap={});o.length;){const t=o.shift();if(r&&t.dataset&&null!=(c=t.dataset[r])&&!t.unmatched){const e=l[c];e?(!t.retainElement&&i.performSync(t,e,r,s)&&s&&s({action:"reuseOwnElement",config:t,element:e,syncId:c}),t.retainElement?e.retainElement=!0:e.retainElement&&(e.retainElement=!1),n.syncIdMap[c]=e,t._element=e,le.remove(a,e),e.isReleased=!1):(o.push(t),t.unmatched=!0);continue}let d;t.unmatched&&delete t.unmatched;for(let e=0;e<a.length&&!d;e++)a[e].retainElement||(d=a[e],0===e?a.shift():a.splice(e,1));if(d)if((t.tag||"div").toLowerCase()===d.tagName.toLowerCase()){const e=d.lastConfig;i.performSync(t,d,r,s),null!=c&&(n.syncIdMap[c]=d,d.isReleased=!1),t._element=d,s&&s({action:"reuseElement",config:t,oldConfig:e,element:d,syncId:c})}else{const r=n.insertBefore(e.createElement(t),d);null!=c&&(n.syncIdMap[c]=r),t._element=r,s&&s({action:"newElement",config:t,element:r,syncId:c}),d.remove()}else{const i=n.appendChild(e.createElement(t,!1,null,r));null!=c&&(n.syncIdMap[c]=i),t._element=i,s&&s({action:"newElement",config:t,element:i,syncId:c})}}a.forEach(e=>{e.retainElement?r&&(n.syncIdMap[e.dataset[r]]=e):r?e.isReleased||(e.className="b-released",e.isReleased=!0,s&&s({action:"releaseElement",config:e.lastConfig,oldConfig:e.lastConfig,element:e}),e.elementData=e.lastConfig=null):e.remove()})}static syncChildren(e,t,n,r){e instanceof HTMLElement?this.syncChildrenElement(e,t,n,r):this.syncChildrenConfig(e,t,n,r)}static syncClassList(e,t){const n=e.classList,r="string"==typeof t,s=r?t.trim().split(et):Array.isArray(t)?t:We.getTruthyKeys(t),i=s.length;let o,a=n.length!==i;for(o=0;!a&&o<i;o++)a=!n.contains(s[o]);a&&(e.className=r?t:s.join(" "))}static setTheme(t){t=t.toLowerCase();const n=this.themeInfo.name.toLowerCase(),r=document.head.querySelector("#bryntum-theme")||document.head.querySelector(`[href$="${n}.css"]`);if(!r||!r.href.includes(`${n}.css`))throw new Error(`Theme link for ${n} not found`);return r.href.includes(t)?ut:new Promise((n,s)=>{const i=document.createElement("link"),o=r.nextSibling,a=e.themeInfo.name.toLowerCase(),l={theme:t,prev:a};i.rel="stylesheet",i.id="bryntum-theme",i.addEventListener("load",()=>{Xe=null,r.remove(),window.bryntum.GlobalEvents.trigger("theme",l),n(l)}),i.addEventListener("error",e=>{s(e)}),i.href=r.href.replace(a,t),o.parentNode.insertBefore(i,o)})}static get themeInfo(){if(!Xe){const t=this.createElement({parent:document.body,className:"b-theme-info"}),n=this.getStyleValue(t,"content",!1,":before");if(n)try{Xe=JSON.parse(n.replace(/^["']|["']$|\\/g,""))}catch(e){Xe=null}t.remove()}return Xe}}return e.supportsTemplate="content"in at.createElement("template"),e._$name="DomHelper",e}();let bt;const Ct=()=>yt.isTouchEvent=!1,wt=()=>{yt.isTouchEvent=!0,clearTimeout(bt),bt=setTimeout(Ct,400)};if(at.addEventListener("touchstart",wt,!0),at.addEventListener("touchend",wt,!0),!("children"in Node.prototype)){const e=e=>1===e.nodeType;Object.defineProperty(Node.prototype,"children",{get:function(){return Array.prototype.filter.call(this.childNodes,e)}})}if(Element.prototype.matches||(Element.prototype.matches=Element.prototype.matchesSelector||Element.prototype.mozMatchesSelector||Element.prototype.msMatchesSelector||Element.prototype.oMatchesSelector||Element.prototype.webkitMatchesSelector||function(e){let t=(this.document||this.ownerDocument).querySelectorAll(e),n=t.length;for(;--n>=0&&t.item(n)!==this;);return n>-1}),ot.Element&&!Element.prototype.closest?Node.prototype.closest=Element.prototype.closest=function(e){var t=this;if(!at.documentElement.contains(t))return null;do{if(t.matches(e))return t;t=t.parentElement||t.parentNode}while(null!==t&&1===t.nodeType);return null}:Node.prototype.closest=function(e){return this.parentNode.closest(e)},[Element.prototype,CharacterData.prototype,DocumentType.prototype].forEach(function(e){e.hasOwnProperty("remove")||Object.defineProperty(e,"remove",{configurable:!0,enumerable:!0,writable:!0,value:function(){this.parentNode&&this.parentNode.removeChild(this)}})}),SVGElement.prototype.contains||(SVGElement.prototype.contains=function(e){do{if(this===e)return!0;e=e.parentNode}while(e);return!1}),"function"!=typeof ot.CustomEvent){let e,t;ot.CustomEvent=t=function(t,n={bubbles:!1,cancelable:!1,detail:void 0}){return(e=at.createEvent("CustomEvent")).initCustomEvent(t,n.bubbles,n.cancelable,n.detail),e},t.prototype=ot.Event.prototype,ot.MouseEvent=t=function(t,n={bubbles:!1,cancelable:!1,detail:void 0}){return(e=at.createEvent("MouseEvents")).initMouseEvent(t,n.bubbles,n.cancelable,at.defaultView||ot,n.detail,n.screenX,n.screenY,n.clientX,n.clientY,!1,!1,!1,!1,0,document),e},t.prototype=ot.Event.prototype,ot.KeyboardEvent=t=function(t,n={bubbles:!1,cancelable:!1,detail:void 0}){const r=`${n.shiftKey?"Shift ":""}${n.ctrlKey?"Control":""}`;return(e=at.createEvent("KeyboardEvent")).initKeyboardEvent(t,n.bubbles,n.cancelable,at.defaultView||ot,n.key,n.location,r,!1,""),e},t.prototype=ot.Event.prototype}if(G.isEdge&&(!Object.getOwnPropertyDescriptor(SVGElement.prototype,"dataset")||!Object.getOwnPropertyDescriptor(SVGElement.prototype,"dataset").get)){var St={enumerable:!0,get:function(){var e,t,n,r,s,i={},o=this.attributes,a=o.length,l=function(e){return e.charAt(1).toUpperCase()},c=function(){return this},d=function(e,t){return void 0!==t?this.setAttribute(e,t):this.removeAttribute(e)};for(e=0;e<a;e++)(s=o[e])&&s.name&&/^data-\w[\w-]*$/.test(s.name)&&(t=s.value,r=(n=s.name).substr(5).replace(/-./g,l),Object.defineProperty(i,r,{enumerable:this.enumerable,get:c.bind(t||""),set:d.bind(this,n)}));return i}};Object.defineProperty(SVGElement.prototype,"dataset",St)}const Dt=DOMTokenList.prototype.add,Et=DOMTokenList.prototype.remove;DOMTokenList.prototype.add=function(e){Array.isArray(e)?Dt.call(this,...e):Dt.call(this,...arguments)},DOMTokenList.prototype.remove=function(e){Array.isArray(e)?Et.call(this,...e):Et.call(this,...arguments)};const xt=function(){class e extends(U()){static get defaultConfig(){return{mode:"dark",icon:"b-icon b-icon-spinner",text:null}}construct(e){super.construct(e),this.element||(this.element=document.body),this.show()}doDestroy(){const e=this;e.maskElement&&(e.maskElement.remove(),e.maskElement=null,e.mode.endsWith("blur")&&yt.forEachChild(e.element,t=>{t.classList.remove(`b-masked-${e.mode}`)}),e.element.mask=null),super.doDestroy()}create(){const e=this.element.mask=this;e.maskElement=yt.createElement({parent:e.element,className:`b-mask b-widget b-mask-${e.mode}`}),e.text=e._text}static mask(t,n=document.body){return new e("string"!=typeof t?Object.assign({element:n},t):{element:n,text:t})}static unmask(e=document.body){return e.mask&&e.mask.close()}set text(e){let t=this;t._text=e||"",t.maskElement&&(t.maskElement.innerHTML=`<div class="b-mask-content"><i class="b-mask-icon ${t.icon}"></i>${t._text}</i>`)}get text(){return this._text}show(){const e=this;e.hasTimeout("hide")&&(e.resolve(),e.clearTimeout("hide")),e.element.mask||e.create();const{element:t,maskElement:n}=e;n&&(t.classList.add("b-masked"),n.classList.add("b-visible"),n.classList.remove("b-hidden"),e.shown=!0,e.mode.endsWith("blur")&&yt.forEachChild(t,t=>{t!==n&&t.classList.add(`b-masked-${e.mode}`)}))}hide(){const e=this,{element:t,maskElement:n}=e;return new Promise(r=>{e.shown?(e.shown=!1,n.classList.remove("b-visible"),n.classList.add("b-hidden"),t.classList.remove("b-masked"),e.mode.endsWith("blur")&&yt.forEachChild(t,t=>{t!==n&&t.classList.remove(`b-masked-${e.mode}`)}),e.resolve=r,e.setTimeout(()=>r(),500,"hide")):r()})}close(){return new Promise(e=>{this.hide().then(()=>{this.destroy(),e()})})}}return e._$name="Mask",e}();let Tt=null;const Rt=[],kt=e=>1===e.nodeType&&"absolute"===e.ownerDocument.defaultView.getComputedStyle(e).getPropertyValue("position"),Mt=function(){class e{static addResizeListener(e,t){const n=this;if(e!==document&&e!==window||(e=document.body),e.classList.contains("b-resize-monitored")||(e.classList.add("b-resize-monitored"),e._bResizemonitor={handlers:[]}),e===document.body)n.hasWindowResizeListener||(window.addEventListener("resize",n.onWindowResize),n.hasWindowResizeListener=!0);else if(window.ResizeObserver)n.resizeObserver||(n.resizeObserver=new ResizeObserver(n.onElementResize)),n.resizeObserver.observe(e);else{const[r,s,i]=yt.createElement({parent:e,className:"b-resize-monitors",children:[{className:"b-resize-monitor-expand"},{className:"b-resize-monitor-shrink"}]},!0);s.scrollLeft=s.scrollTop=i.scrollLeft=i.scrollTop=1e6,s.addEventListener("scroll",n.onSizeMonitorScroll,!0),i.addEventListener("scroll",n.onSizeMonitorScroll,!0),(t.targetMutationMonitor=new MutationObserver(e=>{const t=[];for(let n of e)"childList"===n.type&&(t.push.apply(t,n.removedNodes),t.push.apply(t,n.addedNodes));t.length>0&&t.every(kt)||s.dispatchEvent(new CustomEvent("scroll",{}))})).observe(e,{childList:!0,subtree:!0}),t.monitorElement=r}e._bResizemonitor.handlers.push(t)}static removeResizeListener(e,t){if(e){e!==document&&e!==window||(e=document.body);const n=e._bResizemonitor;let r=0;n&&n.handlers&&(le.remove(n.handlers,t),r=n.handlers.length),r||(e.classList.remove("b-resize-monitored"),this.resizeObserver?this.resizeObserver.unobserve(e):(t.monitorElement&&(t.monitorElement.remove(),t.monitorElement=null),t.targetMutationMonitor&&t.targetMutationMonitor.disconnect()))}}static onElementResize(e){for(let t of e){let e=t.target,n=e._bResizemonitor,r=t.contentRect||e.getBoundingClientRect();if(e.offsetParent&&(!n.rectangle||r.width!==n.rectangle.width||r.height!==n.rectangle.height)){const t=n.rectangle;n.rectangle=r;for(let s of n.handlers)s(e,t,r)}}}static onSizeMonitorScroll(t){if(document.body.contains(t.target)){t.stopPropagation();const n=t.target.parentNode,r=n.parentNode,s=r._bResizemonitor,i=r.getBoundingClientRect();s.rectangle&&i.width===s.rectangle.width&&i.height===s.rectangle.height||(Rt.push([r,s.rectangle,i]),s.rectangle=i,Tt||(Tt=requestAnimationFrame(e.fireResizeEvents))),n.firstChild.scrollLeft=n.firstChild.scrollTop=n.childNodes[1].scrollTop=n.childNodes[1].scrollLeft=1e6}}static onWindowResize(e){let t=document.body,n=t._bResizemonitor,r=n.rectangle;n.rectangle=document.documentElement.getBoundingClientRect();for(let s of t._bResizemonitor.handlers)s(t,r,n.rectangle)}static fireResizeEvents(){for(let e of Rt)for(let t of e[0]._bResizemonitor.handlers)e[0].offsetParent&&t.apply(this,e);Tt=null,Rt.length=0}}return e._$name="ResizeMonitor",e}(),It=function(){class e extends oe{static from(t){const n=t.changedTouches;return new e(n?n[0].screenX:t.screenX,n?n[0].screenY:t.pageY)}constructor(e,t){super(e,t,0,0)}constrain(e){return this.x=Math.min(Math.max(this.x,e.x),e.right-1),this.y=Math.min(Math.max(this.y,e.y),e.bottom-1),this}toArray(){return[this.x,this.y]}}return e._$name="Point",e}();It.__proto__.Point=It;const At=function(){class e{static curry(e){return function t(...n){return n.length>=e.length?e.apply(this,n):function(...e){return t.apply(this,n.concat(e))}}}static bindAll(e){for(let t in e)"function"==typeof e[t]&&(e[t]=e[t].bind(e))}static createInterceptor(e,t,n){return(...r)=>!1!==t.call(n,...r)&&e.call(n,...r)}static createSequence(e,t,n){return(...r)=>{const s=e.call(n,...r),i=t.call(n,...r);return void 0===i?s:i}}static createThrottled(e,t,n,r,s){let i,o,a,l=0;const c=()=>{o=0,l=performance.now(),i.push.apply(i,r),e.apply(n,i)};return(a=function(...e){let a=performance.now()-l;i=e,a>=t?(clearTimeout(o),c()):(o||(o=setTimeout(c,t-a)),s&&(i.push.apply(i,r),s.apply(n,i)))}).cancel=(()=>clearTimeout(o)),a}static createBuffered(e,t,n,r){let s,i,o;const a=()=>{i=0,s.push.apply(s,r),e.apply(n,s)};return(o=function(...e){s=e,i&&clearTimeout(i),i=setTimeout(a,t)}).cancel=(()=>clearTimeout(i)),o}static returnTrue(){return!0}static animate(e,t,n,r="linear"){let s=!1;const i=new Promise(i=>{const o=performance.now(),a=()=>{const l=Math.min((performance.now()-o)/e,1);s||!1===t.call(n,this.easingFunctions[r](l))&&i(),s||1===l?requestAnimationFrame(()=>i()):requestAnimationFrame(a)};a()});return i.cancel=(()=>(s=!0,!1)),i}}return e.easingFunctions={linear:e=>e,easeInQuad:e=>Math.pow(e,2),easeOutQuad:e=>-(Math.pow(e-1,2)-1),easeInOutQuad:e=>(e/=Ft)<1?Ft*Math.pow(e,2):-Ft*((e-=2)*e-2),easeInCubic:e=>Math.pow(e,3),easeOutCubic:e=>Math.pow(e-1,3)+1,easeInOutCubic:e=>(e/=Ft)<1?Ft*Math.pow(e,3):Ft*(Math.pow(e-2,3)+2),easeInQuart:e=>Math.pow(e,4),easeOutQuart:e=>-(Math.pow(e-1,4)-1),easeInOutQuart:e=>(e/=Ft)<1?Ft*Math.pow(e,4):-Ft*((e-=2)*Math.pow(e,3)-2),easeInQuint:e=>Math.pow(e,5),easeOutQuint:e=>Math.pow(e-1,5)+1,easeInOutQuint:e=>(e/=Ft)<1?Ft*Math.pow(e,5):Ft*(Math.pow(e-2,5)+2),easeInSine:e=>1-Math.cos(e*(Math.PI/2)),easeOutSine:e=>Math.sin(e*(Math.PI/2)),easeInOutSine:e=>-Ft*(Math.cos(Math.PI*e)-1),easeInExpo:e=>0===e?0:Math.pow(2,10*(e-1)),easeOutExpo:e=>1===e?1:1-Math.pow(2,-10*e),easeInOutExpo:e=>0===e?0:1===e?1:(e/=Ft)<1?Ft*Math.pow(2,10*(e-1)):Ft*(2-Math.pow(2,-10*--e)),easeInCirc:e=>-(Math.sqrt(1-e*e)-1),easeOutCirc:e=>Math.sqrt(1-Math.pow(e-1,2)),easeInOutCirc:e=>(e/=Ft)<1?-Ft*(Math.sqrt(1-e*e)-1):Ft*(Math.sqrt(1-(e-=2)*e)+1),easeOutBounce:e=>e<jt?Lt*e*e:e<Pt?Lt*(e-=Ht)*e+Bt:e<Nt?Lt*(e-=$t)*e+Vt:Lt*(e-=zt)*e+Wt,easeInBack:e=>e*e*((Ot+1)*e-Ot),easeOutBack:e=>(e-=1)*e*((Ot+1)*e+Ot)+1,easeInOutBack:e=>{let t=1.70158;return(e/=Ft)<1?Ft*(e*e*((1+(t*=_t))*e-t)):Ft*((e-=2)*e*((1+(t*=_t))*e+t)+2)},elastic:e=>-1*Math.pow(4,-8*e)*Math.sin((6*e-1)*(2*Math.PI)/2)+1,swingFromTo:e=>{let t=1.70158;return(e/=Ft)<1?Ft*(e*e*((1+(t*=_t))*e-t)):Ft*((e-=2)*e*((1+(t*=_t))*e+t)+2)},swingFrom:e=>e*e*((Ot+1)*e-Ot),swingTo:e=>(e-=1)*e*((Ot+1)*e+Ot)+1,bounce:e=>e<jt?Lt*e*e:e<Pt?Lt*(e-=Ht)*e+Bt:e<Nt?Lt*(e-=$t)*e+Vt:Lt*(e-=zt)*e+Wt,bouncePast:e=>e<jt?Lt*e*e:e<Pt?2-(Lt*(e-=Ht)*e+Bt):e<Nt?2-(Lt*(e-=$t)*e+Vt):2-(Lt*(e-=zt)*e+Wt),easeFromTo:e=>(e/=Ft)<1?Ft*Math.pow(e,4):-Ft*((e-=2)*Math.pow(e,3)-2),easeFrom:e=>Math.pow(e,4),easeTo:e=>Math.pow(e,.25)},e._$name="FunctionHelper",e}(),Ft=.5,Ot=1.70158,Lt=7.5625,_t=1.525,Pt=2/2.75,$t=2.25/2.75,jt=1/2.75,Ht=1.5/2.75,Nt=2.5/2.75,zt=2.625/2.75,Bt=.75,Vt=.9375,Wt=.984375,Ut=["clientX","clientY","pageX","pageY","screenX","screenY"],Gt={element:1,thisObj:1,once:1,delegate:1,delay:1,capture:1,passive:1,throttled:1,autoDetach:1},Yt={get:()=>!0},qt={Spacebar:"Space",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown"},Xt=e=>{const{type:t}=e;if(t.startsWith("key")){const t=qt[e.key];t&&Object.defineProperty(e,"key",{get:()=>t})," "!==e.key||e.code||Object.defineProperty(e,"code",{get:()=>"Space"})}if(e.metaKey&&!e.ctrlKey&&Object.defineProperty(e,"ctrlKey",Yt),e.target&&e.target.shadowRoot&&e.composedPath&&!G.isIE11&&!G.isEdge){const t=e.composedPath()[0],n=e.target;e.target!==t&&(Object.defineProperty(e,"target",{get:()=>t}),Object.defineProperty(e,"originalTarget",{get:()=>n}))}if(e.target&&9===e.target.nodeType&&"clientX"in e){const t=yt.elementFromPoint(e.clientX,e.clientY);Object.defineProperty(e,"target",{get:()=>t})}if(e.target&&3===e.target.nodeType){const t=e.target.parentElement;Object.defineProperty(e,"target",{get:()=>t})}if(e.relatedTarget&&3===e.relatedTarget.nodeType){const t=e.target.parentElement;Object.defineProperty(e,"relatedTarget",{get:()=>t})}return t.startsWith("touch")&&e.touches.length&&Kt.normalizeEvent(e),e},Kt=function(){class e{static normalizeEvent(e){return We.copyPropertiesIf(e,e.touches[0]||e.changedTouches[0],Ut)}static getXY(e){return e.touches&&(e=e.touches[0]),[e.clientX,e.clientY]}static getDistanceBetween(e,t){const n=this.getXY(e),r=this.getXY(t);return Math.sqrt(Math.pow(n[0]-r[0],2)+Math.pow(n[1]-r[1],2))}static getPagePoint(e){return new It(e.pageX,e.pageY)}static getClientPoint(e){return new It(e.clientX,e.clientY)}static addListener(e,t,n,r){return r=e.nodeType?"string"==typeof t?Object.assign({element:e,[t]:n},r):Object.assign({element:e},t):e,this.on(r)}static on(e){const t=this,n=e.element,r=e.thisObj,s=[],i=We.allKeys(e);let o,a,l=i.length;for(o=0;o<l;o++)if(!Gt[a=i[o]]){let i=e[a];"object"!=typeof i&&(i={handler:i});const o=i.element||n;G.isTouchDevice&&("contextmenu"===a?s.push(t.addElementListener(o,"touchstart",{handler:t.createContextMenuWrapper(i.handler,i.thisObj||r)},e)):"dblclick"===a&&s.push(t.addElementListener(o,"touchend",{handler:t.createDblClickWrapper(o,i.handler,i.thisObj||r),delay:10,capture:!0},e))),s.push(t.addElementListener(o,a,i,e))}const c=()=>{for(l=s.length,o=0;o<l;o++){const e=s[o];e[0].removeEventListener(e[1],e[2],e[3])}s.length=0};return r&&!1!==e.autoDetach&&(r.doDestroy=At.createInterceptor(r.doDestroy,c,r)),c}static addElementListener(e,t,n,r){const s=this.createHandler(e,t,n,r),i="passive"in n;let o=n.capture||r.capture;return(i||"passive"in r)&&G.supportsPassive&&(o={capture:!!o,passive:i?n.passive:r.passive}),e.addEventListener(t,s,o),[e,t,s,o]}static createHandler(e,t,n,r){const s=n.delay||r.delay,i=n.throttled||r.throttled,o=n.once||r.once,a=n.thisObj||r.thisObj,l=n.capture||r.capture,c=n.delegate||r.delegate;let d=n.handler,u=(e,...t)=>{if(!(this.playingDemo&&e.isTrusted||a&&a.isDestroyed)){if(Xt(e),c){const t=e.target instanceof HTMLElement&&e.target.closest(c);if(!t)return;Object.defineProperty(e,"currentTarget",{get:()=>t,configurable:!0})}"string"==typeof d&&(d=a[d]),d.call(a,e,...t)}};if(null!=s){const e=u;u=((...t)=>{setTimeout(()=>{e(...t)},s)})}if(null!=i){let e,t=i;i.buffer&&(e=(e=>i.alt.call(this,Xt(e))),t=i.buffer),u=At.createThrottled(u,t,a,null,e)}if(o){const n=u;u=((...r)=>{e.removeEventListener(t,u,l),n(...r)})}return n.thisObj&&!1!==n.autoDetach&&(a.doDestroy=At.createInterceptor(a.doDestroy,()=>e.removeEventListener(t,u),a)),u}static createContextMenuWrapper(e,t){const n=this;return r=>{if(1===r.touches.length){const s=r.touches[0],i=setTimeout(()=>{a();const i=new MouseEvent("contextmenu",s);Object.defineProperty(i,"target",{get:()=>s.target}),"string"==typeof e&&(e=t[e]),i.browserEvent=r,e.call(t,i),n.contextMenuTouchId=s.identifier},n.longPressTime),o=()=>{n.contextMenuTouchId=null,a(),clearTimeout(i)},a=n.on({element:document,touchmove:o,touchend:o,pointermove:o,pointerup:o,capture:!0})}}}static createDblClickWrapper(e,t,n){const r=this;let s,i,o;return()=>{i||(i=r.on({element:e,touchstart:e=>{s=e.changedTouches[0].identifier,e.preventDefault()},touchend:e=>{if(e.changedTouches[0].identifier===s){e.preventDefault(),clearTimeout(o),s=i=null;const r=oe.from(e.changedTouches[0].target,null,!0),a=e.changedTouches[0].pageX-r.x,l=e.changedTouches[0].pageY-r.y,c=Object.assign({browserEvent:e},e),d=new MouseEvent("dblclick",c);Object.defineProperty(d,"target",{get:()=>e.target}),Object.defineProperty(d,"offsetX",{get:()=>a}),Object.defineProperty(d,"offsetY",{get:()=>l}),"string"==typeof t&&(t=n[t]),t.call(n,d)}},once:!0}),o=setTimeout(()=>{i(),s=i=null},r.dblClickTime))}}static lockComposedPath(e){e.composedPath&&(e.composedPath=(e=>()=>e)(e.composedPath()))}}return e.longPressTime=500,e.dblClickTime=300,e._$name="EventHelper",e}();Kt.on({element:document,mousedown(){yt.isTouchEvent||(yt.usingKeyboard=!1,document.body.classList.remove("b-using-keyboard"))},touchmove(){yt.usingKeyboard=!1,document.body.classList.remove("b-using-keyboard")},keydown(){yt.usingKeyboard=!0,document.body.classList.add("b-using-keyboard")}}),G.isTouchDevice&&Kt.on({element:document,touchmove:e=>{e.target.closest(".b-dragging")&&e.preventDefault()},passive:!1,capture:!0});const Zt=function(){class e extends W{static get defaultConfig(){return{property:null,value:null,operator:null,filterBy:null,convert:null,caseSensitive:!0,id:null}}construct(e){"function"==typeof e&&(e={filterBy:e}),super.construct(e)}get id(){return this._id||(this._id=this.property||k.generateId("b-filter"))}set id(e){this._id=e}onChange(e){const t=this;!t.isConfiguring&&t.owner&&!t.owner.isConfiguring&&t.owner.onFilterChanged&&t.owner.onFilterChanged(t,e)}get filterBy(){return this._filterBy||this.defaultFilterBy}set filterBy(e){this._filterBy=e}defaultFilterBy(e){return this[this.operator](this.convert(e[this.property]))}set property(e){this._property=e,this.onChange("property")}get property(){return this._property}set value(e){this._value=this.caseSensitive||"string"!=typeof e?e:e.toLowerCase(),this.onChange("value")}get value(){return this._value}set operator(e){this._operator=e,this.onChange("operator")}get operator(){return this._operator||("string"==typeof this.value?"*":"=")}convert(e){return this.caseSensitive||"string"!=typeof e?e:e.toLowerCase()}filter(e){return this.filterBy(e)}startsWith(e){return String(e).startsWith(this.value)}endsWith(e){return String(e).endsWith(this.value)}"="(e){return We.isEqual(e,this.value)}"!="(e){return!We.isEqual(e,this.value)}">"(e){return We.isMoreThan(e,this.value)}">="(e){return We.isMoreThan(e,this.value)||We.isEqual(e,this.value)}"<"(e){return We.isLessThan(e,this.value)}"<="(e){return We.isLessThan(e,this.value)||We.isEqual(e,this.value)}"*"(e){return We.isPartial(e,this.value)}static generateFiltersFunction(e){return e&&(e.length||e.count)?function(t){let n=!0;for(const r of e)if(r.disabled||(n=r.filter(t)),!n)break;return n}:At.returnTrue}}return e._$name="CollectionFilter",e}(),Jt=function(){class e extends W{static get defaultConfig(){return{property:null,direction:"ASC",sortFn:null,convert:null,id:null,useLocaleSort:null}}construct(e){"function"==typeof e&&(e={sortFn:e}),super.construct(e)}get id(){return this._id||(this._id=this.property||k.generateId("b-sorter"))}set id(e){this._id=e}set sortFn(e){this._sortFn=e}get sortFn(){return this._sortFn?this._sortFn:this.defaultSortFn}defaultSortFn(e,t){const{convert:n,property:r,useLocaleSort:s}=this,i="desc"===this.direction.toLowerCase()?-1:1;if(e=e[r],t=t[r],n&&(e=n(e),t=n(t)),s&&null!=e&&null!=t){if(!0===s)return String(e).localeCompare(t);if("string"==typeof s)return String(e).localeCompare(t,s);if("object"==typeof s)return String(e).localeCompare(t,s.locale,s)}return(e>t?1:e<t?-1:0)*i}static generateSortFunction(e,t){const n=e.isCollection?e.values:e,r=n.length;return(e,s)=>{let i,o;for(o=0;o<r;++o)if(i=n[o].sortFn(e,s))return i;return t?t(e,s):0}}}return e._$name="CollectionSorter",e}(),Qt=()=>0,en=(e,t)=>t-e,tn=Symbol("filteredIndicesProperty"),nn=Object.freeze([]),rn=Object.freeze({action:"sort",added:nn,removed:nn,replaced:nn}),sn=Object.freeze({action:"filter",added:nn,removed:nn,replaced:nn}),on={string:1,number:1},an=new WeakMap,ln=e=>{if(e&&"object"==typeof e){let t=an.get(e);void 0===t&&(t=Symbol("bscik"),an.set(e,t)),e=t}return e},cn=function(){class e extends(ue(W)){static get defaultConfig(){return{idProperty:"id",extraKeys:null,autoFilter:!0}}construct(e){this.generation=0,this._values=[],super.construct(e)}doDestroy(){super.doDestroy(),this._values.length=0,this.isFiltered&&(this._filteredValues.length=0,this.filters.destroy()),this._sorters&&this._sorters.destroy()}get isCollection(){return!0}clear(){const e=this,t=this._values.slice();e.totalCount&&(e._values.length=0,e._filteredValues&&(e._filteredValues.length=0),e._indicesInvalid=!0,e.generation++,e.trigger("change",{action:"clear",removed:t}))}replaceValues(e,t,n){const r=this;let s;r.isFiltered&&!n?(s=r._filteredValues,r._filteredValues=e):(s=r._values,r._values=e,r._filteredValues&&(r._filteredValues.length=0)),r._indicesInvalid=!0,r.generation++,t||r.trigger("change",{action:"replaceValues",removed:s,values:e,replaced:[]})}set values(e){this.splice(0,this._values.length,e)}get values(){return this.isFiltered?this._filteredValues:this._values}[Symbol.iterator](){return this.values[Symbol.iterator]()}forEach(e,t=!1){(this.isFiltered&&!t?this._filteredValues:this._values).forEach(e)}map(e,t=!1){return(this.isFiltered&&!t?this._filteredValues:this._values).map(e)}find(e,t=!1){return(this.isFiltered&&!t?this._filteredValues:this._values).find(e)}get first(){return this.values[0]}get last(){return this.values[this.count-1]}get allValues(){return this._values}add(...e){1===e.length?this.splice(this._values.length,null,...e):this.splice(this._values.length,null,e)}remove(...e){1===e.length?this.splice(0,...e):this.splice(0,e)}move(e,t){const n=this,{_values:r}=n,s=n.indexOf(e,!0);let i=t?n.indexOf(t,!0):r.length;if(-1===s||-1===i)throw new Error("Collection move parameters must be present in Collection");return s!==i&&s!==i-1&&(s<i&&i--,r.splice(s,1),r.splice(i,0,e),n._indicesInvalid=!0,n.trigger("change",{action:"move",item:e,from:s,to:i})),i}splice(e=0,t,...n){const r=this,s=r.idProperty,i=r._values,o={},a=[],l=[],c=r.totalCount;let d,u;if(n)if(1===n.length&&Array.isArray(n[0])&&(n=n[0]),c&&n.length){const e=r.indices[s];d=[];for(let t=0;t<n.length;t++){const r=n[t],a=ln(r[s]),c=e[a];o[a]=!0,null!=c?i[c]!==r&&(l.push([i[c],r]),i[c]=r):d.push(r)}}else d=n;if(t)if("number"==typeof t)for(let h=e;t;--t)o[ln(i[h][s])]?(e++,h++):(a.push(i[h]),i.splice(h,1),r._indicesInvalid=u=!0);else{let e,n=0===d.length;Array.isArray(t)||(t=[t]);const l=t.reduce((t,s)=>{const i="number"==typeof s,o=i?s:r.indexOf(s,!0);return n&&(null!=e&&o!==e+1||i)&&(n=!1),o>=0&&o<c&&t.push(o),e=o,t},[]).sort(en);if(n)l.length&&(a.push.apply(a,t),i.splice(l[l.length-1],l.length),r._indicesInvalid=u=!0);else for(let t=0;t<l.length;t++){const e=l[t];-1!==e&&(o[ln(i[e][s])]||(a.unshift(i[e]),i.splice(e,1),r._indicesInvalid=u=!0))}}d.length&&(i.splice(Math.min(e,i.length),0,...d),r._indicesInvalid=u=!0),r.isSorted?r.onSortersChanged():r.isFiltered&&(r.autoFilter?r.onFiltersChanged():r._filteredValues.push(...d)),u||l.length?(r.generation++,r.trigger("change",{action:"splice",removed:a,added:d,replaced:l,oldCount:c})):r.trigger("noChange",{index:e,toRemove:t,toAdd:n})}changeId(e,t){const n=this,{idProperty:r}=n,s=on[typeof e]?e:e[r],i=n.get(s);if(i){const e=n.get(t);if(e&&i!==e)throw new Error(`Attempt to set item ${s} to already existing member's id ${t}`);if(i[r]=t,!n._indicesInvalid){const e=n.indices.id,r=e[s];delete e[s],e[t]=r}}}get(e,t=!1){return this.getBy(this.idProperty,e,t)}getAt(e,t=!1){return this.isFiltered&&!t?this._filteredValues[e]:this._values[e]}getBy(e,t,n=!1){const r=this;if(r.isFiltered&&n){const n=r.findIndex(e,t,!0);if(-1!==n)return r._values[n]}else{const n=r.findIndex(e,t);if(-1!==n)return r.values[n]}}get count(){return this.values.length}get totalCount(){return this._values.length}set idProperty(e){this._idProperty=e,this.addIndex(e)}get idProperty(){return this._idProperty}set extraKeys(e){Array.isArray(e)||(e=[e]);for(let t=0;t<e.length;t++)this.addIndex(e[t])}get sorters(){return this._sorters||(this._sorters=new e({listeners:{change:"onSortersChanged",thisObj:this}})),this._sorters}addSorter(e){const t=e instanceof Jt?e:new Jt(e);return this.sorters.add(t),t}get isSorted(){return Boolean(this._sorters&&this._sorters.count)}onSortersChanged(){const e=this;delete e._sortFunction,e._values.sort(e.sortFunction),e._indicesInvalid=!0,e.trigger("change",rn)}get sortFunction(){return this._sortFunction||(this._sortFunction=this.isSorted?Jt.generateSortFunction(this.sorters.values):Qt),this._sortFunction}get filters(){return this._filters||(this._filters=new e({listeners:{change:"onFiltersChanged",thisObj:this}})),this._filters}addFilter(e){const t=e instanceof Zt?e:new Zt(e);return this.filters.add(t),t}get isFiltered(){return Boolean(this._filters&&this._filters.count)}onFiltersChanged(){const e=this;e._filterFunction=null,e._filteredValues=e._values.filter(e.filterFunction),e._indicesInvalid=!0,e.trigger("change",sn)}get filterFunction(){return this._filterFunction||(this._filterFunction=this.isFiltered?Zt.generateFiltersFunction(this.filters.values):At.returnTrue),this._filterFunction}addIndex(e){(this._indices||(this._indices={}))[e]={},this._indicesInvalid=!0}findIndex(e,t,n=!1){const r=this,s=r.isFiltered,i=s&&!n?r.indices[tn][e]:r.indices[e];if(i){const e=i[ln(t)];if(null!=e)return e}else{const i=s&&!n?r._filteredValues:r._values,o=i.length;for(let n=0;n<o;n++)if(i[n][e]==t)return n}return-1}indexOf(e,t=!1){return this.findIndex(this.idProperty,on[typeof e]?e:e[this.idProperty],t)}includes(e,t=!1){return-1!==this.indexOf(e,t)}get indices(){return this._indicesInvalid&&this.rebuildIndices(),this._indices}rebuildIndices(){const e=this,t=e.isFiltered,n=e._indices||(e._indices={}),r=Object.keys(n),s=r.length,i=e._values,o=i.length;let a,l;for(t&&(n[tn]={}),a=0;a<s;a++)n[r[a]]={},t&&(n[tn][r[a]]={});for(a=0;a<o;a++){const e=i[a];for(l=0;l<s;l++){const t=r[l];n[t][ln(e[t])]=a}}if(t){const t=e._filteredValues,n=t.length,i=e._indices[tn];for(a=0;a<n;a++){const e=t[a];for(l=0;l<s;l++){const t=r[l];i[t][ln(e[t])]=a}}}e._indicesInvalid=!1}}return e._$name="Collection",e}(),dn={true:"auto",false:"hidden","hidden-scroll":"auto"},un="b-widget-scroller",hn={block:"nearest"},gn=new Promise(e=>e()),mn={x:1},pn=function(){class e extends(U(ue(W))){get defaultConfig(){return{element:null,overflowX:null,overflowY:null,translate:null}}addPartner(e,t=mn){"string"==typeof t&&(t={[t]:1}),(this.partners||(this.partners=new cn)).add({id:e.id,scroller:e,axes:t}),e.partners&&e.partners.includes(this.id)||e.addPartner(this,t)}removePartner(e){this.partners&&this.partners.includes(e)&&(this.partners.remove(e),e.removePartner(this))}scrollIntoView(e,t=hn){const n=e instanceof oe,r=n?e:oe.from(e),{xDelta:s,yDelta:i}=this.getDeltaTo(e,t),o=this.scrollBy(s,i,t);return(t.highlight||t.focus)&&o.then(()=>{n&&(e=r.translate(-s,-i)),t.highlight&&yt.highlight(e),t.focus&&e.focus()}),o}scrollBy(e=0,t=0,n=hn){const r=this,s="object"==typeof n?n.animate:n,i=Math.abs(e),o=Math.abs(t);r.scrollAnimation&&(r.scrollAnimation.cancel(),r.scrollAnimation=null),(e||t)&&(r.silent=n.silent);let a=s&&("number"==typeof s?s:"number"==typeof s.duration?s.duration:300);if(a&&(i>10||o>10)){const{x:l,y:c}=r;let d=l,u=c;return Math.max(i,o)<50&&(a=Math.min(a,500)),r.scrollAnimation=At.animate(a,s=>{const i=1===s;if(e){if(r.x!==d&&!n.force)return r.scrollAnimation&&r.scrollAnimation.cancel();d=r.x=Math.max(l+(i?e:Math.round(e*s)),0)}if(t){if(r.y!==u&&!n.force)return r.scrollAnimation&&r.scrollAnimation.cancel();u=r.y=Math.max(c+(i?t:Math.round(t*s)),0)}},null,s.easing),r.scrollAnimation.then(()=>{r.scrollAnimation=null}),r.scrollAnimation}return r.x+=e,r.y+=t,gn}scrollTo(e,t,n){const{x:r,y:s}=this;return this.scrollBy(null==e?0:e-r,null==t?0:t-s,n)}doDestroy(){const e=this;e._element&&(e._element.removeEventListener("scroll",e.scrollHandler),e.wheelListenerRemover&&e.wheelListenerRemover()),e.scrollAnimation&&e.scrollAnimation.cancel(),e.partners&&e.partners.forEach(t=>t.scroller.removePartner(e)),super.doDestroy()}onElMutation(e){const t=this,[n,r]=yt.getTranslateXY(t.element);if(t._x!==-n||t.y!==-r){const e=new CustomEvent("scroll",{bubbles:!0});Object.defineProperty(e,"target",{get:()=>t.element}),t.onScroll(e)}}onScroll(e){const t=this;t.widget&&t.widget.isDestroyed||(t.positionDirty=!0,e.widget=t.widget,t.silent||t.trigger("scroll",e),t.partners&&t.partners.forEach(({axes:e,scroller:n})=>{n!==t.controllingPartner&&n.sync(t,e)}),t.controllingPartner=null,t.scrollEndHandler(e))}onScrollEnd(e){this.silent&&(this.silent=!1),this.trigger("scrollEnd",e)}getDeltaTo(e,t){e instanceof oe||(e=oe.from(e));const n=this,r=t.block||"nearest",s=n.viewport,i=t.edgeOffset||0,o=s.width>=e.width+2*i?i:0,a=s.height>=e.height+2*i?i:0,l=e.clone().adjust(-o,-a,o,a).constrainTo(new oe(s.x-n.x,s.y-n.y,n.scrollWidth,n.scrollHeight)),c=l.clone();let d=0,u=0;if("start"===r)c.moveTo(s.x,s.y),d=l.x-c.x,u=l.y-c.y;else if("end"===r)c.translate(s.right-c.right,s.bottom-c.bottom),d=l.x-c.x,u=l.y-c.y;else if("center"===r){const e=s.center;c.moveTo(e.x-c.width/2,e.y-c.height/2),d=l.x-c.x,u=l.y-c.y}else c.width<=s.width&&(c.right>s.right?d=c.right-s.right:c.x<s.x&&(d=c.x-s.x)),c.height<=s.height&&(c.bottom>s.bottom?u=c.bottom-s.bottom:c.y<s.y&&(u=c.y-s.y));return{xDelta:!1===t.x?0:Math.max(Math.min(d,n.maxX-n.x),-n.x),yDelta:!1===t.y?0:Math.max(Math.min(u,n.maxY-n.y),-n.y)}}get viewport(){return oe.from(this.element)}get element(){return this._element}set element(e){const t=this,n=t.scrollHandler||(t.scrollHandler=t.onScroll.bind(t));if(t.scrollEndHandler||(t.scrollEndHandler=t.buffer(t.onScrollEnd,100)),t._element&&(t.translate?t.mutationObserver&&t.mutationObserver.disconnect(t._element):(t._element.removeEventListener("scroll",n),t._element.classList.remove(un))),t._element=e,t.translate){if(t.mutationObserver||(t.mutationObserver=new MutationObserver(e=>t.onElMutation(e))),t.mutationObserver.observe(e,{attributes:!0}),t._x=t._y=0,document.contains(e)){const[n,r]=yt.getTranslateXY(e);t._x=-n,t._y=-r}}else e.addEventListener("scroll",n),e.classList.add(un);t.updateOverflowX(t.overflowX),t.updateOverflowY(t.overflowY)}get x(){const e=this,{element:t}=e;if(t&&e.positionDirty){if(e.translate){const[n,r]=yt.getTranslateXY(t);e._x=-n,e._y=-r}else e._x=t.scrollLeft,e._y=t.scrollTop;e.positionDirty=!1}return e._x}set x(e){const{element:t}=this;this._x=e,t&&(this.translate?yt.setTranslateX(t,-e):t.scrollLeft=e,this.positionDirty=!0)}sync(e,t){const{x:n,y:r}=t;this.controllingPartner=e,null!=n&&(this.x=e.x),null!=r&&(this.y=e.y)}get y(){const e=this,{element:t}=e;if(t&&e.positionDirty){if(e.translate){const[n,r]=yt.getTranslateXY(t);e._x=-n,e._y=-r}else e._x=t.scrollLeft,e._y=t.scrollTop;e.positionDirty=!1}return e._y}set y(e){const{element:t}=this;this._y=e,t&&(this.translate?yt.setTranslateY(t,-e):t.scrollTop=e,this.positionDirty=!0)}get maxX(){return this.scrollWidth-this.clientWidth}get maxY(){return this.scrollHeight-this.clientHeight}get overflowX(){return this._overflowX}set overflowX(e){this._overflowX=e,this.element&&this.updateOverflowX(e)}updateOverflowX(e){const{element:t,translate:n}=this;"hidden-scroll"!==e||n||(t.classList.add("b-hide-scroll"),this.enableWheel()),n||(t.style.overflowX=dn[e]||e),this.positionDirty=!0}get overflowY(){return this._overflowY}set overflowY(e){this._overflowY=e,this.element&&this.updateOverflowY(e)}updateOverflowY(e){const{element:t,translate:n}=this;"hidden-scroll"!==e||n||(t.classList.add("b-hide-scroll"),this.enableWheel()),n||(t.style.overflowY=dn[e]||e),this.positionDirty=!0}enableWheel(){G.isChrome||G.isSafari||this.wheelListenerRemover||(this.wheelListenerRemover=Kt.on({element:this.element,wheel:"onWheel",thisObj:this}))}onWheel(e){e.deltaX>e.deltaY&&!1!==this.overflowX?this.x+=e.deltaX:!1!==this.overflowY&&(this.y+=e.deltaY)}get scrollWidth(){return this.element?this.element.scrollWidth:0}set scrollWidth(e){const t=this;let n=t.widthStretcher;n&&null==e?(n.remove(),t.widthStretcher=null):e&&(n||(n=t.widthStretcher=yt.createElement({className:"b-scroller-stretcher"})),n.style.transform=`translateX(${e-1}px)`,t.element&&t.element.lastChild!==n&&t.element.appendChild(n))}get scrollHeight(){return this.element?this.element.scrollHeight:0}set scrollHeight(e){const t=this,n=t.stretcher||(t.stretcher=yt.createElement({className:"b-scroller-stretcher"}));n.style.transform=`translateY(${e-1}px)`,t.element&&t.element.lastChild!==n&&t.element.appendChild(n)}get clientWidth(){return this.element?this.element.clientWidth:0}get clientHeight(){return this.element?this.element.clientHeight:0}get id(){return this._id||(this._id=this.widget?`${this.widget.id}-scroller`:k.generateId("scroller-")),this._id}}return e._$name="Scroller",e}(),fn={localeName:"En",localeDesc:"English",TemplateColumn:{noTemplate:"TemplateColumn needs a template",noFunction:"TemplateColumn.template must be a function"},ColumnStore:{columnTypeNotFound:e=>`Column type '${e.type}' not registered`},InstancePlugin:{fnMissing:e=>`Trying to chain fn ${e.plugIntoName}#${e.fnName}, but plugin fn ${e.pluginName}#${e.fnName} does not exist`,overrideFnMissing:e=>`Trying to override fn ${e.plugIntoName}#${e.fnName}, but plugin fn ${e.pluginName}#${e.fnName} does not exist`},ColumnPicker:{columnsMenu:"Columns",hideColumn:"Hide column",hideColumnShort:"Hide"},Filter:{applyFilter:"Apply filter",filter:"Filter",editFilter:"Edit filter",on:"On",before:"Before",after:"After",equals:"Equals",lessThan:"Less than",moreThan:"More than",removeFilter:"Remove filter"},FilterBar:{enableFilterBar:"Show filter bar",disableFilterBar:"Hide filter bar"},Group:{groupAscending:"Group ascending",groupDescending:"Group descending",groupAscendingShort:"Ascending",groupDescendingShort:"Descending",stopGrouping:"Stop grouping",stopGroupingShort:"Stop"},Search:{searchForValue:"Search for value"},Sort:{sortAscending:"Sort ascending",sortDescending:"Sort descending",multiSort:"Multi sort",removeSorter:"Remove sorter",addSortAscending:"Add ascending sorter",addSortDescending:"Add descending sorter",toggleSortAscending:"Change to ascending",toggleSortDescending:"Change to descending",sortAscendingShort:"Ascending",sortDescendingShort:"Descending",removeSorterShort:"Remove",addSortAscendingShort:"+ Ascending",addSortDescendingShort:"+ Descending"},Tree:{noTreeColumn:"To use the tree feature one column must be configured with tree: true"},Grid:{featureNotFound:e=>`Feature '${e}' not available, make sure you have imported it`,invalidFeatureNameFormat:e=>`Invalid feature name '${e}', must start with a lowercase letter`,removeRow:"Delete row",removeRows:"Delete rows",loadMask:"Loading...",loadFailedMessage:"Data loading failed.",moveColumnLeft:"Move to left section",moveColumnRight:"Move to right section",noRows:"No rows to display"},Field:{invalidValue:"Invalid field value",minimumValueViolation:"Minimum value violation",maximumValueViolation:"Maximum value violation",fieldRequired:"This field is required",validateFilter:"Value must be selected from the list"},DateField:{invalidDate:"Invalid date input"},TimeField:{invalidTime:"Invalid time input"},DateHelper:{locale:"en-US",shortWeek:"W",shortQuarter:"q",week:"Week",weekStartDay:0,unitNames:[{single:"millisecond",plural:"ms",abbrev:"ms"},{single:"second",plural:"seconds",abbrev:"s"},{single:"minute",plural:"minutes",abbrev:"min"},{single:"hour",plural:"hours",abbrev:"h"},{single:"day",plural:"days",abbrev:"d"},{single:"week",plural:"weeks",abbrev:"w"},{single:"month",plural:"months",abbrev:"mon"},{single:"quarter",plural:"quarters",abbrev:"q"},{single:"year",plural:"years",abbrev:"yr"}],unitAbbreviations:[["mil"],["s","sec"],["m","min"],["h","hr"],["d"],["w","wk"],["mo","mon","mnt"],["q","quar","qrt"],["y","yr"]],parsers:{L:"MM/DD/YYYY",LT:"HH:mm A"},ordinalSuffix:e=>e+({1:"st",2:"nd",3:"rd"}[e[e.length-1]]||"th")},BooleanCombo:{Yes:"Yes",No:"No"}};he.registerLocale("En",{desc:"English",locale:fn});let vn,yn,bn=!1,Cn=(window.bryntum||(window.bryntum={})).GlobalEvents=new class extends(ue(W)){suspendFocusEvents(){bn=!0}resumeFocusEvents(){bn=!1}get lastInteractionType(){return yn}};function wn(e,t,n,r,s,i,o){const a=new CustomEvent(e,o);return Object.defineProperty(a,"target",{get:()=>t}),Object.defineProperty(a,"relatedTarget",{get:()=>n}),a.fromWidget=r,a.toWidget=s,a.backwards=i,a}function Sn(e,t){if(e===t)return e;const n=e instanceof An;for(;e&&!e[n?"owns":"contains"](t)&&e!==t;)e=e[n?"owner":"parentNode"];return e}const Dn={element:document,touchstart(e){vn=vn||1!==e.changedTouches.length?null:e.changedTouches[0]},touchend:{handler:e=>{vn&&(vn.identifier===Kt.contextMenuTouchId?(e.stopImmediatePropagation(),e.preventDefault()):1===e.changedTouches.length&&e.changedTouches[0].identifier===vn.identifier&&Cn.trigger("globaltap",{event:e}),vn=null)},passive:!1},mousedown:{handler:e=>{yn="mouse",vn||Cn.trigger("globaltap",{event:e})},passive:!1},keydown(){yn="key"},keypress(){yn="key"},focusin(e){if(An.floatRoot.scrollTop=An.floatRoot.scrollLeft=0,bn)return;const t=e.relatedTarget,n=e.target||document.body,r=k.fromElement(t),s=k.fromElement(n),i=Sn(r,s),o=!!(t&&4&n.compareDocumentPosition(t));let a=wn("focusout",t,n,r,s,o);for(let c=r;c&&c!==i;c=c.owner)c.isDestroyed||c.isDestroying||c.onFocusOut&&c.onFocusOut(a);if(i&&e.target===i.element)document.activeElement===n&&i.focusElement&&i.focusElement!==i.element&&setTimeout(()=>i.focus&&i.focus(),0);else{a=wn("focusin",n,t,r,s,o);for(let e=s;e&&e!==i;e=e.owner)e.isDestroyed||e.isDestroying||e.onFocusIn&&e.onFocusIn(a)}const l=Sn(t&&1===t.nodeType?t:null,n)||n.parentNode;a=wn("focusmove",n,t,r,s,o,{bubbles:!0}),l.dispatchEvent(a)},focusout(e){bn||e.relatedTarget&&k.fromElement(e.relatedTarget)||Dn.focusin({target:e.relatedTarget,relatedTarget:e.target})},capture:!0,passive:!0};function En(e=document){const t=We.assign({},Dn,{element:e});Kt.on(t)}En();const xn=/transparent|rgba\(0,\s*0,\s*0,\s*0\)/,Tn={INPUT:1,TEXTAREA:1},Rn=e=>e.isVisible&&e.trigger("paint"),kn=/^:not\((.+)\)$/,Mn=e=>e.floating&&"realign"===e.scrollAction,In=yt.createElement({html:"\xa0",style:"position:absolute;top:-10000em;left:-10000em"}),An=function(){class e extends(U(ue(ge(W)))){static get defaultConfig(){return{element:!0,callOnFunctions:!0,id:"",html:null,hasGeneratedId:null,cls:null,style:null,disabled:null,appendTo:null,insertBefore:null,insertFirst:null,dataset:null,tooltip:null,preventTooltipOnTouch:null,monitorResize:null,cache:{},floating:null,positioned:null,draggable:null,align:"t-b",centered:null,constrainTo:null,anchor:null,scrollAction:null,hideAnimation:null,showAnimation:null,x:null,y:null,scrollable:null,scrollerClass:pn,defaultBindProperty:"html",defaultAction:null,width:null,height:null,scaleToFitWidth:null,allowGrowWidth:!0,margin:null,flex:null,alignSelf:null,ripple:null,title:null,localizableProperties:["title"],requireSize:!1,ref:null,hidden:null}}construct(e={},...t){const n=this;n.alignConstrained=0,n.afterHideShowAnimate=n.afterHideShowAnimate.bind(n),n.callRealign=n.realign.bind(n),n.doHideOrRealign=n.doHideOrRealign.bind(n),n.initialRender=!0,n._isUserAction=!1,super.construct(e,t),n.finalizeInit()}isType(e,t){return k.isType(this,e,t)}startConfigure(e){super.startConfigure(e),this._thisIsAUsedExpression(this.element)}set title(e){this._title=e,this.titleElement&&(this.titleElement.innerHTML=e)}get title(){return this._title}get element(){return this._element}set element(e){const t=this;"string"==typeof e?e=yt.createElementFromTemplate(e):"Object"===e.constructor.name?e=yt.createElement(e):1!==e.nodeType&&(e=yt.createElementFromTemplate(t.template(t))),t._element=e;const n=e.classList;e.id=t.id,e.className+=" "+t.widgetClassList.join(" "),t._hidden&&n.add("b-hidden"),t.parent||(n.add("b-outer"),G.isTouchDevice&&n.add("b-touch-events"),yt.scrollBarWidth||n.add("b-overlay-scrollbar"),G.isChrome?n.add("b-chrome"):G.isSafari?n.add("b-safari"):G.isFirefox?n.add("b-firefox"):G.isIE11?n.add("b-ie"):G.isEdge&&n.add("b-edge"));const r=e.querySelectorAll("[reference]");for(const s of r){const e=s.getAttribute("reference");s.removeAttribute("reference"),t[e]=s,s.dataset&&(s.dataset.ownerCmp=t.id)}t.contentRange=G.isIE11?document.createRange():new Range}set constrainTo(e){this._constrainTo=e}get constrainTo(){return"_constrainTo"in this?this._constrainTo:window}set centered(e){if(this._centered=e,e&&!this.floating)throw new Error("`centered` is only relevant when a Widget is `floating`");e?this.element.classList.add("b-centered"):this.element.classList.remove("b-centered")}get centered(){return this._centered}get contentElement(){return this.element}get id(){return this._id}set id(e){const t=this;t._id&&k.unregister(t),e||(e=k.generateId(`b-${t.$name.toLowerCase()}-`),t.hasGeneratedId=!0),t._id=e,k.register(t)}get style(){return this.element?this.element.ownerDocument.defaultView.getComputedStyle(this.element):this._style}set style(e){this._style=e,this.element&&yt.applyStyle(this.element,this._style)}get dataset(){return this.element.dataset}set dataset(e){Object.assign(this.dataset,e)}finalizeInit(){(this.insertBefore||this.appendTo||this.insertFirst)&&this.render()}doDestroy(){const e=this,t=e._element;e.scrollable&&e.scrollable.destroy(),e._tooltip&&e._tooltip.destroy(),e.unmask(),t&&(e.removeTransientListeners(),e.revertFocus(),Mt.removeResizeListener(t.parentElement,e.onParentElementResize),Mt.removeResizeListener(t,e.onElementResize),t.remove(),e.dragEventDetacher&&e.dragEventDetacher(),e.dragOverEventDetacher&&e.dragOverEventDetacher(),In.remove()),k.unregister(e),super.doDestroy()}render(e,t=!0){const n=this,{element:r,contentRange:s,contentElement:i}=n;Mt.removeResizeListener(r.parentElement,n.onParentElementResize),Mt.removeResizeListener(r,n.onElementResize),n.emptyCache(),n.syncElement&&n.currentElement?yt.sync(r,n.currentElement):(e?(n.appendTo="string"==typeof e?document.getElementById(e):e,n.appendTo.appendChild(r)):n.insertBefore?(n.insertBefore="string"==typeof n.insertBefore?document.getElementById(n.insertBefore):n.insertBefore,n.insertBefore.parentElement.insertBefore(r,n.insertBefore)):n.insertFirst?(n.insertFirst="string"==typeof n.insertFirst?document.getElementById(n.insertFirst):n.insertFirst,n.insertFirst.firstChild?n.insertFirst.insertBefore(r,n.insertFirst.firstChild):n.insertFirst.appendChild(r)):n.appendTo&&(n.appendTo="string"==typeof n.appendTo?document.getElementById(n.appendTo):n.appendTo,n.appendTo.appendChild(r)),n.currentElement=r),"contentRangeStart"in n?(s.setStart(i,n.contentRangeStart),s.setEnd(i,n.contentRangeEnd)):(s.setStart(n.contentElement,0),s.setEnd(n.contentElement,n.contentElement.childNodes.length)),n.scaleToFitWidth?(n.onParentElementResize=n.onParentElementResize.bind(n),Mt.addResizeListener(r.parentElement,n.onParentElementResize),n.isVisible&&n.updateScale()):n.monitorResize&&(n.onElementResize=n.onElementResize.bind(n),Mt.addResizeListener(r,n.onElementResize),Mt.onElementResize([{target:r}])),t&&n.triggerPaint()}template(e){return`<div class="${e.html?"b-html":""}" ${e.name?`data-name="${e.name}"`:""}>${e.html||""}</div>`}alignTo(t){(1===t.nodeType||t instanceof e||t instanceof It)&&(t={target:t}),this.releaseSizeConstraints();const n=this,{scrollable:r,element:s}=n,i=t.target,o=i&&(i instanceof oe?i:i.element||i),a=oe.from(s,n.positioned?s.offsetParent:null,!0),l=o&&1===o.nodeType;if(t=Object.assign({constrainTo:n.positioned?null:n.constrainTo,axisLock:n.axisLock,anchor:n.anchor},"object"==typeof n.align?n.align:{align:n.align},t),a.minWidth=t.minWidth||n.minWidth,a.minHeight=t.minHeight||n.minHeight,n.lastAlignSpec=t,l&&o.offsetParent){(t=Object.setPrototypeOf({},t)).target=oe.from(o,n.positioned?s.offsetParent:null,!n.positioned),t.target.height=Math.max(t.target.height,1),t.target.width=Math.max(t.target.width,1);const e=n.clippedBy;if(e){const r=t.target.intersect(e);if(!r){const e=n.hide();return n.lastAlignSpec.targetHidden=!0,e}t.target=r}n.anchoredTo=o}else n.anchoredTo=null;t.anchor&&(t.anchorSize=n.anchorSize,s.appendChild(n.anchorElement)),n.isAligning=!0,n.trigger("beforeAlign",t),n.isAligning=!1;const{constrainTo:c}=t,d=c===window||c===document,u=a.alignTo(t);let{align:h,anchor:g,x:m,y:p,width:f,height:v,bottom:y,right:b}=u;if(n.lastAlignSpec.zone=u.zone,v!==a.height&&("configuredHeight"in n||(n.configuredHeight=s.style.height),n.height=v,n.alignConstrained=1|n.alignConstrained,r&&(r.overflowY=!0)),f!==a.width&&("configuredWidth"in n||(n.configuredWidth=s.style.width),n.width=f,n.alignConstrained=2|n.alignConstrained,r&&(r.overflowX=!0)),h&&n.alignConstrained){t.align=h;const e=oe.from(s,n.positioned?s.offsetParent:null,!0).alignTo(t);g=e.anchor,m=e.x,p=e.y,f=e.width,v=e.height,y=e.bottom,b=e.right}if(n.setXY(m,p),g){const{edge:e}=g,{anchorElement:t}=n,r=[],i=s.style.pointerEvents;s.style.pointerEvents="all","top"===e||"bottom"===e?(r[0]=m+g.x,r[1]="top"===e?p+1:y-1):(r[0]="left"===e?m+1:b-1,r[1]=p+g.y);const o=document.elementFromPoint(...r);if(s.style.pointerEvents=i||null,o){const e=yt.getStyleValue(o,"background-color");e.match(xn)?n.anchorPathElement.setAttribute("fill",n.defaultAnchorBackgroundColor):n.anchorPathElement.setAttribute("fill",e)}t.classList.remove("b-hide-display"),t.style.transform="",t.className=`b-anchor b-anchor-${e}`,yt.setTranslateXY(t,g.x,g.y)}else n._anchorElement&&n.anchorElement.classList.add("b-hide-display");"hide"!==n.scrollAction||l||(s.style.pointerEvents="none",n.anchoredTo=document.elementFromPoint(m,p),s.style.pointerEvents=""),("realign"===n.scrollAction&&l||"hide"===n.scrollAction)&&!n.documentScrollListener&&n.setTimeout(()=>{document.addEventListener("scroll",n.doHideOrRealign,!0),n.documentScrollListener=!0},0),!c||1!==c.nodeType&&!d||n.constrainListeners||(Mt.addResizeListener(c,n.callRealign),d||n.constrainMutationMonitor||(n.constrainMutationMonitor=new MutationObserver(n.callRealign)).observe(c,{attributes:!0,childList:!0}),n.constrainListeners=!0)}realign(e){const t=this;if(t.isVisible&&(t.floating||t.positioned)&&t.lastAlignSpec){const n=t.lastAlignSpec.target;if(n&&1===n.nodeType){const r=oe.from(n);if(r.minHeight=r.minWidth=1,n!==document.body&&!n.offsetParent||e&&1===e.nodeType&&e.contains(n)&&!oe.from(e).intersect(r))return t.hide()}t.alignTo(t.lastAlignSpec)}}releaseSizeConstraints(){const e=this,t=e.scrollable;1&e.alignConstrained&&(e.height=e.configuredHeight,t&&(t.overflowY=t.config.overflowY)),2&e.alignConstrained&&(e.width=e.configuredWidth,t&&(t.overflowX=t.config.overflowX)),e.alignConstrained=0}toFront(){this.element&&this.element.nextSibling&&this.element.parentNode.appendChild(this.element)}set ref(e){this._ref=e,this.element.dataset.ref=e}get ref(){return this._ref}set clippedBy(e){this._clippedBy=Array.isArray(e)?e:e?[e]:null}get clippedBy(){const e=this._clippedBy;if(e){let t,n=oe.from(e[0],null,!0);for(t=1;t<e.length;t++)n=n.intersect(oe.from(e[t],null,!0));return n}}get overflowElement(){return this.contentElement}get maxHeightElement(){return this.element}set scrollable(e){const t=this.overflowElement;"boolean"==typeof e&&(e={overflowX:e,overflowY:e}),t&&(e.element=t),e.widget=this,this._scrollable=new this.scrollerClass(e)}get scrollable(){return this._scrollable}get html(){return this.initializingElement||!this.element?this.content||this._html:this.contentElement.innerHTML}set html(e){const t=this,n=null==e,{element:r,contentElement:s}=t;if(t._html!==e&&(t._html=e,r)){const i=s===r&&t._anchorElement;r.classList[n?"remove":"add"]("b-html"),i&&t.element.removeChild(i),t.contentElement.innerHTML=n?"":e,i&&r.appendChild(i),(t.floating||t.positioned)&&(t.isAligning||t.realign())}}set content(e){const t=this,n=null==e,{element:r}=t;if(t._html!==e&&(t._html=e,r)){let{contentRange:s}=t;r.classList[n?"remove":"add"]("b-html"),s.deleteContents(),n||s.insertNode(yt.createElementFromTemplate(e,{fragment:!0})),t.isAligning&&!t.positioned||t.realign()}}onThemeChange(){this.anchorElement&&this.anchorElement.offsetParent&&(this._anchorSize=null,this.realign())}get anchorSize(){const e=this;let t=this._anchorSize;if(!t){const n=parseFloat(yt.getStyleValue(e.element,"border-top-width")),r=yt.getStyleValue(e.element,"border-top-color"),s=e.anchorElement,i=s.firstElementChild,o=e.anchorPathElement=i.lastElementChild,a=e._hidden;let l=yt.getStyleValue(e.contentElement,"background-color");l.match(xn)&&(l=yt.getStyleValue(e.element,"background-color")),e.defaultAnchorBackgroundColor=l,t=s.getBoundingClientRect();const[c,d]=t=e._anchorSize=[t.width,t.height];i.setAttribute("height",d+n),i.setAttribute("width",c),o.setAttribute("d",`M0,${d}L${c/2},0.5L${c},${d}`),n&&(o.setAttribute("stroke-width",n),o.setAttribute("stroke",r)),t[1]-=n,a&&e.element.classList.add("b-hidden"),e.themeChangeListener||(e.themeChangeListener=Cn.on({theme:"onThemeChange",thisObj:e}))}return e.anchorPathElement.setAttribute("fill",e.defaultAnchorBackgroundColor),t}get anchorElement(){let e=this._anchorElement;return e||(e=this._anchorElement=yt.createElement({parent:this.element,className:"b-anchor b-anchor-top",children:[{tag:"svg",ns:"http://www.w3.org/2000/svg",version:"1.1",class:"b-pointer-el",children:[{tag:"defs",children:[{tag:"filter",id:"shadow-filter",children:[{tag:"feDropShadow",dx:0,dy:-1,stdDeviation:2,"flood-opacity":.05}]}]},{tag:"path",filter:G.isIE11||G.isEdge?null:"url(#shadow-filter)"}]}]})),e}set anchor(e){this._anchor=e,this._anchorElement&&this._anchorElement.classList[e?"remove":"add"]("b-hide-display")}get draggable(){return this._draggable}set draggable(e){const t=this,{element:n}=t;t._draggable=e,n.setAttribute("draggable",Boolean(e)),e?t.dragEventDetacher=Kt.addListener({element:t.element,dragstart:t.onWidgetDragStart,dragend:t.onWidgetDragEnd,thisObj:t}):(t.dragEventDetacher&&t.dragEventDetacher(),t.dragOverEventDetacher&&t.dragOverEventDetacher())}onWidgetDragStart(e){const t=this,n=document.elementFromPoint(e.clientX,e.clientY),{handleSelector:r}=t.draggable;if(r){const s=kn.exec(r)[1];if(s){if(n.closest(`#${t.element.id} ${s}`))return void e.preventDefault()}else if(!n.closest(`#${t.element.id} ${r}`))return void e.preventDefault()}t.removeTransientListeners();const s=e.clientX,i=e.clientY,o=document.scrollingElement||document.body,a=t.getXY()[0],l=t.getXY()[1];document.body.appendChild(In),e.dataTransfer.setDragImage&&(e.dataTransfer.setData("application/node type",""),e.dataTransfer.setDragImage(In,0,0)),e.dataTransfer.effectAllowed="none",t.dragOverEventDetacher=Kt.addListener({element:document.body,dragover:e=>t.setXY(a+e.clientX-s-o.scrollLeft,l+e.clientY-i-o.scrollTop)}),t.anchor=null}onWidgetDragEnd(e){In.remove(),this.dragOverEventDetacher()}get anchor(){return this._anchor}get floating(){return this._floating}set floating(e){e=Boolean(e),Boolean(this.floating)!==e&&(this._floating=e)}get positioned(){return this._positioned}set positioned(e){e=Boolean(e),Boolean(this.positioned)!==e&&(this.element.classList[e?"add":"remove"]("b-positioned"),this._positioned=e)}getXY(){return[yt.getPageX(this.element),yt.getPageY(this.element)]}setXY(e,t){const n=this;(n.floating||n.positioned)&&(null!=e&&(n._x=e,n.centered=!1),null!=t&&(n._y=t,n.centered=!1),yt.setTranslateXY(n.element,n._x||0,n._y||0))}set x(e){this.setXY(e)}get x(){return this.getXY()[0]}set y(e){this.setXY(null,e)}get y(){return this.getXY()[1]}get width(){const e=this,t=e.element;return e.monitorResize?(null==e._width&&(e._width=t.offsetWidth),e._width):t.offsetWidth}set width(e){yt.setLength(this.element,"width",e),this._width=null,this._flex=null,this.element.style.flex=G.isIE11?"":null}get maxWidth(){return yt.measureSize(this.element.style.maxWidth,this.element)}set maxWidth(e){yt.setLength(this.element,"maxWidth",e)}get minWidth(){return yt.measureSize(this.element.style.minWidth,this.element)}set minWidth(e){yt.setLength(this.element,"minWidth",e)}get flex(){return this._flex}set flex(e){this._flex=e,("number"==typeof e||"string"==typeof e&&1===e.split(/\s/).length)&&(e=`${e} ${e}`),this.element.style.flex=e,this.element.style.width=G.isIE11?"":null}get alignSelf(){return this._alignSelf}set alignSelf(e){this.element.style.alignSelf=e}get margin(){return this._margin}set margin(e){this.element.style.margin=this._margin=this.parseTRBL(e).join(" ")}get height(){const e=this,t=e.element;return e.monitorResize?(null==e._height&&(e._height=t.offsetHeight),e._height):t.offsetHeight}set height(e){yt.setLength(this.element,"height",e),this._height=null}get maxHeight(){return yt.measureSize(this.maxHeightElement.style.maxHeight,this.element)}set maxHeight(e){const t=this,{element:n}=t;yt.setLength(t.maxHeightElement,"maxHeight",e),G.isIE11&&t.contentElement!==n&&(null==e?Mt.removeResizeListener(n,t.boundMaxHeightBugHandler):(Mt.addResizeListener(n,t.boundMaxHeightBugHandler||(t.boundMaxHeightBugHandler=t.fixIEMaxHeightBug.bind(t))),document.body.contains(n)&&t.fixIEMaxHeightBug()))}fixIEMaxHeightBug(){const{element:e,contentElement:t}=this;if("column"===yt.getStyleValue(e,"flex-direction")){t.style.maxHeight="";let n=oe.client(e).height;const r=e.childNodes,s=r.length;for(let e=0;e<s;e++){const s=r[e];s===t||s.classList.contains("b-resize-monitors")||(n-=s.offsetHeight)}this.contentElement.style.maxHeight=`${n}px`}}get minHeight(){return yt.measureSize(this.element.style.minHeight,this.element)}set minHeight(e){yt.setLength(this.element,"minHeight",e)}get disabled(){return this._disabled}set disabled(e){const t=this.element,n=this.focusElement;e&&this.revertFocus(),t&&(t.classList[e?"add":"remove"]("b-disabled"),n&&(n.disabled=e)),this._disabled=e}disable(){this.disabled=!0}enable(){this.disabled=!1}get tooltip(){return this._tooltip}set tooltip(e){const t=this;t._tooltip&&(t._tooltip.destroy(),t._tooltip=null),!e||t.preventTooltipOnTouch&&G.isTouchDevice||("Object"!==e.constructor.name&&(e={html:"string"==typeof e?e:t.placeholder,textContent:!0}),e.type="tooltip",e.forElement||(e.forElement=t.element),"showOnHover"in e||(e.showOnHover=!0),"autoClose"in e||(e.autoClose=!0),t._tooltip=I.createWidget(e))}get isVisible(){const e=this.element;let t=e&&!this._hidden;if(t&&(!document.body.contains(e)||this.requireSize&&0===e.offsetWidth&&0===e.offsetHeight)&&(t=!1,window.ShadowRoot)){let n=e;for(;n=n.parentNode;)n instanceof window.ShadowRoot&&(t=!0)}return t}focus(){this.isFocusable&&yt.focusWithoutScrolling(this.focusElement)}get focusElement(){}get isFocusable(){const e=this.focusElement;return e&&this.isVisible&&!this.disabled&&(e===document.body||e.offsetParent)}show(){return new Promise(t=>{const n=this,{showAnimation:r,element:s}=n,i=e.floatRoot,o=s.style;let a,l;n.isVisible||!1===n.trigger("beforeShow")||(n.cancelHideShowAnimation(),r&&(l=r[a=Object.keys(r)[0]],n.currentAnimation={styleProp:a},s.addEventListener("transitionend",n.afterHideShowAnimate),o[a]=l.from),n.floating&&(i.contains(s)||n.render(i),document.body.contains(i)||document.body.appendChild(i)),n._hidden=!1,s.classList.remove("b-hidden"),r&&(o.transition=`${a} ${l.duration} ease ${l.delay}`,o[a]=l.to),n.afterShow(t),!n.inShowBy&&n.floating&&n.forElement&&n.alignTo(n.forElement))})}showBy(e){const t=this;t.inShowBy=!0,t.show(),t.inShowBy=!1,t.isVisible&&t.alignTo(e)}showByPoint(e,t,n){const r=1===arguments.length?e:[e,t];this.showBy(Object.assign({target:new oe(r[0],r[1],1,1),align:"t-b"},n))}afterShow(e){this.boundMaxHeightBugHandler&&this.boundMaxHeightBugHandler(),this.trigger("show"),this.triggerPaint(),e()}triggerPaint(){this.isVisible&&(this.trigger("paint"),this.eachWidget&&this.eachWidget(Rn,!0))}cancelHideShowAnimation(){const e=this,t=e.element,n=t.style;e.currentAnimation&&(t.classList.remove("b-hiding"),t.removeEventListener("transitionend",e.afterHideShowAnimate),n.transition=n[e.currentAnimation.styleProp]="",e.currentAnimation=null)}afterHideShowAnimate(e){if(this.isDestroyed)return;const t=this,n=t.element,r=n.style,{styleProp:s,resolve:i}=t.currentAnimation;e.target===n&&e.propertyName===s&&(n.classList.remove("b-hiding"),t.currentAnimation=null,n.removeEventListener("transitionend",t.afterHideShowAnimate),r.transition=r[s]="",t._hidden&&(t.afterHideAnimation(),t.afterHide(i,!1)))}hide(e=!0){return new Promise(t=>{const n=this,r=n.element,s=r.style,i=e&&n.hideAnimation;if(!n._hidden&&!1!==n.trigger("beforeHide")){if(n._hidden=!0,!r)return;if(n.revertFocus(),n.isDestroyed)return void t();if(n.currentAnimation&&n.cancelHideShowAnimation(),i){const e=Object.keys(i)[0],o=i[e];n.currentAnimation={styleProp:e,resolve:t},r.classList.add("b-hiding"),r.addEventListener("transitionend",n.afterHideShowAnimate),s[e]=o.from,s.transition=`${e} ${o.duration} ease ${o.delay}`,n.requestAnimationFrame(()=>{s[e]=o.to})}else r.classList.add("b-hidden");n.afterHide(!i&&t)}})}doHideOrRealign(e){const t=this,n=t.anchoredTo,r=document.activeElement;9===e.target.nodeType&&t.element.contains(r)&&Tn[r]&&window.innerHeight<document.body.offsetHeight||("hide"!==t.scrollAction||n&&!yt.isDescendant(e.target,n)?"realign"===t.scrollAction&&(yt.isDescendant(e.target,n)||k.fromElement(n,Mn))&&e.target!==(document.scrollingElement||document.body)&&t.realign(e.target):t.hide())}afterHide(e=null,t=!0){const n=this,{lastAlignSpec:r}=n;r&&(r.targetHidden=null),n.removeTransientListeners(),n.hideAnimation||n.afterHideAnimation(),t&&n.trigger("hide"),e&&e()}removeTransientListeners(){const e=this;e.documentScrollListener&&(document.removeEventListener("scroll",e.doHideOrRealign,!0),e.documentScrollListener=!1),e.constrainListeners&&(Mt.removeResizeListener(e.lastAlignSpec.constrainTo,e.callRealign),e.constrainMutationMonitor&&e.constrainMutationMonitor.disconnect(),e.constrainListeners=!1)}afterHideAnimation(){const{element:t,contentRange:n}=this;this.floating&&e.floatRoot.contains(t)?(n&&(this.contentRangeStart=n.start,this.contentRangeEnd=n.end),t.remove()):t.classList.add("b-hidden")}set visible(e){this.hidden=!e}set hidden(e){this.isConfiguring?(this._hidden=e,this.element.classList[e?"add":"remove"]("b-hidden")):e?this.hide():this.show()}get assignedId(){return this.hasGeneratedId?null:this.id}get owner(){return this.parent||this._owner||k.fromElement(this.forElement||this.element.parentNode)}set owner(e){this._owner=e}up(e,t,n){const r=typeof n,s="number"===r,i="string"===r;for(let o=this.owner,a=1;o;o=o.owner,a++){if(M(o,e,t))return o;if(s&&a>=n)return;if(i&&M(o,n,t))return;if(o===n)return}}owns(e){if(e&&1===e.nodeType){if(this.element.contains(e))return!0;e=k.fromElement(e)}for(;e;){if(e===this)return!0;e=e.owner}return!1}onFocusIn(e){const t=this,{element:n}=t;t.containsFocus=!0,t.focusInEvent=e,n.classList.add("b-contains-focus"),n.contains(e.target)&&t.onInternalKeyDown&&!t.keyDownListenerRemover&&(t.keyDownListenerRemover=Kt.on({element:n,keydown:"onInternalKeyDown",thisObj:t})),t.trigger("focusin",e)}onFocusOut(e){const t=this;t.keyDownListenerRemover&&(t.keyDownListenerRemover(),t.keyDownListenerRemover=null),t.isDestroyed||(t.containsFocus=!1,t.focusInEvent=null,t.element.classList.remove("b-contains-focus"),t.trigger("focusout",e))}revertFocus(){this.focusInEvent&&this.focusInEvent.relatedTarget&&1===this.focusInEvent.relatedTarget.nodeType&&this.element.contains(document.activeElement)&&yt.focusWithoutScrolling(this.focusInEvent.relatedTarget)}isFocused(){return this.element.classList.contains("b-contains-focus")}get widgetClassList(){const t=this;let n=t.cls,r=t.classHierarchy(e).reduce((e,n)=>{let r,s=Reflect.getOwnPropertyDescriptor(n.prototype,"widgetClass");return(r=s&&s.get?s.get.call(t):`b-${n.$name.toLowerCase()}`)&&e.push(...r.split(" ")),e},n?n.split(" "):[]);return t.floating&&r.push("b-floating"),G.isTouchDevice&&r.push("b-touch"),r}fromCache(e,t=!1,n=this.element){return n?(this.cache[e]||(this.cache[e]=t?yt.children(n,e):yt.down(n,e)),this.cache[e]):null}emptyCache(){this.cache={}}mask(e){const t=this;return t.maskInstance&&t.maskInstance.destroy(),"string"==typeof e?t.maskInstance=I.mask(t.element,e):(e.element=t.element,t.maskInstance=I.mask(e))}unmask(){this.maskInstance&&(I.unmask(this.element),this.maskInstance=null)}onInternalResize(e,t,n,r,s){this._width=e.offsetWidth,this._height=e.offsetHeight}onElementResize(e){const t=this,n=t.element,r=t._width,s=t._height,i=n.offsetWidth,o=n.offsetHeight;t.suspendResizeMonitor||r===i&&s===o||(t.onInternalResize(n,i,o,r,s),t.trigger("resize",{width:i,height:o,oldWidth:r,oldHeight:s}))}updateScale(){const e=this,t=e.element,n=t.parentElement;e.configuredWidth||(e.configuredWidth=e.width),e.parentHeight||(e.parentHeight=n.offsetHeight),t.style.display="none";const r=n.offsetWidth/e.configuredWidth,s=e.allowGrowWidth?Math.min(r,1):r;t.style.transform=`scale(${s})`,t.style.transformOrigin="top left",t.style.display="",n.style.height=e.parentHeight*s+"px",e.allowGrowWidth&&r>1&&(e.width=e.configuredWidth*r)}onParentElementResize(e){this.updateScale()}parseTRBL(e,t="px"){if("number"==typeof(e=e||0))return[`${e}${t}`,`${e}${t}`,`${e}${t}`,`${e}${t}`];const n=e.split(" "),r=n.length;return 1===r?n[1]=n[2]=n[3]=n[0]:2===r?(n[2]=n[0],n[3]=n[1]):3===r&&(n[3]=n[1]),[isFinite(n[0])?`${n[0]}${t}`:n[0],isFinite(n[1])?`${n[1]}${t}`:n[2],isFinite(n[2])?`${n[2]}${t}`:n[3],isFinite(n[3])?`${n[3]}${t}`:n[4]]}static get floatRoot(){const e=this;return e._floatRoot||(e._floatRoot=document.querySelector(".b-float-root"),e._floatRoot||(e._floatRoot=yt.createElement({className:"b-float-root",parent:document.body}))),e._floatRoot}static fromElement(e,t,n){}}return e._$name="Widget",e}();E.register("widget",An),E.register("tool",function(){class e extends An{template(){return'<div class="b-icon"></div>'}construct(e){super.construct(e),Kt.on({element:this.element,click:"onClick",mousedown:"onMousedown",thisObj:this})}onClick(e){const t=this,n=t.panel,r="function"==typeof t.handler?t.handler:n[t.handler];!1!==n.trigger("toolclick",{tool:t})&&r&&t.callback(r,n,[e])}onMousedown(e){const t=this.panel,n=t.focusElement;e.preventDefault(),n&&document.activeElement!==n&&t.focus()}get panel(){return this.parent}}return e._$name="Tool",e}());const Fn=function(){class e extends(ue(W)){static get defaultConfig(){return{containerCls:null,itemCls:null}}static getLayout(t,n){if(t instanceof e)return t;const r="string"==typeof t,s={owner:n};return new(r?On[t]:t)(r?s:Object.assign(s,t))}static registerLayout(e,t=e.$name.toLowerCase()){On[t]=e}renderChildren(){const{owner:e,containerCls:t,itemCls:n}=this,{contentElement:r,items:s}=e,i=e.itemCls,o=s&&s.length;if(r.classList.add("b-content-element"),t&&r.classList.add(t),o)for(let a=0;a<o;a++){const e=s[a],{element:t}=e;t.dataset.index=a,n&&t.classList.add(n),i&&t.classList.add(i),t.classList.remove("b-outer"),e.render(r)}}}return e._$name="Layout",e}(),On={default:Fn};let Ln=0;const _n=e=>e.ripple,Pn=(window.Ripple=new class extends An{static get defaultConfig(){return{old_element:{children:[{className:"b-ripple-inner",reference:"rippleElement"}]},element:{children:[{tag:"svg",class:"b-ripple-inner",reference:"rippleElement",ns:"http://www.w3.org/2000/svg",version:"1.1",viewBox:"0 0 100 100",children:[{reference:"circleElement",tag:"circle",cx:"0",cy:"0",r:10}]}]},floating:!0,hideAnimation:!1,showAnimation:!1,scrollAction:"realign",color:"rgba(0,0,0,.3)",startRadius:10,radius:100}}static get $name(){return"Ripple"}afterConstruct(){super.afterConstruct(),Kt.on({element:document,DOMContentLoaded:"doEnableDisable",thisObj:this}),Cn.on({theme:"doEnableDisable",thisObj:this})}doEnableDisable(){const e=this;e.show();const t=yt.getStyleValue(e.circleElement,"animationName");e.hide(),t&&"none"!==t?e.listenerDetacher=Kt.on({mousedown:{element:document,capture:!0,handler:"onDocumentMousedown"},touchstart:{element:document,capture:!0,handler:"onDocumentTouchStart"},animationend:{element:e.circleElement,handler:"onAnimationEnd"},thisObj:e}):e.listenerDetacher&&e.listenerDetacher()}onDocumentTouchStart(e){Ln=performance.now(),this.handleTriggerEvent(e)}onDocumentMousedown(e){performance.now()-Ln>200&&this.handleTriggerEvent(e)}handleTriggerEvent(e){const t=k.fromElement(e.target,_n);if(t){const n=t.ripple,r=n.delegate?e.target.closest(n.delegate):t.focusElement||t.element;if(r){const s=We.assign({event:e,target:r,radius:this.radius},n);if("string"==typeof s.clip&&(s.clip=t[s.clip]||e.target.closest(s.clip),!s.clip))return;this.ripple(s)}}}ripple({event:e,point:t=Kt.getClientPoint(e),target:n=e.target,clip:r=n,radius:s=this.radius,color:i=this.color}){this.clip=r,r=oe.from(r,null,!0);const o=this,a=r.getDelta(t),l=o.rippleElement.style,c=o.circleElement;o.hide(),o.alignTo(r),l.transform=`translateX(${a[0]}px) translateY(${a[1]}px)`,l.height=l.width=`${s}px`,c.setAttribute("r",s),c.setAttribute("fill",i),o.show(),o.requestAnimationFrame(()=>{document.addEventListener("scroll",o.callRealign,!0),o.documentScrollListener=!0},0)}alignTo(e){1===e.nodeType&&(e=oe.from(e,null,!0));const{x:t,y:n,width:r,height:s}=e;this.x=t,this.y=n,this.height=s,this.width=r}onAnimationEnd(e){"b-ripple-expand"===e.animationName&&this.hide()}realign(){this.isVisible&&this.alignTo(this.clip)}},Object.freeze({})),$n=function(){class e extends An{static get defaultConfig(){return{items:null,widgets:null,defaults:null,defaultType:"widget",layoutStyle:null,itemCls:null,layout:"default",namedItems:null}}setConfig(e,t){e.widgets&&(e.items=e.widgets),super.setConfig(e,t)}startConfigure(e){const{items:t}=this;this.hasItems=Boolean(t&&t.length),super.startConfigure(e)}set widgets(e){console.warn("`widgets` was deprecated in 2.1, please change your code to use `items`")}get widgets(){return console.warn("`widgets` was deprecated in 2.1, please change your code to use `items`"),this.items}set items(e){this._items=e,this._itemsInvalid=this.itemsInitialized=!0}get items(){const e=this,t=e._items;if(e._widgetMap||(e._widgetMap={}),e._itemsInvalid){const n=e._items=[];Array.isArray(t)?e.processItemsArray(t,n):t&&e.processItemsObject(t,e.namedItems,n),n.some(e=>e.weight)&&n.sort((e,t)=>(e.weight||0)-(t.weight||0)),e._itemsInvalid=!1}return e._items}processItemsArray(e,t){const n=e.length;let r,s;for(r=0;r<n;r++)(s=e[r])instanceof An?s.parent=this:s=this.createWidget(s),s&&(t.push(s),this.registerReference(s,s.ref||s.id))}processItemsObject(e,t=Pn,n){let r,s;for(s in e)(r=e[s])&&(s in t&&(r="object"==typeof r?We.merge(We.clone(t[s]),r):t[s]),r&&(r instanceof An?r.parent=this:r=this.createWidget(r),r&&(n.push(r),this.registerReference(r,s))))}registerReference(e,t){for(let n=this;n;n=n.parent)n.widgetMap[t]||(n.widgetMap[t]=e)}get widgetMap(){return this._widgetMap||this._thisIsAUsedExpression(this.items),this._widgetMap}set record(e){const t=this.queryAll(e=>e.name),n=t.length,r=this.element.classList;r.add("b-form-updating");for(let s=0;s<n;s++){const n=t[s],r=n.name,i=n.highlightExternalChange;n.highlightExternalChange=!1,!e&&r?n.value=null:e&&r in e&&(n.value=e[r]),n.highlightExternalChange=i}this.setTimeout(()=>r.remove("b-form-updating"),1500),this._record=e}get record(){return this._record}set layoutStyle(e){yt.applyStyle(this.contentElement,e),this._layoutStyle=e}get layoutStyle(){return this._layoutStyle}set layout(e){this._layout=Fn.getLayout(e,this)}get layout(){return this._layout||(this._layout=new Fn)}eachWidget(e,t=!0){const n=this.items,r=n?n.length:0;for(let s=0;s<r;s++){const r=n[s];if(!1===e(r))return;t&&r.eachWidget&&r.eachWidget(e,t)}}queryAll(e){const t=[];return this.eachWidget(n=>{e(n)&&t.push(n)}),t}query(e){let t=null;return this.eachWidget(n=>{if(e(n))return t=n,!1}),t}getWidgetById(e){return this.widgetMap[e]}processWidgetConfig(e){}createWidget(e){const t=this;e.type||(e.type=t.defaultType);let n=e=Object.setPrototypeOf({parent:t},e);for(;n=n.parent;)if(!1===n.processWidgetConfig(e))return null;return!1===t.trigger("beforeWidgetCreate",{widget:e})?null:I.createWidget(We.assign({},t.defaults,e),t.defaultType||"widget")}render(e){const t=super.render(e,!1);return this.layout.renderChildren(),this.parent||this.triggerPaint(),t}get focusElement(){const e=this.query(this.defaultFocus||(e=>e.focusElement));return e?e.focusElement:super.focusElement}doDestroy(){!this._itemsInvalid&&this.items&&this.items.forEach(e=>e.destroy&&e.destroy()),super.doDestroy()}}return e._$name="Container",e}();E.register("container",$n);const jn=function(){class e extends $n{static get defaultConfig(){return{defaultType:"button",layout:"default"}}createWidget(e){return"->"===e&&(e={cls:"b-toolbar-fill"}),super.createWidget(e)}}return e._$name="Toolbar",e}();E.register("toolbar",jn);const Hn=e=>!e.classList.contains("b-focus-trap")&&yt.isFocusable(e)?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP,Nn=(e,t)=>(e.weight||0)-(t.weight||0),zn=(e,t)=>(t.weight||0)-(e.weight||0);Hn.acceptNode=Hn;const Bn=function(){class e extends $n{static get defaultConfig(){return{trapFocus:null,title:null,header:null,footer:null,tools:null,tbar:null,bbar:null}}set element(t){const n=this,r=n.header||(n.tools||n.title&&(!n.parent||!n.parent.suppressChildHeaders)?{}:null),s=n.footer,i=r&&("string"==typeof r?r:n.title||r.title),o=r&&(r.titleAlign||"start"),a=n.classHierarchy(e).map(e=>`b-${e.$name.toLowerCase()}-header`).join(" "),l=n.tbar,c=n.bbar||n.buttons,d=[{reference:"topFocusTrap",className:"b-focus-trap",tabIndex:0}],u=[],h=[],g={children:d};if((n.hasItems||n.focusable)&&(g.tabIndex=0),r){const e=[{reference:"titleElement",className:"b-header-title",style:`text-align:${o}`,html:i}];for(const t in n.tools){const e=n.tools[t];"start"===e.align?u.unshift(e):h.push(e)}u.sort(Nn),h.sort(zn),e.unshift(...u.map(e=>e.element)),e.push(...h.map(e=>e.element)),d.push({tag:"header",reference:"headerElement",className:`${a} b-dock-${r.dock||"top"} ${r.cls||""}`,children:e})}l&&(l.layout.renderChildren(),d.push(l.element)),d.push(n.bodyConfig),c&&(c.layout.renderChildren(),d.push(c.element)),s&&d.push({tag:"footer",reference:"footerElement",className:`${a} b-dock-${s.dock||"bottom"} ${s.cls||""}`}),d.push({reference:"bottomFocusTrap",className:"b-focus-trap",tabIndex:0}),super.element=g}set bodyConfig(e){this._bodyConfig=e}get bodyConfig(){return this._bodyConfig||{reference:"bodyElement",className:this.classHierarchy(e).map(e=>`b-${e.$name.toLowerCase()}-content`).join(" "),html:this.html}}get element(){return super.element}set tbar(e){e instanceof jn?e.parent=this:(Array.isArray(e)&&(e={items:e}),e=new jn(Object.assign({parent:this},e))),e.element.classList.add("b-top-toolbar",`b-dock-${e.dock||"top"}`),this._tbar=e}get tbar(){return this._tbar}set bbar(e){e instanceof jn?e.parent=this:(Array.isArray(e)&&(e={items:e}),e=new jn(Object.assign({parent:this},e))),e.element.classList.add("b-bottom-toolbar",`b-dock-${e.dock||"bottom"}`),this._bbar=e}get bbar(){return this._bbar}eachWidget(e,t=!0){const n=this,r=n.items?n.items.slice():[];n.tools&&r.unshift(...Object.values(n.tools)),n.tbar&&r.unshift(n.tbar),n.bbar&&r.push(n.bbar);for(let s=0;s<r.length;s++){const n=r[s];if(!1===e(n))return;t&&n.eachWidget&&n.eachWidget(e,t)}}set tools(e){const t=this,n=t._tools={};for(const r in e){const s=n[r]=I.createWidget(We.assign({type:"tool",ref:r,reference:r,parent:t},e[r]),t.defaultToolType||"tool");t.registerReference(s,s.ref)}}get tools(){return this._tools}set trapFocus(e){const t=this;t.element.classList[e?"add":"remove"]("b-focus-trapped"),e?(t.focusTrapListener=Kt.on({element:t.element,focusin:"onFocusTrapped",delegate:".b-focus-trap",thisObj:t}),t.treeWalker||(t.treeWalker=document.createTreeWalker(t.element,NodeFilter.SHOW_ELEMENT,Hn,!1))):t.focusTrapListener&&(t.focusTrapListener(),t.focusTrapListener=null),t._trapFocus=e}get trapFocus(){return this._trapFocus}onFocusTrapped(e){const t=this,n=t.treeWalker;e.target===t.bottomFocusTrap?(n.currentNode=t.topFocusTrap,n.nextNode()):(n.currentNode=t.bottomFocusTrap,n.previousNode()),t.requestAnimationFrame(()=>n.currentNode.focus())}get focusElement(){return this.hasItems&&(super.focusElement||this.element)}get contentElement(){return this.element&&this.bodyElement}get widgetClassList(){const e=this,t=super.widgetClassList,n=e.header;return(n||e.title||e.tools)&&t.push(`b-panel-has-header b-header-dock-${n&&n.dock||"top"}`),e.tbar&&t.push("b-panel-has-top-toolbar"),e.bbar&&t.push("b-panel-has-bottom-toolbar"),t}doDestroy(){this.tbar&&this.tbar.destroy(),this.bbar&&this.bbar.destroy(),super.doDestroy()}}return e._$name="Panel",e}();E.register("panel",Bn);const Vn=function(){class e extends Bn{static get defaultConfig(){return{autoShow:!0,autoClose:!0,showOnClick:!1,forElement:null,monitorResize:!0,floating:!0,hidden:!0,axisLock:!0,hideAnimation:G.isIE11?null:{opacity:{from:1,to:0,duration:".3s",delay:"0s"}},showAnimation:G.isIE11?null:{opacity:{from:0,to:1,duration:".4s",delay:"0s"}},closeAction:"hide",trapFocus:!0,focusOnToFront:!0,closable:null,modal:null}}startConfigure(e){this._thisIsAUsedExpression(this.closable),super.startConfigure(e)}finalizeInit(){const e=this;e.anchoredTo=e.forElement,e.initialAnchor=e.anchor,e.forElement&&e.showOnClick&&(e.initialConfig.autoShow||(e.autoShow=!1),Kt.on({element:e.forElement,click:"onElementUserAction",thisObj:e})),super.finalizeInit(),e.autoShow&&(!0===e.autoShow?e.show():e.setTimeout(()=>e.show(),e.autoShow))}close(){if(!this._hidden&&!1!==this.trigger("beforeClose")||this._hidden&&"destroy"==this.closeAction)return this[this.closeAction]()}onElementResize(e,t,n){const r=this,{lastAlignSpec:s}=r;if(r.isVisible&&s&&s.target){const e=!t||n.width!==t.width;((!t||n.height!==t.height)&&2!==s.zone||e&&1!==s.zone)&&r.requestAnimationFrame(()=>r.realign())}super.onElementResize(e)}onInternalKeyDown(e){"Escape"===e.key&&(e.stopImmediatePropagation(),this.close(!0))}onDocumentMouseDown({event:t}){const n=this;n.modal&&t.target===e.modalMask?(t.preventDefault(),n.modal.closeOnMaskTap?n.close():n.containsFocus||n.focus()):n.owns(t.target)||!n.autoClose||n.containsFocus||n.close()}onFocusIn(e){const t=document.activeElement;super.onFocusIn(e),document.activeElement===t&&e.target===this.element&&this.focus()}onFocusOut(e){this.autoClose&&this.close(),super.onFocusOut(e)}onShow(){const t=this;if(t.autoClose&&!t.mouseDownRemover&&(t.mouseDownRemover=Cn.on({globaltap:"onDocumentMouseDown",thisObj:t})),t.focusOnToFront&&t.focus(),super.onShow&&super.onShow(),t.modal){t._x||t._y||(t.centered=!0);const{modalMask:n}=e;n.classList.remove("b-hide-display"),n.parentNode.insertBefore(n,t.element)}}onHide(){this.mouseDownRemover&&(this.mouseDownRemover(),this.mouseDownRemover=null),super.onHide&&super.onHide(),this.modal&&e.modalMask.classList.add("b-hide-display")}onElementUserAction(){this.show()}set closable(e){this._closable=e,this.tools||(this.tools={})}get closable(){return this._closable}set tools(e){this.closable&&((e||(e={})).close={cls:"b-popup-close",handler:"close",weight:-1e3}),super.tools=e}get tools(){return super.tools}static get modalMask(){return this._modalMask||(this._modalMask=yt.createElement({className:"b-modal-mask b-hide-display",parent:this.floatRoot})),this._modalMask}}return e._$name="Popup",e}();E.register("popup",Vn);const Wn=/>[ \t\r\n]+</g,Un=/\s\s+/g,Gn=function(){class e{static tpl(e,...t){let n=0,r=t.map((t,r)=>{let s=e[r];return Array.isArray(t)?s+=t.reduce((e,t)=>e+=("string"==typeof t?t.trim():t)+"\n",""):(void 0===t&&(t=""),s+="string"==typeof t?t.trim():t),n++,s}).join("");return n<=e.length&&(r+=e[e.length-1]),r.replace(Wn,"><").replace(Un," ").trim()}static docsTpl(e,...t){let n=0,r=t.map((t,r)=>{let s=e[r];return Array.isArray(t)?s+=t.reduce((e,t)=>e+=("string"==typeof t?t.trim():t)+"\n",""):(void 0===t&&(t=""),s+="string"==typeof t?t.trim():t),n++,s}).join("");return n<=e.length&&(r+=e[e.length-1]),r.replace(Wn,"><").trim()}static repeat(t){return function(...n){return e.tpl(...n).repeat(t)}}static loop(e){}}return e._$name="TemplateHelper",e}(),Yn=/^b-icon-/,qn=/^b-fa-/,Xn=function(){class e extends An{static get defaultConfig(){return{menu:null,icon:null,text:null,checked:null,closeParent:null,localizableProperties:["text"]}}doAction(e){const t=this.parent,n={menu:t,item:this,element:this.element,bubbles:!0};"boolean"==typeof this.checked&&(this.checked=!this.checked),this.trigger("beforeItem",n),this.trigger("item",n),this.closeParent&&t&&(t.rootMenu.close(),e&&!this.href&&e.preventDefault())}doDestroy(){const e=this._menu;e instanceof An&&e.destroy(),super.doDestroy()}template(e){const t=e.icon||("boolean"==typeof e.checked?`b-fw-icon b-icon-${e.checked?"":"un"}checked`:""),n=Yn.test(t)?" b-icon":qn.test(t)?" b-fa":"",r=e.href?"a":"div";return Gn.tpl`
            <${r} ${"a"===r?`href="${e.href}"`:""} ${"a"===r&&e.target?`target="${e.target}"`:""} class="${e.hasMenu?"b-has-submenu":""}" ${e.name?`data-name="${e.name}"`:""} tabIndex="-1">
                ${t?`<i class="b-menuitem-icon ${t}${n}" reference="iconElement"></i>`:""}
                <span class="b-menu-text" reference="textElement">${e.text}</span>
                ${e.hasMenu?'<i class="b-fw-icon b-icon-sub-menu" reference="subMenuIcon"></i>':""}
            </${r}>`}get focusElement(){return this.element}get contentElement(){return this.textElement}get isFocusable(){const e=this.focusElement;return e&&this.isVisible&&(e===document.body||e.offsetParent)}onFocusIn(e){super.onFocusIn(e),!this.disabled&&this.menu&&this.openMenu()}onFocusOut(e){super.onFocusOut(e),this.closeMenu()}openMenu(e){const t=this.menu;!this.disabled&&t&&(t.focusOnToFront=e,t.show(),this.owner.currentSubMenu=t)}closeMenu(){this._menu instanceof An&&this.menu.close()}set checked(e){const t=this,{isConfiguring:n}=t;(n||"boolean"==typeof t._checked)&&(e=!!e)!==t._checked&&(t._checked=e,n||(t.iconElement.classList[e?"add":"remove"]("b-icon-checked"),t.iconElement.classList[e?"remove":"add"]("b-icon-unchecked"),t.trigger("toggle",{menu:t.owner,item:t,checked:t._checked,element:t.element,bubbles:!0})))}get checked(){return this._checked}set menu(e){this._menu=e}get text(){return this.html}set text(e){this.html=e}get menu(){const e=this;let t=e._menu;return!t||t instanceof An||("object"!=typeof t||"items"in t||"widgets"in t||"html"in t||(t={items:t}),t=e.menu=I.createWidget(Object.assign({type:"menu",autoShow:!1,autoClose:!0,scrollAction:e.owner.scrollAction,constrainTo:e.owner.constrainTo,forElement:e.element,align:"l0-r0",anchor:!0,owner:e,cls:"b-sub-menu"},t))),t}set closeParent(e){this._closeParent=e}get closeParent(){return("boolean"==typeof this.checked?this._closeParent:!1!==this._closeParent)&&!this.hasMenu}get hasMenu(){const e=this.isConfiguring?this.initialConfig.menu:this._menu;return e&&(e instanceof An||"object"==typeof e||e.length>0)}}return e._$name="MenuItem",e}();E.register("menuitem",Xn);const Kn={ArrowUp:1,ArrowDown:1,ArrowRight:1,ArrowLeft:1,Enter:1,Escape:1},Zn=function(){class e extends Vn{static get defaultConfig(){return{align:"t-b",scrollAction:"hide",focusOnHover:null,scrollable:!1,defaultType:"menuitem"}}construct(e){Array.isArray(e)&&(e={items:e}),super.construct(e),Kt.on({element:this.element,click:"onMouseClick",mouseover:"onMouseOver",mouseleave:"onMouseLeave",thisObj:this})}afterShow(e){this.items.some(e=>Boolean(e._menu))&&this.element.classList.add("b-menu-with-submenu"),this.items.some(e=>e.icon)&&this.element.classList.add("b-menu-with-icon"),super.afterShow(e)}createWidget(e){return"string"==typeof e&&(e={text:e}),super.createWidget(e)}get focusElement(){return this.parentMenu&&this.parentMenu.element.contains(document.activeElement)||!(this.items[0]instanceof Xn)?super.focusElement:this.element}onDocumentMouseDown(e){this.parentMenu&&this.parentMenu.owns(e.event.target)||super.onDocumentMouseDown(e)}hide(e){this.currentSubMenu&&this.currentSubMenu.hide(e),super.hide(e),this.parentMenu&&(this.parentMenu.currentSubMenu=null)}onMouseClick(e){const t=e.target.closest(".b-menuitem");t&&(this.triggerElement(t,e),e.stopImmediatePropagation())}onMouseOver(e){if(!1!==this.focusOnHover){const t=yt.up(e.relatedTarget,".b-widget"),n=yt.up(e.target,".b-widget"),r=k.fromElement(n);!yt.isTouchEvent&&n&&n!==t&&r.parent===this&&r&&r.focus()}}onMouseLeave(e){const t=this,{relatedTarget:n}=e,r=n&&t.owns(n);let s=n&&n instanceof HTMLElement&&k.fromElement(n),i=!r;if(s){for(;s.ownerCmp;)s=s.ownerCmp;i&=!yt.getAncestor(s.element,[e.target])}!r&&i&&(t.currentSubMenu&&t.currentSubMenu.hide(),t.currentSubMenu=t.selectedElement=null,t.element.contains(document.activeElement)&&document.activeElement.matches(".b-menuitem")&&t.element.focus())}onInternalKeyDown(e){const t=k.fromElement(e),n=t&&t!==this&&!(t instanceof Xn);if("Escape"===e.key)return void(n?this:this.rootMenu).close();if(super.onInternalKeyDown(e),n)return;Kn[e.key]&&e.preventDefault();const r=document.activeElement,s=this.element;this.navigateFrom(r!==s&&s.contains(r)?r:null,e.key,e)}navigateFrom(e,t,n){const r=this,s=r.treeWalker,i=e&&r.getItemFromElement(e);let o;switch(t){case"ArrowUp":s.currentNode=e||(e=r.bottomFocusTrap),s.previousNode(),o=s.currentNode;break;case"ArrowDown":s.currentNode=e||(e=r.topFocusTrap),s.nextNode(),o=s.currentNode;break;case" ":e&&!e.classList.contains("b-disabled")&&(i&&i.menu?r.openSubMenu(e,i):r.triggerElement(e,n));break;case"ArrowRight":if(e&&i&&i.menu&&!e.classList.contains("b-disabled")){const t=r.openSubMenu(e,i);t&&t.focus()}else s.currentNode=e||(e=r.topFocusTrap),s.nextNode(),o=s.currentNode;break;case"ArrowLeft":r.isSubMenu?r.hide():e||(s.currentNode=e||(e=r.topFocusTrap),s.nextNode(),o=s.currentNode);break;case"Enter":e&&!e.classList.contains("b-disabled")&&r.triggerElement(e,n)}o&&(o===r.element?r.navigateFrom(r.bottomFocusTrap,"ArrowUp",n):o===e?r.navigateFrom(r.topFocusTrap,"ArrowDown",n):o.focus())}getItemFromElement(e){return k.fromElement(e,"menuitem",this.contentElement)}triggerElement(e,t){const n=this.getItemFromElement(e);n&&!n.disabled&&n.doAction(t)}get isSubMenu(){return this.owner&&this===this.owner.menu}openSubMenu(e,t){const n=this,r=t.menu;if(r){if(!r.isVisible){const s={item:t,element:e};if(!1===n.trigger("beforeSubMenu",s))return;if(t.onBeforeSubMenu&&!1===t.onBeforeSubMenu(s))return;r.show()}return n.currentSubMenu=r}}set selectedElement(e){const t=this,n=t._selectedElement;if(n){const e=t.getItemFromElement(n),r=e&&e.menu;r&&r.hide(),n.classList.remove("b-active")}if(t._selectedElement=e,e){const n=yt.isFocusable(e);e.classList.add("b-active"),t.scrollable.scrollIntoView(e,{animate:!n,focus:n})}}get selectedElement(){return this._selectedElement}selectFirst(){const e=this.treeWalker;e.currentNode=this.topFocusTrap,e.nextNode(),this.requestAnimationFrame(()=>e.currentNode.focus())}get parentMenu(){let t=this.owner;if(t instanceof Xn&&(t=t.owner),t instanceof e)return t}get rootMenu(){let e=this;for(;e.parentMenu&&e.parentMenu instanceof this.constructor;)e=e.parentMenu;return e}}return e._$name="Menu",e}();E.register("menu",Zn);const Jn=function(){class e extends An{static get defaultConfig(){return{floating:!0,timeout:2500,showProgress:!0,color:null,bottomMargin:20}}doDestroy(){const t=e.toasts.indexOf(this);t>-1&&e.toasts.splice(t,1),super.doDestroy()}set element(e){}get element(){if(!this._element&&!this.isConfiguring){const t=this,n=e.toasts.length&&e.toasts[0].element,r=n?n._nextBottom:t.bottomMargin,s=super.element=yt.createElement({parent:t.appendTo||An.floatRoot,children:t.showProgress?[{className:"b-toast-progress",style:`animation-duration:${t.timeout/1e3}s;`}]:null,html:t._html,className:t.color||"",style:t._style||""});Kt.on({element:s,click:"hide",thisObj:t}),e.toasts.unshift(t),s._nextBottom=r+s.offsetHeight+t.bottomMargin,s.style.cssText+=`;bottom:${r}px;transform:translateY(0)`}return super.element}show(){super.show(),this.timeout>0&&(this.hideTimeout=this.setTimeout("hide",this.timeout))}hide(){const e=this;e.destroyTimeout||(e.element.classList.add("b-toast-hide"),e.element.style.bottom="",e.animationTimeout=e.setTimeout("destroy",200))}static hideAll(){e.toasts.reverse().forEach(e=>e.hide())}static show(t){const n=new e("string"==typeof t?{html:t}:t);return n.show(),n}}return e.toasts=[],e._$name="Toast",e}();E.register("toast",Jn);const Qn={left:!0,right:!0,top:!0,bottom:!0,transform:!0},er=function(){class e extends Vn{static get defaultConfig(){return{mouseOffsetX:15,mouseOffsetY:15,floating:!0,getHtml:null,forElement:null,trackMouse:null,forSelector:null,hideOnDelegateChange:null,anchorToTarget:!0,showOnHover:!1,hoverDelay:500,autoShow:!1,dismissDelay:0,hideDelay:500,loadingMsg:"Loading...",allowOver:!1,textContent:!1,anchor:!0,align:"b-t",axisLock:!0,showAnimation:null,hideAnimation:null}}afterConstruct(){const e=this,{forSelector:t}=e;t&&(e.showOnHover=!0,e.forElement||(e.trackMouse=!0,e.forElement=document.body)),super.afterConstruct(),e.forElement&&e.showOnHover&&Kt.on({element:e.forElement,mouseover:"internalOnPointerOver",mouseout:"onPointerOut",transitionend:"onTransitionEnd",thisObj:e}),e.autoShow&&e.show(),e.allowOver&&Kt.on({element:e.element,mouseenter:"onOwnElementMouseEnter",mouseleave:"onPointerOut",thisObj:e})}get focusElement(){const e=super.focusElement;if(e!==this.element)return e}get anchorToTarget(){return this._anchorToTarget}set anchorToTarget(e){this._anchorToTarget=e,e||(this.anchor=!1)}set trackMouse(e){this._trackMouse=e}get trackMouse(){return this._trackMouse&&!this.anchorToTarget}internalOnPointerOver(e){const t=this,n=t.forElement,r=t.forSelector,s=t.activeTarget;let i;if(!(t.disabled||t.allowOver&&t.element.contains(e.target))){if(r){if(s&&s.contains(e.target)&&s.contains(e.relatedTarget))return;if((i=e.target.closest(r))&&e.relatedTarget&&e.relatedTarget.closest(r)===i)return}else{if(n.contains(e.relatedTarget))return;i=n}i?t.handleForElementOver(e,i):s&&t.handleForElementOut()}}onTransitionEnd(t){const n=this,r=e.currentOverElement;if(Qn[t.propertyName]){if(n.allowOver&&n.element.contains(r))return;n.isVisible&&n.activeTarget.contains(r)&&!n.trackMouse&&n.realign()}}handleForElementOver(e,t){const n=this;if(!1===n.trigger("pointerOver",{event:e,target:t}))n.onPointerOut(e);else if(n.pointerEvent=e,n.abortDelayedHide(),n.isVisible&&!n.hideOnDelegateChange){if(n.updateActiveTarget(t),!1===n.trigger("beforeShow"))return n.hide();n.alignTo({target:n.anchorToTarget?t:new It(n.pointerEvent.pageX-window.pageXOffset+n.mouseOffsetX,n.pointerEvent.pageY-window.pageYOffset+n.mouseOffsetY),overlap:!(n.anchorToTarget&&n.anchor)}),n.trigger("show"),n.afterShowByTarget()}else n.hideOnDelegateChange&&n.hide(),n.updateActiveTarget(t),n.delayShow(t)}delayShow(e){const t=this;t.currentAnimation&&(t.cancelHideShowAnimation(),t._hidden=!0),t.isVisible||t.hasTimeout("show")?t.isVisible&&t.showByTarget(e):!t.hoverDelay||t.forSelector&&Date.now()-t.lastHidden<t.quickShowInterval?t.showByTarget(e):(t.listeningForMouseMove||t.anchorToTarget||(t.mouseMoveRemover=Kt.on({element:document,mousemove:"onMouseMove",thisObj:t})),t.setTimeout(()=>t.showByTarget(e),t.pointerEvent&&"mouseover"!==t.pointerEvent.type?0:t.hoverDelay,"show"))}showByTarget(e){const t=this;t.mouseMoveRemover&&(t.mouseMoveRemover(),t.mouseMoveRemover=null),t.showBy({target:t.anchorToTarget?e:new It(t.pointerEvent.pageX-window.pageXOffset+t.mouseOffsetX,t.pointerEvent.pageY-window.pageYOffset+t.mouseOffsetY),overlap:!(t.anchorToTarget&&t.anchor)})}afterShowByTarget(){const e=this.dismissDelay;this.abortDelayedShow(),e&&this.setTimeout("hide",e),this.toFront()}updateActiveTarget(e){const t=this.activeTarget;this.activeTarget=e,this.isConfiguring||this.trigger("overtarget",{newTarget:e,lastTarget:t})}onPointerOut(e){const t=this,n=e.relatedTarget;t.allowOver&&t.element.contains(n)||t.element.contains(e.target)&&t.activeTarget&&t.activeTarget.contains(n)||t.activeTarget&&!t.activeTarget.contains(e.relatedTarget)&&t.handleForElementOut()}handleForElementOut(){const e=this,{hideDelay:t}=e;e.abortDelayedShow(),e.isVisible&&!1!==t&&(e.abortDelayedHide(),t>0?e.setTimeout("hide",t):e.hide())}show(){const e=this;e.forElement&&e.anchorToTarget&&!e.forSelector&&!e.inShowBy?e.showByTarget(e.forElement):(e.inShowBy&&(e.y=-1e4),super.show()),e.afterShowByTarget(),e.mouseMoveRemover||e._hidden||!e.trackMouse||(e.mouseMoveRemover=Kt.on({element:document,mousemove:"onMouseMove",thisObj:e}))}hide(...e){const t=this;t.isVisible&&(t.abortDelayedShow(),t.abortDelayedHide(),super.hide(...e),t.lastHidden=Date.now(),t.activeTarget=null,t.mouseMoveRemover&&(t.mouseMoveRemover(),t.mouseMoveRemover=null),t.listeningForMouseMove=!1)}abortDelayedShow(){const e=this;e.hasTimeout("show")&&(e.clearTimeout("show"),e.mouseMoveRemover&&(e.mouseMoveRemover(),e.mouseMoveRemover=null))}abortDelayedHide(){this.clearTimeout("hide")}realign(e){const t=this,n=t.lastAlignSpec,r=t.clippedBy;!t.isConfiguring&&r&&!t.isVisible&&n.targetHidden&&oe.from(n.target,t.positioned?t.element.offsetParent:null,!t.positioned).intersect(r)&&(t.show(),n.targetHidden=!1),super.realign(e)}alignTo(e){const t=this;if(t.isVisible){if(t.getHtml&&(!t.pointerEvent||!t.element.contains(t.pointerEvent.target))){1===e.nodeType&&(e={target:e});const n=e instanceof It?e:e.position||(1===e.target.nodeType?oe.from(e.target):e.target);t.isAligning=!0,t.html=t.getHtml({tip:t,element:t.element,forElement:t.activeTarget,x:n.x,y:n.y,event:t.pointerEvent}),t.isAligning=!1}t.isVisible&&super.alignTo(e)}}set textContent(e){this._textContent=e,this.element.classList[e?"add":"remove"]("b-tooltip-text-content")}get textContent(){return this._textContent}set html(e){const t=this;if(!1===e?e=`<div class="b-tooltip-loading"><div class="b-icon b-icon-spinner"></div>${t.L(t.loadingMsg)}</div>`:null!=e&&(e=String(e)),e){let n=t.getHtml;t.getHtml=null,super.html=e,t.isAligning||t.realign(),t.getHtml=n,t.trigger("innerHtmlUpdate")}else t.hide()}get html(){return super.html}onMouseMove(e){const t=this,n=e.pageX-window.pageXOffset+t.mouseOffsetX,r=e.pageY-window.pageYOffset+t.mouseOffsetY,s=t.hasTimeout("hide"),i=e.target;t.pointerEvent=e,t._hidden||(!t.forSelector||s||1!==i.nodeType||i.matches(t.forSelector)||t.allowOver&&t.element.contains(i)?s&&!t.forElement.contains(i)||(t.dismissDelay&&!s&&t.setTimeout("hide",t.dismissDelay),t.trackMouse&&t.alignTo({position:new It(n,r),ignorePageScroll:!0})):t.handleForElementOut())}onOwnElementMouseEnter(e){this.abortDelayedHide()}}return e._$name="Tooltip",e}();Kt.on({element:document,mouseenter:e=>er.currentOverElement=e.target,capture:!0}),E.register("tooltip",er);var tr=e=>(class extends(e||W){construct(e){super.construct(e),this._badge&&(this.badge=this._badge)}set badge(e){const{element:t}=this;this._badge=e,t&&(null!=e&&""!==e?(t.dataset.badge=e,t.classList.add("b-badge")):(t.dataset.badge&&delete t.dataset.badge,t.classList.remove("b-badge")))}get badge(){return this._badge}get widgetClass(){if(this.badge)return"b-badge"}});const nr=/^b-icon-/,rr=/^b-fa-/,sr=function(){class e extends(tr(An)){static get defaultConfig(){return{icon:null,pressedIcon:null,iconAlign:"start",text:"",color:null,toggleable:!1,pressed:!1,toggleGroup:null,ripple:{radius:75},defaultBindProperty:"text",localizableProperties:["text"],menu:null}}template(){const e=this;return Gn.tpl`
            <button class="${e.color||""} ${e.toggleable&&e.pressed?"b-pressed":""}" ${e.toggleGroup?`data-group="${e.toggleGroup}"`:""}>
                \xa0
            </button>
        `}construct(e={},...t){e.toggleGroup&&(e.toggleable=!0),super.construct(e,...t),Kt.on({element:this.element,click:"onInternalClick",thisObj:this})}doDestroy(){this.destroyProperties("menu"),super.doDestroy()}get focusElement(){return this.element}get text(){return this._text}set text(e){const{element:t}=this;null==e&&(e=""),t.lastChild.data=this._text=e,t.classList[e?"add":"remove"]("b-text")}get menu(){const e=this;let t=e._menu;return!t||t instanceof An||("object"!=typeof t||"items"in t||"widgets"in t||"html"in t||(t={items:t}),t=e.menu=I.createWidget(Object.assign({type:"menu",autoShow:!1,autoClose:!0,scrollAction:"realign",constrainTo:document.body,forElement:e.element,align:"t0-b0",owner:e,onHide(){e.setTimeout(()=>e.toggle(!1),300)}},t))),t}set menu(e){this._menu=e,this.toggleable=Boolean(e)}set pressed(e){const t=this;e&&t.toggleGroup&&yt.forEachSelector(`button[data-group=${t.toggleGroup}]`,e=>{e!==t.element&&I.getById(e.id).toggle(!1)}),t._pressed=e,t.element&&t.element.classList[e?"add":"remove"]("b-pressed")}get pressed(){return this._pressed}set icon(e){this._icon=e,this.syncIconCls()}get icon(){return this._icon}set pressedIcon(e){this._pressedIcon=e,this.syncIconCls()}get pressedIcon(){return this._pressedIcon}set iconAlign(e){const t=this._iconAlign;e!==t&&(t&&this.element.classList.remove(`b-icon-align-${t}`),this.element.classList.add(`b-icon-align-${e}`),this._iconAlign=e)}get iconAlign(){return this._iconAlign}onInternalClick(e){const t=this,n={event:e};if(t.toggleable){if(t.toggleGroup&&t.pressed)return;t.toggle(!t.pressed)}t.trigger("click",n),t.isDestroyed||t.trigger("action",n),e.preventDefault(),e.stopPropagation()}toggle(e=null){const t=this,{menu:n}=t;t.toggleable&&(null===e&&(e=!t.pressed),t.pressed=e,t.toggling=!0,n&&(n.minWidth=t.width,n[e?"show":"hide"]()),t.syncIconCls(),t.trigger("toggle",{pressed:e}),t.toggling=!1)}syncIconCls(){const e=this;let t=e._iconEl;if(e.icon){t||(t=e._iconEl=yt.createElement({tag:"i",nextSibling:e.element.firstChild}));const n=e.pressed&&e.pressedIcon?e.pressedIcon:e.icon;e._iconEl.className=n,nr.test(n)?t.classList.add("b-icon"):rr.test(n)&&t.classList.add("b-fa")}else t&&t.remove()}}return e._$name="Button",e}();E.register("button",sr),E.register("buttonGroup",function(){class e extends $n{static get defaultConfig(){return{defaultType:"button",cls:null,items:null,color:null,toggleGroup:null}}createWidget(e){const t=this;t.color&&!e.color&&(e.color=t.color),t.toggleGroup&&!e.toggleGroup&&("boolean"==typeof t.toggleGroup&&(t.toggleGroup=k.generateId("toggleGroup")),e.toggleGroup=t.toggleGroup);const n=super.createWidget(e);if(!(n instanceof sr))throw new Error("A ButtonGroup can only contain buttons");return n}}return e._$name="ButtonGroup",e}());const ir=function(){class e extends(U(W)){static get defaultConfig(){return{element:null,delegate:null,delay:500,startRate:2,endRate:20,accelerateDuration:4e3}}doDestroy(){this.mousedownRemover&&this.mousedownRemover(),super.doDestroy()}set element(e){this._element=e,this.mousedownRemover=Kt.on({element:e,mousedown:"onMouseDown",thisObj:this})}get element(){return this._element}onMouseDown(e){const t=this,n=t.delegate?e.target.closest(t.delegate):t.element;n&&(t.triggerEvent=e,Kt.lockComposedPath(t.triggerEvent),t.activeListenerRemover=Kt.on({mouseup:{element:document,handler:"onMouseUp"},mousemove:{element:n,handler:"onTargetMouseMove"},mouseleave:{element:n,handler:"onTargetMouseLeave"},mouseenter:{element:n,handler:"onTargetMouseEnter"},thisObj:t}),t.setTimeout("startAutoRepeat",t.delay))}onMouseUp(e){const t=this;t.acceleration&&t.acceleration.cancel(),t.activeListenerRemover&&t.activeListenerRemover(),t.clearTimeout("startAutoRepeat"),t.clearInterval(t.repeatTimer)}onTargetMouseLeave(){this.clearInterval(this.repeatTimer)}onTargetMouseEnter(e){this.triggerEvent=e,this.fireClick()}onTargetMouseMove(e){this.triggerEvent=e}startAutoRepeat(){const e=this;e.interval=e.startInterval=1e3/e.startRate,e.accelerationDelta=e.startInterval-1e3/e.endRate,e.fireClick(),e.acceleration=At.animate(e.accelerateDuration,e.nextTick,e,"easeOutQuad")}nextTick(e){this.interval=this.startInterval-this.accelerationDelta*e}fireClick(){const e=this,t=new MouseEvent("click",e.triggerEvent);e.triggerEvent.target.dispatchEvent(t),e.repeatTimer=e.setTimeout(e.fireClick,e.interval)}}return e._$name="ClickRepeater",e}(),or=(e,t)=>(e.weight||0)-(t.weight||0),ar=(e,t)=>(t.weight||0)-(e.weight||0),lr={array:!0},cr=function(){class e extends(tr(An)){static get defaultConfig(){return{placeholder:"",value:"",label:null,required:null,clearable:null,labelWidth:null,inputWidth:null,keyStrokeChangeDelay:0,readOnly:null,editable:!0,defaultAction:"change",triggers:null,highlightExternalChange:!0,localizableProperties:["label","title"],autoSelect:!1,autoComplete:"off"}}doDestroy(){const t=e._errorTip;super.doDestroy(),t&&t.field===this&&t.hide()}get errorTip(){return this.constructor.errorTip}static get errorTip(){return e._errorTip||(e._errorTip=new er({cls:"b-field-error-tip",forSelector:".b-field.b-invalid .b-field-inner",align:"l-r",scrollAction:"realign",onBeforeShow(){const e=this,t=k.fromElement(e.activeTarget);if(t){const n=t.getErrors();if(n)return e.html=n.join("<br>"),e.field=t,!0}return!1}}))}construct(e){const t=this;t.highlightChanged=t.createOnFrame("addUpdatedCls"),super.construct(e),t.keyStrokeChangeDelay&&(t.changeOnKeyStroke=t.buffer(t.internalOnChange,t.keyStrokeChangeDelay))}onFocusOut(e){super.onFocusOut(e),this.onEditComplete()}onEditComplete(){}set element(e){const t=this,n=t.initialConfig.value,r=yt.createElementFromTemplate(t.inputTemplate(t),lr),s=[{className:"b-field-inner",reference:"inputWrap",children:r}],i=[],o=[];t.label&&s.unshift({tag:"label",reference:"labelElement",htmlFor:`${t.id}_input`,html:t.label}),t._thisIsAUsedExpression(t.clearable);for(const a in t.triggers){const e=t.triggers[a];"start"===e.align?i.unshift(e):o.push(e)}i.sort(or),o.sort(ar),r.unshift(...i.map(e=>e.element)),r.push(...o.map(e=>e.element)),super.element={className:t.label?"b-has-label":"",children:s},null!=n&&(t.value=n),t.updateEmpty(),t.updateInvalid()}get element(){return super.element}get focusElement(){return this.input}select(e,t){const n=this.focusElement;if(n.value.length){if(0===arguments.length)return void this.selectAll();if(!this.supportsTextSelection)return;G.isIE11?(n.focus(),n.setSelectionRange(e,t)):n.setSelectionRange(e,t)}}moveCaretToEnd(){const e=this.input;if(e.createTextRange){const t=e.createTextRange();t.collapse(!1),t.select()}else this.supportsTextSelection&&this.select(e.value.length,e.value.length)}selectAll(){this.focusElement.select()}updateEmpty(){const{isEmptyInput:e,isEmpty:t,element:n,clearIcon:r}=this,s=e&&t;n&&(r&&r.classList[s?"add":"remove"]("b-icon-hidden"),n.classList[s?"add":"remove"]("b-empty"))}updateInvalid(){const{isValid:e,element:t,errorTip:n,inputWrap:r}=this;t&&(t.classList[e?"remove":"add"]("b-invalid"),e?n.isVisible&&n.field===this&&n.hide():r.contains(er.currentOverElement)&&(n.activeTarget===r&&n.isVisible?n.onBeforeShow():(n.activeTarget=r,n.showBy(r))))}get editable(){return this._editable&&!this.readOnly}set editable(e){const t=this,n=t.input;t._editable=e,n&&(t.readOnly||(n.readOnly=!1===e?"readOnly":null),!1!==e?t.inputListenerRemover=Kt.on({element:n,thisObj:t,focus:"internalOnInputFocus",change:"internalOnChange",input:"internalOnInput",keydown:"internalOnKeyPress",keypress:"internalOnKeyPress",keyup:"internalOnKeyPress"}):t.inputListenerRemover&&t.inputListenerRemover())}set clearable(e){this._clearable=e,e&&!this.triggers&&(this.triggers={})}get clearable(){return this._clearable}set triggers(e){const t=this,n=t._triggers={};t.clearable&&((e||(e={})).clear={cls:"b-icon-remove",handler(){t._isUserAction=!0,t.clear(),t._isUserAction=!1},weight:1e3});for(const r in e)n[r]=I.createWidget(We.assign({type:"trigger",reference:r,parent:t},e[r]),t.defaultTriggerType||"trigger")}get triggers(){return this._triggers}set labelWidth(e){this.labelElement&&(this.labelElement.style.flex=`0 0 ${yt.setLength(e)}`,this.inputWrap.style.flexBasis=null==e?"":0)}get label(){return this._label}set label(e){null==e&&(e=""),this._label=e,this.labelElement&&(this.labelElement.innerHTML=e)}get readOnly(){return this._readOnly||this.disabled}set readOnly(e){this._readOnly=e,this.element.classList[e?"add":"remove"]("b-readonly"),e?this.input.setAttribute("readonly",""):this.input.removeAttribute("readonly")}get isValid(){return(!this.errors||!We.getTruthyValues(this.errors).length)&&(!this.input||!this.input.validity||this.input.validity.valid)}get isEmpty(){return null==this.value||""===this.value}get isEmptyInput(){return!this.input||null==this.input.value||""===this.input.value}get value(){return this._value}set value(e){const t=this,n=t._value;t.hasChanged(n,e)&&(t.inputting||(t._lastValue=e),t._value=e,!t.required||""!=e&&null!=e?t.clearError("fieldRequired",!0):t.setError("fieldRequired",!0),t.isConfiguring||t.inputting||t.trigger("change",{value:t.value,oldValue:n,userAction:Boolean(t._isUserAction),valid:t.isValid}),t.syncInputFieldValue())}hasChanged(e,t){return t!==e}syncInputFieldValue(){const e=this,t=e.input;t&&!e.inputting&&(e.input.value=e.inputValue,e.isConfiguring||e.containsFocus||!e.highlightExternalChange||(t.classList.remove("b-field-updated"),e.clearTimeout("removeUpdatedCls"),e.highlightChanged())),e.updateEmpty(),e.updateInvalid()}addUpdatedCls(){this.input.classList.add("b-field-updated"),this.setTimeout("removeUpdatedCls",1500)}removeUpdatedCls(){this.input.classList.remove("b-field-updated")}get inputValue(){return null==this.value?"":this.value}get supportsTextSelection(){const e=this.focusElement;return e&&("textarea"===e.tagName.toLowerCase()||e.type&&(/text|search|password|tel|url/.test(e.type)||G.isEdge))}internalOnInputFocus(){const e=this.input.value.length;G.isIE11&&e&&!this.autoSelect&&this.select(e,e)}internalOnChange(e){const t=this,n=t.value,r=t._lastValue;t.isValid&&n!==r&&(t._lastValue=n,t.trigger("change",{value:n,oldValue:r,event:e,userAction:!0}),"change"===t.defaultAction&&t.trigger("action",{value:n,oldValue:r,event:e}))}internalOnInput(e){const t=this;t.inputting=!0,t.value=t.input.value,t.inputting=!1,t.trigger("input",{value:t.value,event:e}),t.changeOnKeyStroke&&t.changeOnKeyStroke(e)}internalOnKeyPress(e){const t=this;if("keydown"===e.type)if("Escape"===e.key&&!t.readOnly&&t.clearable){if(t.clear(),t.isDestroyed)return void e.stopImmediatePropagation()}else"Enter"===e.key&&G.isIE11&&this.internalOnChange(e);t.trigger(e.type,{event:e})}clear(){this.value=null,this.trigger("clear")}setError(e,t){(this.errors||(this.errors={}))[e]=this.L(e),t||this.updateInvalid()}clearError(e,t){this.errors&&delete this.errors[e],t||this.updateInvalid()}getErrors(){if(!this.isValid){const e=this.errors?We.getTruthyValues(this.errors):[this.input.validationMessage||this.L("invalidValue")];if(e&&e.length)return e}}}return e.Trigger=class extends An{static get defaultConfig(){return{align:null}}template(){return`<div class="b-icon b-align-${this.align||"end"}"></div>`}construct(e){super.construct(e),Kt.on({element:this.element,click:{handler:"onClick",thisObj:this},mousedown:{handler:"onMousedown",thisObj:this}})}onClick(e){const t=this,n=t.field,r="function"==typeof t.handler?t.handler:n[t.handler];n.disabled||n.readOnly||r&&!1!==n.trigger("trigger",{trigger:t})&&r.call(n,e)}onMousedown(e){const t=this.field;!("key"in e)&&yt.isTouchEvent&&t.editable&&(t.editable=!1,t.setTimeout(()=>t.editable=!0,500)),e.preventDefault(),document.activeElement!==t.input&&t.focus()}get field(){return this.parent}},e.SpinTrigger=class extends e.Trigger{static get defaultConfig(){return{repeat:!0}}template(){return`<div class="b-icon b-align-${this.align||"end"}">\n                    <div reference="upButton" class="b-icon b-spin-up"></div>\n                    <div reference="downButton" class="b-icon b-spin-down"></div>\n                </div>`}set repeat(e){const t=this;e?t.clickRepeater=new ir(Object.assign({element:t.element},e)):t.clickrepeater&&(t.clickRepeater.destroy(),t.clickrepeater=null)}onClick(e){const t=this.field;t.disabled||(e.target===this.upButton?t.doSpinUp():e.target===this.downButton&&t.doSpinDown())}},e._$name="Field",e}();cr.Trigger._$name="FieldTrigger",cr.SpinTrigger._$name="SpinTrigger",E.register("trigger",cr.Trigger),E.register("spintrigger",cr.SpinTrigger);const dr=function(){class e extends cr{static get defaultConfig(){return{text:"",color:null,value:"",defaultBindProperty:"value"}}construct(e){super.construct(e),this.initialConfig.readOnly&&(this.readOnly=!0)}inputTemplate(){return Gn.tpl`
            <input type="checkbox" id="${this.id}_input" reference="input"/>
            <label class="b-checkbox-label" for="${this.id}_input" reference="textLabel">${this.text||""}</label>
        `}set element(e){const t=this;super.element=e,t.color&&t.element.classList.add(t.color),t.text&&t.element.classList.add("b-text")}get element(){return super.element}get text(){return this._text}set text(e){this._text=e,this.textLabel&&(this.textLabel.innerHTML=e)}get value(){return this.input.value}set value(e){this.input.value=e}get checked(){return this.input.checked}set checked(e){e=Boolean(e),this.input.checked!==e&&(this.input.checked=e,this.isConfiguring||this.triggerChange(!1))}get readOnly(){return this._readOnly}set readOnly(e){this._readOnly=e,this.element.classList[e?"add":"remove"]("b-readonly"),this.input.disabled=e}check(){this.checked=!0}uncheck(){this.checked=!1}toggle(){this.checked=!this.checked}internalOnChange(e){this.triggerChange(!0)}triggerChange(e){const t=this;!t.callPreventable("change",{checked:t.input.checked,userAction:e},e=>(t.trigger("action",e),!0))&&(t.input.checked=!t.input.checked)}}return e._$name="Checkbox",e}();E.register("checkbox",dr),E.register("check",dr);const ur=function(){class e extends(ge(ue(W))){static get defaultConfig(){return{disabled:!1}}static initPlugins(e,...t){let n=e.plugins||(e.plugins={});for(let r of t)n[r.$name]=new r(e)}construct(e,t){this.client=e,super.construct(t),this.applyPluginConfig(e)}applyPluginConfig(e){let t=this,n=t.pluginConfig||t.constructor.pluginConfig,r=n&&n.assign,s=n&&(n.chain||n.after),i=n&&n.before,o=n&&n.override;t.pluggedInto=e,r&&t.applyAssign(e,r),s&&t.applyChain(e,s),i&&t.applyChain(e,i,!1),o&&t.applyOverride(e,o)}applyAssign(e,t){t.forEach(t=>this.assign(e,t))}applyChain(e,t,n=!0){const r=this;t.forEach(t=>{e[t]?r.chain(e,t,n):r.assign(e,t)})}applyOverride(e,t){const n=this;n.overridden||(n.overridden={}),t.forEach(t=>{if(!n[t])throw new Error(this.L("overrideFnMissing",{plugIntoName:e.$name,pluginName:n.$name,fnName:t}));"function"==typeof e[t]&&(n.overridden[t]=e[t].bind(e)),e[t]=n[t].bind(n)})}assign(e,t){let n=this,r=Object.getOwnPropertyDescriptor(Object.getPrototypeOf(n),t);r&&(r.get||r.set)?Object.defineProperty(e,t,{configurable:!0,enumerable:!0,get:r.get&&r.get.bind(n),set:r.set&&r.set.bind(n)}):e[t]=n[t].bind(n)}chain(e,t,n=!0){let r=this,s=e.pluginFunctionChain||(e.pluginFunctionChain={});if(s[t]||(s[t]=[e[t].bind(e)]),!r[t])throw new Error(this.L("fnMissing",{plugIntoName:e.$name,pluginName:r.$name,fnName:t}));n?s[t].push(r[t].bind(r)):s[t].unshift(r[t].bind(r)),e[t]=((...e)=>r.functionChainRunner(t,...e))}functionChainRunner(e,...t){const n=this.pluggedInto.pluginFunctionChain[e];let r;for(let s=0;s<n.length;s++)if(!1===(r=n[s](...t)))return!1;return r}get disabled(){return this._disabled}set disabled(e){this._disabled=e}}return e._$name="InstancePlugin",e}();var hr=e=>(class extends(e||W){get plugins(){return this._plugins||(this._plugins={}),this._plugins}set plugins(e){e&&(Array.isArray(e)||(e=[e]),ur.initPlugins(this,...e)),this.initPlugins()}initPlugins(){}addPlugins(...e){ur.initPlugins(this,...e)}hasPlugin(e){return null!=this.getPlugin(e)}getPlugin(e){return"function"==typeof e&&(e=e.$name),this.plugins&&this.plugins[e]}get widgetClass(){}}),gr=e=>(class extends(e||W){get state(){return this._state=this.getState(),this._state}set state(e){this._state=e,this.applyState(e)}get widgetClass(){}});const mr=Symbol("STM_PROP");var pr=e=>(class extends(e||W){static get defaultConfig(){return{stm:null}}joinStore(e){super.joinStore&&super.joinStore(e),this.stm||(this.stm=e.stm)}unJoinStore(e){this.stm===e.stm&&(this.stm=null),super.unJoinStore&&super.unJoinStore(e)}get stm(){return this[mr]}set stm(e){this[mr]=e}beforeSet(e,t,n,r){const s=super.beforeSet?super.beforeSet(e,t,n,r):[],i=this.stm;if(i&&!i.disabled){let n,r;"object"==typeof e?[n,r]=Object.keys(e).reduce((t,n)=>(t[0][n]=e[n],t[1][n]=this.get(n),t),[{},{}]):(n={[e]:t},r={[e]:this.get(e)}),s.push([n,r])}return s}afterSet(e,t,n,r,s,i){const o=this.stm;if(o&&!o.disabled){const e=s.pop();if(i){let[t,n]=e,[r,s]=Object.keys(i).reduce((e,r)=>(e[0][r]=t[r],e[1][r]=n[r],e),[{},{}]);o.onModelUpdate(this,r,s)}}super.afterSet&&super.afterSet(e,t,n,r,s,i)}beforeInsertChild(e){const t=super.beforeInsertChild?super.beforeInsertChild(e):[],n=this.stm;return n&&!n.disabled&&t.push(e.reduce((e,t)=>(t.root===this.root&&e.set(t,{parent:t.parent,index:t.parent?t.parentIndex:void 0}),e),new Map)),t}afterInsertChild(e,t,n,r){const s=this.stm;if(s&&!s.disabled){const t=n.pop();r&&s.onModelInsertChild(this,e,r,t)}super.afterInsertChild&&super.afterInsertChild(e,t,n,r)}beforeRemoveChild(e,t){const n=super.beforeRemoveChild?super.beforeRemoveChild(e,t):[],r=this.stm;return!r||r.disabled||t||n.push(e.reduce((e,t)=>(e.set(t,t.parentIndex),e),new Map)),n}afterRemoveChild(e,t,n){const r=this.stm;if(r&&!r.disabled&&!n){const n=t.pop();e&&e.length&&r.onModelRemoveChild(this,e,n)}super.afterRemoveChild&&super.afterRemoveChild(e,t,n)}}),fr=e=>(class extends(e||W){ingestChildren(e,t=this.stores){const n=t[0],r=this.constructor,{inProcessChildren:s}=this;if(!0===e)return!!s||[];if(e){Array.isArray(e)||(e=[e]);let t,s=0,i=e.length,o=[];for(;s<i;s++)t=(t=e[s])instanceof Sr?t:n?n.createRecord(t):new r(t,null,null,!0),o.push(t);return o}}processChildren(e=this.stores){const t=this;t.inProcessChildren=!0;const n=t.ingestChildren(t.data[t.constructor.childrenField],e);n&&(n.length?(!0===t.children&&(t.children=[]),t.appendChild(n)):!0===n&&(t.children=!0)),t.inProcessChildren=!1}ancestorsExpanded(e){const{parent:t}=this;return!t||t.isExpanded(e)&&t.ancestorsExpanded(e)}isExpanded(e){const t=this.instanceMeta(e.id);return t.hasOwnProperty("collapsed")||(t.collapsed=!this.expanded),!t.collapsed}get expanded(){return this.data.expanded}get childLevel(){return this.parent?this.parent.childLevel+1:this.isRoot?-1:0}get isLeaf(){return Boolean(!this.children||this.constructor.convertEmptyParentToLeaf&&!this.children.length&&!this.isRoot)}get isParent(){return!this.isLeaf}get isLoaded(){return this.isParent&&Array.isArray(this.children)}get descendantCount(){return this.getDescendantCount()}get visibleDescendantCount(){return this.getDescendantCount(!0)}getDescendantCount(e=!1,t=this.firstStore){const n=this.children;return!n||!Array.isArray(n)||e&&!this.isExpanded(t)?0:n.reduce((t,n)=>t+n.getDescendantCount(e),n.length)}get allChildren(){const e=this.children;return e?e.reduce((e,t)=>(e.push(t),e.push.apply(e,t.allChildren),e),[]):[]}get firstChild(){const e=this.children;return e&&e.length&&e[0]||null}get lastChild(){const e=this.children;return e&&e.length&&e[e.length-1]||null}get previousSiblingsTotalCount(){let e=this.previousSibling,t=this.parentIndex;for(;e;)t+=e.descendantCount,e=e.previousSibling;return t}get root(){return this.parent&&this.parent.root||this}get parentId(){return this.parent&&!this.parent.isRoot?this.parent.id:null}set parentId(e){const t=this,{parent:n}=t,r=e&&t.firstStore.getById(e);r!==n&&(n||r)&&(t.isBatchUpdating?t.meta.batchChanges.parentId=e:r?r.appendChild(t):t.parent.removeChild(t))}static set parentIdField(e){this._parentIdField=e,Object.defineProperty(this.prototype,e,{set:function(e){this.parentId=e},get:function(){return this.parentId}})}static get parentIdField(){return this._parentIdField||"parentId"}traverse(e,t=!1){const{children:n}=this;t||e.call(this,this);for(let r=0,s=n&&n.length;r<s;r++)n[r].traverse(e)}traverseBefore(e,t=!1){const{children:n}=this;for(let r=0,s=n&&n.length;r<s;r++)n[r].traverse(e);t||e.call(this,this)}traverseWhile(e,t=!1){let n=!0;return t||(n=!1!==e.call(this,this)),n&&this.isLoaded&&(n=this.children.every(t=>t.traverseWhile(e))),n}bubble(e,t=!1){let n=this;for(t||e.call(n,n);n.parent;)e.call(n=n.parent,n)}bubbleWhile(e,t=!1){let n=this,r=!0;for(t||(r=e.call(n,n));r&&n.parent;)r=e.call(n=n.parent,n);return r}contains(e){return e&&"object"==typeof e&&(e=e.id),!this.traverseWhile(t=>t.id!=e)}getTopParent(e){let t;return e?(t=[],this.bubbleWhile(e=>(t.push(e),e.parent&&!e.parent.isRoot))):(t=null,this.bubbleWhile(e=>(e.parent||(t=e),e.parent&&!e.parent.isRoot))),t}appendChild(e,t=!1){return this.insertChild(e,null,t)}insertChild(e,t,n=!1){if("number"==typeof e){const n=e;e=t,t=this.children[n]}const r=this,s=r.isLeaf,i=Array.isArray(e);if(!n&&!r.stores.every(t=>!1!==t.trigger("beforeAdd",{records:e,parent:r})))return null;e=r.ingestChildren(e);const o=t?t.parentIndex:r.children?r.children.length:0,a=r.beforeInsertChild?r.beforeInsertChild(e):void 0,l=r.internalAppendInsert(e,t,n);return r.isLeaf===s||r.root.isLoading||n||r.stores.forEach(e=>{const t={isLeaf:!1};e.trigger("update",{record:r,changes:t}),e.trigger("change",{action:"update",record:r,changes:t})}),r.afterInsertChild&&r.afterInsertChild(o,e,a,l),i||!l?l:l[0]}internalAppendInsert(e,t,n){const r=this,{stores:s,root:i}=r,{firstStore:o}=i,a={};let l,c,d,u;if(t&&t.parent!==r&&(t=null),r.children){const n=r.children,s=t?t.parentIndex:n.length;if(n[c=s]===e[0]||n[c=s-1]===e[0])for(l=!0,d=0;l&&d<e.length;d++)e[d]!==n[c+d]&&(l=!1)}if(l)return e;for(d=0;d<e.length;d++){const t=e[d],n=t.parent;if(a[t.id]=t.root===i,o&&t.traverse(e=>{e.root===i&&(a[e.id]=!0)}),n&&!1===n.removeChild(t,a[t.id]))u||(e=e.slice(),u=!0),e.splice(d--,1);else{const{parentIdField:e}=t.constructor,s=r.isAutoRoot?null:r.id;if(t.parent=r,t.data[e]=s,!r.inProcessChildren&&!r.isLoading){const i={parentId:s},{modified:o}=t.meta,a=n?n.id:null,l={[e]:{value:r.id,oldValue:a}};o[e]===r.id?delete o[e]:"parentId"in o||(o[e]=a),t.afterChange(i,l)}}}if(e.length){const i=r.addToChildren(r.children||(r.children=[]),t,e);r.addToChildren(r.unfilteredChildren,t,e,!0),s.forEach(t=>{t.chained||(e.forEach(e=>{e.instanceMeta(t.id).collapsed=!e.expanded,e.joinStore(t)}),t.onNodeAddChild(r,e,i,a,n))})}return e}removeChild(e,t=!1){const n=this,r=n.isLeaf,{children:s,stores:i}=n;Array.isArray(e)||(e=[e]),e=e.filter(e=>e.parent===n);for(const a of i)if(!a.chained&&!1===a.trigger("beforeRemove",{parent:n,records:e,isMove:t}))return!1;const o=n.beforeRemoveChild?n.beforeRemoveChild(e,t):void 0;for(const a of e){const e=n.removeFromChildren(s,a);n.removeFromChildren(n.unfilteredChildren,a,!0),i.forEach(r=>{r.chained||r.onNodeRemoveChild(n,[a],e,t)}),a.parent=a.parentIndex=a.unfilteredIndex=a.nextSibling=a.previousSibling=null}n.isLeaf!==r&&n.stores.forEach(e=>{const t={isLeaf:!0};e.trigger("update",{record:n,changes:t}),e.trigger("change",{action:"update",record:n,changes:t})}),n.afterRemoveChild&&n.afterRemoveChild(e,o,t)}clearChildren(){const e=this,{children:t,stores:n}=e;t&&(e.children=[],e.unfilteredChildren&&(e.unfilteredChildren=[]),n.forEach(n=>{n.chained||n.onNodeRemoveChild(e,t,0)}))}clear(){const e=this,{stores:t}=e,n=e.children.slice();if(e.isRoot){for(const r of t)if(!r.chained&&!1===r.trigger("beforeRemove",{parent:e,records:n,isMove:!1,removingAll:!0}))return!1;e.children.length=0,t.forEach(e=>{n.forEach(t=>{t.stores.includes(e)&&t.unJoinStore(e),t.parent=t.parentIndex=t.nextSibling=t.previousSibling=null}),e.storage.suspendEvents(),e.storage.clear(),e.storage.resumeEvents(),e.added.clear(),e.modified.clear(),e.trigger("removeAll"),e.trigger("change",{action:"removeall"})})}}updateChildrenIndex(e,t=!1){const n=t?"unfilteredIndex":"parentIndex";let r=null;for(let s=0;s<e.length;s++){const i=e[s];i[n]=s,t||(i.previousSibling=r,r&&(r.nextSibling=i),s===e.length-1&&(i.nextSibling=null),r=i)}}addToChildren(e,t,n,r=!1){if(e){const s=r?"unfilteredIndex":"parentIndex",i=t?t[s]:e.length;return e.splice(i,0,...n),this.updateChildrenIndex(e,r),i}}removeFromChildren(e,t,n=!1){if(e){const r=t[n?"unfilteredIndex":"parentIndex"];return r>-1&&(e.splice(r,1),this.updateChildrenIndex(e,n)),r}}});const vr={children:1,data:1,meta:1},yr={},br=function(e){return e instanceof Date||(e=Ne.parse(e,this.format||this.dateFormat)),e||void 0},Cr=(e,t,n)=>e&&e.isEqual?e.isEqual(t,n):We.isEqual(t,n),wr=()=>{},Sr=function(){class e extends(fr(pr())){static set convertEmptyParentToLeaf(e){this._convertEmptyParentToLeaf=e}static get convertEmptyParentToLeaf(){return this._convertEmptyParentToLeaf}static set idField(e){this._assignedIdField=!0,this._idField=e}static get idField(){return this._idField}static set childrenField(e){this._childrenField=e}static get childrenField(){return this._childrenField||"children"}get indexPath(){const e=[];for(let t=this;t&&!t.isRoot;t=t.parent)e.unshift(t.parentIndex+1);return e}construct(t={},n=null,r=null,s=!1){const i=this,{constructor:o}=i,{fieldMap:a}=o,l=n?Array.isArray(n)?n:[n]:[];if(n=l[0],i.meta=Object.assign({modified:{}},o.metaConfig,r),super.construct(null),s?o.hasOwnProperty("fieldMap")||o.exposeProperties():o.exposeProperties(t),!o.hasOwnProperty("idFieldProcessed")){let e=i.meta.idField;e||(o._assignedIdField?e=o.idField:n&&(e=n.idField)),e&&e!==a.id.dataSource&&o.createFieldDefinition({name:"id",dataSource:e}),o.idFieldProcessed=!0}i._internalId=e._internalIdCounter++,i.stores=[],i.originalData||(i.originalData=t),i.data=n&&n.useRawData?t:o.processData(t),void 0===i.id&&i.setData("id",i.generateId()),i.data[o.childrenField]&&i.processChildren(l),i.generation=0}static processData(e,t=!1){const{fieldMap:n,defaultValues:r}=this;let s,i=Object.assign({},e);if(!t)for(s in r)void 0===i[s]&&(i[s]=r[s]);for(s in n){const r=n[s],{name:o,dataSource:a}=r,l=a!==o&&!We.pathExists(e,a)&&o in e;if(l||r.convert){const n=l?e[o]:e[a];(!t||l&&o in e||!l&&a in e)&&(We.setPath(i,a,r.convert?r.convert(n):n),l&&delete i[o])}}return i}static exposeProperties(e){const t=this,n=t.superclass,r=t.hasOwnProperty("fields")&&t.fields;if(n.exposeProperties&&!n.hasOwnProperty("fieldMap")&&n.exposeProperties(),t.hasOwnProperty("propertiesExposed")||(t.defaultValues=Object.assign({},n.defaultValues,t.hasOwnProperty("defaults")?t.defaults:null),t.fieldMap=Object.setPrototypeOf({},n.fieldMap||yr),t.fieldDataSourceMap=Object.setPrototypeOf({},n.fieldDataSourceMap||yr),t.propertiesExposed=Object.setPrototypeOf({},n.propertiesExposed||yr),t.hasOwnProperty("idField")&&(t.createFieldDefinition({name:"id",dataSource:t.idField}),t.propertiesExposed[t.idField]=!0),r&&r.length&&r.map(t.createFieldDefinition,t)),t.autoExposeFields&&e&&!t.hasOwnProperty("propertiesExposedForData")){for(let n in e)t.propertiesExposed[n]||t.createFieldDefinition({name:n,dataSource:n,fromData:!0});t.propertiesExposedForData=!0}t.exposeRelations()}static createFieldDefinition(e){if(null==e)return;"string"==typeof e&&(e={name:e});const t=this,{propertiesExposed:n,defaultValues:r}=t,{name:s}=e,i=e.dataSource||(e.dataSource=s);return e.hasOwnProperty("persist")||(e.persist=!0),"date"===e.type&&(e.convert=br),t.fieldMap[s]=e,t.fieldDataSourceMap[i]||(t.fieldDataSourceMap[i]=e),-1===i.indexOf(".")?n[i]=!0:(e.complexMapping=!0,n[i.split(".")[0]]=!0),"defaultValue"in e&&(r[i]=e.defaultValue),t.createFieldProperty(s,i,e),e}static createFieldProperty(e,t,n){vr[t]||e in this.prototype||Object.defineProperty(this.prototype,e,{enumerable:!0,get:function(){return this.get(e)},set:n&&n.readOnly?wr:function(t){this.set(e,t)}})}static exposeRelations(){const e=this;e.hasOwnProperty("relationsExposed")||e.relationConfig&&(e.relationsExposed=!0,e.relations=[],e.relationConfig.forEach(t=>{e.relations.push(t);let n=t.relationName;Reflect.ownKeys(e.prototype).includes(n)||Object.defineProperty(e.prototype,n,{enumerable:!0,get:function(){return this.getForeign(n)},set:function(e){this.setForeign(n,e,t)}})}))}static get autoExposeFields(){return!0}static get fields(){return[]}static get internalFields(){const{fieldMap:e}=this;let t=this._internalFields;if(this.hasOwnProperty("fieldMap")&&!t){t=this._internalFields=[];for(let n in e)t.push(e[n])}return t}get fields(){return this.constructor.internalFields||this.constructor.fields}getFieldDefinition(e){return this.constructor.getFieldDefinition(e)}get fieldNames(){return Object.keys(this.data)}static getFieldDefinition(e){return this.fieldMap[e]}getDataSource(e){const t=this.constructor.getFieldDefinition(e);if(t)return t.dataSource||t.name}static processField(e,t){const n=this.fieldMap[e];return n&&n.convert?n.convert(t):t}initRelations(){const e=this;e.constructor.relations&&e.stores.forEach(t=>{t.modelRelations||t.initRelations();const n=[];t.modelRelations&&t.modelRelations.forEach(t=>{n.push({related:e.initRelation(t),config:t})}),t.updateRecordRelationCache(e,n)})}initRelation(e){const t=this.get(e.fieldName),n=void 0!==t&&"string"!=typeof e.store&&e.store.getById(t),r={id:t,placeHolder:!0};return this.meta.relationCache||(this.meta.relationCache={}),this.meta.relationCache[e.relationName]=n||(null!=t?r:null),n}removeRelation(e){this.meta.relationCache[e.relationName]&&(delete this.meta.relationCache[e.relationName],e.nullFieldOnRemove&&this.setData(e.fieldName,null))}getForeign(e){return this.meta.relationCache&&this.meta.relationCache[e]}setForeign(t,n,r){let s=e.asId(n);return this.set(r.fieldName,s)}get(e){const t=this,n=t.meta.batchChanges?Object.assign({},t.data,t.meta.batchChanges):t.data,r=t.constructor.fieldMap[e],s=r?r.dataSource:e;if(s)return r&&r.complexMapping?We.getPath(n,s):s in n?n[s]:n[e]}setData(e,t){const n=this.constructor.fieldMap[e],r=n?n.dataSource:e;r&&We.setPath(this.data,r,t)}syncId(e){const t=this.id;if(t!==e){this.setData("id",e);const n={id:{value:e,oldValue:t}};this.triggerChanges(n,n)}}set(e,t,n=!1,r=!1){const s=this;if(s.isBatchUpdating)return s.inBatchSet(e,t),null;{const i=s.beforeSet?s.beforeSet(e,t,n,r):void 0,o=s.inSet(e,t,n,r);return s.afterSet&&s.afterSet(e,t,n,r,i,o),o}}fieldToKeys(e,t){let n;return"string"!=typeof e?(n={},Reflect.ownKeys(e).forEach(t=>n[t]=e[t])):n={[e]:t},n}inBatchSet(e,t){const n=this.fieldToKeys(e,t);Object.keys(n).forEach(e=>{this.meta.batchChanges[e]=this.constructor.processField(e,n[e])})}inSet(e,t,n,r){const s=this,i=s.constructor.fieldMap,o=s.constructor.prototype,a=s.data,l={},c=s.fieldToKeys(e,t);let d=!1;return n||s.triggerBeforeUpdate(c)?(Object.keys(c).forEach(e=>{let t=i[e],n=t&&t.readOnly,u=t?t.dataSource:e,h=!t&&e in o,g=h?s[u]:We.getPath(a,u),m=s.constructor.processField(e,c[e]),p=c[e]={value:m},f=s.getRelationConfig(e);n||Cr(t,g,m)?delete c[e]:(s.generation++,p.oldValue=g,d=!0,Cr(t,s.meta.modified[e],m)?delete s.meta.modified[e]:(s.meta.modified[e]=g,void 0===p.oldValue&&"oldValue"in p&&delete p.oldValue),l[e]=p,h?s[e]=m:We.setPath(a,u,m),f&&!r&&(s.initRelation(f),s.stores.forEach(e=>e.cacheRelatedRecord(s,m,f.relationName,p.oldValue))))}),d&&s.afterChange(c,l,n),d?l:null):null}afterChange(e,t,n){const r=this;r.stores.forEach(e=>{r.isModified?e.modified.includes(r)||e.added.includes(r)||(e.modified.add(r),e.autoCommit&&e.commit()):e.modified.remove(r)}),n||r.triggerChanges(e,t)}get isModified(){return Boolean(this.meta.modified&&Object.keys(this.meta.modified).length>0)}isFieldModified(e){return this.isModified&&this.meta.modified[e]}getFieldPersistentValue(e){const t=this.getFieldDefinition(e);let n;return t&&!t.persist||(n=this[e],t&&t.serialize&&(n=t.serialize.call(this,n,this))),n}get modifications(){const e=this;if(!e.isModified)return null;const t={};return Object.keys(e.meta.modified).forEach(n=>{const r=e.getFieldPersistentValue(n);void 0!==r&&(t[n]=r)}),t[e.constructor.idField]=e.id,t}get persistableData(){const e=this,t={};return Object.keys(e.data).forEach(n=>{const r=e.getFieldPersistentValue(n);void 0!==r&&(t[n]=r)}),t}get isCommitting(){return Boolean(this.meta.committing)}clearChanges(e=!0,t=!0){const n=this,{meta:r}=n;r.modified={},r.committing=!1,e&&n.stores.forEach(e=>{if(e.modified.remove(n),e.added.remove(n),t){const t=e.collectDescendants(n).all;e.added.remove(t),e.modified.remove(t)}})}get internalId(){return this._internalId}get isPhantom(){return""===this.id||null==this.id||this.hasGeneratedId}get hasGeneratedId(){return this.id&&"string"==typeof this.id&&this.id.startsWith("_generated")}generateId(){return this.constructor.generatedIdIndex||(this.constructor.generatedIdIndex=0),"_generated"+this.$name+ ++this.constructor.generatedIdIndex}static asId(t){return t instanceof e?t.id:t}get json(){return JSON.stringify(this.data)}toJSON(){return this.data}get isBatchUpdating(){return Boolean(this.batching)}beginBatch(){this.batching||(this.batching=0,this.meta.batchChanges={}),this.batching++}endBatch(e=!1){const t=this,{parentIdField:n}=t.constructor;if(t.batching&&(t.batching--,!(t.batching>0||We.isEmpty(t.meta.batchChanges)))){const r=Object.assign({},t.meta.batchChanges);t.meta.batchChanges=null,r[n]&&(t.parentId=r[n],delete r[n]),t.set(r,void 0,e),t.cancelBatch()}}cancelBatch(){this.batching=null,this.meta.batchChanges=null}triggerBeforeUpdate(e){return!this.stores.some(t=>{if(!1===t.trigger("beforeUpdate",{record:this,changes:e}))return!0})}triggerChanges(e,t){this.stores.forEach(n=>n.onModelChange(this,e,t))}copy(e=null){let t,n,r,s=Object.assign({},this.data),i=!0,o=this.constructor.idField;return e&&"object"==typeof e?(t=e.deep,n=e.id,delete e.id):n=e,t&&this.children?(i=!1,s.children=this.children.map(t=>t.copy(e))):(delete s.children,delete s.expanded),n?s[o]=n:null==n&&(s[o]=this.generateId()),(r=i?new this.constructor(s):s).originalInternalId=this.internalId,r}remove(e=!1){const t=this,{parent:n}=this;n?n.removeChild(t):t.stores.length&&(t.meta.specialRow||t.stores.forEach(n=>n.remove(t,e,!1,!0)))}get firstStore(){return this.stores.length>0&&this.stores[0]}getRelationConfig(e){return this.firstStore&&this.firstStore.modelRelations&&this.firstStore.modelRelations.find(t=>t.fieldName===e)}get isValid(){return!0}joinStore(e){const t=this,{stores:n}=t;n.includes(e)||(super.joinStore&&super.joinStore(e),e.register(t),n.push(e),t.isLoaded&&t.children.forEach(t=>t.joinStore(e)),t.initRelations())}unJoinStore(e){const t=this,{stores:n}=t;n.includes(e)&&(e.unregister(t),t.children&&t.children.forEach(t=>t.unJoinStore(e)),n.splice(n.indexOf(e),1),super.unJoinStore&&super.unJoinStore(e),e.uncacheRelatedRecord(t)),n.length||(t.meta.removed=!0)}isPartOfStore(e){return e?e.indexOf(this)>=0:this.stores.length>0}instanceMeta(e){const{meta:t}=this,n=e.id||e;return t.map||(t.map={}),t.map[n]||(t.map[n]={})}}return e._idField="id",e._internalIdCounter=1,e._assignedIdField=!1,e._$name="Model",e}();Sr.exposeProperties();const Dr=e=>({mixes:(...t)=>t.reduce((e,t)=>t(e),e||W)}),Er=function(){class e{constructor(e){const t=this;t.generation=0,t.items=new Set,t.idMap={},t.idProperty="id",e&&(e.idProperty&&(t.idProperty=e.idProperty),e.values&&(t.values=e.values)),t.idProperty=e&&e.idProperty||"id"}get(e){return this.idMap[ln(e)]}get count(){return this.items.size}add(e){Array.isArray(e)||(e=[e]);const t=this,{items:n,idMap:r,idProperty:s}=t,i=e.length;for(let o=0;o<i;o++){const i=e[o],a=ln(i[s]),l=r[a];null==l?(r[a]=i,n.add(i),t.generation++):l!==i&&(r[a]=i,n.delete(l),n.add(i))}}remove(e){Array.isArray(e)||(e=[e]);const{items:t,idMap:n,idProperty:r}=this,s=e.length;for(let i=0;i<s;i++){const s=ln(e[i][r]),o=n[s];null!=o&&(t.delete(o),delete n[s],this.generation++)}}clear(){this.items.clear(),this.idMap={},this.generation++}changeId(e,t){const n=this,{idMap:r,idProperty:s}=n,i=on[typeof e]?e:ln(e[s]),o=n.get(i);if(o){const e=n.get(t);if(e&&o!==e)throw new Error(`Attempt to set item ${i} to already existing member's id ${t}`);o[s]=t,delete r[i],r[t]=o}}includes(e){const t=on[typeof e]?e:ln(e[this.idProperty]);return Boolean(this.idMap[t])}map(e,t){const{items:n}=this,r=new Array(n.size);return n.forEach(s=>r[0]=e.call(t,s,0,n)),r}forEach(e,t){return this.items.forEach(e,t)}find(e){for(const t of this.items)if(e(t))return t}[Symbol.iterator](){return this.items[Symbol.iterator]()}get values(){return[...this.items]}set values(e){const{generation:t}=this;this.clear(),this.add(e),this.generation=t+1}}return e._$name="Bag",e}();var xr=e=>(class extends(e||W){static get defaultConfig(){return{autoCommit:!1}}remove(e,t=!1,n){const r=this,{storage:s}=r;if((e=(Array.isArray(e)?e:[e]).reduce((e,t)=>((t=r.getById(t))&&e.push(t),e),[])).length){if(r.tree){const t=e.reduce((e,t)=>{const n=t.parent;return n&&(e[n.id]||(e[n.id]=[n,[]]),e[n.id][1].push(t)),e},{});for(const e of Object.values(t))e[0].removeChild(e[1],!1,n);return e}if(r.isGrouped){const t=s.count,n=[],i=new Set;for(const s of e){const{groupParent:e}=s.instanceMeta(r);e&&e.meta.collapsed&&n.push(s),le.remove(e.groupChildren,s),e.meta.childCount--,i.add(e)}for(const e of i)r.onModelChange(e,{},{});n.length&&s.trigger("change",{action:"splice",removed:n,added:[],replaced:[],oldCount:t})}if(!e.length||!t&&!1===r.trigger("beforeRemove",{records:e}))return null;t&&r.suspendEvents(),s.remove(e),t&&r.resumeEvents(),r.autoCommit&&r.commit()}return e}clear(e=!0){const t=this,{storage:n}=t;if(t.storage.totalCount){if(e&&!1===t.trigger("beforeRemove",{records:n.allValues,removingAll:!0}))return null;if(!e){const e=t.registeredRecords;for(let n,r=e.length-1;r>=0;r--)(n=e[r])&&!n.isDestroyed&&n.unJoinStore(t);t.removed.clear()}e||n.suspendEvents(),n.clear(),e||n.resumeEvents(),t.added.clear(),t.modified.clear()}}removeAll(e){const t=this,n=t.storage;if(e){n.suspendEvents();const e=t.registeredRecords;for(let n,r=e.length-1;r>=0;r--)(n=e[r])&&!n.isDestroyed&&n.unJoinStore(t)}t.tree?t.rootNode.clear():t.clear(),e&&n.resumeEvents()}add(e,t=!1){const n=this,r=n.storage,s=[];if(Array.isArray(e)){if(!e.length)return}else e=[e];return n.tree=n.tree||Boolean(n.autoTree&&e[0].children),n.tree?n.rootNode.appendChild(e,t):t||!1!==n.trigger("beforeAdd",{records:e})?(e.forEach(e=>{s.push(e instanceof Sr?e:n.createRecord(e))}),t&&n.suspendEvents(),r.add(s),t&&n.resumeEvents(),n.autoCommit&&n.commit(),s):null}insert(e,t,n=!1){const r=this,s=r.storage,i=[],o=r.getAt(e),a=s.values,l=[];if(Array.isArray(t)||(t=[t]),!1===r.trigger("beforeAdd",{records:t}))return null;let c,d,u;if(a[d=e]===t[0]||a[d=e-1]===t[0])for(c=!0,u=0;c&&u<t.length;u++)t[u]!==a[d+u]&&(c=!1);if(!c){if(t.forEach(t=>{let n=t instanceof Sr?t:r.createRecord(t),a=s.indexOf(n);n.children&&n.children.length&&r.autoTree&&(r.tree=!0),i.push(n),a>-1&&(a<e&&o&&e--,l.push(a)),n.meta.previousIndex=a}),r.tree){const n=r.rootNode;return n.insertChild(t,n.children&&n.children[e])}return r.suspendEvents(),r.storage.remove(l),r.resumeEvents(),n&&r.suspendEvents(),s.splice(e,0,...i),n&&r.resumeEvents(),r.autoCommit&&r.commit(),i}}move(e,t){this.storage.move(e,t)}setMultiple(e,t,n){const r=this,s=[],i=[];r.forEach(r=>{e(r)&&(i.push(r.set(t,n,!0)),s.push(r))}),r.trigger("updateMultiple",{records:s,all:r.records.length===s.length}),r.trigger("change",{action:"updatemultiple",records:s,all:r.records.length===s.length}),r.reapplyFilterOnUpdate&&r.isFiltered&&r.filter()}setAll(e,t){const n=this,r=[];n.forEach(n=>{r.push(n.set(e,t,!0))}),n.trigger("updateMultiple",{records:n.records,all:!0}),n.trigger("change",{action:"updatemultiple",records:n.records,all:!0}),n.reapplyFilterOnUpdate&&n.isFiltered&&n.filter()}commit(){const e=this,t=e.changes;return e.callPreventable("commit",{changes:t},()=>(e.modified.forEach(e=>e.clearChanges(!1)),e.added.clear(),e.modified.clear(),e.removed.clear(),t))}clearChanges(){const e=this;e.remove(e.added.values,!0),e.modified.forEach(e=>e.clearChanges(!1)),e.added.clear(),e.modified.clear(),e.removed.clear(),e.trigger("change",{action:"clearchanges"})}get changes(){const e=this;return e.added.count||e.modified.count||e.removed.count?{added:e.added.values.slice(),modified:e.modified.values.slice(),removed:e.removed.values.slice()}:null}get autoCommit(){return this._autoCommit}set autoCommit(e){this._autoCommit=e,e&&this.changes&&this.commit()}applyChangesFromStore(e){const t=this,n=e.changes;n&&(n.added&&t.add(n.added),n.removed&&t.remove(n.removed.map(e=>e.id)),n.modified&&n.modified.forEach(e=>{t.getById(e.id).set(e.modifications)}))}}),Tr=e=>(class extends(e||W){static get defaultConfig(){return{filters:null,reapplyFilterOnAdd:!1,reapplyFilterOnUpdate:!1}}set filters(e){const t=this,n=t.filters;if(n.clear(),t._filtersFunction=null,e){if("Object"===e.constructor.name)for(const t of Object.entries(e))n.add(new Zt("filterBy"===t[0]&&"function"==typeof t[1]?{filterBy:t[1]}:"Object"===t[1].constructor.name?Object.assign({property:t[0]},t[1]):{property:t[0],value:t[1]}));else Array.isArray(e)?n.add(...e.map(e=>e instanceof Zt?e:new Zt(e))):e.isCollection?n.add(...e.values):n.add(new Zt({filterBy:e}));n.forEach(e=>e.owner=t)}}get filters(){return this._filters||(this._filters=new cn({extraKeys:["property"]}))}set filtersFunction(e){this._filtersFunction=e}get filtersFunction(){const e=this,{filters:t,isGrouped:n}=e;if(!e._filtersFunction)if(t.count){const r=Zt.generateFiltersFunction(t);e._filtersFunction=(e=>n&&e.meta.specialRow?e.groupChildren.some(r):r(e))}else e._filtersFunction=At.returnTrue;return e._filtersFunction}get isFiltered(){return this.filters.values.some(e=>!e.disabled)}traverseFilter(e){let t=this,n=!e.isRoot&&t.filtersFunction(e),r=!1,s=e.unfilteredChildren||e.children;return s&&s.length?(e.unfilteredChildren||(e.unfilteredChildren=e.children.slice()),e.children=e.unfilteredChildren.filter(e=>t.traverseFilter(e)),e.children.length&&(r=!0),n||r):n}traverseClearFilter(e){const t=this;e.children&&(e.children=e.unfilteredChildren||e.children,e.children.forEach(e=>t.traverseClearFilter(e)))}get latestFilterField(){return this.filters.last?this.filters.last.property:null}processFieldFilter(e,t){"string"==typeof e&&(e={property:e,value:t}),(e=e instanceof Zt?e:new Zt(e)).owner=this,this.filters.add(e)}filter(e,t,n=!1){const r=this,{storage:s,filters:i,rootNode:o}=r,a=r.count;if(e){const s=typeof e;if(r.isConfiguring=!0,Array.isArray(e)?(n=t,e.forEach(r.processFieldFilter,r)):"function"===s?r.filters=e:r.processFieldFilter(e,t),r.isConfiguring=!1,!r.isFiltered)return}r.filtersFunction=null,r.tree?(r.isFiltered?r.traverseFilter(o):r.traverseClearFilter(o),s.replaceValues(r.collectDescendants(o).visible,!0)):r.isFiltered?s.addFilter({id:"primary-filter",filterBy:r.filtersFunction}):s.filters.clear(),r.resetRelationCache(),n||r.triggerFilterEvent({action:"filter",filters:i,oldCount:a,records:r.storage.values})}get filtered(){return this.storage.isFiltered}triggerFilterEvent(e){this.trigger("filter",e),this.trigger("refresh",e),this.trigger("change",e)}filterBy(e){this.filter(e)}removeFieldFilter(e,t){const n=this.filters.getBy("property",e);n&&(this.filters.remove(n),this._filtersFunction=null,t||this.filter())}clearFilters(e){this.filters.clear(),this.filter(void 0,void 0,e)}convertFilterToString(e){let t=this.filters.getBy("property",e),n="";return t&&!t.filterBy&&(n=String(t)),n}get filterState(){return this.filters.values.map(e=>We.cleanupProperties(e.config))}});const Rr={add:1,replace:1};var kr=e=>(class extends(e||W){static get defaultConfig(){return{groupers:[]}}construct(e){super.construct(e),this.on("change",this.onDataChanged)}storeCollapsedGroups(){const e=this;return e.collapsedGroupsHash={},!(!e.groupRecords||!e.groupRecords.length||(e.groupRecords.forEach(t=>{e.expand(t)&&(e.collapsedGroupsHash[t.id]=!0)}),0))}restoreCollapsedGroups(){const e=this;Object.keys(e.collapsedGroupsHash).forEach(t=>e.collapse(e.getById(t)))}onDataChange({source:e,action:t,removed:n}){const r=this;let s=e.values;r.isGrouped?"splice"===t&&n&&n.length&&(r.storeCollapsedGroups()&&r.storage.replaceValues(r.removeHeadersAndFooters(r.storage.values),!0),r.storage.replaceValues(r.prepareGroupRecords(r.storage.values),!0),r.restoreCollapsedGroups()):e.replaceValues(r.removeHeadersAndFooters(s),!0),super.onDataChange&&super.onDataChange(...arguments)}collapse(e){return!(!e||e.meta.collapsed||(this.excludeGroupRecords(e),e.meta.collapsed=!0,0))}expand(e){return!(!e||!e.meta.collapsed||(this.includeGroupRecords(e),e.meta.collapsed=!1,0))}removeHeadersAndFooters(e){const t=this;return e.filter(e=>!e.meta.specialRow||(t.unregister(e),!1),!0)}prepareGroupRecords(e=this.registeredRecords){const t=this;if(e=t.removeHeadersAndFooters(e),!t.isGrouped)return e;const n=[],r=t.groupers[0].field,s=[];let i=null,o=null,a=0;function l(){const e=o.meta.groupRowFor,r=`group-footer-${"number"==typeof e?e:$.createId(e)}`,i=t.getById(r)||new t.modelClass({id:r},t,{specialRow:!0,groupFooterFor:e,groupRecord:o});return t.register(i),i.groupChildren=o.groupChildren,s.push(i),n.push(i),t.allRecords.push(i),o.groupChildren.push(i),a++,i}return e.forEach(e=>{const c=e[r],d=`group-header-${"number"==typeof c?c:$.createId(c)}`;!e.groupChildren||e.groupChildren.length?(We.isEqual(c,i)||(o&&(t.useGroupFooters&&l(),o.meta.childCount=a),o=t.getById(d)||new t.modelClass({id:d},t,{specialRow:!0,groupRowFor:c,groupField:r}),t.register(o),o.groupChildren=[],n.push(o),t.allRecords.push(o),s.push(o),i=c,a=0),e.instanceMeta(t.id).groupParent=o,n.push(e),o.groupChildren.push(e),a++):t.unregister(e)}),o&&(o.meta.childCount=a,t.useGroupFooters&&l()),t.groupRecords=s,n}get isGrouped(){return Boolean(this.groupers.length)}group(e,t,n=!1,r=!0,s=!1){const i=this;let o;if(n?i.groupers.push(o={field:e,ascending:t,complexMapping:e.includes(".")}):e&&(null==t&&(t=!i.groupInfo||i.groupInfo.field!==e||!i.groupInfo.ascending),i.groupInfo=o={field:e,ascending:t,complexMapping:e.includes(".")},i.groupers=[i.groupInfo]),o){const{prototype:t}=i.modelClass;o.complexMapping&&!t.hasOwnProperty(e)&&Object.defineProperty(t,e,{get(){return We.getPath(this,e)}})}!1!==r&&i.sort(null,null,!1,!0),s||(i.trigger("group",{isGrouped:i.isGrouped,groupers:i.groupers,records:i.storage.values}),i.trigger("refresh",{action:"group",isGrouped:i.isGrouped,groupers:i.groupers,records:i.storage.values}))}addGrouper(e,t=!0){this.group(e,t,!0)}removeGrouper(e){const t=this.groupers.findIndex(t=>t.field===e);t>-1&&(this.groupers.splice(t,1),this.group())}clearGroupers(){const e=this,{groupers:t}=e;t.length&&(t.length=0,e.groupRecords.forEach(t=>{t.meta.collapsed&&e.includeGroupRecords(t)}),e.storage.replaceValues(e.removeHeadersAndFooters(e.registeredRecords),!0),e.group(null,null,null,!1),"groupRecords"in e&&delete e.groupRecords)}isRecordInGroup(e,t){return this.isGrouped?e[this.groupers[0]&&this.groupers[0].field]===t&&!e.meta.specialRow:null}isInCollapsedGroup(e){const t=e.instanceMeta(this).groupParent;return t&&t.meta.collapsed}getGroupRecords(e){const t=this;return t.isGrouped?t.storage.values.filter(n=>t.isRecordInGroup(n,e)):null}getGroupTitles(){return this.isGrouped?this.getDistinctValues(this.groupers[0]&&this.groupers[0].field):null}onDataChanged(e){this.isGrouped&&(!e.changes&&Rr[e.action]||e.changes&&this.groupers.some(t=>t.field in e.changes))&&this.sort()}internalIncludeExcludeGroupRecords(e,t){const n=this,r=n.indexOf(e),s=n.id;e.meta.collapsed&&!t||!e.meta.collapsed&&t||(e.groupChildren.forEach(e=>e.instanceMeta(s).hiddenByCollapse=!t),t?n.storage.values.splice(r+1,0,...e.groupChildren):n.storage.values.splice(r+1,e.groupChildren.length),n.storage._indicesInvalid=!0,n._idMap=null)}excludeGroupRecords(e){this.internalIncludeExcludeGroupRecords(e,!1)}includeGroupRecords(e){this.internalIncludeExcludeGroupRecords(e,!0)}collectGroupRecords(){return this.records.reduce((e,t)=>(t.meta.specialRow&&(e.push(t),"groupRowFor"in t.meta&&e.push.apply(e,t.groupChildren)),e),[])}}),Mr=e=>(class extends(e||W){initRelations(e){const t=this,n=t.modelClass.relations;e&&t.modelRelations&&t.modelRelations.forEach(e=>{e.storeDetacher&&e.storeDetacher()}),t.modelRelations&&0!==t.modelRelations.length&&!e||!n||(t.modelRelations=[],n&&n.forEach(e=>{const n=Object.assign({},e),r="string"==typeof n.store?t[n.store]:n.store;if(n.dependentStore=t,t.modelRelations.push(n),r){n.storeProperty=n.store,n.store=r;const e=r.dependentStoreConfigs;e.has(t)?e.get(t).push(n):e.set(t,[n]),n.collectionName&&r.initRelationCollection(n,t),r.count>0&&r.updateDependentStores("dataset",r.records)}}))}initRelationCollection(e,t){const n=this,r=e.collectionName;n.collectionStores||(n.collectionStores={}),n.collectionStores[r]={store:t,config:e},n[r+"Store"]||(n[r+"Store"]=t),n.count>0&&n.initModelRelationCollection(r,n.records)}initModelRelationCollection(e,t){const n=this;t.forEach(t=>{t.traverse(t=>{!(e in t)&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return n.getCollection(this,e)},set:function(t){return n.setCollection(this,e,t)}})})})}resetRelationCache(){this.relationCache={},this.forEach(e=>e.initRelations())}updateRecordRelationCache(e,t){const n=this;t&&t.forEach(t=>{let r=t.related?t.related.id:e.get(t.config.fieldName);void 0!==r&&n.cacheRelatedRecord(e,r,t.config.relationName,r)})}getCollection(e,t){const{config:n,store:r}=this.collectionStores[t];return r.relationCache[n.relationName]&&r.relationCache[n.relationName][e.id]||[]}setCollection(e,t,n){const{config:r,store:s}=this.collectionStores[t];s.relationCache[r.relationName]||(s.relationCache[r.relationName]={});const i=(s.relationCache[r.relationName][e.id]||[]).slice(),o=[],a=[];s.suspendEvents(),i.forEach(e=>{n.includes(e)||(e[r.fieldName]=null,s.remove(e),a.push(e))}),n.forEach(t=>{t instanceof Sr?t.stores.includes(s)||(s.add(t),o.push(t)):([t]=s.add(t),o.push(t)),t[r.fieldName]=e.id}),s.resumeEvents(),a.length&&(s.trigger("remove",{records:a}),s.trigger("change",{action:"remove",records:a})),o.length&&(s.trigger("add",{records:o}),s.trigger("change",{action:"add",records:o}))}cacheRelatedRecord(e,t,n,r=null){const s=this.relationCache[n]||(this.relationCache[n]={});null!==r&&this.uncacheRelatedRecord(e,n,r),t&&le.include(s[t]||(s[t]=[]),e)}uncacheRelatedRecord(e,t=null,n=null){const r=this;function s(t,n){const s=r.relationCache[t],i=s&&s[n];if(i){const t=i.indexOf(e);t>=0&&i.splice(t,1),0===i.length&&delete s[n]}}null!==n?s(t,n):e.meta.relationCache&&Object.entries(e.meta.relationCache).forEach(([e,t])=>{s(e,t&&t.id)})}updateDependentStores(e,t){this.dependentStoreConfigs.forEach(n=>{n.forEach(n=>{const r=n.dependentStore,s=r.relationCache[n.relationName];return"dataset"===e?(n.collectionName&&this.initModelRelationCollection(n.collectionName,t),void r.forEach(e=>{const t=e.initRelation(n);t&&r.cacheRelatedRecord(e,t.id,n.relationName,t.id)})):"removeall"===e?(r.forEach(e=>{e.removeRelation(n)}),void delete r.relationCache[n.relationName]):("add"===e&&n.collectionName&&this.initModelRelationCollection(n.collectionName,t),void("add"!==e&&"remove"!==e||t.forEach(t=>{let i=s&&s[t.id];switch(e){case"remove":i&&i.forEach(e=>e.removeRelation(n));break;case"add":r.forEach(e=>{e.get(n.fieldName)==t.id&&(e.initRelation(n),r.cacheRelatedRecord(e,t.id,n.relationName))})}})))})})}updateDependentRecordIds(e,t){this.dependentStoreConfigs&&this.dependentStoreConfigs.forEach(n=>{n.forEach(n=>{const r=n.dependentStore,s=r.relationCache[n.relationName],i=s&&s[e]&&s[e].slice();i&&i.forEach(s=>{s.set(n.fieldName,t,!1,!0),r.cacheRelatedRecord(s,t,n.relationName,e)})})})}}),Ir=e=>(class extends(e||W){sum(e,t=this.storage.values){return t?t.reduce((t,n)=>{if(n.meta.specialRow)return t;const r=Number(n[e]);return isNaN(r)?t:t+r},0):0}min(e,t=this.storage.values){return t&&t.length?t.reduce((t,n)=>(n[e]<t&&(t=n[e]),t),t[0][e]):0}max(e,t=this.storage.values){return t&&t.length?t.reduce((t,n)=>(n[e]>t&&(t=n[e]),t),t[0][e]):0}average(e,t=this.storage.values){if(!t||!t.length)return 0;let n=0;return t.reduce((t,r)=>{if(r.meta.specialRow)return t;const s=parseFloat(r[e]);return isNaN(s)?t:(n++,t+s)},0)/n}groupSum(e,t){return this.sum(t,this.getGroupRecords(e))}});const Ar=(e,t)=>-1!==String(e).toLowerCase().indexOf(t),Fr={string:Ar,number:Ar,boolean:Ar,date:(e,t)=>e instanceof Date&&t instanceof Date?String(e)===String(t):-1!==String(e.getMonth()+1).indexOf(t)||-1!==String(e.getDate()).indexOf(t)||-1!==String(e.getFullYear()).indexOf(t)};var Or=e=>(class extends(e||W){search(e,t=null){const n=this.storage.values,r=n.length,s=[];if(null==e)return null;let i,o,a,l,c;for("string"==typeof e&&(e=String(e).toLowerCase()),i=0;i<r;i++){o=n[i];for(let n of t||o.fieldNames)l=(a=o[n])instanceof Date?"date":typeof a,c=Fr[l],a&&c&&c(a,e)&&s.push({index:i,data:o,field:n,id:o.id})}return s}findByField(e,t){let n,r,s,i=this.storage.values,o=i.length,a=[];for(null!=t&&(t=String(t).toLowerCase()),n=0;n<o;n++){let o=(s=(r=i[n])[e])instanceof Date?"date":typeof s,l={date:()=>Boolean(s)&&s.toLocaleString().includes(t),string:()=>Boolean(s)&&s.toLowerCase().includes(t),number:()=>"number"==typeof s&&s.toString().includes(t),object:()=>s===t,undefined:()=>s===t};(null==t&&s===t||t&&l[o]())&&a.push({id:r.id,index:n,data:r})}return a}find(e){return this.storage.values.find(e)}findRecord(e,t,n=!1){const r=n=>We.isEqual(n[e],t);return this.tree?this.query(r)[0]:(n?this.storage.allValues:this.storage.values).find(r)}query(e){if(this.isTree){const t=[];return this.traverse(n=>{e(n)&&t.push(n)}),t}return this.storage.values.filter(e)}some(e){return this.storage.values.some(e)}}),Lr=e=>(class extends(e||W){static get defaultConfig(){return{sorters:[],useLocaleSort:null}}get isSorted(){return Boolean(this.sorters.length)||this.isGrouped}sort(e,t,n=!1,r=!1){const s=this,i=s.allRecords,o=s.sorters.slice();let a,l=null;if(e)if(Array.isArray(e))s.sorters=e.map(e=>"string"==typeof e?{field:e}:e);else{const r="object"==typeof e?e.field:e;a=s.sorters.find(e=>e.field===r),null==t&&(t=!(a&&("string"==typeof e&&a.field===e||"object"==typeof e&&a.field===e.field)&&a.ascending));const i={field:r,ascending:t};"object"==typeof e&&(i.fn=e.fn,i.useLocaleSort=e.useLocaleSort),n?a?(l=a.ascending,a.ascending=t):s.sorters.push(i):s.sorters=[i]}if(!r&&!1===s.trigger("beforeSort",{sorters:s.sorters,records:i,currentSorters:o}))return s.sorters=o,void(null!==l&&(a.ascending=l));s.performSort(r),r||(s.trigger("sort",{sorters:s.sorters,records:i}),s.trigger("refresh",{action:"sort",sorters:s.sorters,records:i}))}addSorter(e,t=!0){this.sort(e,t,!0)}removeSorter(e){let t=this.sorters.findIndex(t=>t.field==e);t>-1&&(this.sorters.splice(t,1),this.sort())}clearSorters(){this.sorters.length=0,this.sort()}createSorterFn(e){const t=this.useLocaleSort;return(n,r)=>{for(let{field:s,ascending:i=!0,fn:o=null,useLocaleSort:a=t}of e){const e=i?1:-1;if(o){const t=o(n,r);if(null!==t)return t*e}const t=n[s],l=r[s];if(null==t)return-e;if(null==l)return e;if(a){if(!0===a)return String(t).localeCompare(l)*e;if("string"==typeof a)return String(t).localeCompare(l,a)*e;if("object"==typeof a)return String(t).localeCompare(l,a.locale,a)*e}if(t>l)return e;if(t<l)return-e}return 0}}performSort(){const e=this,{rootNode:t,storage:n,sorters:r}=e,s=e.createSorterFn(e.isGrouped?e.groupers.concat(r):r);e.isGrouped&&e.storeCollapsedGroups()&&n.replaceValues(e.removeHeadersAndFooters(n.values),!0),e.tree?(t.traverse(e=>{e.isLoaded&&e.isParent&&(e.children=e.children.sort(s),e.updateChildrenIndex(e.children))}),n.replaceValues(e.collectDescendants(t).visible,!0)):n.replaceValues(n.values.sort(s),!0),e._idMap=null,e.isGrouped&&(n.replaceValues(e.prepareGroupRecords(n.values),!0),e.restoreCollapsedGroups())}}),_r=e=>(class extends(e||W){static get defaultConfig(){return{chained:!1,chainedFilterFn:null,chainedFields:null,masterStore:null,doRelayToMaster:["add","remove","insert","removeAll"],dontRelayToMaster:[],keepUncommittedChanges:!1}}construct(e){const t=this;if(super.construct(e),t.chained){if(!t.masterStore)throw new Error("masterStore required on a chained store");t.methodNamesToRelay.forEach(e=>t[e]=((...n)=>t.relayToMaster(e,n))),t.masterStore.on({change:t.onMasterDataChanged,prio:1,thisObj:t}),t.masterStore.chainedStores||(t.masterStore.chainedStores=[]),t.masterStore.chainedStores.push(t),t.fillFromMaster()}}get isChained(){return this.chained}set chainedFilterFn(e){this._chainedFilterFn=this.thisObj?e.bind(this.thisObj):e}get chainedFilterFn(){return this._chainedFilterFn}get methodNamesToRelay(){const e=Array.isArray(this.doRelayToMaster),t=Array.isArray(this.dontRelayToMaster);return e&&this.doRelayToMaster.filter(e=>!t||!this.dontRelayToMaster.includes(e))||[]}updateChainedStores(){this.chainedStores&&this.chainedStores.forEach(e=>e.fillFromMaster())}fillFromMaster(){const e=this;if(!e.chained)throw new Error("fillFromMaster only allowed on chained store");e.data=e.keepUncommittedChanges?[].concat(e.added.values.filter(t=>!e.removed.includes(t)),e.masterStore.allRecords.filter(t=>!e.removed.includes(t)&&!e.added.includes(t)&&e.chainedFilterFn(t))):e.masterStore.allRecords.filter(e.chainedFilterFn)}commitToMaster(){const e=this,t=e.masterStore;if(!e.chained)throw new Error("commitToMaster only allowed on chained store");return t.beginBatch(),t.remove(e.removed.values),t.add(e.added.values),t.endBatch(),e.commit()}relayToMaster(e,t){if("remove"!==e||4!==t.length||!0!==t[3])return this.masterStore[e](...t)}onMasterDataChanged({action:e,changes:t}){("update"!==e||this.chainedFields&&this.chainedFields.some(e=>e in t))&&this.fillFromMaster()}}),Pr=e=>(class extends(e||W){getState(){const e=this,t={};return e.sorters&&e.sorters.length&&(t.sorters=e.sorters.slice()),e.groupers&&e.groupers.length&&(t.groupers=e.groupers.slice()),e.filters&&e.filters.values.length&&(t.filters=e.filterState),t}applyState(e){const t=this;"sorters"in e&&(t.sorters=e.sorters.slice()),"groupers"in e&&(t.groupers=e.groupers.slice()),("sorters"in e||"groupers"in e)&&t.sort(),"filters"in e&&(t.filters=e.filters.slice(),t.filter())}}),$r=e=>(class extends(e||W){get isTree(){return this.tree}get leaves(){const e=[];return this.tree?(this.traverse(t=>{t.isLeaf&&e.push(t)}),e):(this.allRecords.forEach(t=>{t.isLeaf&&e.push(t),t.traverse(t=>{t.isLeaf&&e.push(t)},!0)}),e)}async loadChildren(e){}onNodeAddChild(e,t,n,r,s){const i=this,o=e===i.rootNode&&e.isLoading,{storage:a}=i,l=[],c=[],d=t[0].previousSibling;let u;if(i.collectDescendants(t,l,c,!(e.isExpanded(i)&&e.ancestorsExpanded(i))),!o&&c.length)for(const h of c)i.modified.includes(h)||r[h.id]||(i.added.add(h),i.removed.remove(h));if(o&&i.rootVisible&&(l.unshift(e),c.unshift(e)),l.length&&(u=0!==n&&d?a.indexOf(d)+d.getDescendantCount(!0,i):a.indexOf(e),a.suspendEvents(),i.storage.splice(++u,0,l),a.resumeEvents()),i.updateDependentStores("add",t),o&&l.length){if(i.sorters.length&&i.sort(null,null,!1,!0),!s){const e={action:"dataset",data:i._data,records:l};i.trigger("refresh",e),i.trigger("change",e)}}else if(!s){const n={action:"add",parent:e,isChild:!0,isMove:r,records:t,allRecords:c,index:u};i.trigger("add",n),i.trigger("change",n)}}onNodeRemoveChild(e,t,n,r){const s=this,{storage:i}=s,o=[],a=[];if(s.collectDescendants(t,o,a,!(e.isExpanded(s)&&e.ancestorsExpanded(s))),!r){for(let e of t)e.unJoinStore(s);if(a.length){for(let e of a)e.stores.includes(s)&&e.unJoinStore(s),s.added.includes(e)?s.added.remove(e):s.removed.add(e);s.modified.remove(a)}}o.length?(n=i.indexOf(o[0]))>-1&&(i.suspendEvents(),i.splice(n,o.length),i.resumeEvents()):n=-1;const l={action:"remove",parent:e,isChild:!0,isMove:r,records:t,allRecords:a,index:n};s.trigger("remove",l),s.trigger("change",l)}collectDescendants(e,t=[],n=[],r=!1){const s=this,i=Array.isArray(e)?e:e.children;if(i)for(let o,a=0,l=i.length;a<l;a++)o=i[a],r||t.push(o),n.push(o),s.collectDescendants(o,t,n,r||!o.isExpanded(s));return{visible:t,all:n}}internalToggleTreeSubRecords(e,t){const n=this,{storage:r}=n,s=r.indexOf(e),i=[];let o=0,a=-1;if(e.traverse(e=>{const r=e.isExpanded(n),s=e.instanceMeta(n.id);a&&e.childLevel<=a&&(a=-1),-1===a&&(e.isLeaf||r||(a=e.childLevel),t?i.push(e):s.hidden||(i.push(e),o++)),s.hidden=!t},!0),i.length&&!1!==s){if(r.suspendEvents(),t){r.splice(s+1,0,...i);const e={action:"add",isExpand:!0,records:i,index:s+1};n.trigger("add",e),n.trigger("change",e)}else{r.splice(s+1,o);const e={action:"remove",isCollapse:!0,records:i,index:s+1};n.trigger("remove",e),n.trigger("change",e)}r.resumeEvents()}}onNodeCollapse(e){return this.internalToggleTreeSubRecords(e,!1)}onNodeExpand(e){return this.internalToggleTreeSubRecords(e,!0)}});const jr=Symbol("STM_PROP");var Hr=e=>(class extends(e||W){static get defaultConfig(){return{stm:null}}get stm(){return this[jr]}set stm(e){const t=this;t.stm!=e&&(t.stm&&t.stm.hasStore(t)&&t.stm.removeStore(t),t[jr]=e,t.stm&&!t.stm.hasStore(t)&&t.stm.addStore(t))}add(e,t=!1){let n;const r=this.stm;return this.tree||!r||r.disabled?n=super.add(e,t):(n=super.add(e,t))&&n.length&&r.onStoreModelAdd(this,n,t),n}insert(e,t,n=!1){let r;const s=this.stm;if(this.tree||!s||s.disabled)r=super.insert(e,t,n);else{const i=(Array.isArray(t)?t:[t]).reduce((e,t)=>{const n=t instanceof Sr?this.indexOf(t):void 0;return void 0!==n&&-1!==n&&e.set(t,n),e},new Map);(r=super.insert(e,t))&&r.length&&(e=this.indexOf(r[0]),s.onStoreModelInsert(this,e,r,i,n))}return r}remove(e,t=!1,n){let r;const s=this.stm;if(this.tree||!s||s.disabled)r=super.remove(e,t,n);else{const i=(Array.isArray(e)?e:[e]).map(e=>this.getById(e)).filter(e=>!!e).reduce((e,t)=>{const n=this.indexOf(t);return void 0!==n&&-1!=n&&e.set(t,n),e},new Map);(r=super.remove(e,t,n))&&r.length&&s.onStoreModelRemove(this,r,i,t)}return r}removeAll(e){const t=this.stm;if(t&&!t.disabled){const{tree:n,rootNode:r,allRecords:s}=this,i=s.length,o=n?r.children.slice():s.slice();super.removeAll(e),i&&0===this.count&&t.onStoreRemoveAll(this,o,e)}else super.removeAll(e)}});const Nr=function(){class e extends(Dr(W).mixes(ue,hr,gr,Tr,xr,Mr,Ir,Or,Lr,kr,_r,Pr,$r,Hr)){static get properties(){return{relationCache:{},dependentStoreConfigs:new Map}}static get defaultConfig(){return{storeId:null,id:!0,fields:null,autoTree:!0,modelClass:Sr,data:null,tree:!1,callOnFunctions:!0,storage:null,useRawData:null}}construct(e={}){const t=this;t.added=new Er,t.removed=new Er,t.modified=new Er,t.idRegister={},t.internalIdRegister={},super.construct(e),t.on({idChange:t.onRecordIdChange,update:t.onUpdateRecord,thisObj:t}),t.initRelations()}doDestroy(){const t=this,n=t.registeredRecords;for(let e,r=n.length-1;r>=0;r--)(e=n[r])&&!e.isDestroyed&&e.unJoinStore(t);t.storage.destroy(),delete e.storeMap[t.id],super.doDestroy()}beginBatch(){this.suspendEvents()}endBatch(){this.resumeEvents()&&this.trigger("refresh",{action:"batch",data:this.storage.values,records:this.storage.values})}set storage(e){const t=this;t._storage=e&&e.isCollection?e:new cn(e),t._storage.autoFilter=t.reapplyFilterOnAdd;for(const n of t._storage)n.joinStore(t);t._storage.on({change:"onDataChange",thisObj:t})}get storage(){return this._storage||(this.storage={}),this._storage}get allRecords(){const e=this;if(e.tree){const t=e.collectDescendants(e.rootNode).all;return e.rootVisible&&t.unshift(e.rootNode),t}return e.isGrouped?e.collectGroupRecords():e.storage.allValues}onDataChange({source:e,action:t,added:n,removed:r,replaced:s,oldCount:i,item:o,from:a,to:l}){const c=this,d=n&&n.length,u=r&&r.length;let h,g;if(c._idMap=null,d&&n.forEach(e=>{e.joinStore(c)}),s&&s.forEach(([e,t])=>{e.unJoinStore(c),t.joinStore(c)}),super.onDataChange(...arguments),!c.tree){if(d){for(h of n)h.joinStore(c);c.added.add(n),c.removed.remove(n),(g=c.filtered&&c.reapplyFilterOnAdd)&&c.filter(null,null,!0)}if(u){for(h of r)h.unJoinStore(c),c.added.includes(h)?c.added.remove(h):c.removed.add(h);c.modified.remove(r),(g=c.filtered)&&c.filter(null,null,!0)}}switch(t){case"clear":c.relationCache={},c.updateDependentStores("removeall"),c.trigger("removeAll"),c.trigger("change",{action:"removeall"});break;case"splice":if(d){c.updateDependentStores("add",n);const t=n.reduce((e,t)=>{const{previousIndex:n}=t.meta;return n>-1&&n<e&&(e=n),e},n[0].meta.previousIndex),r={records:n,index:e.indexOf(n[0])};t>-1&&(r.oldIndex=t),c.trigger("add",r),c.trigger("change",Object.assign({action:"add"},r)),g&&c.triggerFilterEvent({action:"filter",filters:c.filters,oldCount:i,records:c.storage.allValues})}r.length&&(c.updateDependentStores("remove",r),c.trigger("remove",{records:r}),c.trigger("change",{action:"remove",records:r})),s.length&&(c.trigger("replace",{records:s,all:c.records.length===s.length}),c.trigger("change",{action:"replace",replaced:s,all:c.records.length===s.length}));break;case"filter":c.isGrouped?c.group():c.isSorted&&c.performSort();break;case"move":for(let e=c.storage.allValues,t=Math.min(a,l);t<=Math.max(a,l);t++)e[t].parentIndex=t;c.trigger("move",{record:o,from:a,to:l}),c.trigger("change",{action:t,record:o,from:a,to:l})}}onModelChange(e,t,n){const r=this,s=e.constructor.idField;if(s in t){const{oldValue:n,value:i}=t[s];r.updateDependentRecordIds(n,i),r.trigger("idChange",{store:r,record:e,oldValue:n,value:i})}const i={record:e,changes:n};null!=e.batching&&(i.batch=!0),r.trigger("update",i),r.trigger("change",Object.assign({action:"update"},i))}get idMap(){const e=this.storage.values,t=!this._idMap,n=this._idMap||(this._idMap={});if(t)for(let r,s=0,i=0;s<e.length;s++)n[(r=e[s]).id]={index:s,visibleIndex:i,record:r},r.meta.specialRow||i++;return n}get modelClass(){return this._modelClass}set modelClass(e){const t=this.fields;let n=null;(n=t&&t.length?class extends e{static get fields(){return t}}:class extends e{}).exposeRelations(),this._modelClass=n}set storeId(e){this.id=e}get storeId(){return this.id}set id(t){this._id&&delete e.storeMap[this._id],this._id=!0===t?k.generateId("store-"):t,t&&(e.storeMap[t]=this)}get id(){return this._id}get tree(){return this._tree}set tree(e){this._tree=e,e&&!this.rootNode&&(this.rootNode=this.buildRootNode())}buildRootNode(){return{}}static getStore(t,n){if(t instanceof e)return t;if(this.storeMap[t])return this.storeMap[t];if(Array.isArray(t)){let r;const s=t.map(e=>(e instanceof Sr?r=e.constructor:"string"==typeof e&&(e={text:e}),e));t={autoCreated:!0,data:s,modelClass:r||class extends Sr{}},n||(n=e)}return n?new n(t):void 0}static get stores(){return Object.values(this.storeMap)}get rootNode(){return this._rootNode}set rootNode(e){const t=this,n=t._rootNode;e!==n&&(n&&t.clear(!1),e instanceof Sr?(e.instanceMeta(t).collapsed=!1,t._rootNode=e):(t._rootNode=e=new t.modelClass(Object.assign({expanded:!0,[t.modelClass.idField]:`${t.id}-rootNode`},e),t,null,!0),e.isAutoRoot=!0),t._tree=!0,e.isRoot=!0,e.joinStore(t),(e.children&&e.children.length||t.rootVisible)&&(e.isLoading=!0,t.onNodeAddChild(e,e.children||[],0),e.isLoading=!1),t.trigger("rootChange",{oldRoot:n,rootNode:e}))}set data(e){const t=this;if(t._thisIsAUsedExpression(t.plugins),t.processConfiguredListeners(),t._data=e,t.tree=!t.chained&&(t.tree||Boolean(t.autoTree&&e&&e.some(e=>e[t.modelClass.childrenField]))),t.tree){const n=t.rootNode;n.clearChildren(),n.isLoading=!0,n.appendChild(e),t.updateDependentStores("dataset",[n]),n.isLoading=!1}else t.loadData(e);t.added.clear(),t.removed.clear(),t.modified.clear()}loadData(e){const t=this,n=t.storage;if(t.allCount&&t.clear(!1),t._idMap=null,e){if(t.storeCollapsedGroups(),e[0]instanceof Sr)n.replaceValues(e.slice(),!0,!0);else{t.modelClass.exposeProperties(e[0]);const r=e.length,s=new Array(r);for(let n=0;n<r;n++)s[n]=t.createRecord(e[n],!0),s[n].parentIndex=n;n.replaceValues(s,!0,!0)}if(t.storage.allValues.forEach(e=>{e.joinStore(t)}),t.prepareGroupRecords(),t.restoreCollapsedGroups(),t.isFiltered&&t.filter(null,null,!0),t.groupers.length>0&&t.isGrouped&&t.group(null,null,!1,!t.sorters.length,!0),t.sorters.length&&t.sort(null,null,!1,!0),!t.useRawData){const e=t.idMap;if(Object.keys(e).length<t.storage.values.length){const n=[];throw t.storage.values.forEach(t=>e[t.id]?delete e[t.id]:n.push(t)),new Error(`Id collision on ${n.map(e=>e.id)}`)}}const r={action:"dataset",data:e,records:t.storage.values};t.updateDependentStores(r.action,r.records),t.trigger("refresh",r),t.trigger("change",r)}else t._data=null}get data(){return this._data}getRange(e,t,n=!0){return(n?this.storage.allValues:this.storage.values).slice(e,t)}createRecord(e,t=!1){return new this.modelClass(e,this,null,t)}refreshData(){this.filter(),this.sort()}onRecordIdChange({record:e,oldValue:t,value:n}){const r=this,s=r._idMap,{idRegister:i}=r;r.storage._indicesInvalid=!0,s&&(delete s[t],s[n]=e),r.added.changeId(t,n),r.removed.changeId(t,n),r.modified.changeId(t,n),delete i[t],i[n]=e,e.index=r.storage.indexOf(e)}onUpdateRecord({record:e,changes:t}){const{internalId:n}=t,{internalIdRegister:r}=this;n&&(this.storage._indicesInvalid=!0,delete r[n.oldValue],r[n.value]=e),this.reapplyFilterOnUpdate&&this.isFiltered&&this.filter()}getCount(e=!0){return e?this.count:this.originalCount}get originalCount(){return this.storage.totalCount}get count(){return this.storage.count}get allCount(){return this.tree?this.rootNode.descendantCount:this.storage.totalCount}get records(){return this.storage.values}get first(){return this.storage.values[0]}get last(){return this.storage.values[this.storage.values.length-1]}getAt(e,t=!1){return this.storage.getAt(e,t)}register(e){const t=this.tree&&this.idRegister[e.id];if(t&&t!==e)throw new Error(`Id collision on ${e.id}`);this.idRegister[e.id]=e,this.internalIdRegister[e.internalId]=e}unregister(e){delete this.idRegister[e.id],delete this.internalIdRegister[e.internalId]}get registeredRecords(){return Object.values(this.idRegister)}getById(e){return e instanceof Sr?e:this.idRegister[e]}isVisible(e){return this.storage.includes(this.getById(e))}isAvailable(e){return this.storage.includes(this.getById(e))}getByInternalId(e){return this.internalIdRegister[e]}includes(e){return this.tree?null!=this.idRegister[Sr.asId(e)]:this.indexOf(e)>-1}indexOf(e,t=!1){const n=Sr.asId(e);if(!n)return-1;if(this.tree)return this.storage.indexOf(n);const r=this.idMap[n];return r?r[t?"visibleIndex":"index"]:-1}allIndexOf(e){if(this.tree){const t=this.getById(e);let n=-1;return t&&t.bubble(e=>{e.parent?n+=e.parentIndex+1:e===this.rootNode&&this.rootVisible&&(n+=1)}),n}return this.storage.indexOf(e,!0)}getDistinctValues(e){const t=[],n={};let r;return this.forEach(s=>{s.meta.specialRow||s.isRoot||(r=s.get(e),n[r]||(t.push(r),n[r]=1))}),t}getValueCount(e,t){let n=0;return this.forEach(r=>{We.isEqual(r.get(e),t)&&n++}),n}get json(){return JSON.stringify(this,null,4)}toJSON(){return(this.tree?this.rootNode.children:this).map(e=>e.toJSON())}forEach(e,t=this){const n=(n,r)=>{if(!n.isRoot&&!n.meta.specialRow)return e.call(t,n,r)};if(this.tree)this.rootNode.traverseWhile(n);else{const e=this.storage.values;for(let t=0;t<e.length;t++)if(!1===n(e[t],t))return}}map(e,t=this){return this.storage.values.map(e,t)}reduce(e,t=[],n=this){return n!==this&&(e=e.bind(n)),this.storage.values.reduce(e,t,n)}[Symbol.iterator](){return this.storage.values[Symbol.iterator]()}traverse(e){if(this.tree)this.rootNode.traverse(e,!0);else for(let t of this.storage)t.traverse(e)}getNext(e,t=!1,n=!1){let r=this.storage.values,s=this.indexOf(e);if(s>=r.length-1){if(!t)return null;s=-1}const i=r[s+1];return n&&i&&i.meta.specialRow?this.getNext(r[s+1],t,!0):i}getPrev(e,t=!1,n=!1){let r=this.storage.values,s=this.indexOf(e);if(0===s){if(!t)return null;s=r.length}const i=r[s-1];return n&&i&&i.meta.specialRow?this.getNext(r[s+1],t,!0):i}getAdjacent(e,t=!0,n=!1,r=!1){return t?this.getNext(e,n,r):this.getPrev(e,n,r)}getNextLeaf(e,t=!1){let n=this.leaves,r=this.getById(e),s=n.indexOf(r);if(s>=n.length-1){if(!t)return null;s=-1}return n[s+1]}getPrevLeaf(e,t=!1){let n=this.leaves,r=this.getById(e),s=n.indexOf(r);if(0===s){if(!t)return null;s=n.length}return n[s-1]}getAdjacentLeaf(e,t=!0,n=!1){return t?this.getNextLeaf(e,n):this.getPrevLeaf(e,n)}makeChained(e=(()=>!0),t,n){return new this.constructor(Object.assign(n||{},{chained:!0,tree:!1,autoTree:!1,masterStore:this,chainedFilterFn:e,chainedFields:t}))}chain(){return this.makeChained(...arguments)}}return e.storeMap={},e._$name="Store",e}(),zr=function(){class e extends cr{inputTemplate(){const e=this,t="inputWidth"in e?`style="width:${yt.setLength(e.inputWidth)}"`:"";return Gn.tpl`<input type="${e.inputType||"text"}"
            reference="input"
            class="${e.inputCls||""}"
            placeholder="${e.placeholder}" 
            autocomplete="${e.autoComplete}"
            name="${e.name||e.id}"
            id="${e.id+"_input"}"
            ${t}/>`}set value(e){super.value="TextField"===this.$name&&null==e?"":e}get value(){return super.value}}return e._$name="TextField",e}();E.register("textfield",zr),E.register("text",zr);const Br=function(){class e extends zr{static get defaultConfig(){return{editable:!0,pickerAlignElement:"inputWrap",value:null,triggers:{expand:{cls:"bars"}},autoClose:!0,autoExpand:null,picker:null,inputType:"text",monitorResize:!0}}doDestroy(){const e=this;e.globalTapListener&&e.globalTapListener(),e._picker&&(e.hidePicker(),e._picker.destroy(),e.pickerVisible=!1),super.doDestroy()}finalizeInit(){super.finalizeInit();const e=this;!1===e.editable?(e.element.classList.add("b-not-editable"),Kt.on({element:e.input,click:"onTriggerClick",thisObj:e})):e.globalTapListener=Cn.on({globaltap:"showKeyboard",thisObj:e})}onEditComplete(){super.onEditComplete(),this.autoClosePicker()}onElementResize(e){this.pickerVisible&&this.picker.requestAnimationFrame(this.picker.realign,null,this.picker),super.onElementResize(e)}onInternalKeyDown(e){const t=this;if(!t.disabled)if(t.pickerVisible){const{picker:n}=t;"Escape"===e.key?(e.stopPropagation(),t.hidePicker()):n.onInternalKeyDown?n.onInternalKeyDown(e):"ArrowDown"===e.key&&n.focusable&&n.focus()}else"ArrowDown"===e.key&&t.onTriggerClick(e)}onFocusIn(e){super.onFocusIn(e),this.autoExpand&&this.onTriggerClick(e)}onFocusOut(e){this.autoClosePicker(),super.onFocusOut(e)}onTriggerClick(e){this.disabled||this.togglePicker("key"in e)}showKeyboard({event:e}){const t=this.input;yt.isTouchEvent&&document.activeElement===t&&e.target===t&&(Cn.suspendFocusEvents(),t.blur(),t.focus(),Cn.resumeFocusEvents())}togglePicker(e){this.pickerVisible?this.hidePicker():this.showPicker(e)}showPicker(e){const t=this,n=t.picker;t.pickerHideShowListenersAdded||(n.on({show:"onPickerShow",hide:"onPickerHide",thisObj:t}),t.pickerHideShowListenersAdded=!0),n.autoClose=t.autoClose,n.show(),n.isVisible&&e&&t.focusPicker()}onPickerShow(){const e=this;e.pickerVisible=!0,e.element.classList.add("b-open"),e.trigger("togglePicker",{show:!0}),e.pickerTapOutRemover=Cn.on({globaltap:"onPickerTapOut",thisObj:e}),e.pickerKeyDownRemover=Kt.on({element:e.picker.element,keydown:"onPickerKeyDown",thisObj:e})}onPickerHide(){const e=this;e.pickerVisible=!1,e.element.classList.remove("b-open"),e.trigger("togglePicker",{show:!1}),e.pickerTapOutRemover&&e.pickerTapOutRemover(),e.pickerKeyDownRemover&&e.pickerKeyDownRemover()}onPickerTapOut({event:e}){this.owns(e.target)||this.autoClosePicker()}onPickerKeyDown(e){if("Tab"===e.key){const t=document.activeElement;this.input.dispatchEvent(new KeyboardEvent("keydown",e)),document.activeElement===t?this.input.focus():e.preventDefault(),this.isDestroyed||this.hidePicker()}}autoClosePicker(){this.autoClose&&this.hidePicker()}hidePicker(){this.pickerVisible&&this.picker.hide()}focusPicker(){}focus(){const e=this.input;yt.isTouchEvent&&this.editable&&(e.readOnly=!0,setTimeout(()=>e.readOnly=!1,500)),super.focus()}}return e._$name="PickerField",e}(),Vr=function(){class e extends(ue(W)){static get defaultConfig(){return{ownerCmp:null,target:null,keyEventTarget:null,processEvent:null,itemSelector:null,focusCls:"b-active",keys:null,allowCtrlKey:null,allowShiftKey:null}}set itemSelector(e){this._itemSelector=e}get itemSelector(){return this._itemSelector||`.${this.ownerCmp.itemCls}`}onKeyDown(e){const t=this,n=t.ownerCmp,r=t.activeItem,s=t.target.querySelector(t.itemSelector),i=e.key.trim()||e.code,o=`${e.ctrlKey?"CTRL+":""}${e.shiftKey?"SHIFT+":""}${e.altKey?"ALT+":""}${i}`;if(s&&t.target.offsetParent){if(null==t.inlineFlow){let e=s.parentNode,n=yt.getStyleValue(s,"position"),r=yt.getStyleValue(s,"display"),i=yt.getStyleValue(s,"float");t.inlineFlow="absolute"===n||"inline"===r||"inline-block"===r||"left"===i||"right"===i||"flex"===yt.getStyleValue(e,"display")&&"row"===yt.getStyleValue(e,"flex-direction"),t.inlineFlow?(t.prevKey="ArrowLeft",t.nextKey="ArrowRight"):(t.prevKey="ArrowUp",t.nextKey="ArrowDown")}if(t.processEvent&&!(e=t.processEvent.call(n,e)))return;if(r)switch(i){case t.prevKey:if(t.disabled||e.ctrlKey&&!t.allowCtrlKey)return;if(e.shiftKey&&!t.allowShiftKey)return;e.preventDefault(),t.navigatePrevious(e);break;case t.nextKey:if(t.disabled||e.ctrlKey&&!t.allowCtrlKey)return;if(e.shiftKey&&!t.allowShiftKey)return;e.preventDefault(),t.navigateNext(e);break;default:let r=t.keys&&t.keys[o];r&&!t.disabled?t.callback(r,t.thisObj||n,[e]):n.onInternalKeyDown&&n.onInternalKeyDown(e)}else t.activeItem=t.previousActiveItem||t.getDefaultNavigationItem(e);t.activeItem!==r&&t.trigger("navigate",{event:e,item:t.activeItem})}}getDefaultNavigationItem(e){const{target:t,itemSelector:n,prevKey:r,nextKey:s}=this;return 4&t.compareDocumentPosition(e.target)&&e.key===r?t.querySelector(`${n}:last-of-type`):2&t.compareDocumentPosition(e.target)&&e.key===s?t.querySelector(`${n}`):void 0}navigatePrevious(e){const t=this,n=t.previous;e.preventDefault(),n&&t.ownerCmp.scrollable.scrollIntoView(n,{animate:50}).then(()=>{t.activeItem=n,t.trigger("navigate",{event:e,item:t.activeItem})})}navigateNext(e){const t=this,n=t.next;e.preventDefault(),n&&t.ownerCmp.scrollable.scrollIntoView(n,{animate:50}).then(()=>{t.activeItem=n,t.trigger("navigate",{event:e,item:t.activeItem})})}get owner(){return this.ownerCmp}get previous(){const e=this.treeWalker;if(e.currentNode=this.activeItem,e.previousNode(),e.currentNode!==this.activeItem)return e.currentNode}get next(){const e=this.treeWalker;if(e.currentNode=this.activeItem,e.nextNode(),e.currentNode!==this.activeItem)return e.currentNode}onTargetFocusIn(e){e.target.matches(this.itemSelector)&&(this.activeItem=e.target)}onTargetFocusOut(e){e.relatedTarget&&this.target.contains(e.relatedTarget)||(this.activeItem=null)}onTargetMouseDown(e){this.onFocusGesture(e)}onTargetClick(e){const t=this;t.disabled||(t.processEvent&&(e=t.processEvent.call(t.ownerCmp,e)),e&&(t.activeItem=e.target.closest(t.itemSelector),t.trigger("navigate",{event:e,item:t.activeItem})))}onFocusGesture(e){(e.target===this.ownerCmp.contentElement||e.target.closest(this.itemSelector)&&!1===this.ownerCmp.itemsFocusable)&&e.preventDefault()}acceptNode(e){return e.offsetParent&&e.matches&&e.matches(this.itemSelector)?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}get activeItem(){return this._activeItem}set activeItem(e){const t=this,n=t.ownerCmp.scrollable;"number"==typeof e&&(e=t.target.querySelectorAll(t.itemSelector)[e]),e?yt.isFocusable(e)&&e!==document.activeElement?n.scrollIntoView(e,{block:"nearest",focus:!0,silent:t.scrollSilently}):(t.activeItem&&(t.previousActiveItem=t.activeItem,t.activeItem.classList.remove(t.focusCls)),n.scrollIntoView(e,{block:"nearest",silent:t.scrollSilently}),e.classList.add(t.focusCls),t._activeItem=e):(e===document.activeElement?t.ownerCmp.revertFocus():t.activeItem&&t.activeItem.classList.remove(t.focusCls),t.previousActiveItem=t.target.contains(t.activeItem)?t.activeItem:null,t._activeItem=null)}get target(){return this._target}set target(e){const t=this,n={element:e,thisObj:t,focusin:"onTargetFocusIn",focusout:"onTargetFocusOut",click:"onTargetClick"};t._target=e,t.hasOwnProperty("acceptNode")||(t.acceptNode=t.acceptNode.bind(t),t.acceptNode.acceptNode=t.acceptNode),!1===t.ownerCmp.itemsFocusable&&(n.mousedown="onTargetMouseDown"),Kt.on(n),t.treeWalker=document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT,t.acceptNode,!1),t.keyEventTarget||(t.keyEventTarget=e),(t.targetMutationMonitor=new MutationObserver(t.onTargetChildListChange.bind(t))).observe(e,{childList:!0})}onTargetChildListChange(){const e=this.activeItem;e&&!this.target.contains(e)&&(this.activeItem=this.target.querySelector(`${this.itemSelector}[data-id="${e.dataset.id}"]`))}get keyEventTarget(){return this._keyEventTarget}set keyEventTarget(e){this._keyEventTarget=e,Kt.on({element:e,keydown:"onKeyDown",thisObj:this})}}return e._$name="Navigator",e}(),Wr=document.createRange(),Ur=function(){class e extends An{static get defaultConfig(){return{itemCls:"b-list-item",selectedCls:"b-selected",items:null,store:null,navigator:!0,scrollable:{x:!1,y:!0},itemsFocusable:!0,multiSelect:!1,itemTpl:e=>e.text,selected:{},activateOnMouseover:null}}construct(e,...t){const n=this;Array.isArray(e)&&(e={items:e}),super.construct(e,...t);const r=n.element,s=r.classList;n.multiSelect&&s.add("b-multiselect"),n.store.count?n.refresh():s.add("b-empty"),Kt.on({element:r,delegate:n.itemSelector,mouseover:"onMouseOver",click:"onClick",thisObj:n}),n.storeDetacher=n.store.on({change:"onStoreChange",refresh:"onStoreRefresh",thisObj:n})}doDestroy(){this.storeDetacher&&this.storeDetacher(),super.doDestroy()}contentTpl(){return Gn.tpl`${this.store.records.map((e,t)=>this.itemWrapperTpl(e,t))}`}itemWrapperTpl(e,t){return Gn.tpl`<div class="${this.getItemClasses(e,t)}" data-index="${t}" data-id="${e.id}" ${this.itemsFocusable?'tabindex="-1"':""}>
            ${this.itemContentTpl(e,t)}
            </div>`}itemContentTpl(e,t){return Gn.tpl`${this.multiSelect?'<div class="b-selected-icon b-icon b-icon-check"></div>':""}${this.itemTpl(e,t)}`}getItemClasses(e){const t=this,n=t._navigator&&t._navigator.activeItem,r=n&&n.dataset.id==e.id,s=t.selected.includes(e);return`${t.itemCls} ${e.cls||""} ${s?t.selectedCls:""} ${r?t.navigator.focusCls:""}`}onStoreChange({action:e,records:t,record:n}){switch(e){case"remove":this.selected.remove(t);break;case"clear":this.selected.clear();break;case"update":return void this.refreshItem(n)}this.refresh()}onStoreRefresh(){this.refresh()}refresh(){const e=this;e.isVisible?(e.clearItems().insertNode(yt.createElementFromTemplate(e.contentTpl(),{fragment:!0})),e.element.classList[e.store.count>0?"remove":"add"]("b-empty")):e.on({paint:()=>e.refresh(),once:!0})}clearItems(){const e=this,t=e.contentElement.querySelector(e.itemSelector),n=e.contentElement.lastChild;return t?(Wr.setStartBefore(t),Wr.setEndAfter(e.contentElement.querySelector(`${e.itemSelector}:last-of-type`)),Wr.deleteContents()):n?(Wr.setStartAfter(n),Wr.setEndAfter(n)):(Wr.setStart(e.contentElement,0),Wr.setEnd(e.contentElement,0)),Wr}refreshItem(...e){for(const t of e){const e=this.getItem(t);if(e){const n=this.store.indexOf(t),r=yt.createElementFromTemplate(this.itemWrapperTpl(t,n));yt.sync(r,e)}}}getItem(e){return"number"==typeof e?this.contentElement.querySelector(`[data-index="${e}"]`):(null!=e.id&&(e=e.id),this.contentElement.querySelector(`[data-id="${e}"]`))}getRecord(e){return e.target&&(e=e.target),e=e.closest(this.itemSelector),this.store.getAt(parseInt(e.dataset.index))}set items(e){this.store&&this.store.autoCreated&&this.store.destroy(),this.store=Nr.getStore(e)}set selected(e){e&&e instanceof cn||(e=new cn(e)),this._selected=e,e.on({change:"onSelectionChange",thisObj:this})}get itemSelector(){return`.${this.itemCls}`}get selected(){return this._selected}get store(){return this._thisIsAUsedExpression(this.items),this._store}set store(e){e instanceof Nr||(e=new Nr(e)),this._store=e}get navigator(){return this._navigator}set navigator(e){const{element:t}=this;this._navigator=t?new(e.class||Vr)(Object.assign({ownerCmp:this,target:t,keyEventTarget:t},e)):e}get minHeight(){return super.minHeight}set minHeight(e){super.minHeight=this._minHeight=e}get minAlignHeight(){const e=this.element.lastElementChild,t=this.minHeight;if(null!=t)return this.store.count?Math.min(e.offsetTop+e.offsetHeight,t):0}alignTo(...e){super.minHeight=this.minAlignHeight,super.alignTo(...e)}hide(...e){this.navigator.activeItem=null,super.hide(...e)}show(){super.minHeight=this._minHeight;let e=this.navigator.previousActiveItem;super.show(),e&&(this.element.contains(e)||(e=this.element.querySelector(`[data-id="${e.dataset.id}"]`)),this.navigator.activeItem=e)}onMouseOver(e){const t=e.target.closest(this.itemSelector);t&&this.navigator&&this.activateOnMouseover&&(this.navigator.activeItem=t)}onClick(e){const t=e.target.closest(this.itemSelector);t&&this.onItemClick(t,e)}onInternalKeyDown(e){const t=this.navigator.activeItem;switch(e.key){case" ":if(!e.target.readOnly)break;case"Enter":t&&(this.onItemClick(t,e),e.stopImmediatePropagation(),e.preventDefault())}}onItemClick(e,t){const n=this,r=parseInt(e.dataset.index),s=n.store.getAt(r),i=n.selected,o=i.includes(s);n.trigger("item",{item:e,record:s,index:r,event:t}),e.contains(t.target.closest("[data-noselect]"))||(n.multiSelect?i[o?"remove":"add"](s):i.splice(0,i.count,s)),n.lastClicked=s}onSelectionChange({action:e,removed:t,added:n}){const r=this,{selectedCls:s}=r;let i,o;if("clear"===e)for(o of r.element.querySelectorAll(`.${s}`))o.classList.remove(s);else{for(i of t)(o=r.getItem(i))&&o.classList.remove(s);for(i of n)(o=r.getItem(i))&&o.classList.add(s)}}}return e._$name="List",e}();Ur.prototype.navigatorClass=Vr,E.register("list",Ur);const Gr=function(){class e extends Ur{static get defaultConfig(){return{itemCls:"b-chip",closable:!0,iconTpl:null,closeHandler:null}}itemContentTpl(e,t){return Gn.tpl`${this.iconTpl?this.iconTpl(e):""}
            ${this.itemTpl(e,t)}
            ${this.closable?'<div class="b-icon b-close-icon b-icon-clear" data-noselect></div>':""}`}onInternalKeyDown(e){"Delete"===e.key||"Backspace"===e.key&&this.selected.count?this.callback(this.closeHandler,this.owner,[this.selected.values,{isKeyEvent:!0}]):super.onInternalKeyDown(e)}onClick(e){const t=this,n=e.target.closest(`.${t.itemCls}`);if(t.closable&&e.target.classList.contains("b-close-icon")){const e=t.store.getAt(parseInt(n.dataset.index));t.callback(t.closeHandler,t.owner,[[e]])}else super.onClick(e)}}return e._$name="ChipView",e}();E.register("chipview",Gr);const Yr=Symbol("Combo.queryAll"),qr=Symbol("Combo.queryLast"),Xr="fieldRequired",Kr="validateFilter",Zr=function(){class e extends Br{static get defaultConfig(){return{items:null,store:null,valueField:null,displayField:"text",pickerWidth:null,minChars:1,selected:null,listItemTpl:null,displayValueRenderer:null,listCls:null,triggers:{expand:{cls:"b-icon-picker",handler:"onTriggerClick"}},overlayAnchor:null,keyStrokeFilterDelay:null,defaultAction:"select",triggerAction:Yr,filterOperator:"startsWith",caseSensitive:!1,multiSelect:null,hidePickerOnSelect:null,chipView:null,filterSelected:null,emptyText:null,value:null,validateFilter:!0,clearTextOnPickerHide:!0}}afterConfigure(){super.afterConfigure(),"_value"in this||(this._value=this.valueField===this.displayField?"":null)}eachWidget(e,t=!0){for(const n of[this.chipView,this._picker])if(n){if(!1===e(n))return;t&&n.eachWidget&&n.eachWidget(e,t)}}set element(e){const t=this;super.element=e,t.multiSelect&&(t.element.classList.add("b-multiselect"),t.chipView=new Jr(We.assign({parent:t,insertBefore:t.input,store:t.chipStore=new Nr({storage:t.valueCollection}),navigator:{class:Qr,keyEventTarget:t.input}},t.chipView)),t.chipView.element.appendChild(t.input),Kt.on({element:t.chipView.element,mousedown:"onChipViewMousedown",thisObj:t}))}onChipViewMousedown(e){e.preventDefault(),this.containsFocus||this.focus()}onChipClose(e,t={}){(t.isKeyEvent&&""===this.input.value||!t.isKeyEvent)&&this.valueCollection.remove(e)}get element(){return super.element}set keyStrokeFilterDelay(e){e&&(this.filterList=this.buffer(this.doFilter,e)),this._keyStrokeFilterDelay=e}get keyStrokeFilterDelay(){return this._keyStrokeFilterDelay}set items(e){if(null==e&&(e=[]),e instanceof Nr)return this.store=e;let t,n,r=this.valueField;const s=this,i=s.displayField;if(Array.isArray(e)?n=e.map(e=>{let n=e;return e instanceof Sr?(t=e.constructor,r||(s.valueField=r=t.idField)):"string"==typeof e?(r||(s.valueField=r=s.displayField),n={[r]:e,[i]:e}):(r||(s.valueField=r="value"),Array.isArray(e)&&(n={[r]:e[0],[i]:e[1]})),n.selected&&(s.value=n),n}):(r||(s.valueField=r="value"),n=[],Object.entries(e).forEach(([e,t])=>{n.push({[r]:e,[i]:t})})),s.store)s.store.data=n;else{const e=r===i?{name:"value",dataSource:i}:r;s.store=new Nr({data:n,idField:r,modelClass:t||class extends Sr{static get idField(){return r}static set idField(e){super.idField=e}static get fields(){return[e,i]}}})}}get items(){return this.store.allRecords}set value(e){const t=this;if(e===t.value){const e=t.highlightExternalChange;return t.highlightExternalChange=!1,t.syncInputFieldValue(),void(t.highlightExternalChange=e)}if(!t.multiSelect&&Array.isArray(e)&&e.length>1)throw new Error("Multiple values cannot be set to a non-multiselect Combo");t._thisIsAUsedExpression(t.items);const{valueField:n,displayField:r,store:s,valueCollection:i}=t;let o;if(s.filtered&&(t.primaryFilter.disabled=!0,s.filter()),null!=e){const a=Array.isArray(e)?e:[e];for(let e=0,t=a.length;e<t;e++){let i=a[e];if(i instanceof Sr)s.storage.includes(i)||s.add(i);else{const l=i instanceof Object;l&&(i=i[n]),(o=s.storage.getBy(r,i)||s.storage.getBy(n,i))?(l&&o.set(a[e]),a[e]=o):(a.splice(e,1),t--,e--)}}const l=i.generation;i.splice(0,i.count,a),i.generation===l&&t.syncInputFieldValue(),a.length||(t._value=e)}else if(i.count)i.clear();else{const n=t._value;t._value=null,t.syncInputFieldValue(),t.updateEmpty(),t.isConfiguring||t.trigger("change",{value:e,oldValue:n,userAction:t._isUserAction,valid:t.isValid})}}get value(){const e=this;return e.multiSelect?e.valueCollection.map(t=>t[e.valueField]):e.valueCollection.count?e.valueCollection.first[e.valueField]:e._value}syncInputFieldValue(){this.multiSelect||super.syncInputFieldValue()}get isEmpty(){return 0===this.valueCollection.count}get isValid(){return this.required&&!this.valueCollection.count&&this.setError(Xr,!0),super.isValid}get inputValue(){let e=this,t=e.value;return t=e.selected?e.selected[e.displayField]:t,e.displayValueRenderer&&(t=this.displayValueRenderer(e.selected)),null==t?"":t}set displayValueRenderer(e){this._displayValueRenderer=e}get displayValueRenderer(){return this._displayValueRenderer}get valueCollection(){return this._valueCollection||(this._valueCollection=new cn({listeners:{noChange:"onValueCollectionNoChange",change:"onValueCollectionChange",prio:-1e3,thisObj:this}})),this._valueCollection}set store(e){const t=this,n=[];if(Array.isArray(e))return t.initialConfig.store=null,t.items=e;!e||e instanceof Nr||(e=new Nr(e)),t.valueField||(t.valueField=e.modelClass.idField),t.primaryFilter||(t.primaryFilter=new Zt({id:"primary",property:t.displayField,operator:t.filterOperator,disabled:!0,caseSensitive:t.caseSensitive})),n.push(t.primaryFilter),t.filterSelected&&(t.selectedItemsFilter=(e=>!t.valueCollection.includes(e)),n.push(t.selectedItemsFilter)),e.filter(n),t._store=e,e.storage.addIndex(t.displayField),e.storage.addIndex(t.valueField),t.displayValueRenderer&&(e.on({change:()=>t.syncInputFieldValue()}),t.syncInputFieldValue())}get store(){return this._store}get record(){return this.selected}get records(){return this.valueCollection.values.slice()}get selected(){return this.valueCollection.first}onEditComplete(){const e=this,t=e.valueCollection.count;super.onEditComplete(),t&&(e.clearError(Kr),e.syncInputFieldValue()),e.required&&!t&&e.setError(Xr)}onTriggerClick(){const e=this;if(e.pickerVisible)e.hidePicker();else if(!e.readOnly&&!e.disabled)switch(e.triggerAction){case Yr:e.doFilter(null);break;case qr:e.doFilter(e.lastQuery);break;default:e.doFilter(e.input.value)}}internalOnInput(e){const t=this,n=t.input.value.length;t.editable&&(t.updateEmpty(),n>=t.minChars?t.filterList(t.input.value):(t.validateFilter&&t[n?"setError":"clearError"](Kr),t.hidePicker()),t.trigger("input",{value:t.input.value,event:e}))}filterList(e){this.doFilter(e)}doFilter(e){const t=this,n=t.store,r=null==e||""==e;t.lastQuery=e,t.primaryFilter.setConfig({value:e,disabled:r}),n.filter(),t.showPicker(),n.count?r||(t.picker.navigator.activeItem=0):!r&&t.validateFilter&&t.setError(Kr)}onValueCollectionChange({source:e}){const t=this,{multiSelect:n}=t,r="hidePickerOnSelect"in t?t.hidePickerOnSelect:!n,s=n?e.values.slice():e.first,i=e.values.slice(),o=t._isUserAction||r&&t.pickerVisible||!1,a=t._value;r&&t.hidePicker(),!e.count&&t.required?t.setError(Xr):(t.clearError(Xr),t.clearError(Kr)),t.validateFilter&&s&&t.clearError(Kr),t.filterSelected&&t.store.filter(),t._value=null;const l=t._value=t.value;t.syncInputFieldValue(),t.updateEmpty(),t.isConfiguring||(t.trigger("change",{value:l,oldValue:a,userAction:o,valid:t.isValid}),t.trigger("select",{record:s,records:i,userAction:t.containsFocus}),"select"===t.defaultAction&&t.trigger("action",{value:l,record:s,records:i}))}onValueCollectionNoChange({toAdd:e}){!this.multiSelect&&e.length&&this.pickerVisible&&this.picker.hide()}get picker(){return this._picker||(this.picker=!0),this._picker}set picker(e){this._picker&&this._picker.destroy(),this._picker=e instanceof An?e:this.createPicker(e)}showPicker(){const e=this,{picker:t}=e;super.showPicker(),e.overlayAnchor&&!t.align.offset&&(t.align.offset=-t.anchorSize[1],t.realign()),e.selected&&(t.navigator.activeItem=e.store.indexOf(e.selected)),e.input.focus()}createPicker(e){const t=this,{multiSelect:n,pickerWidth:r}=t,s=new Ur(We.merge({owner:t,floating:!0,scrollAction:"realign",itemsFocusable:!1,activateOnMouseover:!0,store:t.store,selected:t.valueCollection,multiSelect:n,cls:t.listCls,itemTpl:t.listItemTpl||(e=>e[t.displayField]),forElement:t[t.pickerAlignElement],align:{align:"t-b",axisLock:!0,matchSize:null==r,anchor:t.overlayAnchor,target:t[t.pickerAlignElement]},width:r,navigator:{keyEventTarget:t.input},maxHeight:324,scrollable:{overflowY:!0},autoShow:!1,focusOnHover:!1},e));return s.element.dataset.emptyText=t.emptyText||t.L("No results"),s}onPickerHide(){super.onPickerHide(),this.multiSelect&&this.clearTextOnPickerHide&&(this.input.value="")}}return e.queryAll=Yr,e.queryLast=qr,e._$name="Combo",e}();class Jr extends Gr{static get defaultConfig(){return{cls:"b-combo-chip-list",itemsFocusable:!1,multiSelect:!0,closeHandler:"up.onChipClose",itemTpl:function(e){return e[this.owner.displayField]}}}}class Qr extends Vr{static get defaultConfig(){return{allowShiftKey:!0}}onTargetClick(e){const t=e.target.closest(this.itemSelector);!t||e.shiftKey||t.contains(e.target.closest("[data-noselect]"))||this.ownerCmp.selected.clear(),super.activeItem=t}onKeyDown(e){"Enter"!==e.key&&super.onKeyDown(e)}set activeItem(e){const t=this.ownerCmp;super.activeItem=e,e&&t.selected.add(t.getRecord(e))}get activeItem(){return super.activeItem}navigatePrevious(e){const t=this.ownerCmp;t.navigator.activeItem&&!e.shiftKey&&t.selected.clear(),this.previous?super.navigatePrevious(e):this.activeItem=null}navigateNext(e){const t=this.ownerCmp;t.navigator.activeItem&&!e.shiftKey&&t.selected.clear(),this.next?super.navigateNext(e):this.activeItem=null}}E.register("combo",Zr),E.register("combobox",Zr),E.register("dropdown",Zr);const es=function(){class e{constructor(e){let{date:t,weekStartDay:n,sixWeeks:r}=e;this.constructor.updateDayNumbers(n),this.sixWeeks=r,this.date=t}set date(t){if(!(t instanceof Date)){if(t=new Date(t),isNaN(t))throw new Error("Month constructor must be passed a Date, or a valid argument to the Date constructor");const e=t.getTimezoneOffset();e&&(t=Ne.add(t,e,"minute"))}const n=this,r=Ne.getFirstDateOfMonth(t),s=Ne.getLastDateOfMonth(r),i=n.dayNumbers[r.getDay()],o=n.dayNumbers[s.getDay()];if(n._date=t,n.startDayOfMonth=1-i,n.endDayOfMonth=s.getDate()+(6-o),n.sixWeeks)for(;n.weekCount<6;)n.endDayOfMonth+=7;n.year=t.getFullYear(),n.month=t.getMonth();const a=new Date(n.year,0,1),l=new Date(n.year,1,31),c=n.month?new e({date:a,weekStartDay:n.weekStartDay}):n;n.weekBase=n.dayNumbers[a.getDay()]>3?c.startDate:new Date(n.year,0,c.startDayOfMonth-7),n.has53weeks=l.getDay()<4}get date(){return this._date}get dayCount(){return this.endDayOfMonth+1-this.startDayOfMonth}get weekCount(){return this.dayCount/7}get startDate(){return new Date(this.year,this.month,this.startDayOfMonth)}get endDate(){return new Date(this.year,this.month,this.endDayOfMonth)}eachDay(e){const t=this;for(let n=t.startDayOfMonth;n<=t.endDayOfMonth;n++)e(new Date(t.year,t.month,n))}eachWeek(e){const t=this,{weekCount:n}=t;for(let r=t.startDayOfMonth,s=0;s<n;s++){const n=[],s=t.getWeekNumber(new Date(t.year,t.month,Math.max(r,1)));for(let e=0;e<7;e++,r++)n.push(new Date(t.year,t.month,r));e(s,n)}}getWeekNumber(t){const n=this,{weekStartDay:r}=n;if((t=Ne.clearTime(t))<n.startDate||t>n.endDate)return new e({date:t,weekStartDay:r}).getWeekNumber(t);let s=Math.floor((t-n.weekBase)/864e5/7),i=t.getFullYear();if(!s){const t=new Date(n.year,0,0);return new e({date:t,weekStartDay:r}).getWeekNumber(t)}return 53!==s||n.has53weeks||(s=1,i++),[i,s]}static applyLocale(){this.updateDayNumbers()}static updateDayNumbers(e=Ne.weekStartDay){const t=this.prototype,n=t.dayNumbers=[],r=t.canonicalDayNumbers=[];t.weekStartDay=e;for(let s=0;s<7;s++){const t=(e+s)%7;r[s]=t,n[t]=s}}}return e._$name="Month",e}();he.on({locale:"applyLocale",thisObj:es});const ts=function(){class e extends Bn{static get defaultConfig(){return{weekStartDay:null,sixWeeks:!0,showWeekNumber:!1,disabledDates:null,headerRenderer:null,weekRenderer:null,cellRenderer:null,disableWeekends:null,tip:null,cellCls:"b-calendar-cell",disabledCls:"b-disabled-date",otherMonthCls:"b-other-month",weekendCls:"b-weekend",todayCls:"b-today"}}construct(e){he.on({locale:ns}),ns(),super.construct(e),this.refresh()}ingestDate(e){if(!(e instanceof Date)){if(e=new Date(e),isNaN(e))throw new Error("CalendarPanel date ingestion must be passed a Date, or a valid argument to the Date constructor");const t=e.getTimezoneOffset();t&&(e=Ne.add(e,t,"minute"))}return Ne.clearTime(e)}set tip(e){this._tip=new er(Object.assign({forElement:this.element,forSelector:".b-calendar-cell"},e)),this._tip.on({pointerOver:"onTipOverCell",thisObj:this})}get tip(){return this._tip}get element(){return super.element}set element(e){super.element=e,this.weekElements=Array.from(this.element.querySelectorAll(".b-calendar-week")),this.cellElements=Array.from(this.element.querySelectorAll(".b-calendar-week > div"))}set date(e){const t=this;e=t._date=t.ingestDate(e),t.month&&t.month.month===e.getMonth()||(t.month=new es({date:e,weekStartDay:t.weekStartDay,sixWeeks:t.sixWeeks})),t.refresh()}get date(){return this._date}set showWeekNumber(e){this.element.classList[e?"add":"remove"]("b-show-week-number"),this.floating&&(this.isAligning||this.realign())}refresh(){const e=this,t=Ne.clearTime(new Date),{cellElements:n,weekElements:r,date:s,month:i,cellCls:o,disabledCls:a,otherMonthCls:l,weekendCls:c,todayCls:d}=e;if(!s)return e.date=t;for(let g=0,m=n.length;g<m;g++)n[g].className=n[g].innerHTML="";for(let g=0;g<7;g++){const t=e.weekdayCells[g];t.className=t.innerHTML="",e.headerRenderer?e.headerRenderer(t,g):t.innerHTML=ss[e.canonicalDayNumbers[g]],t.classList.add("b-calendar-day-header")}let u=0,h=0;i.eachWeek((n,s)=>{const g=r[u].children;g[0].className="b-week-number-cell",e.weekRenderer?e.weekRenderer(g[0],n):g[0].innerHTML=n[1];for(let r=0;r<7;r++){const n=s[r],u=n.getDay(),m=g[r+1],p=m.classList;p.add(o),e.isDisabledDate(n)&&p.add(a),n.getMonth()!==i.month&&p.add(l),0!==u&&6!==u||p.add(c),n.getTime()===t.getTime()&&p.add(d),m.dataset.date=Ne.format(n,"YYYY-MM-DD"),m.dataset.cellIndex=h,e.cellRenderer?e.cellRenderer(m,n):m.innerHTML=n.getDate(),h++}u++}),e.floating&&(e.isAligning||e.realign())}isDisabledDate(e){const t=e.getDay(),n=this.disabledDates;if(this.disableWeekends&&(0===t||6===t))return!0;if(n){if("function"==typeof n)return n(e);if(Array.isArray(n))return n.some(t=>Ne.clearDate(t,!0).getTime()===Ne.clearDate(e,!0).getTime())}}get bodyConfig(){const e=super.bodyConfig,t=[];e.children=[{tag:"div",className:"b-calendar-row b-calendar-weekdays",children:this.dayNameCells},{className:"b-weeks-container",children:t}];for(let n=0;n<6;n++){let e={className:"b-calendar-row b-calendar-week",children:[]};for(let t=0;t<8;t++)e.children.push({});t.push(e)}return e}set weekStartDay(e){const t=this;t.dayNames=[],t.dayNumbers=[],t.canonicalDayNumbers=[],t._weekStartDay=null!=e?e:Ne.weekStartDay;for(let n=0;n<7;n++){const e=(t._weekStartDay+n)%7;t.canonicalDayNumbers[n]=e,t.dayNumbers[e]=n,t.dayNames[n]=ss[e]}}get weekStartDay(){return this.hasOwnProperty("_weekStartDay")||(this.weekStartDay=void 0),this._weekStartDay}get dayNameCells(){const e=document.createElement("div"),t=[e],n=this.weekdayCells=[];e.className="b-week-number-cell",this._thisIsAUsedExpression(this.weekStartDay);for(let r=0;r<7;r++){const e=document.createElement("div");t.push(e),n.push(e)}return t}onTipOverCell({source:e,target:t}){e.date=Ne.parse(t.dataset.date,"YYYY-MM-DD")}}return e._$name="CalendarPanel",e}();function ns(){ss.length=0;for(let e=2;e<9;e++)rs.setDate(e),ss.push(Ne.format(rs,"ddd"))}const rs=new Date("2000-01-01T00:00:00"),ss=[];E.register("calendarpanel",ts);const is=function(){class e extends ts{static get defaultConfig(){return{focusable:!0,tools:{prevMonth:{align:"start",cls:"b-icon b-icon-angle-left",handler:"gotoPrevMonth"},nextMonth:{align:"end",cls:"b-icon b-icon-angle-right",handler:"gotoNextMonth"}},header:{title:"\xa0",titleAlign:"center"},minDate:null,maxDate:null,outOfRangeCls:"b-out-of-range",activeCls:"b-active-date",selectedCls:"b-selected-date",focusDisabledDates:null,multiSelect:!1}}construct(e){const t=this;t.selection=[],t.refresh=t.createOnFrame(t.refresh),super.construct(e),t.element.setAttribute("aria-activedescendant",`${t.id}-active-day`),Kt.on({element:t.element,mousedown:"onPickerMousedown",click:{delegate:`.${t.cellCls}:not(.${t.disabledCls}):not(.${t.outOfRangeCls})`,handler:"onCellClick"},keydown:"onPickerKeyDown",thisObj:t})}get focusElement(){return this.element}refresh(){super.refresh(),this.title=Ne.format(this.month.date,"MMMM YYYY")}cellRenderer(e,t){const n=this,{activeCls:r,selectedCls:s}=n,i=e.classList;e.innerHTML=t.getDate(),e.setAttribute("aria-label",Ne.format(t,"MMMM D, YYYY")),n.isActiveDate(t)&&(i.add(r),e.id=`${n.id}-active-day`),n.isSelectedDate(t)&&i.add(s),n.minDate&&t<n.minDate?i.add(n.outOfRangeCls):n.maxDate&&t>n.maxDate&&i.add(n.outOfRangeCls)}onPickerMousedown(e){e.preventDefault()}onCellClick(e){this.onDateActivate(Ne.parse(e.target.dataset.date,"YYYY-MM-DD"),e)}onDateActivate(e,t){const n=this,{lastClickedDate:r,selection:s}=n;n.activeDate=e,n.lastClickedDate=e,n.multiSelect?n.multiRange||r&&e.getTime()===r.getTime()||(r&&t.shiftKey?(s[1]=e,s.sort()):(s.length=0,s[0]=e),n.trigger("selectionChange",{selection:s})):n.value&&n.value.getTime()===e.getTime()?n.hide():n.value=e}onPickerKeyDown(e){const t=this,n=e.key.trim()||e.code,r=t.activeDate;let s=new Date(r);if(r){do{switch(n){case"Escape":t.hide();break;case"ArrowLeft":e.ctrlKey?(e.preventDefault(),s.setMonth(s.getMonth()-1)):s.setDate(s.getDate()-1);break;case"ArrowUp":s.setDate(s.getDate()-7);break;case"ArrowRight":e.ctrlKey?(e.preventDefault(),s.setMonth(s.getMonth()+1)):s.setDate(s.getDate()+1);break;case"ArrowDown":s.setDate(s.getDate()+7);break;case"Enter":t.onDateActivate(r,e)}}while(t.isDisabledDate(s)&&!t.focusDisabledDates);if(t.minDate&&s<t.minDate)return;if(t.maxDate&&s>t.maxDate)return;t.activeDate=s}}set minDate(e){this._minDate=e?this.ingestDate(e):null,this.refresh()}get minDate(){return this._minDate}set maxDate(e){this._maxDate=e?this.ingestDate(e):null,this.refresh()}get maxDate(){return this._maxDate}set activeDate(e){const t=this;t._activeDate=e?t.ingestDate(e):Ne.clearTime(new Date),t.month.month!==t._activeDate.getMonth()&&(t.month.date=t._activeDate),t.refresh()}get activeDate(){return this._activeDate}set value(e){const t=this,{selection:n}=t;let r;e?(e=t.ingestDate(e),t.value&&e.getTime()===t.value.getTime()||(n.length=0,n[0]=e,t.date=e,r=!0)):(r=n.length,n.length=0,t.date=new Date),r&&t.trigger("selectionChange",{selection:n})}get value(){return this.selection[this.selection.length-1]}gotoPrevMonth(){const e=this.date;e.setMonth(e.getMonth()-1),this.date=e}gotoNextMonth(){const e=this.date;e.setMonth(e.getMonth()+1),this.date=e}isActiveDate(e){return this.activeDate&&this.ingestDate(e).getTime()===this.activeDate.getTime()}isSelectedDate(e){return this.selection.some(t=>t.getTime()===e.getTime())}}return e._$name="DatePicker",e}();E.register("datepicker",is);const os=function(){class e extends Br{static get defaultConfig(){return{format:"L",fallbackFormat:"YYYY-MM-DD",pickerFormat:null,triggers:{expand:{cls:"b-icon-calendar",handler:"onTriggerClick",weight:200}},stepTriggers:{back:{cls:"b-icon-angle-left b-step-trigger",handler:"onBackClick",align:"start",weight:100},forward:{cls:"b-icon-angle-right b-step-trigger",handler:"onForwardClick",align:"end",weight:100}},calendarContainerCls:"",min:null,max:null,step:null,picker:null}}inputTemplate(){const e=this;return Gn.tpl`<input type="${e.inputType||"text"}"
            reference="input"
            class="${e.inputCls||""}"
            min="${e.min}"
            max="${e.max}"
            placeholder="${e.placeholder}"
            name="${e.name||e.id}"
            id="${e.id+"_input"}"/>`}get picker(){return this._picker||(this.picker=!0),this._picker}set picker(e){const t=this;t._picker&&t._picker.destroy(),t._picker=e=new is(Object.assign({owner:t,forElement:t[t.pickerAlignElement],floating:!0,scrollAction:"realign",align:{align:"t0-b0",axisLock:!0,anchor:t.overlayAnchor,target:t[t.pickerAlignElement]},value:t.value,minDate:t.min,maxDate:t.max,onSelectionChange:({selection:n})=>{e.isVisible&&(t._isUserAction=!0,t.value=n[0],t._isUserAction=!1,e.hide())}},e)),t.calendarContainerCls&&e.element.classList.add(t.calendarContainerCls)}set triggers(e){super.triggers=We.assign(e,this.stepTriggers)}get triggers(){return super.triggers}onBackClick(){const e=this,{min:t}=e;if(!e.readOnly&&e.value){const n=Ne.add(e.value,-1*e._step.magnitude,e._step.unit);(!t||t.getTime()<=n)&&(e.value=n)}}onForwardClick(){const e=this,{max:t}=e;if(!e.readOnly&&e.value){const n=Ne.add(e.value,e._step.magnitude,e._step.unit);(!t||t.getTime()>=n)&&(e.value=n)}}showPicker(e){this.picker.value=this.picker.activeDate=this.value,super.showPicker(e)}focusPicker(){this.picker.focus()}get isValid(){const e=this,t=e.min,n=e.max;e.clearError("minimumValueViolation",!0),e.clearError("maximumValueViolation",!0);let r=e.value;if(r){if(r=r.getTime(),t&&t.getTime()>r)return e.setError("minimumValueViolation",!0),!1;if(n&&n.getTime()<r)return e.setError("maximumValueViolation",!0),!1}return super.isValid}transformDateValue(e){return null!=e&&("Date"!==e.constructor.name&&(e="string"==typeof e?Ne.parse(e,this.format)||Ne.parse(e,this.fallbackFormat):new Date(e)),e&&"Date"===e.constructor.name&&!isNaN(e.valueOf()))?Ne.clearTime(e):null}set min(e){const t=this;t._min=t.transformDateValue(e),t.input&&(t.input.min=t._min),t._picker&&(t._picker.minDate=t._min),t.updateInvalid()}get min(){return this._min}set max(e){const t=this;t._max=t.transformDateValue(e),t.input&&(t.input.max=t._max),t._picker&&(t._picker.maxDate=t._max),t.updateInvalid()}get max(){return this._max}set value(e){const t=this,n=t.value,r=t._picker,s=t.transformDateValue(e);!e||s?(t.clearError("invalidDate"),t.hasChanged(n,s)&&(r&&!t.inputting&&(r.value=s),super.value=s)):t.setError("invalidDate")}get value(){return super.value}set step(e){const t=this;t.element.classList[e?"add":"remove"]("b-show-steppers"),"number"==typeof e?e={magnitude:e,unit:t._step?t._step.unit:"day"}:"object"!=typeof e&&(e=Ne.parseDuration(e)),e&&e.magnitude&&e.unit&&(e.magnitude=Math.abs(e.magnitude),t._step=e,t.updateInvalid())}get step(){return this._step}hasChanged(e,t){return e&&e.getTime&&t&&t.getTime?e.getTime()!==t.getTime():super.hasChanged(e,t)}get inputValue(){let e=this.value;return e?Ne.format(e,this.format):""}set format(e){this._format=e,this.syncInputFieldValue()}get format(){return this._format}updateLocalization(){super.updateLocalization(),this.syncInputFieldValue()}internalOnKeyPress(e){super.internalOnKeyPress(e),"Enter"===e.key&&this.isValid&&this.picker.hide()}}return e._$name="DateField",e}();E.register("datefield",os),E.register("date",os);const as=function(){class e extends cr{static get defaultConfig(){return{min:null,max:null,step:1,value:0,triggers:{spin:{type:"spintrigger"}}}}internalOnKeyPress(e){G.isEdge&&"keydown"===e.type&&("ArrowUp"===e.key?(this.doSpinUp(),e.preventDefault()):"ArrowDown"===e.key&&(this.doSpinDown(),e.preventDefault())),super.internalOnKeyPress(e)}inputTemplate(){const e=this;return Gn.tpl`
            <input type="number"
                reference="input"
                min="${e.min}"
                max="${e.max}"
                step="any"
                value="${e._value}"
                autocomplete="${e.autoComplete}"
                placeholder="${e.placeholder}"
                name="${e.name||e.id}"
                id="${e.id}_input"
                ${"inputWidth"in e?`style="width:${e.inputWidth}${"number"==typeof e.inputWidth?"px":""}"`:""}/>
            `}set step(e){this.element.classList[e?"remove":"add"]("b-hide-spinner"),this._step=e}get step(){return this._step}set min(e){this._min=e,this.input&&(this.input.min=e)}get min(){return this._min}set max(e){this._max=e,this.input&&(this.input.max=e)}get max(){return this._max}doSpinUp(){let e=(this.value||0)+this.step,{min:t,max:n}=this;!isNaN(t)&&e<t&&(e=t),(isNaN(n)||e<=n)&&(this._isUserAction=!0,this.value=e,this._isUserAction=!1)}doSpinDown(){let e=(this.value||0)-this.step,{min:t,max:n}=this;!isNaN(n)&&e>n&&(e=n),(isNaN(t)||e>=t)&&(this._isUserAction=!0,this.value=e,this._isUserAction=!1)}get value(){return super.value}set value(e){e||0===e?"number"!=typeof e&&(e="string"==typeof e?parseFloat(e):Number(e),isNaN(e)&&(e="")):e=this.clearable?void 0:0,this.value!==e&&(super.value=e)}}return e._$name="NumberField",e}();E.register("numberfield",as),E.register("number",as),E.register("slider",function(){class e extends An{static get defaultConfig(){return{text:"",showValue:!0,showTooltip:!1,min:0,max:100,step:1,value:null,thumbSize:20,localizableProperties:["text"]}}construct(e){const t=this;super.construct(e),t.updateLabel(),t.showTooltip&&(t.tip=new er({forElement:t.input,anchor:!1,align:"b-t",axisLock:!0})),t.input.addEventListener("input",t.onInternalInput.bind(t)),t.input.addEventListener("change",t.onInternalChange.bind(t)),t.input.addEventListener("mouseover",t.onInternalMouseOver.bind(t)),t.input.addEventListener("mouseout",t.onInternalMouseOut.bind(t))}template(e){return Gn.tpl`
            <div class="${e.text?"b-text b-has-label":""}">
                <input type="range"
                   reference="input"
                   id="${e.id}_input"
                   min="${e.min}"
                   max="${e.max}"
                   step="${e.step}"
                   value="${e.value}">
                <label reference="label" for="${e.id}_input">${e.text}</label>
            </div>
        `}get focusElement(){return this.input}onInternalInput(e){const t=this;t._value=parseInt(t.input.value),t.updateUI(),t.trigger("input",{value:t.value})}onInternalChange(e){this.updateUI(),this.triggerChange(!0),this.trigger("action",{value:this.value})}onInternalMouseOver(e){this.updateLabel(),this.tip&&this.tip.showBy({target:this.calcThumbPosition(),offset:5})}onInternalMouseOut(e){this.tip&&this.tip.hide()}triggerChange(e){this.trigger("change",{value:this.value,userAction:e})}get text(){return this._text}set text(e){const t=this;t._text=e,t.label&&(t.showValue&&(e=e?`${e} (${t.value})`:t.value),t.label.innerHTML=e),t.tip&&(t.tip.html=t.value)}get value(){return this.input?parseInt(this.input.value):this._value}set value(e){const t=this;t._value!==e&&(t.input&&(t.input.value=e,t.updateUI(),t.triggerChange(!1)),t._value=e)}get min(){return this.input?this.input.min:this._min}set min(e){const t=this;t.input&&(t.input.min=e,t._value<e&&(t.value=e,t.trigger("input",{value:t.value}))),t._min=e}get max(){return this.input?this.input.max:this._max}set max(e){const t=this;t.input&&(t.input.max=e,t._value>e&&(t.value=e,t.trigger("input",{value:t.value}))),t._max=e}get step(){return this.input?this.input.step:this._step}set step(e){this.input&&(this.input.step=e),this._step=e}updateLabel(){this.text=this._text}updateTooltipPosition(){this.tip&&this.tip.alignTo({target:this.calcThumbPosition(),offset:5})}updateUI(){this.updateLabel(),this.updateTooltipPosition()}calcThumbPosition(){const e=this,t=oe.from(e.input),n=(t.width-e.thumbSize)*e.calcPercentProgress()/100;return new oe(t.x+n,t.y+t.height/2-e.thumbSize/2,e.thumbSize,e.thumbSize)}calcPercentProgress(){return(this.value-this.min)/(this.max-this.min)*100}}return e._$name="Slider",e}());const ls=["b-slide-out-left","b-slide-out-right","b-slide-in-left","b-slide-in-right"];Fn.registerLayout(function(){class e extends Fn{static get defaultConfig(){return{containerCls:"b-card-container",itemCls:"b-card-item",animateCardChange:!0}}setActiveItem(e){const t=this,{owner:n}=t,{contentElement:r,items:s}=n,i=e instanceof An,o=parseInt(r.dataset.activeIndex),a=s[o],l=n.items[e=i?e=s.indexOf(e):parseInt(e)],c={prevActiveIndex:o,prevActiveItem:a};if(l&&l!==a){const n=a.element,s=l&&l.element;if(c.activeIndex=e,c.activeItem=l,t.animateDetacher){const e=t.animateDetacher.event;t.animateDetacher(),e.prevActiveItem.element.classList.remove(ls),e.activeItem.element.classList.remove("b-active",...ls),t.animateDetacher=null}c.promise=new Promise((i,a)=>{n&&t.animateCardChange?(n.classList.add(e>o?"b-slide-out-left":"b-slide-out-right"),s.classList.add("b-active",e<o?"b-slide-in-left":"b-slide-in-right"),l.triggerPaint(),t.animateDetacher=Kt.on({element:s,animationend:()=>{t.animateDetacher=null,s.classList.remove(...ls),n&&n.classList.remove("b-active",...ls),r.dataset.activeIndex=e,l.focus(),i(c)},once:!0}),t.animateDetacher.reject=a,t.animateDetacher.event=c):(n&&n.classList.remove("b-active"),s.classList.add("b-active"),r.dataset.activeIndex=e,l.focus(),l.triggerPaint(),i(c))})}return c}renderChildren(){const{owner:e}=this,t=e.activeIndex;G.isIE11&&(this.animateCardChange=!1),e.items&&null!=t&&e.items[t]&&(e.contentElement.dataset.activeIndex=t,e.items[t].element.classList.add("b-active")),super.renderChildren()}get activeIndex(){return parseInt(this.owner.contentElement.dataset.activeIndex)}get activeItem(){return this.owner.items[parseInt(this.owner.contentElement.dataset.activeIndex)]}}return e._$name="Card",e}());const cs=function(){class e extends $n{static get defaultConfig(){return{template:e=>Gn.tpl`
                <div>
                    <div class="b-tabpanel-tabs" reference="tabStrip">
                        ${e.items.map((t,n)=>`\n                        <div tabindex="-1" data-index="${n}" class="b-tabpanel-tab ${n===e.activeIndex?"b-active":""} ${t.cls||""}" style="${e.tabMinWidth?"min-width:"+yt.setLength(e.tabMinWidth)+";":""} ${e.tabMaxWidth?"max-width:"+yt.setLength(e.tabMaxWidth)+";":""}" >\n                            <span class="b-tabpanel-tab-title">${t.title}</span>\n                        </div>\n                        `)}
                    </div>
                    <div class="b-tabpanel-body" reference="tabPanelBody" data-activeIndex="${e.activeIndex}">
                    </div>
                </div>
            `,itemCls:"b-tabpanel-item",defaultType:"container",activeTab:0,tabMinWidth:null,tabMaxWidth:null,animateTabChange:!0,layout:"card",suppressChildHeaders:!0}}construct(e){const t=this;super.construct(e),t.items.forEach((e,n)=>{e.titleElement=t.element.querySelector(`div.b-tabpanel-tab[data-index="${n}"] span`)}),Kt.on({element:t.tabStrip,delegate:".b-tabpanel-tab",click:"onTabElementClick",thisObj:t})}set tabMinWidth(e){this._tabMinWidth=e,this.element&&yt.forEachSelector(this.element,".b-tabpanel-tab",t=>{yt.setLength(t,"minWidth",e||null)})}get tabMinWidth(){return this._tabMinWidth}set tabMaxWidth(e){this._tabMaxWidth=e,this.element&&yt.forEachSelector(this.element,".b-tabpanel-tab",t=>{yt.setLength(t,"maxWidth",e||null)})}get tabMaxWidth(){return this._tabMaxWidth}set layout(e){super.layout=e,this.layout.animateCardChange=this.animateTabChange}get layout(){return super.layout}get contentElement(){return this.tabPanelBody}get focusElement(){const e=this.items[this.activeTab||0];return e&&e.focusElement||this.tabStrip.children[this.activeTab]}set activeTab(e){const t=this;if(t.isConfiguring)t._activeTab=e;else{const n=t.layout.setActiveItem(e),{promise:r,activeIndex:s,activeItem:i}=n;if(i){const{tabStrip:e}=t,i=e.children[t._activeTab];t._activeTab=s,i&&i.classList.remove("b-active"),e.children[s].classList.add("b-active"),r.then(()=>{t.trigger("tabchange",n)})}}}get activeIndex(){return this.activeTab}get activeTab(){return this._activeTab}get activeItem(){return this.layout.activeItem}onTabElementClick(e){this.activeTab=e.currentTarget.dataset.index}}return e._$name="TabPanel",e}();E.register("tabpanel",cs),E.register("tabs",cs);const ds=function(){class e extends Br{static get defaultConfig(){return{triggers:null,inline:!0,resize:"none"}}startConfigure(e){this._thisIsAUsedExpression(this.inline),super.startConfigure(e)}inputTemplate(){const e=this;return e.inline?Gn.tpl`<textarea
                reference="input"
                class="${e.inputCls||""}"
                placeholder="${e.placeholder}"
                name="${e.name||e.id}"
                style="resize:${e.resize}"
                id="${e.id+"_input"}"></textarea>`:Gn.tpl`<input type="text"
                readOnly="readonly"
                reference="displayElement"
                placeholder="${e.placeholder}"/>`}get focusElement(){return this.inline||this._picker&&this._picker.isVisible?this.input:this.displayElement}showPicker(){this.picker.width=this.pickerWidth||this[this.pickerAlignElement].offsetWidth,super.showPicker(!0)}focusPicker(){this.input.focus()}onPickerKeyDown(e){const t=this,n=t.input;switch(e.key.trim()||e.code){case"Escape":return void t.picker.hide();case"Enter":e.ctrlKey&&(t.syncInputFieldValue(),t.picker.hide())}t.input=t.displayElement;const r=super.onPickerKeyDown(e);return t.input=n,r}syncInputFieldValue(){this.displayElement&&(this.displayElement.value=this.inputValue),super.syncInputFieldValue()}set value(e){super.value=null==e?"":e}get value(){return super.value}set inline(e){this._inline=e,e||this.triggers||(this.triggers={})}set triggers(e){this.inline||((e||(e={})).expand={cls:"b-icon-picker",handler:"onTriggerClick"}),super.triggers=e}get triggers(){return super.triggers}get inline(){return this._inline}get picker(){return this._picker||(this.picker=!0),this._picker}set picker(e){const t=this;t._picker&&t._picker.destroy(),e.width&&(t.pickerWidth=e.width),t._picker=new An(We.merge({cls:"b-textareafield-picker",owner:t,floating:!0,scrollAction:"realign",forElement:t[t.pickerAlignElement],align:{align:"t-b",axisLock:!0,anchor:t.overlayAnchor,target:t[t.pickerAlignElement]},html:`<textarea id="${t.id+"_input"}" style="resize:${t.resize}">${t.value}</textarea>`,autoShow:!1},e));const n=t.input=t.picker.element.querySelector(`#${t.id}_input`);t.inputListenerRemover=Kt.on({element:n,thisObj:t,focus:"internalOnInputFocus",change:"internalOnChange",input:"internalOnInput",keydown:"internalOnKeyPress",keypress:"internalOnKeyPress",keyup:"internalOnKeyPress"})}}return e._$name="TextAreaField",e}();E.register("textareafield",ds),E.register("textarea",ds);const us=function(){class e extends Vn{static get defaultConfig(){return{items:[{type:"number",ref:"fieldHours",min:0,max:23},{html:"<label>:</label>"},{type:"number",ref:"fieldMinutes",min:0,max:59},{type:"button",text:"AM",toggleGroup:"am-pm",ref:"buttonAM",cls:"b-blue"},{type:"button",text:"PM",toggleGroup:"am-pm",ref:"buttonPM",cls:"b-blue"}],float:"1",autoShow:!1,trapFocus:!0,value:Ne.getTime(0),format:null}}construct(e){const t=this;super.construct(e),t._pm=!1,t.fieldHours.on("change",t.onFieldChange,t),t.fieldMinutes.on("change",t.onFieldChange,t),t.buttonAM.on("click",t.onButtonAMClick,t),t.buttonPM.on("click",t.onButtonPMClick,t),Kt.on({element:t.element,keydown:"onPickerKeyDown",thisObj:t}),Kt.on({element:t.fieldHours.element,keydown:"onPickerKeyDown",thisObj:t}),Kt.on({element:t.fieldMinutes.element,keydown:"onPickerKeyDown",thisObj:t}),t.refresh()}onFieldChange(){this._time&&(this.value=this.pickerToTime())}onButtonAMClick(){this._pm=!1,this._time&&(this.value=this.pickerToTime())}onButtonPMClick(){this._pm=!0,this._time&&(this.value=this.pickerToTime())}onPickerKeyDown(e){const t=this;switch(e.key&&e.key.trim()||e.code){case"Escape":t.triggerTimeChange(t._initialValue),t.hide(),e.preventDefault();break;case"Enter":t.value=t.pickerToTime(),t.hide(),e.preventDefault()}}pickerToTime(){const e=this,t=e._pm;let n=e.fieldHours.value,r=new Date(e._time);return e._is24Hour||(t&&n<12&&(n+=12),t||12!==n||(n=0)),r.setHours(n),r.setMinutes(e.fieldMinutes.value),e._min&&(r=Ne.max(e._min,r)),e._max&&(r=Ne.min(e._max,r)),r}triggerTimeChange(e){this.trigger("timeChange",{time:e})}set value(t){const n=this;let r=!1;t&&n._time?t.getTime()!==n._time.getTime()&&(n._time=t,r=!0):(n._time=e.defaultConfig.value,r=!0),r&&(n.isVisible&&n.triggerTimeChange(n.value),n.refresh())}get value(){return this._time}set format(e){this._format=e,this._is24Hour=Ne.is24HourFormat(this._format),this.refresh()}get format(){return this._format}set min(e){this._min=e}get min(){return this._min}set max(e){this._max=e}get max(){return this._max}set initialValue(e){this.value=e,this._initialValue=e}get initialValue(){return this._initialValue}get buttonAM(){return this.widgetMap.buttonAM}get buttonPM(){return this.widgetMap.buttonPM}get fieldHours(){return this.widgetMap.fieldHours}get fieldMinutes(){return this.widgetMap.fieldMinutes}refresh(){const e=this;if(!e.isConfiguring){const t=e._time,n=e._is24Hour,r=t.getHours(),s=e._pm=r>=12,i=e.fieldHours;e.element.classList[n?"add":"remove"]("b-24h"),i.min=n?0:1,i.max=n?23:12,i.value=n?r:r%12||12,e.fieldMinutes.value=t.getMinutes(),e.buttonAM.pressed=!s,e.buttonPM.pressed=s,e.buttonAM.hidden=e.buttonPM.hidden=n}}}return e._$name="TimePicker",e}();E.register("timepicker",us);const hs=function(){class e extends Br{static get defaultConfig(){return{format:"LT",triggers:{back:{cls:"b-icon b-icon-angle-left",handler:"onBackClick",align:"start"},expand:{template:()=>`<div class="b-align-${this.align||"end"}"><div class="b-icon-clock-live"></div></div>`,handler:"onTriggerClick",align:"end"},forward:{cls:"b-icon b-icon-angle-right",handler:"onForwardClick",align:"end"}},min:null,max:null,step:"5m"}}get picker(){return this._picker||(this.picker=!0),this._picker}set picker(e){const t=this;t._picker&&t._picker.destroy(),t._picker=new us(Object.assign({owner:t,floating:!0,forElement:t[t.pickerAlignElement],align:{align:"t0-b0",axisLock:!0,anchor:t.overlayAnchor,target:t[t.pickerAlignElement]},value:t.value,format:t.format,onTimeChange({time:e}){t._isUserAction=!0,t.value=e,t._isUserAction=!1}},e))}onBackClick(){const e=this,{min:t}=e;if(!e.readOnly&&e.value){const n=Ne.add(e.value,-1*e._step.magnitude,e._step.unit);(!t||t.getTime()<=n)&&(e._isUserAction=!0,e.value=n,e._isUserAction=!1)}}onForwardClick(){const e=this,{max:t}=e;if(!e.readOnly&&e.value){const n=Ne.add(e.value,e._step.magnitude,e._step.unit);(!t||t.getTime()>=n)&&(e._isUserAction=!0,e.value=n,e._isUserAction=!1)}}get isValid(){const e=this;e.clearError("minimumValueViolation",!0),e.clearError("maximumValueViolation",!0);let t=e.value;if(t){if(t=t.getTime(),e._min&&e._min.getTime()>t)return e.setError("minimumValueViolation",!0),!1;if(e._max&&e._max.getTime()<t)return e.setError("maximumValueViolation",!0),!1}return super.isValid}hasChanged(e,t){return e&&e.getTime&&t&&t.getTime?e.getTime()!==t.getTime():super.hasChanged(e,t)}showPicker(e){const t=this,n=t.picker;n.initialValue=t.value,n.format=t.format,n.maxTime=t.max,n.minTime=t.min,t.value=n.value,super.showPicker(e)}onPickerShow(){super.onPickerShow(),this.pickerKeyDownRemover&&this.pickerKeyDownRemover()}focusPicker(){this.picker.focus()}transformTimeValue(e){return null!=e&&("Date"!==e.constructor.name&&(e="string"==typeof e?Ne.parse(e,this.format):new Date(e)),e&&"Date"===e.constructor.name&&!isNaN(e.valueOf()))?((e=Ne.clone(e)).setFullYear(1970,0,1),e):null}set min(e){const t=this;t._min=t.transformTimeValue(e),t.input&&(t.input.min=t._min),t.updateInvalid()}get min(){return this._min}set max(e){const t=this;t._max=t.transformTimeValue(e),t.input&&(t.input.max=t._max),t.updateInvalid()}get max(){return this._max}set value(e){const t=this,n=t.value,r=t.transformTimeValue(e);!e||r?(t.clearError("invalidTime"),t.hasChanged(n,r)&&(t.triggers.expand&&r&&(t.triggers.expand.element.firstElementChild.style.animationDelay=-(60*r.getHours()+r.getMinutes())/10+"s"),super.value=r)):t.setError("invalidTime")}get value(){return super.value}set step(e){"number"==typeof e?e={magnitude:e,unit:this._step.unit}:"object"!=typeof e&&(e=Ne.parseDuration(e)),e&&e.magnitude&&e.unit&&(e.magnitude=Math.abs(e.magnitude),this._step=e,this.updateInvalid())}get step(){return this._step}set format(e){this._format=e,this.syncInputFieldValue()}get format(){return this._format}get inputValue(){return Ne.format(this.value,this.format)}updateLocalization(){super.updateLocalization(),this.syncInputFieldValue()}}return e._$name="TimeField",e}();E.register("timefield",hs),E.register("time",hs),I._adapter||(I.adapter=function(){class e{createWidget(e){return E.createWidget(e.type,e)}getClass(e){return E.getClass(e)}appendWidget(e){return this.createWidget(e)}appendWidgets(e,t){return e.map(e=>this.appendWidget(We.assign({},t||{},e)))}openPopup(e,t){return new Vn(We.assign({forElement:e},"string"==typeof t?{html:t}:t))}showContextMenu(e,t){const n=this;return n.currentContextMenu&&n.currentContextMenu.destroy(),e instanceof HTMLElement?t.forElement=e:Array.isArray(e)?t.forElement={target:new It(...e)}:e instanceof It&&(t.forElement={target:e}),n.currentContextMenu=new Zn(t),n.currentContextMenu.on("destroy",()=>{n.currentContextMenu=null}),n.currentContextMenu}attachTooltip(e,t){return"string"==typeof t&&(t={html:t}),new er(Object.assign({forElement:e},t)),e}hasTooltipAttached(e){return er.hasTooltipAttached(e)}destroyTooltipAttached(e){return er.destroyTooltipAttached(e)}mask(e,t="Loading"){if(e)return e instanceof HTMLElement&&(e={element:e,text:t}),xt.mask(e,e.element)}unmask(e,t=!0){e.mask&&(t?e.mask.close():e.mask.hide())}toast(e){return Jn.show(e)}set defaultStyle(e){this._defaultStyle=e}get defaultStyle(){return this._defaultStyle}}return e._$name="BryntumWidgetAdapter",e}());const gs=(e,t)=>(Array.isArray(t[1])?t[1].forEach(n=>e.push(t[0]+"="+n)):e.push(t[0]+"="+t[1]),e),ms=new Promise(e=>e()),ps=function(){class e extends Nr{static get defaultConfig(){return{headers:null,fetchOptions:null,sendAsFormData:!1,writeAllFields:!1,parentIdParamName:"id",responseDataProperty:"data"}}afterConstruct(e){super.afterConstruct(e),this.autoLoad&&this.load().catch(e=>{})}get isLoading(){return this._isLoading}get isCommitting(){return Boolean(this.commitPromise)}buildQueryString(...e){const t=Object.entries(Object.assign({},...e)).reduce(gs,[]).join("&");return t?"?"+t:""}internalLoad(e,t,n){const r=this,s=Object.assign({},r.params,e),i={action:"read"+t,params:s};return r.readUrl?new Promise((e,o)=>{if(!1===r.trigger("beforeLoad"+t,i))return o(!1);r._isLoading=!0,r.trigger(`load${t}Start`,i),r.trigger("beforeRequest",i),ae.get(r.readUrl+r.buildQueryString(s),Object.assign({headers:r.headers,parseJson:!0},r.fetchOptions)).then(s=>{const a=s.parsedJson,l=Array.isArray(a),c=l||a&&!1!==a.success;r._isLoading=!1,i.response=s,i.json=a,c?(i.data=l?a:a[r.responseDataProperty],n(i),r.trigger("load"+t,i),e(i)):(i.exception=!0,i.exceptionType="server",r.trigger("exception",i),o(i)),r.trigger("afterRequest",i)}).catch(e=>{r._isLoading=!1,i.exception=!0,e instanceof Response?(i.exceptionType=e.ok?"server":"network",i.response=e,i.error=e.error):(i.exceptionType="server",i.error=e),r.trigger("exception",i),o(i),r.trigger("afterRequest",i)})}):null}load(e){const t=this;return t.internalLoad(e,"",e=>{t.data=e.data})}async loadChildren(e){return this.internalLoad({[this.parentIdParamName]:e.id},"Children",t=>{t.parentRecord=e,e.data[e.constructor.childrenField]=t.data,e.processChildren(e.stores)})}commit(){const e=this,t=e.changes,n=[];if(e.commitPromise)return!1;if(!t)return ms;if([...t.added,...t.modified,...t.removed].forEach(e=>e.meta.committing=!0),!e.disabled&&!1!==e.trigger("beforeCommit",{changes:t})){let r={action:"commit",exception:!1,changes:t},s=e.commitRemoved(r);return s&&n.push(s),(s=e.commitAdded(r))&&n.push(s),(s=e.commitModified(r))&&n.push(s),n.length?(s=1===n.length?n[0]:Promise.all(n),e.commitPromise=new Promise((n,i)=>{s.then(()=>{e.commitPromise=null,r.exception?(e.trigger("exception",r),i(r)):(e.trigger("commit",{changes:t}),n(r))}).catch(()=>{e.commitPromise=null,i(r)})})):(e.modified.forEach(e=>e.clearChanges(!1)),e.modified.clear(),e.added.forEach(e=>e.clearChanges(!1)),e.added.clear(),e.removed.clear(),e.trigger("commit",{changes:t}),ms)}}commitAdded(e){const t=this,n=t.added,r={action:"create",params:t.params};return n.count&&t.createUrl?new Promise(s=>{const i=n.values.map(e=>e.persistableData);e.create=r,t.trigger("beforeRequest",r);let o={data:i};if(t.sendAsFormData){const e=new FormData;e.append("data",JSON.stringify(i)),o=e}ae.post(t.createUrl+t.buildQueryString(t.params),o,Object.assign({headers:t.headers,parseJson:!0},t.fetchOptions)).then(i=>{const o=i.parsedJson,a=Array.isArray(o),l=a||o&&!1!==o.success;r.json=o,r.response=i,l?(t.processReturnedData(n.values,a?o:o[t.responseDataProperty]),t.added.forEach(e=>e.clearChanges(!1)),n.clear(),t.trigger("commitAdded"),t.trigger("refresh",r),s(e)):(n.forEach(e=>e.meta.committing=!1),e.exception=r.exception=!0,e.exceptionType=r.exceptionType="server",t.trigger("exception",r),s(e)),t.trigger("afterRequest",r)}).catch(i=>{n.forEach(e=>e.meta.committing=!1),e.exception=r.exception=!0,i instanceof Response?(r.exceptionType=i.ok?"server":"network",r.response=i,r.error=i.error):(r.exceptionType="server",r.error=i),t.trigger("exception",r),s(e),t.trigger("afterRequest",r)})}):null}commitModified(e){let t=this,n=t.modified,r={action:"update",params:t.params};return n.count&&t.updateUrl?new Promise(s=>{const i=n.map(e=>t.writeAllFields?e.persistableData:e.modifications);e.update=r,t.trigger("beforeRequest",r);let o={data:i};if(t.sendAsFormData){const e=new FormData;e.append("data",JSON.stringify(i)),o=e}ae.post(t.updateUrl+t.buildQueryString(t.params),o,Object.assign({headers:t.headers,parseJson:!0},t.fetchOptions)).then(i=>{const o=i.parsedJson,a=Array.isArray(o),l=a||o&&!1!==o.success;r.json=o,r.response=i,l?(t.processReturnedData(t.modified.values,a?o:o[t.responseDataProperty],!0),n.forEach(e=>e.clearChanges(!1)),n.clear(),t.trigger("commitModified"),t.trigger("refresh",r),s(e)):(n.forEach(e=>e.meta.committing=!1),e.exception=r.exception=!0,r.exceptionType="server",t.trigger("exception",r),s(e)),t.trigger("afterRequest",r)}).catch(i=>{n.forEach(e=>e.meta.committing=!1),e.exception=r.exception=!0,i instanceof Response?(r.exceptionType=i.ok?"server":"network",r.response=i,r.error=i.error):(r.exceptionType="server",r.error=i),t.trigger("exception",r),s(e),t.trigger("afterRequest",r)})}):null}processReturnedData(e,t,n=!1){const r=this.modelClass,s=r.fieldMap.id.dataSource;t.forEach((t,i)=>{e[i].syncId(t[s]),Object.assign(e[i].data,r.processData(t,n))})}commitRemoved(e){const t=this,n=t.removed,r={action:"delete",params:t.params};return n.count&&t.deleteUrl?new Promise(s=>{e.delete=r,t.trigger("beforeRequest",r);let i={ids:n.map(e=>e.id)};if(t.sendAsFormData){const e=new FormData;e.append("id",JSON.stringify(i.ids)),i=e}ae.post(t.deleteUrl+t.buildQueryString(t.params),i,Object.assign({headers:t.headers,parseJson:!0},t.fetchOptions)).then(i=>{const o=i.parsedJson,a=Array.isArray(o)||o&&!1!==o.success;r.json=o,r.response=i,a?(n.forEach(e=>e.meta.committing=!1),n.clear(),t.trigger("commitRemoved"),t.trigger("refresh",r),s(e)):(n.forEach(e=>e.meta.committing=!1),e.exception=r.exception=!0,r.exceptionType="server",t.trigger("exception",r),s(e)),t.trigger("afterRequest",r)}).catch(i=>{n.forEach(e=>e.meta.committing=!1),e.exception=r.exception=!0,i instanceof Response?(r.exceptionType=i.ok?"server":"network",r.response=i,r.error=i.error):(r.exceptionType="server",r.error=i),t.trigger("exception",r),s(e),t.trigger("afterRequest",r)})}):null}}return e._$name="AjaxStore",e}(),fs=function(){class e{static get(e,t){const n=e._domData||(e._domData={});return null!=t?n[t]:n}static set(e,t,n){3===arguments.length?(e._domData||(e._domData={}))[t]=n:e._domData=t}static assign(e,t){Object.assign(e._domData||(e._domData={}),t)}}return e._$name="DomDataStore",e}(),vs=()=>{throw new Error("Abstract method call!")},ys=()=>{throw new Error("Method cannot be called at this state!")},bs=function(){class e extends W{canUndo(e){vs()}canRedo(e){vs()}onUndo(e){vs()}onRedo(e){vs()}onStartTransaction(e){vs()}onStopTransaction(e){vs()}onStopTransactionDelayed(e){vs()}onRejectTransaction(e){vs()}onEnable(e){vs()}onDisable(e){vs()}onAutoRecordOn(e){vs()}onAutoRecordOff(e){vs()}onResetQueue(e){vs()}onModelUpdate(e){vs()}onStoreModelAdd(e){vs()}onStoreModelInsert(e){vs()}onStoreModelRemove(e){vs()}onStoreModelRemoveAll(e){vs()}onModelInsertChild(e){vs()}onModelRemoveChild(e){vs()}}return e._$name="StateBase",e}(),Cs=Symbol("STATE_PROP"),ws=Symbol("STORES_PROP"),Ss=Symbol("QUEUE_PROP"),Ds=Symbol("POS_PROP"),Es=Symbol("TRANSACTION_PROP"),xs=Symbol("TRANSACTION_TIMER_PROP"),Ts=Symbol("AUTO_RECORD_PROP"),Rs=(Object.freeze([Cs,ws,Ss,Ds,Es,xs,Ts]),new Map);var ks=(e,t)=>{Rs.set(e,t)},Ms=e=>("string"==typeof e&&(e=Rs.get(e)),e);const Is=(e,t)=>{const{undo:n,redo:r}=t;let s;return[s=n&&!r?{[Ss]:e[Ss].slice(e.position),[Ds]:0}:r&&!n?{[Ss]:e[Ss].slice(0,e.position)}:{[Ss]:[],[Ds]:0},()=>{e.notifyStoresAboutQueueReset(t)}]},As=new class extends bs{canUndo(){return!1}canRedo(){return!1}onUndo(){ys()}onRedo(){ys()}onEnable(e){return e.autoRecord?"autoreadystate":"readystate"}onDisable(){ys()}onAutoRecordOn(){return{[Ts]:!0}}onAutoRecordOff(){return{[Ts]:!1}}onStartTransaction(){ys()}onStopTransaction(){ys()}onStopTransactionDelayed(){ys()}onRejectTransaction(){ys()}onResetQueue(e,t){return Is(e,t)}onModelUpdate(){}onModelInsertChild(){}onModelRemoveChild(){}onStoreModelAdd(){}onStoreModelInsert(){}onStoreModelRemove(){}onStoreRemoveAll(){}};ks("disabledstate",As);const Fs=Symbol("ACTION_QUEUE_PROP"),Os=function(){class e extends W{get defaultConfig(){return{title:null}}construct(...e){this[Fs]=[],super.construct(...e)}get queue(){return this[Fs].slice(0)}get length(){return this[Fs].length}addAction(e){this[Fs].push(e)}undo(){const e=this[Fs];for(let t=e.length-1;t>=0;--t)e[t].undo()}redo(){const e=this[Fs];for(let t=0,n=e.length;t<n;++t)e[t].redo()}}return e._$name="Transaction",e}();class Ls extends bs{canUndo(e){return 0<e.position&&e.position<=e.length}canRedo(e){return 0<=e.position&&e.position<e.length}onUndo(e,t){const n=e[Ss];let r=e.position,s=Math.max(0,r-t);return[{[Cs]:"restoringstate",[Ds]:s},()=>{for(e.notifyStoresAboutStateRestoringStart();r!=s;)n[--r].undo();return[e.autoRecord?"autoreadystate":"readystate",()=>{e.notifyStoresAboutStateRestoringStop()}]}]}onRedo(e,t){const n=e[Ss];let r=e.position,s=Math.min(n.length,r+t);return[{[Cs]:"restoringstate",[Ds]:s},()=>{e.notifyStoresAboutStateRestoringStart();do{n[r++].redo()}while(r!=s);return[e.autoRecord?"autoreadystate":"readystate",()=>{e.notifyStoresAboutStateRestoringStop()}]}]}onEnable(){ys()}onDisable(){return"disabledstate"}onAutoRecordOn(){return{[Cs]:"autoreadystate",[Ts]:!0}}onAutoRecordOff(){ys()}onStartTransaction(e,t){const n=new Os({title:t});return[{[Cs]:"recordingstate",[Es]:n},()=>{e.notifyStoresAboutStateRecordingStart(n)}]}onStopTransaction(){ys()}onStopTransactionDelayed(){ys()}onRejectTransaction(){ys()}onResetQueue(e,t){return Is(e,t)}onModelUpdate(){}onModelInsertChild(){}onModelRemoveChild(){}onStoreModelAdd(){}onStoreModelInsert(){}onStoreModelRemove(){}onStoreRemoveAll(){}}let _s=new Ls;ks("readystate",_s);class Ps extends bs{canUndo(){return!1}canRedo(){return!1}onEnable(){}onDisable(e){return e.notifyStoresAboutStateRecordingStop(e[Es],{disabled:!0}),{[Cs]:"disabledstate",[Es]:null}}onAutoRecordOn(e){return[{[Cs]:"autorecordingstate",[Ts]:!0},()=>{e[Cs].onStopTransactionDelayed(e)}]}onAutoRecordOff(){ys()}onStartTransaction(){ys()}onStopTransaction(e,t){const n=e[Es];let r=e[Ds],s=e[Ss];return n.length&&(n.title||t||!e.getTransactionTitle?t&&(n.title=t):n.title=e.getTransactionTitle(n),s[r]=n,s.length=++r),[{[Cs]:"readystate",[Ds]:r,[Es]:null},()=>{e.notifyStoresAboutStateRecordingStop(n,{stop:!0})}]}onRejectTransaction(e){const t=e[Es];return[{[Cs]:"restoringstate",[Es]:null},()=>(t.length&&t.undo(),["readystate",()=>{e.notifyStoresAboutStateRecordingStop(t,{rejected:!0})}])]}onStopTransactionDelayed(){ys()}onQueueReset(){ys()}onModelUpdate(e,t,n,r){e[Es].addAction(e.makeModelUpdateAction(t,n,r))}onModelInsertChild(e,t,n,r,s,i){e[Es].addAction(e.makeModelInsertChildAction(t,n,r,s,i))}onModelRemoveChild(e,t,n,r){e[Es].addAction(e.makeModelRemoveChildAction(t,n,r))}onStoreModelAdd(e,t,n,r){e[Es].addAction(e.makeStoreModelAddAction(t,n,r))}onStoreModelInsert(e,t,n,r,s,i){e[Es].addAction(e.makeStoreModelInsertAction(t,n,r,s,i))}onStoreModelRemove(e,t,n,r,s){e[Es].addAction(e.makeStoreModelRemoveAction(t,n,r,s))}onStoreRemoveAll(e,t,n,r){e[Es].addAction(e.makeStoreRemoveAllAction(t,n,r))}}const $s=new Ps;ks("recordingstate",$s);const js=new class extends bs{canUndo(){return!1}canRedo(){return!1}onUndo(){ys()}onRedo(){ys()}onEnable(){ys()}onDisable(){ys()}onAutoRecordOn(){return{[Ts]:!0}}onAutoRecordOff(){return{[Ts]:!1}}onStartTransaction(){ys()}onStopTransaction(){ys()}onStopTransactionDelayed(){ys()}onRejectTransaction(){ys()}onQueueReset(){ys()}onModelUpdate(){}onModelInsertChild(){}onModelRemoveChild(){}onStoreModelAdd(){}onStoreModelInsert(){}onStoreModelRemove(){}onStoreRemoveAll(){}};ks("restoringstate",js);const Hs=new class extends Ls{onAutoRecordOn(){ys()}onAutoRecordOff(){return{[Cs]:"readystate",[Ts]:!1}}onStartTransaction(e,t){const n=new Os({title:t});return[{[Cs]:"autorecordingstate",[Es]:n},()=>{e.notifyStoresAboutStateRecordingStart(n),e.stopTransactionDelayed()}]}onModelUpdate(e,t,n,r){e.startTransaction(),e.onModelUpdate(t,n,r)}onModelInsertChild(e,t,n,r,s){e.startTransaction(),e.onModelInsertChild(t,n,r,s)}onModelRemoveChild(e,t,n,r){e.startTransaction(),e.onModelRemoveChild(t,n,r)}onStoreModelAdd(e,t,n,r){e.startTransaction(),e.onStoreModelAdd(t,n,r)}onStoreModelInsert(e,t,n,r,s,i){e.startTransaction(),e.onStoreModelInsert(t,n,r,i)}onStoreModelRemove(e,t,n,r,s){e.startTransaction(),e.onStoreModelRemove(t,n,r,s)}onStoreRemoveAll(e,t,n,r){e.startTransaction(),e.onStoreRemoveAll(t,n,r)}};ks("autoreadystate",Hs);const Ns=new class extends(U(Ps)){onDisable(e){const t=e[Es],n=e[xs];return n&&this.clearTimeout(n),e.notifyStoresAboutStateRecordingStop(t,{disabled:!0}),{[Cs]:"disabledstate",[Es]:null,[xs]:null}}onAutoRecordOn(e){ys()}onAutoRecordOff(e){const t=e[xs];return t&&this.clearTimeout(t),{[Cs]:"recordingstate",[Ts]:!1,[xs]:null}}onStopTransaction(e,t){const n=e[Es],r=e[xs];let s=e[Ds],i=e[Ss];return r&&this.clearTimeout(r),n.length&&(n.title||t||!e.getTransactionTitle?t&&(n.title=t):n.title=e.getTransactionTitle(n),i[s]=n,i.length=++s),[{[Cs]:"autoreadystate",[Ds]:s,[Es]:null,[xs]:null},()=>{e.notifyStoresAboutStateRecordingStop(n,{stop:!0})}]}onStopTransactionDelayed(e){let t=e[xs];return t&&this.clearTimeout(t),t=this.setTimeout(()=>{e.stopTransaction()},e.autoRecordTransactionStopTimeout),{[Cs]:Ns,[xs]:t}}onRejectTransaction(e){const t=e[Es],n=e[xs];return n&&this.clearTimeout(n),[{[Cs]:"restoringstate",[Es]:null,[xs]:null},()=>(t.length&&t.undo(),["autoreadystate",()=>{e.notifyStoresAboutStateRecordingStop(t,{rejected:!0})}])]}onModelUpdate(e,...t){super.onModelUpdate(e,...t),e.stopTransactionDelayed()}onModelInsertChild(e,...t){super.onModelInsertChild(e,...t),e.stopTransactionDelayed()}onModelRemoveChild(e,...t){super.onModelRemoveChild(e,...t),e.stopTransactionDelayed()}onStoreModelAdd(e,...t){super.onStoreModelAdd(e,...t),e.stopTransactionDelayed()}onStoreModelInsert(e,...t){super.onStoreModelInsert(e,...t),e.stopTransactionDelayed()}onStoreModelRemove(e,...t){super.onStoreModelRemove(e,...t),e.stopTransactionDelayed()}onStoreRemoveAll(e,...t){super.onStoreRemoveAll(e,...t),e.stopTransactionDelayed()}};ks("autorecordingstate",Ns);const zs=()=>{throw new Error("Abstract method call!")},Bs=function(){class e extends W{get type(){return this.constructor.name}undo(){zs()}redo(){zs()}}return e._$name="ActionBase",e}(),Vs=Symbol("MODEL_PROP"),Ws=Symbol("NEW_DATA_PROP"),Us=Symbol("OLD_DATA_PROP"),Gs=function(){class e extends Bs{static get defaultConfig(){return{model:void 0,newData:void 0,oldData:void 0}}get type(){return"UpdateAction"}get model(){return this[Vs]}set model(e){this[Vs]=e}get newData(){return this[Ws]}set newData(e){this[Ws]=Object.assign({},e)}get oldData(){return this[Us]}set oldData(e){this[Us]=Object.assign({},e)}undo(){this.model.set(this.oldData)}redo(){this.model.set(this.newData)}}return e._$name="UpdateAction",e}(),Ys=Symbol("PARENT_MODEL_PROP"),qs=Symbol("CHILD_MODELS_PROP"),Xs=Symbol("INSERT_INDEX_PROP"),Ks=Symbol("CONTEXT_PROP"),Zs=function(){class e extends Bs{static get defaultConfig(){return{parentModel:void 0,childModels:void 0,insertIndex:void 0,context:void 0}}get type(){return"InsertChildAction"}get parentModel(){return this[Ys]}set parentModel(e){this[Ys]=e}get childModels(){return this[qs]}set childModels(e){this[qs]=e.slice(0)}get insertIndex(){return this[Xs]}set insertIndex(e){this[Xs]=e}get context(){return this[Ks]}set context(e){this[Ks]=e}undo(){const{parentModel:e,context:t,childModels:n}=this;n.sort((e,n)=>{const{lhsParent:r,lhsIndex:s}=t.get(e)||{},{rhsParent:i,rhsIndex:o}=t.get(n)||{};return r&&r===i?s-o:0}),n.forEach(n=>{const{parent:r,index:s}=t.get(n)||{};r?r.insertChild(n,r===e?r.children[s+1]:r.children[s]):e.removeChild(n)})}redo(){this.parentModel.insertChild(this.insertIndex,this.childModels)}}return e._$name="InsertChildAction",e}(),Js=Symbol("PARENT_MODEL_PROP"),Qs=Symbol("CHILD_MODELS_PROP"),ei=Symbol("CONTEXT_PROP"),ti=function(){class e extends Bs{static get defaultConfig(){return{parentModel:void 0,childModels:void 0,context:void 0}}get type(){return"RemoveChildAction"}get parentModel(){return this[Js]}set parentModel(e){this[Js]=e}get childModels(){return this[Qs]}set childModels(e){this[Qs]=e.slice(0)}get context(){return this[ei]}set context(e){this[ei]=e}undo(){const{parentModel:e,context:t,childModels:n}=this;n.sort((e,n)=>t.get(e)-t.get(n)),n.forEach(n=>{e.insertChild(t.get(n),n)})}redo(){this.parentModel.removeChild(this.childModels)}}return e._$name="RemoveChildAction",e}(),ni=Symbol("STORE_PROP"),ri=Symbol("MODEL_LIST_PROP"),si=function(){class e extends Bs{static get defaultConfig(){return{store:void 0,modelList:void 0,silent:!1}}get type(){return"AddAction"}get store(){return this[ni]}set store(e){this[ni]=e}get modelList(){return this[ri]}set modelList(e){this[ri]=e.slice(0)}undo(){this.store.remove(this.modelList,this.silent)}redo(){this.store.add(this.modelList,this.silent)}}return e._$name="AddAction",e}(),ii=Symbol("STORE_PROP"),oi=Symbol("MODEL_LIST_PROP"),ai=Symbol("INSERT_INDEX_PROP"),li=Symbol("CONTEXT_PROP"),ci=function(){class e extends Bs{static get defaultConfig(){return{store:void 0,modelList:void 0,insertIndex:void 0,context:void 0,silent:!1}}get type(){return"InsertAction"}get store(){return this[ii]}set store(e){this[ii]=e}get modelList(){return this[oi]}set modelList(e){this[oi]=e.slice(0)}get insertIndex(){return this[ai]}set insertIndex(e){this[ai]=e}get context(){return this[li]}set context(e){this[li]=e}undo(){const{store:e,modelList:t,context:n,silent:r}=this;t.sort((e,t)=>{const r=n.get(e),s=n.get(t);return void 0!==r&&void 0!==s?r-s:0}),t.forEach(t=>{const s=n.get(t);void 0!==s?e.insert(s,t,r):e.remove(t,r)})}redo(){this.store.insert(this.insertIndex,this.modelList,this.silent)}}return e._$name="InsertAction",e}(),di=Symbol("STORE_PROP"),ui=Symbol("MODEL_LIST_PROP"),hi=Symbol("CONTEXT_PROP"),gi=function(){class e extends Bs{static get defaultConfig(){return{store:void 0,modelList:void 0,context:void 0,silent:!1}}get type(){return"RemoveAction"}get store(){return this[di]}set store(e){this[di]=e}get modelList(){return this[ui]}set modelList(e){this[ui]=e.slice(0)}get context(){return this[hi]}set context(e){this[hi]=e}undo(){const{store:e,context:t,modelList:n,silent:r}=this;n.sort((e,n)=>t.get(e)-t.get(n)),n.forEach(n=>{const s=t.get(n);e.insert(s,n,r)})}redo(){this.store.remove(this.modelList,this.silent)}}return e._$name="RemoveAction",e}(),mi=Symbol("STORE_PROP"),pi=Symbol("ALL_RECORDS_PROP"),fi=function(){class e extends Bs{static get defaultConfig(){return{store:void 0,allRecords:void 0,silent:!1}}get type(){return"RemoveAllAction"}get store(){return this[mi]}set store(e){this[mi]=e}get allRecords(){return this[pi]}set allRecords(e){this[pi]=e.slice(0)}undo(){const{store:e,allRecords:t,silent:n}=this;e.add(t,n)}redo(){this.store.removeAll(this.silent)}}return e._$name="RemoveAllAction",e}(),vi=(e,t,n)=>new Gs({model:e,newData:t,oldData:n}),yi=(e,t,n,r)=>new Zs({parentModel:e,childModels:n,insertIndex:t,context:r}),bi=(e,t,n)=>new ti({parentModel:e,childModels:t,context:n}),Ci=(e,t,n)=>new si({store:e,modelList:t,silent:n}),wi=(e,t,n,r,s)=>new ci({store:e,insertIndex:t,modelList:n,context:r,silent:s}),Si=(e,t,n,r)=>new gi({store:e,modelList:t,context:n,silent:r}),Di=(e,t,n)=>new fi({store:e,allRecords:t,silent:n}),Ei=(e,t,...n)=>{const r=t.call(e[Cs],e,...n);if("string"==typeof r)e[Cs]=Ms(r);else if(r instanceof bs)e[Cs]=r;else if(Array.isArray(r)){const[t,s]=r;"string"==typeof t?e[Cs]=Ms(t):t instanceof bs?e[Cs]=t:t&&"object"==typeof t&&((e=Object.assign(e,t))[Cs]=Ms(e[Cs])),"function"==typeof s&&Ei(e,s,...n)}else r&&"object"==typeof r&&((e=Object.assign(e,r))[Cs]=Ms(e[Cs]))},xi=function(){class e extends(ue(W)){static get defaultConfig(){return{disabled:!0,autoRecord:!1,autoRecordTransactionStopTimeout:100,makeModelUpdateAction:vi,makeModelInsertChildAction:yi,makeModelRemoveChildAction:bi,makeStoreModelAddAction:Ci,makeStoreModelInsertAction:wi,makeStoreModelRemoveAction:Si,makeStoreRemoveAllAction:Di,getTransactionTitle:null}}construct(...e){Object.assign(this,{[Cs]:_s,[ws]:[],[Ss]:[],[Ds]:0,[Es]:null,[xs]:null,[Ts]:!1}),super.construct(...e)}doDestroy(){super.doDestroy(),this.destroyProperties(Cs)}get state(){return this[Cs]}get position(){return this[Ds]}get length(){return this[Ss].length}get stores(){return Array.from(this[ws])}hasStore(e){return this[ws].includes(e)}addStore(e){this.hasStore(e)||(this[ws].push(e),e.stm=this)}removeStore(e){this.hasStore(e)&&(this[ws]=this[ws].filter(t=>t!==e),e.stm=null)}getStoreById(e){return this[ws].find(t=>t.id===e)}forEachStore(e){this[ws].forEach(t=>e(t,t.id))}get disabled(){return this.state===As}set disabled(e){const t=this;t.disabled!=e&&Ei(t,e?t.state.onDisable:t.state.onEnable,t)}enable(){this.disabled=!1}disable(){this.disabled=!0}get isReady(){return this.state===_s||this.state===Hs}get isRecording(){return this.state===$s||this.state===Ns}get autoRecord(){return this[Ts]}set autoRecord(e){const t=this;t.autoRecord!=e&&Ei(t,e?t.state.onAutoRecordOn:t.state.onAutoRecordOff,t)}startTransaction(e=null){Ei(this,this.state.onStartTransaction,e)}stopTransaction(e=null){Ei(this,this.state.onStopTransaction,e)}stopTransactionDelayed(){Ei(this,this.state.onStopTransactionDelayed)}rejectTransaction(){Ei(this,this.state.onRejectTransaction)}get transaction(){return this[Es]}get queue(){return this[Ss].map(e=>e.title)}get isRestoring(){return this.state===js}get canUndo(){return this.state.canUndo(this)}get canRedo(){return this.state.canRedo(this)}undo(e=1){Ei(this,this.state.onUndo,e)}undoAll(){this.undo(this.length)}redo(e=1){Ei(this,this.state.onRedo,e)}redoAll(){this.redo(this.length)}resetQueue(e={undo:!0,redo:!0}){Ei(this,this.state.onResetQueue,e)}resetUndoQueue(){this.resetQueue({undo:!0})}resetRedoQueue(){this.resetQueue({redo:!0})}notifyStoresAboutStateRecordingStart(e){this.forEachStore(t=>{t.onStmRecordingStart&&t.onStmRecordingStart(this,e)}),this.trigger("recordingStart",{stm:this,transaction:e})}notifyStoresAboutStateRecordingStop(e,t){this.forEachStore(n=>{n.onStmRecordingStop&&n.onStmRecordingStop(this,e,t)}),this.trigger("recordingStop",{stm:this,transaction:e,reason:t})}notifyStoresAboutStateRestoringStart(){this.forEachStore(e=>{e.onStmRestoringStart&&e.onStmRestoringStart(this)}),this.trigger("restoringStart",{stm:this})}notifyStoresAboutStateRestoringStop(){this.forEachStore(e=>{e.onStmRestoringStop&&e.onStmRestoringStop(this)}),this.trigger("restoringStop",{stm:this})}notifyStoresAboutQueueReset(e){this.forEachStore(t=>{t.onStmQueueReset&&t.onStmQueueReset(this,e)}),this.trigger("queueReset",{stm:this,options:e})}onModelUpdate(e,t,n){Ei(this,this.state.onModelUpdate,e,t,n)}onModelInsertChild(e,t,n,r){Ei(this,this.state.onModelInsertChild,e,t,n,r)}onModelRemoveChild(e,t,n){Ei(this,this.state.onModelRemoveChild,e,t,n)}onStoreModelAdd(e,t,n){Ei(this,this.state.onStoreModelAdd,e,t,n)}onStoreModelInsert(e,t,n,r,s){Ei(this,this.state.onStoreModelInsert,e,t,n,r,s)}onStoreModelRemove(e,t,n,r){Ei(this,this.state.onStoreModelRemove,e,t,n,r)}onStoreRemoveAll(e,t,n){Ei(this,this.state.onStoreRemoveAll,e,t,n)}}return e._$name="StateTrackingManager",e}();var Ti=e=>(class extends(e||W){initContainerDrag(){if(this.mode||(this.mode="container"),"container"===this.mode&&!this.containers)throw new Error("Container drag mode must specify containers")}grabContainerDrag(e){const t=this;if(!t.ignoreSelector||!yt.up(e.target,t.ignoreSelector)){const n=yt.getAncestor(e.target,t.containers,t.outerElement);if(n){const r=n.getBoundingClientRect();t.context={element:n,valid:!0,action:"container",offsetX:e.pageX-r.left,offsetY:e.pageY-r.top,originalPosition:{parent:n.parentElement,prev:n.previousElementSibling,next:n.nextElementSibling}}}return!0}return!1}startContainerDrag(e){const{context:t}=this,{element:n}=t,r=n.cloneNode(!0),s=n.getBoundingClientRect();r.classList.add(this.dragProxyCls),r.classList.add(this.draggingCls),document.body.appendChild(r),t.dragProxy=r,r.style.width=s.width+"px",r.style.height=s.height+"px",yt.setTranslateXY(t.dragProxy,s.left,s.top),t.dragging=n,n.classList.add(this.dropPlaceholderCls)}updateContainerDrag(e){const t=this.context;if(!t.started||!t.targetElement)return;const n=yt.getAncestor(t.targetElement,this.containers,"b-grid"),r=t.dragging&&t.dragging.contains(document.activeElement);n&&yt.isDescendant(t.element,n)||(r&&Cn.suspendFocusEvents(),n&&t.valid?this.moveNextTo(n,e):this.revertPosition(),r&&Cn.resumeFocusEvents(),e.preventDefault())}finishContainerDrag(e){const t=this,n=t.context,{dragging:r,dragProxy:s,valid:i,draggedTo:o,insertBefore:a,originalPosition:l}=n;r&&(n.valid=i&&o&&(r!==a||l.parent!==o),n.finalize=((e=n.valid)=>{!e&&this.context&&t.revertPosition(),r.classList.remove(t.dropPlaceholderCls),s.remove(),t.reset()}),n.async=!1,t.trigger("drop",{context:n,event:e}),n.async?n.awaitingFinalization=!0:n.finalize())}abortContainerDrag(e=!1,t=null,n=!1){const r=this.context;r.dragging&&(r.dragging.classList.remove(this.dropPlaceholderCls),r.dragProxy.remove(),this.context={}),n||this.trigger(e?"drop":"abort",{context:r,event:t})}updateContainerProxy(e){const t=this,n=t.context,r=n.dragProxy;let s,i=e.pageX-n.offsetX,o=e.pageY-n.offsetY;if("number"==typeof t.minX&&(i=Math.max(t.minX,i)),"number"==typeof t.maxX&&(i=Math.min(t.maxX-r.offsetWidth,i)),"number"==typeof t.minY&&(o=Math.max(t.minY,o)),"number"==typeof t.maxY&&(o=Math.min(t.maxY-r.offsetHeight,o)),t.lockX?yt.setTranslateY(r,o):t.lockY?yt.setTranslateX(r,i):yt.setTranslateXY(r,i,o),"touchmove"===e.type){let t=e.changedTouches[0];s=document.elementFromPoint(t.clientX,t.clientY)}else s=e.target;n.targetElement=s}moveNextTo(e,t){const n=this.context,r=n.dragging,s=e.parentElement;if(e!==r){const i=e.getBoundingClientRect().left+e.offsetWidth/2;t.pageX<i?(s.insertBefore(r,e),n.insertBefore=e):e.nextElementSibling?e.nextElementSibling!==r?(n.insertBefore=e.nextElementSibling,s.insertBefore(r,e.nextElementSibling)):n.insertBefore||r.parentElement.lastElementChild===r||(n.insertBefore=e.nextElementSibling):(s.appendChild(r),n.insertBefore=null),n.draggedTo=s}}revertPosition(){const e=this.context,t=e.originalPosition;t.next?t.next&&t.next.previousSibling===e.dragging||!t.next&&e.dragging===t.parent.lastChild||t.parent.insertBefore(e.dragging,t.next):t.parent.appendChild(e.dragging),e.draggedTo=null}});const Ri={pageXOffset:0,pageYOffset:0};var ki=e=>(class extends(U(e||W)){initTranslateDrag(){const e=this;!e.isElementDraggable&&e.targetSelector&&(e.isElementDraggable=(t=>yt.up(t,e.targetSelector)))}grabTranslateDrag(e){const t=this.getTarget(e);return!!t&&(this.context={valid:!0,action:this.mode,element:t,startPageX:e.pageX,startPageY:e.pageY,startClientX:e.clientX,startClientY:e.clientY},!0)}getTarget(e){return yt.up(e.target,this.targetSelector)}startTranslateDrag(e){const t=this,n=t.context,{relatedElements:r}=n;let s=n.dragProxy||n.element;if(s&&!n.started){const i=s,o=s.parentElement,a=t.dragWithin=t.dragWithin||t.cloneTarget&&document.body,l=t.outerElement;if(t.cloneTarget){const e=yt.getOffsetX(s,a),n=yt.getOffsetY(s,a),r=s.offsetWidth,o=s.offsetHeight;s=this.createProxy(s),yt.setTranslateXY(s,e,n),s.style.width=`${r}px`,s.style.height=`${o}px`,s.classList.add(t.dragProxyCls),a.appendChild(s),i.classList.add("b-drag-original"),t.hideOriginalElement&&i.classList.add("b-hidden")}Object.assign(t.context,{element:s,grabbed:i,grabbedParent:o,grabbedNextSibling:s.nextElementSibling,elementStartX:yt.getTranslateX(s),elementStartY:yt.getTranslateY(s),elementX:yt.getOffsetX(s,a||l),elementY:yt.getOffsetY(s,a||l),scrollX:0,scrollY:0,scrollManagerElementContainsDragProxy:!t.cloneTarget||a===l}),s.classList.add(t.draggingCls),a&&(n.parentElement=s.parentElement,a!==s.parentElement&&a.appendChild(s),t.updateTranslateProxy(e)),r&&r.forEach(e=>{e.classList.add(t.draggingCls)})}}applyConstraints(e,t,n){const r=this,s=r.dragWithin,{pageXOffset:i,pageYOffset:o}=s===document.body?window:Ri;return s&&r.constrain&&(t<0&&(t=0),t+e.offsetWidth>s.scrollWidth&&(t=s.scrollWidth-e.offsetWidth),n<0&&(n=0),n+e.offsetHeight>s.scrollHeight&&(n=s.scrollHeight-e.offsetHeight)),"number"==typeof r.minX&&(t=Math.max(r.minX+i,t)),"number"==typeof r.maxX&&(t=Math.min(r.maxX+i,t)),"number"==typeof r.minY&&(n=Math.max(r.minY+o,n)),"number"==typeof r.maxY&&(n=Math.min(r.maxY+o,n)),{constrainedX:t,constrainedY:n}}updateTranslateProxy(e,t){const{mode:n,lockX:r,lockY:s}=this,i=this.context,o=i.dragProxy||i.element,{relatedElements:a,relatedElDragFromPos:l}=i;i.scrollManagerElementContainsDragProxy&&t&&(i.scrollX=t.scrollRelativeLeft,i.scrollY=t.scrollRelativeTop),i.pageX=e.pageX,i.pageY=e.pageY,i.clientX=e.clientX,i.clientY=e.clientY;const c=i.elementStartX+e.pageX-i.startPageX+i.scrollX,d=i.elementStartY+e.pageY-i.startPageY+i.scrollY,{constrainedX:u,constrainedY:h}=this.applyConstraints(o,c,d);if("translateXY"!==n||r||s?"translateX"===n||s?yt.setTranslateX(o,u):("translateY"===n||r)&&yt.setTranslateY(o,h):yt.setTranslateXY(o,u,h),a){const e=r||"translateY"===n?0:u-i.elementStartX,t=s||"translateX"===n?0:h-i.elementStartY;a.forEach((n,r)=>{const[s,i]=l[r];yt.setTranslateXY(n,s+e,i+t)})}i.newX=u,i.newY=h}finishTranslateDrag(e){const t=this,n=t.context,r=n.newX!==n.elementStartX,s=n.newY!==n.elementStartY,i=n.dragProxy||n.element,{relatedElements:o}=n;function a(){i.classList.remove(t.invalidCls),i.classList.remove(t.draggingCls),o&&o.forEach(e=>{e.classList.remove(t.invalidCls),e.classList.remove(t.draggingCls)}),i.classList.contains("b-aborting")||(t.hideOriginalElement&&n.grabbed.classList.remove("b-hidden"),n.grabbed.classList.remove("b-drag-original"))}if(!t.ignoreSamePositionDrop||"translateY"!==t.mode&&r||"translateX"!==t.mode&&s){if(!1===n.valid)t.abortTranslateDrag(!0,e);else{const r=oe.from(t.dragWithin||t.outerElement);!t.minX&&e.pageX<r.left||!t.maxX&&e.pageX>r.right||!t.minY&&e.pageY<r.top||!t.maxY&&e.pageY>r.bottom?(n.valid=!1,t.abortTranslateDrag(!0,e)):(n.finalize=((e=n.valid)=>{n.asyncCleanup&&a(),!e&&t.context?t.abortTranslateDrag(!0,null,!0):(t.cloneTarget||n.dragProxy)&&i.remove(),t.reset()}),n.async=!1,t.trigger("drop",{context:n,event:e}),n.async?n.awaitingFinalization=!0:n.finalize())}n.asyncCleanup||a()}else t.abortTranslateDrag(!1,e)}abortTranslateDrag(e=!1,t=null,n=!1){const r=this,s=r.context,{relatedElements:i,relatedElStartPos:o,grabbed:a}=s,l=s.dragProxy||s.element,c=r.cloneTarget&&r.hideOriginalElement?a:l;let{elementStartX:d,elementStartY:u}=s;l&&s.started&&(!r.cloneTarget&&r.dragWithin&&r.dragWithin!==s.grabbedParent&&s.grabbedParent.insertBefore(l,s.grabbedNextSibling),a.classList.remove("b-hidden"),r.cloneTarget&&(r.hideOriginalElement&&([d,u]=yt.getTranslateXY(a),yt.alignTo(a,l),c.getBoundingClientRect()),l.remove()),c.classList.add("b-aborting"),"translateXY"!==r.mode||r.lockX||r.lockY||(yt.setTranslateXY(c,d,u),i&&i.forEach((e,t)=>{e.classList.add("b-aborting"),yt.setTranslateXY(e,o[t][0],o[t][1])})),("translateX"===r.mode||r.lockY)&&(yt.setTranslateX(c,d),i&&i.forEach((e,t)=>{e.classList.add("b-aborting"),yt.setTranslateX(e,o[t][0])})),("translateY"===r.mode||r.lockX)&&(yt.setTranslateY(c,u),i&&i.forEach((e,t)=>{e.classList.add("b-aborting"),yt.setTranslateY(e,o[t][1])})),r.setTimeout(()=>{c.classList.remove("b-aborting"),a.classList.remove("b-dragging"),a.classList.remove("b-drag-original"),r.cloneTarget||(i&&i.forEach((e,t)=>{e.classList.remove("b-aborting")}),l.classList.remove("b-aborting"),l.classList.remove(r.draggingCls),l.classList.remove(r.invalidCls))},300,void 0,!0),n||r.trigger(e?"drop":"abort",{context:s,event:t})),r.reset()}});const Mi={down:"onMouseDown",move:"onMouseMove",up:"onMouseUp",docclick:"onDocumentClick",touchstart:"onTouchStart",touchmove:"onTouchMove",touchend:"onTouchEnd",keydown:"onKeyDown"},Ii=function(){class e extends(Dr(W).mixes(ue,Ti,ki)){static get defaultConfig(){return{dragProxyCls:"b-drag-proxy",invalidCls:"b-drag-invalid",draggingCls:"b-dragging",dropPlaceholderCls:"b-drop-placeholder",resizingCls:"b-resizing",dragThreshold:5,handleSize:10,touchHandleSize:30,minWidth:1,outerElement:document.body,dragWithin:null,constrain:!0,minX:null,maxX:null,minY:null,maxY:null,mode:null,isElementDraggable:null,targetSelector:null,dropTargetSelector:null,cloneTarget:!1,hideOriginalElement:!1,containers:null,ignoreSelector:null,handleSelector:null,startEvent:null,lockX:!1,lockY:!1,touchStartDelay:300,ignoreSamePositionDrop:!0}}construct(e){const t=this;super.construct(e),t.initListeners(),G.isTouchDevice&&(t.handleSize=t.touchHandleSize),"container"===t.mode?t.initContainerDrag():t.mode.startsWith("translate")&&(t.lockY?t.mode="translateX":t.lockX&&(t.mode="translateY"),t.initTranslateDrag())}doDestroy(){this.abort(!0),super.doDestroy()}initListeners(){const e={element:this.outerElement,mousedown:Mi.down,thisObj:this};G.isTouchDevice&&(e.touchstart=Mi.touchstart),Kt.on(e)}onPointerDown(e){let t=this,n=!1,r="touches"in e;if(t.context)t.context.awaitingFinalization||(t.onMouseUp(e),t.reset());else if(t.startEvent=e,(!t.isElementDraggable||t.isElementDraggable(e.target,e))&&(t.mode&&(n||"container"!==t.mode||(n=t.grabContainerDrag(e)),!n&&t.mode.startsWith("translate")&&(n=t.grabTranslateDrag(e))),n)){const e={element:document,thisObj:t,keydown:Mi.keydown};if(r?(e.touchmove={handler:Mi.touchmove,passive:!1},e.touchend=e.pointerup=Mi.touchend):(e.mousemove=Mi.move,e.mouseup=Mi.up),t.removeListeners=Kt.on(e),t.dragWithin&&t.dragWithin!==t.outerElement){const e=t.dragWithin.getBoundingClientRect();t.minY=e.top,t.maxY=e.bottom,t.minX=e.left,t.maxX=e.right}}}onTouchStart(e){const t=this;1===e.touches.length&&(t.touchStartTimer=t.setTimeout(()=>{t.touchStartTimer=null},t.touchStartDelay),t.onPointerDown(e))}onMouseDown(e){0===e.button&&this.onPointerDown(e)}internalMove(e){const t=this,n=t.context,r=Kt.getDistanceBetween(t.startEvent,e);if(t.touchStartTimer&&r>t.dragThreshold)t.abort(!0);else if(!t.touchStartTimer&&n&&n.element&&e.target.nodeType===Node.ELEMENT_NODE&&(n.started||r>=t.dragThreshold)){if(!n.started&&!1===t.callPreventable("dragStart",{context:n,event:e},()=>{const r=t.lockX?"vertical":t.lockY?"horizontal":"both";n.action.startsWith("translate")?t.startTranslateDrag(e):"container"===n.action&&t.startContainerDrag(e),n.started=!0,t.scrollManager&&t.scrollManager.startMonitoring({direction:r,element:t.dragWithin||t.outerElement,callback:e=>{t.context.element&&t.lastMouseMoveEvent&&(t.lastMouseMoveEvent.isScroll=!0,t.update(t.lastMouseMoveEvent,e))},thisObj:t}),document.body.classList.add("b-draghelper-active")}))return t.abort();"touchmove"===e.type&&(e.preventDefault(),e.stopImmediatePropagation()),t.update(e)}}onTouchMove(e){this.internalMove(e)}onMouseMove(e){this.internalMove(e)}update(e,t){const n=this,r=n.context,s=r.dragProxy||r.element;let i=e.target,o=document.scrollingElement||document.body;if("touchmove"===e.type){const t=e.changedTouches[0];i=yt.elementFromPoint(t.clientX+o.scrollLeft,t.clientY+o.scrollTop)}r.target=i,r.valid=!n.dropTargetSelector||Boolean(i.closest(n.dropTargetSelector)),r.action&&("container"===r.action&&n.updateContainerProxy(e,t),r.action.startsWith("translate")&&n.updateTranslateProxy(e,t)),n.trigger("drag",{context:r,event:e}),"container"===r.action&&n.updateContainerDrag(e,t),s.classList[r.valid?"remove":"add"](n.invalidCls),e&&(n.lastMouseMoveEvent=e)}abort(e=!1){const t=this,n=t.context;t.scrollManager&&t.scrollManager.stopMonitoring(t.dragWithin||t.outerElement),n&&(n.element.getBoundingClientRect(),n.valid=!1,"container"===n.action?t.abortContainerDrag(void 0,void 0,e):t.abortTranslateDrag(void 0,void 0,e)),t.reset()}removeListeners(){}reset(){document.body.classList.remove("b-draghelper-active"),this.removeListeners(),this.trigger("reset"),this.context=this.lastMouseMoveEvent=null}onTouchEnd(e){this.onMouseUp(e)}onDocumentClick(e){e.stopPropagation()}onMouseUp(e){const t=this,n=t.context;if(t.removeListeners(),n)if(t.scrollManager&&t.scrollManager.stopMonitoring(t.dragWithin||t.outerElement),"container"===n.action?t.finishContainerDrag(e):n.started&&n.action.startsWith("translate")&&t.finishTranslateDrag(e),n.started){const e=Kt.on({element:document,thisObj:t,click:Mi.docclick,capture:!0,once:!0});t.setTimeout(e,50)}else t.reset()}onKeyDown(e){"Escape"===e.key&&this.abort()}createProxy(e){const t=e.cloneNode(!0);return t.removeAttribute("id"),t}}return e._$name="DragHelper",e}(),Ai=function(){class e{constructor(...e){"object"==typeof e[0]?Object.assign(this,e[0]):this.process(1,e),this[_i]=!0}clone(){return new e(this)}toString(){return this.length?`${this.value} `:""}trim(){return this.value}isEqual(e){if("string"==typeof e&&(Pi.value=e,e=Pi),this.length===e.length){const t=We.getTruthyKeys(e);for(let e=0,n=t.length;e<n;e++)if(!this[t[e]])return!1;return!0}return!1}get value(){const e=this;if(e[_i]){const t=We.getTruthyKeys(e);e[Li]=t.length,e[Oi]=t.join(" "),e[_i]=!1}return e[Oi]}set value(e){const t=this,n=Object.keys(t),r=n.length;for(let s=0;s<r;s++)delete t[n[s]];e?t.process(1,[e]):t[_i]=!0}get length(){return this.value?this[Li]:0}process(e,t){const n=t.length;for(let r=0;r<n;r++)if(t[r]){const n=t[r],s=n.values?Array.from(n.values()):n.item?Array.from(n):n.split(Fi),i=s.length;for(let t=0;t<i;t++)s[t]&&(this[s[t]]=e)}this[_i]=!0}add(...e){this.process(1,e)}remove(...e){this.process(0,e)}split(){return We.getTruthyKeys(this)}forEach(e){return We.getTruthyKeys(this).forEach(e)}get isDomClassList(){return!0}}return e._$name="DomClassList",e}(),Fi=/\s+/,Oi=Symbol("value"),Li=Symbol("length"),_i=Symbol("dirty"),Pi=new Ai,$i=function(){class e{constructor(){this.random100=[46,2,36,46,54,59,18,20,71,55,88,98,13,61,61,40,2,15,3,32,51,45,64,25,81,85,54,13,57,49,64,22,81,94,0,62,17,7,11,2,33,99,85,26,83,83,96,26,20,89,91,38,26,13,11,79,32,30,5,51,70,7,5,56,58,77,37,89,40,80,78,59,26,36,8,51,60,23,86,5,11,96,64,94,87,64,4,78,17,85,35,0,90,86,23,55,53,9,35,59,29,2,64,42,8,49,43,73,6,53,38,9,39,31,32,40,49,13,78,68,20,99,24,78,35,91,73,46,67,76,89,69,30,69,25,3,4,55,1,65,66,76,83,19,67,1,95,24,54,45,56,40,67,92,72,4,69,8,47,50,27,2,38,9,14,83,12,14,62,95,22,47,35,18,38,14,86,64,68,61,52,69,39,93,20,73,32,52,74,6,56,68,99,29,24,92,40,67,6,72,31,41,91,53,80,55,33,97,97,99,18,20,5,27,82,84,61,78,27,67,7,42,75,95,91,25,63,21,70,36,46,0,1,45,84,6,86,15,10,62,96,94,10,23,93,83,94,47,5,29,29,52,51,37,77,96,43,72,43,14,54,14,72,52,4,39,15,26,68,28,25,76,60,50,22,40,72,74,68,58,8,48,40,62,52,24,9,26,47,44,49,96,7,77,90,45,76,47,5,86,1,36,18,42,19,90,34,23,70,32,69,79,0,99,57,80,72,21,19,72,85,68,4,40,86,62,0,63,4,11,69,31,78,31,21,78,29,84,13,53,57,10,26,50,24,30,90,42,51,96,93,21,99,23,81,0,89,43,86,63,93,19,54,71,92,36,4,95,37,99,60,29,23,50,68,95,57,95,77,53,99,78,75,12,92,47,23,14,0,41,98,11,34,64,26,90,50,23,38,31,74,76,16,76,66,23,22,72,48,50,20,36,37,58,5,43,49,64,81,30,8,21,98,75,60,17,50,42,27,38,90,74,45,68,67,27,31,15,58,76,41,99,23,98,53,98,56,19,79,2,4,38,96,24,65,51,43,42,41,60,46,7,90,65,3,27,63,99,51,44,86,1,54,40,15,74,3,81,51,63,87,79,84,72,22,38,96,95,33,41,21,99,21,69,7,49,40,52,41,6,91,19,76,40,54,17,33,11,11,0,1,32,94,33,13,18,45,7,85,61,42,54,45,72,78,96,17,9,80,87,41,96,66,0,8,59,18,21,2,28,64,75,97,32,80,86,97,97,55,2,73,75,11,89,67,58,70,76,12,46,64,17,22,97,25,35,93,57,82,46,57,61,31,74,27,4,32,85,53,86,53,53,42,5,28,50,65,63,70,61,73,37,13,80,7,34,22,3,26,6,62,78,12,56,87,41,58,64,31,27,45,35,18,66,62,43,89,69,94,93,33,74,2,43,85,37,82,41,74,9,15,44,33,42,65,19,1,49,78,12,29,9,78,7,55,12,45,40,33,16,86,14,52,16,73,76,0,98,75,91,78,46,99,95,90,69,78,45,62,55,37,88,49,77,27,83,38,73,39,1,75,40,65,83,54,95,7,73,4,30,26,36,89,21,5,95,11,14,87,45,36,21,77,55,5,66,51,98,48,62,74,58,23,82,30,28,19,53,89,76,98,8,34,70,28,54,16,52,35,93,54,54,72,49,18,93,72,90,71,73,15,60,38,80,76,53,70,39,69,25,5,31,61,46,6,54,34,31,52,33,36,79,76,44,29,28,38,1,66,2,90,91,1,76,78,31,55,37,71,2,3,38,85,0,95,42,2,39,57,87,61,77,98,2,24,80,48,27,47,71,15,7,49,60,86,3,2,29,38,54,36,59,83,27,47,9,36,42,8,73,85,9,16,73,60,39,12,43,25,23,29,28,47,40,77,20,89,22,30,41,59,96,19,56,20,76,73,39,46,72,40,47,37,52,29,79,37,39,50,41,87,66,17,75,31,45,26,88,70,11,90,40,74,9,32,65,72,61,6,93,54,15,84,22,99,47,10,96,4,84,19,85,73,45,25,16,8,94,99,39,28,26,68,87,48,1,65,86,46,86,7,60,82,45,75,38,56,41,35,30,86,91,97,85,45,5,14,69,85,96,37,18,26,16,38,16,1,44,94,85,58,60,20,5,47,52,41,50,71,43,42,67,64,38,65,83,99,78,96,33,20,98,24,6,2,25,16,16,44,63,24,68,56,49,91,15,59,99,27,43,34,28,36,45,1,10,19,54,26,75,17,88,96,63,24,71,93,72,97,66,87,18,86],this.randomCache={},this.rndIndex=0}nextRandom(e){let t,n=this.randomCache;return n[e]?t=n[e]:(t=this.random100.filter(t=>t<e),n[e]=t),t[this.rndIndex++%t.length]}reset(){this.rndIndex=0}fromArray(e){return e[this.nextRandom(e.length)]}}return e._$name="RandomGenerator",e}(),ji={down:"onMouseDown",move:"onMouseMove",up:"onMouseUp",docclick:"onDocumentClick",touchstart:"onTouchStart",touchmove:"onTouchMove",touchend:"onTouchEnd",keydown:"onKeyDown"},Hi=function(){class e extends(ue(W)){static get defaultConfig(){return{resizingCls:"b-resizing",dragThreshold:5,handleSize:10,touchHandleSize:30,minWidth:1,maxWidth:0,minHeight:1,maxHeight:0,outerElement:document.body,scroller:null,allowResize:null,dragWithin:null,isElementResizable:null,targetSelector:null,leftHandle:!0,rightHandle:!0,topHandle:!0,bottomHandle:!0,handleSelector:null,handleContainerSelector:null,startEvent:null,grab:null,invalidCls:"b-resize-invalid",handleVisibilityThreshold:null,skipTranslate:!1,direction:"horizontal"}}construct(e){const t=this;super.construct(e),!t.handleSelector&&G.isTouchDevice&&(t.handleSize=t.touchHandleSize),t.handleVisibilityThreshold=t.handleVisibilityThreshold||2*t.handleSize,t.initListeners(),t.initResize()}doDestroy(){this.abort(!0),super.doDestroy()}initResize(){const e=this;if(!e.isElementResizable&&e.targetSelector&&(e.isElementResizable=(t=>yt.up(t,e.targetSelector))),e.grab){const{edge:t,element:n,event:r}=e.grab;e.startEvent=r,e.context={element:n,edge:t,valid:!0,async:!1,elementStartX:yt.getTranslateX(n)||n.offsetLeft,elementStartY:yt.getTranslateY(n)||n.offsetTop,newX:yt.getTranslateX(n)||n.offsetLeft,newY:yt.getTranslateY(n)||n.offsetTop,elementWidth:n.offsetWidth,elementHeight:n.offsetHeight,startX:r.clientX+e.scrollLeft,startY:r.clientY+e.scrollTop,started:!0,finalize:()=>e.reset&&e.reset()},n.classList.add(e.resizingCls),e.internalStartResize(e.isTouch)}}initListeners(){const e=this,t={element:e.outerElement,mousedown:ji.down,thisObj:e};G.isTouchDevice?t.touchstart=ji.touchstart:e.handleSelector||(t.mousemove={handler:ji.move,delegate:e.targetSelector},t.mouseleave={handler:"onMouseLeaveTarget",delegate:e.targetSelector,capture:!0}),e.removeListeners=Kt.on(t)}removeListeners(){}get scrollLeft(){return this.scroller?this.scroller.x:this.outerElement.scrollLeft}get scrollTop(){return this.scroller?this.scroller.y:this.outerElement.scrollTop}internalStartResize(e){const t=this,n={element:document,keydown:ji.keydown,thisObj:t};e?(n.touchmove=ji.touchmove,n.touchend=n.pointerup=ji.touchend):(n.mousemove=ji.move,n.mouseup=ji.up),t.removeDragListeners=Kt.on(n),t.scrollManager&&t.scrollManager.startMonitoring({direction:t.direction,element:t.dragWithin||t.outerElement,callback:e=>t.context&&t.context.element&&t.lastMouseMoveEvent&&t.update(t.lastMouseMoveEvent,e),thisObj:t})}removeDragListeners(){}reset(){this.removeDragListeners(),this.context=null}onPointerDown(e,t){const n=this;n.startEvent=t,n.isElementResizable&&!n.isElementResizable(t.target,t)||n.grabResizeHandle(e,t)&&(t.stopImmediatePropagation(),n.internalStartResize(e))}onTouchStart(e){e.touches.length>1||this.onPointerDown(!0,e)}onMouseDown(e){0===e.button&&this.onPointerDown(!1,e)}internalMove(e,t){const n=this,r=n.context;r&&r.element&&(r.started||Kt.getDistanceBetween(n.startEvent,t)>=n.dragThreshold)?(r.started||(n.trigger("resizeStart",{context:r,event:t}),r.started=!0),n.update(t)):e||n.handleSelector||n.checkResizeHandles(t)}onTouchMove(e){this.internalMove(!0,e)}onMouseMove(e){this.internalMove(!1,e)}internalEnd(e,t){const n=this,r=n.context;n.removeDragListeners(),r&&(n.scrollManager&&n.scrollManager.stopMonitoring(n.dragWithin||n.outerElement),n.finishResize(t),n.context&&Kt.on({element:document,thisObj:n,click:ji.docclick,capture:!0,once:!0}))}onTouchEnd(e){this.internalEnd(!0,e)}onMouseUp(e){this.internalEnd(!1,e)}onDocumentClick(e){e.stopPropagation()}onKeyDown(e){"Escape"===e.key&&this.abort()}update(e){const t=this,n=t.context,r=oe.from(t.outerElement.parentElement);n.currentX=Math.max(Math.min(e.clientX,r.right-1),r.x)+t.scrollLeft,n.currentY=Math.max(Math.min(e.clientY,r.bottom-1),r.y)+t.scrollTop,t.updateResize(e),t.trigger("resizing",{context:n,event:e}),n.element.classList[!1===n.valid?"add":"remove"](t.invalidCls),e&&(t.lastMouseMoveEvent=e)}abort(e=!1){const t=this;t.scrollManager&&t.scrollManager.stopMonitoring(t.dragWithin||t.outerElement),t.context&&t.abortResize(null,e)}grabResizeHandle(e,t){const n=this;if(n.allowResize&&!n.allowResize(t.target,t))return!1;const r=n.handleSelector,s="touchstart"===t.type?t.changedTouches[0]:t,i=s.clientX,o=s.clientY,a=n.targetSelector?yt.up(t.target,n.targetSelector):t.target;if(a){let s;if(r){if(!t.target.matches(r))return!1;s="horizontal"===n.direction?t.pageX<yt.getPageX(a)+a.offsetWidth/2?"left":"right":t.pageY<yt.getPageY(a)+a.offsetHeight/2?"top":"bottom"}else if("horizontal"===n.direction?n.overLeftHandle(t,a)?s="left":n.overRightHandle(t,a)&&(s="right"):n.overTopHandle(t,a)?s="top":n.overBottomHandle(t,a)&&(s="bottom"),!s)return n.context=null,!1;if("touchstart"===t.type&&t.preventDefault(),!1!==n.trigger("beforeResizeStart",{element:a,event:t}))return n.context={element:a,edge:s,valid:!0,async:!1,direction:n.direction,isTouch:e,elementStartX:yt.getTranslateX(a)||a.offsetLeft,elementStartY:yt.getTranslateY(a)||a.offsetTop,newX:yt.getTranslateX(a)||a.offsetLeft,newY:yt.getTranslateY(a)||a.offsetTop,elementWidth:a.offsetWidth,elementHeight:a.offsetHeight,startX:i+n.scrollLeft,startY:o+n.scrollTop,finalize:()=>n.reset&&n.reset()},a.classList.add(n.resizingCls),!0}return!1}checkResizeHandles(e){const t=this,n=t.targetSelector?yt.up(e.target,t.targetSelector):e.target;if(!n||t.allowResize&&!t.allowResize(e.target,e))t.currentElement&&t.unHighlightHandle();else if(t.currentElement=t.handleContainerSelector?yt.up(e.target,t.handleContainerSelector):e.target,t.currentElement){let r=!1;(r="horizontal"===t.direction?t.overLeftHandle(e,n)||t.overRightHandle(e,n):t.overTopHandle(e,n)||t.overBottomHandle(e,n))?t.highlightHandle():t.unHighlightHandle()}}onMouseLeaveTarget(e){const t=this;t.currentElement=t.handleContainerSelector?yt.up(e.target,t.handleContainerSelector):e.target,t.currentElement&&t.unHighlightHandle()}updateResize(e){const t=this,n=t.context;t.allowEdgeSwitch&&(n.edge="horizontal"===t.direction?n.currentX>n.startX?"right":"left":n.currentY>n.startY?"bottom":"top");let r=n.currentX-n.startX,s=n.currentY-n.startY,i=yt.getExtremalSizePX(n.element,"minWidth")||t.minWidth,o=yt.getExtremalSizePX(n.element,"maxWidth")||t.maxWidth,a=yt.getExtremalSizePX(n.element,"minHeight")||t.minHeight,l=yt.getExtremalSizePX(n.element,"maxHeight")||t.maxHeight,c="right"===n.edge||"bottom"===n.edge?1:-1,d=Math.max(i,n.elementWidth+r*c),u=Math.max(a,n.elementHeight+s*c);o>0&&(d=Math.min(d,o)),l>0&&(u=Math.min(u,l)),n.element.style.flex&&(n.element.style.flex=""),"horizontal"===t.direction?(n.element.style.width=Math.abs(d)+"px",n.newWidth=d,"left"===n.edge||d<0?(n.newX=Math.max(Math.min(n.elementStartX+n.elementWidth-t.minWidth,n.elementStartX+r),0),t.skipTranslate||yt.setTranslateX(n.element,n.newX)):"right"===n.edge&&t.allowEdgeSwitch&&!t.skipTranslate&&yt.setTranslateX(n.element,n.elementStartX)):(n.element.style.height=Math.abs(u)+"px",n.newHeight=u,"top"===n.edge||u<0?(n.newY=Math.max(Math.min(n.elementStartY+n.elementHeight-t.minHeight,n.elementStartY+s),0),t.skipTranslate||yt.setTranslateY(n.element,n.newY)):"bottom"===n.edge&&t.allowEdgeSwitch&&!t.skipTranslate&&yt.setTranslateY(n.element,n.elementStartY))}finishResize(e){const t=this.context,n={context:t,event:e};t.element.classList.remove(this.resizingCls);let r=!1;this.trigger((r="horizontal"===this.direction?t.newWidth&&t.newWidth!==t.elementWidth:t.newHeight&&t.newHeight!==t.elementHeight)?"resize":"cancel",n),t.async||t.finalize()}abortResize(e=null,t=!1){const n=this,r=n.context;r.element.classList.remove(n.resizingCls),"horizontal"===n.direction?(yt.setTranslateX(r.element,r.elementStartX),r.element.style.width=r.elementWidth+"px"):(yt.setTranslateY(r.element,r.elementStartY),r.element.style.height=r.elementHeight+"px"),!t&&n.trigger("cancel",{context:r,event:e}),n.isDestroyed||n.reset()}highlightHandle(){const e=this,t=e.targetSelector?yt.up(e.currentElement,e.targetSelector):e.currentElement;e.currentElement.classList.add("b-resize-handle"),t.classList.add("b-over-resize-handle")}unHighlightHandle(){const e=this,t=e.targetSelector?yt.up(e.currentElement,e.targetSelector):e.currentElement;t&&t.classList.remove("b-over-resize-handle"),e.currentElement.classList.remove("b-resize-handle"),e.currentElement=null}overAnyHandle(e,t){return this.overStartHandle(e,t)||this.overEndHandle(e,t)}overStartHandle(e,t){return"horizontal"===this.direction?this.overLeftHandle(e,t):this.overTopHandle(e,t)}overEndHandle(e,t){return"horizontal"===this.direction?this.overRightHandle(e,t):this.overBottomHandle(e,t)}overLeftHandle(e,t){if(this.leftHandle&&t.offsetWidth>=this.handleVisibilityThreshold){const n=oe.from(t);return n.width=this.handleSize,n.contains(Kt.getPagePoint(e))}return!1}overRightHandle(e,t){if(this.rightHandle&&t.offsetWidth>=this.handleVisibilityThreshold){const n=oe.from(t);return n.x=n.right-this.handleSize,n.contains(Kt.getPagePoint(e))}return!1}overTopHandle(e,t){if(this.topHandle&&t.offsetHeight>=this.handleVisibilityThreshold){const n=oe.from(t);return n.height=this.handleSize,n.contains(Kt.getPagePoint(e))}return!1}overBottomHandle(e,t){if(this.bottomHandle&&t.offsetHeight>=this.handleVisibilityThreshold){const n=oe.from(t);return n.y=n.bottom-this.handleSize,n.contains(Kt.getPagePoint(e))}return!1}}return e._$name="ResizeHelper",e}(),Ni=function(){class e{static setVersion(e,t){this[e=e.toLowerCase()]={version:t,isNewerThan:e=>e<t,isOlderThan:e=>e>t},window.bryntum||(window.bryntum={});let n="";try{n=r}catch(i){}const s=`${n}.${e}${t.replace(/\./g,"-")}`;if(!0===window.bryntum[s]){if(!window.parent.Siesta)throw new Error("Bundle included twice, check cache-busters and file types (.js)");window.BUNDLE_EXCEPTION=!0}else window.bryntum[s]=!0}static getVersion(e){if(!this[e=e.toLowerCase()])throw new Error("No version specified");return this[e].version}}return e._$name="VersionHelper",e}();Object.assign(function(){class e{static reset(){this.rnd.reset(),this.rndTime.reset()}static*generate(e,t=!1,n=1){const r=this,s=r.rnd,i=r.rndTime,o=r.firstNames,a=r.surNames,l=r.teams,c=r.foods,d=r.colors,u=r.cities;for(let h=0;h<e;h++){const r=s.fromArray(o),g=s.fromArray(a),m=`${r} ${String.fromCharCode(65+h%25)} ${g}`,p=s.nextRandom(60)+1,f=new Date(2019,0,p),v=new Date(2019,0,p+s.nextRandom(30)+2),y={id:h+n,title:"Row "+h,name:m,firstName:r,surName:g,city:s.fromArray(u),team:s.fromArray(u)+" "+s.fromArray(l),age:10+s.nextRandom(80),food:s.fromArray(c),color:s.fromArray(d),score:10*s.nextRandom(100),rank:s.nextRandom(100)+1,start:f,finish:v,time:Ne.getTime(i.nextRandom(24),5*i.nextRandom(12)),percent:s.nextRandom(100),done:s.nextRandom(100)<50,rating:Math.round(5*Math.random()),relatedTo:Math.min(e-1,h+n+s.nextRandom(10))};t&&(y.rowHeight=5*s.nextRandom(!0===t?20:t)+20),yield y}}static generateData(t,n=!1,r=1,s=!0){s&&this.reset();const i=[],o=e.overrideRowCount?e.overrideRowCount:t,a=this.generate(o,n,r);for(let e=0;e<o;e++)i.push(a.next().value);return i}}return e._$name="DataGenerator",e}(),{rnd:new $i,rndTime:new $i,rating:0,cities:["Stockholm","Barcelona","Paris","Dubai","New York","San Francisco","Washington","Moscow"],firstNames:["Mike","Linda","Don","Karen","Doug","Jenny","Daniel","Melissa","John","Jane","Theo","Lisa","Adam","Mary","Barbara","James","David"],surNames:["McGregor","Ewans","Scott","Smith","Johnson","Adams","Williams","Brown","Jones","Miller","Davis","More","Wilson","Taylor","Anderson","Thomas","Jackson"],teams:["Lions","Eagles","Tigers","Horses","Dogs","Cats","Panthers","Rats","Ducks","Cougars","Hens","Roosters"],foods:["Pancake","Burger","Fish n chips","Carbonara","Taco","Salad","Bolognese","Mac n cheese","Waffles"],colors:["Blue","Green","Red","Yellow","Pink","Purple","Orange","Teal","Black"]}),function(){class e{static init(){const e=["fullscreenEnabled","requestFullscreen","exitFullscreen","fullscreenElement"],t=t=>e.map(e=>{let n=t+$.capitalizeFirstLetter(e);return"moz"===t&&(n=n.replace("screen","Screen"),"mozCancelFullScreen"in document&&"exitFullscreen"===e&&(n="mozCancelFullScreen")),n});this.functions="fullscreenEnabled"in document&&e||"webkitFullscreenEnabled"in document&&t("webkit")||"mozFullScreenEnabled"in document&&t("moz")||"msFullscreenEnabled"in document&&t("ms")||[];const n=["fullscreenchange","fullscreenerror"],r=e=>n.map(t=>e+$.capitalizeFirstLetter(t));this.events="fullscreenEnabled"in document&&n||"webkitFullscreenEnabled"in document&&r("webkit")||"mozFullscreenEnabled"in document&&r("moz")||"msFullscreenEnabled"in document&&["MSFullscreenChange","MSFullscreenError"]||[]}static get enabled(){return document[this.functions[0]]}static request(e){return e[this.functions[1]](e)}static exit(){return document[this.functions[2]]()}static get isFullscreen(){return!!document[this.functions[3]]}static onFullscreenChange(e){document.addEventListener(this.events[0],e)}static unFullscreenChange(e){document.removeEventListener(this.events[0],e)}}return e._$name="Fullscreen",e}().init();let zi=0;const Bi=new WeakMap,Vi=e=>{const t=new Map;return(...n)=>{const r=((...e)=>e.map(e=>{let t;return e&&"object"==typeof e||"function"==typeof e?void 0===(t=Bi.get(e))&&(t=++zi,Bi.set(e,t)):t=String(e),t}).join("-"))(n);let s=t.get(r);return void 0===s&&(s=e(...n),t.set(r,s)),s}},Wi=e=>{const t=new Map,n=e=>e[0],r=e=>e[1],s=(e,t)=>n(e).push(t);return(i,o)=>{const a=(e=>{let n=t.get(e);return void 0===n&&t.set(e,n=[[],[]]),n})(i);(e=>!r(e).length&&!n(e).length)(a)?(s(a,o),e(i,e=>{((e,t)=>r(e).some(e=>We.isEqual(e,t)))(a,e)||(((e,t)=>r(e).push(t))(a,e),n(a).forEach(t=>t(e)))})):(s(a,o),r(a).forEach(e=>o(e)))}},Ui=Symbol("success"),Gi=Symbol("failure"),Yi=(e,t)=>[Ui,e,t],qi=e=>[Gi,e],Xi=e=>e.length&&e[0]===Ui,Ki=e=>"function"!=typeof e||e.length?e:e(),Zi=Vi(e=>Wi((t,n)=>n(Yi(e,t)))),Ji=Vi(e=>Wi((t,n)=>{const r=Math.min(e.length,t.length),s=t.substr(0,r),i=t.substr(r);n(s===e?Yi(s,i):qi(i))})),Qi=(e,t)=>(n,r)=>Ki(e)(n,e=>{if(Xi(e)){const[,n,s]=e;t(n)(s,r)}else r(e)}),eo=Vi((...e)=>{const t=Vi((e,t)=>Wi(Qi(e,e=>Qi(t,t=>Zi([].concat(e,t))))));return e.reduce(t,Zi([]))}),to=Vi((...e)=>Wi((t,n)=>e.forEach(e=>Ki(e)(t,n)))),no=Vi(e=>(t,n)=>{const r=new RegExp(`^${e}`).exec(t);if(r){const e=r[0],s=t.substr(e.length);n(Yi(e,s))}else n(qi(t))}),ro=Vi((e,t)=>Qi(e,(...e)=>Zi(t(...[].concat.apply([],e))))),so=(e,t)=>{let n=[];return e(t,e=>{if(Xi(e)){const[,,t]=e;""===t&&n.push(e)}}),n};var io={memo:Vi,memoCps:Wi,success:Yi,failure:qi,isSuccess:Xi,resolveParser:Ki,succeed:Zi,string:Ji,bind:Qi,seq:eo,alt:to,regexp:no,red:ro,runParser:so,defineParser:e=>(t,n)=>n?Ki(e)(t,n):so(Ki(e),t)};const oo=function(){class e extends(ge(Zr)){static get type(){return"booleancombo"}static get defaultConfig(){return{positiveValue:!0,positiveText:null,negativeValue:!1,negativeText:null,value:!1}}get store(){return this._store||(this.store=new Nr({data:[{id:this.positiveValue,text:this.positiveText||this.L("Yes")},{id:this.negativeValue,text:this.negativeText||this.L("No")}]})),this._store}set store(e){super.store=e}}return e._$name="BooleanCombo",e}();E.register(oo.type,oo),E.register("filefield",function(){class e extends cr{static get defaultConfig(){return{multiple:!1,accept:null}}inputTemplate(){return Gn.tpl`
            <input
             type="file"
             id="${this.id}_input"
             class="${this.inputCls||""}"
             ${this.multiple?"multiple":""}
             accept="${this.accept||""}"
            />
        `}construct(e){const t=this;super.construct(e),t.input=t.element.querySelector("input"),Kt.on({element:t.input,change:t.onFileInputChange,thisObj:t})}get oldValue(){return this._oldValue}set oldValue(e){this._oldValue=e}get files(){return this.input.files}pickFile(){this.input.click()}clear(){this.input.value=null}onFileInputChange(){const e=this.input.value;this.trigger("change",{value:e,oldValue:this.oldValue,userAction:!0,valid:!0}),this.oldValue=e}}return e._$name="FileField",e}()),E.register("filepicker",function(){class e extends $n{static get defaultConfig(){return{buttonConfig:null,fileFieldConfig:null}}construct(e={}){const t=this;e.items=[Object.assign({type:"button",ref:"fileButton",text:"File"},e.buttonConfig),Object.assign({type:"filefield",ref:"fileField",style:"display: none"},e.fileFieldConfig)].concat(e.items||[]),super.construct(e),t.button.on({click:t.onButtonClick,thisObj:t}),t.fileField.on({change:t.onFileFieldChange,thisObj:t}),t._thisIsAUsedExpression(t.fileTip)}get button(){return this.widgetMap.fileButton}get fileField(){return this.widgetMap.fileField}get files(){return this.fileField.files}get fileTip(){const e=this;return e._fileTip||(e._fileTip=new er({cls:"b-file-tip",forElement:e.button.element,showOnHover:!0,align:"b-t",scrollAction:"realign",listeners:{beforeshow(){const t=e.files;return!(!t||!t.length||(this.html=`${Array.from(t).map(e=>e.name).join("<br>")}`,0))}}}))}clear(){this.fileField.clear(),this.button.badge="",this.trigger("clear")}onButtonClick({event:e}){this.fileField.pickFile(),e.preventDefault()}onFileFieldChange(){this.button.badge=this.files.length||"",this.trigger("change",{files:this.files})}}return e._$name="FilePicker",e}());const ao=function(){class e extends dr{static get type(){return"flagfield"}static get defaultConfig(){return{value:""}}get value(){return this.checked}set value(e){e=Boolean(e),super.value=e,this.inputting||(this.checked=e)}}return e._$name="FlagField",e}();E.register(ao.type,ao);const lo=function(){class e extends zr{static get defaultConfig(){return{value:null,step:1,unit:null,useAbbreviation:!1,allowNegative:!1,triggers:{spin:{type:"spintrigger"}}}}get inputValue(){const e=this.value;return null==e?"":this.valueToVisible(e.magnitude,e.unit)}set unit(e){this.value={magnitude:super.value,unit:e}}get unit(){return this._unit}valueToVisible(e,t){if(!isNaN(e)){const n=parseInt(e,10);if(!isNaN(n)){const r=We.toFixed(e,this.decimalPrecision);return String(n==r?n:r)+" "+Ne[this.useAbbreviation?"getShortNameOfUnit":"getLocalizedNameOfUnit"](t||this.unit,1!==e)}}return""}parseDuration(e){if(null==e)return null;const t=Ne.parseDuration(e,this.allowDecimals,this.unit);return t?(t.unit=t.unit||this.unit,t):null}get isValid(){const e=this;return null==e.value&&e.clearable&&!e.required||null!=e.value&&(e.allowNegative||e.value.magnitude>=0)}internalOnChange(e){const t=this,n=t.value;t.hasChanged(t._lastValue,n)&&(t._lastValue=n,t.trigger("change",{value:n,event:e,userAction:!0,valid:t.isValid}))}onFocusOut(e){return this.syncInputFieldValue(),super.onFocusOut(e)}set value(e){const t=this;"number"==typeof e?e={magnitude:e,unit:t._unit}:"object"!=typeof e&&(e=t.parseDuration(e)),t.value!==e&&(e?(t._unit=e.unit,super.value=e):(t._unit=t.clearable?null:0,super.value=t.clearable?null:0))}get value(){return super.value}hasChanged(e,t){return t&&!e||!t&&e||t&&e&&(t.magnitude!=e.magnitude||t.unit!=e.unit)}get milliseconds(){const e=this.value;return Ne.asMilliseconds(e.magnitude,e.unit)}onInternalKeyDown(e){"ArrowUp"===e.key?this.doSpinUp():"ArrowDown"===e.key&&this.doSpinDown()}doSpinUp(){const e=this,t=e.value;e._isUserAction=!0,e.value={unit:t.unit,magnitude:(t.magnitude||0)+e.step},e._isUserAction=!1}doSpinDown(){const e=this,t=e.value;(e.allowNegative||t.magnitude>0)&&(e._isUserAction=!0,e.value={unit:t.unit,magnitude:(t.magnitude||0)-e.step},e._isUserAction=!1)}}return e._$name="DurationField",e}();E.register("durationfield",lo),E.register("duration",lo);const co=function(){class e extends(ue(ge(Sr))){static get fields(){return["text","field","renderer","width","flex",{name:"editor",defaultValue:{}},{name:"sortable",defaultValue:!0},{name:"searchable",defaultValue:!0},{name:"filterable",defaultValue:!0},{name:"hideable",defaultValue:!0},{name:"draggable",defaultValue:!0},{name:"groupable",defaultValue:!0},{name:"resizable",defaultValue:!0},"groupRenderer","headerRenderer","tooltipRenderer","cellCls","cls","icon","align",{name:"minWidth",defaultValue:60},{name:"hidden",defaultValue:!1},{name:"locked"},{name:"region"},{name:"showColumnPicker",defaultValue:!0},{name:"enableHeaderContextMenu",defaultValue:!0},{name:"enableCellContextMenu",defaultValue:!0},"headerMenuItems","cellMenuItems","sum","summaries","summaryRenderer","responsiveLevels","tags","touchConfig","tree","filterType",{name:"htmlEncode",defaultValue:!0},{name:"autoSyncHtml",defaultValue:!1},"type",{name:"instantUpdate",defaultValue:!1},{name:"repaintOnResize",defaultValue:!1},"editTargetSelector"]}static get autoExposeFields(){return!1}construct(t,n){const r=this;r.masterStore=n,n&&(r._grid=Array.isArray(n)?n[0].grid:n.grid),r.localizableProperties=t.localizableProperties||["text"],t.localeClass&&(r.localeClass=t.localeClass),super.construct(t,n,null,!1),r.processConfiguredListeners(t.listeners),"field"in r.data||(r.field="_"+(r.type||"")+ ++e.emptyCount),r.hasComplexMapping=r.field&&r.field.includes("."),r.width||r.flex||r.children||r.set({width:e.defaultWidth,flex:null},null,!0)}getRawValue(e){return this.hasComplexMapping?We.getPath(e,this.field):e[this.field]||e.get(this.field)}get nextVisibleSibling(){let e=this.nextSibling;for(;e&&e.hidden;)e=e.nextSibling;return e}get isLast(){return!this.nextVisibleSibling&&(!this.parent||this.parent.isLast)}get isLastInSubGrid(){return(!this.nextVisibleSibling||this.nextVisibleSibling.region!==this.region)&&(!this.parent||this.parent.isLastInSubGrid)}get element(){return this.grid.getHeaderElement(this)}get textWrapper(){return yt.getChild(this.element,".b-grid-header-text")}get textElement(){return yt.down(this.element,".b-grid-header-text-content")}get contentElement(){return yt.down(this.element,".b-grid-header-children")}get editor(){let e=this.data.editor;return!e||e instanceof An||("string"==typeof e&&(e={type:e}),e=this.data.editor=I.createWidget(Object.assign(this.defaultEditor,e))),e}set editor(e){this.data.editor=e}get defaultEditor(){return{type:"textfield",name:this.field}}static get type(){return"column"}static get text(){return this.defaultValues.text}get grid(){return this._grid||this.parent&&this.parent.grid}get locked(){return"locked"===this.data.region}set locked(e){this.region=e?"locked":"normal"}get sortable(){return this.isLeaf&&this.data.sortable}set sortable(e){this.set("sortable",e)}get groupable(){return this.isLeaf&&this.data.groupable}set groupable(e){this.set("groupable",e)}hide(e=!1){const t=this,n=t.parent;t.hidden||(t.hidden=!0,n&&!n.isRoot&&(n.children.some(e=>!0!==e.hidden)||n.hidden||(e=!0,n.hide())),t.children&&t.children.forEach(e=>e.hide(!0)),e||t.stores.forEach(e=>e.trigger("hideColumn")))}show(e=!1){const t=this,n=t.parent;t.hidden&&(t.hidden=!1,n&&n.hidden&&n.show(),t.children&&t.children.forEach(e=>e.show(!0)),e||t.stores.forEach(e=>e.trigger("showColumn")))}toggle(e=null){return this.hidden&&void 0===e||!0===e?this.show():!this.hidden&&void 0===e||!1===e?this.hide():void 0}generateId(){return e.generatedIdIndex||(e.generatedIdIndex=0),(this.field?this.field.replace(/\./g,"-"):"col")+ ++e.generatedIdIndex}get allIndex(){return this.masterStore.indexOf(this)}get width(){return this.data.width}set width(e){const t={width:e};e&&(t.flex=null),this.set(t)}get subGrid(){return this.grid?this.grid.getSubGridFromColumn(this):void 0}measureSize(e){return yt.measureSize(e,this.subGrid?this.subGrid.element:void 0)}calculateMinWidth(){const e=this,t=e.measureSize(e.width),n=e.measureSize(e.minWidth);let r=0;return e.children&&(r=e.children.reduce((e,t)=>e+t.calculateMinWidth(),0)),Math.max(t,n,r)}resizeToFitContent(){const e=this,{grid:t,renderer:n,defaultRenderer:r,element:s}=e,i=t.rowManager,o=t.store,a=o.count,l=n||r;if(a<=0)return;const c=t.element.querySelector(`.b-grid-cell[data-column-id=${e.id}]`),d=c.cssText,u=c.className;let h,g,m,p,f,v=0;if(t.resizeToFitIncludesHeader){const e=window.getComputedStyle(s);v=yt.measureText(s.innerText,s,!1,s.parentElement)+parseInt(e.paddingLeft),s.parentElement.offScreenDiv.parentElement.remove()}for(a>1e3?g=(h=Math.max(Math.min(i.topIndex+i.rowCount/2-500,a-1e3),0))+1e3:(h=0,g=a),m=h;m<g;m++)p=o.getAt(m),f=e.getRawValue(p),l&&(f=null==(f=l.call(e,{cellElement:c,rowElement:c.parentNode,value:f,record:p,column:e,size:{height:p.rowHeight||0},grid:t,row:{},updatingSingleRow:!1}))?c.innerHTML:String(f)),f&&(v=Math.max(v,yt.measureText(f,c,!(e.htmlEncode&&!e.disableHtmlEncode),e.subGrid.element)));return c.className=u,c.cssText=d,e.width=v}getState(){const e=this,t={[e.flex?"flex":"width"]:e.flex?e.flex:e.width,id:e.id,hidden:e.hidden,index:e.allIndex,region:e.region,filterable:e.filterable,text:e.text,locked:e.locked};return e.children&&(t.children=e.children.map(e=>e.getState())),t}applyState(e){const t=this;t.beginBatch(),"locked"in e&&(t.locked=e.locked),"minWidth"in e&&(t.minWidth=e.minWidth),"width"in e&&(t.width=e.width),"flex"in e&&(t.flex=e.flex),"width"in e&&t.flex?t.flex=void 0:"flex"in e&&t.width&&(t.width=void 0),"text"in e&&(t.text=e.text),"region"in e&&(t.region=e.region),"renderer"in e&&(t.renderer=e.renderer),"filterable"in e&&(t.filterable=e.filterable),t.endBatch(),"hidden"in e&&t.toggle(!0!==e.hidden)}clearCell(e){e.innerHTML=""}canEdit(e){return!0}}return e.emptyCount=0,e.defaultWidth=100,e._$name="Column",e}();co.exposeProperties();const uo=function(){class e extends(ge(Nr)){static get defaultConfig(){return{modelClass:co,tree:!0}}construct(e){const t=this;e.grid&&(e.grid._columnStore=t,t.id=`${e.grid.id}-columns`),super.construct(e),t.on({change:t.clearCaches,scope:t,prio:1})}doDestroy(){const e=[];this.traverse(t=>e.push(t)),super.doDestroy(),e.forEach(e=>e.destroy())}getById(e){return super.getById(e)||this.idRegister[e]}forEach(e,t=this){this.tree?this.rootNode.traverseWhile((n,r)=>e.call(t,n,r),!0):super.forEach(e,t)}get totalFixedWidth(){let e=0;for(let t of this)t.hidden||(e+=t.flex?t.measureSize(co.defaultWidth):Math.max(t.measureSize(t.width),t.measureSize(t.minWidth)));return e}get visibleColumns(){return this._visibleColumns||(this._visibleColumns=this.leaves.filter(e=>!e.hidden)),this._visibleColumns}clearCaches(){this._visibleColumns=null}onMasterDataChanged(e){super.onMasterDataChanged(e),this.clearCaches()}getAdjacentVisibleLeafColumn(e,t=!0,n=!1){let r=this.visibleColumns,s=e instanceof co?e:this.getById(e),i=r.indexOf(s)+(t?1:-1);if(!r[i]){if(!n)return null;i=t?0:r.length-1}return r[i]}get bottomColumns(){return this.leaves}get(e){return this.findRecord("field",e,!0)}createRecord(t){let n=this.modelClass;if(t.type&&!(n=e.getColumnClass(t.type)))throw new Error(this.L("columnTypeNotFound",t));t.locked&&(t.region="locked",delete t.locked);const r=new n(t,this);return r.data.region||(r.data.region=this.grid?this.grid.defaultRegion:"normal"),r}indexOf(e){let t=super.indexOf(e);return t>-1?t:this.records.findIndex(t=>t.field===e)}static registerColumnType(t){e.columnTypes||(e.columnTypes={}),e.columnTypes[t.type]=t}static getColumnClass(t){return e.columnTypes&&e.columnTypes[t]}}return e._$name="ColumnStore",e}(),ho=(e,t)=>({update:({store:n,record:r,changes:s})=>{let i=!0;return("width"in s||"minWidth"in s||"flex"in s)&&(i=e.call(t,{store:n,record:r,changes:s})),i}});uo.registerColumnType(co);const go=function(){class e extends co{static get type(){return"widget"}static get fields(){return["widgets"]}static get defaults(){return{filterable:!1,sortable:!1,editor:!1,searchable:!1}}construct(e,t){this.widgetMap={},this.internalCellCls="b-widget-cell",super.construct(...arguments)}doDestroy(){for(const e of Object.values(this.widgetMap))e.destroy&&e.destroy();super.doDestroy()}renderer(e){const t=this,{cellElement:n,column:r,value:s,record:i}=e,o=r.widgets;o&&(n.widgets||t.clearCell(n),n.widgets=o.map((o,a)=>{let l,c;return n.widgets&&(c=(l=n.widgets[a]).element.nextElementSibling,o.recreate&&l&&(delete t.widgetMap[l.id],l.destroy(),n.widgets[a]=null)),l||(t.onBeforeWidgetCreate(o,e),l=I.append(o,c?{insertBefore:c}:n)[0],t.widgetMap[l.id]=l,t.onAfterWidgetCreate(l,e)),l.cellInfo={cellElement:n,value:s,record:i,column:r},t.grid&&(l.readOnly=t.grid.readOnly),!1!==t.onBeforeWidgetSetValue(l,e)&&(o.noValueOnRender||(o.valueProperty?l[o.valueProperty]=s:l.defaultBindProperty?l[l.defaultBindProperty]=s:l.text=l.value=s)),l}))}onBeforeWidgetCreate(e,t){}onAfterWidgetCreate(e,t){}onBeforeWidgetSetValue(e,t){}clearCell(e){e.widgets&&(e.widgets.forEach(e=>{delete this.widgetMap[e.id],e.destroy()}),e.widgets=null),super.clearCell(e)}resizeToFitContent(){}}return e._$name="WidgetColumn",e}();uo.registerColumnType(go),go.exposeProperties();const mo=function(){class e extends go{static get type(){return"check"}static get fields(){return["checkCls"]}static get defaults(){return{align:"center",checkCls:null,widgets:[{type:"checkbox",valueProperty:"checked"}]}}constructor(e,t){super(...arguments),this.internalCellCls="b-check-cell"}onBeforeWidgetCreate(e,t){e.cls=this.checkCls}onAfterWidgetCreate(e,t){t.cellElement.widget=e,e.on({beforeChange:"onBeforeCheckboxChange",change:"onCheckboxChange",thisObj:this})}onBeforeWidgetSetValue(e){e.record=e.cellInfo.record}onBeforeCheckboxChange({source:e,checked:t}){return this.trigger("beforeToggle",{record:e.cellInfo.record,checked:t})}onCheckboxChange({source:e,checked:t}){const n=e.cellInfo.record,r=this.field;if(r){const e=`set${$.capitalizeFirstLetter(r)}`;n[e]?n[e](t):n.set(r,t)}this.trigger("toggle",{record:n,checked:t})}}return e._$name="CheckColumn",e}();uo.registerColumnType(mo);const po=function(){class e extends co{static get type(){return"date"}static get fields(){return["format","pickerFormat","step"]}static get defaults(){return{format:"L",pickerFormat:null,step:1,minWidth:85,filterType:"date"}}constructor(e,t){super(...arguments),this.internalCellCls="b-date-cell"}defaultRenderer({value:e}){return e?this.formatValue(e):""}groupRenderer({cellElement:e,groupRowFor:t}){e.innerHTML=this.formatValue(t)}formatValue(e){return"string"==typeof e&&(e=Ne.parse(e,this.format)),Ne.format(e,this.format)}set format(e){const t=this.editor;this.set("format",e),t&&(t.format=this.format)}get format(){return this.get("format")}get defaultEditor(){const e=this;return{name:e.field,type:"date",calendarContainerCls:"b-grid-cell-editor-related",format:e.format,pickerFormat:e.pickerFormat||e.format,step:e.step}}}return e._$name="DateColumn",e}();uo.registerColumnType(po),po.exposeProperties(),uo.registerColumnType(function(){class e extends co{static get type(){return"percent"}static get fields(){return["lowThreshold"]}static get defaults(){return{editor:{type:"number",min:0,max:100},lowThreshold:20,filterType:"number",htmlEncode:!1,searchable:!1,summaryRenderer:e=>`${e}%`}}constructor(e,t){super(...arguments),this.internalCellCls="b-percent-bar-cell"}renderer({value:e,cellElement:t}){e=e||0,t.percentBarElement||(t.percentBarElement=yt.createElement({tag:"div",className:"b-percent-bar-outer",parent:t,children:[{tag:"div",className:"b-percent-bar",html:"%"}]},!0)[1]);const{percentBarElement:n}=t;n.classList[0===e?"add":"remove"]("b-zero"),n.classList[e<this.lowThreshold?"add":"remove"]("b-low"),n.style.width=e+"%",n.firstChild.data=e+"%"}clearCell(e){e.percentBarElement&&(e.percentBarElement=null),super.clearCell(e)}resizeToFitContent(){}}return e.sum="average",e._$name="PercentColumn",e}());const fo=function(){class e extends co{static get type(){return"number"}static get fields(){return["min","max","step","unit"]}static get defaults(){return{filterType:"number"}}constructor(e,t){super(...arguments),this.internalCellCls="b-number-cell"}get defaultEditor(){return{name:this.field,type:"numberfield",max:this.max,min:this.min,step:this.step}}defaultRenderer({value:e=0}){return this.unit?`${e}${this.unit}`:e}}return e._$name="NumberColumn",e}();uo.registerColumnType(fo),fo.exposeProperties();const vo=function(){class e extends fo{static get type(){return"rating"}static get fields(){return["emptyIcon","filledIcon","editable"]}static get defaults(){return{min:0,max:5,emptyIcon:"b-icon b-icon-star",filledIcon:"b-icon b-icon-star",editable:!0,filterType:"number",searchable:!1,width:"11.2em",htmlEncode:!1,autoSyncHtml:!0,minWidth:"11.2em",editor:!1}}constructor(e,t){super(...arguments),this.internalCellCls="b-rating-cell"}renderer({value:e}){let t=`<div class="b-rating-cell-inner ${this.editable?"":"b-not-editable"}">`;for(let n=0;n<this.max;n++)t+=`<i class="b-rating-icon ${n<e?"b-filled "+this.filledIcon:"b-empty "+this.emptyIcon}"></i>`;return t+"</div>"}onCellClick({grid:e,column:t,record:n,target:r,event:s}){if(r.classList.contains("b-rating-icon")&&!e.readOnly&&t.editable){let e=[].indexOf.call(r.parentNode.childNodes,r);r.classList.contains("b-filled")&&(s.metaKey||s.shiftKey)&&(e-=1),1===n.get(t.field)&&0===e&&(e=-1),n.set(t.field,e+1)}}}return e._$name="RatingColumn",e}();uo.registerColumnType(vo),vo.exposeProperties(),uo.registerColumnType(function(){class e extends co{static get defaults(){return{groupable:!1,sortable:!1,filterable:!1,searchable:!1,resizable:!1,minWidth:50,width:50,align:"right",text:"#",editor:!1}}construct(e,t){const n=this;super.construct(...arguments),n.grid&&(n.grid.store.on({change:n.resizeToFitContent,thisObj:n}),n.grid.store.count&&n.grid.on({render:n.resizeToFitContent,thisObj:n,once:!0})),n.internalCellCls="b-row-number-cell"}static get type(){return"rownumber"}renderer({record:e,grid:t}){return e.meta.specialRow?"":t.store.indexOf(e,!0)+1}resizeToFitContent(){const e=this.grid,t=e.store.count;if(t&&!this.hidden){const n=e.element.querySelector(`.b-grid-cell[data-column-id=${this.id}]`);if(n){const e=window.getComputedStyle(n),r=parseInt(e["padding-left"]),s=yt.measureText(t,n);this.width=s+2*r}}}set flex(e){}}return e._$name="RowNumberColumn",e}());const yo=function(){class e extends co{static get fields(){return["template"]}static get defaults(){return{htmlEncode:!1}}constructor(e,t){if(super(...arguments),!this.template)throw new Error(this.L("noTemplate"));if("function"!=typeof this.template)throw new Error(this.L("noFunction"))}static get type(){return"template"}renderer(e){if(!e.record.meta.specialRow)return this.template({value:e.value,record:e.record,field:e.column.field})}}return e._$name="TemplateColumn",e}();uo.registerColumnType(yo),yo.exposeProperties();const bo=function(){class e extends co{static get type(){return"time"}static get fields(){return["format"]}static get defaults(){return{format:"LT",minWidth:140,filterType:"time"}}constructor(e,t){super(...arguments),this.internalCellCls="b-time-cell"}defaultRenderer({value:e}){return e?this.formatValue(e):""}groupRenderer({cellElement:e,groupRowFor:t}){e.innerHTML=this.formatValue(t)}formatValue(e){return"string"==typeof e&&(e=Ne.parse(e,this.format)),Ne.format(e,this.format)}set format(e){const t=this.editor;this.set("format",e),t&&(t.format=this.format)}get format(){return this.get("format")}get defaultEditor(){return{name:this.field,type:"time",format:this.format}}}return e._$name="TimeColumn",e}();uo.registerColumnType(bo),bo.exposeProperties();let Co=!1;const wo=function(){class e extends co{static get defaults(){return{tree:!0,hideable:!1,minWidth:150}}static get fields(){return[{name:"expandIconCls",defaultValue:"b-icon b-icon-tree-expand"},{name:"collapseIconCls",defaultValue:"b-icon b-icon-tree-collapse"},{name:"collapsedFolderIconCls"},{name:"expandedFolderIconCls"},{name:"leafIconCls",defaultValue:"b-icon b-icon-tree-leaf"},{name:"editTargetSelector",defaultValue:".b-tree-cell-value"}]}static get type(){return"tree"}constructor(e,t){super(...arguments);const n=this;n.internalCellCls="b-tree-cell",n.shouldHtmlEncode=n.htmlEncode,n.tempDiv=document.createElement("div"),n.setData("htmlEncode",!1),n.renderer&&(n.originalRenderer=n.renderer),n.renderer=n.treeRenderer.bind(n)}treeRenderer(e){const t=this;let n,{cellElement:r,row:s,record:i,value:o}=e,a="",l=i.instanceMeta(e.grid.store),c="",d=i.href?"a":"div";if(t.originalRenderer){const n=t.originalRenderer(e);o=!1===n?r.innerHTML:n}return i.isLeaf?(r.classList.add("b-tree-leaf-cell"),(n=e.iconCls||i.iconCls||t.leafIconCls)&&(c+=n)):(s.addCls&&s.addCls("b-tree-parent-row"),r.classList.add("b-tree-parent-cell"),l.isLoadingChildren&&s.addCls("b-loading-children"),a+=`<div class="b-tree-expander ${l.collapsed?t.expandIconCls+" b-tree-collapsed":t.collapseIconCls+" b-tree-expanded"}"></div>`,Co=n=e.iconCls||i.iconCls||(l.collapsed?t.collapsedFolderIconCls:t.expandedFolderIconCls),n&&(a+=`<div class="b-tree-icon ${n}"></div>`)),o=null!=o?o:"",t.shouldHtmlEncode&&(t.tempDiv.innerText=o,o=t.tempDiv.innerHTML),`<${d} ${i.href?`href="${i.href}"`:""} ${"a"===d&&i.target?`target="${i.target}"`:""} class="b-tree-cell-inner ${c}" style="padding-left:${1.7*i.childLevel+(i.isLeaf?Co?1.8:n?.4:.3:0)}em">${a+=`<div class="b-tree-cell-value">${o}</div>`}</${d}>`}}return e._$name="TreeColumn",e}();uo.registerColumnType(wo),wo.exposeProperties();const So=function(){class e extends Sr{static get fields(){return["iconCls","expanded","cls","rowHeight","href","target"]}}return e._$name="GridRowModel",e}();So.exposeProperties();const Do=new Map,Eo=new Map,xo="Grid",To=function(){class e{static registerFeature(e,t=!1,n=null,r=null){r=$.lowercaseFirstLetter(r||e.$name),Array.isArray(n)||(n=[n||xo]),n.forEach(n=>{const s=Do.get(n)||new Map,i=Eo.get(n)||new Map;s.set(r,e),i.set(e,t),Do.set(n,s),Eo.set(n,i)})}static getTypeNameFeatures(e=xo){const t=Do.get(e),n={};return t&&t.forEach((e,t)=>n[t]=e),n}static getTypeNameDefaultFeatures(e=xo){const t=Do.get(e),n=Eo.get(e);let r={};return t&&n&&t.forEach((e,t)=>{n.get(e)&&(r[t]=e)}),r}static getInstanceFeatures(e){return e.classNameHierarchy().reduce((e,t)=>Object.assign(e,this.getTypeNameFeatures(t)),{})}static getInstanceDefaultFeatures(e){return e.classNameHierarchy().reduce((e,t)=>Object.entries(this.getTypeNameFeatures(t)).reduce((e,[n,r])=>(this.isDefaultFeatureForTypeName(r,t)?e[n]=r:delete e[n],e),e),{})}static isDefaultFeatureForTypeName(e,t=xo){const n=Eo.get(t);return n&&n.get(e)||!1}static isDefaultFeatureForInstance(e,t){const n=t.classNameHierarchy().reverse();let r=null;for(let s=0,i=n.length;s<i&&null===r;++s){const t=Eo.get(n[s]);t&&t.has(e)&&(r=t.get(e))}return r||!1}static reset(){Do.clear(),Eo.clear()}}return e._$name="GridFeatureManager",e}();To.registerFeature(function(){class e extends ur{static get defaultConfig(){return{tooltipRenderer:null}}construct(e,t){const n=this;super.construct(e,n.processConfig(t)),n.tip=new er(Object.assign({forElement:e.element,forSelector:".b-grid-cell",hoverDelay:1e3,trackMouse:!1,cls:"b-celltooltip-tip",getHtml:n.getTooltipContent.bind(n),listeners:{pointerOver:"onPointerOver",thisObj:n}},t)),n.relayEvents(n.tip,["beforeshow","show"])}onPointerOver({target:e}){return!1!==this.client.getColumnFromElement(e).tooltipRenderer}processConfig(e){return"function"==typeof e?{tooltipRenderer:e}:e}setConfig(e){super.setConfig(this.processConfig(e))}doDestroy(){this.tip.destroy(),super.doDestroy()}getTooltipContent({tip:e,forElement:t,event:n}){const r=this,s=r.client.getRecordFromElement(t),i=r.client.getColumnFromElement(t);let o;return r.forSelector||s!==r.lastRecord||i!==r.lastColumn?(i.tooltipRenderer?o=i.tooltipRenderer({cellElement:t,record:s,column:i,event:n,tip:e,cellTooltip:r}):r.tooltipRenderer&&!1!==i.tooltipRenderer&&(o=r.tooltipRenderer({cellElement:t,record:s,column:i,event:n,tip:e,cellTooltip:r})),null!=o&&(r.lastRecord=s,r.lastColumn=i),o):r.tip._html}}return e._$name="CellTooltip",e}()),To.registerFeature(function(){class e extends(U(ur)){static get pluginConfig(){return{after:["render"]}}construct(e,t){e.features.columnReorder&&e.features.columnReorder.on("beforedestroy",this.onColumnReorderBeforeDestroy,this),this.grid=e,super.construct(e,t)}doDestroy(){const e=this;e.grid.features.columnReorder&&!e.grid.features.columnReorder.isDestroyed&&e.detachFromColumnReorder(),e.element&&e.element.remove(),e.element=null,super.doDestroy()}init(){const e=this,t=e.grid;t.features.columnReorder&&(e.reorderDetacher=t.features.columnReorder.on({gridheaderdragstart({context:n}){const r=t.columns.getById(n.element.dataset.columnId);e.showToolbar(r)},gridheaderdrag:({context:t})=>e.onDrag(t),gridheaderabort:()=>{e.hideToolbar()},gridheaderdrop:({context:t})=>{t.valid?e.hideToolbar():e.onDrop(t)}}),e.initialized=!0)}onColumnReorderBeforeDestroy(){this.detachFromColumnReorder()}detachFromColumnReorder(){const e=this;e.grid.features.columnReorder.un("beforedestroy",e.onColumnReorderBeforeDestroy,e),e.reorderDetacher&&e.reorderDetacher(),e.reorderDetacher=null}render(){this.initialized||this.init()}showToolbar(e){const t=this,n=t.grid.getColumnDragToolbarItems(e,[]),r=[];t.clearTimeout(t.buttonHideTimer),t.clearTimeout(t.toolbarHideTimer),n.forEach(e=>{let t=r.find(t=>t.text===e.group);t||r.push(t={text:e.group,buttons:[]}),t.buttons.push(e)}),t.element=yt.append(t.grid.element,t.template(r)),t.groups=r,t.buttons=n,t.column=e}hideToolbar(){const e=this;return new Promise(t=>{e.element&&!e.toolbarHideTimer&&(e.element.classList.add("b-remove"),e.toolbarHideTimer=e.setTimeout(()=>{e.toolbarHideTimer=null,e.element&&e.element.remove(),e.element=null,t()},200))})}onDrag(e){const t=this;if(e.dragProxy.getBoundingClientRect().top-t.grid.element.getBoundingClientRect().top>100?t.element.classList.add("b-closer"):t.element.classList.remove("b-closer"),t.hoveringButton&&(t.hoveringButton.classList.remove("b-hover"),t.hoveringButton=null),e.targetElement&&e.targetElement.closest(".b-columndragtoolbar")){t.element.classList.add("b-hover");let n=e.targetElement.closest(".b-columndragtoolbar  .b-target-button:not([data-disabled=true])");n&&(n.classList.add("b-hover"),t.hoveringButton=n)}else t.element.classList.remove("b-hover")}onDrop(e){const t=this;if(e.targetElement&&e.targetElement.matches(".b-columndragtoolbar .b-target-button:not([data-disabled=true])")){const n=e.targetElement,r=t.buttons.find(e=>e.name===n.dataset.name);r&&(n.classList.add("b-activate"),t.buttonHideTimer=t.setTimeout(()=>{t.hideToolbar(),r.onDrop({column:t.column})},100))}else t.hideToolbar()}template(e){return Gn.tpl`
            <div class="b-columndragtoolbar">     
            <div class="b-title"></div>          
            ${e.map(e=>Gn.tpl`
                <div class="b-group">
                    <div class="b-buttons">
                    ${e.buttons.map(e=>Gn.tpl`
                        <div class="b-target-button" data-name="${e.name}" data-disabled="${e.disabled}">
                            <i class="${e.icon}"></i>
                            ${e.text}
                        </div>
                    `)}
                    </div>
                    <div class="b-title">${e.text}</div>
                </div>
            `)}
            </div>`}}return e.featureClass="b-hascolumndragtoolbar",e._$name="ColumnDragToolbar",e}(),G.isTouchDevice),To.registerFeature(function(){class e extends ur{static get defaultConfig(){return{groupByRegion:!1,groupByTag:!1}}static get pluginConfig(){return{chain:["getHeaderMenuItems","getColumnDragToolbarItems"]}}construct(e,t){this.grid=e,super.construct(e,t)}getColumnPickerItems(e){const t=this;if(t.groupByRegion)return t.grid.regions.map(e=>{const n=t.grid.getSubGrid(e).columns.records;return{text:$.capitalizeFirstLetter(e),menu:t.buildColumnMenu(n),disabled:0===n.length,region:e}});if(t.groupByTag){const n={};return e.forEach(e=>{e.tags&&e.hideable&&e.tags.forEach(e=>{n[e]||(n[e]=1)})}),Object.keys(n).sort().map(e=>({text:$.capitalizeFirstLetter(e),menu:t.buildColumnMenu(t.getColumnsForTag(e)),tag:e,onBeforeSubMenu:({item:e,itemEl:n})=>{t.refreshTagMenu(e,n)}}))}return t.buildColumnMenu(e.records)}getColumnsForTag(e){return this.grid.columns.records.filter(t=>t.tags&&t.tags.includes(e)&&!1!==t.hideable)}refreshTagMenu(e,t){this.getColumnsForTag(e.tag).forEach(t=>{const n=e.items.find(e=>e.column===t);n&&(n.checked=!0!==t.hidden)})}buildColumnMenu(e){let t=e.length>0&&e[0].region,{grid:n}=this;return e.reduce((e,r)=>{const s=this.grid.columns.visibleColumns.filter(e=>e.region===r.region);if(!1!==r.hideable){const i={grid:n,text:r.text,column:r,name:r.id,checked:!0!==r.hidden,disabled:!0!==r.hidden&&1===s.length,cls:r.region!==t?"b-separator":""};t=r.region,r.children&&(i.menu=this.buildColumnMenu(r.children)),e.push(i)}return e},[])}getHeaderMenuItems(e,t){const n=this,{grid:r}=n,{columns:s}=r;if(!1!==e.showColumnPicker&&s.some(e=>e.hideable)&&t.push({text:n.L("columnsMenu"),name:"columnPicker",icon:"b-fw-icon b-icon-columns",cls:"b-separator",weight:100,menu:n.getColumnPickerItems(s),onToggle:n.onColumnToggle}),!1!==e.hideable){const r=s.visibleColumns.filter(t=>t.region===e.region);t.push({text:n.L("hideColumn"),icon:"b-fw-icon b-icon-hide-column",weight:101,name:"hideColumn",disabled:1===r.length,onItem:()=>e.hide()})}}onColumnToggle({menu:e,item:t,checked:n}){if(!!t.column.hidden!=!n){t.column[n?"show":"hide"]();const{grid:r,column:s}=t,{columns:i}=r,o=e.items,a=i.visibleColumns.filter(e=>e.region===t.column.region),{currentMenu:l}=r.features.contextMenu,c=l.items.find(e=>"hideColumn"===e.name);if(1===a.length){const e=o.find(e=>e.name===a[0].id);e&&(e.disabled=!0),c&&s.region===t.column.region&&(c.disabled=!0)}else a.forEach(e=>{const t=o.find(t=>t.column===e);t&&(t.disabled=!1)}),c&&s.region===t.column.region&&(c.disabled=!1);t.menu&&t.menu.eachWidget(e=>{e.checked=n});const d=e.owner;if(d&&d.column===s.parent){const e=o.some(e=>!0===e.checked);d.checked=e}}}getColumnDragToolbarItems(e,t){const n=this.grid.columns.visibleColumns.filter(t=>t.region===e.region);return!1!==e.hideable&&n.length>1&&t.push({text:this.L("hideColumnShort"),group:this.L("Column"),icon:"b-fw-icon b-icon-hide-column",weight:101,name:"hideColumn",onDrop:({column:e})=>e.hide()}),t}}return e._$name="ColumnPicker",e}(),!0),To.registerFeature(function(){class e extends(U(ur)){construct(e){this.ignoreSelectors=[".b-grid-header-resize-handle",".b-field"],this.grid=e,super.construct(e)}doDestroy(){this.dragHelper&&this.dragHelper.destroy(),super.doDestroy()}init(){const e=this,{grid:t}=e,n=t.element,r=yt.children(n,".b-grid-headers");r.push(...yt.children(n,".b-grid-header-children")),e.dragHelper?e.dragHelper.containers=r:(e.dragHelper=new Ii({name:"columnReorder",mode:"container",dragThreshold:10,targetSelector:".b-grid-header",outerElement:n.querySelector("header.b-grid-header-container"),containers:r,isElementDraggable(n){if(Boolean(yt.up(n,e.ignoreSelectors.join(","))))return!1;const r=yt.up(n,this.targetSelector),s=r&&t.columns.getById(r.dataset.columnId),i=s&&0===s.childLevel&&1===t.subGrids[s.region].columns.count;return Boolean(s)&&!1!==s.draggable&&!i},ignoreSelector:".b-filter-icon,.b-grid-header-resize-handle",listeners:{dragstart:e.onDragStart,drag:e.onDrag,drop:e.onDrop,thisObj:e}}),e.relayEvents(e.dragHelper,["dragstart","drag","drop","abort"],"gridheader"))}static get pluginConfig(){return{after:["render","renderContents"]}}onDrag({context:e,event:t}){const n=k.fromElement(t.target,"header");n&&n.subGrid.sealedColumns?e.valid=!1:this.grid.features.columnDragToolbar||(e.valid=Boolean(t.target.closest(".b-grid-headers")))}onDragStart(){const e=this;if(!e.grid.features.columnDragToolbar){const t=e.grid.element.querySelector(".b-grid-header-container").getBoundingClientRect();e.dragHelper.minY=t.top,e.dragHelper.maxY=t.bottom}this.grid.headerContainer.classList.add("b-dragging-header")}onDrop({context:e}){if(!e.valid)return this.onInvalidDrop({context:e});const t=this.grid,n=e.dragging,r=yt.up(e.target,".b-grid-header"),s=t.columns.get(r.dataset.column),i=e.draggedTo.dataset.region||s.region,o=e.insertBefore,a=t.columns.getById(n.dataset.columnId),l=o?t.columns.getById(o.dataset.columnId):t.subGrids[i].columns.last.nextSibling,c=l?l.parent:t.columns.rootNode;if(t.headerContainer.classList.remove("b-dragging-header"),i===a.region&&s===a.previousSibling)return void this.dragHelper.abort();const d=a.parent&&1===a.parent.children.length&&a.parent;d&&d.parent.removeChild(d),n.remove(),a.region=i,c.insertChild(a,l)}onInvalidDrop({}){this.grid.headerContainer.classList.remove("b-dragging-header")}renderContents(){this.init()}render(){this.init()}}return e.featureClass="b-column-reorder",e._$name="ColumnReorder",e}(),!0),To.registerFeature(function(){class e extends ur{static get defaultConfig(){return{liveResize:"auto"}}construct(e,t){const n=this;n.grid=e,super.construct(e,t),n.resizer=new Hi({name:"columnResize",targetSelector:".b-grid-header",handleSelector:".b-grid-header-resize-handle",outerElement:e.element,listeners:{resizestart:n.onResizeStart,resizing:n.onResizing,resize:n.onResize,thisObj:n}})}static get pluginConfig(){return[]}set liveResize(e){"auto"===e&&(e=!G.isMobileSafari),this._liveResize=e}get liveResize(){return this._liveResize}doDestroy(){this.resizer&&this.resizer.destroy(),super.doDestroy()}onResizeStart({context:e}){const t=e.column=this.grid.columns.getById(e.element.dataset.columnId);this.resizer.minWidth=t.minWidth,e.element.style.minWidth="",this.grid.element.classList.add("b-column-resizing")}onResizing({context:e}){e.valid&&this.liveResize&&(this.grid.dragResizing=!0,e.column.width=e.newWidth)}onResize({context:e}){const t=this,n=e.column;if(t.grid.element.classList.remove("b-column-resizing"),e.valid&&(t.liveResize?(t.grid.dragResizing=!1,t.grid.afterColumnsResized()):e.column.width=e.newWidth,G.isIE11&&n.parent&&n.parent.flex)){const e=n.parent;t.grid.getHeaderElement(e.id).style.flexBasis=e.children.reduce((e,n)=>e+t.grid.getHeaderElement(n.id).offsetWidth,0)+"px"}}}return e.featureClass="b-column-resize",e._$name="ColumnResize",e}(),!0),To.registerFeature(function(){class e extends ur{static get defaultConfig(){return{headerItems:[],processHeaderItems:null,cellItems:[],processCellItems:null,triggerEvent:null}}construct(e,t){this.grid=e,super.construct(e,t)}doDestroy(){this.currentMenu&&this.currentMenu.destroy(),super.doDestroy()}static get pluginConfig(){return{assign:["showContextMenu"],chain:["onElementContextMenu","onElementClick","onElementDblClick","onElementKeyDown"]}}onElementContextMenu(e){"contextmenu"===this.triggerEvent&&this.showContextMenu(e)}onElementClick(e){"click"===this.triggerEvent&&this.showContextMenu(e)}onElementDblClick(e){"dblclick"===this.triggerEvent&&this.showContextMenu(e)}onElementKeyDown(e){if(!e.handled&&e.target.matches(".b-grid-header.b-depth-0"))switch(e.key){case" ":case"ArrowDown":this.showContextMenu(e)}}showContextMenu(e){const t=this.grid,n=yt.up(e.target,".b-grid-header"),r=t.getEventData(e);n?this.handleHeaderContextMenu(n,e):r&&this.handleCellContextMenu(r,e)}handleHeaderContextMenu(e,t){if(e.dataset.column){const n=this,r=n.grid,s=r.columns.getById(e.dataset.columnId),i=e=>{e.column||(e.column=s);let t=e.menu;t&&(Array.isArray(t)||(t=t.items||t.widgets),t.forEach(i))};if(!1!==s.enableHeaderContextMenu){const o=[...n.headerItems,...s.headerMenuItems||[]],{processHeaderItems:a}=n,l={items:o,column:s,event:t,element:e};r.getHeaderMenuItems(s,o),(!a||!1!==a(l))&&o.length>0&&(t.preventDefault(),o.sort((e,t)=>(e.weight||150)-(t.weight||150)),o.forEach(i),!1!==r.trigger("headerContextMenuBeforeShow",l)&&(n.currentMenu=I.showContextMenu("keydown"===t.type?e:[t.clientX+1,t.clientY+1],{owner:n.client,constrainTo:document,cls:"b-context-menu",items:o,scrollAction:"hide",onItem({item:e,element:t}){r.trigger("contextMenuItem",{source:r,item:e,column:s,element:t})},onToggle({item:e,checked:t,element:n}){r.trigger("contextMenuToggleItem",{source:r,item:e,column:s,checked:t,element:n})},onDestroy(){n.currentMenu=null},listeners:{show({source:e}){l.menu=e,r.trigger("headerContextMenuShow",l)}}})))}}}handleCellContextMenu(e,t){const n=this,r=n.grid,s=e.cellElement,i=r.columns.getById(e.columnId);if(!1!==i.enableCellContextMenu){r.focusCell(e.cellSelector,{doSelect:!r.isSelected(e.id),event:t});const o=e.record,a=[...n.cellItems||[],...i.cellMenuItems||[]],{processCellItems:l}=n,c={items:a,column:i,event:t,record:o,element:s};r.getCellMenuItems(i,o,a),(!l||!1!==l(c))&&a.length>0&&(a.forEach(e=>{e.column=i,e.record=o}),t.preventDefault(),a.sort((e,t)=>(e.weight||150)-(t.weight||150)),!1!==r.trigger("cellContextMenuBeforeShow",c)&&(n.currentMenu=I.showContextMenu([t.clientX+1,t.clientY+1],{owner:n.client,items:a,onBeforeItem:e=>{Object.assign(e,c)},onItem({item:e}){r.trigger("contextMenuItem",{source:r,item:e,column:i,record:o,cell:s})},onClose({reason:e}){"outside"!==e&&r.element.focus()},onDestroy(){n.currentMenu=null},listeners:{show({source:e}){c.menu=e,r.trigger("cellContextMenuShow",c)}}})))}}hideContextMenu(e){this.currentMenu&&this.currentMenu.hide(e)}get triggerEvent(){return this._triggerEvent||this.client.contextMenuTriggerEvent}set triggerEvent(e){this._triggerEvent=e}}return e.featureClass="",e._$name="ContextMenu",e}(),!0),To.registerFeature(function(){class e extends ur{static get pluginConfig(){return{chain:["renderHeader","getCellMenuItems","getHeaderMenuItems","onElementClick"]}}construct(e,t){const n=this;n.grid=e,n.store=e.store,n.closeFilterEditor=n.closeFilterEditor.bind(n),super.construct(e,t),n.store.on({filter:n.onStoreFilter},n),t&&"object"==typeof t&&n.store.filter(t,null,n.client.isConfiguring)}doDestroy(){const e=this;e.filterTip&&e.filterTip.destroy(),e.store.un({sort:e.onStoreFilter},e),super.doDestroy()}refreshHeaders(e){let t=this,n=t.grid,r=n.headerContainer;if(r){yt.children(r,".b-filter-icon.b-latest").forEach(e=>e.classList.remove("b-latest")),t.filterTip||(t.filterTip=new er({forElement:r,forSelector:".b-filter-icon",getHtml:({forElement:e})=>e.dataset.filterText}));for(let e of n.columns)if(!1!==e.filterable){let n=t.store.filters.getBy("property",e.field),r=e.element;if(r){let s,i=e.textWrapper,o=i&&i.querySelector(".b-filter-icon");s=n?t.L("filter")+": "+("string"==typeof n?n:`${n.operator} ${n.displayValue||n.value||""}`):t.L("applyFilter"),o?o.dataset.filterText=s:(o=yt.createElement({parent:i,tag:"div",className:"b-filter-icon",dataset:{filterText:s}}),r.classList.add("b-filterable")),e.field===t.store.latestFilterField&&o.classList.add("b-latest"),r.classList[n?"add":"remove"]("b-filter")}e.meta.isFiltered=!!n}e&&n.refreshRows()}}applyFilter(e){const{store:t}=this,n=this.grid.columns.get(e.property);t.filter("function"==typeof n.filterable?{filterBy:t=>n.filterable(Object.assign({},e,{record:t})),value:e.value,property:e.property,operator:e.operator,displayValue:e.displayValue}:e)}getPopupDateItems(e,t,n,r,s,i,o){const a=this,l=i,c=o;function d({source:e,value:t}){null==t?o():(a.applyFilter({property:r,operator:e.operator,value:t,displayValue:e._value}),i())}return[{type:"date",ref:"on",placeholder:a.L("on"),clearable:!0,label:'<i class="b-fw-icon b-icon-filter-equal"></i>',value:t&&"="===t.operator?t.value:n,operator:"=",onChange:d,onClose:l,onClear:c},{type:"date",ref:"before",placeholder:a.L("before"),clearable:!0,label:'<i class="b-fw-icon b-icon-filter-before"></i>',value:t&&"<"===t.operator?t.value:null,operator:"<",onChange:d,onClose:l,onClear:c},{type:"date",ref:"after",cls:"b-last-row",placeholder:a.L("after"),clearable:!0,label:'<i class="b-fw-icon b-icon-filter-after"></i>',value:t&&">"===t.operator?t.value:null,operator:">",onChange:d,onClose:l,onClear:c}]}getPopupNumberItems(e,t,n,r,s,i,o){const a=this,l=i,c=o;function d({source:e,value:t}){null==t?o():(a.applyFilter({property:r,operator:e.operator,value:t}),i())}return[{type:"number",placeholder:a.L("equals"),clearable:!0,label:'<i class="b-fw-icon b-icon-filter-equal"></i>',value:t&&"="===t.operator?t.value:n,operator:"=",onChange:d,onEsc:l,onClear:c},{type:"number",placeholder:a.L("lessThan"),clearable:!0,label:'<i class="b-fw-icon b-icon-filter-less"></i>',value:t&&"<"===t.operator?t.value:null,operator:"<",onChange:d,onEsc:l,onClear:c},{type:"number",cls:"b-last-row",placeholder:a.L("moreThan"),clearable:!0,label:'<i class="b-fw-icon b-icon-filter-more"></i>',value:t&&">"===t.operator?t.value:null,operator:">",onChange:d,onEsc:l,onClear:c}]}getPopupStringItems(e,t,n,r,s,i,o){const a=this;return[{type:e,cls:"b-last-row",placeholder:a.L("filter"),clearable:!0,label:'<i class="b-fw-icon b-icon-filter-equal"></i>',value:t?t.value||t:n,onChange:({value:e})=>{""===e?o():(a.applyFilter({property:r,value:e}),i())},onClose:i,onClear:o}]}getPopupItems(e,t,n,r,s,i,o){switch(e){case"date":return this.getPopupDateItems(...arguments);case"number":return this.getPopupNumberItems(...arguments);default:return this.getPopupStringItems(...arguments)}}showFilterEditor(e,t){let n=this,r="string"==typeof e?n.grid.columns.getById(e):e,s=r.element,i=n.store.filters.getBy("property",r.field);!1!==r.filterable&&(n.filterEditorPopup=I.openPopup(s,{width:"16em",cls:"b-filter-popup",scrollAction:"realign",items:n.getPopupItems({string:"text",number:"number",date:"date"}[r.filterType||r.type||"string"]||"text",i,t,r.field,n.store,n.closeFilterEditor,()=>{n.store.removeFieldFilter(r.field),n.closeFilterEditor()})}))}closeFilterEditor(){this.filterEditorPopup&&this.filterEditorPopup.setTimeout(this.filterEditorPopup.destroy),this.filterEditorPopup=null}getMenuDateItems(e,t){const n=this,r=t[e.field],s=t=>{n.applyFilter({property:e.field,operator:t,value:r,displayValue:e.formatValue?e.formatValue(r):r})};return[{text:n.L("on"),icon:"b-fw-icon b-icon-filter-equal",cls:"b-separator",name:"filterDateEquals",onItem:()=>s("=")},{text:n.L("before"),icon:"b-fw-icon b-icon-filter-before",name:"filterDateBefore",onItem:()=>s("<")},{text:n.L("after"),icon:"b-fw-icon b-icon-filter-after",name:"filterDateAfter",onItem:()=>s(">")}]}getMenuNumberItems(e,t){const n=this,r=r=>{n.applyFilter({property:e.field,operator:r,value:t[e.field]})};return[{text:n.L("equals"),icon:"b-fw-icon b-icon-filter-equal",cls:"b-separator",name:"filterNumberEquals",onItem:()=>r("=")},{text:n.L("lessThan"),icon:"b-fw-icon b-icon-filter-less",name:"filterNumberLess",onItem:()=>r("<")},{text:n.L("moreThan"),icon:"b-fw-icon b-icon-filter-more",name:"filterNumberMore",onItem:()=>r(">")}]}getMenuStringItems(e,t){return[{text:this.L("equals"),icon:"b-fw-icon b-icon-filter-equal",cls:"b-separator",name:"filterStringEquals",onItem:()=>{this.applyFilter({property:e.field,value:t[e.field]})}}]}getCellMenuItems(e,t,n){const r=this,s=t.getFieldDefinition(e.field);if(!1!==e.filterable){let t=[];switch(e.meta.isFiltered&&t.push({text:r.L("removeFilter"),icon:"b-fw-icon b-icon-clear",cls:"b-separator",name:"filterRemove",onItem:()=>{r.store.removeFieldFilter(e.field)}}),e.filterType||e.type||s&&s.type){case"date":t.push(...r.getMenuDateItems(...arguments));break;case"number":t.push(...r.getMenuNumberItems(...arguments));break;default:t.push(...r.getMenuStringItems(...arguments))}e.meta.isFiltered&&t.length>1&&(t[1].cls=""),n.push(...t)}}getHeaderMenuItems(e,t){const n=this;e.meta.isFiltered?(t.push({text:n.L("editFilter"),name:"editFilter",icon:"b-fw-icon b-icon-filter",cls:"b-separator",onItem(){n.showFilterEditor(e)}}),t.push({text:n.L("removeFilter"),name:"removeFilter",icon:"b-fw-icon b-icon-remove",onItem:()=>{n.store.removeFieldFilter(e.field)}})):!1!==e.filterable&&t.push({text:n.L("filter"),name:"filter",icon:"b-fw-icon b-icon-filter",cls:"b-separator",onItem(){n.showFilterEditor(e)}})}onStoreFilter(){this.refreshHeaders(!1)}renderHeader(){this.refreshHeaders(!1)}onElementClick(e){const t=e.target;if(this.filterEditorPopup&&this.closeFilterEditor(),t.classList.contains("b-filter-icon")){const e=yt.up(t,".b-grid-header");return this.showFilterEditor(e.dataset.columnId),!1}}}return e.featureClass="b-filter",e._$name="Filter",e}()),To.registerFeature(function(){class e extends ur{static get defaultConfig(){return{keyStrokeFilterDelay:300,clearStoreFiltersOnHide:!0}}construct(e,t){const n=this;Object.assign(n,{filterFieldCls:"b-filter-bar-field",filterFieldInputCls:"b-filter-bar-field-input",filterableColumnCls:"b-filter-bar-enabled",filterFieldInputSelector:".b-filter-bar-field-input",filterableColumnSelector:".b-filter-bar-enabled",filterParseRegExp:/^\s*([<>=*])?(.*)$/,storeTrackingSupended:0,store:e.store,grid:e}),n.onColumnFilterFieldChange=n.onColumnFilterFieldChange.bind(n),super.construct(e,Array.isArray(t)?{filter:t}:t),n.store.on({filter:n.onStoreFilter,thisObj:n}),n.filter&&n.store.filter(n.filter),n.gridDetacher=e.on("beforeelementclick",n.onBeforeElementClick,n)}doDestroy(){this.destroyFilterBar(),this.gridDetacher&&this.gridDetacher(),super.doDestroy()}static get pluginConfig(){return{before:["onElementKeyDown"],chain:["renderHeader","getHeaderMenuItems"]}}destroyFilterBar(){const e=this.grid.columns;e&&e.forEach(this.destroyColumnFilterField,this)}hideFilterBar(){const e=this,t=e.grid.columns;e.clearStoreFiltersOnHide&&e.suspendStoreTracking(),t&&t.forEach(t=>e.hideColumnFilterField(t,!0)),e.grid.store.filter(),e.clearStoreFiltersOnHide&&e.resumeStoreTracking(),e.hidden=!0}showFilterBar(){this.renderFilterBar(),this.hidden=!1}toggleFilterBar(){this.hidden?this.showFilterBar():this.hideFilterBar()}renderFilterBar(){const e=this;e.grid.columns.visibleColumns.forEach(t=>e.renderColumnFilterField(t))}renderColumnFilterField(e){const t=this,n=t.grid,r=t.getColumnFilterable(e);if(r&&!e.hidden){const s=e.element;let i=t.getColumnFilterField(e);if(i)t.onColumnFilterFieldChange({source:i,value:i.value}),i.render(s),i.show();else{const o=n.store.filters.getBy("property",e.field);i=I.append(Object.assign({type:`${e.filterType||"text"}field`,owner:t.grid,clearable:!0,column:e,name:e.field,value:o&&t.buildFilterString(o),cls:t.filterFieldCls,inputCls:t.filterFieldInputCls,keyStrokeChangeDelay:t.keyStrokeFilterDelay,onChange:t.onColumnFilterFieldChange,onClear:t.onColumnFilterFieldChange},r.filterField),s)[0],t.setColumnFilterField(e,i)}s.classList.add(t.filterableColumnCls)}}updateColumnFilterFields(){const e=this,t=e.grid;let n,r;for(let s of t.columns)(n=e.getColumnFilterField(s))&&(r=t.store.filters.getBy("property",s.field),n.value=r&&e.buildFilterString(r)||"")}getColumnFilterable(e){if(!e.isRoot&&!1!==e.filterable&&e.field)return"function"==typeof e.filterable&&(e.filterable={filterFn:e.filterable}),e.filterable}destroyColumnFilterField(e){const t=this.getColumnFilterField(e);t&&(this.hideColumnFilterField(e),t.destroy(),this.setColumnFilterField(e,void 0))}hideColumnFilterField(e,t){const n=this.grid.store,r=e.element,s=this.getColumnFilterField(e);s&&(s.hide(),this.clearStoreFiltersOnHide&&e.field&&n.removeFieldFilter(e.field,t),r.classList.remove(this.filterableColumnCls))}getColumnFilterField(e){return this._columnFilters&&this._columnFilters[e.data.id]}setColumnFilterField(e,t){this._columnFilters=this._columnFilters||{},this._columnFilters[e.data.id]=t}parseFilterValue(e){const t=String(e).match(this.filterParseRegExp);return{operator:t[1]||"*",value:t[2]}}buildFilterString(e){let t;return e&&!e.initialConfig.filterBy&&(t=("*"===e.operator?"":e.operator)+e.value),t}onStoreFilter(){this.storeTrackingSupended||this.updateColumnFilterFields()}suspendStoreTracking(){this.storeTrackingSupended++}resumeStoreTracking(){this.storeTrackingSupended--}renderHeader(e){this.renderFilterBar()}onElementKeyDown(e){if(!e.handled&&e.target.matches(this.filterFieldInputSelector))switch(e.key){case"ArrowLeft":case"ArrowRight":e.handled=!0}}onBeforeElementClick({event:e}){if(e.target.closest("."+this.filterFieldCls))return!1}onColumnFilterFieldChange({source:e,value:t}){const n=this,r=n.grid.store,s=n.getColumnFilterable(e.column);n.suspendStoreTracking(),null==t||""===t?r.removeFieldFilter(e.name):r.filter(s.filterFn?{filterBy:n=>s.filterFn({property:e.name,value:t,record:n}),property:e.name}:Object.assign({property:e.name},n.parseFilterValue(t))),n.resumeStoreTracking()}getHeaderMenuItems(e,t){const n=this;t.push({text:n.L(n.hidden?"enableFilterBar":"disableFilterBar"),name:"toggleFilterBar",icon:"b-fw-icon b-icon-filter",cls:"b-separator",onItem:()=>n.toggleFilterBar()})}}return e.featureClass="b-filter-bar",e._$name="FilterBar",e}()),To.registerFeature(function(){class e extends ur{static get defaultConfig(){return{field:null,renderer:null}}construct(e,t){const n=this;e.features.tree||(n._thisIsAUsedExpression(e.features.groupSummary),t=n.processConfig(t),Object.assign(n,{grid:e,rowManager:e.rowManager,store:e.store}),super.construct(e,t),n.store.on({group:n.onStoreGroup,groupingoff:n.onStoreGroupingOff,thisObj:n}),n.rowManager.on({rendercell:n.renderCell,thisObj:n}))}processConfig(e){return"string"==typeof e?{field:e,ascending:null}:e}setConfig(e){null===e?this.store.clearGroupers():super.setConfig(this.processConfig(e))}set renderer(e){this.groupRenderer=e}set field(e){this._field=e,this.store.group(e,this.ascending)}get field(){return this._field}doDestroy(){super.doDestroy()}static get pluginConfig(){return{assign:["collapseAll","expandAll"],chain:["renderHeader","getHeaderMenuItems","getColumnDragToolbarItems","onElementTouchStart","onElementClick","onElementKeyDown"],override:["onStoreDataChange"]}}toggleCollapse(e,t){this.internalToggleCollapse(e,t)}internalToggleCollapse(e,t,n=!1){const r=this.store,s=r.getById(e),i=s.meta;void 0!==i.groupRowFor&&((t=void 0===t?!i.collapsed:t)?r.excludeGroupRecords(s):r.includeGroupRecords(s),i.collapsed=t,this.grid.trigger("toggleGroup",{groupRecord:s,collapse:t}),n||this.rowManager.renderFromRecord(s))}collapseAll(){const e=this;e.store.isGrouped&&(e.store.groupRecords.forEach(t=>e.internalToggleCollapse(t,!0,!0)),e.grid.refreshRows(!0))}expandAll(){const e=this;e.store.isGrouped&&(e.store.groupRecords.forEach(t=>e.internalToggleCollapse(t,!1,!0)),e.grid.refreshRows())}renderCell(e){if(!this.store.isGrouped)return;let{cellElement:t,rowElement:n,column:r}=e,s=this.grid,i=e.record.meta,o=s.columns.visibleColumns[0],a=s.getSubGridFromColumn(r);i.hasOwnProperty("groupRowFor")?(r.clearCell(t),i.collapsed?n.classList.add("b-grid-group-collapsed"):n.classList.remove("b-grid-group-collapsed"),n.classList.add("b-group-row"),r.region===s.regions[0]&&("rownumber"===o.type&&r===a.columns.visibleColumns[1]||"rownumber"!==o.type&&r===a.columns.visibleColumns[0])&&t.classList.add("b-group-title"),this.buildGroupHeader(e)):t===n.firstElementChild&&(n.classList.remove("b-group-row"),n.classList.remove("b-grid-group-collapsed"),t.classList.remove("b-group-title"))}buildGroupHeader(e){const t=this,{record:n,cellElement:r,rowElement:s,column:i,persist:o}=e,a=t.grid,l=n.meta,c=a.columns.visibleColumns[0],d=i&&a.getSubGridFromColumn(i);let u=null;if(o||i&&"rownumber"===c.type&&i===d.columns.visibleColumns[1]||"rownumber"!==c.type&&i===d.columns.visibleColumns[0]){if(o||i.region===a.regions[0]){const i=a.columns.get(l.groupField);u=i&&i.groupRenderer?i.groupRenderer({cellElement:r,groupRowFor:l.groupRowFor,record:n,rowElement:s,groupColumn:i}):t.groupRenderer?t.groupRenderer(Object.assign({},e,{groupRowFor:l.groupRowFor,groupColumn:i})):`${null==l.groupRowFor?"":l.groupRowFor} (${l.childCount-(a.features.groupSummary?1:0)})`}}else t.groupRenderer&&(u=t.groupRenderer(e));return"string"==typeof u&&(r.innerHTML=u),r.innerHTML}renderHeader(e){let t=this.grid,n=this.store.groupers;for(let r of n){const e=t.columns.get(r.field),n=e&&t.getHeaderElement(e.id);n&&(n.classList.add("b-group"),n.classList.add(r.ascending?"b-asc":"b-desc"))}}getHeaderMenuItems(e,t){const n=this.store;!1!==e.groupable&&t.push({text:this.L("groupAscending"),icon:"b-fw-icon b-icon-group-asc",name:"groupAsc",cls:"b-separator",weight:110,onItem:({item:{column:e}})=>n.group(e.field,!0)},{text:this.L("groupDescending"),icon:"b-fw-icon b-icon-group-desc",name:"groupDesc",weight:110,onItem:({item:{column:e}})=>n.group(e.field,!1)}),n.isGrouped&&t.push({text:this.L("stopGrouping"),icon:"b-fw-icon b-icon-clear",name:"groupRemove",cls:e.groupable?"":"b-separator",weight:110,onItem:({item:{}})=>n.clearGroupers()})}getColumnDragToolbarItems(e,t){const n=this,r=n.store;t.push({text:n.L("groupAscendingShort"),group:n.L("Group"),icon:"b-icon b-icon-group-asc",name:"groupAsc",cls:"b-separator",weight:110,onDrop:({column:e})=>r.group(e.field,!0)}),t.push({text:n.L("groupDescendingShort"),group:n.L("Group"),icon:"b-icon b-icon-group-desc",name:"groupDesc",weight:110,onDrop:({column:e})=>r.group(e.field,!1)});let s=r.groupers&&r.groupers.find(t=>t.field===e.field);return t.push({text:n.L("stopGroupingShort"),group:n.L("Group"),icon:"b-icon b-icon-clear",name:"groupRemove",disabled:!s,weight:110,onDrop:({column:e})=>r.removeGrouper(e.field)}),t}onStoreGroup({groupers:e}){const t=this.grid,n=t.element,r=n&&yt.children(n,".b-grid-header.b-group");if(n){for(let e of r)e.classList.remove("b-group"),e.classList.remove("b-asc"),e.classList.remove("b-desc");for(let n of e){let e=t.getHeaderElementByField(n.field);e&&(e.classList.add("b-group"),e.classList.add(n.ascending?"b-asc":"b-desc"))}}}onStoreGroupingOff(){const e=this.grid,t=yt.children(e.element,".b-grid-header.b-group");for(let n of t)n.classList.remove("b-group"),n.classList.remove("b-asc"),n.classList.remove("b-desc");e.refreshRows()}onElementTouchStart(e){const t=yt.up(e.target,".b-grid-header"),n=t&&this.grid.getColumnFromElement(t);e.touches.length>1&&n&&!1!==n.groupable&&this.store.group(n.field)}onElementClick(e){const t=this,n=t.store,r=e.target,s=yt.up(r,".b-group-row"),i=yt.up(r,".b-grid-header"),o=i&&i.dataset.column;if(!r.classList.contains("b-resizer")){if(i&&o){const r=n.groupers.find(e=>e.field===o);if(r&&!e.shiftKey)return n.group(o,!r.ascending),!1;e.shiftKey&&!1!==t.grid.columns.get(o).groupable&&(e.altKey?n.removeGrouper(o):n.group(o)),e.preventDefault()}return s?(t.internalToggleCollapse(fs.get(s).id),!1):void 0}}onElementKeyDown(e){const t=this;t.store.isGrouped&&e.target===t.client.element&&" "===e.key&&t.grid.focusedCell&&(e.preventDefault(),t.internalToggleCollapse(t.grid.focusedCell.id))}onStoreDataChange(e){const t=e.source;t.isGrouped&&t.count>0||this.overridden.onStoreDataChange(e)}}return e.featureClass="b-group",e._$name="Group",e}(),!0,["Grid","Scheduler"]);var Ro=e=>(class extends(e||W){generateHtml(e,t,n){const r=this.store;let s=`<table class="${n}">`;return(e.summaries||(e.sum?[{sum:e.sum,renderer:e.summaryRenderer}]:[])).forEach(n=>{let i=n.sum,o=null;switch(!0===i&&(i="sum"),i){case"sum":case"add":o=r.sum(e.field,t);break;case"max":o=r.max(e.field,t);break;case"min":o=r.min(e.field,t);break;case"average":case"avg":o=r.average(e.field,t);break;case"count":o=t.length;break;case"countNotEmpty":o=t.reduce((t,n)=>t+(null!=n[e.field]?1:0),0)}if("function"==typeof i&&(o=t.reduce(i,"seed"in n?n.seed:0)),null!==o){const e="b-grid-summary-value",t=n.renderer?n.renderer({config:n,sum:o}):o,r=n.label?`<td class="b-grid-summary-label">${n.label}</td>`:"";let i;i=String(t).includes("<td>")?t:r?`${r}<td class="${e}">${t}</td>`:`<td colspan="2" class="${e}">${t}</td>`,s+=`<tr>${i}</tr>`}}),s+"</table>"}});To.registerFeature(function(){class e extends(Ro(ur)){construct(e,t){const n=this;if(Object.assign(n,{grid:e,store:e.store}),n.store.useGroupFooters=!0,super.construct(e,t),!e.features.group)throw new Error("Requires Group feature to work, please enable");n.store.on({update:n.onStoreUpdate,prio:1,thisObj:n}),n.grid.rowManager.on({beforerenderrow:n.onBeforeRenderRow,rendercell:n.renderCell,thisObj:n})}static get pluginConfig(){return{}}onBeforeRenderRow({row:e,record:t}){e.isGroupFooter&&!t.meta.hasOwnProperty("groupFooterFor")&&(e.isGroupFooter=!1,e.removeCls("b-group-footer"),e.forceInnerHTML=!0)}renderCell({column:e,cellElement:t,rowElement:n,row:r,record:s,size:i}){const o=this;if(o.store.isGrouped&&s.meta.hasOwnProperty("groupFooterFor")){n.classList.add("b-group-footer"),r.isGroupFooter=!0;const a=o.updateSummaryHtml(t,e,s.meta.groupRecord.groupChildren),l="number"==typeof a?a:a.count;l>1&&(i.height=o.grid.rowHeight+l*o.grid.rowHeight*.1),a.height&&(i.height+=a.height)}}updateSummaryHtml(e,t,n){(n=n.slice()).pop();const r=this.generateHtml(t,n,"b-grid-group-summary");return e.children.length?yt.sync(r,e.firstElementChild):e.innerHTML=r,t.summaries?t.summaries.length:t.sum?1:0}onStoreUpdate({source:e,changes:t}){t&&e.groupers.find(e=>e.field in t)||Object.keys(t).some(e=>{const t=this.grid.columns.get(e);return Boolean(t)&&(Boolean(t.sum)||Boolean(t.summaries))})&&(this.grid.forceFullRefresh=!0)}}return e.featureClass="b-group-summary",e._$name="GroupSummary",e}()),To.registerFeature(function(){class e extends ur{static get defaultConfig(){return{mode:"header",find:""}}static get pluginConfig(){return{chain:["onElementKeyDown","onElementKeyPress","onCellNavigate"]}}construct(e,t){this.grid=e,this.store=e.store,super.construct(e,t)}showQuickFind(){const e=this,t=e.grid.getHeaderElement(e.columnId);if(t){if(!e.headerField){const[n,r,s]=yt.createElement({tag:"div",className:"b-quick-hit-header",children:[{tag:"div",className:"b-quick-hit-field"},{tag:"div",className:"b-quick-hit-badge"}]},!0);"header"===e.mode?t.appendChild(n):(n.className+=" b-quick-hit-mode-grid",e.grid.element.appendChild(n)),e.headerField={header:n,field:r,badge:s,colHeader:t}}e.headerField.field.innerHTML=e.find,e.headerField.badge.innerHTML=e.found.length,t.classList.add("b-quick-find-header"),e.renderListenerInitialized||(e.grid.rowManager.on({rendercell:e.renderCell,thisObj:e}),e.renderListenerInitialized=!0)}}hideQuickFind(){const e=this;for(let t of e.prevFound||e.found){let n=e.grid.getRowById(t.id);n&&n.renderCell(n.getCell(e.columnId),t.data)}e.headerField&&(e.headerField.header.parentNode.removeChild(e.headerField.header),e.headerField.colHeader.classList.remove("b-quick-find-header"),e.headerField=null),e.renderListenerInitialized&&(e.grid.rowManager.un({rendercell:e.renderCell},e),e.renderListenerInitialized=!1),e.grid.trigger("hideQuickFind")}search(e,t=this.columnId){let n=this,r=n.grid.columns.getById(t)||n.grid.columns.get(t),s=n.store.findByField(r.field,e),i=1,o=n.grid;Object.assign(n,{foundMap:{},prevFound:n.found,found:s,find:e,columnId:r.id}),e?n.showQuickFind():n.hideQuickFind(),n.currentColumn&&n.currentColumn!==r&&(n.currentColumn.disableHtmlEncode=!1);for(let a of yt.children(o.element,".b-quick-hit"))a.classList.remove("b-quick-hit"),a.classList.remove("b-quick-hit-cell"),fs.get(a).row.renderCell(a);if(r.disableHtmlEncode=!0,n.currentColumn=r,s){s.length>0&&n.gotoClosestHit(o.focusedCell,s);for(let e of s){n.foundMap[e.id]=i++;let t=o.getRowById(e.data.id);if(t&&t.renderCell(t.getCell(r.id)),i>1e3)break}n.grid.trigger("quickFind",{find:e,found:s})}}clear(){this.found&&this.found.length&&this.search("")}get foundCount(){return this.found?this.found.length:0}gotoHit(e){let t=this.found[e];return t&&this.grid.focusCell({columnId:this.columnId,id:t.id}),!!t}gotoClosestHit(e,t){let n=e?this.grid.store.indexOf(e.id):0,r=t.slice().sort((e,t)=>Math.abs(e.index-n)-Math.abs(t.index-n));this.gotoHit(t.indexOf(r[0]))}gotoFirstHit(){this.gotoHit(0)}gotoLastHit(){this.gotoHit(this.found.length-1)}gotoNextHit(){let e=this.grid,t=e.store.indexOf(e._focusedCell?e._focusedCell.id:e.lastFocusedCell.id)||0,n=this.found.find(e=>e.index>t);n?e.focusCell({columnId:this.columnId,id:n.id}):this.gotoFirstHit()}gotoPrevHit(){let e,t=this,n=t.grid,r=n.store.indexOf(n._focusedCell?n._focusedCell.id:n.lastFocusedCell.id)||0,s=t.found;if(s.length){for(let t=s.length-1;t--;t>=0)if(s[t].index<r){e=s[t];break}e?n.focusCell({columnId:t.columnId,id:e.id}):t.gotoLastHit()}}renderCell(e){let t=this,n=e.cellElement,r=t.foundMap&&t.columnId===e.column.id&&t.foundMap[e.record.id];if(r){const s=e.column.htmlEncode||e.column.shouldHtmlEncode;if(n.classList.add("b-quick-hit"),s){let e=yt.down(n,".b-grid-cell-value,.b-tree-cell-value")||n,s=e.innerText,i=s&&s.toLowerCase().indexOf(t.find.toLowerCase());if(i>-1){let n=i+t.find.length,o=s.slice(i,n),a="";" "===s[i-1]&&(a="&nbsp;"),s=s.slice(0,i)+`<span class="b-quick-hit-text">${a}${o}</span>`+s.slice(n),e.innerHTML=s+`<div class="b-quick-hit-cell-badge">${r}</div>`}else n.classList.add("b-quick-hit-cell")}else n.classList.add("b-quick-hit-cell")}}onElementKeyDown(e){const t=this,n=this.grid.features.filter;yt.up(e.target,G.isIE11?".b-widget:not(.b-grid-subgrid):not(.b-grid)":".b-widget:not(.b-grid)")||t.find.length>0&&("Backspace"===e.key?(e.preventDefault(),t.find=t.find.substr(0,t.find.length-1),t.search(t.find)):"Escape"===e.key?(e.preventDefault(),t.find="",t.search(t.find)):"F3"===e.key||"g"===e.key.toLowerCase()&&(e.ctrlKey||e.metaKey)?(e.preventDefault(),e.shiftKey?t.gotoPrevHit():t.gotoNextHit()):n&&t.columnId&&t.foundCount&&e.ctrlKey&&e.shiftKey&&"F"===e.key&&n.showFilterEditor(t.grid.columns.getById(t.columnId),t.find))}onElementKeyPress(e){const t=this;if(!yt.up(e.target,G.isIE11?".b-widget:not(.b-grid-subgrid):not(.b-grid)":".b-widget:not(.b-grid)")&&"Enter"!==e.key&&t.grid._focusedCell){const n=t.grid.columns.getById(t.grid._focusedCell.columnId);n&&!1!==n.searchable&&(t.columnId=t.grid._focusedCell.columnId,e.key&&1===e.key.length&&(t.find+=e.key,t.search(t.find)))}}onCellNavigate(e,t,n,r){!this.prevFound&&!this.found||n&&n.columnId===this.columnId||this.clear()}}return e.featureClass="b-quick-find",e._$name="QuickFind",e}()),To.registerFeature(function(){class e extends ur{construct(e,t){this.grid=e,super.construct(e,t)}doDestroy(){super.doDestroy()}static get pluginConfig(){return{chain:["onElementTouchStart","onElementTouchMove","onElementTouchEnd","onElementMouseDown","onElementMouseMove","onElementDblClick","onElementMouseUp","onSubGridCollapse","onSubGridExpand","render"]}}onElementDblClick(e){const t=this,n=t.grid,r=yt.up(e.target,".b-grid-splitter-collapsed");if(r&&!t.expanding){t.expanding=!0;let e=r.dataset.region,s=n.getSubGrid(e);s.collapsed||(e=n.getLastRegions()[1],s=n.getSubGrid(e)),s.expand().then(()=>t.expanding=!1)}}startMove(e,t){let{grid:n}=this,r=e.dataset.region,s=n.element,i=n.getSubGrid(r),o=n.regions[n.regions.indexOf(r)+1],a=n.getSubGrid(o),l=1;if(null!=i.flex&&null==a.flex&&(i=a,l=-1),e.classList.contains("b-grid-splitter-collapsed"))return;const c=i.element.offsetWidth+a.element.offsetWidth;this.dragContext={element:e,headerEl:i.header.element,subGridEl:i.element,subGrid:i,originalWidth:i.element.offsetWidth,originalX:t,minWidth:i.minWidth||0,maxWidth:Math.min(c,i.maxWidth||c),flip:l},s.classList.add("b-moving-splitter"),e.classList.add("b-moving")}onCollapseClick(e,t){const n=this.grid,r=t.dataset.region,s=n.getLastRegions();if(s[0]===r){const e=n.getSubGrid(s[1]);if(e.collapsed)return void e.expand()}e.collapse()}onExpandClick(e,t){const n=this.grid,r=t.dataset.region,s=n.getLastRegions();s[0]!==r||e.collapsed?e.expand():n.getSubGrid(s[1]).collapse()}updateMove(e){const{dragContext:t}=this;if(t){const n=Math.min(t.maxWidth,t.originalWidth+(e-t.originalX)*t.flip);t.subGrid.width=Math.max(n,t.minWidth)}}endMove(){const e=this.dragContext;e&&(this.grid.element.classList.remove("b-moving-splitter"),e.element.classList.remove("b-moving"),this.dragContext=null)}onElementTouchStart(e){const t=e.target;t.classList.contains("b-grid-splitter")&&(this.startMove(t,e.touches[0].clientX),e.preventDefault())}onElementTouchMove(e){this.dragContext&&(this.updateMove(e.touches[0].clientX),e.preventDefault())}onElementTouchEnd(e){this.dragContext&&(this.endMove(),e.preventDefault())}onElementMouseDown(e){const t=e.target,n=e.target.closest(":not(.b-row-reordering):not(.b-dragging-event):not(.b-dragging-task):not(.b-dragging-header):not(.b-dragselecting) .b-grid-splitter"),r=n&&this.grid.getSubGrid(n.dataset.region);0===e.button&&(t.classList.contains("b-grid-splitter")||t.classList.contains("b-grid-splitter-inner")?(this.startMove(n,e.clientX),e.preventDefault()):t.classList.contains("b-icon-collapse-gridregion")?this.onCollapseClick(r,n):t.classList.contains("b-icon-expand-gridregion")&&this.onExpandClick(r,n))}onElementMouseMove(e){this.dragContext&&(this.updateMove(e.clientX),e.preventDefault())}onElementMouseUp(e){this.dragContext&&(this.endMove(),e.preventDefault())}onSubGridCollapse(e){const t=this.grid.resolveSplitter(e);this.grid.getLastRegions()[1]===e.region&&t.classList.add("b-grid-splitter-allow-collapse")}onSubGridExpand(e){this.grid.resolveSplitter(e).classList.remove("b-grid-splitter-allow-collapse")}render(){const{regions:e,subGrids:t}=this.grid;e.length>2&&(t[e[0]].splitterElement.classList.add("b-left-only"),t[e[1]].splitterElement.classList.add("b-right-only"))}}return e.featureClass="b-split",e._$name="RegionResize",e}());const ko=function(){class e extends(U(ur)){static get defaultConfig(){return{hoverExpandTimeout:1e3}}construct(e,t){this.grid=e,super.construct(...arguments)}doDestroy(){this.dragHelper&&this.dragHelper.destroy(),super.doDestroy()}init(){const e=this,{grid:t}=e;e.dragHelper=new Ii({name:"rowReorder",mode:"translateXY",cloneTarget:!0,dragThreshold:10,targetSelector:".b-grid-row",lockX:!0,scrollManager:t.scrollManager,dragWithin:t.verticalScroller,outerElement:t.verticalScroller,ignoreSamePositionDrop:!1,createProxy(e){const t=e.cloneNode(!0),n=document.createElement("div");return t.removeAttribute("id"),t.style.transform="",n.appendChild(t),n},listeners:{beforedragstart:e.onBeforeDragStart,dragstart:e.onDragStart,drag:e.onDrag,drop:e.onDrop,reset:e.onReset,thisObj:e}}),e.dropIndicator=yt.createElement({parent:t.bodyContainer,className:"b-row-drop-indicator"}),e.relayEvents(e.dragHelper,["beforeDragStart","dragStart","drag","drop","abort"],"gridRow")}static get pluginConfig(){return{after:["render"]}}onBeforeDragStart({context:e}){const t=this.grid;return!(this.disabled||t.readOnly||yt.isTouchEvent||!t.subGrids[t.regions[0]].element.contains(e.element)||this.grid.getRecordFromElement(e.element).meta.specialRow)}onDragStart({context:e}){const t=this,n=t.grid.getRecordFromElement(e.grabbed);if(!n)throw new Error("Failed to find record for dragged element");t.grid.features.cellEdit&&(t.grid.readOnly=!0,t.grid.features.cellEdit.cancelEditing(!0)),t.grid.features.contextMenu&&t.grid.features.contextMenu.hideContextMenu(!1),t.grid.element.classList.add("b-row-reordering");const r=e.element.querySelector(".b-focused");r&&r.classList.remove("b-focused"),yt.removeClasses(e.element.firstElementChild,["b-selected","b-hover"]),t.record=n}onDrag({context:e,event:t}){const n=this,{store:r,rowManager:s}=n.grid;if(!n.dragHelper.outerElement.contains(t.target)||!t.target.closest(".b-grid-subgrid"))return void(e.valid=!1);let i,o,a,l,c=e.valid,d=n.grid.rowManager.getRowAt(t.clientY);if(d){const e=d.top+n.grid._bodyRectangle.y+d.height/2;o=d.dataIndex,i=d&&r.getAt(o),a=t.clientY>e}else i=r.last,d=n.grid.rowManager.getRow(o=r.count-1),a=!0;if(i===n.record&&(c=!1),r.tree){if(yt.removeClsGlobally(n.grid.element,"b-row-reordering-target-parent"),l=a?i.nextSibling:i,n.record.contains(i)&&(c=!1),e.parent=i.parent,!e.parent.isRoot){const t=s.getRowById(e.parent);t&&t.addCls("b-row-reordering-target-parent")}n.clearTimeout(n.hoverTimer),i&&i.isParent&&!i.isExpanded(r)&&(n.hoverTimer=n.setTimeout(()=>n.grid.expand(i),n.hoverExpandTimeout))}else l=a?r.getAt(o+1):i;yt.setTranslateY(n.dropIndicator,d.top+(a?d.height:0)),e.insertBefore=l,e.valid=c}onDrop({context:e}){const t=this,n=t.grid,r=n.store;e.asyncCleanup=e.async=!0,e.element.classList.add("b-dropping"),t.setTimeout(()=>{n.element.classList.remove("b-row-reordering"),e.valid&&(r.tree?e.parent.insertChild(t.record,e.insertBefore):r.insert(e.insertBefore?r.indexOf(e.insertBefore):r.count,t.record),r.clearSorters(),e.finalize())},300)}onReset(){this.grid.element.classList.remove("b-row-reordering"),this.grid.readOnly=!1,yt.removeClsGlobally(this.grid.element,"b-row-reordering-target-parent")}render(){this.init()}}return e.featureClass="",e._$name="RowReorder",e}();To.registerFeature(ko,!1),To.registerFeature(ko,!0,"Gantt"),To.registerFeature(function(){class e extends ur{construct(e,t){super.construct(e,t),Object.assign(this,{store:e.store,grid:e,find:"",hitEls:[]})}doDestroy(){this.clear(!0),super.doDestroy()}static get pluginConfig(){return{chain:["getCellMenuItems","onElementKeyDown"]}}search(e,t=!0,n=!1){if(!e)return this.clear();if(!n&&e===this.find)return;const r=this,s=r.grid,i=s.columns.visibleColumns.filter(e=>!1!==e.searchable).map(e=>e.field),o=r.store.search(e,i);let a=1;Object.assign(r,{foundMap:{},prevFound:r.found,found:o,find:e});for(let l of yt.children(s.element,".b-search-hit"))l.classList.remove("b-search-hit"),l.classList.remove("b-search-hit-cell"),fs.get(l).row.renderCell(l);if(o){r.hitColumns&&r.hitColumns.forEach(e=>e.disableHtmlEncode=!1),r.hitColumns=[];for(let e of o){r.foundMap[e.field+"-"+e.id]=a++;const t=r.grid.columns.get(e.field);if(t&&(t.disableHtmlEncode=!0,r.hitColumns.push(t)),a>1e3)break}return r.listenersInitialized||(r.grid.rowManager.on({rendercell:r.renderCell},r),r.store.on({refresh:r.onStoreRefresh},r),r.listenersInitialized=!0),s.refreshRows(),r.grid.trigger("search",{grid:s,find:e,found:o}),t&&!r.isHitFocused&&r.gotoNextHit(!0),o}}clear(e=!1){const t=this,n=t.grid;t.foundMap&&(delete t.foundMap,delete t.find),yt.forEachSelector(n.element,".b-search-hit",e=>{e.classList.remove("b-search-hit"),e.classList.remove("b-search-hit-cell")}),yt.removeEachSelector(n.element,".b-search-hit-cell-badge,.b-search-hit-text"),t.listenersInitialized&&(n.rowManager.un({rendercell:t.renderCell},t),t.store.un({refresh:t.onStoreRefresh},t),t.listenersInitialized=!1),e||(n.refreshRows(),t.grid.trigger("clearSearch",{grid:n}))}get foundCount(){return this.found&&this.found.length||0}get isHitFocused(){let e=this.grid,t=e.focusedCell?e.store.indexOf(e.focusedCell.id):-1,n=e.focusedCell?e.columns.getById(e.focusedCell.columnId):null;return-1!==t&&this.found.some(e=>e.index===t&&n&&e.field===n.field)}gotoNextHit(e=!1){const t=this;if(!t.found||!t.found.length)return;const n=t.grid,r=n.focusedCell||n.lastFocusedCell,s=r&&!e?n.store.indexOf(r.id):-1,i=t.found.findIndex(e=>e.index>s);-1!==i&&t.gotoHit(i)}gotoPrevHit(){const e=this;if(!e.found||!e.found.length)return;const t=e.grid,n=t.focusedCell||t.lastFocusedCell,r=n?t.store.indexOf(n.id):0,s=e.found;for(let i=s.length-1;i--;i>=0)if(s[i].index<r){e.gotoHit(i);break}}gotoHit(e){let t=this.found[e];return t&&this.grid.focusCell({field:t.field,id:t.id}),!!t}gotoFirstHit(){this.gotoHit(0)}gotoLastHit(){this.gotoHit(this.found.length-1)}renderCell({cellElement:e,column:t,record:n,value:r,cellContent:s}){const i=this,o=i.foundMap&&i.foundMap[t.field+"-"+n.id];if(o){e.classList.add("b-search-hit");const t=yt.down(e,".b-grid-cell-value")||e,n=String(i.find).toLowerCase();if(String(r).toLowerCase()===n)t.innerHTML=`<span class="b-search-hit-text">${s}</span><div class="b-search-hit-cell-badge">${o}</div>`;else{const n=String(i.find).toLowerCase(),r=s&&s.toLowerCase().indexOf(n);if(r>-1){let e=r+n.length,i=s.slice(r,e);t.innerHTML=`${s.slice(0,r)}<span class="b-search-hit-text">${i}</span>${s.slice(e)}<div class="b-search-hit-cell-badge">${o}</div>`}else e.classList.add("b-search-hit-cell")}i.hitEls.push(e)}}getCellMenuItems(e,t,n){const r=this;return e.searchable&&n.push({text:r.L("searchForValue"),icon:"b-fw-icon b-icon-search",cls:"b-separator",name:"search",onItem:({item:e})=>{const{column:t,record:n}=e;let s=window.getSelection().toString();s||(s=n[t.field]),r.search(s)}}),n}onElementKeyDown(e){this.find&&""!==this.find&&("F3"===e.key||"g"===e.key.toLowerCase()&&(e.ctrlKey||e.metaKey))&&(e.preventDefault(),e.shiftKey?this.gotoPrevHit():this.gotoNextHit())}onStoreRefresh(){this.search(this.find,!1,!0)}}return e.featureClass="b-search",e._$name="Search",e}()),To.registerFeature(function(){class e extends ur{static get defaultConfig(){return{multiSort:!0,ignoreRe:new RegExp(["b-grid-header-resize-handle","b-filter-icon"].join("|")),sortableCls:"b-sortable",sortedCls:"b-sort",sortedAscCls:"b-asc",sortedDescCls:"b-desc"}}construct(e,t){const n=this;t=n.processConfig(t),n.store=e.store,n.grid=e,n.store.on({sort:n.syncHeaderSortState,thisObj:n}),super.construct(e,t)}processConfig(e){return"string"==typeof e||Array.isArray(e)?{field:e,ascending:null}:e}setConfig(e){super.setConfig(this.processConfig(e))}set field(e){const t=this.grid.columns.get(e);t&&"object"==typeof t.sortable&&(t.sortable.field=t.sortable.property||e,e=t.sortable),this.store.sort(e,this.ascending)}doDestroy(){super.doDestroy()}static get pluginConfig(){return{chain:["onElementClick","getHeaderMenuItems","getColumnDragToolbarItems","renderHeader"]}}syncHeaderSortState(){const e=this,t={};if(!e.grid.isConfiguring){let n,r=e.store.sorters,s=r.length,i=new Ai;for(let e=0;e<s;e++){const n=r[e];n.field&&(t[n.field]={ascending:n.ascending,sortIndex:e+1})}for(const o of e.grid.columns.bottomColumns){const r=o.element;if(r){const a=o.textWrapper&&o.textWrapper.dataset;a&&a.sortIndex&&delete a.sortIndex,i.value=r.classList,!1!==o.sortable?(i.add(e.sortableCls),(n=t[o.field])?(s>1&&a&&(a.sortIndex=n.sortIndex),i.add(e.sortedCls),n.ascending?(i.add(e.sortedAscCls),i.remove(e.sortedDescCls)):(i.add(e.sortedDescCls),i.remove(e.sortedAscCls))):(i.remove(e.sortedCls),i["b-group"]||(i.remove(e.sortedAscCls),i.remove(e.sortedDescCls)))):i.remove(e.sortableCls),yt.syncClassList(r,i)}}}}getHeaderMenuItems(e,t){const n=this;if(!1!==e.sortable&&(t.push({text:n.L("sortAscending"),icon:"b-fw-icon b-icon-sort-asc",name:"sortAsc",cls:"b-separator",weight:105,onItem:({item:{column:e}})=>n.store.sort(e.field,!0)}),t.push({text:n.L("sortDescending"),icon:"b-fw-icon b-icon-sort-desc",name:"sortDesc",weight:105,onItem:({item:{column:e}})=>n.store.sort(e.field,!1)}),n.multiSort&&n.grid.columns.records.filter(e=>e.sortable).length>1)){const r=this.grid.store.sorters.find(t=>t.field===e.field);t.push({text:n.L("multiSort"),icon:"b-fw-icon b-icon-sort",name:"multiSort",weight:105,menu:[{text:n.L(r?"toggleSortAscending":"addSortAscending"),icon:"b-fw-icon b-icon-sort-asc",name:"addSortAsc",disabled:r&&r.ascending,weight:105,onItem:({item:{column:e}})=>n.store.addSorter(e.field,!0)},{text:n.L(r?"toggleSortDescending":"addSortDescending"),icon:"b-fw-icon b-icon-sort-desc",name:"addSortDesc",disabled:r&&!r.ascending,weight:105,onItem:({item:{column:e}})=>n.store.addSorter(e.field,!1)},{text:n.L("removeSorter"),icon:"b-fw-icon b-icon-remove",name:"remove-sorter",weight:105,disabled:!r,onItem:({item:{column:e}})=>n.store.removeSorter(e.field)}]})}return t}getColumnDragToolbarItems(e,t){const n=this,r=n.store;if(!1!==e.sortable){t.push({text:n.L("sortAscendingShort"),group:n.L("Sort"),icon:"b-icon b-icon-sort-asc",name:"sortAsc",cls:"b-separator",weight:105,onDrop:({column:e})=>r.sort(e.field,!0)}),t.push({text:n.L("sortDescendingShort"),group:n.L("Sort"),icon:"b-icon b-icon-sort-desc",name:"sortDesc",weight:105,onDrop:({column:e})=>r.sort(e.field,!1)});const s=r.sorters.find(t=>t.field===e.field);Array.prototype.push.apply(t,[{text:n.L("addSortAscendingShort"),group:n.L("Multisort"),icon:"b-icon b-icon-sort-asc",name:"multisortAddAsc",disabled:s&&s.ascending,weight:105,onDrop:({column:e})=>r.addSorter(e.field,!0)},{text:n.L("addSortDescendingShort"),group:n.L("Multisort"),icon:"b-icon b-icon-sort-desc",name:"multisortAddDesc",disabled:s&&!s.ascending,weight:105,onDrop:({column:e})=>r.addSorter(e.field,!1)},{text:n.L("removeSorterShort"),group:n.L("Multisort"),icon:"b-icon b-icon-remove",name:"multisortRemove",weight:105,disabled:!s,onDrop:({column:e})=>r.removeSorter(e.field)}])}return t}onElementClick(e){const t=this,n=t.store,r=e.target,s=yt.up(r,".b-grid-header.b-sortable"),i=s&&s.dataset.column;if(!t.ignoreRe.test(r.className)&&s&&i){const r=t.grid.columns.getById(s.dataset.columnId);if(n.groupers.find(e=>e.field===i)&&!e.shiftKey)return;if(r.sortable&&!e.shiftKey)if(e.metaKey&&e.altKey)n.removeSorter(r.field);else{let t=r.field;"function"==typeof r.sortable?t={field:r.field,fn:r.sortable}:"object"==typeof r.sortable&&((t=r.sortable).field||(t.field=t.property||r.field)),n.sort(t,null,e.metaKey)}}}renderHeader(){this.syncHeaderSortState()}}return e.featureClass="b-sort",e._$name="Sort",e}(),!0),To.registerFeature(function(){class e extends ur{construct(e,t){this.grid=e,super.construct(e,t),e.rowManager.on({renderrow:this.onRenderRow,thisObj:this})}onRenderRow({row:e}){e.addCls(e.dataIndex%2==0?"b-even":"b-odd")}}return e._$name="Stripe",e}());const Mo=function(){class e extends An{static get defaultConfig(){return{scrollable:{}}}construct(e){let t=e.subGrid;t&&(e.grid=t.grid,e.columns=t.columns,t.width?e.width=t.width:t.flex&&(e.flex=t.flex)),super.construct(e)}get columns(){return this._columns}set columns(e){this._columns=e}fixCellWidths(){const e=this;let t,n=!1;e.columns.traverse(r=>{const s=e.getBarCellElement(r.id),i=yt.setLength(r.width),o=yt.setLength(r.minWidth);if(s){if(t=G.isIE11?`calc(${i} - ${e.getLrPadding(s)}px)`:i,n=n||Boolean(r.flex),r.isParent&&null==r.width&&null==r.flex){const e=r.children.reduce((e,t)=>e+=!t.hidden&&t.flex||0,0);s.style.flex=e>0?`${e} 0 auto`:"",e>0&&r.traverse(e=>e.data.minWidth=null)}else if(parseInt(r.minWidth)>=0&&(s.style.minWidth=o),s.style.flex=s.style.flexBasis=s.style.width="",r.flex)s.style.flex=!isNaN(parseInt(r.flex))&&r.children?`${r.flex} 0 auto`:r.flex;else if(parseInt(r.width)>=0){const n=r.parent;!e.isHeader||n.isRoot||n.width?s.style.flexBasis=t:s.style.width=i}r.height>=0&&(s.style.height=yt.setLength(r.height))}}),e.element.classList[n?"add":"remove"]("b-has-flex")}getLrPadding(e){if(!this.cellLrPadding){const t=e.ownerDocument.defaultView.getComputedStyle(e);this.cellLrPadding=parseInt(t.getPropertyValue("padding-left"))+parseInt(t.getPropertyValue("padding-right"))+parseInt(t.getPropertyValue("border-left-width"))+parseInt(t.getPropertyValue("border-right-width"))}return this.cellLrPadding}getBarCellElement(e){return this.element.querySelector(`[data-column-id="${e}"]`)}}return e._$name="Bar",e}(),Io=function(){class e extends Mo{static get defaultConfig(){return{isFooter:!0}}startConfigure(e){e.scrollable.overflowX="hidden-scroll",super.startConfigure(e)}get subGrid(){return this._subGrid}set subGrid(e){this._subGrid=this.owner=e}refreshContent(){this.element.firstElementChild.innerHTML=this.contentTemplate(),this.fixFooterWidths()}render(e){super.render(e),this.refreshContent()}template(){const e=this.subGrid.region;return Gn.tpl`
            <div class="b-grid-footer-scroller b-grid-footer-scroller-${e}">
                <div reference="footersElement" class="b-grid-footers b-grid-footers-${e}" data-region="${e}"></div>
            </div>
        `}get overflowElement(){return this.footersElement}getFooter(e){return this.getBarCellElement(e)}contentTemplate(){return this.columns.visibleColumns.map(e=>e.hidden?"":Gn.tpl`
                <div 
                    class="b-grid-footer ${e.align?`b-grid-footer-align-${e.align}`:""} ${e.cls||""}" 
                    data-column="${e.field}" data-column-id="${e.id}" data-all-index="${e.allIndex}"
                    >
                    ${e.footerText||""}
                </div>`).join("")}fixFooterWidths(){this.fixCellWidths()}}return e._$name="Footer",e}();To.registerFeature(function(){class e extends(Ro(ur)){construct(e,t){const n=this;Object.assign(n,{grid:e,store:e.store}),super.construct(e,t),n.store.on({change:n.onStoreChanged,thisObj:n}),n.grid.eachSubGrid(e=>{e.footer||(e.footer=new Io({subGrid:e,parent:e}))})}doDestroy(){super.doDestroy()}static get pluginConfig(){return{chain:["renderRows"]}}renderRows(){this.updateSummaries()}updateSummaries(){const e=this,t=yt.children(e.grid.element,".b-grid-footer"),n=e.store.storage.values.filter(e=>!e.meta.specialRow);e.grid.columns.forEach(e=>{e.summaries&&e.summaries.forEach(e=>{"seed"in e&&("initialSeed"in e||(e.initialSeed=e.seed),e.seed=["number","string","date"].includes(typeof e.initialSeed)?e.initialSeed:Object.assign({},e.initialSeed))})}),t.forEach(t=>{const r=e.grid.columns.get(t.dataset.column),s=e.generateHtml(r,n,"b-grid-footer-summary");(r.summaries?r.summaries.length:r.sum)&&(t.children.length?yt.sync(s,t.firstElementChild):t.innerHTML=s)})}onStoreChanged({action:e,changes:t}){let n=!0;"update"===e&&(n=Object.keys(t).some(e=>{const t=this.grid.columns.get(e);return Boolean(t)&&(Boolean(t.sum)||Boolean(t.summaries))})),n&&this.updateSummaries()}}return e.featureClass="b-summary",e._$name="Summary",e}());const Ao=new Promise(e=>e()),Fo=function(){class e extends(U(ur)){static get defaultConfig(){return{expandOnCellClick:!1}}static get pluginConfig(){return{assign:["collapseAll","expandAll","collapse","expand","expandTo","toggleCollapse"],before:["navigateRight","navigateLeft"],chain:["onElementClick","onElementKeyDown"]}}construct(e,t){super.construct(e,t);const n=e.columns.find(e=>e instanceof wo);Object.assign(this,{grid:e,store:e.store,rowManager:e.rowManager,treeColumn:n})}doDestroy(){super.doDestroy()}async toggleCollapse(e,t,n=!1){const r=this,{store:s,grid:i}=r,o=i.rowManager,a=s.getById(e),l=a.instanceMeta(s);if(l.isLoadingChildren||a.isLeaf)return;let c=!0,d=o.getRowFor(a);if(void 0===t&&(t=!l.collapsed),Boolean(l.collapsed)!==t){if(i.trigger("beforeToggleNode",{source:i,record:a,collapse:t}),l.collapsed=t,l.collapsed)s.onNodeCollapse(a);else if(s.onNodeExpand(a),!a.isLoaded){l.isLoadingChildren=!0,d&&d.addCls("b-loading-children");try{await s.loadChildren(a),d=o.getRowFor(a)}catch(u){c=!1,l.collapsed=!0}finally{d&&d.removeCls("b-loading-children"),l.isLoadingChildren=!1}}if(c){if(d){const e=d.getCell(r.treeColumn.id);d.renderCell(e,a)}r.isTogglingNode||(i.element.classList.add("b-toggling-node"),r.isTogglingNode=!0,r.requestAnimationFrame(()=>{i.element.classList.remove("b-toggling-node"),r.isTogglingNode=!1})),i.trigger(l.collapsed?"collapseNode":"expandNode",{source:i,record:a}),i.trigger("toggleNode",{source:i,record:a,collapse:t})}}}async collapse(e){return this.toggleCollapse(e,!0)}async expand(e){return this.toggleCollapse(e,!1)}expandOrCollapseAll(e=!0,t=this.store.rootNode){const{grid:n,store:r}=this,s=[];return n.trigger("beforeToggleAllNodes",{source:n,collapse:e}),r.suspendEvents(),t.traverse(t=>{const n=t.instanceMeta(r);t.isLeaf||(e&&!n.collapsed?this.toggleCollapse(t,!0,!0):!e&&n.collapsed&&s.push(this.toggleCollapse(t,!1,!0)))},t===r.rootNode),r.resumeEvents(),n.refreshRows(!0),n.trigger("toggleAllNodes",{source:n,collapse:e}),e?Ao:Promise.all(s)}async collapseAll(){return this.expandOrCollapseAll(!0)}async expandAll(){return this.expandOrCollapseAll(!1)}async expandTo(e){const t=this,n=t.store.getById(e);if(!1===n.instanceMeta(t.store).hiddenByCollapse)return;let r=!1,s=n.parent,i=[];for(;s&&!s.isRoot;)i.push(s),s=s.parent;await i.reverse().forEach(async e=>{e.instanceMeta(t.store).collapsed&&(r=!0),await t.toggleCollapse(e,!1,!0)}),r&&t.grid.refreshRows(),await t.grid.scrollRowIntoView(n)}onElementClick(e){const t=e.target,n=this.grid.getEventData(e);(t.classList.contains("b-tree-expander")||this.expandOnCellClick&&n&&n.record.isParent)&&this.toggleCollapse(n.record)}onElementKeyDown(e){e.target===this.client.element&&" "===e.key&&(e.preventDefault(),this.toggleCollapse(this.grid.focusedCell.id))}navigateRight(e){const t=this,n=t.grid,r=n.focusedCell;if(r){const s=n.store.getById(r.id);if(n.columns.getById(r.columnId).tree&&(e.shiftKey||1===n.columns.count))return s.isParent&&s.instanceMeta(n.store).collapsed?t.expand(s):n.navigateDown(e),!1}}navigateLeft(e){const t=this,n=t.grid,r=n.focusedCell;if(r){const s=n.store.getById(r.id);if(n.columns.getById(r.columnId).tree&&(e.shiftKey||1===n.columns.count))return s.isParent&&!s.instanceMeta(n.store).collapsed?t.collapse(s):s.parent&&n.focusCell({id:s.parent.id,columnId:r.columnId}),!1}}}return e.featureClass="b-tree",e._$name="Tree",e}();To.registerFeature(Fo,!1,"Grid"),To.registerFeature(Fo,!0,"TreeGrid");const Oo=function(){class e extends(U(W)){static get defaultConfig(){return{zoneWidth:50,scrollSpeed:5,verticalElement:null,direction:"both",monitoring:[]}}startMonitoring(e){const t=this,n=e instanceof HTMLElement?{element:e}:e,r=n.element,s=n.verticalElement||t.verticalElement||r;if(r&&(r.scrollWidth>r.offsetWidth||s.scrollHeight>s.offsetHeight)){if(t.monitoring.find(e=>e.element===r))return;n.direction=n.direction||t.direction,Object.assign(n,{verticalElement:s,scrollManager:t,startScrollLeft:r.scrollLeft,startScrollTop:s.scrollTop,scrollLeft:r.scrollLeft,scrollTop:s.scrollTop,scrollRelativeLeft:0,scrollRelativeTop:0});const e=t.onMouseMove.bind(n);t.mouseMoveDetacher=Kt.on({mousemove:e,touchmove:e,element:r}),n.scrollWidth=r.scrollWidth,t.monitoring.push(n)}}stopMonitoring(e){const t=this,n=t.monitoring.find(t=>t.element===e);n&&(t.stopScroll(n),t.mouseMoveDetacher&&t.mouseMoveDetacher(),t.monitoring.splice(t.monitoring.indexOf(n),1))}startScroll(e){e.scrolling=!0,this.performScroll(e)}stopScroll(e){e.scrolling=!1,e.scrollRequested&&(this.cancelAnimationFrame(e.frameId),e.scrollRequested=!1)}performScroll(e){if(e.scrolling&&!e.scrollRequested){let t=e.element,n=e.verticalElement;0!==e.scrollDeltaX&&(e.scrollLeft+=e.scrollDeltaX,e.scrollLeft=Math.max(Math.min(e.scrollLeft,e.scrollWidth-t.offsetWidth),0),e.scrollRelativeLeft=e.scrollLeft-e.startScrollLeft,t.scrollLeft=e.scrollLeft),0!==e.scrollDeltaY&&(e.scrollTop+=e.scrollDeltaY,e.scrollTop=Math.max(Math.min(e.scrollTop,n.scrollHeight-n.offsetHeight),0),e.scrollRelativeTop=e.scrollTop-e.startScrollTop,n.scrollTop=e.scrollTop),0===e.scrollRelativeLeft&&0===e.scrollRelativeTop||!e.callback||e.callback.call(e.thisObj||this,e),e.scrollRequested=!0,e.frameId=this.requestAnimationFrame(()=>{e.scrollRequested=!1,this.performScroll(e)})}}onMouseMove(e){const t=this.scrollManager,n=this.verticalElement,r=this.element.getBoundingClientRect(),s=n.getBoundingClientRect(),i=t.zoneWidth,o=t.scrollSpeed;this.scrollDeltaX=0,"vertical"!==this.direction&&(e.clientX>r.right-i?this.scrollDeltaX=Math.round((i-(r.right-e.clientX))/o)+1:e.clientX<r.left+i&&(this.scrollDeltaX=-Math.round((i+(r.left-e.clientX))/o)-1)),this.scrollDeltaY=0,"horizontal"!==this.direction&&(e.clientY>s.bottom-i?this.scrollDeltaY=Math.round((i-(s.bottom-e.clientY))/o)+1:e.clientY<s.top+i&&(this.scrollDeltaY=-Math.round((i+(s.top-e.clientY))/o)-1)),0===this.scrollDeltaX&&0===this.scrollDeltaY?t.stopScroll(this):t.startScroll(this)}}return e._$name="ScrollManager",e}(),Lo=function(){class e extends Mo{static get defaultConfig(){return{isHeader:!0}}startConfigure(e){e.scrollable.overflowX="hidden-scroll",super.startConfigure(e)}get subGrid(){return this._subGrid}set subGrid(e){this._subGrid=e,this.id=e.id+"-header"}get region(){return this.subGrid&&this.subGrid.region}template(){const e=this.region;return Gn.tpl`
            <div class="b-grid-header-scroller b-grid-header-scroller-${e}">
                <div reference="headersElement" class="b-grid-headers b-grid-headers-${e}" data-region="${e}" data-max-depth="${this.maxDepth}" reference="headersElement"></div>
            </div>
        `}get overflowElement(){return this.headersElement}contentTemplate(e){const t=this;return e.hidden?"":Gn.tpl`
                <div class="b-grid-header" data-column="${e.field}" data-column-id="${e.id}" ${e.isLeaf?'tabindex="0"':""}>
                    <div class="b-grid-header-text">
                        <div class="b-grid-header-text-content"></div>
                    </div>
                    ${e.children?`\n                    <div class="b-grid-header-children">\n                            ${e.children.map(e=>t.contentTemplate(e)).join("")}\n                    </div>\n                    `:""}
                    <div class="b-grid-header-resize-handle"></div>
                </div>
            `}calculateMinWidthForSafari(){let e=0;return this.columns.visibleColumns.forEach(t=>{e+=t.calculateMinWidth()}),e}fixHeaderWidths(){this.fixCellWidths()}refreshHeaders(){const e=this;e.columns.traverse(t=>{const n=e.getBarCellElement(t.id);if(n){const r=new Ai({"b-grid-header":1,"b-grid-header-parent":t.isParent,[`b-level-${t.childLevel}`]:1,[`b-depth-${t.meta.depth}`]:1,[`b-grid-header-align-${t.align}`]:t.align,"b-grid-header-resizable":t.resizable&&t.isLeaf,[t.cls]:t.cls,"b-last-parent":t.isParent&&t.isLastInSubGrid,"b-last-leaf":t.isLeaf&&t.isLastInSubGrid});let s=t.text;n.className=r,t.headerRenderer&&(s=t.headerRenderer.call(t.thisObj||e,{column:t,headerElement:n})),t.icon&&(s=`<i class="${t.icon}"></i>`+(s||""));const i=n.querySelector(".b-grid-header-text-content");i&&(i.innerHTML=s||"")}}),e.fixHeaderWidths()}get columns(){return super.columns}set columns(e){const t=this;t.columnsDetacher&&t.columnsDetacher(),e&&(t.columnsDetacher=e.on({change(){this.initDepths()},thisObj:t})),super.columns=e,t.initDepths()}initDepths(e=this.columns,t=null){let n=this,r=0;t&&t.meta&&t.meta.depth++;for(let s of e)s.meta.depth=0,s.children&&(n.initDepths(s.children,s),s.meta.depth&&t&&(t.meta.depth+=s.meta.depth)),s.meta.depth>r&&(r=s.meta.depth);return t||(this.maxDepth=r),r}getHeader(e){return this.getBarCellElement(e)}get contentElement(){return this.element.firstElementChild}refreshContent(){const e=this;e.content=e.columns.map(t=>e.contentTemplate(t)).join(""),e.refreshHeaders()}render(e){super.render(e),this.refreshContent()}}return e._$name="Header",e}(),_o=new Promise(e=>e()),Po={block:"nearest"},$o=function(){class e extends pn{scrollIntoView(e,t=Po){const{xDelta:n,yDelta:r}=this.getDeltaTo(e,t),s=n||r?this.scrollBy(n,r,t):_o;return(t.highlight||t.focus)&&s.then(()=>{t.highlight&&(e instanceof oe?e.translate(-n,-r).highlight():yt.highlight(e)),t.focus&&e.focus&&e.focus()}),s}scrollBy(e,t,n){const r=t&&this.yScroller.scrollBy(0,t,n),s=e&&super.scrollBy(e,0,n);if(s&&s.cancel&&r&&r.cancel){const e=s.cancel,t=r.cancel;return s.cancel=r.cancel=(()=>{e(),t()}),Promise.all([s,r])}return s||r}scrollTo(e,t,n){const r=null!=t&&this.yScroller.scrollTo(null,t,n),s=null!=e&&super.scrollTo(e,null,n);if(s&&s.cancel&&r&&r.cancel){const e=s.cancel,t=r.cancel;return s.cancel=r.cancel=(()=>{e(),t()}),Promise.all([s,r])}return s||r}get viewport(){return oe.from(this.element).intersect(oe.from(this.yScroller.element))}set y(e){this.yScroller.y=e}get y(){return this.yScroller?this.yScroller.y:0}get maxY(){return this.yScroller?this.yScroller.maxY:0}get scrollHeight(){return this.yScroller?this.yScroller.scrollHeight:0}get clientHeight(){return this.yScroller?this.yScroller.clientHeight:0}}return e._$name="SubGridScroller",e}(),jo=function(){class e extends An{static get defaultConfig(){return{insertRowsBefore:null,appendTo:null,hideHeaders:null,monitorResize:!0,collapsedStateWidth:5,splitterWidth:1,collapsed:null,scrollable:{overflowX:!0},scrollerClass:$o,hasCalculatedWidth:null,sealedColumns:null,emptyText:null}}construct(e){super.construct(e),this.initHeader(),this.rowManager.on("addrows",this.onAddRow,this)}doDestroy(){const e=this;e.header&&e.header.destroy(),e.footer&&e.footer.destroy(),e.fakeScroller&&e.fakeScroller.destroy(),e.virtualScrollerElement&&e.virtualScrollerElement.remove(),e.splitterElement&&e.splitterElement.remove(),super.doDestroy()}initHeader(){const e=this,t=Object.assign({subGrid:e,columns:e.columns,hidden:e.hideHeaders,parent:e},e.headerConfig);e.header=new e.headerClass(t)}initElements(){this.footerElement=yt.down(this.grid.element,".b-grid-footer-scroller-"+this.region),this.updateHasFlex()}template(){const{grid:e,region:t}=this;return Gn.tpl`
            <div class="b-grid-subgrid b-grid-subgrid-${t} b-grid-horizontal-scroller" data-region="${t}">
                <div reference="virtualScrollerElement" class="b-virtual-scroller" data-region="${t}">
                    <div reference="virtualScrollerWidth" class="b-virtual-width"></div>
                </div>
                ${!e||t===e.regions[e.regions.length-1]?"":Gn.tpl`
                <div reference="splitterElement" data-region="${t}" class="${`b-grid-splitter${G.isIE11?" b-grid-splitter-transform":""}`}">
                    <div class="b-grid-splitter-inner"></div>
                    <i class="b-icon b-icon-collapse-gridregion"></i>
                    <i class="b-icon b-icon-expand-gridregion"></i>
                </div>`}
            </div>
        `}rowTemplate(){return Gn.tpl`
            <div class="b-grid-row">
                ${this.columns.visibleColumns.map(this.cellTemplate,this)}
            </div>
        `}cellTemplate(e){return`<div class="b-grid-cell" data-column="${e.field}" data-column-id="${e.id}"></div>`}onPaint(){const e=this;if(!e.rendered){const{grid:t}=e,n=t&&t.resolveSplitter(e);t&&(t.virtualScrollers.appendChild(e.virtualScrollerElement),e.splitterElement&&t.element.appendChild(e.splitterElement),e.renderHeader(t.headerContainer),e.renderFooter(t.footerContainer),e.initElements()),e.syncSplitter(!0),e.splitterWidth=n&&n.offsetWidth||1,e._collapsed&&e.collapse(),e.rendered=!0}}renderHeader(e){this.header&&this.header.render(e)}renderFooter(e){this.footer&&(this.footer.render(e),this.grid.footerContainer.classList.remove("b-hidden"))}refreshHeader(){this.header.refreshContent()}refreshFooter(){this.footer&&this.footer.refreshContent()}fixCellWidths(e,t=null){t||(t=this.columns.bottomColumns.filter(e=>!e.hidden));let n=e.firstElementChild,r=0;for(;n;){const e=t[r];e.minWidth&&yt.setLength(n,"minWidth",e.minWidth),e.flex?(n.style.flex=e.flex,n.style.width=""):e.width?(n.style.flex="",n.style.width=yt.setLength(e.width),G.isIE11&&(n.style.minWidth=n.style.width)):n.style.flex=n.style.width=n.style.minWidth="",n=n.nextElementSibling,r++}}get totalFixedWidth(){return this.columns.totalFixedWidth}fixWidths(){const e=this,{element:t,header:n,footer:r}=e;if(e.flex)n.flex=e.flex,r&&(r.flex=e.flex),t.style.flex=e.flex;else{if(e.hasCalculatedWidth&&!e.columns.some(e=>!e.hidden&&e.flex)&&e.totalFixedWidth!==e.width)return e.width=e.totalFixedWidth,void(e.hasCalculatedWidth=!0);let s=e.width;if(!s){s=0;for(let t of e.columns)t.flex||t.hidden||(s+=t.width)}t.style.width=`${s}px`,n.width=s,r&&(r.width=s)}e.syncScrollingPartners(!1)}fixRowWidthsInSafariEdge(){if(G.isSafari||G.isEdge){const e=this,{region:t,header:n}=e,r=n.calculateMinWidthForSafari();e.rowManager.forEach(e=>{const n=e.getElement(t);n&&(n.style.width=`${r}px`)}),n.headersElement.style.width=`${r}px`}}set width(e){const t=this;t.hasCalculatedWidth=!1,t.header&&(t.header.width=e),t.footer&&(t.footer.width=e),super.width=e,t.isConfiguring||t.onElementResize()}get width(){return super.width}set flex(e){const t=this;t.hasCalculatedWidth=!1,t.header&&(t.header.flex=e),t.footer&&(t.footer.flex=e),super.flex=e,t.isConfiguring||t.onElementResize()}get flex(){return super.flex}onInternalResize(e,t,n,r,s){const i=this,{grid:o}=i;super.onInternalResize(e,t,n,r,s),o&&t!==r&&(o.trigger("horizontalScroll",{subGrid:i,grid:o,scrollLeft:i.scrollable.x}),i.refreshFakeScroll(),o.rendered&&o.eachSubGrid(e=>e.syncSplitter()),i.fixRowWidthsInSafariEdge(),i.trigger("afterInternalResize",i))}syncSplitter(e=!1){const{element:t,splitterElement:n}=this;n&&(n.style.left=`${t.offsetLeft+(this.collapsed&&!e?0:t.offsetWidth)}px`)}get viewRectangle(){return new oe(this.scrollable.x,this.scrollable.y,this._width,this.rowManager.viewHeight)}updateHasFlex(){const e=this.columns.visibleColumns.some(e=>e.flex);yt.toggleClasses(this.element,["b-has-flex"],e)}refreshFakeScroll(){const e=this,{element:t,virtualScrollerElement:n,virtualScrollerWidth:r}=e,s=e.scrollable;s.scrollWidth=e.store.count?null:e.totalFixedWidth,n.style.width=`${t.offsetWidth}px`,e.totalFixedWidth>s.clientWidth?t.classList.add("b-overflowing-horizontally"):t.classList.remove("b-overflowing-horizontally"),s.scrollWidth>s.clientWidth+(G.isEdge?1:0)?(r.style.width=`${s.scrollWidth}px`,e.header.element.classList.add("b-overflowing"),e.footer&&e.footer.element.classList.add("b-overflowing"),e.overflowingHorizontally=!0,e.grid.virtualScrollers.classList.remove("b-hide-display")):(r.style.width=0,e.header.element.classList.remove("b-overflowing"),e.footer&&e.footer.element.classList.remove("b-overflowing"),e.overflowingHorizontally=!1)}initScroll(){const e=this,t=e.scrollable,n=e.virtualScrollerElement;G.isFirefox&&t.element.addEventListener("wheel",e=>{e.deltaX&&(t.x+=e.deltaX,e.preventDefault())}),t.yScroller=e.grid.scrollable,t.yScroller.addScroller(t),e.fakeScroller=new pn({element:n,overflowX:!0}),t.on("scroll",e.createOnFrame(e.syncScrollingPartners)),t.on("scrollend",()=>{e.scrolling=!1}),t.addPartner(e.fakeScroller,"x"),e.header&&t.addPartner(e.header.scrollable,"x"),e.footer&&t.addPartner(e.footer.scrollable,"x")}set scrolling(e){this._scrolling=e,this.grid.bodyContainer.classList[e?"add":"remove"]("b-scrolling")}get scrolling(){return this._scrolling}syncScrollingPartners(e=!0){const{grid:t}=this,n=this.scrollable.x;!this.scrolling&&e&&(this.scrolling=!0),t.trigger("horizontalScroll",{subGrid:this,grid:t,scrollLeft:n})}scrollColumnIntoView(e,t){const n=this,r=n.header.scrollable;if(e=e instanceof co?e:n.columns.get(e)||n.columns.getById(e)||n.columns.getAt(e)){const s=n.header.getHeader(e.id);if(s)return r.scrollIntoView(oe.from(s,null,!0),t)}}onAddRow({rows:e}){const t=this,n=t.rowTemplate(),r=t.columns.bottomColumns.filter(e=>!e.hidden),s=document.createDocumentFragment();e.forEach(e=>{const i=yt.createElementFromTemplate(n);s.appendChild(i),e.addElement(t.region,i),t.fixCellWidths(i,r)}),t.fixRowWidthsInSafariEdge(),t.element.insertBefore(s,t.insertRowsBefore)}get rowElements(){return this.fromCache(".b-grid-row",!0)}clearRows(){this.emptyCache();const e=this.element.querySelectorAll(".b-grid-row"),t=document.createRange();e.length&&(t.setStartBefore(e[0]),t.setEndAfter(e[e.length-1]),t.deleteContents())}addNewRowElement(){const e=yt.append(this.element,this.rowTemplate());return this.fixCellWidths(e),e}get emptyText(){return this._emptyText}set emptyText(e){this._emptyText=e,this.element.dataset.emptyText=e}toggleTransitionClasses(e=!1){const t=this.grid,n=t.getSubGrid(t.getNextRegion(this.region)),r=t.resolveSplitter(n);n.element.classList[e?"remove":"add"]("b-grid-subgrid-animate-collapse"),n.header.element.classList[e?"remove":"add"]("b-grid-subgrid-animate-collapse"),this.element.classList[e?"remove":"add"]("b-grid-subgrid-animate-collapse"),this.header.element.classList[e?"remove":"add"]("b-grid-subgrid-animate-collapse"),r.classList[e?"remove":"add"]("b-grid-splitter-animate")}get collapsed(){return this._collapsed}set collapsed(e){this.isConfiguring?this._collapsed=e:e?this.collapse():this.expand()}async collapse(){const e=this,t=e.collapsedStateWidth,n=e.grid,r=n.getSubGrid(n.getNextRegion(e.region));let s=0;return n.eachSubGrid(t=>{t!==e&&!t._collapsed&&++s}),0===s&&await r.expand(),new Promise(s=>{if(!e._beforeCollapseState){e._beforeCollapseState={};let i=!1;e.width!==t&&(i=!0,e.on({afterinternalresize:()=>{s(e)},thisObj:e,once:!0})),e._beforeCollapseState.width=e.width,e._beforeCollapseState.splitterLeft=n.resolveSplitter(e).offsetLeft,""===r.element.style.flex&&(e._beforeCollapseState.nextRegionWidth=r.width,r.width+=e._beforeCollapseState.width),""!==e.element.style.flex&&(e._beforeCollapseState.style=e.element.style.flex,e.header.element.style.flex=e.element.style.flex=""),e.element.classList.add("b-grid-subgrid-collapsed"),e._collapsed=!0,i?(e.width=t,n.resolveSplitter(e).style.left=e.element.offsetLeft):s(!1)}}).then(t=>{!1!==t&&e.grid.trigger("subGridCollapse",e)})}async expand(){const e=this,t=e.grid,n=t.getSubGrid(t.getNextRegion(e.region));return new Promise(r=>{if(null!=e._beforeCollapseState){let s=!1;e.width!==e._beforeCollapseState.width&&(s=!0,e.on({afterinternalresize:()=>{setTimeout(()=>r(e),10)},thisObj:e,once:!0})),""===n.element.style.flex&&(n.width=e._beforeCollapseState.nextRegionWidth),e.element.classList.remove("b-grid-subgrid-collapsed"),e._collapsed=!1,e.width=e._beforeCollapseState.width,e._beforeCollapseState.style&&(e.header.element.style.flex=e.element.style.flex=e._beforeCollapseState.style,e.header.element.style.width=e.element.style.width="",e._width=null),t.resolveSplitter(e).style.left=`${e._beforeCollapseState.splitterLeft}px`,e.element.classList.remove("b-grid-subgrid-collapsed"),e._collapsed=!1,s||r(!1),delete e._beforeCollapseState}}).then(t=>{!1!==t&&e.grid.trigger("subGridExpand",e)})}}return e._$name="SubGrid",e}(),Ho=function(){class e extends(U(W)){static get defaultConfig(){return{cls:"b-grid-row"}}construct(e){Object.assign(this,{_elements:{},_elementsArray:[],_cells:{},_allCells:[],_regions:[],lastHeight:0,lastTop:-1,_dataIndex:0,_top:0,_height:0,_id:null,forceInnerHTML:!1,isGroupFooter:!1}),Object.assign(this,e),super.construct()}get index(){return this._index}set index(e){this._index=e}get dataIndex(){return this._dataIndex}set dataIndex(e){if(this._dataIndex!==e){const t=this._elementsArray;this._dataIndex=e;for(let n=0;n<t.length;n++)t[n].dataset.index=e}}get id(){return this._id}set id(e){const t=this,n={id:e},r=t.rowManager.idMap,s=t._elementsArray,i=t._allCells;if(t._id!=e||r[e]!==t){r[t._id]===t&&delete r[t._id],r[e]=t,t._id=e;for(let e=0;e<s.length;e++)fs.assign(s[e],n);for(let e=0;e<i.length;e++)fs.assign(i[e],n)}}addElement(e,t){const n=this;let r=t.firstElementChild;for(n._elements[e]=t,n._elementsArray.push(t),n._regions.push(e),fs.assign(t,{index:n.index}),n._cells[e]=[];r;)n._cells[e].push(r),n._allCells.push(r),fs.set(r,{column:r.dataset.column,columnId:r.dataset.columnId,rowElement:r.parentNode,row:n}),r=r.nextElementSibling;t.dataset.index=n.index}getElement(e){return this._elements[e]}eachElement(e){for(let t=0;t<this._elementsArray.length;t++)e(this._elementsArray[t],t)}eachCell(e){this._allCells.forEach(e)}get elements(){return this._elements}get cells(){return this._allCells}getCells(e){return this._cells[e]}getCell(e){return this._allCells.find(t=>{const n=fs.get(t);return n.columnId===e||n.column===e})}removeElements(e=!1){const t=this;e||t._elementsArray.forEach(e=>e.remove()),t._elements={},t._cells={},t._elementsArray.length=t._regions.length=t._allCells.length=t.lastHeight=t.height=0,t.lastTop=-1}get height(){return this._height}set height(e){this._height=e}get offsetHeight(){return this.height+this.grid._rowBorderHeight}setHeightIfBigger(e){e>this.height&&(this.height=e)}updateElementsHeight(){const e=this;if(e.lastHeight!==e.height){const t=e._elementsArray;for(let n=0;n<t.length;n++)t[n].style.height=`${e.offsetHeight}px`;e.lastHeight=e.height}}addCls(...e){this.eachElement(t=>yt.addClasses(t,e))}removeCls(...e){this.eachElement(t=>yt.removeClasses(t,e))}get isFirst(){return 0===this.dataIndex}get top(){return this._top}get bottom(){return this._top+this._height+this.grid._rowBorderHeight}setTop(e){this._top!==e&&(this._top=e,this.translateElements())}setBottom(e){this.setTop(e-this.offsetHeight)}translateElements(){const e=this,t=e.grid.positionMode;if(e.lastTop!==e.top){const n=e._elementsArray;for(let r=0;r<n.length;r++){const s=n[r].style;"translate"===t?s.transform=`translate(0,${e.top}px)`:"translate3d"===t?s.transform=`translate3d(0,${e.top}px,0)`:"position"===t&&(s.top=`${e.top}px`)}e.rowManager.trigger("translateRow",{row:e}),e.lastTop=e.top}}offset(e){let t=this._top+e;return t<0&&(e-=t,t=0),this.setTop(t),e}render(e,t,n=!0,r=!1){const s=this,{cells:i,grid:o}=s,a=s._id,l=s._elementsArray,c=fs.get(l[0]),d=s.rowManager,u=d._rowHeight,h=s.height,g=n&&o.transitionDuration?`${s.cls} b-grid-row-updating`:s.cls;let m,p,f,v=0;t||!1===t||(t=o.store.getById(c.id),e=o.store.indexOf(t));const y=t&&o.isSelected(t.id);for(d.trigger("beforeRenderRow",{row:s,record:t,oldId:a});v<l.length;v++)(m=l[v]).className=g,y&&m.classList.add("b-selected"),t||(c.displayed=!1,m.classList.add("b-grid-row-not-displayed")),t&&(t.cls&&t.cls.split(" ").forEach(e=>m.classList.add(e)),c.displayed=!0);for(n&&o.transitionDuration&&s.setTimeout(()=>{l.forEach(e=>{e.classList.remove("b-grid-row-updating")})},o.transitionDuration),s.height=0,t?(s.id=t.id,s.dataIndex=e):(s.id=null,s.dataIndex=null),v=0;v<i.length;v++)f=s.renderCell(p=i[v],t,v,n),s.setHeightIfBigger(f&&f.height||u);s.updateElementsHeight(),n&&(h!==s.height&&d.translateFromRow(s,r),d.trigger("updateRow",{row:s,record:t,oldId:a})),d.trigger("renderRow",{row:s,record:t,oldId:a}),s.forceInnerHTML=!1}renderCell(e,t,n,r=!0){const s=this,i=fs.get(e),o=s.grid.columns.getById(i.columnId),a=i.rowElement,l=fs.get(a),{internalCellCls:c,cellCls:d,align:u,renderer:h,defaultRenderer:g,id:m}=o,p={columnId:m,id:l.id},f=h||g;if(!t){if(null===l.id)return void(e.className="b-grid-cell");if(!(t=s.grid.store.getById(l.id)))return}const v={"b-grid-cell":1,[c]:c,[d]:d,"b-cell-dirty":t.isFieldModified(o.field),[`b-grid-cell-align-${u}`]:u,"b-selected":s.grid.isSelected(p),"b-focused":s.grid.isFocused(p)};yt.syncClassList(e,v);let y={height:t.get("rowHeight")||0},b=o.getRawValue(t),C=!0,w={cellElement:e,rowElement:a,value:b,record:t,column:o,size:y,grid:s.grid,row:i.row,updatingSingleRow:r};f&&void 0===(b=f.call(o,w))&&(C=!1);const S=w.cellContent=null==b?"":String(b);if(C)if(s.forceInnerHTML)e.innerHTML=S;else if(o.htmlEncode&&!o.disableHtmlEncode)if(G.isLinux)e.innerText=S;else{const t=e.firstChild;t?t.data=S:e.innerText=S}else{const t="string"==typeof b;!o.autoSyncHtml||t&&!e.childElementCount?e.innerHTML=S:t?yt.sync(S,e.firstElementChild):yt.sync({elementConfig:b,targetElement:e})}return s.rowManager.trigger("renderCell",w),y}}return e._$name="Row",e}(),No=function(){class e extends ur{static get pluginConfig(){return{chain:["getRowById","topRow","bottomRow","getRecordCoords","getRow","getRowFor","getRowFromElement","destroy"],assign:["rowHeight"]}}static get defaultConfig(){return{prependRowBuffer:5,appendRowBuffer:5,rowHeight:null,idMap:{},rowScrollMode:"move",autoHeight:!1,topIndex:0,lastScrollTop:0,_rows:[]}}construct(e){e.grid._rowManager=this,this.scrollTargetRecordId=null,super.construct(e.grid,e)}initWithHeight(e,t=!1){const n=this;return n.autoHeight&&(e=n.store.allCount*n.rowOffsetHeight),n.viewHeight=e,n.calculateRowCount(t),e}reinitialize(e=!1){const t=this,n=t.topRow?t.topRow.top:0;t._rows.length=1,t.scrollTargetRecordId=null,e&&(t.topIndex=0,t.lastScrollTop=0),t.releaseElements(),t.calculateRowCount(!1,!0,!0),!e&&t.topRow&&(t.topRow.dataIndex=t.topIndex,t.topRow.setTop(n)),t.estimateTotalHeight(),t.renderFromRow(t.topRow)}matchRowCount(e=!1){const t=this,n=t._rows,r=n.length,s=r-t.rowCount,i=t.grid;if(s)if(s<0){const s=[];for(let e=r,o=r?n[r-1].dataIndex+1:0;e<t.rowCount;e++,o++)s.push(new Ho({rowManager:t,grid:i,index:e,dataIndex:o}));n.push.apply(n,s),t.trigger("addRows",{rows:s}),e||t.renderFromRow(n[Math.max(0,r-1)])}else{const e=n.splice(r-s,s);e.forEach(e=>e.eachElement(e=>e.remove())),t.trigger("removeRows",{rows:e})}}calculateRowCount(e=!1,t=!0,n=!1){const r=this,s=r.store,i=Math.ceil(r.viewHeight/r.rowOffsetHeight),o=i+r.prependRowBuffer+r.appendRowBuffer;return r.grid.columns.count?o<r.rowCount&&!t?r.rowCount:(r.visibleRowCount=i,r.rowCount=Math.min(s.count,o),"all"===r.rowScrollMode&&(r.rowCount=s.allCount),e||(r._rows&&r.rowCount!==r._rows.length?r.matchRowCount(n):r.rowCount||r.trigger("changeTotalHeight",{totalHeight:r.totalHeight}),r.grid.bodyContainer.classList[r.rowCount||s.isLoading?"remove":"add"]("b-grid-empty")),r.rowCount):(r.rowCount=0,0)}releaseElements(){this.forEach(e=>e.removeElements(!0)),this._rows.length=0,this.idMap={}}get store(){return this.client.store}get rows(){return this._rows}getRow(e){return this.rowCount&&this.rows[e-this.topIndex]}getRowById(e){return"string"!=typeof e&&"number"!=typeof e&&(e=e.id),this.idMap[e]}getRowFromElement(e){return(e=e.closest(".b-grid-row"))&&this.getRow(e.dataset.index)}getRowAt(e,t=!1){return t||(e-=oe.from(this.grid.bodyContainer,null,!0).top,e+=this.grid.scrollable.y),e=gt(e),this.rows.find(t=>e>=t.top&&e<t.bottom)}getRowFor(e){return e instanceof HTMLElement?this.getRowFromElement(e):this.getRowById(e)}getNextRow(e){return this.getRow((("number"==typeof e?e:e.index)+1)%this.rowCount)}get topRow(){return this._rows[0]}get bottomRow(){const e=Math.min(this.rowCount,this.store.count);return this.rows[e-1]}offsetRows(e){if(0!==e){const t=this.rows,n=t.length;for(let r=0;r<n;r++)t[r].offset(e)}}get rowHeight(){return this._rowHeight}set rowHeight(e){const t=this,{grid:n}=t,r=t._rowHeight;if(We.assertNumber(e,"rowHeight"),t.trigger("beforeRowHeight",{height:e}),t._rowHeight=e,t.prependBufferHeight=t.prependRowBuffer*t.rowOffsetHeight,t.appendBufferHeight=t.appendRowBuffer*t.rowOffsetHeight,t.rows.length){let s=t.averageRowHeight;const i=s;s-=n._rowBorderHeight,s*=e/r,t.averageRowHeight=s+=n._rowBorderHeight,t.calculateRowCount(!1,!0,!0),t.topRow.setTop(t.topRow.dataIndex*s),t.refresh();const o=n.scrollable.y,a=o*(s/i);a!==o&&(t.ignoreScroll=!0,n.scrollable.y=a)}t.trigger("rowHeight",{height:e})}get rowOffsetHeight(){return Math.floor(this.averageRowHeight)||this._rowHeight+this.grid._rowBorderHeight}getRecordCoords(e,t=!1){const n=this,r="string"==typeof e||"number"==typeof e?e:e.id,s=n.getRowById(e);let i=n.client._bodyRectangle;return t||(i=n.client._bodyRectangle=oe.client(n.client.bodyContainer)),s?new oe(i.x,t?Math.round(s.top):Math.round(s.top+i.y-n.client.scrollable.y),i.width,s.offsetHeight):n.getRecordCoordsByIndex(n.store.indexOf(r),t)}getRecordCoordsByIndex(e,t=!1){const n=this,r=n.client._bodyRectangle,s=n.averageRowHeight||n._rowHeight+n.grid._rowBorderHeight,i=n.topRow.dataIndex,o=n.bottomRow.dataIndex,a=e>o?{index:e-o-1,y:n.bottomRow.bottom,from:"bottomRow"}:e>i/2?{index:e-i,y:n.topRow.top,from:"topRow"}:{index:e,y:0,from:"top"},l=Math.floor(a.y+a.index*s),c=new oe(r.x,t?l:l+r.y-n.client.scrollable.y,r.width,s);return c.virtual=!0,c.block=c.bottom<r.y?"start":c.y>r.bottom?"end":"nearest",c}get totalHeight(){return Math.floor(this.store.count*this.rowOffsetHeight)}forEach(e){this.rows.forEach(e)}[Symbol.iterator](){return this.rows[Symbol.iterator]()}returnToTop(){const e=this;e.topIndex=0,e.lastScrollTop=0,e.topRow.dataIndex=0,e.topRow.setTop(0),e.refresh(),e.grid.scrollable.y=0}renderFromRecord(e){const t=this.getRowById(e.id);t&&this.renderFromRow(t)}renderFromRow(e=null){const t=this,{_rows:n,store:r}=t,s=r.count;if(0===t.calculateRowCount(!1,s<n.length,!0))return;let i,o=e?n.indexOf(e):0,a=e?e.dataIndex:n[0].dataIndex,l=Math.min(n.length-1,o+(s-a-1)),c=n.length-l-1,d=o>0?n[o-1].bottom:n[o].top;for(let u=o;u<=l;u++)(i=n[u]).dataIndex=a,i.setTop(d),i.render(a,r.getAt(a++),!1),d+=i.offsetHeight;for(;c-- >0;)t.displayRecordAtTop();t.averageRowHeight=t.averageRowHeight?(t.averageRowHeight*(s-t.rowCount)+(d-t.topRow.top))/s:(d-t.topRow.top)/t.rowCount,t.estimateTotalHeight()}renderRows(e){let t,n=!1;e=Array.from(e);for(const r of e)t=r.height,r.render(null,null,!1),n|=r.height!==t;n&&(this.translateFromRow(e[0],!0),this.estimateTotalHeight())}translateFromRow(e,t=!1){let n,r,s=this,i=e.bottom,o=s.store.count;for(n=s.getRow(r=e.dataIndex+1);n;n=s.getRow(++r))n.setTop(i),i+=n.offsetHeight;s.averageRowHeight=(s.averageRowHeight*(o-s.rowCount)+(s.bottomRow.bottom-s.topRow.top))/o,t||s.estimateTotalHeight()}refresh(){const{topRow:e}=this;e&&(this.idMap={},this.renderFromRow(e),this.trigger("refresh"))}jumpToPosition(e,t){const n=this,r=n.rowOffsetHeight,s=n.store.count,i=null==t?Math.floor(e/r)-n.prependRowBuffer:t-Math.floor(n.rowCount/2),o=Math.max(Math.min(i,s-n.rowCount),0),a=n.client.scrollable.y,l=Math.min(n.client._bodyRectangle.height+a+n.appendBufferHeight,n.totalHeight);if(n.lastScrollTop=e,n.topRow.dataIndex=n.topIndex=o,n.topRow.setTop(o*r,!1),n.refresh(),n.bottomRow.bottom<l){for(;n.bottomRow.bottom<l&&n._rows[n.prependRowBuffer].top<a&&n.bottomRow.dataIndex<s-1;)n.displayRecordAtBottom();n.averageRowHeight=(n.averageRowHeight*(s-n.rowCount)+(n.bottomRow.bottom-n.topRow.top))/s}if(n.estimateTotalHeight(),null!=t){const r=n.getRow(t),s=r&&oe.from(r._elementsArray[0]).center.y,i=n.grid.scrollable.viewport.center.y;r&&(n.grid.scrollable.y=e=Math.floor(n.grid.scrollable.y+(s-i)))}return e}warpIfNeeded(e){const t=this,n={newScrollTop:e,deltaTop:e-t.lastScrollTop};if(Math.abs(n.deltaTop)>t.rowCount*t.rowOffsetHeight*3){let r;t.scrollTargetRecordId&&(r=t.store.indexOf(t.scrollTargetRecordId)),n.newScrollTop=t.jumpToPosition(e,r),n.deltaTop=0}return n}updateRenderedRows(e,t,n){const r=this,s=r.client._bodyRectangle;if(r.ignoreScroll)return r.ignoreScroll=!1,null;if(0===r.rowCount)return 0;let i=r.estimatedTotalHeight;if(t||Math.abs(e-r.lastScrollTop)>r.rowOffsetHeight){const t=r.warpIfNeeded(e);if(r.scrollTargetRecordId=null,r.lastScrollTop=t.newScrollTop,t.deltaTop>0?r.fillBelow(t.newScrollTop):t.deltaTop<0&&r.fillAbove(t.newScrollTop),i=r.estimateTotalHeight(),!n&&(t.deltaTop<0&&e<2*s.height||t.deltaTop>0&&e>r.estimatedTotalHeight-2*s.height-3)){const e=r.topRow.top-r.topIndex*r.rowOffsetHeight;e&&(r.offsetRows(-e),r.grid.scrollable.y=r.lastScrollTop=r.grid.scrollable.y-e)}}return i}fillAbove(e){const t=this,n=e-t.topRow.top-t.prependBufferHeight;let r=0;for(;r>n&&t.topIndex>0;)r-=t.displayRecordAtTop()}fillBelow(e){const t=this,n=e-t.topRow.top-t.prependBufferHeight,r=t.store.count,s=t.rowCount;let i=0;for(;i<n&&t.topIndex+s<r&&t.topRow.top+t.topRow.offsetHeight<e;)i+=t.displayRecordAtBottom()}estimateTotalHeight(){let e=this,t=e.store.count,n=Math.floor(t*(e.averageRowHeight||e.rowOffsetHeight)),{bottomRow:r}=e;if(r){const s=r.bottom;(s>n||e.topIndex+e.rowCount>=t&&n>s)&&(n=s,r.dataIndex<t-1&&(n+=(t-1-r.dataIndex)*e.rowOffsetHeight))}return n!=e.estimatedTotalHeight&&e.trigger("changeTotalHeight",{totalHeight:n}),e.estimatedTotalHeight=n,n}displayRecordAtTop(){const e=this,t=e.topIndex-1,n=e.store.getAt(t),r=e.store.count,s=e.bottomRow,i=s.top;return e.trigger("beforeTranslateRow",{row:s,newRecord:n}),s._top=e.topRow.top-e.rowOffsetHeight,s.estimatedTop=!0,s.render(t,n,!1),s._top=i,s.setBottom(e.topRow.top),s.estimatedTop=!1,e.topIndex--,e._rows.unshift(e._rows.pop()),e.averageRowHeight=(e.averageRowHeight*(r-1)+s.offsetHeight)/r,s.offsetHeight}displayRecordAtBottom(){const e=this,t=e.topIndex+e.rowCount,n=e.store.getAt(t),r=e.store.count,s=e.topRow;return e.trigger("beforeTranslateRow",{row:s,newRecord:n}),s.dataIndex=t,s.setTop(e.bottomRow.bottom),s.render(t,n,!1),e.topIndex++,e._rows.push(e._rows.shift()),e.averageRowHeight=(e.averageRowHeight*(r-1)+s.offsetHeight)/r,s.offsetHeight}}return e._$name="RowManager",e}(),zo={x:1},Bo=function(){class e extends pn{addScroller(e){(this.xScrollers||(this.xScrollers=[])).push(e)}addPartner(e,t=zo){if("string"==typeof t&&(t={[t]:1}),t.x)for(let n=0;n<this.xScrollers.length;n++)this.xScrollers[n].addPartner(e.xScrollers[n],"x");t.y&&super.addPartner(e,"y")}updateOverflowX(e){this.xScrollers&&this.xScrollers.forEach(t=>t.overflowX=e),this.widget.virtualScrollers.classList[!1===e?"add":"remove"]("b-hide-display")}scrollIntoView(e,t){if(1!==e.nodeType)return super.scrollIntoView(e,t);for(const n of this.xScrollers)if(n.element.contains(e))return n.scrollIntoView(e,t)}set x(e){this.xScrollers[0].x=e}get x(){return this.xScrollers[0].x}}return e._$name="GridScroller",e}(),Vo={touchstart:"onElementTouchStart",touchmove:"onElementTouchMove",touchend:"onElementTouchEnd",mouseover:"onElementMouseOver",mouseout:"onElementMouseOut",mousedown:"onElementMouseDown",mousemove:"onElementMouseMove",mouseup:"onElementMouseUp",click:"onHandleElementClick",dblclick:"onElementDblClick",keydown:"onElementKeyDown",keyup:"onElementKeyUp",keypress:"onElementKeyPress",contextmenu:"onElementContextMenu",focus:"onGridElementFocus"};var Wo=e=>(class extends(e||W){static get defaultConfig(){return{longPressTime:400}}initInternalEvents(){const e=Object.keys(Vo),t=e.length,n={element:this.element,thisObj:this};for(let r=0;r<t;r++)n[e[r]]="handleEvent";Kt.on(n)}getEventData(e){const t=this,n=yt.up(e.target,".b-grid-cell");if(n){const e=fs.get(n),{id:r,columnId:s}=e,i=t.store.getById(r);return i?{cellElement:n,cellData:e,columnId:s,id:r,record:i,cellSelector:{id:r,columnId:s}}:null}}handleEvent(e){this.disabled||(this.event=e,Vo[e.type]&&this[Vo[e.type]](e))}onElementTouchStart(e){const t=this;yt.isTouchEvent=!0,1===e.touches.length&&(t.longPressTimeout=setTimeout(()=>{t.onElementLongPress(e),e.preventDefault(),t.longPressPerformed=!0},t.longPressTime))}onElementTouchMove(e){this.longPressTimeout&&(clearTimeout(this.longPressTimeout),this.longPressTimeout=null)}onElementTouchEnd(e){const t=this;t.longPressPerformed&&(e.cancelable&&e.preventDefault(),t.longPressPerformed=!1),t.longPressTimeout&&(clearTimeout(t.longPressTimeout),t.longPressTimeout=null)}onElementLongPress(e){}triggerCellMouseEvent(e,t){const n=this,r=n.getEventData(t);if(r){const s=n.columns.getById(r.columnId);n.trigger("cell"+$.capitalizeFirstLetter(e),{grid:this,record:r.record,column:s,cellSelector:r.cellSelector,cellElement:r.cellElement,target:t.target,event:t})}}onElementMouseDown(e){const t=this.getEventData(e);this.skipFocusSelection=!0,this.triggerCellMouseEvent("mousedown",e),e.defaultPrevented||this.onFocusGesture(t,e)}onElementMouseMove(e){}onElementMouseUp(e){}onHandleElementClick(e){!1!==this.trigger("beforeElementClick",{event:e})&&this.onElementClick(e)}onElementClick(e){const t=this.getEventData(e);t&&(this.triggerCellMouseEvent("click",e),fs.get(t.cellElement).row.removeCls("b-hover"))}onFocusGesture(e,t){e&&this.focusCell(e.cellSelector,{doSelect:!0,event:t})}onElementDblClick(e){const t=this,n=e.target;if(t.triggerCellMouseEvent("dblClick",e),n.classList.contains("b-grid-header-resize-handle")){const e=yt.up(n,".b-grid-header");t.columns.getById(e.dataset.columnId).resizeToFitContent()}}onElementMouseOver(e){if(!this.scrolling){const t=yt.up(e.target,".b-grid-cell");if(t){const n=fs.get(t).row;!n||"number"==typeof e.buttons&&0!==e.buttons||n.addCls("b-hover"),this.triggerCellMouseEvent("mouseOver",e)}this.trigger("mouseOver",{event:e})}}onElementMouseOut(e){const t=this;if(!t.scrolling){const n=yt.up(e.target,".b-grid-cell");if(n){const r=fs.get(n).row;r&&r.removeCls("b-hover"),t.triggerCellMouseEvent("mouseOut",e)}t.trigger("mouseOut",{event:e})}}onElementKeyDown(e){const t=this;if(!e.handled)if(e.target.matches(".b-grid-header.b-depth-0"))t.handleHeaderKeyDown(e);else if(e.target===this.element||G.isIE11&&e.currentTarget===this.element)t.handleViewKeyDown(e);else if("Escape"===e.key&&t.isActionableLocation){const e=We.clone(t.focusedCell);e.element=null,t.focusCell(e),yt.focusWithoutScrolling(t.element)}}handleViewKeyDown(e){const t=this;switch(e.key){case"ArrowLeft":return e.preventDefault(),t.navigateLeft(e);case"ArrowRight":return e.preventDefault(),t.navigateRight(e);case"ArrowUp":return e.preventDefault(),t.navigateUp(e);case"ArrowDown":return e.preventDefault(),t.navigateDown(e)}}handleHeaderKeyDown(e){const t=this,n=t.columns.getById(e.target.dataset.columnId);switch(n.onKeyDown&&n.onKeyDown(e),e.key){case"ArrowLeft":const r=t.columns.getAdjacentVisibleLeafColumn(n,!1);r&&t.getHeaderElement(r.id).focus();break;case"ArrowRight":const s=t.columns.getAdjacentVisibleLeafColumn(n,!0);s&&t.getHeaderElement(s.id).focus();break;case"Enter":t.getHeaderElement(n.id).click()}}onElementKeyPress(e){}onElementKeyUp(e){}onElementContextMenu(e){const t=this.getEventData(e);t&&(this.triggerCellMouseEvent("contextMenu",e),yt.isTouchEvent&&this.onFocusGesture(t,e))}onInternalResize(e,t,n,r,s){const i=this;i._devicePixelRatio&&i._devicePixelRatio!==window.devicePixelRatio&&yt.resetScrollBarWidth(),i._devicePixelRatio=window.devicePixelRatio,i._bodyRectangle=oe.client(i.bodyContainer),super.onInternalResize(...arguments),n!==s&&(i._bodyHeight=i.bodyContainer.offsetHeight,i.rendered&&i.rowManager.initWithHeight(i._bodyHeight)),i.refreshVirtualScrollbars(),t!==r&&i.setTimeout(()=>{i.isDestroyed||i.updateResponsive(t,r)},0)}get widgetClass(){}});let Uo={string:1,object:1,function:1};var Go=e=>(class extends(e||W){set features(e){const t=this,n=To.getInstanceDefaultFeatures(this);let r,s,i;e=t._features=We.assign({},e),n&&Object.entries(n).forEach(([t,n])=>{t in e||(e[t]=!0)});const o=To.getInstanceFeatures(this);for(r of Object.keys(e))if(s=e[r]){if($.lowercaseFirstLetter(r)!==r)throw new Error(t.L("invalidFeatureNameFormat",r));if(!(i=o[r]))throw new Error(t.L("featureNotFound",r));Reflect.defineProperty(e,r,t.createFeatureInitializer(e,r,i,s))}}get features(){return this._features}createFeatureInitializer(e,t,n,r){const s=[this],i=n.prototype.construct;return Uo[typeof r]&&(s[1]=r),{configurable:!0,get:()=>(delete e[t],n.prototype.construct=function(...r){e[t]=this,i.apply(this,r),n.prototype.construct=i},new n(...s))}}hasFeature(e){return!!(this.features&&e in this.features)}get widgetClass(){}});const Yo=Object.freeze({doSelect:!0});var qo=e=>(class extends(e||W){get focusedCell(){return this._focusedCell}get isActionableLocation(){const e=this._focusedCell;return Boolean(e&&e.element&&this.getCell(e).contains(e.element))}set focusedCell(e){this.focusCell(e,{doSelect:!1})}get focusedRecord(){if(this._focusedCell)return this.store.getById(this._focusedCell.id)}get cellCSSSelector(){const e=this._focusedCell,t=e&&this.getRowById(e.id);return e&&t?`[data-index=${t.index}] [data-column-id=${e.columnId}]`:""}onGridElementFocus(e){const t=this,n={doSelect:!1,event:e};if(t._focusedCell)t.focusCell(t._focusedCell,n);else{const r=t.element.contains(e.relatedTarget)?null:t.lastFocusedCell;if(r){if(!t.store.getById(r.id))return void t.revertFocus();t.returningFocus=!0,t.focusCell(r,n),t.returningFocus=!1}else!t.skipFocusSelection&&t.store.first&&t.focusCell({id:t.store.first.id,columnId:t.columns.visibleColumns[0].id},n)}t.skipFocusSelection=!1}onFocusOut(e){super.onFocusOut(e),this.clearFocus()}isFocused(e){return Boolean(this._focusedCell)&&this.isLocationEqual(e,this._focusedCell)}focusCell(e,t=Yo){e=this.normalizeCellContext(e===Object?Object.assign({},e):e);const n=this,r=!1!==t.doSelect,{event:s}=t,i=n.lastFocusedCell=n._focusedCell,o=n.isLocationEqual(e,i),a=i&&n.getCell(i);let l=n.getCell(e);if(s&&"mousedown"===s.type)for(let c=s.target;c!==l;c=c.parentElement)if(yt.isFocusable(c))return void(e.element=c);return o?(s&&n.onCellNavigate&&n.onCellNavigate(n,null,n._focusedCell,s,r),e):(a&&a.classList.remove("b-focused"),n.scrollRowIntoView(e.id,Object.assign({column:e.columnId},t)),(l=n.getCell(e))&&(e.element=l,l.classList.add("b-focused")),n._focusedCell=e,n.onCellNavigate&&n.onCellNavigate(n,i,n._focusedCell,s,r),n.trigger("navigate",{lastFocusedCell:i,focusedCell:n._focusedCell,event:s}),e)}isLocationEqual(e,t){return e&&t&&e.id===t.id&&e.columnId===t.columnId&&(!e.element||!t.element||e.element===t.element)}blurCell(e){const t=this.getCell(e);t&&t.classList.remove("b-focused")}clearFocus(){const e=this;e._focusedCell&&(e.lastFocusedCell=e._focusedCell,e.blurCell(e._focusedCell),e._focusedCell=null)}internalNextPrevCell(e=!0,t){let n=this._focusedCell;return n?this.focusCell({id:n.id,columnId:this.columns.getAdjacentVisibleLeafColumn(n.columnId,e,!0).id},{doSelect:!0,event:t}):null}navigateRight(e){return this.internalNextPrevCell(!0,e)}navigateLeft(e){return this.internalNextPrevCell(!1,e)}internalNextPrevRow(e,t=!0,n){const r=this,s=r._focusedCell;if(!s)return!1;const i=r.store[`get${e?"Next":"Prev"}`](s.id,!1,t);return!!i&&r.focusCell({id:i.id,columnId:r._focusedCell&&r._focusedCell.columnId},{doSelect:!0,event:n})}navigateDown(e){return this.internalNextPrevRow(!0,!1,e)}navigateUp(e){return this.internalNextPrevRow(!1,!1,e)}get widgetClass(){}}),Xo=e=>(class extends(e||W){static get defaultConfig(){return{responsiveLevels:Object.freeze({small:400,medium:600,large:"*"})}}getClosestBiggerLevel(e){let t=this,n=Object.keys(t.responsiveLevels),r=null,s=99995,i=null;return n.forEach(n=>{let o=t.responsiveLevels[n];if(["number","string"].includes(typeof o)||(o=o.levelWidth),"*"===o)i=n;else if(e<o){const t=o-e;t<s&&(s=t,r=n)}}),r||i}get responsiveLevel(){return this.getClosestBiggerLevel(this.width)}updateResponsive(e,t){const n=this,r=n.getClosestBiggerLevel(t),s=n.getClosestBiggerLevel(e);if(r!==s){const i=n.responsiveLevels[s];["number","string"].includes(typeof i)||n.applyState(i),n.columns.forEach(e=>{const t=e.responsiveLevels;t&&(t[s]?e.applyState(t[s]):t["*"]&&e.applyState(t["*"]))}),n.element.classList.remove("b-responsive-"+r),n.element.classList.add("b-responsive-"+s),n.trigger("responsive",{level:s,width:e,oldLevel:r,oldWidth:t})}}get widgetClass(){}});const Ko={string:1,number:1};var Zo=e=>(class extends(e||W){static get defaultConfig(){return{recordCollection:{}}}afterConfigure(){const e=this;if(e.selectionMode.checkbox){const t=e.checkboxColumn=new mo({id:`${e.id}-selection-column`,width:"4em",field:null,region:Object.keys(e.subGridConfigs).sort()[0]});t.meta.depth=0,t._grid=e;const n=t.renderer;t.renderer=(r=>{r.value=e.isSelected(r.record),n.call(t,r)}),t.on({toggle:"onCheckChange",thisObj:e});const r=e.columns.indexOf(e.columns.findRecord("type","rownumber"))+1;e.columns.insert(r,t)}super.afterConfigure()}onRecordCollectionChange({added:e=[],removed:t}){const n=this;n._selectedCell&&!n.isSelectable(n._selectedCell)&&n.deselectCell(n._selectedCell),e=e.filter(e=>n.isSelectable(e)),n.triggerChangeEvent({mode:"row",action:e.length?"select":"deselect",selection:n.selectedRecords,selected:e,deselected:t},n.silent)}onCheckChange({checked:e,record:t}){e?this.selectRow(t,!1,!0):this.deselectRow(t)}onElementKeyDown(e){const t=this,{focusedCell:n,checkboxColumn:r}=t;if(super.onElementKeyDown(e),n&&" "===e.key&&r&&t.columns.getById(n.columnId)===r){const e=t.getCell(n).widget;e&&e.toggle()}}set recordCollection(e){e instanceof cn||(e=new cn(e)),this._recordCollection=e,e.on({change:"onRecordCollectionChange",thisObj:this})}get recordCollection(){return this._recordCollection}spliceSelectedRecords(e,t,n){this._recordCollection.splice(e,t,n)}isSelected(e){return e instanceof Sr&&(e=e.id),Ko[typeof e]?this.recordCollection.includes(e):this._selectedCell&&this._selectedCell.id==e.id&&this._selectedCell.columnId===e.columnId}isSelectable(e){if(!e)return!1;const t=this.store.getById(e.id||e);return t&&!(t.meta&&t.meta.specialRow)}get selectedCell(){return this._selectedCell}set selectedCell(e){this.selectCell(e)}get selectedRecord(){return this.recordCollection.last||null}set selectedRecord(e){this.selectRow(e)}get selectedRecords(){return this.recordCollection.values}set selectedRecords(e){const{recordCollection:t,store:n}=this,r=[];if(e&&e.length)for(let s of e)(s=n.getById(s))&&r.push(s);t.splice(0,t.count,r)}get selectedCellCSSSelector(){const e=this._selectedCell,t=e&&this.getRowById(e.id);return e&&t?`[data-index=${t.dataIndex}] [data-column-id=${e.columnId}]`:""}selectRow(e,t=!0,n=!1){const r=this.store.getById(e);r?this.selectCell({id:r.id},t,n):this.deselectAll()}selectCell(e,t=!1,n=!1,r=!1){const s=this,{recordCollection:i,selectionMode:o}=s,a=s.normalizeCellContext(e),l=a.record||s.store.getById(a.id);if(s.isSelectable(l)){if(t&&s.scrollRowIntoView(a.id,{column:a.columnId}),o.row&&(r&&(s.silent=(s.silent||0)+1),n?i.add(l):i.splice(0,i.count,l),r&&s.silent--,1===s.recordCollection.count&&(s.startCell=a,s.lastRange=null)),o.cell&&(a.columnId||a.column)&&!s.isSelected(a)){let e=s._selectedCell?[s._selectedCell]:[];s._selectedCell=a,s.triggerChangeEvent({mode:"cell",action:"select",selected:[a],deselected:e,selection:[a]},r)}return a}this.deselectAll()}deselectAll(){this.recordCollection.clear(),this._selectedCell&&this.deselectCell(this._selectedCell)}deselectRow(e){const t=e instanceof Sr?e:this.store.getById(e);t&&this.recordCollection.remove(t)}deselectCell(e){const t=this,n=t.normalizeCellContext(e),r=t.selectionMode,s=n.record||t.store.getById(n.id),i=t._selectedCell;return r.row&&t.recordCollection.remove(s),r.cell&&n.columnId&&i&&i.id===n.id&&i.columnId===n.columnId&&(t._selectedCell=null,t.triggerChangeEvent({mode:"cell",action:"deselect",selected:[],deselected:[n],selection:[]})),n}selectRange(e,t){const{store:n,recordCollection:r}=this,s=n.indexOf(e),i=n.indexOf(t),o=Math.min(s,i),a=Math.max(s,i);if(-1===o||-1===a)throw new Error("Record not found in selectRange");r.splice(0,r.count,n.getRange(o,a+1,!1))}onStoreRemove(e){super.onStoreRemove&&super.onStoreRemove(e),this.recordCollection.remove(e.records)}onStoreDataChange({action:e,source:t}){if(super.onStoreDataChange&&super.onStoreDataChange(...arguments),["dataset","batch"].includes(e)){const e=this.recordCollection,n=[];e.forEach(e=>{t.includes(e)||n.push(e)}),e.remove(n)}}onStoreRemoveAll(){super.onStoreRemoveAll&&super.onStoreRemoveAll(),this.deselectAll()}handleMouseMultiSelect(e,t){const n=this,r=e.id;(t.metaKey||t.ctrlKey)&&n.isSelected(r)?n.deselectRow(r):n.selectionMode.multiSelect&&(t.shiftKey&&n.startCell?function(e,t){const{store:r,recordCollection:s}=n,i=r.indexOf(e),o=r.indexOf(t),a=Math.min(i,o),l=Math.max(i,o);if(-1===a||-1===l)throw new Error("Record not found in selectRange");const c=r.getRange(a,l+1,!1).filter(e=>n.isSelectable(e));s.splice(0,n.lastRange||0,c),n.lastRange=c}(n.startCell.id,r):(t.ctrlKey||t.metaKey)&&n.selectRow(r,!1,!0))}onCellNavigate(e,t,n,r,s=!0){if(e.columns.getById(n.columnId)===e.checkboxColumn)return;if(!s||e.returningFocus||r&&r.target.classList.contains("b-tree-expander"))return;const i=r&&"mousedown"===r.type&&r.ctrlKey;!r||r.button&&2!==r.button||!r.shiftKey&&!i?e.selectCell(n,!1,t&&n.id===t.id&&(!r||r.shiftKey||r.ctrlKey)||r&&(i||2===r.button&&e.isSelected(n.id))):e.handleMouseMultiSelect(n,r),e.startCell&&!i||(e.startCell=n,e.lastRange=null)}triggerChangeEvent(e,t){const n=this,{mode:r,selected:s,deselected:i}=e;let o,a,l,c;if("row"===r){for(o=0,a=s.length;o<a;o++)(l=n.getRowFor(s[o]))&&(l.addCls("b-selected"),n.checkboxColumn&&!s[o].meta.specialRow&&(l.getCell(n.checkboxColumn.id).widget.checked=!0));for(o=0,a=i.length;o<a;o++)(l=n.getRowFor(i[o]))&&(l.removeCls("b-selected"),n.checkboxColumn&&!i[o].meta.specialRow&&(l.getCell(n.checkboxColumn.id).widget.checked=!1))}else if("cell"===r){for(o=0,a=s.length;o<a;o++)(c=n.getCell(s[o]))&&c.classList.add("b-selected");for(o=0,a=i.length;o<a;o++)(c=n.getCell(i[o]))&&c.classList.remove("b-selected")}t||n.trigger("selectionChange",e)}get widgetClass(){}}),Jo=e=>(class extends(e||W){getState(){const e=this,t=e.element.style.cssText,n={rowHeight:e.rowHeight,readOnly:e.readOnly};if(t&&(n.style=t),e.selectedCell){const{id:t,columnId:r}=e.selectedCell;n.selectedCell={id:t,columnId:r}}return n.selectedRecords=e.selectedRecords.map(e=>e.id),n.columns=e.columns.map(e=>e.getState()),n.store=e.store.state,n.scroll=e.storeScroll(),n.width={},n.collapsed={},e.eachSubGrid(e=>{null==e.flex&&(n.width[e.region]=e.width),n.collapsed[e.region]=e.collapsed}),n}applyState(e){const t=this;"readOnly"in e&&(t.readOnly=e.readOnly),"rowHeight"in e&&(t.rowHeight=e.rowHeight),"style"in e&&(t.style=e.style),"selectedCell"in e&&(t.selectedCell=e.selectedCell),"store"in e&&(t.store.state=e.store),"selectedRecords"in e&&(t.selectedRecords=e.selectedRecords),"columns"in e&&(e.columns.forEach(e=>{const n=t.columns.getById(e.id);n&&(n.applyState(e),n.stateSortIndex=e.index)}),t.eachSubGrid(e=>{e.columns.records.sort((e,t)=>e.stateSortIndex-t.stateSortIndex),e.columns.allRecords.sort((e,t)=>e.stateSortIndex-t.stateSortIndex)}),t.columns.sort({fn:(e,t)=>e.stateSortIndex-t.stateSortIndex},!0),t.rendered?t.renderContents():t.render()),"width"in e&&t.eachSubGrid(t=>{t.region in e.width&&(t.width=e.width[t.region])}),"collapsed"in e&&t.eachSubGrid(t=>{t.collapsed=e.collapsed[t.region]}),"scroll"in e&&t.restoreScroll(e.scroll)}get widgetClass(){}}),Qo=e=>(class extends(e||W){initSubGrids(){const e=this,t=e._regions,n=new Set;let r,s,i,o=!0;for(const a of e.columns.records)a.region&&!e.subGridConfigs[a.region]&&(e.subGridConfigs[a.region]={}),n.add(a.region);t&&t.forEach(t=>e.subGrids[t].destroy()),e.subGrids={},e._regions=Array.from(n),e._regions.sort(),e.subGridConfigs.normal&&0===Object.keys(e.subGridConfigs.normal).length&&(e.subGridConfigs.normal=oa.defaultConfig.subGridConfigs.normal);for(const a of e._regions)i=e.columns.makeChained(e=>0===e.childLevel&&e.region===a,["region"]),r=!1,(s=We.assign({},e.subGridConfigs[a],{owner:e,grid:e,store:e.store,rowManager:e.rowManager,region:a,headerClass:e.subGridConfigs[a].headerClass||e.headerClass,columns:i,hideHeaders:e.hideHeaders})).flex||s.width||(s.width=i.totalFixedWidth,r=!0),e.subGrids[a]=new jo(s),e.subGrids[a].hasCalculatedWidth=r,o&&(e.subGrids[a].isFirstRegion=!0,o=!1)}doDestroy(){this.callEachSubGrid("destroy"),super.doDestroy()}eachSubGrid(e,t=null){const n=this;n.regions.forEach((r,s)=>{const i=n.subGrids[r];e.call(t||i,i,s++)})}eachWidget(e,t=!0){const n=this;n.regions.forEach(r=>{const s=n.subGrids[r];!1!==e(s)&&t&&s.eachWidget&&s.eachWidget(e,t)})}callEachSubGrid(e,...t){let n=this,r=null;return n.regions.forEach((s,i)=>{const o=n.subGrids[s];if(o[e]){const n=o[e](...t);0===i&&(r=n)}}),r}getLastRegions(){const e=this.regions.slice(-2);return 2===e.length?e:[e[0],e[0]]}getNextRegion(e){const t=this.regions;return t[t.indexOf(e)+1]||t[t.length-2]}getPreviousRegion(e){return this.regions[this.regions.indexOf(e)-1]}getSubGrid(e){return this.subGrids[e]}getSubGridFromColumn(e){return e=e instanceof co?e:this.columns.get(e)||this.columns.getById(e),this.getSubGrid(e.region)}get regions(){return this._regions||this.initSubGrids(),this._regions}onSubGridCollapse(e){const t=this.resolveSplitter(e);t.classList.add("b-grid-splitter-collapsed"),t.style.width=`${e.collapsedStateWidth+e.splitterWidth}px`,t.style.left=`${Math.max(e.element.offsetLeft-e.splitterWidth,0)}px`}onSubGridExpand(e){const t=this.resolveSplitter(e);t.classList.remove("b-grid-splitter-collapsed"),t.style.width=""}resolveSplitter(e){const t=this.getLastRegions();let n=e instanceof jo?e.region:e;return t[1]===n&&(n=t[0]),this.subGrids[n].splitterElement}get widgetClass(){}});Fn.registerLayout(function(){class e extends Fn{static get defaultConfig(){return{containerCls:"b-fit-container",itemCls:"b-fit-item"}}}return e._$name="Fit",e}());const ea=function(){class e extends $n{static get defaultConfig(){return{positioned:!0,hidden:!0,layout:"fit",inputField:"textfield",blurAction:"complete",completeKey:"Enter",cancelKey:"Escape",allowInvalid:!1}}afterConfigure(){const e=this;super.afterConfigure(),(e.completeKey||e.cancelKey)&&Kt.on({element:e.element,keydown:"onKeyDown",thisObj:e}),he.on({locale:"onLocaleChange",thisObj:e})}onLocaleChange(){this.inputField&&this.inputField.syncInputFieldValue()}startEdit({target:e,align:t="t0-t0",matchSize:n=!0,value:r,record:s,field:i=this.inputField.name,focus:o=!0}){const a=this,{inputField:l}=a,c=e instanceof oe?e:oe.inner(e);return!1!==a.trigger("beforestart",{value:r})&&(s&&i&&void 0===r&&(a.record=s,a.dataField=i,r=s[i]),n&&(a.width=c.width,a.height=c.height),l.value=r,a.showBy({target:e,align:t}),o&&a.inputField.focus&&a.inputField.focus(),1===e.nodeType&&e.classList.add("b-editing"),a.trigger("start",{value:l.value}),a.oldValue=l.value,Array.isArray(a.oldValue)&&(a.oldValue=a.oldValue.slice()),!0)}refreshEdit(){if(this.isVisible){const{record:e,dataField:t,inputField:n}=this;if(e&&t){const r=e[t];We.isEqual(n.value,r)||(n.value=r)}}}onKeyDown(e){const t=this;switch(e.key){case t.completeKey:t.completeEdit(),e.stopImmediatePropagation();break;case t.cancelKey:t.cancelEdit(),e.stopImmediatePropagation()}t.trigger("keydown",{event:e})}onFocusOut(e){if(super.onFocusOut(e),!this.isFinishing){const e=this[`${this.blurAction}Edit`];e&&e.call(this)}}completeEdit(){const e=this,{inputField:t,oldValue:n}=e,{value:r}=t;if(!(t.isValid||e.allowInvalid||t.allowInvalid))return t.focus&&t.focus(),!1;if(We.isEqual(r,n))return e.cancelEdit(),!0;{const s={value:r,oldValue:n};if(!1!==e.trigger("beforecomplete",s))return s.async?(s.async.then(n=>{!0===n?e.onEditComplete():(t.setError(n||t.L("invalidValue")),e.allowInvalid||t.allowInvalid||t.focus&&t.focus())}),!1):(e.onEditComplete(),!0);t.focus&&t.focus()}return!1}cancelEdit(){const e=this,{inputField:t,oldValue:n}=e,{value:r}=t;e.isFinishing||!1===e.trigger("beforecancel",{value:r,oldValue:n})||(e.isFinishing=!0,e.hide(),e.trigger("cancel",{value:r,oldValue:n}),e.isFinishing=!1)}onEditComplete(){const e=this,{record:t,dataField:n,inputField:r,oldValue:s,lastAlignSpec:i}=e,{target:o}=i,{value:a}=r;if(!e.isFinishing){if(e.isFinishing=!0,e.hide(),t){const e=`set${$.capitalizeFirstLetter(n)}`;t[e]?t[e](a):t[n]=a}e.trigger("complete",{value:a,oldValue:s}),1===o.nodeType&&o.classList.remove("b-editing"),e.isFinishing=!1}}doDestroy(){this.createdInputField&&this.inputField.destroy(),super.doDestroy()}set owner(e){this._owner=e}get owner(){return this._owner||k.fromElement(this.element.parentNode)}get items(){return this._items=[this.inputField]}set inputField(e){const t=this;t._inputField&&t._inputField.destroy(),"string"==typeof e&&(e={type:e}),e instanceof An?t._inputField=e:(t._inputField=I.createWidget(e),t.createdInputField=!0),t._inputField.parent=t}get inputField(){return this._inputField}}return e._$name="Editor",e}();E.register("editor",ea);const ta={Enter:1,F2:1},na={ArrowUp:1,ArrowDown:1,ArrowLeft:1,ArrowRight:1},ra=function(){class e extends(U(ur)){static get defaultConfig(){return{autoSelect:!0,blurAction:"complete",addNewAtEnd:null,autoEdit:!1,editorClass:ea}}static get pluginConfig(){return{assign:["startEditing"],before:["onElementKeyDown","onElementMouseDown"],chain:["onElementClick"]}}construct(e,t){const n=this;n.grid=e,super.construct(e,t),n.storeListenerDetacher=e.store.on({update:"onStoreUpdate",thisObj:n}),n.listenerDetacher=e.on({cellclick:"onCellClick",celldblclick:"onCellDblClick",beforerenderrows:"onGridBeforeRenderRows",thisObj:n})}doDestroy(){this.cancelEditing(!0),this.listenerDetacher(),this.storeListenerDetacher(),super.doDestroy()}get isEditing(){return Boolean(this.editorContext)}getEditorForCell({column:e,selector:t}){const n=this,r=n.grid;let s=e._cellEditor;s||(e.editor.autoSelect=n.autoSelect,s=e._cellEditor=new n.editorClass({cls:"b-cell-editor",inputField:e.editor,blurAction:"none",completeKey:!1,cancelKey:!1,owner:r,listeners:n.getEditorListeners()}),e.instantUpdate&&We.wrapProperty(e.editor,"value",null,e=>{n.editorContext&&!We.isEqual(n.editorContext.record[n.editorContext.column.field],e)&&(n.editorContext.record[n.editorContext.column.field]=e)}));const i=s.element.dataset;return i.rowId=t.id,i.columnId=t.columnId,i.field=e.field,n.editor=s}getEditorListeners(){return{focusout:"onEditorFocusOut",focusin:"onEditorFocusIn",start:"onEditorStart",beforecomplete:"onEditorBeforeComplete",complete:"onEditorComplete",cancel:"onEditorCancel",thisObj:this}}onEditorStart({source:e}){const t=this,n=t.editorContext=e.cellEditorContext;if(n){const{grid:e}=t,{cell:r,editor:s,column:i}=n;if(i.editTargetSelector){const e=r.querySelector(i.editTargetSelector);e&&(s.width-=e.offsetLeft,yt.addTranslateX(s.element,e.offsetLeft))}r.classList.add("b-editing"),t.grid.on({cellclick:"onCellClickWhileEditing",viewportResize:"onViewportResizeWhileEditing"},t),t.removeEditingListeners=Cn.addListener({globaltap:"onTapOut",thisObj:t}),e.trigger("startCellEdit",{grid:e,editorContext:n})}}onEditorBeforeComplete(e){const{grid:t}=this,n=e.source.cellEditorContext;return e.grid=t,e.editorContext=n,t.trigger("beforeFinishCellEdit",e)}onEditorComplete({source:e}){const{grid:t}=this,n=e.cellEditorContext;n.value=e.inputField.value,t.trigger("finishCellEdit",{grid:t,editorContext:n}),this.cleanupAfterEdit(n)}onEditorCancel(){const{editorContext:e,muteEvents:t,grid:n}=this;e&&this.cleanupAfterEdit(e),t||n.trigger("cancelCellEdit",{grid:n})}cleanupAfterEdit(e){const{editor:t}=e;e.cell.classList.remove("b-editing"),t.cellEditorContext=this.editorContext=null,this.grid.un({cellclick:"onCellClickWhileEditing",viewportResize:"onViewportResizeWhileEditing"},this),this.removeEditingListeners(),Cn.suspendFocusEvents(),t.element.remove(),Cn.resumeFocusEvents()}getAdjacentEditableCell(e,t){let n=this.addNewAtEnd,r=this.grid,s=r.store,i=r.rowManager,o=e.id,a=e.columnId,l=r.columns,c=l.getAdjacentLeaf(a,t);for(;o;){const r=s.getById(o);if(c){if(a=c.id,!c.hidden&&c.editor&&c.canEdit(r))return{id:o,columnId:c.id};c=l.getAdjacentLeaf(a,t)}else{let r=s.getAdjacent(e.id,t,!1,!0);!r&&t&&n&&(r=s.add("object"==typeof n?We.clone(n):{})[0],i.getRowFor(r)||i.displayRecordAtBottom()),o=r&&r.id,r&&(c=t?l.first:l.leaves[l.leaves.length-1])}}return null}getEditingContext(e){e=this.grid.normalizeCellContext(e);const{grid:t}=this,n=t.columns.getById(e.columnId),r=t.store.getById(e.id),s=t.getCell(e);if(s&&n&&!n.hidden&&n.editor&&r&&!r.meta.specialRow&&n.canEdit(r)){const t=r&&r[n.field];return{column:n,record:r,cell:s,value:void 0===t?null:t,selector:e}}return!1}startEditing(e={}){const t=this;if(!(t.editorContext||t.disabled||t.grid.readOnly||t.grid.disabled)){const{grid:n}=t,r=n.normalizeCellContext(e);n.focusCell(e);const s=t.getEditingContext(r);if(!1===n.trigger("beforeCellEditStart",{grid:n,editorContext:s}))return!1;if(s){yt.focusWithoutScrolling(n.element);const e=s.editor=t.getEditorForCell(s),{cell:r,record:i,column:o}=s;return e.inputField.highlightExternalChange=!1,e.cellEditorContext=s,e.render(t.grid.getSubGridFromColumn(o).element),e.startEdit({target:r,record:i}),!0}}return!1}cancelEditing(e=!1){const t=this,{editorContext:n,editor:r,grid:s}=t;n&&(r.containsFocus&&(t.editorContext=null,r.inputField.owns(yt.activeElement)&&s.focus(),t.editorContext=n),t.muteEvents=e,r.cancelEdit(),t.muteEvents=!1)}finishEditing(){const{editorContext:e}=this;return!!e&&e.editor.completeEdit()}onCellClickWhileEditing({event:e,cellSelector:t}){const n=this;n.editorContext.editor.owns(e.target)||(n.getEditingContext(t)?n.finishEditing()?n.startEditing(t):(n.grid.focusCell(n.editorContext.selector),n.editor.inputField.focus()):n.finishEditing())}onViewportResizeWhileEditing(){const{editor:e,column:t}=this.editorContext;e.width=t.element.offsetWidth}onCellClick({source:e,record:t,cellSelector:n,cellElement:r,target:s,event:i}){const o=e.focusedCell||{},a=e.columns.getById(n.columnId);if(a.onCellClick)a.onCellClick({grid:e,column:a,record:t,cellSelector:n,cellElement:r,target:s,event:i});else{if(s.matches(".b-tree-expander"))return this.cancelEditing(),!1;yt.isTouchEvent&&n.id==o.id&&n.columnId==o.columnId&&this.startEditing(n)}}onCellDblClick({cellSelector:e}){this.editorContext&&!this.finishEditing()||this.startEditing(e)}onStoreUpdate({changes:e,record:t}){const{editorContext:n}=this;n&&n.editor.isVisible&&t===n.record&&n.editor.dataField in e&&n.editor.refreshEdit()}onGridBeforeRenderRows(){this.editorContext&&this.editorContext.editor.isVisible&&this.cancelEditing()}onElementKeyDown(e){const t=this;if(!e.handled)if(t.editorContext){if("Enter"===e.key&&(e.preventDefault(),e.stopPropagation(),t.finishEditing()&&!t.isEditing)){if(e.ctrlKey||e.metaKey||e.altKey||t.grid.touch)return;e.shiftKey?t.grid.navigateUp()&&t.startEditing(t.grid.focusedCell):t.grid.navigateDown()&&t.startEditing(t.grid.focusedCell)}if("F2"===e.key&&(e.preventDefault(),t.finishEditing()),"Escape"===e.key&&(e.stopPropagation(),e.preventDefault(),t.cancelEditing()),"Tab"===e.key){e.preventDefault();let n=t.grid.focusedCell;if(n){let r=t.getAdjacentEditableCell(n,!e.shiftKey);r&&t.finishEditing()&&(t.grid.focusCell(r,{animate:100}),t.startEditing(r))}}na[e.key]&&(e.handled=!0)}else{const n=e.key,r=t.autoEdit&&(1===n.length||"Backspace"===n);if((r||ta[n])&&t.grid.focusedCell){if(e.preventDefault(),!t.startEditing(t.grid.focusedCell))return;const s=t.editor.inputField,i=s.input;r&&i&&(i.value="Backspace"===n?"":n,s.internalOnInput(e),s.moveCaretToEnd())}}}onElementMouseDown(e){2===e.button&&this.editorContext&&e.preventDefault()}onEditorFocusOut(e){const t=this,{grid:n}=t;t.editorContext&&!t.editor.isFinishing&&t.editor.inputField.owns(e.target)&&(e.toWidget!==n||n.isLocationEqual(t.grid.focusedCell,t.editorContext.selector))&&("cancel"===t.blurAction?t.cancelEditing():t.finishEditing())}onEditorFocusIn(e){const t=e.toWidget;t===this.editor.inputField&&this.autoSelect&&t.selectAll&&!t.readOnly&&!t.disabled&&t.selectAll()}onTapOut({event:e}){const t=this;t.grid.bodyContainer.contains(e.target)||t.editor.inputField.owns(e.target)||("cancel"===t.blurAction?t.cancelEditing():t.finishEditing())}onElementClick(e){e.target.classList.contains("b-grid-body-container")&&this.editorContext&&this.finishEditing()}}return e.featureClass="b-cell-edit",e._$name="CellEdit",e}();To.registerFeature(ra,!0);const sa=new Promise(e=>e()),ia={block:"nearest",inline:"nearest"},oa=function(){class e extends(Dr(An).mixes(hr,gr,Wo,Go,qo,Xo,Zo,Jo,Qo)){static get defaultConfig(){return{rowHeight:null,defaultRowHeight:45,emptyText:this.L("noRows"),fullRowRefresh:!0,readOnly:null,hideHeaders:null,showRemoveRowInContextMenu:!0,autoHeight:null,store:{},data:null,columns:[],defaultRegion:"normal",destroyStore:null,selectionMode:{row:!0,cell:!0,multiSelect:!0,checkbox:!1},enableTextSelection:null,loadMask:this.L("loadMask"),columnLines:!0,fillLastColumn:!0,resizeToFitIncludesHeader:!0,animateRemovingRows:!G.isIE11,disableGridRowModelWarning:null,loadMaskErrorIcon:"b-icon b-icon-warning",headerClass:Lo,testPerformance:!1,positionMode:"translate",rowScrollMode:"move",monitorResize:!0,features:!0,subGridConfigs:{normal:{flex:1}},scrollable:{overflowY:!0},scrollerClass:Bo,showDirty:null,loadMaskHideTimeout:3e3,refreshSuspended:0,transitionDuration:500,contextMenuTriggerEvent:"contextmenu"}}static getLKey(){return"%LICENSE%"}static get properties(){return{_selectedRecords:[],_verticalScrollHeight:0,virtualScrollHeight:0,_scrollTop:null}}finishConfigure(e){const t=this;super.finishConfigure(e),t.scrollManager=new Oo({grid:t,verticalElement:t.scrollable.element}),he.on({locale:"onBeforeLocaleChange",prio:1,thisObj:t}),he.on({locale:"onLocaleChange",prio:-1,thisObj:t}),Cn.on({theme:"onThemeChange",thisObj:t}),t._thisIsAUsedExpression(t.regions),t.setGridClassList(t.element.classList)}onBeforeLocaleChange(){this._suspendRenderContentsOnColumnsChanged=!0}onLocaleChange(){this._suspendRenderContentsOnColumnsChanged=!1,this.rendered?this.renderContents():this.render()}finalizeInit(){super.finalizeInit(),this.store.isLoading&&this.onStoreLoadStart()}doDestroy(){const e=this;e.storeDetacher&&e.storeDetacher();for(let t of Object.values(e.features))t.destroy&&t.destroy();e.columns&&(e.columns=null),e.store&&(e.store=null),super.doDestroy()}setGridClassList(e){const t=this;e.add(`b-grid-${t.positionMode}`),t.enableTextSelection||e.add("b-grid-notextselection"),t.autoHeight&&e.add("b-autoheight"),t.readOnly&&e.add("b-readonly"),t.fillLastColumn&&e.add("b-fill-last-column"),t.showDirty&&e.add("b-show-dirty");for(let n in t.features){let r,s=t.features[n];(r=s.constructor.hasOwnProperty("featureClass")?s.constructor.featureClass:`b-${s instanceof W?s.$name:s.constructor.name}`)&&e.add(r.toLowerCase())}}template(e){const t=G.isFirefox?`height:${yt.scrollBarWidth}px`:"";return this._thisIsAUsedExpression(e.regions),Gn.tpl`
            <div tabindex="-1">
                <header reference="headerContainer" class="b-grid-header-container ${this.hideHeaders?"b-hidden":""}"></header>
                <div reference="bodyContainer" class="b-grid-body-container">
                    <div reference="verticalScroller" class="b-grid-vertical-scroller"></div>
                </div>
                <div reference="virtualScrollers" class="b-virtual-scrollers ${yt.scrollBarWidth?"":"b-overlay-scrollbar"}" style="${t}"></div>
                <footer reference="footerContainer" class="b-grid-footer-container b-hidden"></footer>
            </div>
        `}get overflowElement(){return this.bodyContainer}get focusElement(){return this.element}set columns(e){const t=this;t._columnStore?e?t._columnStore.data=e:t._columnStore.destroy():(e instanceof uo?(e.grid||(e.grid=t),t._columnStore=e):Array.isArray(e)?t._columnStore=new uo({grid:t,data:e}):e&&(t._columnStore=new uo(Object.assign({grid:t},e))),t._columnStore.on("change",t.onColumnsChanged,t),t._columnStore.on(ho(t.onColumnsResized,t)),G.isTouchDevice&&(t.touch=!0,t._columnStore.forEach(e=>{const t=e.touchConfig;t&&e.applyState(t)})))}get columns(){return this._columnStore}onColumnsChanged({action:e,changes:t,record:n}){const r=this;if("update"===e){if("width"in t||"minWidth"in t||"flex"in t){if(r.rendered){const e=n.region;r.columns.visibleColumns.forEach(t=>{t.region===e&&t.repaintOnResize&&r.refreshColumn(t)})}return}if("hidden"in t){const e=r.getSubGridFromColumn(n.id);e.header.fixHeaderWidths(),e.footer&&e.footer.fixFooterWidths(),e.updateHasFlex()}}("dataset"===e||t&&"region"in t&&!r.regions.includes(t.region.value))&&(r.initSubGrids(),r.eachSubGrid(e=>{e.render(r.verticalScroller),e.initScroll()})),r._suspendRenderContentsOnColumnsChanged||r.renderContents()}onColumnsResized({changes:e,record:t}){const n=this,r=e.width&&null==t.flex,s=e.minWidth&&null==t.flex,i=e.flex&&null==t.width,o=yt.setLength(t.width),a=yt.setLength(t.minWidth),l=n.getSubGridFromColumn(t.id);l.header.fixHeaderWidths(),l.footer&&l.footer.fixFooterWidths(),l.updateHasFlex(),n.cellEls&&t===n.lastColumnResized||(n.cellEls=yt.children(n.element,`.b-grid-cell[data-column-id=${t.id}]`),n.lastColumnResized=t);for(let c of n.cellEls)r?(c.style.width=o,c.style.flex="",G.isIE11&&(c.style.minWidth=o)):s?c.style.minWidth=a:i?(c.style.flex=t.flex,c.style.width=""):c.style.flex=c.style.width=c.style.minWidth="";n.dragResizing||n.afterColumnsResized()}afterColumnsResized(){this.refreshVirtualScrollbars(),this.eachSubGrid(e=>{e.collapsed||(e.fixWidths(),e.fixRowWidthsInSafariEdge(),e.refreshFakeScroll())}),this.lastColumnResized=this.cellEls=null}get rowManager(){const e=this;return e._isRowMeasured||e.measureRowHeight(),e._rowManager||(e._rowManager=new No({grid:e,rowHeight:e.rowHeight,rowScrollMode:e.rowScrollMode||"move",autoHeight:e.autoHeight,listeners:{changetotalheight:e.onRowManagerChangeTotalHeight,requestscrollchange:e.onRowManagerRequestScrollChange,thisObj:e}}))}showEmptyText(){this.bodyContainer&&this.bodyContainer.classList[this.rowManager.rowCount||this.store.isLoading?"remove":"add"]("b-grid-empty")}bindStore(e){const t=this;t.storeDetacher=e.on({refresh:t.onStoreDataChange,update:t.onStoreUpdateRecord,add:t.onStoreAdd,remove:t.onStoreRemove,move:t.onStoreMove,replace:t.onStoreReplace,removeall:t.onStoreRemoveAll,loadstart:t.onStoreLoadStart,afterrequest:t.onStoreAfterRequest,clearchanges:t.onStoreDataChange,exception:t.onStoreException},t)}get store(){return this._store}set store(e){const t=this,n=t.initialConfig.features;if(e!==t._store)if(t.storeDetacher&&(t.storeDetacher(),t.storeDetacher=null),e){if(e instanceof Nr);else{const r={};t.data&&(r.data=t.data),n&&n.tree&&(r.tree=!0),e.modelClass||(r.modelClass=class extends So{}),e=new(e.readUrl?ps:Nr)(Object.assign(r,e))}t._store=e,t.bindStore(e)}else t.destroyStore&&t._store.destroy(),t._store=null}onStoreUpdateRecord({source:e,record:t,data:n}){const r=this;if(r.forceFullRefresh)r.rowManager.refresh(),r.forceFullRefresh=!1;else{let s;if(t.isFieldModified("id")&&(s=r.getRowFor(t.meta.modified.id)),!(s=s||r.getRowFor(t)))return;if(r.fullRowRefresh||t.meta.specialRow){const n=e.indexOf(t);-1!==n&&s.render(n,t)}else Object.keys(n).forEach(e=>{let n=s.getCell(e);n&&s.renderCell(n,t)})}}refreshFromRowOnStoreAdd(e,t){const{rowManager:n}=this;n.renderFromRow(e),n.trigger("changeTotalHeight",{totalHeight:n.totalHeight}),1===this.store.count&&this.callEachSubGrid("refreshFakeScroll")}onStoreAdd({source:e,records:t,index:n,oldIndex:r,isChild:s,oldParent:i,isMove:o}){if(!this.rendered)return;if(s&&!t[0].ancestorsExpanded(e))return;this.rowManager.calculateRowCount(!1,!0,!0);const{rowManager:a}=this,{topIndex:l,rows:c,rowCount:d}=a,u=a.topIndex+a.rowCount-1,h=n,g=n+t.length-1,m=u>=e.count-t.length-1;i||r>-1||s&&o?a.refresh():h>=l&&h<l+d?this.refreshFromRowOnStoreAdd(c[h-l],...arguments):g>=l&&g<l+d?a.refresh():(m&&n>u&&a.fillBelow(this._scrollTop),a.trigger("changeTotalHeight",{totalHeight:a.totalHeight}))}onStoreException(e){const t=this;let n;switch(e.type){case"server":n=e.response.message||"Unspecified failure";break;case"exception":n="network"===e.exceptionType?"Network error":e.error&&e.error.message||"Failed to parse server response";break;default:n=e.response.status+" - "+e.response.statusText||"Unknown error"}const r=`<div class="b-grid-load-failure">\n                <div class="b-grid-load-fail">${t.L("loadFailedMessage")}</div>\n                <div class="b-grid-load-fail">${e.response.url?e.response.url+" responded with":""}</div>\n                <div class="b-grid-load-fail">${n}</div>\n            </div>`;t.activeMask&&(t.activeMask.icon=t.loadMaskErrorIcon,t.activeMask.text=r,t.loadmaskHideTimer=t.setTimeout(()=>{t.unmaskBody()},t.loadMaskHideTimeout))}onStoreDataChange({action:e,changes:t,source:n}){super.onStoreDataChange&&super.onStoreDataChange(...arguments);const r=this,s=n.isGrouped&&t&&r.groupers.find(e=>e.field in t);"dataset"===e&&(r.rowManager.averageRowHeight=null),r.rendered&&!s&&r.renderRows(null,"dataset"===e||"filter"===e),r.showEmptyText()}onStoreLoadStart(){this.loadMask&&this.maskBody(this.loadMask)}onStoreAfterRequest(e){this.activeMask&&!e.exception&&this.unmaskBody()}onStoreRemove({records:e,isCollapse:t,isChild:n,isMove:r}){if(!this.rendered||r)return;super.onStoreRemove&&super.onStoreRemove(...arguments);let s=2**53-1;const i=this,{rowManager:o}=this,a=e.reduce((e,t)=>{const n=o.getRowById(t.id);return n&&(e.push(n),s=Math.min(s,o.rows.indexOf(n))),e},[]);if(i.animateRemovingRows&&a.length&&!t&&!n){const e=a[0];i.isAnimating=!0,Kt.on({element:e._elementsArray[0],transitionend:e=>{i.isAnimating=!1,"background-color"!==e.propertyName&&"width"!==e.propertyName&&(a.forEach(e=>e.removeCls("b-removing")),o.refresh(),i.trigger("rowRemove"))},once:!0}),a.forEach(e=>e.addCls("b-removing"))}else o.calculateRowCount(!1,!0,!0),o.rows[s]?o.renderFromRow(o.rows[s]):o.trigger("changeTotalHeight",{totalHeight:o.totalHeight}),i.trigger("rowRemove",{isCollapse:t})}onStoreMove({from:e,to:t}){const{rowManager:n}=this,{topIndex:r,rowCount:s}=n,[i,o]=[e,t].sort();i>=r&&i<r+s?n.renderFromRow(n.rows[i-r]):o>=r&&o<r+s&&n.refresh()}onStoreReplace({records:e,all:t}){if(t)this.rowManager.refresh();else{const t=e.reduce((e,[,t])=>{const n=this.getRowFor(t);return n&&e.push(n),e},[]);this.rowManager.renderRows(t)}}onStoreRemoveAll(){super.onStoreRemoveAll&&super.onStoreRemoveAll(...arguments),this.rendered&&(this.renderRows(),this.showEmptyText())}get data(){return this._store?this._store.records:this._data}set data(e){this._store?this._store.data=e:this._data=e}get emptyText(){return this._emptyText}set emptyText(e){this._emptyText=e,this.eachSubGrid(t=>t.emptyText=e)}getHeaderMenuItems(e,t){const n=this,{subGrids:r,regions:s}=n;let i=!0;Object.entries(r).forEach(([o,a])=>{if(!a.sealedColumns&&e.draggable&&o!==e.region&&(!e.parent&&r[e.region].columns.count>1||e.parent&&e.parent.children.length>1)){const l=a.element.compareDocumentPosition(r[e.region].element)===document.DOCUMENT_POSITION_PRECEDING,c=s.length>2?n.L("Move column to ")+o:n.L(l?"moveColumnRight":"moveColumnLeft");t.push({targetSubGrid:o,text:c,icon:"b-fw-icon "+(l?"b-icon-column-move-right":"b-icon-column-move-left"),name:"moveColumn",cls:i?"b-separator":"",onItem:({item:e})=>{const{column:t}=e;t.traverse(e=>e.region=o),n.columns.insert(n.columns.indexOf(r[e.targetSubGrid].columns.last)+1,t),n.scrollColumnIntoView(t)}}),i=!1}})}getCellMenuItems(e,t,n){const r=this;r.showRemoveRowInContextMenu&&!r.readOnly&&t&&!t.meta.specialRow&&n.push(r.selectedRecords.length>1?{text:r.L("removeRows"),icon:"b-fw-icon b-icon-trash",name:"removeRows",onItem:()=>r.store.remove(r.selectedRecords)}:{text:r.L("removeRow"),icon:"b-fw-icon b-icon-trash",name:"removeRow",onItem:()=>r.store.remove(t)})}getColumnDragToolbarItems(e,t){return t}normalizeCellContext(e){const{columns:t,store:n}=this;if(e instanceof n.modelClass)return{record:e,id:e.id,columnId:t.bottomColumns[0].id};if(!("columnId"in e)){if("field"in e){const n=t.get(e.field);e.columnId=n&&n.id}else if("column"in e){const n="number"==typeof e.column?t.bottomColumns[e.column]:e.column;e.columnId=n&&n.id}"columnId"in e||(e.columnId=t.bottomColumns[0].id)}if("id"in e){if(e.element&&!n.getById(e.id)){const t=this.getRecordFromElement(e.element);t&&(e.id=t.id)}}else"row"in e?e.id=n.getAt(e.row).id:"record"in e&&(e.id=e.record.id);return e}getCell(e){let t,n=null;return(e=this.normalizeCellContext(e)).id&&(t=this.getRowById(e.id)),t&&e.columnId&&(n=t.getCell(e.columnId)),n}getHeaderElement(e){return"string"!=typeof e&&(e=e.id),this.fromCache(`.b-grid-header[data-column-id="${e}"]`)}getHeaderElementByField(e){const t=this.columns.get(e);return t?this.getHeaderElement(t):null}get bodyHeight(){return this._bodyHeight}get headerHeight(){const e=this;return e.rendered&&!e._headerHeight&&(e._headerHeight=e.headerContainer.offsetHeight),e._headerHeight}getRecordFromElement(e){const t=e.closest(".b-grid-row");return t?this.store.getAt(t.dataset.index):null}getColumnFromElement(e){const t=yt.up(e,".b-grid-cell, .b-grid-header");if(!t)return null;if(t.matches(".b-grid-header"))return this.columns.getById(t.dataset.columnId);const n=fs.get(t);return this.columns.getById(n.columnId)}get autoHeight(){return this._autoHeight}set autoHeight(e){We.assertBoolean(e,"autoHeight"),this._autoHeight=e}get columnLines(){return this._columnLines}set columnLines(e){We.assertBoolean(e,"columnLines"),yt.toggleClasses(this.element,"b-no-column-lines",!e),this._columnLines=e}set readOnly(e){const t=this;t._readOnly=e,t.rendered&&(t.trigger("readOnly",{readOnly:e}),e?t.element.classList.add("b-readonly"):t.element.classList.remove("b-readonly"))}get readOnly(){return this._readOnly}fixSizes(){this.callEachSubGrid("fixWidths")}onRowManagerChangeTotalHeight({totalHeight:e}){this.refreshTotalHeight(e)}refreshTotalHeight(e=this.rowManager.totalHeight){if(this.renderingRows)return;this.rowManager.bottomRow&&(e=Math.max(e,this.rowManager.bottomRow.bottom));const t=this,n=t.scrollable,r=Math.abs(t.virtualScrollHeight-e),s=t._bodyRectangle.height;if(r){const r=e-s-t._scrollTop<2*s||t._verticalScrollHeight&&t._verticalScrollHeight-s<t._scrollTop;n.scrollHeight=t.virtualScrollHeight=e,t.scrolling&&!r?t.virtualScrollHeightDirty||(t.virtualScrollHeightDirty=n.on({scrollend:t.fixElementHeights,thisObj:t,once:!0})):(t.virtualScrollHeightDirty&&t.virtualScrollHeightDirty(),t.fixElementHeights(e))}}fixElementHeights(){const e=this,t=e.virtualScrollHeight,n=`${t}px`;e._verticalScrollHeight=t,e.verticalScroller.style.height=n,e.virtualScrollHeightDirty=!1,e.autoHeight&&(e.bodyContainer.style.height=n,e._bodyHeight=t,e._bodyRectangle=oe.client(e.bodyContainer)),e.refreshVirtualScrollbars()}set scrolling(e){this._scrolling=e,this.bodyContainer.classList[e?"add":"remove"]("b-scrolling")}get scrolling(){return this._scrolling}onRowManagerRequestScrollChange({bottom:e}){this.scrollable.y=e-this.bodyHeight}initScroll(){const e=this;if(!e.scrollInitialized){let t,n=e.createOnFrame(()=>{(t=e.scrollable.y)!==e._scrollTop&&(e._scrollTop=t,e.scrolling||(e.scrolling=!0,e.eachSubGrid(e=>e.suspendResizeMonitor=!0)),e.rowManager.updateRenderedRows(t),e.trigger("scroll",{scrollTop:t}))});e.scrollInitialized=!0,e.scrollable.on({scroll:n,scrollend(){e.scrolling=!1,e.eachSubGrid(e=>e.suspendResizeMonitor=!1)}}),e.callEachSubGrid("initScroll")}}scrollRowIntoView(e,t=ia){const n=this,r=t.block||"nearest",s=n.rowManager;if(e=n.store.getById(e)){if(-1===n.store.indexOf(e))return sa;let i=n.scrollable,o=n.getRecordCoords(e);const a=oe.from(i.element);if(o.virtual){const l=o.block;if(i.scrollIntoView(o,{block:"center"}),s.scrollTargetRecordId=e,s.updateRenderedRows(i.y,!0),o=n.getRecordCoords(e),s.lastScrollTop=i.y,o.virtual)return sa;const c="nearest"!==r?t:{block:l};if(t.animate){i.suspendEvents(),"end"===r||"nearest"===r&&"end"===l?i.y-=a.bottom-o.bottom:("start"===r||"nearest"===r&&"start"===l)&&(i.y+=o.y-a.y),s.updateRenderedRows(i.y,!1,!0),"end"===l?i.y-=s.appendRowBuffer*s.rowHeight-1:i.y+=s.prependRowBuffer*s.rowHeight-1;const d=i.scrollIntoView(n.getRecordCoords(e),Object.assign({},t,c));return d.then(()=>i.resumeEvents()),d}return n.scrollRowIntoView(e,Object.assign({},t,c))}{let{column:r}=t;if(r&&("string"==typeof r&&(r=n.columns.getById(r)||n.columns.get(r)),r)){i=n.getSubGridFromColumn(r).scrollable;const t=oe.from(s.getRowFor(e).getCell(r.id));o.x=t.x,o.width=t.width}return i.scrollIntoView(o,t)}}}scrollColumnIntoView(e,t){return e=e instanceof co?e:this.columns.get(e)||this.columns.getById(e)||this.columns.getAt(e),this.getSubGridFromColumn(e).scrollColumnIntoView(e,t)}scrollCellIntoView(e,t){return this.scrollRowIntoView(e.id,Object.assign({column:e.columnId},t))}scrollToBottom(e){return this.scrollRowIntoView(this.store.last,e)}scrollToTop(e){return this.scrollable.scrollBy(0,-this.scrollable.y,e)}storeScroll(){const e=this.storedScrollState={scrollTop:this.scrollable.y,scrollLeft:{}};return this.eachSubGrid(t=>{e.scrollLeft[t.region]=t.scrollable.x}),e}restoreScroll(e=this.storedScrollState){this.eachSubGrid(t=>{t.scrollable.x=e.scrollLeft[t.region]}),this.scrollable.y=e.scrollTop}measureRowHeight(){const e=this,t=yt.createElement({tag:"div",className:"b-grid "+(e.features.stripe?"b-stripe":""),style:"position: absolute; visibility: hidden",html:'<div class="b-grid-subgrid"><div class="b-grid-row"></div></div>',parent:document.getElementById(e.appendTo)||document.body}),n=t.firstElementChild.firstElementChild,r=parseInt(yt.getStyleValue(n,"height")),s=parseInt(yt.getStyleValue(n,"border-top-width")),i=parseInt(yt.getStyleValue(n,"border-bottom-width"));null!=e.rowHeight&&e.rowHeight!==e._rowHeightFromStyle||(e.rowHeight=!isNaN(r)&&r?r:e.defaultRowHeight,e._rowHeightFromStyle=e.rowHeight),e._rowBorderHeight=s+i,e._isRowMeasured=!0,t.remove()}onThemeChange({theme:e}){this.measureRowHeight(),this.trigger("theme",{theme:e})}refreshRows(e=!1){this.element.classList.add("b-notransition"),e?this.rowManager.returnToTop():this.rowManager.refresh(),this.element.classList.remove("b-notransition")}refreshColumn(e){const t=e.field;this.rowManager.forEach(e=>{const n=e.getCell(t);e.renderCell(n)})}refreshVirtualScrollbars(){const{scrollBarWidth:e}=yt;if(e){const t=this,{headerContainer:n,footerContainer:r,virtualScrollers:s}=t,i=t.virtualScrollHeight>t.bodyHeight;Object.values(t.subGrids).some(e=>e.overflowingHorizontally)?s.classList.remove("b-hide-display"):s.classList.add("b-hide-display"),i?n.classList.contains("b-grid-vertical-overflow")||n.classList.add("b-grid-vertical-overflow"):n.classList.remove("b-grid-vertical-overflow");const o=n.querySelector(".b-grid-header-scroller:last-child");if(o&&i){const s=parseInt(yt.getStyleValue(o,"border-right-width"));n.style.paddingRight=e-s+(t.regions.length>2?1:0)+"px",r.style.paddingRight=`${e}px`}else n.style.paddingRight="0",r.style.paddingRight="0"}}onContentChange(){const e=this,t=e.rowManager;if(e.isVisible){const n=Math.max(t.totalHeight,t.bottomRow?t.bottomRow.bottom:0);e.paintListener=null,e._bodyRectangle=oe.client(e.bodyContainer),e._bodyHeight=e.autoHeight?n:e._bodyRectangle.height,e.refreshTotalHeight(n),e.callEachSubGrid("refreshFakeScroll")}else e.paintListener||(e.paintListener=e.on({paint:"onContentChange",once:!0,thisObj:e}))}renderHeader(e,t){}renderFooter(e,t){}suspendRefresh(){this.refreshSuspended++}resumeRefresh(e){this.refreshSuspended&&!--this.refreshSuspended&&e&&this.refreshRows()}renderRows(e=!0,t=!1){const n=this,r=e&&n.storeScroll();n.refreshSuspended||(n.trigger("beforeRenderRows"),n.renderingRows=!0,n.element.classList.add("b-grid-refreshing"),n.callEachSubGrid("clearRows"),t&&(n.scrollable.y=n._scrollTop=0),n.rowManager.reinitialize(t),n.renderingRows=!1,n.onContentChange(),e&&n.restoreScroll(r),n.element.classList.remove("b-grid-refreshing"))}renderContents(){const e=this,t=e.appendTo,n=e.headerContainer,r=e.footerContainer;e.emptyCache(),e.rendered&&(e._headerHeight=null,e.callEachSubGrid("refreshHeader",n),e.callEachSubGrid("refreshFooter",r),e.renderHeader(n,t),e.renderFooter(r,t),e.fixSizes(),e.renderRows(!1))}onPaint(){const e=this,{element:t,headerContainer:n,bodyContainer:r,footerContainer:s}=e;if(e.rendered)return;e.updateResponsive(e.width,0);let i=0;e._bodyRectangle=oe.client(e.bodyContainer),e.eachSubGrid(t=>{t.render(e.verticalScroller)}),e.renderHeader(n,t),e.renderFooter(s,t),e.autoHeight?(e._bodyHeight=e.rowManager.initWithHeight(t.offsetHeight-n.offsetHeight-s.offsetHeight,!0),r.style.height=e.bodyHeight+"px"):(e._bodyHeight=e.bodyContainer.offsetHeight,e.rowManager.initWithHeight(e._bodyHeight,!0)),e.eachSubGrid(e=>{e.header.maxDepth>i&&(i=e.header.maxDepth)}),n.dataset.maxDepth=i,e.fixSizes(),e.renderRows(!1),e.initScroll(),e.initInternalEvents(),e.rendered=!0}render(e){const t=this;t.requireSize=Boolean(t.owner),super.render(e),t.autoHeight||!t.headerContainer.offsetHeight||t.bodyContainer.offsetHeight||console.warn("Grid element not sized correctly, please check your CSS styles and review how you size the widget")}maskBody(e){const t=this;if(!t.bodyContainer)return;t.unmaskBody();const{maskElement:n}=t.activeMask=I.mask(t.element,e);return n.style.marginTop=`${t.headerContainer.offsetHeight}px`,n.style.marginBottom=`${t.footerContainer.offsetHeight}px`,t.activeMask}unmaskBody(){const e=this;e.loadmaskHideTimer&&e.clearTimeout(e.loadmaskHideTimer),e.loadmaskHideTimer=null,e.activeMask&&e.activeMask.destroy(),e.activeMask=null}get isAnimating(){return this._animating}set isAnimating(e){const t=this;t.rendered&&e!==t.isAnimating&&(e?t.element.classList.add("b-animating"):t.element.classList.remove("b-animating"),t._animating=e)}}return e._$name="Grid",e}();E.register("grid",oa),Ni.setVersion("grid","2.2.4"),E.register("treegrid",function(){class e extends oa{set store(e){if(e&&!e.tree){if(e instanceof Nr)throw new Error("TreeGrid requires a Store configured with tree : true");e.tree=!0}super.store=e}get store(){return super.store}}return e._$name="TreeGrid",e}());var aa=e=>(class t extends(e||W){static get defaultMethod(){return{load:"GET",sync:"POST"}}cancelRequest(e){e.abort()}sendRequest(e){let n=this,r=e.data,s=n.transport[e.type]||{},i=s.paramName,o=Object.assign({},s.params),a=s.method||t.defaultMethod[e.type],l=Object.assign({url:s.url,method:a,params:o},s.requestConfig);i?(l.params=l.params||{},l.params[i]=r):l.jsonData=r,n.trigger("beforeSend",{params:o,type:e.type,requestConfig:l,config:e});const c=Object.assign({method:a,headers:l.headers,queryParams:o,body:"HEAD"===a||"GET"===a?void 0:l.jsonData},l.fetchOptions),d=ae.fetch(l.url,c);return d.then(t=>{t.ok?e.success&&e.success.call(e.thisObj||n,t,c):e.failure&&e.failure.call(e.thisObj||n,t,c)}),d}});const la=function(e,t,n){return e.store&&(e=e.store),t.store&&(t=t.store),(e=e[n]||0)<(t=t[n]||0)?-1:e>t?1:0},ca=function(e,t){return la(e,t,"loadPriority")},da=function(e,t){return la(e,t,"syncPriority")},ua=()=>{};var ha=e=>(class extends e{static get crudManagerDefaultConfig(){return{crudRevision:null,crudStores:[],storeIdProperty:"storeId",crudFilterParam:"filter",transport:{},trackResponseType:!1,phantomIdField:"$PhantomId",autoLoad:!1,autoSyncTimeout:100,autoSync:!1,resetIdsBeforeSync:!0,syncApplySequence:[],writeAllFields:!1,crudIgnoreUpdates:0,crudLoaded:!1,createMissingRecords:!1,autoSyncTimerId:null,applyingLoadResponse:!1,applyingSyncResponse:!1,callOnFunctions:!0}}construct(e={}){this._requestId=0,this.activeRequests={},this.crudStoresIndex={},this._crudManagerConfig=e,super.construct(e)}applyCrudManagerMixinConfig(e){const t=this.splitCrudManagerConfig(e);t.crudStores&&(this.crudStores=t.crudStores,delete t.crudStores),Object.assign(this,t)}afterConfigure(){this.initialConfig||this.applyCrudManagerMixinConfig(this._crudManagerConfig)}splitCrudManagerConfig(e){let t=Object.assign({},this.constructor.crudManagerDefaultConfig);for(let n in e)n in t&&(t[n]=e[n],delete e[n]);return t}afterConstruct(){super.afterConstruct(),this.autoLoad&&this.load().catch(e=>{})}getStoreDescriptor(e){return e?e instanceof Nr?this.crudStores.find(t=>t.store===e):"object"==typeof e?this.crudStoresIndex[e.storeId]:this.crudStoresIndex[e]||this.getStoreDescriptor(Nr.getStore(e)):null}fillStoreDescriptor(e){let t=e.store,n=t.modelClass&&t.modelClass.prototype;return!e.storeId&&(e.storeId=t[t.storeIdProperty||this.storeIdProperty]),!e.idField&&(e.idField=n.idField),!e.phantomIdField&&(e.phantomIdField=n&&n.phantomIdField),!("writeAllFields"in e)&&(e.writeAllFields=t.writeAllFields),e}updateCrudStoreIndex(){const e=this.crudStoresIndex={};this.crudStores.forEach(t=>t.storeId&&(e[t.storeId]=t))}getCrudStore(e){const t=this.getStoreDescriptor(e);return t&&t.store}forEachCrudStore(e,t=this){e&&this.crudStores.every(n=>!1!==e.call(t,n.store,n.storeId,n))}set crudStores(e){this._crudStores=[],this.addCrudStore(e);for(let t of this._crudStores)t.loadPriority=t.syncPriority=0}get crudStores(){return this._crudStores}set syncApplySequence(e){this._syncApplySequence=[],this.addStoreToApplySequence(e)}get syncApplySequence(){return this._syncApplySequence}addCrudStore(e,t,n){if(!e)return;if(Array.isArray(e)||(e=[e]),!e.length)return;const r=this,s=[];if(e.forEach(e=>{e instanceof Nr?e={store:e}:"object"==typeof e?e.stores&&(Array.isArray(e.stores)||(e.stores=[e.stores]),e.stores.forEach((t,n)=>{let r=t;"string"==typeof t&&(r={storeId:t}),r.masterStoreInfo=e,e.stores[n]=r})):e={store:Nr.getStore(e)},s.push(r.fillStoreDescriptor(e)),e.store.setCrudManager?e.store.setCrudManager(r):e.store.crudManager=r,r.overrideCrudStoreLoad&&e.store.load&&(e.store.load=e.store.commit=(()=>{})),r.bindCrudStoreListeners(e.store)}),void 0===t)r.crudStores.push.apply(r.crudStores,s);else{let e=t;n&&((n instanceof Nr||"object"!=typeof n)&&(n=r.getStoreDescriptor(n)),e+=r.crudStores.indexOf(n)),r.crudStores.splice(e,0,...s)}r.updateCrudStoreIndex()}addPrioritizedStore(e){this.hasCrudStore(e)||this.addCrudStore(e,le.findInsertionIndex(e,this.crudStores,ca)),this.hasApplySequenceStore(e)||this.addStoreToApplySequence(e,le.findInsertionIndex(e,this.syncApplySequence,da))}hasCrudStore(e){return this.crudStores.some(t=>t===e||t.store===e||t.storeId===e)}removeCrudStore(e){const t=this,n=t.crudStores;for(let r=0,s=n.length;r<s;r++){const s=n[r];if(s===e||s.store===e||s.storeId===e){t.unbindCrudStoreListeners(s.store),delete t.crudStoresIndex[s.storeId],n.splice(r,1),t.syncApplySequence&&t.removeStoreFromApplySequence(e);break}}}bindCrudStoreListeners(e,t){const n=this,r={update:n.onCrudStoreChange,removeall:n.onCrudStoreChange,detachable:!0,thisObj:n};Object.assign(r,{add:n.onCrudStoreChange,remove:n.onCrudStoreChange}),e.crudDetatcher=e.on(r)}unbindCrudStoreListeners(e){e.crudDetatcher&&e.crudDetatcher()}addStoreToApplySequence(e,t,n){if(!e)return;Array.isArray(e)||(e=[e]);const r=this,s=e.reduce((e,t)=>{let n=r.getStoreDescriptor(t);return n&&e.push(n),e},[]);if(void 0===t)r.syncApplySequence.push.apply(r.syncApplySequence,s);else{let e=t;n&&((n instanceof Nr||"object"!=typeof n)&&(n=r.getStoreDescriptor(n)),e+=r.syncApplySequence.indexOf(n)),r.syncApplySequence.splice(e,0,...s)}}removeStoreFromApplySequence(e){const t=this.syncApplySequence.findIndex(t=>t===e||t.store===e||t.storeId===e);t>-1&&this.syncApplySequence.splice(t,1)}hasApplySequenceStore(e){return this.syncApplySequence.some(t=>t===e||t.store===e||t.storeId===e)}onCrudStoreChange(){const e=this;e.crudIgnoreUpdates||(e.crudStoreHasChanges()?(e.trigger("hasChanges"),e.autoSync&&(e.autoSyncTimerId||(e.autoSyncTimerId=setTimeout(()=>{e.autoSyncTimerId=null,e.sync()},e.autoSyncTimeout)))):e.trigger("noChanges"))}async internalOnResponse(e,t,n,r){const s=this;s.activeRequests[e]=null;let i=t?s.decode(t):null;return i&&i.success?(!1!==s.trigger("beforeResponseApply",{requestType:e,response:i})&&!1!==s.trigger("before"+$.capitalizeFirstLetter(e)+"Apply",{response:i,options:r})&&(s.crudRevision=i.revision,await s.applyResponse(e,i,r),s.trigger("requestDone",{requestType:e,response:i,responseOptions:n}),s.trigger(e,{response:i,responseOptions:n,options:r}),"load"!==e&&s.crudStoreHasChanges()||s.trigger("noChanges")),i):(s.trigger("requestFail",{requestType:e,response:i,responseText:t,responseOptions:n}),s.trigger(e+"Fail",{response:i,responseOptions:n,responseText:t,options:r}),s.warn("CrudManager: "+e+" failed, please inspect the server response"),i)}async internalOnLoad(e,t,n){return this.crudLoaded=!0,this.internalOnResponse("load",e,t,n)}async internalOnSync(e,t,n){return this.internalOnResponse("sync",e,t,n)}suspendChangesTracking(){this.crudIgnoreUpdates++}resumeChangesTracking(e){this.crudIgnoreUpdates&&!--this.crudIgnoreUpdates&&e&&this.onCrudStoreChange()}crudStoreHasChanges(e){if(e){let t=this.getCrudStore(e);return t&&this.isCrudStoreDirty(t)}return this.crudStores.some(this.isCrudStoreDirty)}isCrudStoreDirty(e){return null!=e.store.changes}emitCrudStoreEvents(e,t){const n={action:"read"+t};for(let r of this.crudStores)e.includes(r.storeId)&&r.store.trigger(t,n)}getLoadPackage(e){const t={type:"load",requestId:this.requestId},n=this.crudStores,r=Object.assign({},e);return t.stores=n.map(e=>{let t=r&&r[e.storeId],n=e.pageSize||e.store&&e.store.pageSize;if(t||n){const s=Object.assign({storeId:e.storeId,page:1,pageSize:n},t);return e.currentPage=s.page,t&&delete r[e.storeId],s}return e.storeId}),Object.assign(t,r),t}loadCrudStore(e,t,n,r){const s=t&&t.rows;n&&n.append||t.append?e.add(s):e.data=s,e.trigger("load",{source:e,data:s})}loadDataToCrudStore(e,t,n){let r,s=this,i=e.store,o=e.stores,a=e.idField||"id",l=i.tree,c=t&&t.rows;i.__loading=!0,c&&(o&&(r=s.getSubStoresData(c,o,a,l)),s.loadCrudStore(i,t,n,e),r&&r.forEach(e=>{s.loadDataToCrudStore(Object.assign({store:i.getById(e.id).get(e.storeDesc.storeId)},e.storeDesc),e.data)})),i.__loading=!1}loadCrudManagerData(e,t={}){this.suspendChangesTracking(),this.crudStores.forEach(n=>{const r=n.storeId,s=e[r];s&&this.loadDataToCrudStore(n,s,t[r])}),this.resumeChangesTracking()}get isCrudManagerLoading(){return Boolean(this.activeRequests.load||this.applyingLoadResponse)}load(e){const t=this,n=t.getLoadPackage(e);return new Promise((r,s)=>{!1!==t.trigger("beforeLoad",{pack:n})?(t.activeRequests.load&&(t.cancelRequest(t.activeRequests.load.desc),t.trigger("loadCanceled",{pack:n})),t.emitCrudStoreEvents(n.stores,"loadStart"),t.activeRequests.load={options:e,pack:n,resolve:r,reject:s,id:n.requestId,desc:t.sendRequest({data:t.encode(n),type:"load",success:t.onLoadSuccess,failure:t.onLoadFailure,thisObj:t})}):(t.trigger("loadCanceled",{pack:n}),s({cancelled:!0}))})}async onLoadSuccess(e,t){let n="";const r=this.activeRequests.load,{options:s}=r;await e.text().then(e=>n=e).catch(ua);const i=await this.internalOnLoad(n,t,s);this.emitCrudStoreEvents(r.pack.stores,"afterRequest"),i&&i.success?r.resolve({response:i,rawResponse:e,responseText:n,options:s}):r.reject({cancelled:!1,response:i,rawResponse:e,responseText:n,options:s})}async onLoadFailure(e,t){let n="";const r=this.activeRequests.load,{options:s}=r;await e.text().then(e=>n=e).catch(ua);const i=await this.internalOnLoad(n,t,s);this.emitCrudStoreEvents(r.pack.stores,"afterRequest"),r.reject({cancelled:!1,response:i,rawResponse:e,responseText:n,options:s})}getSubStoresData(e,t,n,r){if(!e)return;let s=[];function i(e,t){t.forEach(t=>{const r=t.storeId;e[r]&&(s.push({id:e[n],storeDesc:t,data:e[r]}),delete e[r])})}return e.forEach(r?e=>{i(e,t);const r=this.getSubStoresData(e.children,t,n,!0);r&&(s=s.concat(r))}:e=>i(e,t)),s}prepareAdded(e,t,n){return e.filter(e=>e.isValid).map(e=>{const r=Object.assign(e.persistableData,{[t]:e.id});return this.resetIdsBeforeSync&&delete r[e.constructor.idField],n&&this.processSubStores(e,r,n),r})}prepareUpdated(e,t,n){let r=n.writeAllFields||!1!==n.writeAllFields&&this.writeAllFields;if(n.store.tree){const t=n.store.rootNode;e=e.filter(e=>e!==t)}return e.filter(e=>e.isValid).reduce((e,n)=>{let s;r?(s=n.persistableData)[n.constructor.idField]=n.id:(s=n.modifications)[n.constructor.idField]=n.id,t&&this.processSubStores(n,s,t);const i=Object.keys(s);return(i.length>1||i[0]!==n.constructor.idField)&&e.push(s),e},[])}prepareRemoved(e){return e.map(e=>({[e.constructor.idField]:e.id}))}processSubStores(e,t,n){n.forEach(n=>{const r=n.storeId,s=e.get(r);if(s){let e=this.getCrudStoreChanges(Object.assign({store:s},n));e?t[r]=Object.assign(e,{$store:!0}):delete t[r]}else delete t[r]})}getCrudStoreChanges(e,t=e.phantomIdField||this.phantomIdField){let n,r=e.store,s=r.added.values,i=r.modified.values,o=r.removed.values,a=e.stores;return s.length&&(s=this.prepareAdded(s,t,a)),i.length&&(i=this.prepareUpdated(i,a,e)),o.length&&(o=this.prepareRemoved(o)),(s.length||i.length||o.length)&&(n={},s.length&&(n.added=s),i.length&&(n.updated=i),o.length&&(n.removed=o)),n}getChangeSetPackage(){let e={type:"sync",requestId:this.requestId,revision:this.crudRevision},t=0;return this.crudStores.forEach(n=>{const r=this.getCrudStoreChanges(n);r&&(t++,e[n.storeId]=r)}),t?e:null}applyChangesToRecord(e,t,n,r){const s=this,i=e.constructor,{fieldDataSourceMap:o}=i,a=i.prototype,l={},c=e.data,d={[s.phantomIdField]:!0};let u;n&&n.forEach(n=>{const r=n.storeId;if(t.hasOwnProperty(r)){d[r]=!0;const i=e.get(r);i?s.applyChangesToStore(Object.assign({store:i},n),t[r]):console.log("Can't find store for the response sub-package")}});for(const h in t)if(t.hasOwnProperty(h)&&!d[h]){const n=o[h],r=n?n.name:h,s=i.processField(r,t[h]),d=h in a?e[r]:We.getPath(c,h);We.isEqual(d,s)||(u=!0,l[r]=s)}if(u){s.suspendChangesTracking();for(const t in l)e[t]=l[t];s.resumeChangesTracking(),e.clearChanges(!0,!1)}}applyRemovals(e,t,n){let r=e.removed,s=n.findByIdFn,i=n.removeRecordFn,o=0;return t.forEach(e=>{let t=!1,n=e.id;if(r.includes(e)&&(r.remove(e),t=!0,o++),!t){let e=s(n);e?(this.suspendChangesTracking(),i(e),r.remove(e),o++,this.resumeChangesTracking()):console.log("Can't find record to remove from the response package")}}),o}getApplyChangesToStoreHelpers(e){return e.tree?{findByPhantomFn:t=>e.getById(t),findByIdFn:t=>e.getById(t),addRecordFn:t=>(t.parentId&&e.getById(t.parentId)||e.rootNode).appendChild(t),removeRecordFn:e=>e.remove()}:{findByPhantomFn:t=>e.getById(t),findByIdFn:t=>e.getById(t),addRecordFn:t=>e.add(t)[0],removeRecordFn:t=>e.remove(t)}}async applyChangesToStore(e,t){const n=this,r=e.phantomIdField||n.phantomIdField,s=e.idField||"id",i=e.store,{findByPhantomFn:o,findByIdFn:a,addRecordFn:l,removeRecordFn:c}=n.getApplyChangesToStoreHelpers(i),{rows:d,removed:u}=t;if(d){const t=e.stores;d.forEach(e=>{const c=e[r],d=e[s];let u=null;null!=c&&null!=c?u=o(c):s&&(u=a(d)),u?n.applyChangesToRecord(u,e,t,i):(n.suspendChangesTracking(),u=l(e),n.resumeChangesTracking(),u.clearChanges())})}u&&n.applyRemovals(i,u,{idField:s,findByIdFn:a,removeRecordFn:c})&&i.trigger("dataChanged",{source:i})}async applySyncResponse(e){const t=this,n=t.syncApplySequence.length?t.syncApplySequence:t.crudStores;t.applyingSyncResponse=!0,n.forEach(async n=>{const r=e[n.storeId];r&&await t.applyChangesToStore(n,r)}),t.applyingSyncResponse=!1}async applyLoadResponse(e,t){this.applyingLoadResponse=!0,this.loadCrudManagerData(e,t),this.applyingLoadResponse=!1}async applyResponse(e,t,n){switch(this.trackResponseType&&(e=t.type||e),e){case"load":await this.applyLoadResponse(t,n);break;case"sync":await this.applySyncResponse(t)}}get requestId(){return Date.now()+""+this._requestId++}sync(){const e=this;return e.activeRequests.sync?(e.trigger("syncDelayed"),e.activeSyncPromise=e.activeSyncPromise.then(()=>e.sync(),()=>e.sync())):e.activeSyncPromise=new Promise((t,n)=>{const r=e.getChangeSetPackage();r?!1!==e.trigger("beforeSync",{pack:r})?e.activeRequests.sync={pack:r,resolve:t,reject:n,id:r.requestId,desc:e.sendRequest({data:e.encode(r),type:"sync",success:e.onSyncSuccess,failure:e.onSyncFailure,thisObj:e})}:(e.trigger("syncCanceled",{pack:r}),n({cancelled:!0})):t(null)})}async onSyncSuccess(e,t){let n="";await e.text().then(e=>n=e).catch(ua);const r=this.activeRequests.sync,s=await this.internalOnSync(n,t);s&&s.success?r.resolve({response:s,rawResponse:e,responseText:n,request:r}):r.reject({cancelled:!1,response:s,rawResponse:e,responseText:n,request:r})}async onSyncFailure(e,t){let n="";await e.text().then(e=>n=e).catch(ua);const r=this.activeRequests.sync,s=await this.internalOnSync(n,t);r.reject({cancelled:!1,response:s,rawResponse:e,responseText:n,request:r})}commitCrudStores(){this.crudStores.forEach(e=>e.store.commit())}rejectCrudStores(){this.crudStores.forEach(e=>e.store.clearChanges())}warn(){if("console"in window){let e=console;e.log&&e.log.apply&&e.log.apply(e,arguments)}}doDestroy(){const e=this;for(e.activeRequests.load&&e.cancelRequest(e.activeRequests.load.desc),e.activeRequests.sync&&e.cancelRequest(e.activeRequests.sync.desc);e.crudStores.length>0;)e.removeCrudStore(e.crudStores[0]);clearTimeout(e.autoSyncTimerId),e.destroyed=!0}});const ga=function(){class e extends(ha(ue(W))){get revision(){return this.crudRevision}set revision(e){this.crudRevision=e}static get defaultConfig(){return Object.assign({},this.crudManagerDefaultConfig,{overrideCrudStoreLoad:!0,stores:null})}construct(e={}){e.stores&&(e.crudStores=e.stores,delete e.stores),super.construct(e)}set stores(e){e!==this.crudStores&&(this.crudStores=e)}get stores(){return this.crudStores}get isLoading(){return this.isCrudManagerLoading}commit(){this.commitCrudStores()}reject(){this.rejectCrudStores()}addStore(...e){return this.addCrudStore(...e)}removeStore(...e){return this.removeCrudStore(...e)}getStore(...e){return this.getCrudStore(...e)}hasChanges(...e){return this.crudStoreHasChanges(...e)}loadData(...e){return this.loadCrudManagerData(...e)}}return e._$name="AbstractCrudManager",e}(),ma=function(){class e extends Sr{static get fields(){return[{name:"resourceId"},{name:"eventId"}]}static get relationConfig(){return[{relationName:"resource",fieldName:"resourceId",store:"resourceStore",collectionName:"assignments"},{relationName:"event",fieldName:"eventId",store:"eventStore",collectionName:"assignments"}]}get assignmentStore(){return this.stores&&this.stores[0]}get eventStore(){const{assignmentStore:e}=this;return e&&e.eventStore}get resourceStore(){const{eventStore:e}=this;return e&&e.resourceStore}get eventName(){return this.event&&this.event.name}get resourceName(){return this.resource&&this.resource.name}getResource(e=this.resourceStore){return e&&e.getById(this.resourceId)}get isAssignment(){return!0}get isPersistable(){const{event:e,resource:t}=this;return this.isValid&&!e.hasGeneratedId&&!t.hasGeneratedId}get isValid(){return null!=this.resource&&null!=this.event}fullCopy(){throw new Error("Not implemented")}get eventResourceCompositeKey(){return e.makeAssignmentEventResourceCompositeKey(this.eventId,this.resourceId)}static makeAssignmentEventResourceCompositeKey(e,t){return`event(${e})-resource(${t})`}}return e._$name="AssignmentModel",e}();ma.exposeProperties();const pa=function(){class e extends ps{static get defaultConfig(){return{loadPriority:300,syncPriority:300,modelClass:ma}}doDestroy(){this.eventStoreDetacher&&this.eventStoreDetacher(),this.resourceStoreDetacher&&this.resourceStoreDetacher(),super.doDestroy()}get eventStore(){return this._eventStore}set eventStore(e){const t=this,n=t._eventStore;t._eventStore=e||null,t.attachToEventStore(t._eventStore),(n||e)&&n!==e&&t.trigger("eventStoreChange",{newEventStore:e,oldEventStore:n})}attachToEventStore(e){const t=this;t.eventStoreDetacher&&t.eventStoreDetacher(),e&&(t.eventStoreDetacher=e.on({remove:t.onEventRemove,resourcestorechange:t.onEventStoreResourceStoreChange,thisObj:t,prio:200})),t.isConfiguring||t.initRelations(!0),t.attachToResourceStore(e&&e.resourceStore)}attachToResourceStore(e){const t=this;t.resourceStore=e,t.resourceStoreDetacher&&t.resourceStoreDetacher(),e&&(t.resourceStoreDetacher=e.on({remove:t.onResourceRemove,removeAll:t.onResourceRemoveAll,thisObj:t,prio:200}),t.isConfiguring||t.initRelations(!0))}onEventStoreResourceStoreChange({newResourceStore:e}){this.attachToResourceStore(e)}onEventRemove({records:e,isMove:t,isCollapse:n}){if(!t&&!n){const t=[];e.forEach(e=>{e.traverse(e=>{t.push(...e.assignments)})}),this.isRemovingEvent=!0,t.length&&this.remove(t),this.isRemovingEvent=!1}}onResourceRemove({records:e,isMove:t,isCollapse:n}){if(!t&&!n){const t=[];e.forEach(e=>{e.traverse(e=>{t.push(...e.assignments)})}),t.length&&this.remove(t)}}onResourceRemoveAll(){this.removeAll()}mapAssignmentsForEvent(e,t,n){const r=Boolean(t),s=Boolean(n),i=Sr.asId(e),o=this.relationCache.event&&this.relationCache.event[i];return o?(t=t||(e=>e),n=n||(()=>!0),r||s?o.reduce((e,r)=>{const s=t(r);return n(s)&&e.push(s),e},[]):o):[]}mapAssignmentsForResource(e,t,n){const r=Boolean(t),s=Boolean(n),i=Sr.asId(e),o=this.relationCache.resource&&this.relationCache.resource[i];return o?(t=t||(e=>e),n=n||(()=>!0),r||s?o.reduce((e,r)=>{const s=t(r);return n(s)&&e.push(s),e},[]):o):[]}getAssignmentsForEvent(e){return e.assignments}removeAssignmentsForEvent(e){return this.remove(e.assignments)}getAssignmentsForResource(e){return this.mapAssignmentsForResource(e)}removeAssignmentsForResource(e){this.remove(this.getAssignmentsForResource(e))}getResourcesForEvent(e){return this.mapAssignmentsForEvent(e,e=>e.resource,e=>Boolean(e))}getEventsForResource(e){return this.mapAssignmentsForResource(e,e=>e.event,e=>!!e)}assignEventToResource(e,t,n=(e=>e),r=!1){const s=this,i=Array.isArray(t)?t:[t];let o=[];return s.beginBatch(),r&&s.removeAssignmentsForEvent(e),i.forEach(t=>{if(!s.isEventAssignedToResource(e,t)){let r=new s.modelClass({eventId:Sr.asId(e),resourceId:Sr.asId(t)});r=n(r),o.push(r)}}),o=s.add(o),s.endBatch(),o}unassignEventFromResource(e,t){const n=this;if(!t)return n.removeAssignmentsForEvent(e);if(n.isEventAssignedToResource(e,t)){const r=n.getAssignmentForEventAndResource(e,t);return n.remove(r),r}return null}isEventAssignedToResource(e,t){const n=this.getResourcesForEvent(e),r=Sr.asId(t);return n.some(e=>e.id==r)}getAssignmentForEventAndResource(e,t){return e=this.eventStore.getById(e),t=this.resourceStore.getById(t),this.records.find(n=>n.event==e&&n.resource==t)}}return e._$name="AssignmentStore",e}(),fa=function(){class e extends Sr{static get fields(){return[{name:"date",type:"date",format:"YYYY-MM-DD",persist:!0},{name:"weekday",type:"int"},{name:"overrideStartDate",type:"date",dateFormat:"YYYY-MM-DD"},{name:"overrideEndDate",type:"date",dateFormat:"YYYY-MM-DD"},{name:"type",defaultValue:"DAY"},{name:"isWorkingDay",type:"boolean",defaultValue:!1},{name:"cls"},{name:"name"},{name:"availability",persist:!0}]}set date(e){e&&(e=Ne.startOf(e,"day")),this.set("date",e)}get date(){return this.get("date")}clearDate(){this.set("date",null)}get availability(){return this.get("availability")}set availability(e){this.availabilityCache=null,this.set("availability",this.stringifyIntervals(e)),this.getAvailability()}getAvailability(e){const t=this;if(e)return t.get("availability");if(t.availabilityCache)return t.availabilityCache;const n=t.get("availability").map(e=>"string"==typeof e?t.parseInterval(e):e);return t.verifyAvailability(n),t.availabilityCache=n}verifyAvailability(e){const t=this;e.sort((e,t)=>e.startTime-t.startTime),e.forEach((n,r)=>{if(n.startTime>n.endTime)throw new Error(`Start time ${Ne.format(n.startTime,"HH:mm")} is greater than end time ${Ne.format(n.endTime,"HH:mm")}`);if(r>0&&e[r-1].endTime>n.startTime)throw new Error(`Availability intervals should not intersect: [${t.stringifyInterval(e[r-1])}] and [${t.stringifyInterval(n)}]`)})}stringifyInterval(e){const t=e.endTime;return Ne.format(e.startTime,"HH:mm")+"-"+Ne.format(t,"HH:mm")}stringifyIntervals(e){const t=this;return e.map(e=>"string"==typeof e?e:t.stringifyInterval(e))}parseInterval(e){const t=/(\d\d):(\d\d)-(\d\d):(\d\d)/.exec(e);if(!t)throw new Error(`Invalid format for availability string: ${String}. It should have exact format: hh:mm-hh:mm`);return{startTime:new Date(0,0,0,t[1],t[2]),endTime:new Date(0,0,0,t[3],t[4])}}get totalHours(){return this.getTotalMS()/1e3/60/60}get totalMS(){return this.getAvailability().reduce((e,t)=>e+=t.endTime-t.startTime,0)}addAvailabilityInterval(e,t){let n;n=e instanceof Date?{startTime:e,endTime:t}:this.parseInterval(e+(t?"-"+t:""));const r=this.getAvailability().concat(n);this.verifyAvailability(r),this.setAvailability(r)}removeAvailabilityInterval(e){const t=this.getAvailability();t.splice(e,1),this.setAvailability(t)}getAvailabilityIntervalsFor(e){const t=(e="number"==typeof e?new Date(e):e).getFullYear(),n=e.getMonth(),r=e.getDate();return this.getAvailability().map(e=>{const s=e.endTime.getDate();return{startDate:new Date(t,n,r,e.startTime.getHours(),e.startTime.getMinutes()),endDate:new Date(t,n,r+(1==s?1:0),e.endTime.getHours(),e.endTime.getMinutes())}})}getAvailabilityStartFor(e){const t=this.getAvailabilityIntervalsFor(e);return t.length?t[0].startDate:null}getAvailabilityEndFor(e){const t=this.getAvailabilityIntervalsFor(e);return t.length?t[t.length-1].endDate:null}}return e._$name="CalendarDayModel",e}(),va=function(){class e extends Sr{static get fields(){return[{name:"startDate",type:"date",dateFormat:"YYYY-MM-DDTHH:mm:ssZ"},{name:"endDate",type:"date",dateFormat:"YYYY-MM-DDTHH:mm:ssZ"},{name:"duration",type:"number",allowNull:!0},{name:"durationUnit",type:"string",defaultValue:"d"},{name:"fullDuration"},{name:"cls",defaultValue:""},{name:"style",type:"object"},{name:"name",type:"string"}]}afterConstruct(){super.afterConstruct(),this.normalize()}normalize(){const{startDate:e,endDate:t,duration:n,durationUnit:r}=this,s=null!=n;e&&t&&!s?this.setData("duration",Ne.diff(e,t,r,!0)):e&&!t&&s?this.setData("endDate",Ne.add(e,n,r)):!e&&t&&s&&this.setData("startDate",Ne.add(t,-n,r)),this.clearCachedValues()}get cls(){return this._cls||(this._cls=new Ai(super.get("cls"))),this._cls}set cls(e){const t=this;t._cls?t._cls.value=e:t._cls=new Ai(e),t.set("cls",t._cls.value)}get startDate(){return this.get("startDate")}set startDate(e){this.setStartDate(e)}get endDate(){return this.get("endDate")}set endDate(e){this.setEndDate(e)}get duration(){return this.get("duration")}set duration(e){this.setDuration(e,this.durationUnit)}get durationUnit(){return this.get("durationUnit")}setDuration(e,t=this.durationUnit){const n={duration:e=parseFloat(e),durationUnit:t};this.startDate?n.endDate=Ne.add(this.startDate,e,t):this.endDate&&(n.startDate=Ne.add(this.endDate,-e,t)),this.set(n)}get fullDuration(){return{unit:this.durationUnit,magnitude:this.duration}}set fullDuration(e){"string"==typeof e&&(e=Ne.parseDuration(e,!0,this.durationUnit)),this.setDuration(e.magnitude,e.unit)}setStartDate(e,t=!0){const n=this,r={startDate:e};if(e){let s;if(t)s=null!=n.duration;else if(n.endDate){if(r.duration=Ne.diff(e,n.endDate,n.durationUnit,!0),r.duration<0)throw new Error("Negative duration")}else s=null!=this.duration;s&&(r.endDate=Ne.add(e,n.duration,n.durationUnit))}else r.duration=null;n.set(r)}setEndDate(e,t=!1){const n=this,r={endDate:e};if(e){let s;if(!0===t)s=null!=n.duration;else if(n.startDate){if(r.duration=Ne.diff(n.startDate,e,n.durationUnit,!0),r.duration<0)throw new Error("Negative duration")}else s=null!=this.duration;s&&(r.startDate=Ne.add(e,-n.duration,n.durationUnit))}n.set(r)}setStartEndDate(e,t){this.set({startDate:e,endDate:t})}get dates(){const e=[],t=Ne.startOf(this.startDate,"day"),n=this.endDate;for(let r=t;r<n;r=Ne.add(r,1,"day"))e.push(r);return e}get durationMS(){return this.endDate&&this.startDate?this.endDateMS-this.startDateMS:Ne.asMilliseconds(this.duration||0,this.durationUnit)}clearCachedValues(){this._startDateMS=null,this._endDateMS=null,this._isMilestone=null}get endDateMS(){const e=this;return e._endDateMS||(e._endDateMS=e.endDate&&e.endDate.getTime()),e._endDateMS}get startDateMS(){const e=this;return e._startDateMS||(e._startDateMS=e.startDate&&e.startDate.getTime()),e._startDateMS}get isMilestone(){const e=this;return e._isMilestone||(e._isMilestone=e.endDateMS===e.startDateMS),e._isMilestone}inSetNormalize(e){if("string"!=typeof e)return"duration"in(e=Object.assign({},e))?(e.startDate&&!e.endDate&&(e.endDate=Ne.add(e.startDate,e.duration,e.durationUnit||this.durationUnit,!0,!0)),!e.startDate&&e.endDate&&(e.startDate=Ne.add(e.endDate,-e.duration,e.durationUnit||this.durationUnit,!0,!0))):e.startDate&&e.endDate&&(e.duration=Ne.diff(e.startDate,e.endDate,e.durationUnit||this.durationUnit,!0)),e}inSet(e,t,n,r){return this.clearCachedValues(),e=this.inSetNormalize(e)||e,super.inSet(e,t,n,r)}forEachDate(e,t){return this.dates.forEach(e.bind(t))}get isScheduled(){return Boolean(this.startDate&&this.endDate&&this.hasValidDates)}get isValid(){let e=this,t=!0;if(t){let n=e.startDate,r=e.endDate;t=!n||!r||r-n>=0}return t}get hasValidDates(){let e=this.startDateMS,t=this.endDateMS;return!e||!t||t-e>=0}shift(e,t=this.durationUnit){if("string"==typeof e){const n=e;e=t,t=n}this.setStartDate(Ne.add(this.startDate,e,t,!0),!0)}get wbsCode(){return this.indexPath.join(".")}fullCopy(){return this.copy.apply(this,arguments)}intersects(e){return this.intersectsRange(e.startDate,e.endDate)}intersectsRange(e,t){let n=this.startDate,r=this.endDate;return n&&r&&Ne.intersectSpans(n,r,e,t)}split(e=.5){const t=this,n=this.copy(),r=t.firstStore,s=r&&r.assignmentStore,i=t.duration*e,o=t.duration-i;if(e<=0||e>=1)throw new Error("Split point must be > 0 and < 1");return t.duration=i,n.startDate=t.endDate,n.duration=o,r&&r.add(n),s&&s.add(t.assignments.map(e=>{const t=Object.assign({},e.data,{eventId:n.id});return delete t.id,t})),n}}return e._$name="TimeSpan",e}(),ya=function(){class e extends ps{static get defaultConfig(){return{modelClass:fa,daysPerMonth:30,daysPerWeek:7,hoursPerDay:24,unitsInMs:null,defaultNonWorkingTimeCssCls:"b-nonworkingtime",weekendsAreWorkdays:!1,weekendFirstDay:6,weekendSecondDay:0,holidaysCache:null,availabilityIntervalsCache:null,daysIndex:null,weekAvailability:null,defaultWeekAvailability:null,nonStandardWeeksByStartDate:null,nonStandardWeeksStartDates:null,calendarId:null,parent:null,defaultAvailability:["00:00-24:00"],name:null,suspendCacheUpdate:0,availabilitySearchLimit:1825}}static get allCalendars(){return(Nr.stores||[]).filter(t=>t instanceof e)}get calendarId(){return this._calendarId}set parent(t){const n=this,r=e.getCalendar(t);if(t&&!r)throw new Error("Invalid parent specified for the calendar");if(n.parent!=r){const e={calendarchange:n.clearCache,destroy:n.onParentDestroy,thisObj:n},t=n.parent;t&&t.un(e),n._parent=r,r&&r.on(e),n.params=Object.assign(n.params||{},{parentId:r?r.calendarId:null}),n.clearCache(),n.trigger("parentChange",{newParent:r,oldParent:t})}}construct(e){const t=this;super.construct(e),t.unitsInMs={MILLI:1,SECOND:1e3,MINUTE:6e4,HOUR:36e5,DAY:60*t.hoursPerDay*60*1e3,WEEK:t.daysPerWeek*t.hoursPerDay*60*60*1e3,MONTH:t.daysPerMonth*t.hoursPerDay*60*60*1e3,QUARTER:3*t.daysPerMonth*24*60*60*1e3,YEAR:12*t.daysPerMonth*24*60*60*1e3},t.defaultWeekAvailability=t.getDefaultWeekAvailability(),t.on({change:t.clearCache,thisObj:t}),t.clearCache()}static getCalendar(t){return t instanceof e?t:Nr.getStore(t)}set calendarId(e){this._calendarId=e,this.storeId=null!=e?"GNT_CALENDAR:"+e:null,this.params=Object.assign(this.params||{},{calendarId:e})}getDefaultWeekAvailability(){let e=this.defaultAvailability,t=this.weekendFirstDay,n=this.weekendSecondDay,r=[];for(let s=0;s<7;s++)r.push(new this.modelClass(this.weekendsAreWorkdays||s!=t&&s!=n?{type:"WEEKDAY",weekday:s,availability:e&&e.slice()||[],isWorkingDay:!0}:{type:"WEEKDAY",weekday:s,availability:[]}));return r}removeAll(){e.allCalendars.forEach(e=>{e.storeId=null,e.destroy()})}intersectsWithCurrentWeeks(e,t){let n=!1;return this.forEachNonStandardWeek(r=>{const s=r.startDate,i=r.endDate;if(s<=e&&e<i||s<t&&t<=i)return n=!0,!1}),n}clearCache(){const e=this;if(e.suspendCacheUpdate>0)return;e.holidaysCache={},e.availabilityIntervalsCache={};const t=e.daysIndex={},n=e.weekAvailability=[],r=e.nonStandardWeeksStartDates=[],s=e.nonStandardWeeksByStartDate={};e.forEach(function(e){let i=e.id,o=/^(\d)-(\d\d\d\d\/\d\d\/\d\d)-(\d\d\d\d\/\d\d\/\d\d)$/.exec(i),a=/^WEEKDAY:(\d+)$/.exec(i),l=e.type,c=e.weekday;if("WEEKDAYOVERRIDE"==l||o){let t,n;if("WEEKDAYOVERRIDE"==l&&(t=e.overrideStartDate,n=e.overrideEndDate),o&&(t=Ne.parse(o[2],"YYYY/MM/DD"),n=Ne.parse(o[3],"YYYY/MM/DD"),c=o[1]),t&&n&&null!=c){const i=t-0;s[i]||(s[i]={startDate:new Date(t),endDate:new Date(n),name:e.getName(),weekAvailability:[],mainDay:null},r.push(i)),c>=0?s[i].weekAvailability[c]=e:s[i].mainDay=e}}else if("WEEKDAY"==l||a){if(a&&(c=a[1]),null!=c){if(c<0||c>6)throw new Error("Incorrect week day index");n[c]=e}}else{const n=e.date;n&&(t[n-0]=e)}}),r.sort((e,t)=>e-t),e.trigger("calendarChange")}addNonStandardWeek(e,t,n,r){if(e=Ne.clearTime(e),t=Ne.clearTime(t),this.intersectsWithCurrentWeeks(e,t))throw new Error("Can not add intersecting week");const s=this.modelClass,i=[];n.forEach((n,o)=>{if(n instanceof fa)n.type="WEEKDAYOVERRIDE",n.overrideStartDate=e,n.overrideEndDate=t,n.weekday=o,n.name=r||"Week override",i.push(n);else if(Array.isArray(n)){const a=new s;a.type="WEEKDAYOVERRIDE",a.overrideStartDate=e,a.overrideEndDate=t,a.weekday=o,a.name=r||"Week override",a.setAvailability(n),i.push(a)}});const o=new s;o.type="WEEKDAYOVERRIDE",o.overrideStartDate=e,o.overrideEndDate=t,o.weekday=-1,o.name=r||"Week override",i.push(o),this.add(i)}getNonStandardWeekByStartDate(e){return this.nonStandardWeeksByStartDate[Ne.clearTime(e)-0]||null}removeNonStandardWeek(e){e=Ne.clearTime(e)-0;const t=this.getNonStandardWeekByStartDate(e);t&&this.remove(le.clean(t.weekAvailability).concat(t.mainDay))}getNonStandardWeekByDate(e){e=Ne.clearTime(e)-0;const t=this.nonStandardWeeksStartDates,n=this.nonStandardWeeksByStartDate;for(let r=0;r<t.length;r++){const s=n[t[r]];if(s.startDate>e)break;if(s.startDate<=e&&e<=s.endDate)return s}return null}setWeekendsAreWorkDays(e){const t=this;e!==t.weekendsAreWorkdays&&(t.weekendsAreWorkdays=e,t.defaultWeekAvailability=t.getDefaultWeekAvailability(),t.clearCache())}areWeekendsWorkDays(){return this.weekendsAreWorkdays}forEachNonStandardWeek(e,t){const n=this,r=this.nonStandardWeeksStartDates,s=this.nonStandardWeeksByStartDate;for(let i=0;i<r.length;i++)if(!1===e.call(t||n,s[r[i]]))return!1}getCalendarDay(e){return e="number"==typeof e?new Date(e):e,this.getOverrideDay(e)||this.getWeekDay(e.getDay(),e)||this.getDefaultCalendarDay(e.getDay())}getOverrideDay(e){return this.getOwnCalendarDay(e)||this.parent&&this.parent.getOverrideDay(e)||null}getOwnCalendarDay(e){return e="number"==typeof e?new Date(e):e,this.daysIndex[Ne.clearTime(e)-0]}getWeekDay(e,t){if(t){const n=this.getNonStandardWeekByDate(t);if(n&&n.weekAvailability[e])return n.weekAvailability[e]}return this.weekAvailability[e]||this.parent&&this.parent.getWeekDay(e,t)||null}isHoliday(e){const t=e-0,n=this.holidaysCache;if(null!=n[t])return n[t];e="number"==typeof e?new Date(e):e;const r=this.getCalendarDay(e);if(!r)throw new Error("Can't find day for "+e);return n[t]=!r.isWorkingDay}getDefaultCalendarDay(e){return this.hasOwnProperty("defaultAvailability")||this.hasOwnProperty("weekendsAreWorkdays")||!this.parent?this.defaultWeekAvailability[e]:this.parent.getDefaultCalendarDay(e)}isWorkingDay(e){return!this.isHoliday(e)}isWeekend(e){const t=e.getDay();return t===this.weekendFirstDay||t===this.weekendSecondDay}convertMSDurationToUnit(e,t){return e/this.unitsInMs[Ne.getUnitByName(t)]}convertDurationToMs(e,t){return e*this.unitsInMs[Ne.getUnitByName(t)]}forEachAvailabilityInterval(e,t,n){n=n||this;let r=this,s=e.startDate,i=e.endDate,o=!1!==e.isForward;if(o?!s:!i)throw new Error("At least `startDate` or `endDate` is required, depending from the `isForward` option");let a=new Date(o?s:i),l=Ne;o?i||(i=l.add(s,e.availabilitySearchLimit||r.availabilitySearchLimit||1825,"day")):s||(s=l.add(i,-(e.availabilitySearchLimit||r.availabilitySearchLimit||1825),"day"));let c=!1;for(;o?a<i:a>s;){let e=r.getAvailabilityIntervalsFor(a-(o?0:1),!!o&&c);for(let r=o?0:e.length-1;o?r<e.length:r>=0;o?r++:r--){let o=e[r],a=o.startDate,l=o.endDate;if(!(a>=i||l<=s)&&!1===t.call(n,a<s?s:a,l>i?i:l))return!1}a=o?l.getStartOfNextDay(a,!1,c):l.getEndOfPreviousDay(a,c),c=!0}}calculateDuration(e,t,n){let r=0;return this.forEachAvailabilityInterval({startDate:e,endDate:t},(e,t)=>{let n=e.getTimezoneOffset()-t.getTimezoneOffset();r+=t-e+60*n*1e3}),this.convertMSDurationToUnit(r,n)}getHolidaysRanges(e,t,n){if(e>t)throw new Error("startDate can't be bigger than endDate");e=Ne.clearTime(e),t=Ne.clearTime(t);let r,s,i=[];for(s=e;s<t;s=Ne.getNext(s,"day",1))if(this.isHoliday(s)||this.weekendsAreWorkdays&&n&&this.isWeekend(s)){const e=this.getCalendarDay(s),t=e&&e.cls||this.defaultNonWorkingTimeCssCls,n=Ne.getNext(s,"day",1);r?r.cls.isEqual(t)?r.endDate=n:(i.push(r),r=new va({startDate:s,endDate:n,cls:t})):r=new va({startDate:s,endDate:n,cls:t})}else r&&(i.push(r),r=null);return r&&i.push(r),i}calculateEndDate(e,t,n){if(!t)return new Date(e);let r,s=Ne,i=0===(t=this.convertDurationToMs(t,n))&&s.clearTime(e,!0)-e==0?s.add(e,-1,"day"):e;return this.forEachAvailabilityInterval({startDate:i},function(e,n){let s=n-e,i=e.getTimezoneOffset()-n.getTimezoneOffset();if(s>=t)return r=new Date(e-0+t),!1;t-=s+60*i*1e3}),r}skipNonWorkingTime(e,t){let n=!1;if(this.forEachAvailabilityInterval(t?{startDate:e}:{endDate:e,isForward:!1},(r,s)=>(e=t?r:s,n=!0,!1)),!n)throw new Error("skipNonWorkingTime: Cannot skip non-working time, please ensure that this calendar has any working period of time specified");return new Date(e)}calculateStartDate(e,t,n){if(!t)return new Date(e);let r;return t=this.convertDurationToMs(t,n),this.forEachAvailabilityInterval({endDate:e,isForward:!1},(e,n)=>{const s=n-e;if(s>=t)return r=new Date(n-t),!1;t-=s}),r}skipWorkingTime(e,t,n){return t>=0?this.calculateEndDate(e,t,n):this.calculateStartDate(e,-t,n)}isChildOf(e){let t=this,n=!1;for(;t&&!n;)n=t===e,t=t.parent;return n}getParentableCalendars(){const t=this;return e.getAllCalendars().reduce((e,n)=>(n===t||n.isChildOf(t)||e.push({id:n.calendarId,name:n.name||n.calendarId}),e),[])}get parent(){return this._parent}getAvailabilityIntervalsFor(e,t){return e=t?e.valueOf():e instanceof Date?new Date(e.getFullYear(),e.getMonth(),e.getDate()).valueOf():Ne.clearTime(new Date(e)).valueOf(),this.availabilityIntervalsCache[e]=this.availabilityIntervalsCache[e]||this.getCalendarDay(e).getAvailabilityIntervalsFor(e)}onParentDestroy(){this.parent=null}isAvailabilityIntersected(e,t,n){let r,s,i,o;for(let l=0;l<7;l++)if(r=this.getWeekDay(l)||this.getDefaultCalendarDay(l),i=e.getWeekDay(l)||e.getDefaultCalendarDay(l),r&&i){s=r.getAvailability(),o=i.getAvailability();for(let e=0,t=s.length;e<t;e++)for(let n=0,r=o.length;n<r;n++)if(o[n].startTime<s[e].endTime&&o[n].endTime>s[e].startTime)return!0}let a=!1;return this.forEachNonStandardWeek(e=>!(e.startDate>=n)&&(t<e.endDate?(a=!0,!1):void 0)),a}}return e._$name="Calendar",e}();var ba=e=>(class extends(e||W){encode(e){return $.safeJsonStringify(e)}decode(e){return $.safeJsonParse(e)}}),Ca=e=>(class extends(e||W){get eventStore(){return this._eventStore}set eventStore(e){const t=this;if(t._eventStore!==e){const n=t._eventStore;t._eventStore=e||null,e&&!e.resourceStore&&(e.resourceStore=t),t.trigger("eventStoreChange",{newEventStore:e,oldEventStore:n})}}getScheduledEventsInTimeSpan(e,t,n=this.eventStore){return this.reduce((r,s)=>{r.concat(n.getEventsForResource(s).reduce((n,r)=>{r.intersectsRange(e,t)&&n.push(r)}))})}});const wa=function(){class e extends So{static get fields(){return[{name:"name",type:"string",persist:!0},"eventColor","eventStyle","imageUrl"]}get resourceStore(){return this.stores&&this.stores[0]}get eventStore(){const e=this.resourceStore;return e&&e.eventStore||this.parentNode&&this.parentNode.eventStore}get assignmentStore(){const e=this.eventStore;return e&&e.assignmentStore}get events(){return this.eventStore&&this.eventStore.getEventsForResource(this)}getEvents(e=this.eventStore){return e&&e.getEventsForResource(this)||[]}get isPersistable(){const e=this.parentNode;return!e||!e.phantom||e.isRoot&&e.isRoot()}isAbove(e){let t,n,r,s,i,o=this,a=o.resourceStore;if(o===e)return!1;if(a.tree){for(t=o,n=[];t;)n.push(t),t=t.parentNode;for(t=e,r=[];t;)r.push(t),t=t.parentNode;for(s=0;s<n.length-1&&s<r.length-1&&n[s]==r[s];)++s;return e=r[s+1],(i=n[s]).indexOf(o=n[s+1])<i.indexOf(e)}return a.indexOf(o)<a.indexOf(e)}unassignAll(e){this.events&&this.events.slice().forEach(t=>t.unassign(this,e))}}return e._$name="ResourceModel",e}();wa.exposeProperties();const Sa=function(){class e extends(Ca(ps)){static get defaultConfig(){return{loadPriority:200,syncPriority:100,modelClass:wa,storeId:"resources",autoTree:!0}}construct(e){if(super.construct(e),this.modelClass!==wa&&!(this.modelClass.prototype instanceof wa))throw new Error("Model for ResourceStore must subclass ResourceModel")}remove(e){e=Array.isArray(e)?e:[e];for(let t of e)this.getById(t).unassignAll(!0);super.remove(e)}removeAll(){this.traverse(e=>e.unassignAll(!0)),super.removeAll()}}return e._$name="ResourceStore",e}(),Da=function(){class e extends W{set eventStore(e){const t=this;t.eventStoreDetacher&&t.eventStoreDetacher(),t._eventStore=e,e&&e.autoCommit&&(t.eventStoreDetacher=e.on({beforecommit:t.onEventStoreBeforeSync,thisObj:t,detachable:!0,prio:100}))}get eventStore(){return this._eventStore}set resourceStore(e){const t=this;t.resourceStoreDetacher&&t.resourceStoreDetacher(),t._resourceStore=e,e&&e.autoCommit&&(t.resourceStoreDetacher=e.on({beforecommit:t.onResourceStoreBeforeSync,thisObj:t,detachable:!0,prio:100}))}get resourceStore(){return this._resourceStore}set assignmentStore(e){const t=this;t.assignmentStoreDetacher&&t.assignmentStoreDetacher(),t._assignmentStore=e,e&&e.autoSync&&(t.assignmentStoreDetacher=e.on({beforecommit:t.onAssignmentStoreBeforeSync,thisObj:t,detachable:!0,prio:100}))}get assignmentStore(){return this._assignmentStore}set dependencyStore(e){const t=this;t.dependencyStoreDetacher&&t.dependencyStoreDetacher(),t._dependencyStore=e,e&&e.autoSync&&(t.dependencyStoreDetacher=e.on({beforecommit:t.onDependencyStoreBeforeSync,thisObj:t,detachable:!0,prio:100}))}get dependencyStore(){return this._dependencyStore}onEventStoreBeforeSync({changes:e}){return this.removeNonPersistableRecordsToCreate(e),this.shallContinueSync(e)}onResourceStoreBeforeSync({changes:e}){return this.removeNonPersistableRecordsToCreate(e),this.shallContinueSync(e)}onAssignmentStoreBeforeSync({changes:e}){return this.removeNonPersistableRecordsToCreate(e),this.shallContinueSync(e)}onDependencyStoreBeforeSync({changes:e}){return this.removeNonPersistableRecordsToCreate(e),this.shallContinueSync(e)}removeNonPersistableRecordsToCreate(e){let t,n,r=e.added||[];for(n=r.length-1;n>=0;--n)(t=r[n]).isPersistable||r.splice(r.indexOf(t),1);0===r.length&&(e.added.length=0)}shallContinueSync(e){return Boolean(e.added&&e.added.length>0||e.modified&&e.modified.length>0||e.removed&&e.removed.length>0)}}return e._$name="ModelPersistencyManager",e}(),Ea={string:1,number:1};var xa=e=>(class extends(e||W){get resourceStore(){return this._resourceStore}set resourceStore(e){const t=this,n=t._resourceStore;n&&(n.eventStore=null,t.modelPersistencyManager&&(t.modelPersistencyManager.resourceStore=null)),t._resourceStore=e||null,e&&(t.modelPersistencyManager&&(t.modelPersistencyManager.resourceStore=t._resourceStore),e.eventStore=t),t.isConfiguring||t.initRelations(!0),(n||e)&&n!==e&&t.trigger("resourceStoreChange",{newResourceStore:e,oldResourceStore:n})}get assignmentStore(){return this._assignmentStore}set assignmentStore(e){const t=this,n=t._assignmentStore;n&&(n.eventStore=null,t.modelPersistencyManager&&(t.modelPersistencyManager.assignmentStore=null)),t._assignmentStore=e||null,e&&(t.modelPersistencyManager&&(t.modelPersistencyManager.assignmentStore=t._assignmentStore),e.eventStore=t),t.isConfiguring||t.initRelations(!0),(n||e)&&n!==e&&t.trigger("assignmentStoreChange",{newAssignmentStore:e,oldAssignmentStore:n})}get dependencyStore(){return this._dependencyStore}set dependencyStore(e){const t=this,n=t._dependencyStore;n&&(n.eventStore=null,t.modelPersistencyManager&&(t.modelPersistencyManager.dependencyStore=null)),t._dependencyStore=e||null,t._dependencyStore&&(t.modelPersistencyManager&&(t.modelPersistencyManager.dependencyStore=t._dependencyStore),t._dependencyStore.eventStore=t),(n||e)&&n!==e&&t.trigger("dependencyStoreChange",{newDependencyStore:e,oldDependencyStore:n})}construct(e){super.construct(e),Object.assign(this,{isEventStore:!0,autoTree:!0,modelPersistencyManager:this.createModelPersistencyManager()})}createModelPersistencyManager(){return new Da({eventStore:this,resourceStore:this.resourceStore,assignmentStore:this.assignmentStore,dependencyStore:this.dependencyStore})}getEventsInTimeSpan(e,t,n=!0,r=!1){const s=[];return this.forEachScheduledEvent((i,o,a)=>{(n&&Ne.intersectSpans(o,a,e,t)||!n&&o-e>=0&&t-a>=0)&&(!r||i.resources.length>0)&&s.push(i)}),s}getEventsByStartDate(e){const t=[];return this.forEachScheduledEvent((n,r,s)=>{Ne.isEqual(r,e,"day")&&t.push(n)}),t}forEachScheduledEvent(e,t=this){this.forEach(n=>{const r=n.startDate,s=n.endDate;if(r&&s)return e.call(t,n,r,s)})}getTotalTimeSpan(){let e=new Date(9999,0,1),t=new Date(0);return this.forEach(n=>{n.startDate&&(e=Ne.min(n.startDate,e)),n.endDate&&(t=Ne.max(n.endDate,t))}),e=e<new Date(9999,0,1)?e:null,t=t>new Date(0)?t:null,this.lastTotalTimeSpan={startDate:e||null,endDate:t||e||null}}isEventPersistable(e){return!!this.assignmentStore||!e.resource||!e.resource.hasGeneratedId}isDateRangeAvailable(e,t,n,r){if(n instanceof ma){const s=n.event,i=s.resources,o=new Set(r.events);return i.forEach(e=>{e.events.forEach(e=>o.add(e))}),o.delete(s),!Array.from(o).some(n=>Ne.intersectSpans(e,t,n.startDate,n.endDate))}return!this.getEventsForResource(r).some(r=>!(n===r||!Ne.intersectSpans(e,t,r.startDate,r.endDate)))}filterEventsForResource(e,t,n=this){return e.getEvents(this).filter(t.bind(n))}getResourcesForEvent(e){return this.assignmentStore?this.assignmentStore.getResourcesForEvent(e):(e=this.getById(e)).resource&&!e.resource.placeHolder?[e.resource]:[]}getEventsForResource(e){const t=this.assignmentStore;if(t)return t.getEventsForResource(e);Ea[typeof e]||(e=e.id);const n=this.relationCache.resource&&this.relationCache.resource[e];return n?n.slice():[]}getAssignmentsForEvent(e){return this.assignmentStore&&this.assignmentStore.getAssignmentsForEvent(e)||[]}getAssignmentsForResource(e){return this.assignmentStore&&this.assignmentStore.getAssignmentsForResource(e)||[]}assignEventToResource(e,t,n=!1){const r=this.assignmentStore;r?r.assignEventToResource(e,t,void 0,n):(e=this.getById(e),Array.isArray(t)&&(t=t[0]),t=t instanceof wa?t.id:t,e&&(e.resourceId=t))}unassignEventFromResource(e,t){const n=this.assignmentStore;n?n.unassignEventFromResource(e,t):(e=this.getById(e),t=t instanceof wa?t.id:t,e&&e.resourceId==t&&(e.resourceId=null))}reassignEventFromResourceToResource(e,t,n){const r=this.assignmentStore,s=Sr.asId(n),i=Sr.asId(t);if(r){const i=r.getAssignmentForEventAndResource(e,t);i?i.resourceId=s:r.assignEventToResource(e,n)}else(e=this.getById(e)).resourceId==i&&(e.resourceId=s)}isEventAssignedToResource(e,t){let n=this.assignmentStore;return n?n.isEventAssignedToResource(e,t):(e=this.getById(e),t=Sr.asId(t),e&&e.resourceId==t||!1)}removeAssignmentsForEvent(e){let t=this.assignmentStore;t?t.removeAssignmentsForEvent(e):(e=this.getById(e))&&(e.resourceId=null)}removeAssignmentsForResource(e){const t=this.assignmentStore,n=this.resourceStore;t?t.removeAssignmentsForResource(e):n?e=n.getById(e):(e=Sr.asId(e),this.forEach(t=>t.resourceId==e&&(t.resourceId=null)))}});const Ta=function(){class e extends va{static get fields(){return[{name:"iconCls"},{name:"resourceId"},{name:"draggable",type:"boolean",persist:!1,defaultValue:!0},{name:"resizable",persist:!1,defaultValue:!0},"eventStyle","eventColor","milestoneWidth"]}static get relationConfig(){return[{relationName:"resource",fieldName:"resourceId",store:"resourceStore",collectionName:"events"}]}get eventStore(){const e=this;return e._eventStore||(e._eventStore=e.stores&&e.stores.find(e=>e.isEventStore)),e._eventStore}get resourceStore(){const e=this.eventStore;return e&&e.resourceStore}get assignmentStore(){const e=this.eventStore;return e&&e.assignmentStore}get resources(){return this.eventStore&&this.eventStore.getResourcesForEvent(this)||[]}forEachResource(e,t=this){for(let n of this.resources)if(!1===e.call(t,n))return}getResource(e=this.resourceId){let t=this,n=t.eventStore,r=n&&n.resourceStore;if(n&&e){let e=n.getResourcesForEvent(t);if(1==e.length)return e[0];if(e.length>1)throw new Error("Event::getResource() is not applicable for events with multiple assignments, please use Event::resources instead.");return null}if(r)return r?r.getById(e):null}get isEvent(){return!0}get isDraggable(){return this.draggable}get isResizable(){return!this.isMilestone&&this.resizable}get isPersistable(){const e=this.eventStore;return e&&e.isEventPersistable(this)}assign(e){const t=this.eventStore;e=Sr.asId(e),t?t.assignEventToResource(this,e):this.resourceId=e}unassign(e,t){const n=this,r=n.eventStore;e=Sr.asId(e),n.meta.removingResource=t,r?r.unassignEventFromResource(n,e):n.resourceId==e&&(n.resourceId=null),n.meta.removingResource=null}reassign(e,t){const n=this.eventStore;e=Sr.asId(e),t=Sr.asId(t),n?n.reassignEventFromResourceToResource(this,e,t):this.resourceId=t}isAssignedTo(e){let t=this.eventStore;return e=Sr.asId(e),t?t.isEventAssignedToResource(this,e):this.resourceId==e}}return e._$name="EventModel",e}();Ta.exposeProperties();const Ra=function(){class e extends(xa(ps)){static get defaultConfig(){return{loadPriority:100,syncPriority:200,modelClass:Ta,storeId:"events"}}construct(e){if(super.construct(e,!0),this.modelClass!==Ta&&!(this.modelClass.prototype instanceof Ta))throw new Error("The model for the EventStore must subclass EventModel")}append(e){this.add(e)}}return e._$name="EventStore",e}(),ka=["SS","SF","FS","FF"],Ma=function(){class e extends Sr{static get Type(){return{StartToStart:0,StartToEnd:1,EndToStart:2,EndToEnd:3}}static get fields(){return[{name:"from"},{name:"to"},{name:"type",type:"int",defaultValue:2},{name:"cls",defaultValue:""},{name:"bidirectional",type:"boolean"},{name:"fromSide",type:"string"},{name:"toSide",type:"string"},{name:"lag",type:"number",allowNull:!0,defaultValue:0},{name:"lagUnit",type:"string",defaultValue:"d"}]}static get relationConfig(){return[{relationName:"sourceEvent",fieldName:"from",store:"eventStore",collectionName:"successors"},{relationName:"targetEvent",fieldName:"to",store:"eventStore",collectionName:"predecessors"}]}construct(e){super.construct(...arguments),e&&(e.from&&e.from instanceof va&&(this.setSourceEvent(e.from),delete e.from),e.to&&e.to instanceof va&&(this.setTargetEvent(e.to),delete e.to))}get eventStore(){return this.stores[0].eventStore}get hardType(){return this.getHardType()}set hardType(e){this.setHardType(e)}getHardType(){return this.get("type")}setHardType(e){let t;return e!==this.getHardType()&&(t=this.set({type:e,fromSide:null,toSide:null})),t}get lag(){return this.get("lag")}set lag(e){"number"==typeof e?this.set({lag:e}):this.setLag(e)}setLag(e,t){1!==arguments.length?(e=parseFloat(e),this.set({lag:e,lagUnit:t})):"number"==typeof e?this.lag=e:(e=Ne.parseDuration(e),this.set({lag:e.magnitude,lagUnit:e.unit}))}getLag(){return this.lag?`${this.lag<0?"-":"+"}${Math.abs(this.lag)}${Ne.getShortNameOfUnit(this.lagUnit)}`:""}get fullLag(){return{unit:this.lagUnit,magnitude:this.lag}}set fullLag(e){"string"==typeof e?this.setLag(e):this.setLag(e.magnitude,e.unit)}set sourceEvent(e){this.from=e.id}set targetEvent(e){this.to=e.id}get isPersistable(){const e=this.getSourceEvent(),t=this.getTargetEvent();return e&&!e.hasGeneratedId&&t&&!t.hasGeneratedId}getSourceEvent(e=this.eventStore){return e.getById(this.from)}getTargetEvent(e=this.eventStore){return e.getById(this.to)}getDateRange(t=!1){const n=this.sourceEvent,r=this.targetEvent;if(n&&r&&n.isScheduled&&r.isScheduled){let s,i,o=e.Type;switch(this.type){case o.StartToStart:s=n.startDate,i=r.startDate;break;case o.StartToEnd:s=n.startDate,i=r.endDate;break;case o.EndToEnd:s=n.endDate,i=r.endDate;break;case o.EndToStart:s=n.endDate,i=r.startDate}return{start:t?s:Ne.min(s,i),end:t?i:Ne.max(s,i)}}return null}highlight(e){const t=this.highlighted?this.highlighted.split(" "):[];t.includes(e)||(this.highlighted=t.concat(e).join(" "))}unhighlight(e){const t=this,n=t.highlighted;if(n){const r=n.split(" "),s=r.findIndex(t=>t===e);s>=0&&(r.splice(s,1),t.highlighted=r.join(" "))}}isHighlightedWith(e){const t=this.highlighted;return t&&t.split(" ").includes(e)}getConnectorString(t){const n=ka[this.type];if(t)return n;if(this.type===e.Type.EndToStart)return"";const r=he.locale;if(r){const e=r.Scheduler&&r.Scheduler[n];if(e)return e}return n}toString(){return`${this.from}${this.getConnectorString()}${this.getLag()}`}isValid(e){const{from:t,to:n,type:r}=this;return"number"==typeof r&&t&&""!==t&&null!=n&&""!==n&&t!==n}}return e._$name="DependencyBaseModel",e}();Ma.exposeProperties();const Ia=function(){class e extends Ma{getTypeFromSides(e,t,n){const r=Ma.Type,s=n?"right":"left";return e===s?t===s?r.StartToStart:r.StartToEnd:t===(n?"left":"right")?r.EndToEnd:r.EndToStart}}return e._$name="DependencyModel",e}();Ia.exposeProperties();const Aa=function(){class e extends ps{static get defaultConfig(){return{loadPriority:400,syncPriority:400,modelClass:Ia,storeId:"dependencies"}}doDestroy(){this.eventStoreDetacher&&this.eventStoreDetacher(),super.doDestroy()}get eventStore(){return this._eventStore}set eventStore(e){const t=this,n=t._eventStore;t._eventStore=e,e&&(t.attachToEventStore(e),t.isConfiguring||t.initRelations(!0)),(n||e)&&n!==e&&t.trigger("eventStoreChange",{newEventStore:e,oldEventStore:n})}attachToEventStore(e){const t=this;t.eventStoreDetacher&&t.eventStoreDetacher(),t.eventStoreDetacher=e.on({remove:t.onEventRemove,thisObj:t,detachable:!0})}onEventRemove({records:e,isMove:t=!1,isCollapse:n=!1}){t||n||e.forEach(e=>{e.traverse(e=>this.removeEventDependencies(e,!1))})}reduceEventDependencies(e,t,n,r=!0,s){return s=s||(e=>this.getEventDependencies(e)),(e=Array.isArray(e)?e:[e]).reduce((e,n)=>{n.children&&!r?n.traverse(n=>{e=s(n).reduce(t,e)}):e=s(n).reduce(t,e)},n),n}reduceEventPredecessors(e,t,n,r){return this.reduceEventDependencies(e,t,n,r,e=>{})}reduceEventSuccessors(e,t,n,r){return this.reduceEventDependencies(e,t,n,r,e=>{})}mapEventDependencies(e,t,n,r,s){return this.reduceEventDependencies(e,(e,t)=>(n(t)&&e.push(t),e),[],r,s)}mapEventPredecessors(e,t,n,r){return this.reduceEventPredecessors(e,(e,t)=>(n(t)&&e.push(t),e),[],r)}mapEventSuccessors(e,t,n,r){return this.reduceEventSuccessors(e,(e,t)=>(n(t)&&e.push(t),e),[],r)}getEventDependencies(e,t=!1){return[].concat(e.predecessors||[],e.successors||[])}getEventPredecessors(e,t=!1){return e.predecessors}getEventSuccessors(e,t=!1){return e.successors}getUnique(e){return[...new Set(e)]}removeEventDependencies(e,t){const n=this.getEventDependencies(e,t);n.length&&this.remove(this.getUnique(n))}removeEventPredecessors(e,t){const n=this.getEventPredecessors(e,t);n.length&&this.remove(this.getUnique(n))}removeEventSuccessors(e,t){const n=this.getEventSuccessors(e,t);n.length&&this.remove(this.getUnique(n))}getBySourceTargetId(t){return this.records.find(t=>e.makeDependencySourceTargetCompositeKey(t.from,t.to))}getDependencyForSourceAndTargetEvents(t,n){return t=Sr.asId(t),n=Sr.asId(n),this.getBySourceTargetId(e.makeDependencySourceTargetCompositeKey(t,n))}getEventsLinkingDependency(e,t){return this.getDependencyForSourceAndTargetEvents(e,t)||this.getDependencyForSourceAndTargetEvents(t,e)}isValidDependency(e,t,n){return 1===arguments.length&&(n=e.type,t=e.to,e=e.from),null!=e&&null!=t&&e!==t}getHighlightedDependencies(e){return this.records.reduce((t,n)=>(n.isHighlightedWith(e)&&t.push(n),t),[])}static makeDependencySourceTargetCompositeKey(e,t){return`source(${e})-target(${t})`}getTimeSpanDependencies(e){return this.getEventDependencies(e)}}return e._$name="DependencyStore",e}(),Fa=function(){class e extends(ba(aa(ga))){static get defaultConfig(){return{resourceStoreClass:Sa,eventStoreClass:Ra,assignmentStoreClass:pa,dependencyStoreClass:Aa,resourceStore:{},eventStore:{},assignmentStore:null,dependencyStore:null,addRelatedStores:!0}}construct(e={}){e.scheduler&&(this.scheduler=e.scheduler,this.scheduler._crudManager=this),super.construct(e)}afterConstruct(){const e=this,t=e.scheduler;if(t){(t.isVertical||t.isHorizontal&&!t.store)&&(t.resourceStore=e.resourceStore,t.eventStore=e.eventStore);const{dependencies:n,timeRanges:r,resourceTimeRanges:s}=t.features;n&&(e.dependencyStore=n.store),r&&(e.addCrudStore(r.store),e._timeRangesStore=r.store),s&&(e.addCrudStore(s.store),e._timeRangesStore=s.store)}super.afterConstruct()}get timeRangesStore(){return this._timeRangesStore}addFeaturedStore(e){this.addPrioritizedStore(e)}static getEventStoreInfo(e,t){e instanceof Ra||(e="string"==typeof e?Nr.getStore(e):e.store);let n={},r=t.resourceStore,s=t.dependencyStore;return!t.assignmentStore&&(n.assignmentStore=e.assignmentStore),!r&&(n.resourceStore=e.resourceStore),!s&&(n.dependencyStore=e.dependencyStore),n}get resourceStore(){return this._resourceStore&&this._resourceStore.store}set resourceStore(e){const t=this;t.setFeaturedStore("_resourceStore",e,t.resourceStoreClass),t.eventStore.resourceStore=t._resourceStore&&t._resourceStore.store}get eventStore(){return this._eventStore&&this._eventStore.store}set eventStore(t){const n=this;if(n.setFeaturedStore("_eventStore",t,n.eventStoreClass),t=n._eventStore&&n._eventStore.store,n.isConfiguring&&t&&!1!==n.addRelatedStores){let r=e.getEventStoreInfo(t,n.initialConfig),s=r.assignmentStore,i=r.resourceStore,o=r.dependencyStore;s&&(n.assignmentStore=s),i&&(n.resourceStore=i),o&&(n.dependencyStore=o)}}get assignmentStore(){return this._assignmentStore&&this._assignmentStore.store}set assignmentStore(e){this.setFeaturedStore("_assignmentStore",e,this.assignmentStoreClass)}get dependencyStore(){return this._dependencyStore&&this._dependencyStore.store}set dependencyStore(e){this.setFeaturedStore("_dependencyStore",e,this.dependencyStoreClass)}setFeaturedStore(e,t,n){const r=this,s=r[e];return t=Nr.getStore(t,t&&t.storeClass||n),s&&r.removeStore(s),r[e]=t&&{store:t}||null,r.addFeaturedStore(r[e]),r[e]}}return e._$name="CrudManager",e}(),Oa=["rowHeight","tickWidth","tickHeight","displayDateFormat","shiftUnit","shiftIncrement","defaultSpan","timeResolution","columnLinesFor","headerConfig"],La=function(){class e extends W{static get defaultConfig(){return{name:null,rowHeight:24,tickWidth:50,tickHeight:50,displayDateFormat:"HH:mm",shiftUnit:"hour",shiftIncrement:1,defaultSpan:12,timeResolution:null,headerConfig:null,columnLinesFor:"middle",_headers:null,ptype:""}}construct(e){super.construct(e),this.normalizeUnits()}normalizeUnits(){const{timeResolution:e,headerConfig:t}=this;Object.keys(t).forEach(e=>{t[e].unit=Ne.normalizeUnit(t[e].unit),t[e].splitUnit&&(t[e].splitUnit=Ne.normalizeUnit(t[e].splitUnit))}),e&&(e.unit=Ne.normalizeUnit(e.unit)),this.shiftUnit&&(this.shiftUnit=Ne.normalizeUnit(this.shiftUnit))}get headers(){const e=this;if(!e._headers){const t=e._headers=[],{top:n,middle:r,bottom:s}=e.headerConfig;n&&t.push(n),r&&t.push(r),s&&t.push(s)}return e._headers}get mainHeader(){return this.headerConfig.middle}get bottomHeader(){return this.headers[this.headers.length-1]}clone(){const t={};return Oa.forEach(e=>{t[e]=this[e]}),new e(t)}get isValid(){const e=this,t={};let n=!0;return Object.keys(e.headerConfig).forEach(r=>{t[r]=!0,n=n&&Boolean(Ne.normalizeUnit(e.headerConfig[r].unit))}),e.columnLinesFor in t||(e.columnLinesFor="middle"),e.timeResolution&&(n=n&&Ne.normalizeUnit(e.timeResolution.unit)),e.shiftUnit&&(n=n&&Ne.normalizeUnit(e.shiftUnit)),n}}return e._$name="ViewPreset",e}(),_a=function(){class e extends(ge()){static get defaultPresets(){return{secondAndMinute:{tickWidth:30,tickHeight:40,displayDateFormat:"ll LTS",shiftIncrement:10,shiftUnit:"minute",defaultSpan:24,timeResolution:{unit:"second",increment:5},headerConfig:{middle:{unit:"second",increment:10,dateFormat:"ss"},top:{unit:"minute",dateFormat:"llll"}}},minuteAndHour:{tickWidth:100,tickHeight:60,displayDateFormat:"ll LT",shiftIncrement:1,shiftUnit:"hour",defaultSpan:24,timeResolution:{unit:"minute",increment:30},headerConfig:{middle:{unit:"minute",increment:"30",dateFormat:"mm"},top:{unit:"hour",dateFormat:"ddd MM/DD, hA"}}},hourAndDay:{tickWidth:70,tickHeight:40,displayDateFormat:"ll LT",shiftIncrement:1,shiftUnit:"day",defaultSpan:24,timeResolution:{unit:"minute",increment:30},headerConfig:{middle:{unit:"hour",dateFormat:"LT"},top:{unit:"day",dateFormat:"ddd DD/MM"}}},dayAndWeek:{tickWidth:100,tickHeight:80,displayDateFormat:"ll LT",shiftUnit:"day",shiftIncrement:1,defaultSpan:5,timeResolution:{unit:"hour",increment:1},headerConfig:{middle:{unit:"day",dateFormat:"dd DD"},top:{unit:"week",renderer:e=>Ne.getShortNameOfUnit("week")+"."+Ne.format(e,"WW MMM YYYY")}}},weekAndDay:{tickWidth:100,tickHeight:80,displayDateFormat:"ll hh:mm A",shiftUnit:"week",shiftIncrement:1,defaultSpan:1,timeResolution:{unit:"day",increment:1},columnLinesFor:"bottom",headerConfig:{bottom:{unit:"day",increment:1,dateFormat:"DD MMM"},middle:{unit:"week",dateFormat:"YYYY MMMM DD"}}},weekAndMonth:{tickWidth:100,tickHeight:105,displayDateFormat:"ll",shiftUnit:"week",shiftIncrement:5,defaultSpan:6,timeResolution:{unit:"day",increment:1},headerConfig:{middle:{unit:"week",dateFormat:"DD MMM"},top:{unit:"month",dateFormat:"MMM YYYY"}}},monthAndYear:{tickWidth:110,tickHeight:110,displayDateFormat:"ll",shiftIncrement:3,shiftUnit:"month",defaultSpan:12,timeResolution:{unit:"day",increment:1},headerConfig:{middle:{unit:"month",dateFormat:"MMM YYYY"},top:{unit:"year",dateFormat:"YYYY"}}},year:{tickWidth:100,tickHeight:100,resourceColumnWidth:100,displayDateFormat:"ll",shiftUnit:"year",shiftIncrement:1,defaultSpan:1,timeResolution:{unit:"month",increment:1},headerConfig:{middle:{unit:"quarter",renderer:(e,t,n)=>Ne.getShortNameOfUnit("quarter").toUpperCase()+(Math.floor(e.getMonth()/3)+1)},top:{unit:"year",dateFormat:"YYYY"}}},manyYears:{tickWidth:50,tickHeight:50,displayDateFormat:"ll",shiftUnit:"year",shiftIncrement:1,defaultSpan:1,timeResolution:{unit:"year",increment:1},columnLinesFor:"bottom",headerConfig:{middle:{unit:"year",dateFormat:"YYYY",increment:5},bottom:{unit:"year",dateFormat:"YY",increment:1}}},weekAndDayLetter:{tickWidth:20,tickHeight:50,displayDateFormat:"ll",shiftUnit:"week",shiftIncrement:1,defaultSpan:10,timeResolution:{unit:"day",increment:1},columnLinesFor:"bottom",headerConfig:{bottom:{unit:"day",renderer:e=>Ne.format(e,"dd").substring(0,1),verticalColumnWidth:25},middle:{unit:"week",dateFormat:"ddd DD MMM YYYY",verticalColumnWidth:115}}},weekDateAndMonth:{tickWidth:30,tickHeight:40,displayDateFormat:"ll",shiftUnit:"week",shiftIncrement:1,defaultSpan:10,timeResolution:{unit:"day",increment:1},headerConfig:{middle:{unit:"week",dateFormat:"DD"},top:{unit:"month",dateFormat:"YYYY MMMM"}}},day:{displayDateFormat:"LT",shiftIncrement:1,shiftUnit:"day",defaultSpan:1,timeResolution:{unit:"minute",increment:30},columnLinesFor:"bottom",headerConfig:{bottom:{unit:"hour",renderer:e=>`\n                                <div class="b-sch-calendarcolumn-ct"><span class="b-sch-calendarcolumn-hours">${Ne.format(e,"HH")}</span>\n                                <span class="b-sch-calendarcolumn-minutes">${Ne.format(e,"mm")}</span></div>\n                            `},middle:{unit:"day",dateFormat:"ddd DD/MM",splitUnit:"day"}}},week:{displayDateFormat:"LT",shiftIncrement:1,shiftUnit:"week",defaultSpan:24,timeResolution:{unit:"minute",increment:30},columnLinesFor:"bottom",headerConfig:{bottom:{unit:"hour",dateFormat:"LT",renderer:e=>`\n                                <div class="sch-calendarcolumn-ct">\n                                <span class="sch-calendarcolumn-hours">${Ne.format(e,"HH")}</span>\n                                <span class="sch-calendarcolumn-minutes">${Ne.format(e,"mm")}</span>\n                                </div>\n                            `},middle:{unit:"week",dateFormat:"D d",splitUnit:"day"}}}}}static onLocalized(){const e=this;e.presets&&Object.values(e.presets).forEach(t=>{const n=e.L(t.name);n&&(n.displayDateFormat&&(t.displayDateFormat=n.displayDateFormat),n.middleDateFormat&&(t.headerConfig.middle.dateFormat=n.middleDateFormat),n.topDateFormat&&(t.headerConfig.top.dateFormat=n.topDateFormat),n.bottomDateFormat&&(t.headerConfig.bottom.dateFormat=n.bottomDateFormat))})}static registerPreset(e,t){t.name=e;let n=new La(t);if(this.presets||(this.presets={}),!n.isValid)throw new Error("Invalid preset, please check your configuration");this.presets[e]=n}static getPreset(e){return"string"==typeof e?e=this.presets[e]:e instanceof La||(e=new La(e)),e}static normalizePreset(e){let t=this,n=e;if(!(n instanceof La))if("string"==typeof n){if(!(n=t.getPreset(n)))throw new Error("You must define a valid view preset. See PresetManager for reference")}else{if("object"!=typeof n)throw new Error("Invalid preset, specify a preset name or config object");{let e=n.name&&t.getPreset(n.name);if(e)n=new La(Object.assign(e.config,n));else{let e=n.name||"preset"+Object.keys(t.presets).length;t.registerPreset(e,n),n=t.getPreset(e)}}}return n}static deletePreset(e){delete this.presets[e]}static registerDefaults(){const e=this,t=e.defaultPresets;for(let n in t)e.registerPreset(n,t[n])}}return e._$name="PresetManager",e}();he.on("locale",_a.onLocalized.bind(_a)),_a.registerDefaults(),_a.onLocalized();const Pa=function(){class e extends Nr{static get defaultConfig(){return{modelClass:va,continuous:!0,originalContinuous:null,include:null,autoAdjust:!0,unit:null,increment:null,resolutionUnit:null,resolutionIncrement:null,weekStartDay:null,mainUnit:null,shiftUnit:null,shiftIncrement:1,adjustedStart:null,adjustedEnd:null,visibleTickStart:null,visibleTickEnd:null,defaultSpan:1,tickCache:{},viewPreset:null}}construct(e){const t=this;if(t.generateTicksValidatorFn=(()=>!0),super.construct(e),t.originalContinuous=t.continuous,t.on({change:({action:e})=>{"filter"!==e&&t.trigger("reconfigure",{supressRefresh:!1})},refresh:()=>t.trigger("reconfigure",{supressRefresh:!1}),endreconfigure:e=>t.trigger("reconfigure",e)}),t.startDate)t.internalOnReconfigure(),t.trigger("reconfigure");else if(t.viewPreset){const e=t.getAdjustedDates(new Date);t.startDate=e.startDate,t.endDate=e.endDate}}reconfigure(e,t=!1,n=!1){const r=this,s=r.getAdjustedDates(e.startDate,e.endDate);if(!1!==r.trigger("beforeReconfigure",{startDate:s.startDate,endDate:s.endDate,config:e})){if(r.trigger("beginReconfigure"),r._configuredStartDate=e.startDate,r._configuredEndDate=e.endDate,Object.assign(r,e),!1===r.internalOnReconfigure(n))return!1;r.trigger("endReconfigure",{suppressRefresh:t,config:e})}}internalOnReconfigure(e=!1){const t=this;t.isConfigured=!0;const n=t.getAdjustedDates(t.startDate,t.endDate,!0),r=t.getAdjustedDates(t.startDate,t.endDate),s=r.startDate,i=r.endDate;if(s>=i)throw new Error(`Invalid start/end dates. Start date must less than end date. Start date: ${s}. End date: ${i}.`);const o=t.unit,a=t.increment||1,l=t.generateTicks(s,i,o,a);t.suspendEvents(),t.data=l;const{count:c}=t;if(0===c){if(e)return t.resumeEvents(),!1;throw new Error("Invalid time axis configuration or filter, please check your input data.")}t.startDate=t.first.startDate,t.resumeEvents();let d=t.last.endDate;t.isContinuous?(t.adjustedStart=n.startDate,t.adjustedEnd=Ne.getNext(c>1?l[c-1].startDate:n.startDate,o,a,t.weekStartDay)):(t.adjustedStart=t.startDate,t.adjustedEnd=d);do{t.visibleTickStart=(t.startDate-t.adjustedStart)/(Ne.asMilliseconds(o)*a),t.autoAdjust&&(t.visibleTickStart=Math.floor(t.visibleTickStart)),t.visibleTickStart>=1&&(t.adjustedStart=Ne.getNext(t.adjustedStart,o,a,t.weekStartDay))}while(t.visibleTickStart>=1);do{t.visibleTickEnd=c-(t.adjustedEnd-d)/(Ne.asMilliseconds(o)*a),c-t.visibleTickEnd>=1&&(t.adjustedEnd=Ne.getNext(t.adjustedEnd,o,-1,t.weekStartDay))}while(c-t.visibleTickEnd>=1);t.updateTickCache(!0)}get viewPreset(){return this._viewPreset}set viewPreset(e){const t=_a.getPreset(e);this._viewPreset=t,Object.assign(this,{unit:t.bottomHeader.unit,increment:t.bottomHeader.increment||1,resolutionUnit:t.timeResolution.unit,resolutionIncrement:t.timeResolution.increment,mainUnit:t.mainHeader.unit,shiftUnit:t.shiftUnit,shiftIncrement:t.shiftIncrement||1,defaultSpan:t.defaultSpan||1,presetName:t.name,headerConfig:t.headerConfig})}get resolution(){return{unit:this.resolutionUnit,increment:this.resolutionIncrement}}set resolution(e){this.resolutionUnit=e.unit,this.resolutionIncrement=e.increment}get resolutionUnit(){return this._resolutionUnit}set resolutionUnit(e){this._resolutionUnit=e}get resolutionIncrement(){return this._resolutionIncrement}set resolutionIncrement(e){this._resolutionIncrement=e||1}set mainUnit(e){this._mainUnit=e}get mainUnit(){return this._mainUnit}set shiftUnit(e){this._shiftUnit=e}get shiftUnit(){return this._shiftUnit||this._mainUnit}set shiftIncrement(e){this._shiftIncrement=e}get shiftIncrement(){return this._shiftIncrement||1}set unit(e){this._unit=e}get unit(){return this._unit}set increment(e){this._increment=e}get increment(){return this._increment}get defaultSpan(){return this._defaultSpan}set defaultSpan(e){this._defaultSpan=e}setTimeSpan(e,t,n=!1){const{startDate:r,endDate:s}=this.getAdjustedDates(e,t);if(this.startDate-r!=0||this.endDate-s!=0)return this.reconfigure({startDate:r,endDate:s},!1,n)}shift(e,t=this.shiftUnit){const n=this;let{startDate:r,endDate:s}=n;n.isFiltered&&(r=n.allRecords[0].startDate,s=n.allRecords[n.allCount-1].endDate);let i=0;do{r=Ne.add(r,e,t),s=Ne.add(s,e,t)}while(i++<100&&!1===n.setTimeSpan(r,s,!0))}shiftNext(e=this.shiftIncrement){this.shift(e)}shiftPrevious(e=this.shiftIncrement){this.shift(-e)}filterBy(e,t=this){this.filters.clear(),super.filterBy((n,r)=>e.call(t,n.data,r)),0===this.count&&(this.trigger("invalidFilter"),this.clearFilters())}triggerFilterEvent(e){this.continuous=!e.filters.count&&this.originalContinuous,this.updateTickCache(),super.triggerFilterEvent(e)}get isContinuous(){return!1!==this.continuous&&!this.filtered}getAdjustedDates(e,t,n=!1){const r=this;return e=e||r.startDate,t=t||Ne.add(e,r.defaultSpan,r.mainUnit),r.autoAdjust||n?{startDate:r.floorDate(e,!1,r.autoAdjust?r.mainUnit:r.unit,1),endDate:r.ceilDate(t,!1,r.autoAdjust?r.mainUnit:r.unit,1)}:{startDate:e,endDate:t}}get startDate(){return this._start||(this.first?new Date(this.first.startDate):null)}set startDate(e){this._start=Ne.parse(e)}get endDate(){return this._end||(this.last?new Date(this.last.endDate):null)}set endDate(e){e&&(this._end=Ne.parse(e))}get startMS(){return this._startMS}get endMS(){return this._endMS}floorDate(e,t,n,r){const s=this,i=(t=!1!==t)?Ne.clone(s.startDate):null,o=r||s.resolutionIncrement,a=n||(t?s.resolutionUnit:s.mainUnit),l=(e,t)=>Math.floor(e/t)*t;if(t){const t=l(Ne.diff(i,e,a),o);return Ne.add(i,t,a)}let c=Ne.clone(e);if("week"===a){let e=c.getDay()||7,t=s.weekStartDay||7;(c=Ne.add(Ne.startOf(c,"day"),e>=t?t-e:-(7-t+e),"day")).getDay()!==t&&23===c.getHours()&&(c=Ne.add(c,1,"hour"))}else{c=Ne.startOf(c,a);let e=["day","year"].includes(a)?1:0,t="day"===a?"date":a,n=l(Ne.get(c,t)-e,o)+e;c=Ne.set(c,t,n)}return c}roundDate(e,t){const n=this,r=Ne.clone(e),s=n.resolutionIncrement||1;switch(t=Ne.clone(t||n.startDate),n.resolutionUnit){case"week":Ne.startOf(r,"day");let e,i=r.getDay()-n.weekStartDay;return i<0&&(i=7+i),e=1===Math.round(i/7)?7-i:-i,Ne.add(r,e,"day");case"month":const o=Ne.diff(t,r,"month")+Ne.as("month",r.getDay()/Ne.daysInMonth(r)),a=Math.round(o/s)*s;return Ne.add(t,a,"month");case"quarter":return Ne.startOf(r,"month"),Ne.add(r,"month",3-r.getMonth()%3);default:const l=Ne.as(n.resolutionUnit,Ne.diff(t,r)),c=Ne.as(n.resolutionUnit,t.getTimezoneOffset()-r.getTimezoneOffset(),"minute"),d=Math.round((l+c)/s)*s;return Ne.add(t,d-c,n.resolutionUnit)}}ceilDate(e,t,n,r){const s=this;t=!1!==t,r=r||(t?this.resolutionIncrement:1);let i=Ne.clone(e),o=!1,a=n||(t?s.resolutionUnit:s.mainUnit);switch(a){case"minute":o=!Ne.isStartOf(i,"minute");break;case"hour":o=!Ne.isStartOf(i,"hour");break;case"day":case"date":o=!Ne.isStartOf(i,"day");break;case"week":o=(i=Ne.startOf(i,"day")).getDay()!==s.weekStartDay||!Ne.isEqual(i,e);break;case"month":o=1!==(i=Ne.startOf(i,"day")).getDate()||!Ne.isEqual(i,e);break;case"quarter":o=(i=Ne.startOf(i,"day")).getMonth()%3!=0||1!==i.getDate()||!Ne.isEqual(i,e);break;case"year":o=0!==(i=Ne.startOf(i,"day")).getMonth()||1!==i.getDate()||!Ne.isEqual(i,e)}return o?Ne.getNext(i,a,r,s.weekStartDay):i}get include(){return this._include}set include(e){const t=this;t._include=e,t.continuous=!e,t.isConfiguring||(t.startDate=t._configuredStartDate,t.endDate=t._configuredEndDate,t.internalOnReconfigure(),t.trigger("includeChange"))}processExclusion(e,t,n){const{include:r}=this;return!!r&&Object.entries(r).some(([r,s])=>{if(!s)return!1;const{from:i,to:o}=s;if(Ne.compareUnits("day",n)>=0&&Ne.getLargerUnit(r)===n&&(i&&Ne.set(e,r,i),o)){let e=n;"day"===n&&(e="date"),Ne.set(t,{[e]:Ne.get(t,e)-1,[r]:o})}if(Ne.compareUnits(r,n)>=0){const t="day"===r?e.getDay():Ne.get(e,r);if(i&&t<i||o&&t>=o)return!0}})}initExclusion(){Object.entries(this.include).forEach(([e,t])=>{if(t){const{from:n,to:r}=t;t.lengthFactor=Ne.getUnitToBaseUnitRatio(e,Ne.getLargerUnit(e))/(r-n),t.lengthFactorExcl=Ne.getUnitToBaseUnitRatio(e,Ne.getLargerUnit(e))/(r-n-1),t.center=n+n/(t.lengthFactor-1)}})}generateTicks(e,t,n=this.unit,r=this.increment){const s=this,i=[],o=Boolean(s.include);let a,l,c,d=0,{startDate:u,endDate:h}=s.getAdjustedDates(e,t);for(s.tickCache={},o&&s.initExclusion();u<h;){if(a=Ne.getNext(u,n,r,s.weekStartDay),!s.autoAdjust&&a>h&&(a=h),"hour"===n&&r>1&&i.length>0&&0===d){const e=i[i.length-1];0!=(d=(e.startDate.getHours()+r)%24-e.endDate.getHours())&&(a=Ne.add(a,d,"hour"))}c=!1,o?(l=new Date(a.getTime()),c=s.processExclusion(u,a,n)):l=a,s.generateTicksValidatorFn(u)&&!c&&(i.push({startDate:u,endDate:a}),s.tickCache[u.getTime()]=i.length-1),u=l}return i}get visibleTickTimeSpan(){return this.isContinuous?this.visibleTickEnd-this.visibleTickStart:this.count}getTickFromDate(e){const t=this,n=t.records;let r,s,i,o,a=0,l=n.length-1;if(!n.length||e<n[0].startDate||e>n[l].endDate)return-1;if(t.isContinuous){for(;a<l;)e>n[r=a+l+1>>1].endDate?a=r+1:e<n[r].startDate?l=r-1:a=r;return o=(s=n[a]).endDate,e>(i=s.startDate)&&(a+=(e-i)/(o-i)),Math.min(Math.max(a,t.visibleTickStart),t.visibleTickEnd)}for(let c=0;c<=l;c++)if(e<=(o=n[c].endDate))return c+(e>(i=n[c].startDate)?(e-i)/(o-i):0)}getDateFromTick(e,t){const n=this;if(e===n.visibleTickEnd)return n.endDate;const r=Math.floor(e),s=e-r,i=n.getAt(r);if(!i)return null;let o=0===r?n.adjustedStart:i.startDate,a=Ne.add(o,s*((r===n.count-1&&n.isContinuous?n.adjustedEnd:i.endDate)-o),"millisecond");return t&&(a=n[t+"Date"](a)),a}get ticks(){return this.records}updateTickCache(e=!1){const t=this;t.count?(t._start=t.first.startDate,t._end=t.last.endDate,t._startMS=t.startDate.getTime(),t._endMS=t.endDate.getTime()):t._start=t._end=t._startMs=t._endMS=null,e||(t.tickCache={},t.forEach((e,n)=>t.tickCache[e.startDate.getTime()]=n))}dateInAxis(e,t=!1){const n=this,r=n.startDate,s=n.endDate;if(n.isContinuous)return t?Ne.betweenLesserEqual(e,r,s):Ne.betweenLesser(e,r,s);{let r,s,i,o=n.getCount();for(let a=0;a<o;a++)if(r=(i=n.getAt(a)).startDate,s=i.endDate,t&&e<=s||!t&&e<s)return e>=r}return!1}timeSpanInAxis(e,t){const n=this;return t.getTime()===e.getTime()?this.dateInAxis(e,!0):n.isContinuous?Ne.intersectSpans(e,t,n.startDate,n.endDate):e<n.startDate&&t>n.endDate||n.getTickFromDate(e)!==n.getTickFromDate(t)}isTimeSpanInAxis(e){const t=this,n=e.startDateMS,r=e.endDateMS;return!(!n||!r)&&(r===n?this.dateInAxis(e.startDate,!0):t.isContinuous?r>t.startMS&&n<t.endMS:n<t.startMS&&r>t.endMS||t.getTickFromDate(e.startDate)!==t.getTickFromDate(e.endDate))}forEachAuxInterval(e,t=1,n,r=this){let s,i=this.endDate,o=this.startDate,a=0;if(o>i)throw new Error("Invalid time axis configuration");for(;o<i;)s=Ne.min(Ne.getNext(o,e,t,this.weekStartDay),i),n.call(r,o,s,a),o=s,a++}}return e._$name="TimeAxis",e}();To.registerFeature(function(){class e extends ur{static get properties(){return{tickColor:"#e6e6e6",majorTickColor:"#999",tickStyle:"solid",majorTickStyle:"solid"}}static get pluginConfig(){return{after:["render","updateCanvasSize"]}}construct(e,t){e.useBackgroundCanvas=!0,super.construct(e,t),this.timeAxisViewModel=e.timeAxisViewModel,e.on({theme:"onThemeChange",thisObj:this})}doDestroy(){this.timeAxisViewModelDetatcher&&this.timeAxisViewModelDetatcher(),super.doDestroy()}getColorsFromCSS(){const e=this;if(!e.GotColors){const t=yt.createElement({style:"position: absolute; visibility: hidden",html:'<div class="b-column-line"></div><div class="b-column-line-major"></div>',parent:document.body}),n=yt.getStyleValue(t.firstElementChild,"border-left-color"),r=yt.getStyleValue(t.lastElementChild,"border-left-color"),s=yt.getStyleValue(t.firstElementChild,"border-left-style"),i=yt.getStyleValue(t.lastElementChild,"border-left-style");n&&(e.tickColor=n),r&&(e.majorTickColor=r),s&&(e.tickStyle=s),i&&(e.majorTickStyle=i),t.remove(),e.GotColors=!0}}onThemeChange(){this.GotColors=!1,this.render()}render(){this.getColorsFromCSS(),this.drawLines()}drawLines(){if(!this.client.timeAxis.startDate)return;const e=this,{client:t}=e,{timeAxis:n}=t,r=n.startDate,s=t.timeAxisViewModel,i=s.tickSize,o=t.backgroundCanvas,a=document.createElement("canvas"),l=a.getContext("2d"),c=s.headerConfig[s.columnLinesFor],d=s.headers,u=d[d.indexOf(c)-1]||d[0],h=d[d.length-1],g=n.floorDate(r,!1,u.unit,"year"===u.unit?1:u.increment||1),m=Ne.getNext(g,u.unit,u.increment||1,n.weekStartDay),p=Math.round(Ne.getDurationInUnit(g,m,h.unit))/(h.increment||1),f=Math.round(Ne.getDurationInUnit(g,m,c.unit))/(c.increment||1),v=p/f;if(t.isHorizontal){if(r){const t=d.length>1&&Ne.doesUnitsAlign(u.unit,c.unit),m=t?g:n.floorDate(r,!1,c.unit,c.increment),y=n.isContinuous?Ne.getDurationInUnit(m,r,h.unit,!0)/n.increment*i:0,b=10,C=20;yt.removeEachSelector(o,".b-column-line-major");let w=!1,S=!0;c!==u&&t&&"day"===h.unit&&-1!==Ne.compareUnits(u.unit,"month")&&(S=!1,n.forEachAuxInterval(u.unit,u.increment,(e,t)=>{yt.append(o,{tag:"div",className:"b-column-line-major",style:`left:${s.getPositionFromDate(t)-1}px;`})})),a.width=Math.min(2*p*i,32767),a.height=C,l.translate(-.5,-.5),l.lineWidth=2;for(let r=0;r<f;r++){const s=(w=0===r&&u!==c&&t&&S&&n.isContinuous)&&e.majorTickStyle||!w&&e.tickStyle;if("solid"!==s)switch(s){case"dashed":l.setLineDash([6,4]);break;case"dotted":l.setLineDash([2,3])}l.beginPath(),l.strokeStyle=w?e.majorTickColor:e.tickColor,l.moveTo(r*v*i*2+b-1,0),l.lineTo(r*v*i*2+b-1,C+2),l.stroke()}o.style.backgroundImage=`url(${a.toDataURL()})`,o.style.backgroundSize=`${a.width/2}px`,o.style.backgroundPositionX=`${-(b/2+y)}px`}}else{if(a.width=2*t.timeAxisColumn.resourceColumns.columnWidth,a.height=2,l.translate(-.5,-.5),l.lineWidth=2,r){if(yt.removeEachSelector(o,".b-column-line-major"),c!==u&&n.forEachAuxInterval(u.unit,u.increment,(e,t)=>{yt.append(o,{tag:"div",className:"b-column-line-major",style:`top:${s.getPositionFromDate(t)-1}px;`})}),"solid"!==e.tickStyle)switch(e.tickStyle){case"dashed":l.setLineDash([6,4]);break;case"dotted":l.setLineDash([2,3])}const t=v*i*2;a.height=t,l.beginPath(),l.strokeStyle=e.tickColor,l.lineWidth=2,l.moveTo(0,t-1),l.lineTo(a.width+2,t-1),l.stroke()}l.beginPath(),l.strokeStyle=e.tickColor,l.moveTo(a.width-1,0),l.lineTo(a.width-1,a.height+2),l.stroke(),o.style.backgroundImage=`url(${a.toDataURL()})`,o.style.backgroundSize=`${a.width/2}px`,o.style.backgroundPositionX="0"}}updateCanvasSize(){this.drawLines()}}return e._$name="ColumnLines",e}(),!0,["Scheduler","Gantt"]);var $a=e=>(class extends(U(e||W)){static get defaultConfig(){return{showCreationTooltip:!0,creationTooltip:null,terminalCls:"b-sch-terminal",terminalSides:["left","top","right","bottom"],allowCreate:!0}}construct(e,t){super.construct(e,t);const n=this;n.view=e,n.eventName=e.scheduledEventName,n.view.on("readOnly",()=>n.updateCreateListeners()),n.updateCreateListeners()}doDestroy(){const e=this;e.listenersDetacher&&e.listenersDetacher(),e.abort(),e.creationTooltip&&e.creationTooltip.destroy(),super.doDestroy()}updateCreateListeners(){const e=this;e.view&&(e.listenersDetacher&&e.listenersDetacher(),e.listenersDetacher=null,e.isCreateAllowed&&(e.listenersDetacher=e.view.on({[`${e.eventName}mouseenter`]:e.onTimeSpanMouseEnter,[`${e.eventName}mouseleave`]:e.onTimeSpanMouseLeave,thisObj:e})))}set allowCreate(e){this._allowCreate=e,this.updateCreateListeners()}get allowCreate(){return this._allowCreate}get isCreateAllowed(){return this.allowCreate&&!this.view.readOnly&&!this.disabled}onTimeSpanMouseEnter(e){this.showTerminals(e[`${this.eventName}Record`],yt.down(e[`${this.eventName}Element`],e.source.eventInnerSelector))}onTimeSpanMouseLeave(e){const t=e[`${this.eventName}Element`];this.creationData&&yt.isDescendant(t,this.creationData.sourceTerminal.parentElement)||this.hideTerminals(t)}onTerminalMouseOut(e){const t=this,n=yt.up(e.target,t.view.eventSelector);yt.isDescendant(n,t.showingTerminalsFor)||t.creationData&&n===t.creationData.sourceTerminal.parentElement||(t.hideTerminals(n),t.view.unhover(e))}onTerminalMouseDown(e){if(0===e.button){const t=this,n=t.view,r=n.timeAxisSubGridElement,s=e.target,i=s.parentElement.closest(n.eventSelector),o=oe.from(n.element,document.body);e.preventDefault(),e.stopPropagation(),t.creationData={source:n.resolveTimeSpanRecord(i),sourceTerminal:s,startPoint:oe.from(s,r).center,startX:e.pageX-o.x+n.scrollLeft,startY:e.pageY-o.y+n.scrollTop,valid:!1},n.resolveResourceRecord&&(t.creationData.sourceResource=n.resolveResourceRecord(i)),t.mouseDetacher=Kt.on({mouseup:{element:document.body,handler:"onMouseUp"},mousemove:{element:r,handler:"onMouseMove"},thisObj:t})}}onMouseMove(e){const t=this,n=t.view,r=t.creationData,s=oe.from(n.element,document.body),i=e.pageX-s.x+n.scrollLeft-r.startX,o=e.pageY-s.y+n.scrollTop-r.startY,a=Math.round(Math.sqrt(i*i+o*o))-3,l=Math.atan2(o,i);if(!t.connector){if(!1===n.trigger("beforeDependencyCreateDrag",{data:t.creationData}))return void t.abort();t.createConnector(r.startPoint.x,r.startPoint.y),n.trigger("dependencyCreateDragStart",{data:t.creationData})}if(t.connector.style.width=`${a}px`,t.connector.style.transform=`rotate(${l}rad)`,e.target.matches(`.${t.terminalCls}`)&&e.target!==r.sourceTerminal){r.targetTerminal=e.target,r.target=n.resolveTimeSpanRecord(e.target),n.resolveResourceRecord&&(r.targetResource=n.resolveResourceRecord(e.target));const s=r.sourceTerminal.dataset.side,i=r.targetTerminal.dataset.side,o=n=>{r.valid=n,e.target.classList.add(n?"b-valid":"b-invalid"),t.connector.classList.add(n?"b-valid":"b-invalid")};let a;switch(!0){case"left"===s&&"left"===i:a=Ma.Type.StartToStart;break;case"left"===s&&"right"===i:a=Ma.Type.StartToEnd;break;case"right"===s&&"left"===i:a=Ma.Type.EndToStart;break;case"right"===s&&"right"===i:a=Ma.Type.EndToEnd}r.valid=n.dependencyStore.isValidDependency(r.source.id,r.target.id,a),r.valid instanceof Promise?r.valid.then(o):o(r.valid)}else r.target=r.targetTerminal=null,r.valid=!1,t.connector.classList.remove("b-valid"),t.connector.classList.remove("b-invalid");t.lastMouseMoveEvent=e}onMouseUp(e){const t=this,n=t.creationData,r=e.target;n.valid&&r.matches(`.${t.terminalCls}`)?(n.targetTerminal=r,t.createDependency(),n.valid=!0,t.view.trigger("dependencyCreateDrop",{data:n})):n.valid=!1,t.view.trigger("afterDependencyCreateDrop",{data:n}),t.abort()}abort(){const e=this,{view:t,creationData:n}=e;if(n){const{source:r,sourceResource:s,target:i,targetResource:o}=n;if(r){const n=t.getElementFromEventRecord(r,s);n&&e.hideTerminals(n)}if(i){const n=t.getElementFromEventRecord(i,o);n&&e.hideTerminals(n)}}e.creationData=null,e.mouseDetacher&&e.mouseDetacher(),e.removeConnector()}createConnector(e,t){const n=this,r=n.view;n.connector=yt.createElement({parent:r.timeAxisSubGridElement,className:`${n.baseCls}-connector`,style:`left:${e}px;top:${t}px`}),r.element.classList.add("b-creating-dependency"),n.showCreationTooltip&&(n.creationTooltip?n.creationTooltip.show():n.creationTooltip=new er(Object.assign({id:`${r.id}-dependency-drag-tip`,cls:"b-sch-dependency-creation-tooltip",autoShow:!0,anchorToTarget:!1,trackMouse:!0,constrainTo:null,onBeforeAlign:e=>n.updateTipContent(e.source,n.creationData),header:{dock:"right"}},n.creationTooltip||{}))),r.scrollManager.startMonitoring({element:r.timeAxisSubGridElement,callback:()=>n.creationData&&n.lastMouseMoveEvent&&n.onMouseMove(n.lastMouseMoveEvent),thisObj:n})}removeConnector(e){const t=this,{connector:n,view:r}=t;n&&(n.classList.add("b-removing"),n.style.width="0",t.setTimeout(()=>{n.remove(),t.connector=null,e&&e.call(t)},200)),r.element.classList.remove("b-creating-dependency"),t.creationTooltip&&t.creationTooltip.hide(),r.scrollManager.stopMonitoring(r.timeAxisSubGridElement)}showTerminals(e,t){const n=this;if(!n.isCreateAllowed)return;const r=n.terminalCls,s=`${r}s-visible`;(t=yt.down(t,n.view.eventInnerSelector)).classList.contains(s)||this.view.element.classList.contains("b-resizing-event")||n.view.readOnly||(n.terminalSides.forEach(e=>{const s=yt.createElement({parent:t,className:`${r} ${r}-${e}`,dataset:{side:e,feature:!0}});s.detacher=Kt.on({element:s,mouseout:"onTerminalMouseOut",mousedown:{handler:"onTerminalMouseDown",capture:!0},thisObj:n})}),t.classList.add(s),e.cls.add(s),n.showingTerminalsFor=t)}hideTerminals(e){const t=this,n=t.client.getTimeSpanMouseEventParams(e)[`${this.eventName}Record`],r=`${t.terminalCls}s-visible`;yt.forEachSelector(e,`.${t.terminalCls}`,e=>{e.detacher&&e.detacher(),e.remove()}),yt.down(e,t.view.eventInnerSelector).classList.remove(r),n.cls.remove(r),t.showingTerminalsFor=null}createDependency(){const e=this.creationData,t=e.sourceTerminal.dataset.side,n=e.targetTerminal.dataset.side;this.store.add({from:e.source.id,to:e.target.id,type:("left"===t?0:2)+("right"===n?1:0),fromSide:t,toSide:n})}updateTipContent(e,t){const n=this;let r,s,{valid:i}=t;Object.assign(t,{fromText:t.source.name,toText:t.target?t.target.name:"",fromSide:t.sourceTerminal.dataset.side,toSide:t.targetTerminal?t.targetTerminal.dataset.side:""}),i instanceof Promise?(e.element.classList.remove("b-invalid"),e.element.classList.add("b-checking"),r="checking",s=n.L("Checking"),i.then(r=>{t.valid=r,e.isDestroyed||n.updateTipContent(e,t)})):!0===i?(e.element.classList.remove("b-invalid"),e.element.classList.remove("b-checking"),r="valid",s=n.L("valid")):(e.element.classList.remove("b-checking"),e.element.classList.add("b-invalid"),r="invalid",s=n.L("invalid")),e.titleElement.innerHTML=`<i class="b-icon b-icon-${r}"></i>${s}`,e.html=`<table class="b-sch-dependency-creation-tooltip">\n                        <tr><td>${n.L("from")}: </td><td>${t.fromText}</td><td><div class="b-sch-box b-${t.fromSide}"></div></td></tr>\n                        <tr><td>${n.L("to")}: </td><td>${t.toText}</td><td><div class="b-sch-box b-${t.toSide}"></div></td></tr>\n                    </table>`}});const ja=function(){class e{static preWalk(e,t,n){let r,s,i=[e];for(;i.length;)n(r=i.pop()),(s=t(r))&&(i=i.concat(s.slice().reverse()))}static preWalkUnordered(e,t,n){let r,s,i=[e];for(;i.length;)n(r=i[i.length-1]),(s=t(r))?i.splice(i.length-1,1,...s):i.length=i.length-1}static postWalk(e,t,n){let r,s,i=new Map,o=[e];for(;o.length;)i.has(r=o[o.length-1])?(n(r),o.pop()):((s=t(r))&&(o=o.concat(s.slice().reverse())),i.set(r,r))}static prePostWalk(e,t,n,r){let s,i,o=new Map,a=[e];for(;a.length;)o.has(s=a[a.length-1])?(r(s),a.pop()):(n(s),(i=t(s))&&(a=a.concat(i.slice().reverse())),o.set(s,s))}}return e._$name="WalkHelper",e}(),Ha=function(){class e extends W{static get defaultConfig(){return{startSide:"right",startArrowSize:0,startArrowMargin:12,startShift:0,endSide:"left",endArrowSize:0,endArrowMargin:12,endShift:0,verticalMargin:2,horizontalMargin:5,otherBoxes:null}}findPath(e,t){let n,r,s,i,o,a,l,c,d,u,h,g,m,p,f,v,y,b,C,w,S,D,E,x,T,R,k,M,I,A,F,O=this;for(t&&!Array.isArray(t)&&(t=[t]),F=0;e&&!A;)for(r=(n=Object.assign(O.config,e)).startBox,s=n.endBox,i=n.startShift,o=n.endShift,a=n.startSide,l=n.endSide,c=n.startArrowSize,d=n.endArrowSize,u=n.startArrowMargin,h=n.endArrowMargin,g=n.horizontalMargin,m=n.verticalMargin,p=n.hasOwnProperty("startHorizontalMargin")?n.startHorizontalMargin:g,f=n.hasOwnProperty("startVerticalMargin")?n.startVerticalMargin:m,v=n.hasOwnProperty("endHorizontalMargin")?n.endHorizontalMargin:g,y=n.hasOwnProperty("endVerticalMargin")?n.endVerticalMargin:m,b=n.hasOwnProperty("otherHorizontalMargin")?n.otherHorizontalMargin:g,C=n.hasOwnProperty("otherVerticalMargin")?n.otherVerticalMargin:m,w=n.otherBoxes,a=O.normalizeSide(a),l=O.normalizeSide(l),S=O.getConnectionCoordinatesFromBoxSideShift(r,a,i),D=O.getConnectionCoordinatesFromBoxSideShift(s,l,o),k=O.calcGridBaseBoxFromBoxAndDrawParams(r,a,c,u,p,f),M=O.calcGridBaseBoxFromBoxAndDrawParams(s,l,d,h,v,y),w=w&&w.map(e=>O.calcGridBaseBoxFromBoxAndDrawParams(e,!1,0,0,b,C)),E=O.getConnectionCoordinatesFromBoxSideShift(k,a,i),x=O.getConnectionCoordinatesFromBoxSideShift(M,l,o),I=O.buildPathGrid(k,M,E,x,a,l,w),T=O.convertDecartPointToGridPoint(I,E),R=O.convertDecartPointToGridPoint(I,x),A=O.findPathOnGrid(I,T,R,a,l),e=!1;!A&&!e&&t&&F<t.length;F++)e=t[F](n);return A&&(A=O.prependPathWithArrowStaffSegment(A,S,c,a),A=O.appendPathWithArrowStaffSegment(A,D,d,l),A=O.optimizePath(A)),A}getConnectionCoordinatesFromBoxSideShift(e,t,n){let r;switch(t){case"left":r={x:e.start,y:(e.top+e.bottom)/2+n};break;case"right":r={x:e.end,y:(e.top+e.bottom)/2+n};break;case"top":r={x:(e.start+e.end)/2+n,y:e.top};break;case"bottom":r={x:(e.start+e.end)/2+n,y:e.bottom}}return r}calcGridBaseBoxFromBoxAndDrawParams(e,t,n,r,s,i){let o;switch(t){case"left":o={start:e.start-Math.max(n+r,s),end:e.end+s,top:e.top-i,bottom:e.bottom+i};break;case"right":o={start:e.start-s,end:e.end+Math.max(n+r,s),top:e.top-i,bottom:e.bottom+i};break;case"top":o={start:e.start-s,end:e.end+s,top:e.top-Math.max(n+r,i),bottom:e.bottom+i};break;case"bottom":o={start:e.start-s,end:e.end+s,top:e.top-i,bottom:e.bottom+Math.max(n+r,i)};break;default:o={start:e.start-s,end:e.end+s,top:e.top-i,bottom:e.bottom+i}}return o}buildPathGrid(e,t,n,r,s,i,o){let a,l,c,d,u,h,g,m,p,f,v,y,b,C={},w=[];for(a=[e.start,"left"===s||"right"===s?(e.start+e.end)/2:n.x,e.end,t.start,"left"===i||"right"===i?(t.start+t.end)/2:r.x,t.end],l=[e.top,"top"===s||"bottom"===s?(e.top+e.bottom)/2:n.y,e.bottom,t.top,"top"===i||"bottom"===i?(t.top+t.bottom)/2:r.y,t.bottom],o&&o.forEach(e=>{a.push(e.start,(e.start+e.end)/2,e.end),l.push(e.top,(e.top+e.bottom)/2,e.bottom)}),a=[...new Set(a.sort((e,t)=>e-t))],h=0,m=(l=[...new Set(l.sort((e,t)=>e-t))]).length;h<m;++h)for(C[h]=C[h]||{},c=l[h],u=0,g=a.length;u<g;++u){if(y=((d=a[u])<=e.start||d>=e.end||c<=e.top||c>=e.bottom)&&(d<=t.start||d>=t.end||c<=t.top||c>=t.bottom),o)for(p=0,f=o.length;y&&p<f;++p)y=d<=(v=o[p]).start||d>=v.end||c<=v.top||c>=v.bottom||d===n.x&&c===n.y||d===r.x&&c===r.y;b={distance:Math.pow(2,53)-1,permitted:y,x:d,y:c,ix:u,iy:h},C[h][u]=b,w.push(b)}return{width:a.length,height:l.length,xs:a,ys:l,points:C,linearPoints:w}}convertDecartPointToGridPoint(e,t){let n=e.xs.indexOf(t.x),r=e.ys.indexOf(t.y);return e.points[r][n]}findPathOnGrid(e,t,n,r,s){let i=!1;return t.permitted&&n.permitted&&(e=this.waveForward(e,t,0),i=this.collectPath(e,n,s)),i}getGridPointNeighbors(e,t,n){let r,s=t.ix,i=t.iy,o=[];return i<e.height-1&&(r=e.points[i+1][s],(!n||n(r))&&o.push(r)),i>0&&(r=e.points[i-1][s],(!n||n(r))&&o.push(r)),s<e.width-1&&(r=e.points[i][s+1],(!n||n(r))&&o.push(r)),s>0&&(r=e.points[i][s-1],(!n||n(r))&&o.push(r)),o}waveForward(e,t,n){const r=this;return ja.preWalkUnordered([t,n],([t,n])=>r.getGridPointNeighbors(e,t,e=>e.permitted&&e.distance>n+1).map(e=>[e,n+1]),([e,t])=>e.distance=t),e}collectPath(e,t,n){let r,s,i,o,a=this,l=!0,c=[];for(;l&&t.distance;)if(l=(r=a.getGridPointNeighbors(e,t,e=>e.permitted&&e.distance==t.distance-1)).length>0){switch(r=r.sort((e,r)=>{let s,i;s=e.ix-t.ix,i=e.iy-t.iy;let o=("left"===n||"right"===n)&&0===i||("top"===n||"bottom"===n)&&0===s?-1:1;s=r.ix-t.ix,i=r.iy-t.iy;let a=("left"===n||"right"===n)&&0===i||("top"===n||"bottom"===n)&&0===s?-1:1;return o>a?1:o<a?-1:o===a?e.y>r.y?-1:1:void 0}),c.push({x1:(s=r[0]).x,y1:s.y,x2:t.x,y2:t.y}),i=s.ix-t.ix,o=s.iy-t.iy,!0){case!o&&i>0:n="left";break;case!o&&i<0:n="right";break;case!i&&o>0:n="top";break;case!i&&o<0:n="bottom"}t=s}return l&&c.reverse()||!1}prependPathWithArrowStaffSegment(e,t,n,r){let s,i;if(e.length>0){switch(s={x2:(i=e[0]).x1,y2:i.y1},r){case"left":s.x1=t.x-n,s.y1=i.y1;break;case"right":s.x1=t.x+n,s.y1=i.y1;break;case"top":s.x1=i.x1,s.y1=t.y-n;break;case"bottom":s.x1=i.x1,s.y1=t.y+n}e.unshift(s)}return e}appendPathWithArrowStaffSegment(e,t,n,r){let s,i;if(e.length>0){switch(s={x1:(i=e[e.length-1]).x2,y1:i.y2},r){case"left":s.x2=t.x-n,s.y2=i.y2;break;case"right":s.x2=t.x+n,s.y2=i.y2;break;case"top":s.x2=i.x2,s.y2=t.y-n;break;case"bottom":s.x2=i.x2,s.y2=t.y+n}e.push(s)}return e}optimizePath(e){let t,n,r=[];if(e.length>0)for(t=e.shift(),r.push(t);e.length>0;)n=e.shift(),t.x1==n.x1&&t.y1==n.y1&&t.x2==n.x2&&t.y2==n.y2?t=n:t.y1-t.y2==0&&n.y1-n.y2==0?t.x2=n.x2:t.x1-t.x2==0&&n.x1-n.x2==0?t.y2=n.y2:(r.push(n),t=n);return r}normalizeSide(t){return e.sideToSide[t]||t}static get sideToSide(){return{l:"left",r:"right",t:"top",b:"bottom"}}}return e._$name="RectangularPathFinder",e}(),Na=["left","left","right","right"],za=["left","right","left","right"],Ba=function(){class e extends($a(U(ur))){static get defaultConfig(){return{pathFinderConfig:null,overCls:"b-sch-dependency-over",baseCls:"b-sch-dependency",store:!1,dependencies:null,highlightDependenciesOnEventHover:!1,showTooltip:!0,tooltip:null,bufferSize:50,cacheGridSize:{x:500,index:25},drawnDependencies:[],drawnLines:[],dependenciesToRefresh:new Map,storeClass:Aa}}static get pluginConfig(){return{chain:["render","renderContents","onElementClick","onElementDblClick","onElementMouseOver","onElementMouseOut"],assign:["getElementForDependency","getDependencyForElement"]}}construct(e,t={}){const n=this;if(n.scheduler=e,e.isVertical)throw new Error("Dependencies feature is not supported in vertical mode");n.doScheduleDraw=n.createOnFrame("draw",[],n,!0),e.dependencyStore&&(t.store=e.dependencyStore),super.construct(e,t),e.store.on({refresh:n.onRowStoreRefresh,thisObj:n}),e.rowManager.on({translaterow:n.onTranslateRow,refresh:n.onRowsRefresh,rerender:n.onRowsRerender,changetotalheight:n.onChangeTotalHeight,thisObj:n}),e.on({horizontalscroll:n.onHorizontalScroll,svgcanvascreated:n.createMarkers,togglenode:n.onToggleNode,scroll:n.onVerticalScroll,timelineviewportresize:n.onViewportResize,thisObj:n}),n.bindEventStoreListeners(),n.pathFinder=new Ha(n.pathFinderConfig),delete n.pathFinderConfig,n.lineDefAdjusters=n.createLineDefAdjusters(),Object.defineProperty(e,"dependencies",{configurable:!0,get:()=>n.store.records,set:e=>n.store.data=e})}set store(e){const t=this,{client:n}=t;e!==t._store&&(t._store=e||(e=new this.storeClass),t._detachStoreEvents&&t._detachStoreEvents(),n.dependencyStore||(n._dependencyStore=e),e&&(n.dependencies&&(e.add(n.dependencies),delete n.dependencies),t.dependencies&&(e.add(t.dependencies),delete t.dependencies),e.metaMapId=n.id,e.eventStore=n.eventStore,t._detachStoreEvents=e.on({change:t.onDependencyChange,eventstorechange:t.bindEventStoreListeners,detachable:!0,thisObj:t})))}get store(){return this._store}doDestroy(){this.tooltip&&this.tooltip.destroy(),super.doDestroy()}createMarkers(){const e=this,t=e.client.svgCanvas,n=e.endMarker=e.initMarkerElement("arrowEnd","8","M0,0 L0,6 L9,3 z");if(G.isEdge||G.isIE11){const n=e.startMarker=e.initMarkerElement("arrowStart","1","M0,3 L9,6 L9,0 z");t.appendChild(n)}else n.setAttribute("orient","auto-start-reverse");t.appendChild(n)}initMarkerElement(e,t,n){return yt.createElement({id:e,tag:"marker",ns:"http://www.w3.org/2000/svg",markerHeight:9,markerWidth:9,refX:t,refY:3,viewBox:"0 0 9 6",orient:"auto",markerUnits:"userSpaceOnUse",children:[{tag:"path",ns:"http://www.w3.org/2000/svg",d:n}]})}createLineDefAdjusters(){const e=this.client;return[function(t){let n=!1;return(t.startArrowMargin>e.barMargin||t.endArrowMargin>e.barMargin)&&(t.startArrowMargin=t.endArrowMargin=e.barMargin,n=!0),n?t:n},function(e){let t=!1;return(e.startArrowMargin>0||e.endArrowMargin>0)&&(e.startArrowMargin=e.endArrowMargin=0,t=!0),t?e:t}]}getElementForDependency(e,t=null){let n=`[depId="${e.id}"]`;return t&&(n+=`[fromId="${t.from.id}"][toId="${t.to.id}"]`),this.client.svgCanvas.querySelector(n)}getDependencyForElement(e){const t="string"==typeof e?e:e.getAttribute("depId");return this.store.getById(t)}onToggleNode(){this.dependencyGridCache=null,this.scheduleDraw(!0)}onViewportResize(){this.scheduleDraw(!0)}onTranslateRow({row:e}){e.lastTop>=0&&e.top!==e.lastTop&&this.scheduleDraw(!0)}onChangeTotalHeight(){this.scheduleDraw(!0)}onHorizontalScroll(){this.isDrawn&&this.scheduleDraw(!1)}onVerticalScroll(){this.isDrawn&&this.scheduleDraw(!1)}onRowsRefresh(){this.scheduleDraw(!0)}onRowsRerender(){this.scheduleDraw(!0)}onRowStoreRefresh({action:e}){switch(e){case"sort":case"filter":case"batch":return this.dependencyGridCache=null,this.scheduleDraw(!0)}}onDependencyChange({action:e,record:t,records:n}){const r=this;if(r.scheduler.rendered&&!r.disabled){switch(e){case"dataset":r.dependencyGridCache={};case"add":const s=r._dependencyGridCache;return n.forEach(e=>{s&&r.addToGridCache(e)}),s||r._thisIsAUsedExpression(r.dependencyGridCache),void r.scheduleDraw();case"update":return r.scheduleRefreshDependency(t);case"remove":return n.forEach(e=>{r.releaseDependency(e,!0),r.removeFromCache(e)}),void r.client.trigger("dependenciesDrawn");case"removeall":case"filter":r.dependencyGridCache=null}r.scheduleDraw(!0)}}bindEventStoreListeners(){const e=this;e._eventStoreListenersDetacher&&e._eventStoreListenersDetacher(),e._eventStoreListenersDetacher=e.store.eventStore.on({change:e.onEventChange,thisObj:e})}onEventChange({action:e,record:t}){switch(e){case"filter":return this.scheduleDraw(!0);case"update":return this.drawForTimeSpan(t,!0);case"removeall":return this.resetGridCache(),this.scheduleDraw(!0)}}onAssignmentRefresh({action:e}){"dataset"===e&&(this.resetGridCache(),this.scheduleDraw(!0))}onAssignmentChange({action:e,record:t,records:n}){const r=this;t&&(n=[t]),"add"!==e&&"remove"!==e&&"update"!==e||n.forEach(n=>{(n.event?r.store.getEventDependencies(n.event):[]).forEach(s=>{if("add"===e)r.scheduleRefreshDependency(s);else if("remove"===e){let e;(e=s.from===n.eventId?s.targetEvent.assignments.map(e=>({from:n,to:e})):s.sourceEvent.assignments.map(e=>({from:e,to:n}))).forEach(e=>{r.releaseDependency(s,e),r.removeFromCache(s,e)})}else"update"===e&&r.getDependencyAssignments(s).filter(e=>e&&(e.from===t||e.to===t)).forEach(e=>{r.scheduleRefreshDependency(s,e)})})})}onElementClick(e){const t=this;if(e.target.matches("."+t.baseCls)){const n=fs.get(e.target).dependency;t.client.trigger(`dependency${"click"===e.type?"Click":"DblClick"}`,{dependency:n,event:e})}}onElementDblClick(e){return this.onElementClick(e)}onElementMouseOver(e){const t=this;if(e.target.matches("."+t.baseCls)){const n=fs.get(e.target).dependency;t.client.trigger("dependencyMouseOver",{dependency:n,event:e}),t.overCls&&t.highlight(n,t.overCls)}}onElementMouseOut(e){const t=this;if(e.target.matches("."+t.baseCls)){const n=fs.get(e.target).dependency;t.client.trigger("dependencyMouseOut",{dependency:n,event:e}),t.overCls&&!n.meta.removed&&t.unhighlight(n)}}highlight(e,t=this.overCls){const n=this.getElementForDependency(e);n&&n.classList.add(t),e.highlight(t)}unhighlight(e,t=this.overCls){const n=this.getElementForDependency(e);n&&n.classList.remove(t),e.unhighlight(t)}highlightEventDependencies(e){e.allDependencies.forEach(e=>this.highlight(e))}unhighlightEventDependencies(e){e.allDependencies.forEach(e=>this.unhighlight(e))}isDependencyVisible(e,t=null){const n=e.sourceEvent,r=e.targetEvent;if(!n||!r)return!1;let s,i;if(t){s=t.from.resource,i=t.to.resource;const{eventStore:e}=this.client;if(e.isFiltered&&(-1===e.indexOf(n)||-1===e.indexOf(r)))return!1}else s=n.resource,i=r.resource;return n instanceof Sr&&s instanceof wa&&i instanceof wa&&!s.instanceMeta(this.scheduler.store).hidden&&!i.instanceMeta(this.scheduler.store).hidden}getBox(e,t,n=null){const r=this.getTimeSpanRecordFromDependency(e,t);let s;return this.scheduler.getResourceEventBox(r,s=n?n[t?"from":"to"].resource:r.resource,!0)}getRowRecordFromDependency(e,t,n){return n?n[t?"from":"to"].resource:this.getTimeSpanRecordFromDependency(e,t).resource}getTimeSpanRecordFromDependency(e,t=!0){return e[`${t?"source":"target"}Event`]}getMetaId(e=null){return e?`${this.client.id}-ass${e.from.id}-ass${e.to.id}`:this.client.id}getDependencyBounds(e,t=null){const n=this,r=n.client,s=e.getDateRange();if(!r.rowManager.rowCount||!n.isDependencyVisible(e,t))return null;if(!s||!Ne.intersectSpans(s.start,s.end,r.startDate,r.endDate))return null;const i=n.getMetaId(t),o=e.instanceMeta(i);if(n._resetBoundsCache||!o.bounds||!o.bounds.layout){const s=n.getBox(e,!0,t),i=n.getBox(e,!1,t);if(!s||!i)return null;const a=n.getTimeSpanRecordFromDependency(e,!0),l=n.getTimeSpanRecordFromDependency(e,!1),c=new oe(s.start,s.top,s.end-s.start,s.bottom-s.top),d=new oe(i.start,i.top,i.end-i.start,i.bottom-i.top),u=oe.union(c,d);[[a,c,s],[l,d,i]].map(([e,t,n])=>{if("default"===r.milestoneLayoutMode&&e.isMilestone){!r.milestoneWidth&&n.eventEl&&(r.milestoneWidth=e.iconCls?n.eventEl.firstElementChild.offsetWidth:parseInt(window.getComputedStyle(n.eventEl,":before").fontSize));const s=r.milestoneWidth||t.height;t.left-=s/2,t.right+=s/2}}),o.bounds={bounds:u,startRectangle:c,endRectangle:d,layout:s.layout&&i.layout}}return e.instanceMeta(i).bounds}get dependencyGridCache(){const e=this;return e._dependencyGridCache||(e._dependencyGridCache={},e.store.forEach(t=>e.addToGridCache(t))),e._dependencyGridCache}getDependencyAssignments(e){if(!this.client.assignmentStore)return[null];const t=e.sourceEvent&&e.sourceEvent.assignments,n=e.targetEvent&&e.targetEvent.assignments,r=[];return t&&t.forEach(e=>n&&n.forEach(t=>{r.push({from:e,to:t})})),r}addToGridCache(e){const t=this,{dependencyGridCache:n,cacheGridSize:r}=t,s=t.client.store;t.getDependencyAssignments(e).forEach(i=>{const o=t.getDependencyBounds(e,i);if(o){const a=t.getMetaId(i),l=e.instanceMeta(a).gridCache=[],c=s.indexOf(t.getRowRecordFromDependency(e,!0,i)),d=s.indexOf(t.getRowRecordFromDependency(e,!1,i)),u=Math.min(c,d),h=Math.max(c,d),g=o.bounds,m=Math.floor(Math.max(g.x,0)/r.x),p=Math.floor(g.right/r.x),f=Math.floor(u/r.index),v=Math.floor(h/r.index);let y,b,C,w;for(C=m;C<=p;C++)for(y=n[C]||(n[C]={}),w=f;w<=v;w++)(b=y[w]||(y[w]=[])).push({dependency:e,assignmentData:i,metaId:a}),l.push([C,w])}})}removeFromCache(e,t=null){const n=this;(t?[t]:n.getDependencyAssignments(e)).forEach(t=>{const r=n.getMetaId(t),s=e.instanceMeta(r);s.gridCache&&n._dependencyGridCache&&s.gridCache.forEach(([r,s])=>{if(n._dependencyGridCache.hasOwnProperty(r)&&n._dependencyGridCache[r].hasOwnProperty(s)){const i=n._dependencyGridCache[r][s],o=i.findIndex(n=>n.dependency===e&&(n.assignmentData===t||n.assignmentData.from===t.from&&n.assignmentData.to===t.to));o>-1&&i.splice(o,1)}}),s.bounds=null,s.gridCache=null})}set dependencyGridCache(e){this._dependencyGridCache=e}resetBoundsCache(){this._resetBoundsCache=!0}resetGridCache(){this.dependencyGridCache=null}prepareLineDef(e,t,n=null){const r=this,s=r.getTimeSpanRecordFromDependency(e,!0),i=r.getTimeSpanRecordFromDependency(e,!1),o=e.type;let a=e.fromSide,l=e.toSide;if(!a)switch(!0){case o===Ia.Type.StartToEnd:case o===Ia.Type.StartToStart:a=r.getConnectorStartSide(s);break;case o===Ia.Type.EndToStart:case o===Ia.Type.EndToEnd:a=r.getConnectorEndSide(s);break;default:throw new Error("Invalid dependency type: "+o)}if(!l)switch(!0){case o===Ia.Type.StartToEnd:l=r.getConnectorEndSide(i);break;case o===Ia.Type.StartToStart:case o===Ia.Type.EndToStart:l=r.getConnectorStartSide(i);break;case o===Ia.Type.EndToEnd:l=r.getConnectorEndSide(i);break;default:throw new Error("Invalid dependency type: "+o)}const{startRectangle:c,endRectangle:d}=t;return{startBox:{start:c.x,end:c.right,top:c.y,bottom:c.bottom},endBox:{start:d.x,end:d.right,top:d.y,bottom:d.bottom},startSide:a,endSide:l}}drawLine(e,t,n,r=null){const{client:s}=this,i=this.getMetaId(r);let o=t.instanceMeta(i).lineElement;if(o||((o=t.instanceMeta(i).lineElement=document.createElementNS("http://www.w3.org/2000/svg","polyline")).setAttribute("depId",t.id),r&&(o.setAttribute("fromId",r.from.id),o.setAttribute("toId",r.to.id)),e.appendChild(o)),o.classList.length&&o.classList.remove.apply(o.classList,o.getAttribute("class").split(" ")),o.classList.add(this.baseCls),t.cls&&o.classList.add(t.cls),t.bidirectional&&o.classList.add("b-sch-bidirectional-line"),t.highlighted&&o.classList.add(...t.highlighted.split(" ")),G.isIE11){const e=t.getDateRange(!0),n=s.startDate;e.start<n&&o.classList.add("b-no-start-marker"),e.end<n&&o.classList.add("b-no-end-marker")}o.setAttribute("points",n?n.map((e,t)=>t!==n.length-1?`${e.x1},${e.y1}`:`${e.x1},${e.y1} ${e.x2},${e.y2}`).join(" "):""),fs.set(o,{dependency:t})}refreshDependency(e){const t=this,n=t.getDependencyAssignments(e);t.releaseDependency(e,null!==n[0]),t.removeFromCache(e),t.addToGridCache(e),n.forEach(n=>t.drawDependency(e,null,n))}refreshDependencyAssignment(e,t){this.releaseDependency(e,t),this.removeFromCache(e,t),this.addToGridCache(e),this.drawDependency(e,null,t)}scheduleRefreshDependency(e,t=null){const n=this.dependenciesToRefresh;t?n.has(e)?!0!==n.get(e)&&n.get(e).add(t):n.set(e,new Set([t])):n.set(e,!0),1===n.size&&this.requestAnimationFrame(()=>{this.refreshDependencyOnFrame()})}refreshDependencyOnFrame(){const e=this,t=e.dependenciesToRefresh;t.forEach((t,n)=>{if(!0===t){const t=e.getDependencyAssignments(n);e.releaseDependency(n,null!==t[0]),e.removeFromCache(n)}else t.forEach(t=>{e.releaseDependency(n,t),e.removeFromCache(n,t)})}),t.forEach((t,n)=>{e.addToGridCache(n)}),t.forEach((t,n)=>{!0===t&&(t=e.getDependencyAssignments(n)),t.forEach(t=>{e.drawDependency(n,null,t)})}),t.clear(),e.client.trigger("dependenciesDrawn",{partial:!0})}drawDependency(e,t=null,n=null){const r=this,s=r.client.svgCanvas,{drawnDependencies:i,oldDrawnDependencies:o}=r,a=t||r.getDependencyBounds(e,n),l=t=>t.dependency===e&&(t.assignmentData===n||t.assignmentData.from===n.from&&t.assignmentData.to===n.to);if(!r.disabled&&a){const t=r.prepareLineDef(e,a),o=r.pathFinder.findPath(t,r.lineDefAdjusters);r.drawLine(s,e,o,n),i.some(l)||i.push({dependency:e,assignmentData:n})}const c=o&&o.findIndex(l);c>=0&&o.splice(c,1)}drawForTimeSpan(e,t=!1){const n=this;n.client.isAnimating?n.client.on({transitionend(){n.drawForTimeSpan(e,!0)},once:!0}):n.store.getTimeSpanDependencies(e).forEach(e=>{t?n.scheduleRefreshDependency(e):n.refreshDependency(e)})}drawForEvent(e){this.drawForTimeSpan(e)}updateDependenciesForTimeSpan(e,t){const n=this,r=e.isAssignment?e.event:e,s=n.store.getTimeSpanDependencies(r),i=n.getMetaId(),{client:o}=n,a=oe.from(t,o.timeAxisSubGridElement);let l;s.forEach(t=>{n.getDependencyAssignments(t).forEach(s=>{const o=a.clone();let c,d,u;s&&s.from!==e&&s.to!==e||n.isDependencyVisible(t,s)&&(n.getTimeSpanRecordFromDependency(t,!0)===r?(c=o,(l=t.instanceMeta(i).bounds)?d=l.endRectangle:(u=n.getBox(t,!1,s))&&(d=new oe(u.start,u.top,u.end-u.start,u.bottom-u.top))):((l=t.instanceMeta(i).bounds)?c=l.startRectangle:(u=n.getBox(t,!0,s))&&(c=new oe(u.start,u.top,u.end-u.start,u.bottom-u.top)),d=o),c&&d&&n.drawDependency(t,{startRectangle:c,endRectangle:d},s))})})}scheduleDraw(e=!1){const t=this;e&&t.resetBoundsCache(),t.client.isAnimating?t.clientTransitionRemover||(t.clientTransitionRemover=t.client.on({transitionend(){t.clientTransitionRemover(),t.clientTransitionRemover=null,t.draw()},once:!0})):t.doScheduleDraw()}draw(e=!1){const t=this,{client:n}=t;if(!t.oldDrawnDependencies&&!t.store.count)return;if(n.isAnimating)return void n.on({transitionend(){t.scheduleDraw(!0)},once:!0});const r=t.client.timeAxisSubGrid.viewRectangle;if(e&&t.resetBoundsCache(),t.oldDrawnDependencies=t.drawnDependencies,t.drawnDependencies=[],!r.width||!r.height)return[];if(r.inflate(t.bufferSize),!t.disabled&&n.store.count&&n.rowManager.rowCount){const e={},{dependencyGridCache:s,cacheGridSize:i}=t,o=Math.floor(Math.max(r.left,0)/i.x),a=Math.floor(r.right/i.x),l=Math.floor(n.rowManager.topRow.dataIndex/i.index),c=Math.floor(n.rowManager.bottomRow.dataIndex/i.index),d=[];let u,h,g;for(u=o;u<=a;u++)for(h=l;h<=c;h++){const n=s[u],i=n&&n[h];for(g=0;i&&g<i.length;g++){const{dependency:n,assignmentData:s,metaId:o}=i[g],a=n.id+"-"+o;if(!e[a]){const i=t.getDependencyBounds(n,s);i&&i.bounds.intersect(r,!0)&&d.push([n,i,s]),e[a]=!0}}}d.forEach(([e,n,r])=>{t.drawDependency(e,n,r)})}t._resetBoundsCache=!1,t.oldDrawnDependencies.forEach(e=>t.releaseDependency(e.dependency,e.assignmentData)),n.trigger("dependenciesDrawn"),this.isDrawn=!0}releaseDependency(e,t=null){if(!0===t)Object.keys(e.meta.map||{}).filter(e=>e.startsWith(this.client.id)).forEach(t=>{const n=e.meta.map[t];n.lineElement&&(n.lineElement.remove(),n.lineElement=null)});else{const n=this.getMetaId(t),r=e.instanceMeta(n).lineElement;r&&(e.instanceMeta(n).lineElement=null,r.remove())}}render(){const e=this,t=e.scheduler;e.draw(),e.showTooltip&&(e.tooltip=e.createTooltip()),t.timeAxis.on({endreconfigure:e.resetGridCache,thisObj:e}),t.assignmentStore&&t.assignmentStore.on({change:e.onAssignmentChange,refresh:e.onAssignmentRefresh,thisObj:e}),e.highlightDependenciesOnEventHover&&(t.on(t.scheduledEventName+"MouseEnter",t=>e.highlightEventDependencies(t.eventRecord||t.taskRecord)),t.on(t.scheduledEventName+"MouseLeave",t=>e.unhighlightEventDependencies(t.eventRecord||t.taskRecord)))}renderContents(){this.draw()}getConnectorStartSide(e){return this.client.currentOrientation.getConnectorStartSide(e)}getConnectorEndSide(e){return this.client.currentOrientation.getConnectorEndSide(e)}createTooltip(){const e=this;return new er(Object.assign({align:"b-t",id:`${e.client.id}-dependency-tip`,forSelector:`.b-timelinebase:not(.b-eventeditor-editing):not(.b-resizing-event):not(.b-dragcreating):not(.b-dragging-event):not(.b-creating-dependency) .${e.baseCls}`,clippedBy:[e.client.timeAxisSubGridElement,e.client.bodyContainer],forElement:e.client.timeAxisSubGridElement,showOnHover:!0,hoverDelay:0,hideDelay:0,anchorToTarget:!1,trackMouse:!1,getHtml:e.getHoverTipHtml.bind(e)},e.tooltip||{}))}getHoverTipHtml({forElement:e}){const t=this.getDependencyForElement(e),n=t.sourceEvent,r=t.targetEvent;return Gn.tpl`
             <table class="b-sch-dependency-tooltip">
                <tr>
                    <td>${this.L("from")}: </td>
                    <td>${n.name}</td>
                    <td>
                        <div class="b-sch-box b-${Na[t.type]}"></div>
                    </td>
                </tr>
                <tr>
                    <td>${this.L("to")}: </td>
                    <td>${r.name}</td>
                    <td><div class="b-sch-box b-${za[t.type]}"></div></td>
                </tr>
            </table>
        `}get disabled(){return this._disabled}set disabled(e){this._disabled=e,this.updateCreateListeners(),this.client.rendered&&this.draw()}}return e._$name="Dependencies",e}();To.registerFeature(Ba,!1,"Scheduler"),!document.createElementNS||"classList"in document.createElementNS("http://www.w3.org/2000/svg","g")||function(e){if("Element"in e){var t=e.Element.prototype,n=Object,r=String.prototype.trim||function(){return this.replace(/^\s+|\s+$/g,"")},s=Array.prototype.indexOf||function(e){for(var t=0,n=this.length;t<n;t++)if(t in this&&this[t]===e)return t;return-1},i=function(e,t){this.name=e,this.code=DOMException[e],this.message=t},o=function(e,t){if(""===t)throw new i("SYNTAX_ERR","The token must not be empty.");if(/\s/.test(t))throw new i("INVALID_CHARACTER_ERR","The token must not contain space characters.");return s.call(e,t)},a=function(e){for(var t=r.call(e.getAttribute("class")||""),n=t?t.split(/\s+/):[],s=0,i=n.length;s<i;s++)this.push(n[s]);this._updateClassName=function(){e.setAttribute("class",this.toString())}},l=a.prototype=[],c=function(){return new a(this)};if(i.prototype=Error.prototype,l.item=function(e){return this[e]||null},l.contains=function(e){return~o(this,e+"")},l.add=function(){var e,t=arguments,n=0,r=t.length,s=!1;do{~o(this,e=t[n]+"")||(this.push(e),s=!0)}while(++n<r);s&&this._updateClassName()},l.remove=function(){var e,t,n=arguments,r=0,s=n.length,i=!1;do{for(t=o(this,e=n[r]+"");~t;)this.splice(t,1),i=!0,t=o(this,e)}while(++r<s);i&&this._updateClassName()},l.toggle=function(e,t){var n=this.contains(e),r=n?!0!==t&&"remove":!1!==t&&"add";return r&&this[r](e),!0===t||!1===t?t:!n},l.replace=function(e,t){var n=o(e+"");~n&&(this.splice(n,1,t),this._updateClassName())},l.toString=function(){return this.join(" ")},n.defineProperty){var d={get:c,enumerable:!0,configurable:!0};try{n.defineProperty(t,"classList",d)}catch(u){void 0!==u.number&&-2146823252!==u.number||(d.enumerable=!1,n.defineProperty(t,"classList",d))}}else n.prototype.__defineGetter__&&t.__defineGetter__("classList",c)}}(window),function(){var e=document.createElement("_");if(e.classList.add("c1","c2"),!e.classList.contains("c2")){var t=function(e){var t=DOMTokenList.prototype[e];DOMTokenList.prototype[e]=function(e){for(var n=0,r=arguments.length;n<r;n++)t.call(this,e=arguments[n])}};t("add"),t("remove")}if(e.classList.toggle("c3",!1),e.classList.contains("c3")){var n=DOMTokenList.prototype.toggle;DOMTokenList.prototype.toggle=function(e,t){return 1 in arguments&&!this.contains(e)==!t?t:n.call(this,e)}}"replace"in document.createElement("_").classList||(DOMTokenList.prototype.replace=function(e,t){var n=this.toString().split(" "),r=n.indexOf(e+"");~r&&(n=n.slice(r),this.remove.apply(this,n),this.add(t),this.add.apply(this,n.slice(1)))}),e=null}();const Va=function(e,t){for(const n in e){let r=e[n];if(r){n in t&&(r=e[n]="object"==typeof r?We.merge(We.clone(t[n]),r):t[n]);const s=r.menu;s&&Va("items"in s?s.items:s,t)}}},Wa=function(){class e extends ur{static get defaultConfig(){return{defaultItems:null,items:null,processItems:null,triggerEvent:null}}static get pluginConfig(){return{assign:["showEventContextMenu"],chain:["onElementContextMenu","onElementClick","onElementDblClick","onEventSpaceKey"]}}doDestroy(){this.menu&&this.menu.destroy()}onElementContextMenu(e){"contextmenu"===this.triggerEvent&&this.showEventContextMenu(e)}onElementClick(e){"click"===this.triggerEvent&&this.showEventContextMenu(e)}onElementDblClick(e){"dblclick"===this.triggerEvent&&this.showEventContextMenu(e)}onEventSpaceKey(e){const t=oe.from(e.target).center,n=new MouseEvent("contextmenu",Object.assign({clientX:t.x,clientY:t.y},e));Object.defineProperty(n,"target",{get:()=>e.target}),this.showEventContextMenu(n)}showEventContextMenu(e){const t=this,n=e.target,r=yt.up(n,t.client.eventSelector)||n;if(r){e.preventDefault();const n=t.resolveRecord(r);n&&t.showContextMenuFor(n,{targetElement:r,event:e})}}showContextMenuFor(e,t){}beforeContextMenuShow(){}showContextMenu(e){const t=this,n=e.event,r=e.menuType.toLowerCase(),s=$.lowercaseFirstLetter(r),i=`get${$.capitalizeFirstLetter(r)}MenuItems`,{client:o,processItems:a,defaultItems:l,namedItems:c}=t,d=n?[n.clientX+1,n.clientY+1]:oe.from(e.targetElement).center,u=e.items=We.isEmpty(t.items)?We.clone(l):We.merge(We.clone(l),t.items);e.namedItems=c,e.selection=o.selectedRecords,Va(u,c),o[i]&&o[i](e,u),a&&!1===a(e)||We.isEmpty(e.items)||!1!==t.beforeContextMenuShow(e)&&!1!==o.trigger(`${s}ContextMenuBeforeShow`,e)&&(t.menu=I.showContextMenu(d,{owner:o,scrollAction:"hide",clippedBy:[o.timeAxisSubGridElement,o.bodyContainer],constrainTo:window,items:u,onDestroy(){t.menu=null},onBeforeItem:t=>{Object.assign(t,e)},onItem:e=>o.trigger(`${s}ContextMenuItem`,e),listeners:{show({source:t}){e.menu=t,o.trigger(`${s}ContextMenuShow`,e)}}}))}hideContextMenu(e){this.menu&&this.menu.hide(e)}set defaultItems(e){this._defaultItems=e}get defaultItems(){const e=We.clone(this._defaultItems);if(this.client.readOnly)for(let t in e)e[t]=!1;return e}get triggerEvent(){return this._triggerEvent||this.client.contextMenuTriggerEvent}set triggerEvent(e){this._triggerEvent=e}}return e._$name="TimeSpanRecordContextMenuBase",e}();To.registerFeature(function(){class e extends Wa{static get defaultConfig(){return{items:null,processItems:null,defaultItems:{deleteEvent:!0,unassignEvent:!0}}}resolveRecord(e){return this.client.resolveEventRecord(e)}showContextMenuFor(e,{targetElement:t,event:n}={}){const{client:r}=this;(t||(t=r.getElementsFromEventRecord(e)[0]))&&this.showContextMenu({menuType:"event",eventElement:t,targetElement:t,eventRecord:e,resourceRecord:r.resolveResourceRecord(t),assignmentRecord:r.resolveAssignmentRecord(t),event:n})}set defaultItems(e){this._defaultItems=e}get defaultItems(){const e=super.defaultItems;return this.client.assignmentStore||(e.unassignEvent=!1),e}get namedItems(){const{client:e}=this;return this._namedItems||(this._namedItems={deleteEvent:{text:e.L("Delete event"),icon:"b-icon b-icon-trash",weight:-160,onItem:({menu:t,eventRecord:n})=>{const r=t.focusInEvent&&t.focusInEvent.relatedTarget;r&&(r.focus(),e.navigator.activeItem=r),e.removeRecords([n])}},unassignEvent:{text:e.L("Unassign event"),icon:"b-icon b-icon-unassign",weight:-150,name:"unassignEvent",onItem:({menu:t,eventRecord:n,resourceRecord:r})=>{const s=t.focusInEvent&&t.focusInEvent.relatedTarget;s&&(s.focus(),e.navigator.activeItem=s),n.unassign(r)}}}),this._namedItems}}return e.featureClass="",e._$name="EventContextMenu",e}(),!0,"Scheduler");const Ua=function(){class e extends W{static get defaultConfig(){return{minuteHeight:8,minuteTop:2,hourHeight:8,hourTop:2,handLeft:10,timeAxisViewModel:null,template:function(e){return`<div class="b-sch-clockwrap b-sch-clock-${this.mode} ${e.cls||""}">\n                    <div class="b-sch-clock">\n                        <div class="b-sch-hour-indicator">${Ne.format(e.date,"MMM")}</div>\n                        <div class="b-sch-minute-indicator">${Ne.format(e.date,"D")}</div>\n                        <div class="b-sch-clock-dot"></div>\n                    </div>\n                    <span class="b-sch-clock-text">${e.text}</span>\n                </div>`}}}construct(e){super.construct(e),this.timeAxisViewModelDetacher=this.timeAxisViewModel.on({update:this.onTimeAxisViewModelUpdate,thisObj:this})}doDestroy(){this.timeAxisViewModelDetacher&&this.timeAxisViewModelDetacher()}onTimeAxisViewModelUpdate(){delete this._mode}updateDateIndicator(e,t){const n=e.querySelector(".b-sch-hour-indicator"),r=e.querySelector(".b-sch-minute-indicator");t&&n&&r&&("hour"===this.mode?(n.style.transform=`rotate(${t.getHours()%12*30}deg)`,r.style.transform=`rotate(${6*t.getMinutes()}deg)`):(n.style.transform="none",r.style.transform="none"))}get mode(){return this._mode||(this._mode=Ne.compareUnits(this.timeAxisViewModel.timeResolution.unit,"day")>=0?"day":"hour")}set template(e){this._template=e}get template(){return this._template}}return e._$name="ClockTemplate",e}(),Ga=function(){class e extends ur{static get defaultConfig(){return{dragTipTemplate:e=>`\n                <div class="b-sch-tip-${e.valid?"valid":"invalid"}">\n                    ${e.startClockHtml}\n                    ${e.endClockHtml}\n                    <div class="b-sch-tip-message">${e.message}</div>\n                </div>\n            `,constrainDragToResource:!0,showTooltip:!0,showExactDropPosition:!1,constrainDragToTimeline:!0,store:null,tooltipCls:null}}static get pluginConfig(){return{chain:["render"]}}render(){const e=this,t=e.client;e.drag&&e.drag.destroy(),e.drag=new Ii({name:e.constructor.name,mode:"translateXY",lockY:e.constrainDragToResource,minX:!0,constrain:!1,cloneTarget:!e.constrainDragToTimeline,dragWithin:e.constrainDragToTimeline?null:document.body,hideOriginalElement:!0,outerElement:t.timeAxisSubGridElement,targetSelector:t.eventSelector,isElementDraggable:(n,r)=>!t.readOnly&&e.isElementDraggable(n,r),scrollManager:e.constrainDragToTimeline?t.scrollManager:null,listeners:{beforedragstart:"onBeforeDragStart",dragstart:"onDragStart",drag:"onDrag",drop:"onDrop",abort:"onDragAbort",reset:"onDragReset",thisObj:e}}),e.constrainDragToResource||t.rowManager.on({changeTotalHeight:"updateYConstraint",thisObj:e}),e.showTooltip&&(e.clockTemplate=new Ua({timeAxisViewModel:t.timeAxisViewModel}))}doDestroy(){const e=this;e.drag&&e.drag.destroy(),e.clockTemplate&&e.clockTemplate.destroy(),e.tip&&e.tip.destroy(),super.doDestroy()}onBeforeDragStart({context:e}){const t=this.client,n=t.scheduledEventName,r=t.resolveEventRecord(e.element);return!(this.disabled||!r||!r.isDraggable)&&!1!==t.trigger(`before${n}Drag`,{eventRecord:r,context:this.dragData})}onDragStart({context:e,event:t}){const n=this,r=n.client,s=r.scheduledEventName;n.currentOverClient=r,n.scrollClients={},n.onMouseOverNewTimeline(r);const i=n.dragData=n.getDragData(e,t);if(n.showTooltip){const t=i.context.dragProxy?i.context.dragProxy.firstChild:e.element;n.tip?n.tip.showBy(t):(n.tip=new er({id:`${r.id}-event-drag-tip`,align:"b-t",autoShow:!0,clippedBy:n.constrainDragToTimeline?[r.timeAxisSubGridElement,r.bodyContainer]:null,forElement:t,getHtml:n.getTipHtml.bind(n),style:"pointer-events:none",cls:n.tooltipCls}),n.tip.on("innerhtmlupdate",n.updateDateIndicator,n))}r.trigger(`${s}DragStart`,{[`${s}Records`]:i.draggedRecords,context:i})}updateDateIndicator(){const{startDate:e,endDate:t}=this.dragData,n=this.tip,r=n.element.querySelector(".b-sch-tooltip-enddate");this.clockTemplate.updateDateIndicator(n.element,e),r&&this.clockTemplate.updateDateIndicator(r,t)}onDrag({context:e,event:t}){const n=this,r=n.dragData,s=r.startDate;let i;if(n.constrainToTimeline)i=n.client;else{let e=t.target;if(/^touch/.test(t.type)){const t=oe.from(r.context.element,null,!0).center;e=yt.elementFromPoint(t.x,t.y)}i=k.fromElement(e,"timelinebase")}const o=n.client.features.dependencies,a=e.newX,l=e.newY;if(!i)return void(o&&o.updateDependenciesForTimeSpan(r.draggedRecords[0],r.context.element));if(i!==n.currentOverClient&&n.onMouseOverNewTimeline(i),n.updateDragContext(e,t),n.constrainDragToTimeline&&(n.showExactDropPosition||n.client.timeAxisViewModel.snap)){const t=i.getDateFromCoordinate(n.getCoordinate(r.draggedRecords[0],e.element,[a,l])),s=new Date(r.origStart-0+(t-r.sourceDate)),o=i.timeAxisViewModel.getDistanceBetweenDates(s,r.startDate);r.startDate>=i.timeAxis.startDate&&null!=o&&yt.addTranslateX(e.element,o)}n.triggerEventDrag(r,s);let c=n.checkDragValidity(r,t);c&&"boolean"!=typeof c&&(e.message=c.message||"",c=c.valid),e.valid=!1!==c,n.showTooltip&&n.tip.realign(),o&&o.updateDependenciesForTimeSpan(r.draggedRecords[0],r.context.element.querySelector(i.eventInnerSelector))}onMouseOverNewTimeline(e){const t=this.scrollClients;this.currentOverClient.element.classList.remove("b-dragging-"+this.currentOverClient.scheduledEventName),e.element.classList.add("b-dragging-"+e.scheduledEventName),e.id in t||(e.scrollManager.startMonitoring({element:e.timeAxisSubGridElement}),t[e.id]=e),this.currentOverClient=e}onDrop({context:e,event:t}){const n=this,{currentOverClient:r,dragData:s}=n;if(!e.valid)return n.onInvalidDrop({context:e,event:t});let i=!1;n.updateDragContext(e,t),n.tip&&n.tip.hide(),e.valid&&s.startDate&&s.endDate&&(s.finalize=((...t)=>{n.finalize(...t),e.finalize(...t)}),r.trigger(`before${r.capitalizedEventName}DropFinalize`,{context:s,event:t}),e.async=s.async,!e.async&&n.isValidDrop(s)&&(i=s.startDate-s.origStart!=0||s.newResource!==s.resourceRecord)),e.async||n.finalize(s.valid&&e.valid&&i)}onDragAbort({context:e}){this.client.currentOrientation.onDragAbort(e),this.tip&&this.tip.hide()}onInvalidDrop(){const e=this;e.dragData.draggedRecords.forEach(t=>t.instanceMeta(e.currentOverClient).retainElement=!1),e.tip&&e.tip.hide()}onDragReset({source:e}){const t=this;for(const n in t.scrollClients||{})t.scrollClients[n].scrollManager.stopMonitoring(t.scrollClients[n].timeAxisSubGridElement);if(e.context&&e.context.started){const{eventBarEls:e}=t.dragData;e[0].classList.remove("b-drag-main")}if(t.scrollClients=null,t.currentOverClient&&t.currentOverClient.element.classList.remove("b-dragging-"+t.currentOverClient.scheduledEventName),t.dragData&&!t.dragData.context.valid){const e=t.currentOverClient.features.dependencies;e&&e.scheduleDraw(!0)}}onInternalInvalidDrop(){const e=this,{currentOverClient:t}=e;e.tip&&e.tip.hide(),e.drag.abort(),t.trigger(`after${t.capitalizedEventName}Drop`,{[t.scheduledEventName+"Records"]:e.dragData.draggedRecords,valid:!1,context:e.dragData})}async finalize(e){const t=this,{currentOverClient:n,dragData:r}=t,{context:s,draggedRecords:i}=r;let o;return i.forEach((e,s)=>{e.instanceMeta(n).retainElement=!1,r.eventBarEls[s].classList.remove(t.drag.draggingCls)}),e?((o=t.updateRecords(r))instanceof Promise&&(s.async=!0,await o),r.valid?(t.drag.reset(),n.trigger(`after${n.capitalizedEventName}Drop`,{[`${n.scheduledEventName}Records`]:i,valid:!0,context:r})):t.onInternalInvalidDrop()):t.onInternalInvalidDrop(),o}updateDragContext(e,t){const n=this,r=n.dragData,s=n.currentOverClient,i=e.newX,o=e.newY,a=e.clientX,l=e.clientY,c=e.element,d=oe.from(c,s.timeAxisSubGridElement),u=r.draggedRecords[0],h=u.isAssignment?u.event:u;if(r.browserEvent=t,s.timeAxis.isContinuous){let e=s.getDateFromCoordinate(n.getCoordinate(h,c,[a,l]),null,!1);if(e)r.timeDiff=e-r.screenSourceDate;else{if(!(e=s.getDateFromCoordinate(n.getCoordinate(h,c,[i+c.offsetWidth,o]))))return void(r.context.valid=!1);e=Ne.add(e,-h.duration,h.durationUnit),r.timeDiff=e-r.sourceDate}r.startDate=n.adjustStartDate(r.origStart,r.timeDiff),r.endDate=new Date(r.startDate-0+r.duration)}else{const e=n.resolveStartEndDates(d);r.startDate=e.startDate,r.endDate=e.endDate,r.timeDiff=r.startDate-r.origStart}if(Object.assign(r,n.getProductDragContext(r)),r.valid&&r.endDate>s.timeAxis.startDate&&r.startDate<s.timeAxis.endDate){const e=!t||n.checkDragValidity(r,t);e&&"boolean"!=typeof e?(r.context.valid=!1!==e.valid,r.context.message=e.message):(r.context.valid=!1!==e,r.context.message="")}else r.context.valid=!1}getDragData(e,t){const n=this,r=n.client,{record:s,dateConstraints:i,eventBarEls:o,draggedRecords:a}=n.setupProductDragData(e);let l=s.startDate,c=s.endDate,d=r.timeAxis,u=l<d.startDate,h=c>d.endDate;const g=n.getCoordinate(s,e.element,[e.elementStartX,e.elementStartY]),m=n.getCoordinate(s,e.element,[e.startClientX,e.startClientY]);a.forEach(e=>e.instanceMeta(r).retainElement=!0),n.drag.startEvent.ctrlKey&&n.client.selectEvent(a[0],!0);const p={context:e,dateConstraints:i,eventBarEls:o,record:s,draggedRecords:a,sourceDate:u?l:r.getDateFromCoordinate(g),screenSourceDate:r.getDateFromCoordinate(m,null,!1),origStart:l,origEnd:c,startDate:l,endDate:c,timeDiff:0,startsOutsideView:u,endsOutsideView:h,duration:c-l,browserEvent:t};if(o.forEach((e,t)=>{e.classList.add(n.drag.draggingCls),e.classList.remove("b-sch-event-hover"),e.classList.remove("b-active"),e.classList.remove("b-first-render")}),o.length>1)if(e.relatedElements=o.slice(1),e.relatedElStartPos=[],e.relatedElDragFromPos=[],n.unifiedDrag){n.client.isAnimating=!0,Kt.on({element:o[1],transitionend:e=>{n.client.isAnimating=!1},once:!0}),o[0].classList.add("b-drag-main");let[t,r]=yt.getTranslateXY(e.element);e.relatedElements.forEach((n,s)=>{e.relatedElStartPos[s]=yt.getTranslateXY(n),yt.setTranslateXY(n,t+=10,r+=10),e.relatedElDragFromPos[s]=[t,r]})}else e.relatedElements.forEach((t,n)=>{e.relatedElStartPos[n]=e.relatedElDragFromPos[n]=yt.getTranslateXY(t)});return p}getRelatedRecords(e){return[]}setupConstraints(e,t,n,r){r&&this.setXConstraint(e.left,e.right-t.width,!this.showExactDropPosition&&n>1?n:0),this.setYConstraint(e.top,e.bottom-t.height,0)}updateYConstraint(){const e=this,{dragData:t}=e,{context:n}=e.drag;if(n){const r=e.scheduler.getScheduleRegion(null,t.record);e.setYConstraint(r.top,r.bottom-n.grabbed.offsetHeight,0)}}setXConstraint(e,t,n){const r=this.drag;r.leftConstraint=e,r.rightConstraint=t,r.minX=e,r.maxX=t}setYConstraint(e,t,n){const r=this.drag;r.topConstraint=e,r.bottomConstraint=t,r.minY=e,r.maxY=t}adjustStartDate(e,t){return this.client.timeAxis.roundDate(new Date(e-0+t),!!this.client.snapRelativeToEventStartDate&&e)}resolveStartEndDates(e){let t,n=this.dragData,r=n.origStart,s=n.origEnd;return n.startsOutsideView?n.endsOutsideView||(t=this.client.getStartEndDatesFromRectangle(e,"round"))&&(r=Ne.add(s=t.end||n.endDate,-n.duration,"ms")):(t=this.client.getStartEndDatesFromRectangle(e,"round"))&&(s=Ne.add(r=t.start||n.startDate,n.duration,"ms")),{startDate:r,endDate:s}}getTipHtml(){const e=this,{startDate:t,endDate:n,draggedRecords:r}=e.dragData,s=e.client.getFormattedDate(t),i=e.client.getFormattedEndDate(n,t),{valid:o,message:a}=e.dragData.context;return e.dragTipTemplate({valid:o,startDate:t,endDate:n,startText:s,endText:i,message:a||"",[e.client.scheduledEventName+"Record"]:r[0],dragData:e.dragData,startClockHtml:e.clockTemplate.template({date:t,text:s,cls:"b-sch-tooltip-startdate"}),endClockHtml:r[0].isMilestone?"":e.clockTemplate.template({date:n,text:i,cls:"b-sch-tooltip-enddate"})})}get disabled(){return this._disabled}set disabled(e){this._disabled=e}isValidDrop(e){throw new Error("Implement in subclass")}checkDragValidity(e){throw new Error("Implement in subclass")}updateRecords(e){throw new Error("Implement in subclass")}isElementDraggable(e,t){throw new Error("Implement in subclass")}getCoordinate(e,t,n){throw new Error("Implement in subclass")}setupProductDragData(e){throw new Error("Implement in subclass")}getProductDragContext(e){throw new Error("Implement in subclass")}}return e._$name="DragBase",e}(),Ya=[null];To.registerFeature(function(){class e extends Ga{static get defaultConfig(){return{constrainDragToResource:!1,validatorFn:()=>{},validatorFnThisObj:null,unifiedDrag:null}}construct(e,t){this.scheduler=e,this.store=e.eventStore,super.construct(e,t)}isElementDraggable(e,t){const{scheduler:n}=this,r=yt.up(e,n.eventSelector),{eventResize:s}=n.features;if(!r)return!1;if(e.matches('[class$="-handle"]'))return!1;const i=n.resolveEventRecord(r);return!(s&&!i.isMilestone&&s.resize.overAnyHandle(t,r))}triggerEventDrag(e,t){e.startDate-t==0&&e.newResource===e.resourceRecord||this.scheduler.trigger("eventDrag",{eventRecords:e.draggedRecords,startDate:e.startDate,endDate:e.endDate,newResource:e.newResource,context:e})}onDragStart({context:e,event:t}){const n=this.client.features.eventContextMenu;super.onDragStart({context:e,event:t}),n&&n.hideContextMenu(!1)}isValidDrop(e){const{newResource:t,resourceRecord:n}=e;let r=e.draggedRecords[0];return!(t.meta.specialRow||n!==t&&(r instanceof ma&&(r=r.event),r.isAssignedTo(t)))}checkDragValidity(e,t){const n=this.currentOverClient;return this.dragData.context.valid&&(n.allowOverlap||n.isDateRangeAvailable(e.startDate,e.endDate,e.draggedRecords[0],e.newResource))&&this.validatorFn.call(this.validatorFnThisObj||this,e,t)}updateRecords(e){const t=this,n=t.scheduler,r=t.currentOverClient,{assignmentStore:s}=n,{draggedRecords:i}=e;if(s){if(r!==n)throw new Error("Assignments cannot be dragged cross-scheduler");t.updateRecordsMultipleAssignmentMode(n,r,e,!1)}else t.updateRecordsSingleAssignmentMode(n,r,e,!1);r.trigger("eventDrop",{eventRecords:i,isCopy:!1,event:e.browserEvent,targetEventRecord:e.targetEventRecord,targetResourceRecord:e.newResource,context:e})}updateRecordsSingleAssignmentMode(e,t,n,r){const s=this,i=e!==t,{eventStore:o,resourceStore:a}=e,{draggedRecords:l,timeDiff:c,resourceRecord:d,newResource:u}=n,h=s.unifiedDrag||i&&l.length>1,g=[],m=s.constrainDragToResource?0:a.indexOf(d)-a.indexOf(u),p=s.adjustStartDate(l[0].startDate,c);let f;if(l.forEach((d,v)=>{const y=n.eventBarEls[v],b=d.generation,C=i?Ya:d.resources;y.querySelector(e.eventInnerSelector).classList.add(e.committingCls),r?(d=d.fullCopy(null),g.push(d)):o!==t.eventStore&&(o.remove(l),t.eventStore.add(l),d.instanceMeta(t).fromDragProxy=!0),d.beginBatch();let w=h?p:s.adjustStartDate(d.startDate,c);(0!==m||h||i)&&C.length&&C.forEach(e=>{let r=u;if(!h&&!i){let t=a.indexOf(e)-m;t<0?t=0:t>=a.getCount()&&(t=a.getCount()-1),r=a.getAt(t)}if(e?d.reassign(e,r):d.assign(r),"vertical"!==t.mode){const e=t.rowManager.getRowFor(r)&&t.isInTimeAxis(d)?t.getEventRenderId(d,r):null;if(e)if(i){const e=oe.from(n.context.element,t.foregroundCanvas,!0),s=n.context.element.cloneNode(!0);yt.setTranslateXY(s,e.x,e.y),s.classList.remove("b-first-render"),s.classList.remove("b-active"),s.classList.remove("b-drag-proxy"),s.classList.remove("b-dragging"),t.currentOrientation.cacheTimeSpanElement(d,r,s)}else t.currentOrientation.releaseTimeSpanDiv(y,!0),t.currentOrientation.updateElementId(y,e);else y.remove()}}),d.setStartDate(w,!0,o.skipWeekendsDuringDragDrop),d.endBatch(),d.generation!==b&&(f=!0)}),g.length){const e=o.count;o.add(g),o.count!==e&&(f=!0)}f||(n.valid=!1)}updateRecordsMultipleAssignmentMode(e,t,n,r){const s=this,i=e!==t,{eventStore:o}=e,{draggedRecords:a,timeDiff:l,resourceRecord:c,newResource:d}=n,u={};let h;a.forEach((a,g)=>{const m=a.event,p=n.eventBarEls[g],f=m.generation,v=e.getEventRenderId(a.event,d);u[m.id]||(u[m.id]=!0,v&&(i?t.currentOrientation.cacheTimeSpanElement(m,p):t.currentOrientation.updateElementId(p,v)),m.setStartDate(s.adjustStartDate(m.startDate,l),!0,o.skipWeekendsDuringDragDrop),c!==d&&(r?m.assign(d):m.isAssignedTo(d)?m.unassign(a.resource):m.reassign(a.resource,d)),h=h||a.resource!==c||m.generation!==f)}),h||(n.valid=!1)}getProductDragContext(e){const t=this.scheduler.resolveEventRecord(e.browserEvent.target);let n;return n=this.constrainDragToResource?e.resourceRecord:this.constrainDragToTimeline?this.resolveResource()||e.newResource||e.resourceRecord:this.resolveResource(),{valid:Boolean(n),newResource:n,targetEventRecord:t}}setupProductDragData(e){const t=this,n=t.scheduler,r=e.grabbed,s=n.resolveEventRecord(r),i=n.resolveResourceRecord(r),o=n.resolveAssignmentRecord(r),a=oe.from(r),l=[o||s],c=[];if(t.constrainDragToResource&&!i)throw new Error("Resource could not be resolved for event: "+s.id);const d=n.getDateConstraints(t.constrainDragToResource?i:null,s);return t.constrainDragToTimeline&&t.setupConstraints(n.getScheduleRegion(t.constrainDragToResource?i:null,s),a,n.timeAxisViewModel.snapPixelAmount,Boolean(d)),n.multiEventSelect&&(n.isEventSelected(l[0])||t.drag.startEvent.ctrlKey)&&l.push.apply(l,t.getRelatedRecords(o||s)),l.forEach(e=>{let t;if(!(t=n.getElementFromEventRecord(e instanceof ma?e.event:e,e.resource))){const r=n.generateTplData(e,e.resource,{timeAxis:!0,viewport:!0});r.top=r.row?r.top+r.row.top:n.getResourceEventBox(e,e.resource,!0).top,t=n.currentOrientation.renderTimeSpan(r,{},null,!0),n.currentOrientation.availableDivs.add(t),t=t.innerElement}c.push(t)}),c.forEach((e,t)=>c[t]=e.parentNode),{record:s,dateConstraints:d,eventBarEls:c,draggedRecords:l}}getDragData(e,t){return Object.assign(super.getDragData(e,t),{resourceRecord:this.scheduler.resolveResourceRecord(e.grabbed)})}getRelatedRecords(e){return this.scheduler.selectedEvents.filter(t=>t!==e)}getCoordinate(e,t,n){const r=this.currentOverClient;if(r.isHorizontal){let s=n[0];if("default"!==r.milestoneLayoutMode&&e.isMilestone)switch(r.milestoneAlign){case"center":s+=t.offsetWidth/2;break;case"end":s+=t.offsetWidth}return s}{let s=n[1];if("default"!==r.milestoneLayoutMode&&e.isMilestone)switch(r.milestoneAlign){case"center":s+=t.offsetHeight/2;break;case"end":s+=t.offsetHeight}return s}}resolveResource(){const e=this.currentOverClient,{isHorizontal:t}=e,{context:n}=this.dragData,r=n.dragProxy||n.element,s=e.timeAxisSubGrid.virtualScrollerElement,i=oe.from(r,null,!0),o=t?n.clientX:i.center.x,a=e.isVertical||this.unifiedDrag?n.clientY:i.center.y,l=oe.from(r,this.currentOverClient.timeAxisSubGridElement,!0),{x:c,y:d}=l.center;if(t){const t=e.rowManager.getRowAt(a);if(t)return e.resourceStore.getAt(t.dataIndex)}r.style.pointerEvents="none",s&&(s.style.display="none");const u=yt.elementFromPoint(o,a);return r.style.pointerEvents="",s&&(s.style.display=""),u&&e.resolveResourceRecord(u,[c,d])}adjustStartDate(e,t){const n=this.currentOverClient;return n.timeAxis.roundDate(new Date(e-0+t),!!n.snapRelativeToEventStartDate&&e)}resolveStartEndDates(e){const t=this.currentOverClient,n=this.dragData;let r,s=n.origStart,i=n.origEnd;if(n.startsOutsideView)n.endsOutsideView||(r=t.getStartEndDatesFromRectangle(e,"round"))&&(s=Ne.add(i=r.end||n.endDate,-n.duration,"ms"));else if(r=t.getStartEndDatesFromRectangle(e,"round")){if(r.start&&!t.timeAxis.dateInAxis(r.start,!1)){const e=t.timeAxis.getTickFromDate(r.start);e&&(r.start=t.timeAxis.getDateFromTick(e))}i=Ne.add(s=r.start||n.startDate,n.duration,"ms")}return{startDate:s,endDate:i}}}return e._$name="EventDrag",e}(),!0,"Scheduler");const qa=function(){class e extends ur{static get defaultConfig(){return{disabled:!1,showTooltip:!0,dragTolerance:2,preventMultiple:!1,validatorFn:()=>{},validatorFnThisObj:null,proxyCls:"b-sch-dragcreator-proxy",tipTemplate:e=>`\n                <div class="b-sch-tip-${e.valid?"valid":"invalid"}">\n                    ${e.startClockHtml}\n                    ${e.endClockHtml}\n                    <div class="b-sch-tip-message">${e.message}</div>\n                </div>\n            `}}static get pluginConfig(){return{chain:["onElementMouseDown","onElementMouseMove"],before:["onElementContextMenu"]}}doDestroy(){this.tip&&this.tip.destroy(),this.resize&&this.resize.destroy(),super.doDestroy()}addProxy(e){const t=this,{client:n}=t,{barMargin:r}=n,s=n.currentOrientation.getRowRegion(e.rowRecord);let i,o,a,l;return n.isHorizontal?(a="currentX"in e?Math.min(e.startX,e.currentX+1):e.startX,l=s.y+r,i=e.width||t.dragTolerance,o=s.height-2*r):(a=s.x+r,l="currentY"in e?Math.min(e.startY,e.currentY+1):e.startY,i=s.width-2*r,o=e.height||t.dragTolerance),n.element.classList.add("b-dragcreating"),n.element.classList.add("b-dragcreating-proxy-sizing"),t.proxy=yt.createElement({parent:n.foregroundCanvas,className:t.proxyCls,style:`transform:translate(${a}px, ${l}px);width:${i}px;height:${o}px`,retainElement:!0})}removeProxy(){const e=this;e.proxy&&(e.proxy.remove(),e.resize.destroy(),e.proxy=e.resize=null,e.client.element.classList.remove("b-dragcreating"),e.client.element.classList.remove("b-dragcreating-proxy-sizing"),e.tip&&e.tip.hide())}initResizer(e,t){const n=this;let r;r=n.client.isHorizontal?t.currentX>t.startX?"right":"left":t.currentY>t.startY?"bottom":"top",n.resize&&n.resize.destroy(),n.resize=new Hi({name:n.constructor.name,direction:n.client.isVertical?"vertical":"horizontal",isTouch:e.type.startsWith("touch"),grab:{element:n.proxy,edge:r,event:t.startEvent},allowEdgeSwitch:!0,outerElement:n.client.timeAxisSubGridElement,scrollManager:n.client.scrollManager,scroller:n.client.timeAxisSubGrid.scrollable,listeners:{resizing:n.onResizing,resize:n.onResize,cancel:n.onCancel,thisObj:n}}),n.resize.context.resource=t.resource}initTooltip(){const e=this,t=e.client;e.showTooltip&&(e.tip?e.tip.showBy(e.getTooltipTarget()):(e.clockTemplate=new Ua({timeAxisViewModel:t.timeAxisViewModel}),e.tip=new er({id:`${t.id}-drag-create-tip`,autoShow:!0,trackMouse:!1,getHtml:e.getTipHtml.bind(e),align:t.isVertical?"t-b":"b100-t100",hideDelay:0,axisLock:!0}),e.tip.on("innerhtmlupdate",e.updateDateIndicator,e)))}updateDateIndicator(){const{startDate:e,endDate:t}=this.createContext,n=this.tip,r=n.element.querySelector(".b-sch-tooltip-enddate");e&&t&&(this.clockTemplate.updateDateIndicator(n.element,e),r&&this.clockTemplate.updateDateIndicator(r,t))}getTipHtml(){if(!this.resize.context)return;const e=this,t=e.client,{edge:n,newX:r,newY:s,elementStartX:i,elementStartY:o,elementWidth:a,elementHeight:l,newWidth:c,newHeight:d,valid:u,message:h}=e.resize.context;let g,m;if(t.isHorizontal){const e="left"===n?r:i,s=Math.min(Math.max(e+(c||a)-1,0),t.timeAxisViewModel.totalSize-1);g=t.getDateFromCoordinate(e,"round",!0),m=t.getDateFromCoordinate(s,"round",!0)}else{const e="top"===n?s:o,r=Math.min(Math.max(e+(d||l)-1,0),t.timeAxisViewModel.totalSize-1);g=t.getDateFromCoordinate(e,"round",!0),m=t.getDateFromCoordinate(r,"round",!0)}const p=Ne.min(g,m),f=Ne.max(g,m),v=p&&t.getFormattedDate(p),y=f&&m&&t.getFormattedEndDate(f,p);return e.tipTemplate({valid:u,startDate:p,endDate:f,startText:v,endText:y,message:h,startClockHtml:e.clockTemplate.template({date:p,text:v,cls:"b-sch-tooltip-startdate"}),endClockHtml:e.clockTemplate.template({date:t.getDisplayEndDate(f,p),text:y,cls:"b-sch-tooltip-enddate"})})}finalize(e){const t=this;e&&t.finalizeDragCreate(t.createContext),t.proxy.retainElement=!1,t.client.trigger("afterDragCreate",{proxyElement:t.proxy}),t.reset()}onElementMouseDown(e){const t=this,{client:n}=t;if(0===e.button&&e.target.matches(".b-sch-timeaxis-cell")&&!t.disabled&&!n.readOnly){const r=n.isVertical?n.resolveResourceRecord(e):n.getRecordFromElement(e.target);if(r.meta.specialRow)return;if(t.preventMultiple&&!t.isRowEmpty(r))return;t.monitorMove=!0,t.createContext={startEvent:e,startScreenX:e.screenX,startScreenY:e.screenY,startX:e.offsetX,startY:e.offsetY,cellElement:e.target,rowRecord:r},t.mouseUpDetacher=Kt.on({element:document.body,mouseup:"onMouseUp",once:!0,thisObj:this})}}onElementMouseMove(e){const t=this;if(t.monitorMove){const{createContext:n,client:r}=t;if(Math.abs(t.client.isVertical?n.startScreenY-e.screenY:n.startScreenX-e.screenX)>t.dragTolerance){const s=r.getDateFromDomEvent(e),i=oe.from(r.timeAxisSubGridElement,null,!0);if(!1===t.handleBeforeDragCreate(s,e))return void(t.monitorMove=!1);n.currentX=Math.max(e.clientX-i.x+r.timeAxisSubGrid.scrollable.x,0),n.currentY=Math.max(e.clientY-i.y+r.timeAxisSubGrid.scrollable.y,0),t.addProxy(t.createContext),t.initResizer(e,t.createContext),t.initTooltip(),t.monitorMove=!1,r.trigger("dragCreateStart",{proxyElement:t.proxy})}}t.proxy&&t.showTooltip&&t.resize.context&&t.tip.alignTo(t.getTooltipTarget())}getTooltipTarget(){const e=this,t=oe.from(e.proxy,null,!0);return e.client.isVertical?("bottom"===e.resize.context.edge&&(t.y=t.bottom-1),t.height=e.tip.anchorSize[1]/2):("right"===e.resize.context.edge&&(t.x=t.right-1),t.width=e.tip.anchorSize[0]/2),{target:t}}onMouseUp(){this.client.element.classList.remove("b-dragcreating-proxy-sizing"),this.monitorMove=!1}onElementContextMenu(){if(this.proxy)return!1}onResizing({context:e,event:t}){const n=this,r=n.client,s="left"===e.edge?e.newX:e.elementStartX,i="top"===e.edge?e.newY:e.elementStartY,o=Math.min(s+Math.max((e.newWidth||e.elementWidth)-1,0),r.timeAxisViewModel.totalSize-1),a=Math.min(i+Math.max((e.newHeight||e.elementHeight)-1,0),r.timeAxisViewModel.totalSize-1),l=r.isVertical?a:o,c=r.getDateFromCoordinate(r.isVertical?i:s,"round",!0),d=r.getDateFromCoordinate(l,"round",!0),u=n.dateConstraints;let h=Ne.min(c,d),g=Ne.max(c,d);u&&(g=Ne.constrain(g,u.start,u.end),h=Ne.constrain(h,u.start,u.end)),Object.assign(n.createContext,{startDate:h,endDate:g}),e.valid=n.checkValidity(n.createContext,t),e.message="",e.valid&&"boolean"!=typeof e.valid&&(e.message=e.valid.message,e.valid=e.valid.valid),e.valid=!1!==e.valid}onResize({context:{valid:e},event:t}){const n=this,{startDate:r,endDate:s}=n.createContext;(!r||!s||s-r<=0)&&(e=!1),Object.assign(n.createContext,{event:t,async:!1,finalize:e=>n.finalize(e)}),e&&n.client.trigger("beforeDragCreateFinalize",{context:n.createContext,event:t,proxyElement:n.proxy}),n.createContext&&(n.resize.context.async=n.createContext.async,n.createContext.async?n.resize.removeListeners():n.finalize(e))}get dragging(){return this.resize}onCancel(){this.cancel()}cancel(){this.reset(),this.mouseUpDetacher&&this.mouseUpDetacher()}reset(){this.removeProxy(),this.createContext=null,this.monitorMove=!1}checkValidity(e,t){throw new Error("Implement in subclass")}triggerDragCreateEnd(e,t){throw new Error("Implement in subclass")}handleBeforeDragCreate(e,t){throw new Error("Implement in subclass")}isRowEmpty(e){throw new Error("Implement in subclass")}}return e._$name="DragCreateBase",e}();To.registerFeature(function(){class e extends qa{static get defaultConfig(){return{preventMultiple:!1,validatorFn:()=>{}}}construct(e,t){this.scheduler=e,this.store=e.eventStore,super.construct(e,t)}finalizeDragCreate(e){const t=new this.store.modelClass({startDate:e.startDate,endDate:e.endDate});this.proxy.dataset.eventId=t.id,this.scheduler.trigger("dragCreateEnd",{newEventRecord:t,resourceRecord:e.rowRecord,event:e.event,proxyElement:this.proxy})}handleBeforeDragCreate(e,t){const n=this,r=n.scheduler.trigger("beforeDragCreate",{resourceRecord:n.createContext.rowRecord,date:e,event:t});if(r){const e=n.scheduler.features.scheduleTooltip;e&&e.hoverTip&&e.hoverTip.hide()}return n.dateConstraints=n.scheduler.getDateConstraints(n.createContext.rowRecord,e),r}checkValidity(e,t){const n=this.client;return e.resourceRecord=e.rowRecord,(n.allowOverlap||n.isDateRangeAvailable(e.startDate,e.endDate,null,e.resourceRecord))&&this.validatorFn.call(this.validatorFnThisObj||this,e,t)}isRowEmpty(e){const t=this.store.getEventsForResource(e);return!t||!t.length}}return e._$name="EventDragCreate",e}(),!0,"Scheduler");const Xa=Ne,Ka=e=>{if(1===e.length)return e[0].value;if(2===e.length){const[t,n]=e[0]instanceof os?e:e.reverse(),r=Xa.parse(t.value);return r.setHours(n.value.getHours(),n.value.getMinutes(),n.value.getSeconds(),n.value.getMilliseconds()),r}return null},Za=(e,t,n)=>{if(e&&t){const e=Xa.add(((e,t)=>{let r=new Date(n.startDateField.value.getTime());return r.setHours(t.getHours(),t.getMinutes()),r})(0,n.startTimeField.value),n.eventRecord.durationMS,"milliseconds");n.endDateField.value=e,n.endTimeField.value=Xa.clone(e)}},Ja=function(){class e extends ur{static get defaultConfig(){return{autoClose:!0,saveAndCloseOnEnter:!0,triggerEvent:null,showDeleteButton:!0,showNameField:!0,startTimeConfig:null,startDateConfig:null,endTimeConfig:null,endDateConfig:null,dateFormat:"L",timeFormat:"LT",editorConfig:null,extraItems:null,extraWidgets:null}}construct(e,t){const n=this;e.eventEdit=n,super.construct(e,t),n.clientListenersDetacher=e.on({[n.triggerEvent]:n.onActivateEditor,dragcreateend:n.onDragCreateEnd,thisObj:n})}doDestroy(){this.clientListenersDetacher(),this.editor&&this.editor.destroy(),super.doDestroy()}get editorConfig(){return this._editorConfig}set editorConfig(e){const t=this.getDefaultConfiguration().editorConfig;(e=We.assign({},t,e)).items=e.items||[],this.insertExtraWidgetsIntoDefaultWidgets(e),this._editorConfig=e}get extraWidgets(){return this._skipWarn||console.warn("`extraWidgets` was deprecated in 2.1, please change your code to use `extraItems`"),this._extraItems}set extraWidgets(e){console.warn("`extraWidgets` was deprecated in 2.1, please change your code to use `extraItems`"),this._extraItems=e}get extraItems(){const e=this;return e._skipWarn=!0,e._thisIsAUsedExpression(e.extraWidgets),e._skipWarn=!1,e._extraItems}set extraItems(e){this._extraItems=e}insertExtraWidgetsIntoDefaultWidgets(e){if(!this.extraItems||!this.extraItems.length)return;let t,n=e.items.findIndex(e=>"extraItems"===e.type);n>-1&&(e.items.splice(n,1),t=e.items.splice(n));let r=this.extraItems.filter(e=>e.index>=0),s=this.extraItems.filter(e=>!(e.index>=0));e.items=e.items.concat(s),r.sort((e,t)=>e.index-t.index),r.forEach(t=>e.items.splice(t.index,0,t)),t&&t.length&&(e.items=e.items.concat(t))}onDatesChange(e){const t=this,n=e.value;switch(e.source.ref){case"startDateField":t.startTimeField&&Za(n,t.startTimeField.value,t);break;case"startTimeField":t.startDateField&&Za(t.startDateField.value,n,t)}t.endTimeField&&(t.endTimeField.min=Xa.isEqual(Xa.clearTime(t.startDateField.value),Xa.clearTime(t.endDateField.value))?t.startTimeField.value:null)}save(){throw new Error("Implement in subclass")}get isValid(){return Object.values(this.editor.widgetMap).every(e=>!(e.name&&!e.hidden)||!1!==e.isValid)}get values(){const e=[],t=[],n={};return this.editor.eachWidget(r=>{const s=r.name;s&&!r.hidden&&("startDate"===s?e.push(r):"endDate"===s?t.push(r):n[s]=r.value)},!0),n.startDate=Ka(e),n.endDate=Ka(t),n.duration=Xa.diff(n.startDate,n.endDate,this.editor.record.durationUnit,!0),n}onBeforeSave(e){}onAfterSave(e){}updateRecord(e){const{values:t}=this;this.scheduler.assignmentStore&&delete t.resource,e.set(t)}onPopupBeforeHide(){this.client.element.classList.remove("b-eventeditor-editing"),this.dragProxyElement&&this.dragProxyElement.remove(),this.dragProxyElement=null}onPopupKeyDown({event:e}){"Enter"===e.key&&this.saveAndCloseOnEnter&&"input"===e.target.tagName.toLowerCase()&&(e.preventDefault(),"startDate"===e.target.name&&Za(this.startDateField.value,this.startTimeField.value,this),this.onSaveClick())}onSaveClick(){this.save()&&this.editor.close()}onDeleteClick(){this.deleteEvent()&&(this.editor.autoClose&&!this.editor.containsFocus||this.editor.close())}onCancelClick(){this.editor.close()}}return e._$name="EditBase",e}(),Qa=function(){class e extends Vn{static get defaultConfig(){return{items:[],draggable:{handleSelector:":not(button,.b-field-inner)"},axisLock:"flexible"}}processWidgetConfig(e){const t=this,n=t.eventEditFeature;if("extraItems"===e.type)return!1;let r={};if("resourceField"===e.ref){if(!n.showResourceField)return!1;t.resourceStore=e.store=new n.resourceStore.constructor({chained:!0,chainAllRecords:!0,masterStore:n.resourceStore,chainedFilterFn:e=>!e.meta.specialRow}),e.multiSelect=Boolean(n.scheduler.assignmentStore),n.resourceFieldConfig&&(r=n.resourceFieldConfig)}return!("nameField"===e.ref&&!n.showNameField)&&!("deleteButton"===e.ref&&!n.showDeleteButton)&&("startDate"!==e.name&&"endDate"!==e.name||"date"!==e.type||(r.format=n.dateFormat),"startDate"!==e.name&&"endDate"!==e.name||"time"!==e.type||(r.format=n.timeFormat),n.startDateConfig&&"startDate"===e.name&&"date"===e.type&&(r=n.startDateConfig),n.startTimeConfig&&"startDate"===e.name&&"time"===e.type&&(r=n.startTimeConfig),n.endDateConfig&&"endDate"===e.name&&"date"===e.type&&(r=n.endDateConfig),n.endTimeConfig&&"endDate"===e.name&&"time"===e.type&&(r=n.endTimeConfig),Object.assign(e,r),super.processWidgetConfig(e))}show(...e){this.resourceStore&&this.resourceStore.fillFromMaster(),super.show(...e)}afterShow(...e){const t=this.widgetMap.deleteButton;t&&(t.hidden=this.readOnly||!this.record.stores.length),super.afterShow(...e)}onInternalKeyDown(e){this.trigger("keyDown",{event:e}),super.onInternalKeyDown(e)}set readOnly(e){const{deleteButton:t,saveButton:n,cancelButton:r}=this.widgetMap;this._readOnly=e,this.element.classList[e?"add":"remove"]("b-readonly"),this.eachWidget(t=>{t.readOnly=e}),t&&(t.hidden=e),n&&(n.hidden=e),r&&(r.hidden=e)}get readOnly(){return this._readOnly}}return e._$name="EventEditor",e}();To.registerFeature(function(){class e extends Ja{static get defaultConfig(){return{triggerEvent:"eventdblclick",showResourceField:!0,resourceFieldConfig:null,typeField:"eventType",eventRecord:null,readOnly:null,editorConfig:{title:"L{Edit Event}",localeClass:this,closable:!0,items:[{type:"text",localeClass:this,label:"L{Name}",clearable:!0,name:"name",ref:"nameField"},{type:"combo",localeClass:this,label:"L{Resource}",name:"resource",ref:"resourceField",editable:!1,valueField:"id",displayField:"name"},{type:"date",cls:"b-inline",clearable:!1,required:!0,localeClass:this,label:"L{Start}",name:"startDate",ref:"startDateField",flex:"1 0 60%"},{type:"time",clearable:!1,required:!0,name:"startDate",ref:"startTimeField",cls:"b-match-label",flex:"1 0 40%"},{type:"date",cls:"b-inline",clearable:!1,required:!0,localeClass:this,label:"L{End}",name:"endDate",ref:"endDateField",flex:"1 0 60%"},{type:"time",clearable:!1,required:!0,name:"endDate",ref:"endTimeField",cls:"b-match-label",flex:"1 0 40%"},{type:"extraItems"}],bbar:[{type:"widget",cls:"b-label-filler"},{color:"b-green",localeClass:this,text:"L{Save}",ref:"saveButton"},{color:"b-gray",localeClass:this,text:"L{Delete}",ref:"deleteButton"},{color:"b-gray",localeClass:this,text:"L{Cancel}",ref:"cancelButton"}]}}}static get pluginConfig(){return{chain:["getEventMenuItems","onEventEnterKey"],assign:["editEvent"]}}construct(e,t){this.scheduler=e,this.eventStore=e.eventStore,this.resourceStore=e.resourceStore,super.construct(e,t)}get readOnly(){return this.editor?this.editor.readOnly:this._readOnly}set readOnly(e){this._readOnly=e,this.editor&&(this.editor.readOnly=e)}getEditor(){const e=this;let{editor:t}=e;return t||(0===(t=e.editor=new Qa(We.assign({eventEditFeature:e,align:"b-t",id:`${e.scheduler.id}-event-editor`,autoShow:!1,anchor:!0,scrollAction:"realign",clippedBy:[e.scheduler.timeAxisSubGridElement,e.scheduler.bodyContainer],constrainTo:window,autoClose:e.autoClose,cls:e.cls,readOnly:e.readOnly},e.editorConfig))).items.length&&console.warn("Event Editor configured without any `items`"),t.on({beforehide:e.onPopupBeforeHide,keydown:e.onPopupKeyDown,thisObj:e}),Object.values(t.widgetMap).forEach(t=>{const n=t.ref||t.id;if(n&&!e[n])switch(e[n]=t,t.name){case"startDate":case"endDate":t.on("change",e.onDatesChange,e)}}),e.eventTypeField&&e.eventTypeField.on("change",e.onEventTypeChange,e),e.saveButton&&e.saveButton.on("click",e.onSaveClick,e),e.deleteButton&&e.deleteButton.on("click",e.onDeleteClick,e),e.cancelButton&&e.cancelButton.on("click",e.onCancelClick,e),e.editor)}internalShowEditor(e,t,n=null){const r=this,s=r.scheduler,i=n||yt.down(s.getElementFromEventRecord(e,t),s.eventInnerSelector);if(i||!e.isPartOfStore(s.eventStore)){if(!1===s.trigger("beforeEventEdit",{eventEdit:r,eventRecord:e,resourceRecord:t,eventElement:i}))return s.element.classList.remove("b-eventeditor-editing"),r.dragProxyElement&&r.dragProxyElement.remove(),void(r.dragProxyElement=null);r.resourceRecord=t;const n=r.getEditor(e);r.typeField&&r.toggleEventType(e.get(r.typeField)),s.trigger("beforeEventEditShow",{eventEdit:r,eventRecord:e,resourceRecord:t,eventElement:i,editor:n}),r.loadRecord(e,t),i?(i.classList.add("b-editing"),n.anchor=!0,n.showBy(i)):(n.anchor=!1,n.showBy({target:s.element,align:"c-c"}));const o=s.timeAxisViewModel.timeResolution;"hour"!==o.unit&&"minute"!==o.unit||(r.startTimeField.step=r.endTimeField.step=`${o.increment}${o.unit}`)}}editEvent(e,t,n=null){const r=this,s=r.scheduler;s.readOnly||(s.element.classList.add("b-eventeditor-editing"),t||(e.resource?t=e.resource:e.resourceId&&(t=s.resourceStore.getById(e.resourceId))),n||s.eventStore.indexOf(e)<0?r.internalShowEditor(e,t,n):s.scrollResourceEventIntoView(t,e,null,{animate:!0,edgeOffset:0,extendTimeAxis:!1}).then(()=>r.internalShowEditor(e,t),()=>s.element.classList.remove("b-eventeditor-editing")))}loadRecord(e,t){const n=this,{eventStore:r}=n.client;if(n.eventRecord=e,n.resourceRecord=t,n.editor.record=e,n.resourceField){const t=r.getResourcesForEvent(e);!r.storage.includes(e,!0)&&n.resourceRecord?n.resourceField.value=n.resourceRecord[n.resourceField.valueField]:n.scheduler.assignmentStore&&(n.resourceField.value=t.map(e=>e[n.resourceField.valueField]))}}toggleEventType(e){this.editor.element.dataset.eventType=e||"",this.editor.eachWidget(t=>t.dataset&&t.dataset.eventType&&(t.hidden=t.dataset.eventType!==e))}get values(){const e=super.values;return this.scheduler.assignmentStore&&delete e.resourceId,e}save(){const e=this,{scheduler:t,eventRecord:n}=e;if(!n||!e.isValid)return;const r=e.eventStore,s=e.values,i=e.resourceField&&e.resourceField.records||[e.resourceRecord];if(e.scheduler.allowOverlap||!r||!i.some(e=>!r.isDateRangeAvailable(s.startDate,s.endDate,n,e))){if(!1!==t.trigger("beforeEventSave",{eventRecord:n,resourceRecords:i,resourceRecord:i[0],values:s})){if(e.onBeforeSave(n),n.beginBatch(),e.updateRecord(n),n.endBatch(),r&&!n.stores.length){if(!1===t.trigger("beforeEventAdd",{eventRecord:n,resourceRecords:i,resources:i}))return;if(e.dragProxyElement){const r=t.generateTplData(n,i[0]);r&&(yt.syncClassList(e.dragProxyElement,r.wrapperCls),yt.createElement({tag:"div",parent:e.dragProxyElement,className:r.cls.toString()}),e.dragProxyElement.classList.add("b-sch-dragcreator-proxy"),e.dragProxyElement.id=r.id,t.isHorizontal&&t.currentOrientation.releaseTimeSpanDiv(e.dragProxyElement,!0),e.dragProxyElement=null,n.instanceMeta(t).fromDragProxy=!0)}if(e.eventStore.add(n),e.eventStore.assignEventToResource(n,i),!e.eventStore.includes(n)){const e=t.element.querySelector(".b-sch-dragcreator-proxy");e&&(t.currentOrientation.availableDivs.remove(e),e.remove())}}else t.assignmentStore&&e.eventStore.assignEventToResource(n,i,!0);t.trigger("afterEventSave",{eventRecord:n}),e.onAfterSave(n)}return n}}deleteEvent(){const e=this,t=e.eventRecord;return!1!==e.scheduler.trigger("beforeEventDelete",{eventRecord:t})&&(e.editor.containsFocus&&e.editor.revertFocus(),e.scheduler.removeRecords([t]),!0)}get resourceStore(){return this._resourceStore}set resourceStore(e){this._resourceStore=e,this.resourceField&&(this.resourceField.store=e)}onActivateEditor({eventRecord:e,resourceRecord:t}){this.editEvent(e,t)}onDragCreateEnd({newEventRecord:e,resourceRecord:t,proxyElement:n}){this.scheduler.onEventCreated(e);const r=n.cloneNode(!0);r.removeAttribute("id"),n.parentElement.appendChild(r),this.dragProxyElement=r,this.editEvent(e,t,r)}onEventEnterKey({assignmentRecord:e,eventRecord:t}){e?this.editEvent(t,e.resource):t&&this.editEvent(t,t.resource)}onEventTypeChange({value:e}){this.toggleEventType(e)}getEventMenuItems({eventRecord:e,resourceRecord:t,items:n}){this.scheduler.readOnly||(n.editEvent={text:this.L("Edit Event"),icon:"b-icon b-icon-edit",weight:-200,onItem:()=>{this.editEvent(e,t)}})}}return e._$name="EventEdit",e}(),!0,"Scheduler"),To.registerFeature(function(){class e extends ur{static get pluginConfig(){return{chain:["getHeaderMenuItems"]}}construct(e,t){super.construct(e,t),this.scheduler=e}getHeaderMenuItems(e,t){const n=this;"timeAxis"===e.type&&t.push({text:n.L("filterEvents"),icon:"b-fw-icon b-icon-filter",menu:{type:"popup",items:[{type:"textfield",cls:"b-eventfilter b-last-row",clearable:!0,keyStrokeChangeDelay:300,label:n.L("byName"),width:200,listeners:{change:n.onEventFilterChange,thisObj:n}}],onBeforeShow({source:e}){const[t]=e.items,r=n.scheduler.eventStore.filters.getBy("property","name");t.value=r&&r.value}}})}onEventFilterChange({value:e}){""!==e?this.scheduler.eventStore.filter("name",e):this.scheduler.eventStore.removeFieldFilter("name")}}return e.featureClass="b-event-filter",e._$name="EventFilter",e}(),!0,["Scheduler","Gantt"]);const el={top:"b-t",right:"b100-t100",bottom:"t-b",left:"b0-t0"},tl=function(){class e extends ur{static get defaultConfig(){return{showTooltip:!0,showExactResizePosition:!1,validatorFn:()=>{},validatorFnThisObj:null,tip:null,tipTemplate:e=>`\n                <div class="b-sch-tip-${e.valid?"valid":"invalid"}">\n                    ${e.startClockHtml}\n                    ${e.endClockHtml}\n                    <div class="b-sch-tip-message">${e.message}</div>\n                </div>\n            `}}static get pluginConfig(){return{chain:["render"]}}render(){const e=this,t=e.client;e.resize&&e.resize.destroy(),e.resize=e.createResizeHelper(),e.showTooltip&&(e.clockTemplate=new Ua({timeAxisViewModel:t.timeAxisViewModel}))}doDestroy(){const e=this;e.tip&&e.tip.destroy(),e.clockTemplate&&e.clockTemplate.destroy(),e.resize&&e.resize.destroy(),super.doDestroy()}isElementResizable(e,t){const{client:n,resize:r}=this,s=n.resolveTimeSpanRecord(e);if(n.readOnly)return!1;let i=s&&s.isResizable;const o=(e=yt.up(t.target,n.eventSelector))?e.firstElementChild:e,a=t.target.closest('[class$="-handle"]');if(!i||a&&a!==o)return!1;let l=e.classList.contains("b-sch-event-startsoutside"),c=e.classList.contains("b-sch-event-endsoutside");if(!0===i){if(l&&c)return!1;if(l)i="end";else{if(!c)return r.overStartHandle(t,e)||r.overEndHandle(t,e);i="start"}}return!(l&&"start"===i||c&&"end"===i||!(r.overStartHandle(t,e)&&"start"===i||r.overEndHandle(t,e)&&"end"===i))}onBeforeResizeStart({element:e,event:t}){const{client:n}=this,r=n.scheduledEventName,s=n.resolveTimeSpanRecord(e);return!1!==n.trigger(`before${n.capitalizedEventName}Resize`,{[r+"Record"]:s,event:t})}onResizeStart({context:e,event:t}){const n=this,r=n.client,s=r.resolveTimeSpanRecord(e.element),i=r.scheduledEventName;r.element.classList.add("b-resizing-event"),n.setupProductResizeContext(e,t),n.showTooltip&&(n.tip?(n.tip.align=el[e.edge],n.tip.showBy(n.getTooltipTarget())):(n.tip=new er({id:`${r.id}-event-resize-tip`,autoShow:!0,axisLock:!0,trackMouse:!1,getHtml:n.getTipHtml.bind(n),align:el[e.edge],hideDelay:0}),n.tip.on("innerhtmlupdate",n.updateDateIndicator,n))),s.instanceMeta(r).retainElement=!0,r.trigger(`${i}ResizeStart`,{[`${i}Record`]:s,event:t})}updateDateIndicator(){const{edge:e,startDate:t,endDate:n}=this.resize.context,{element:r}=this.tip;(t||n)&&("right"===e||"bottom"===e?this.clockTemplate.updateDateIndicator(r.querySelector(".b-sch-tooltip-enddate"),n):this.clockTemplate.updateDateIndicator(r,t))}getTooltipTarget(){const e=this,t=oe.from(e.resize.context.element,null,!0);return"horizontal"===e.resize.direction?("right"===e.resize.context.edge&&(t.x=t.right-1),t.width=e.tip.anchorSize[0]/2):("bottom"===e.resize.context.edge&&(t.y=t.bottom-1),t.height=e.tip.anchorSize[1]/2),{target:t}}onResizing({context:e,event:t}){const n=this,{client:r}=n,s=r.features.dependencies,i=n.getTimespanRecord(e),o=r.scheduledEventName,{element:a,edge:l}=e,c=yt.getTranslateXY(a);let d,u;if("top"===l||"left"===l?(u=i.endDate,r.snapRelativeToEventStartDate?(d=r.getDateFromXY(c,null,!0),d=r.timeAxis.roundDate(d,i.startDate)):d=r.getDateFromXY(c,"round",!0)):(c[0]+=a.offsetWidth,c[1]+=a.offsetHeight,d=i&&i.startDate,r.snapRelativeToEventStartDate?(u=r.getDateFromXY(c,null,!0),u=r.timeAxis.roundDate(u,i.endDate)):u=r.getDateFromXY(c,"round",!0)),d=d||e.startDate,u=u||e.endDate,e.dateConstraints&&(d=Ne.constrain(d,e.dateConstraints.start,e.dateConstraints.end),u=Ne.constrain(u,e.dateConstraints.start,e.dateConstraints.end)),n.showExactResizePosition||r.timeAxisViewModel.snap){const t="top"===l||"left"===l?r.timeAxisViewModel.getDistanceBetweenDates(d,i.endDate):r.timeAxisViewModel.getDistanceBetweenDates(i.startDate,u);switch(l){case"top":yt.setTranslateY(a,e.elementStartY+e.elementWidth-t),a.style.height=t+"px";break;case"right":a.style.width=t+"px";break;case"bottom":a.style.height=t+"px";break;case"left":yt.setTranslateX(a,e.elementStartX+e.elementWidth-t),a.style.width=t+"px"}}const h=e.endDate-u!=0||e.startDate-d!=0;e.endDate=u,e.startDate=d,h&&(e.valid=n.checkValidity(e,t)),r.trigger(`${o}PartialResize`,{[`${o}Record`]:i,startDate:d,endDate:u,element:a,context:e}),s&&s.updateDependenciesForTimeSpan(i,a),n.showTooltip&&n.tip.alignTo(n.getTooltipTarget())}checkValidity(e,t){let n=e.startDate&&e.endDate>e.startDate&&this.validatorFn.call(this.validatorFnThisObj||this,e,t);return n&&"boolean"!=typeof n&&(e.message=n.message||"",n=n.valid),!1!==n}onFinishResize({context:e,event:t}){const n=this,r=n.getTimespanRecord(e),s=r.startDate,i=r.endDate,o=e.startDate||s,a=e.endDate||i,l=n.client;let c=!1;r.instanceMeta(l).retainElement=!1;const d=e.finalize;e.finalize=((...t)=>{e.async&&n.finalize(...t),d.call(e,t)}),e.valid=o&&a&&a-o>0&&(o-s!=0||a-i!=0)&&!1!==e.valid,e.valid&&(l.trigger(`before${l.scheduledEventName}ResizeFinalize`,{context:e,event:t}),c=!0),e.async||n.finalize(c)}onCancelResize({context:e}){const t=this.getTimespanRecord(e);t&&(t.instanceMeta(this.client).retainElement=!1),this.finalize(!1)}finalize(e){const t=this,{client:n}=t,r=t.resize.context,s=t.getTimespanRecord(r),i=n.scheduledEventName;let o=!1;if(t.tip&&t.tip.hide(),r.started&&(e&&(o=t.internalUpdateRecord(r,s)),!e||!o)){const e=n.features.dependencies;e&&e.scheduleDraw(!0),n.repaintEventsForResource(t.getRowRecord(r))}n.element.classList.remove("b-resizing-event"),n.trigger(`${i}ResizeEnd`,{changed:o,[`${i}Record`]:s||n.resolveEventRecord(r.element)})}getTipHtml({tip:e}){const t=this;let{startDate:n,endDate:r,valid:s,message:i}=t.resize.context;if(!n||!r)return e.html;void 0===i&&(i=""),r=t.client.getDisplayEndDate(r,n);let o=t.client.getFormattedDate(n),a=t.client.getFormattedDate(r);return t.tipTemplate({valid:s,startDate:n,endDate:r,startText:o,endText:a,message:i,startClockHtml:t.clockTemplate.template({date:n,text:o,cls:"b-sch-tooltip-startdate"}),endClockHtml:t.clockTemplate.template({date:r,text:a,cls:"b-sch-tooltip-enddate"})})}getRowRecord(e){throw new Error("Implement in subclass")}getTimespanRecord(e){throw new Error("Implement in subclass")}setupProductResizeContext(e,t){throw new Error("Implement in subclass")}get store(){throw new Error("Implement in subclass")}}return e._$name="ResizeBase",e}();To.registerFeature(function(){class e extends tl{createResizeHelper(){const e=this,t=e.client;return new Hi({direction:t.isVertical?"vertical":"horizontal",name:e.constructor.$name,isElementResizable:(t,n)=>e.isElementResizable(t,n),targetSelector:t.eventSelector,handleContainerSelector:t.eventInnerSelector,resizingCls:"b-sch-event-wrap-resizing",allowResize:e.isElementResizable.bind(e),outerElement:t.timeAxisSubGridElement,scrollManager:t.scrollManager,dragThreshold:0,scroller:t.timeAxisSubGrid.scrollable,listeners:{beforeresizestart:e.onBeforeResizeStart,resizestart:e.onResizeStart,resizing:e.onResizing,resize:e.onFinishResize,cancel:e.onCancelResize,thisObj:e}})}get store(){return this.client.eventStore}getTimespanRecord(e){return e.eventRecord}getRowRecord(e){return e.resourceRecord}setupProductResizeContext(e,t){const n=this.client,r=n.resolveEventRecord(e.element),s=n.resolveResourceRecord(e.element);Object.assign(e,{eventRecord:r,resourceRecord:s,dateConstraints:n.getDateConstraints(s,r)})}onResizeStart({context:e,event:t}){super.onResizeStart({context:e,event:t}),this.client.features.dependencies&&this.client.features.dependencies.hideTerminals(e.element),e.element.querySelector(".b-sch-event").classList.add("b-sch-event-resizing")}checkValidity(e,t){return(this.client.allowOverlap||this.client.isDateRangeAvailable(e.startDate,e.endDate,e.eventRecord,e.resourceRecord))&&super.checkValidity(e,t)}onFinishResize({source:e,context:t,event:n}){super.onFinishResize({source:e,context:t,event:n}),this.client.features.dependencies&&this.client.features.dependencies.showTerminals(t.eventRecord,t.element)}internalUpdateRecord(e,t){const{store:n}=this,{generation:r}=t;return"left"===e.edge||"top"===e.edge?t.setStartDate(e.startDate,!1,n.skipWeekendsDuringDragDrop):t.setEndDate(e.endDate,!1,n.skipWeekendsDuringDragDrop),t.generation!==r||(this.client.repaintEventsForResource(e.resourceRecord),!1)}finalize(e){this.resize.context.element.querySelector(".b-sch-event").classList.remove("b-sch-event-resizing"),super.finalize(e)}}return e._$name="EventResize",e}(),!0,"Scheduler");const nl=function(){class e extends ur{static get defaultConfig(){return{autoUpdate:!1,template:null,cls:null,align:"b-t",clockTemplate:null}}static get pluginConfig(){return{chain:["render"]}}construct(e,t){const n=this;t=n.processConfig(t),super.construct(e,t),n.forSelector||(n.forSelector=`${e.eventInnerSelector}:not(.b-dragproxy)`),n.clockTemplate=new Ua({timeAxisViewModel:e.timeAxisViewModel}),e.on({[`before${e.scheduledEventName}drag`]:()=>{n.tooltip&&n.tooltip.hide()}})}processConfig(e){return"function"==typeof e?{template:e}:e}setConfig(e){super.setConfig(this.processConfig(e))}doDestroy(){this.clockTemplate&&this.clockTemplate.destroy(),this.tooltip&&this.tooltip.destroy(),super.doDestroy()}render(){const e=this,t=e.client,n=[".b-dragselecting",".b-eventeditor-editing",".b-resizing-event",".b-dragcreating",`.b-dragging-${t.scheduledEventName}`,".b-creating-dependency",".b-dragproxy"].map(e=>`:not(${e})`).join("");e.tooltip&&e.tooltip.destroy(),e.tooltip=new er(Object.assign({axisLock:"flexible",id:e.tipId||`${e.client.id}-event-tip`,cls:e.tipCls,forSelector:`.b-timelinebase${n} ${e.forSelector}`,scrollAction:"realign",clippedBy:[t.timeAxisSubGridElement,t.bodyContainer],forElement:t.timeAxisSubGridElement,showOnHover:!0,hoverDelay:0,hideDelay:100,anchorToTarget:!0,allowOver:!0,getHtml:e.getTipHtml.bind(e)},e.config)),e.tooltip.on("innerhtmlupdate",e.updateDateIndicator,e)}updateDateIndicator(){const e=this.tooltip,t=e.activeTarget&&this.client.resolveTimeSpanRecord(e.activeTarget),n=e.element.querySelector(".b-sch-tooltip-enddate");t&&(this.clockTemplate.updateDateIndicator(e.element,t.startDate),n&&this.clockTemplate.updateDateIndicator(n,t.endDate))}resolveTimeSpanRecord(e){return this.client.resolveTimeSpanRecord(e)}getTipHtml({tip:e,forElement:t}){const n=this,r=n.client,s=n.recordType||`${r.scheduledEventName}Record`,i=n.resolveTimeSpanRecord(t);if(i){const{startDate:t,endDate:o}=i,a=r.getFormattedDate(t),l=r.getDisplayEndDate(o,t),c=r.getFormattedDate(l);return e.eventRecord=i,e.title=i.name,n.template({tip:e,[`${s}`]:i,startDate:t,endDate:o,startText:a,endText:c,startClockHtml:n.clockTemplate.template({date:t,text:a,cls:"b-sch-tooltip-startdate"}),endClockHtml:i.isMilestone?"":n.clockTemplate.template({date:l,text:c,cls:"b-sch-tooltip-enddate"})})}return e.hide(),""}}return e._$name="TooltipBase",e}();To.registerFeature(function(){class e extends nl{static get defaultConfig(){return{template:e=>`\n                ${e.eventRecord.name?`<div class="b-sch-event-title">${e.eventRecord.name}</div>`:""}\n                ${e.startClockHtml}\n                ${e.endClockHtml}`,cls:"b-sch-event-tooltip"}}}return e._$name="EventTooltip",e}(),!0,"Scheduler"),To.registerFeature(function(){class e extends ur{static get defaultConfig(){return{extraItems:null,processItems:null}}static get pluginConfig(){return{chain:["getHeaderMenuItems"]}}construct(e,t){super.construct(e,t),this.scheduler=e}getHeaderMenuItems(e,t){const n=this,{scheduler:r}=n,{timeAxis:s}=r,i={magnitude:s.shiftIncrement,unit:s.shiftUnit};if("timeAxis"!==e.type)return;t.push({text:n.L("pickZoomLevel"),icon:"b-fw-icon b-icon-search-plus",disabled:!r.zoomLevels.length,menu:{type:"popup",items:[{type:"slider",showValue:!1,listeners:{input:n.onZoomSliderChange,thisObj:n},minWidth:130}],onBeforeShow({source:e}){const[t]=e.items;t.min=r.minZoomLevel,t.max=r.maxZoomLevel,t.value=r.zoomLevel}}}),n.startDateField=new os({label:n.L("startText"),labelWidth:"6em",required:!0,step:i,listeners:{change:n.onRangeDateFieldChange,thisObj:n}}),n.endDateField=new os({label:n.L("endText"),labelWidth:"6em",required:!0,step:i,listeners:{change:n.onRangeDateFieldChange,thisObj:n}}),t.push({text:n.L("activeDateRange"),icon:"b-fw-icon b-icon-calendar",menu:{type:"popup",width:"20em",items:[n.startDateField,n.endDateField,{type:"button",cls:"b-left-nav-btn",icon:"b-icon b-icon-prev",color:"b-blue b-raised",flex:1,margin:0,listeners:{click:n.onLeftShiftBtnClick,thisObj:n}},{type:"button",cls:"b-today-nav-btn",color:"b-blue b-raised",text:n.L("todayText"),flex:4,margin:"0 8",listeners:{click:n.onTodayBtnClick,thisObj:n}},{type:"button",cls:"b-right-nav-btn",icon:"b-icon b-icon-next",color:"b-blue b-raised",flex:1,listeners:{click:n.onRightShiftBtnClick,thisObj:n}}],onBeforeShow:()=>n.initDates()}}),n.extraItems&&t.push.apply(t,n.extraItems);let o={items:t},{processItems:a}=n;a&&a(o)}onZoomSliderChange({value:e}){this.scheduler.zoomLevel=e}initDates(){const e=this;e.startDateField.suspendEvents(),e.endDateField.suspendEvents(),e.startDateField.value=e.startDateFieldInitialValue=e.scheduler.startDate,e.endDateField.value=e.endDateFieldInitialValue=e.scheduler.endDate,e.startDateField.resumeEvents(),e.endDateField.resumeEvents()}onRangeDateFieldChange({source:e}){const t=this,n=e===t.startDateField,{client:r}=t,{timeResolution:s}=r,{scrollable:i}=r.timeAxisSubGrid,o=t.startDateFieldInitialValue&&!n?t.startDateFieldInitialValue:t.startDateField.value,a=r.getDateFromX(i.x);let l=t.endDateFieldInitialValue&&n?t.endDateFieldInitialValue:t.endDateField.value;n?t.startDateFieldInitialValue=null:t.endDateFieldInitialValue=null,l-o?l<o&&(l=Ne.add(o,s.increment,s.unit)):l=Ne.add(l,s.increment,s.unit),t.scheduler.timeAxis.setTimeSpan(o,l),i.x=r.getCoordinateFromDate(a,!0),t.initDates()}onLeftShiftBtnClick(){this.scheduler.timeAxis.shiftPrevious(),this.initDates()}onTodayBtnClick(){const e=Ne.clearTime(new Date);this.scheduler.timeAxis.setTimeSpan(e,Ne.add(e,1,"day")),this.initDates()}onRightShiftBtnClick(){this.scheduler.timeAxis.shiftNext(),this.initDates()}}return e.featureClass="",e._$name="HeaderContextMenu",e}(),!0,["Scheduler","Gantt"]);const rl=["top","left","right","bottom"],sl={top:"b-b",right:"l-l",bottom:"t-t",left:"r-r"},il={top:1,bottom:1};To.registerFeature(function(){class e extends ur{static get defaultConfig(){return{labelCls:"b-sch-label",top:null,right:null,bottom:null,left:null,thisObj:null,blurAction:"cancel"}}static get pluginConfig(){return{}}construct(e,t){const n=this;if(e.isVertical)throw new Error("Labels feature is not supported in vertical mode");n.scheduler=e,n.labelElements={},super.construct(e,t);const{top:r,bottom:s,left:i,right:o}=n;(r||s||i||o)&&(n.schedulerDetatcher=e.on({eventpaint:"onEventPaint",eventrepaint:"onEventPaint",taskpaint:"onEventPaint",taskrepaint:"onEventPaint",thisObj:n}),n.updateHostClasslist())}updateHostClasslist(){const{top:e,bottom:t}=this,{classList:n}=this.scheduler.element;n.remove("b-labels-topbottom"),n.remove("b-labels-top"),n.remove("b-labels-bottom"),(e||t)&&(n.add("b-labels-topbottom"),e&&n.add("b-labels-top"),t&&n.add("b-labels-bottom"))}onEventDblClick(e){const t=this,{event:n}=e,r=n.target.closest(".b-sch-label");if(r&&!t.scheduler.readOnly){const{side:s}=r.dataset,i=t[s],{editor:o,field:a,recordType:l}=i;if(o)return o instanceof ea||(i.editor=new ea({appendTo:t.scheduler.element,blurAction:t.blurAction,inputField:o,scrollAction:"realign"})),i.editor.startEdit({target:r,align:sl[s],matchSize:!1,record:e[`${l}Record`],field:a}),n.stopImmediatePropagation(),!1}}set top(e){this._top=this.processLabelSpec(e,"top"),this.updateHostClasslist()}get top(){return this._top}set right(e){this._right=this.processLabelSpec(e,"right"),this.updateHostClasslist()}get right(){return this._right}set bottom(e){this._bottom=this.processLabelSpec(e,"bottom"),this.updateHostClasslist()}get bottom(){return this._bottom}set left(e){this._left=this.processLabelSpec(e,"left"),this.updateHostClasslist()}get left(){return this._left}processLabelSpec(e,t){if("function"==typeof e)e={renderer:e};else if("string"==typeof e)e={field:e};else{if(!e)return;e=Object.setPrototypeOf({},e)}const{scheduler:n}=this,{eventStore:r,resourceStore:s,taskStore:i}=n,{field:o,editor:a}=e;if(il[t]&&(n.milestoneWidth=null),o){let t;r&&!i&&((t=r.modelClass.fieldMap[o])?(e.fieldDef=t,e.recordType="event"):Reflect.has(r.modelClass.prototype,o)&&(e.recordType="event")),!t&&i&&((t=i.modelClass.fieldMap[o])?(e.fieldDef=t,e.recordType="task"):Reflect.has(s.modelClass.prototype,o)&&(e.recordType="task")),!t&&s&&((t=s.modelClass.fieldMap[o])?(e.fieldDef=t,e.recordType="resource"):Reflect.has(s.modelClass.prototype,o)&&(e.recordType="resource")),a&&("boolean"==typeof a?n.editor={type:"textfield"}:"string"==typeof a&&(n.editor={type:a}),n.on({eventdblclick:"onEventDblClick",taskdblclick:"onEventDblClick",thisObj:this}))}return e}doDestroy(){this.schedulerDetatcher&&this.schedulerDetatcher(),super.doDestroy()}get disabled(){return this._disabled}set disabled(e){this._disabled=e,this.client.rendered&&this.client.refresh()}onEventPaint(e){if(yt.removeEachSelector(e.element,".b-sch-label"),!this.disabled)for(const t of rl)this[t]&&this.appendLabel(t,e.element,e)}appendLabel(e,t,n){this.labelElements[e]=yt.createElement({tag:"label",dataset:{side:e},parent:t}),this.updateLabel(e,n)}updateLabel(e,t){const n=this,{field:r,fieldDef:s,recordType:i,renderer:o,thisObj:a}=n[e],l=n.labelElements[e];let c;l.className=`${n.labelCls} ${n.labelCls}-${e}`,o?c=o.call(a||n.thisObj||n,Object.assign({labelElement:l},t)):(c=t[`${i}Record`][r],s&&"date"===s.type&&!o&&(c=Ne.format(c,n.scheduler.displayDateFormat))),l.innerHTML=c||"\xa0"}}return e.featureClass="b-sch-labels",e._$name="Labels",e}(),!1,["Scheduler","Gantt"]);const ol=function(){class e extends(U(ur)){static get defaultConfig(){return{rangeCls:"b-sch-range",lineCls:"b-sch-line",store:{modelClass:va},enableResizing:!1,showTooltip:!0,showHeaderElements:!0,dragTipTemplate:e=>`\n                <div class="b-sch-tip-${e.valid?"valid":"invalid"}">\n                    <div class="b-sch-tip-name">${e.name||""}</div>\n                    ${e.startClockHtml}\n                    ${e.endClockHtml||""}\n                </div>\n            `,baseCls:"b-sch-timerange",cls:""}}static get pluginConfig(){return{chain:["render","getHeaderMenuItems"]}}construct(e,t){const n=this;super.construct(e,t),n.cls=n.cls||`b-timerange-${n.constructor.$name}`,n.baseSelector=`.${n.baseCls}.${n.cls}`,n.enableResizing&&(n.showHeaderElements=!0)}doDestroy(){const e=this;e.storeDetacher&&e.storeDetacher(),e.timeAxisViewModelDetacher&&e.timeAxisViewModelDetacher(),e.timeAxisDetacher&&e.timeAxisDetacher(),e.clockTemplate&&e.clockTemplate.destroy(),e.tip&&e.tip.destroy(),e.drag&&e.drag.destroy(),e.resize&&e.resize.destroy(),super.doDestroy()}render(){const e=this;e.timeAxisViewModel=e.client.timeAxisViewModel,e.timeAxisViewModelDetacher=e.timeAxisViewModel.on({reconfigure:e.onTimeAxisViewModelUpdate,update:e.onTimeAxisViewModelUpdate,thisObj:e}),e.timeAxisDetacher=e.client.timeAxis.on({includeChange:e.onTimeAxisViewModelUpdate,thisObj:e}),e.enableResizing&&(e.drag=new Ii({name:"rangeDrag",mode:e.client.isVertical?"translateY":"translateX",constrain:!0,outerElement:e.headerContainerElement,targetSelector:`${e.baseSelector}`,isElementDraggable:(t,n)=>!e.client.readOnly&&e.isElementDraggable(t,n),listeners:{dragstart:e.onDragStart,drag:e.onDrag,drop:e.onDrop,abort:e.onInvalidDrop,thisObj:e}}),e.resize=new Hi({direction:e.client.mode,targetSelector:`${e.baseSelector}.b-sch-range`,outerElement:e.headerContainerElement,listeners:{resizestart:e.onResizeStart,resizing:e.onResizeDrag,resize:e.onResize,thisObj:e}})),e.renderRanges()}renderRanges(){const e=this,t=e.client.foregroundCanvas;if(t){const{headerContainerElement:n,store:r}=e;if(yt.removeEachSelector(t,e.baseSelector),yt.removeEachSelector(n,e.baseSelector),!e.disabled)for(let t of r)e.renderRange(t,!0)}}renderRange(e,t){const n=this,r=n.client;if(r.rendered&&(e.duration&&r.timeAxis.timeSpanInAxis(e.startDate,e.endDate)||e.startDate&&r.timeAxis.dateInAxis(e.startDate))){const s=r.getCoordinateFromDate(Ne.max(e.startDate,r.timeAxis.startDate),{respectExclusion:!0}),i=e.duration&&r.getCoordinateFromDate(Ne.min(e.endDate,r.timeAxis.endDate),{respectExclusion:!0,isEnd:!0}),o=`<label>${e.name||"&nbsp;"}</label>`,a={className:`${n.baseCls} ${n.cls} ${i?n.rangeCls:n.lineCls} ${e.cls||""}`,dataset:{id:e.id},style:r.isVertical?`transform: translateY(${s}px); ${i?`height:${i-s}px`:""};`:`transform: translateX(${s}px); ${i?`width:${i-s}px`:""};`,retainElement:!0},l=yt.createElement(Object.assign({},a,{parent:t&&r.foregroundCanvas,style:a.style+(e.style||""),html:n.showHeaderElements?"":o}));let c;n.showHeaderElements&&(c=yt.createElement(Object.assign({parent:t&&n.headerContainerElement,html:e.name?o:""},a)));const d={bodyElement:l,headerElement:c};return t&&n.rotateLabel(d),d}}rotateLabel({bodyElement:e}){const t=e.firstChild;t&&(t.classList.remove("b-vertical"),t.classList[(this.client.isVertical?t.offsetHeight<e.offsetHeight:t.offsetWidth>e.offsetWidth)?"add":"remove"]("b-vertical"))}getElementsByRecord(e){const t="string"==typeof e?e:e.id,n=this.client.foregroundCanvas.querySelector(`${this.baseSelector}[data-id="${t}"]`),r=this.headerContainerElement.querySelector(`${this.baseSelector}[data-id="${t}"]`);return n?{bodyElement:n,headerElement:r}:null}getBodyElementByRecord(e){return this.client.foregroundCanvas.querySelector(`${this.baseSelector}[data-id="${"string"==typeof e?e:e.id}"]`)}getRecordByElement(e){return this.store.getById(e.dataset.id)}get headerContainerElement(){return this.client.isVertical?this.client.timeView.element.parentElement:this.client.timeAxisColumn.element.parentElement}get showHeaderElements(){return this._showHeaderElements}set showHeaderElements(e){this._showHeaderElements=e,this.client.element&&(e?this.client.element.classList.add("b-sch-timeranges-with-headerelements"):this.client.element.classList.remove("b-sch-timeranges-with-headerelements"),this.renderRanges())}getHeaderMenuItems(e,t){return[]}get disabled(){return super.disabled}set disabled(e){super.disabled=e,this.renderRanges()}get store(){return this._store}set store(e){const t=this;t._store=Nr.getStore(e,Nr);let n=!1;t.storeDetacher&&(t.storeDetacher(),n=!0),t.storeDetacher=t._store.on({change:t.onStoreChanged,thisObj:t}),n&&this.renderRanges()}onTimeAxisViewModelUpdate(){this.renderRanges()}onStoreChanged(e){const t=this;if(!t.isConfiguring)if("update"===e.action){const n=t.getElementsByRecord(e.record),r=t.renderRange(e.record,!n);if(n&&!r&&(n.bodyElement.remove(),n.headerElement&&n.headerElement.remove()),!n||!r)return;t.client.runWithTransition(()=>{yt.sync(r.bodyElement,n.bodyElement),t.showHeaderElements&&yt.sync(r.headerElement,n.headerElement),t.rotateLabel(n)})}else t.renderRanges()}showTip(e){const t=this;t.showTooltip&&(t.clockTemplate=new Ua({timeAxisViewModel:t.client.timeAxisViewModel}),t.tip=new er({cls:"b-interaction-tooltip",align:"b-t",autoShow:!0,forElement:e.element,getHtml:()=>t.getTipHtml(e.record,e.element)}))}isElementDraggable(e){return(e=e.closest(this.baseSelector))&&!e.classList.contains("b-over-resize-handle")}onDragStart({context:e}){const t=this,n=t.getRecordByElement(e.element.closest(t.baseSelector)),r=t.getBodyElementByRecord(n),s=t.drag;Object.assign(e,{record:n,rangeBodyEl:r,originRangeX:yt.getTranslateX(r),originRangeY:yt.getTranslateY(r)}),t.client.isVertical?(s.minY=0,s.maxY=t.timeAxisViewModel.totalSize-e.rangeBodyEl.offsetHeight):(s.minX=0,s.maxX=t.timeAxisViewModel.totalSize-e.rangeBodyEl.offsetWidth),t.showTip(e)}onDrag({context:e}){this.client.isVertical?yt.setTranslateY(e.rangeBodyEl,yt.getTranslateY(e.element)):yt.setTranslateX(e.rangeBodyEl,yt.getTranslateX(e.element)),this.showTooltip&&this.tip.realign()}onDrop({context:e}){if(!e.valid)return this.onInvalidDrop({context:e});const t=this,n=e.record,r=e.rangeBodyEl.getBoundingClientRect(),s=t.client.getDateFromCoordinate(t.client.isVertical?r.top:r.left,"round",!1);n.startDate-s!=0?n.setStartDate(s):t.onInvalidDrop(),t.tip&&(t.tip.destroy(),t.tip=null)}onInvalidDrop(){const e=this;e.drag.reset(),e.renderRanges(),e.tip&&(e.tip.destroy(),e.tip=null)}onResizeStart({context:e}){const t=this.getRecordByElement(e.element.closest(this.baseSelector)),n=this.getBodyElementByRecord(t);Object.assign(e,{record:t,rangeBodyEl:n}),this.showTip(e)}onResizeDrag({context:e}){this.client.isVertical?("top"===e.edge&&yt.setTranslateY(e.rangeBodyEl,e.newY),e.rangeBodyEl.style.height=e.newHeight+"px"):("left"===e.edge&&yt.setTranslateX(e.rangeBodyEl,e.newX),e.rangeBodyEl.style.width=e.newWidth+"px"),this.showTooltip&&this.tip.realign()}onResize({context:e}){if(!e.valid)return this.onInvalidDrop({context:e});const t=this,{client:n}=t,r=e.record,s=e.element.getBoundingClientRect(),i=n.isVertical?s.bottom:s.right,o=n.getDateFromCoordinate(n.isVertical?s.top:s.left,"round",!1),a="left"===e.edge||"top"===e.edge,l=n.getDateFromCoordinate(i,"round",!1);(a&&r.startDate-o!=0||l&&r.endDate-l!=0)&&l>o?a?r.setStartDate(o,!1):r.setEndDate(l,!1):t.onInvalidResize(),t.tip&&(t.tip.destroy(),t.tip=null)}onInvalidResize(){const e=this;e.resize.reset(),e.renderRanges(),e.tip&&(e.tip.destroy(),e.tip=null)}getTipHtml(e,t){const{client:n}=this,r=t.getBoundingClientRect(),s=n.isVertical?r.bottom:r.right,i=n.getDateFromCoordinate(n.isVertical?r.top:r.left,"round",!1),o=e.endDate&&n.getDateFromCoordinate(s,"round",!1),a=n.getFormattedDate(i),l=o&&n.getFormattedEndDate(o,i);return this.dragTipTemplate({name:e.name||"",startDate:i,endDate:o,startText:a,endText:l,startClockHtml:this.clockTemplate.template({date:i,text:a,cls:"b-sch-tooltip-startdate"}),endClockHtml:l&&this.clockTemplate.template({date:o,text:l,cls:"b-sch-tooltip-enddate"})})}}return e._$name="AbstractTimeRanges",e}();To.registerFeature(function(){class e extends ol{static get defaultConfig(){return{highlightWeekends:!0,showHeaderElements:!0,cls:"b-sch-nonworkingtime"}}construct(e,t){super.construct(e,t),this.calendar&&e.calendar||(this.calendar=new ya),this.bindCalendar(this.calendar)}doDestroy(){this.bindCalendar(null),super.doDestroy()}bindCalendar(e){const t=this;t.calendarDetacher&&t.calendarDetacher(),e&&(t.calendarDetacher=e.on({change:t.renderRanges,thisObj:t,delay:1})),t.calendar=e,t.renderRanges()}renderRanges(){const e=this;if(e.store&&!e.store.isDestroyed){const t=Ne.as(e.client.timeAxis.unit,1,"week")>=1;e.store.removeAll(!0),e.calendar&&e.highlightWeekends&&t&&e.store.add(e.calendar.getHolidaysRanges(e.client.timeAxis.startDate,e.client.timeAxis.endDate,!0),!0)}super.renderRanges()}}return e._$name="NonWorkingTime",e}(),!1,["Scheduler","Gantt"]),To.registerFeature(function(){class e extends ur{static get defaultConfig(){return{vertical:!0}}construct(e,t){if(this.timeline=e,e.features.eventDragCreate)throw new Error("Cannot combine Pan and eventDragCreate features");this.targetSelector=[".b-grid-cell",".b-timeline-subgrid"].join(","),super.construct(e,t)}static get pluginConfig(){return{chain:["onElementMouseDown","onElementMouseMove","onElementMouseUp"]}}onElementMouseDown(e){const t=this.timeline,n=Object.values(t.features).find(e=>e instanceof Ga),r=t.readOnly||!n||n.disabled;e.touches||0!==e.button||(e.target.matches(this.targetSelector)||r&&e.target.closest(t.eventSelector))&&(this.mouseX=e.clientX,this.mouseY=e.clientY)}onElementMouseMove(e){const t=this;if(0!==e.buttons||G.isSafari||G.isIE11&&!e.isTrusted){if("number"==typeof t.mouseX){const n=t.timeline.subGrids.normal.scrollable,r=t.timeline.scrollable,s=e.clientX,i=e.clientY;e.preventDefault(),t.vertical&&r.scrollBy(0,t.mouseY-i),n.scrollBy(t.mouseX-s),t.mouseX=s,t.mouseY=i}}else t.onElementMouseUp()}onElementMouseUp(e){this.mouseX=this.mouseY=null}}return e._$name="Pan",e}(),!1,["Scheduler","Gantt"]);const al=function(){class e extends va{static get fields(){return["resourceId","timeRangeColor"]}static get relationConfig(){return[{relationName:"resource",fieldName:"resourceId",store:"resourceStore",collectionName:"timeRanges",nullFieldOnRemove:!0}]}get isResourceTimeRange(){return!0}get resources(){return[this.resource]}}return e._$name="ResourceTimeRangeModel",e}(),ll=function(){class e extends ps{static get defaultConfig(){return{loadPriority:500,syncPriority:500,resourceStore:null,modelClass:al,storeId:"resourceTimeRanges"}}set resourceStore(e){this._resourceStore=e,this.isConfiguring||this.initRelations(!0)}get resourceStore(){return this._resourceStore}getResourcesForEvent(e){return[e.resource]}}return e._$name="ResourceTimeRangeStore",e}();To.registerFeature(function(){class e extends ur{static get defaultConfig(){return{idPrefix:"resourcetimerange",rangeCls:"b-sch-resourcetimerange",store:!1,resourceTimeRanges:null}}static get pluginConfig(){return{chain:["getEventsToRender","onEventDataGenerated","noFeatureElementsInAxis"]}}noFeatureElementsInAxis(){const{timeAxis:e}=this.scheduler;return!this.store.storage.values.some(t=>e.isTimeSpanInAxis(t))}construct(e,t){const n=this;n.scheduler=e,super.construct(e,t),Object.defineProperty(e,"resourceTimeRanges",{get:()=>n.store.records,set:e=>n.store.data=e})}set store(e){const t=this,{scheduler:n}=t;t._store=e=e||new ll,n.resourceTimeRangeStore||(n.resourceTimeRangeStore=e),n.resourceTimeRanges&&(e.add(n.resourceTimeRanges),delete n.resourceTimeRanges),e.resourceStore||(e.resourceStore=n.resourceStore),t.storeDetacher&&t.storeDetacher(),t.storeDetacher=t.store.on({change:t.onStoreChange,thisObj:t})}get store(){return this._store}getEventsToRender(e,t){return e.timeRanges&&e.timeRanges.length&&t.push(...e.timeRanges),t}onEventDataGenerated(e){const t=this,n=e.event||e.eventRecord;n.isResourceTimeRange&&(t.scheduler.isVertical?e.width=t.scheduler.resourceColumnWidth:(e.top=0,e.id=`${t.scheduler.id}-${t.idPrefix}-${n.id}`),e.fillSize=!0,e.eventId=`${t.idPrefix}-${n.id}`,e.wrapperCls[t.rangeCls]=1,e.wrapperCls[`b-sch-color-${n.timeRangeColor}`]=n.timeRangeColor,e.body=document.createDocumentFragment(),e.body.textContent=n.name)}onStoreChange(e){this.scheduler.onInternalEventStoreChange(e)}}return e.featureClass="",e._$name="ResourceTimeRanges",e}(),!1,"Scheduler"),To.registerFeature(function(){class e extends ol{static get defaultConfig(){return{store:{modelClass:va,storeId:"timeRanges"},updateCurrentTimeLineInterval:1e4,currentDateFormat:"HH:mm",timeRanges:null,showCurrentTimeLine:!1}}construct(e,t){const n=this;super.construct(e,t),e._timeRangesExposed||(Object.defineProperty(e,"timeRanges",{get:()=>n.store.records,set:e=>n.store.data=e}),e._timeRangesExposed=!0)}startConfigure(e){const{client:t}=this;if(t.project){const n=t.project.timeRangeStore;n&&(e.store=n)}}initCurrentTimeLine(){const e=this,t=new Date;!e.currentTimeLine&&e.showCurrentTimeLine&&(e.currentTimeLine=new e.store.modelClass({id:"currentTime",cls:"b-sch-current-time",startDate:t,name:Ne.format(t,e.currentDateFormat)}),e.currentTimeInterval=e.setInterval(()=>{e.currentTimeLine.startDate=new Date,e.currentTimeLine.name=Ne.format(e.currentTimeLine.startDate,e.currentDateFormat),e.onStoreChanged({action:"update",record:e.currentTimeLine})},e.updateCurrentTimeLineInterval),e.client.rendered&&e.renderRanges())}hideCurrentTimeLine(){const e=this;e.currentTimeLine&&(e.clearInterval(e.currentTimeInterval),e.currentTimeLine=null,e.client.rendered&&e.renderRanges())}renderRanges(){super.renderRanges(),this.showCurrentTimeLine&&!this.disabled&&this.renderRange(this.currentTimeLine,!0)}get showCurrentTimeLine(){return this._showCurrentTimeLine}set showCurrentTimeLine(e){this._showCurrentTimeLine=e,e?this.initCurrentTimeLine():this.hideCurrentTimeLine()}getHeaderMenuItems(e,t){const n=this;t.some(e=>e.isCurrentTimeline)||"timeAxis"!==e.type||t.push({isCurrentTimeline:!0,text:n.L("showCurrentTimeLine"),checked:n.showCurrentTimeLine,onToggle:({checked:e})=>{n.showCurrentTimeLine=e}})}get disabled(){return this._disabled}set disabled(e){this._disabled=e,this.client.rendered&&this.renderRanges()}get store(){return this._store}set store(e){const t=this,n=t.client;e.storeId||(e.storeId="timeRanges"),super.store=e,n.timeRanges&&!n._timeRangesExposed&&(t._store.add(n.timeRanges),delete n.timeRanges),t.timeRanges&&(t._store.add(t.timeRanges),delete t.timeRanges)}}return e._$name="TimeRanges",e}(),!1,["Scheduler","Gantt"]);let cl=Gn.tpl;const dl=function(){class e extends W{static get defaultConfig(){return{compactCellWidthThreshold:15}}headerHtmlRowTpl(e){return cl`${e.levels.map(e=>cl`<div class="b-sch-header-row b-sch-header-row-${e.position}" headerPosition="${e.position}">
                ${e.cells.map((e,t)=>`<div class="b-sch-header-timeaxis-cell ${e.headerCellCls}  ${e.align?"b-align-"+e.align:""}">${e.value}</div>\n                `)}
            </div>`)}`}fixHtmlHeaderStyles(e,t){t.forEach(t=>{yt.children(e,"[headerPosition="+t.position+"] .b-sch-header-timeaxis-cell").forEach((e,n)=>{e.style.width=e.style.minWidth=`${t.cells[n].width}px`})})}renderTo(e){const t=this,n=t.model.columnConfig,r=[];n.top&&r.push({position:"top",cells:n.top}),n.middle&&r.push({position:"middle",cells:n.middle,cls:!n.bottom&&t.model.tickSize<=t.compactCellWidthThreshold?"b-sch-header-row-compact":""}),n.bottom&&r.push({position:"bottom",cells:n.bottom,cls:t.model.tickSize<=t.compactCellWidthThreshold?"b-sch-header-row-compact":""}),e.innerHTML=t.headerHtmlRowTpl({levels:r});const s=e.parentElement;[1,2,3].forEach(e=>s.classList.remove(`b-sch-timeaxiscolumn-levels-${e}`)),s.classList.add(`b-sch-timeaxiscolumn-levels-${r.length}`),t.fixHtmlHeaderStyles(e,r)}}return e._$name="HorizontalTimeAxis",e}(),ul=function(){class e extends An{static get defaultConfig(){return{resourceStore:null,columnWidth:150,headerRenderer:null,fillWidth:!0,fitWidth:!1,imagePath:null,defaultImageName:null}}static get properties(){return{firstResource:-1,lastResource:-1}}construct(e){super.construct(e);const t=this;if(null!=t.imagePath){const e=t.missingImgUrl=`${t.imagePath}${t.defaultImageName}`;Kt.on({element:t.element,delegate:".b-resource-image",capture:!0,error(t){const{target:n}=t;n.src!==n._lastMissingUrl&&(n._lastMissingUrl=n.src,n.src=e)}}),t.element.classList.add("b-has-images")}}set resourceStore(e){const t=this;e!==t._resourceStore&&(t.resourceStoreDetacher&&t.resourceStoreDetacher(),t._resourceStore=e,t.resourceStoreDatacher=e.on({change:"onResourceStoreDataChange",thisObj:t}))}get resourceStore(){return this._resourceStore}onResourceStoreDataChange({action:e}){const t=this,n=t.resourceStore.count*t.columnWidth;n!==t.width&&(t.element.style.width=n+"px",t.column.set("width",n,t.column.grid.isConfiguring)),"removeall"===e&&(t.element.innerHTML=""),"remove"!==e&&"add"!==e&&"filter"!==e||t.refreshWidths()}get columnWidth(){return this._columnWidth}set columnWidth(e){const t=this;if(e!==t._columnWidth){const n=t._columnWidth;t._columnWidth=e,t.refreshingWidths||(t._originalColumnWidth=e,t.refreshWidths()),t.isConfiguring||(t.refresh(),t.trigger("columnWidthChange",{width:t._columnWidth,oldWidth:n}))}}get fillWidth(){return this._fillWidth}set fillWidth(e){this._fillWidth=e,this.refreshWidths()}get fitWidth(){return this._fitWidth}set fitWidth(e){this._fitWidth=e,this.refreshWidths()}get imagePath(){return this._imagePath}set imagePath(e){this._imagePath=e,this.refresh()}get availableWidth(){return this._availableWidth}set availableWidth(e){this._availableWidth=e,this.refreshWidths()}refreshWidths(){const e=this,{availableWidth:t,_originalColumnWidth:n}=e,r=e.resourceStore&&e.resourceStore.count;if(!t||!r)return;e.refreshingWidths=!0;const s=e.fitWidth||e.fillWidth&&n*r<t?Math.floor(t/r):n,i=e.column.grid.enableEventAnimations&&Math.abs(e._columnWidth-s)>30;yt.addTemporaryClass(e.element,"b-animating",i?300:0),e.columnWidth=s,e.refreshingWidths=!1}set range(e){this.firstResource=e.firstResource,this.lastResource=e.lastResource,this.refresh()}refresh(){const e=this,{firstResource:t,lastResource:n}=e;if(e.column.grid.isConfiguring||-1===t||-1===n||n>=e.resourceStore.count)return;const r=[];for(let s=t;s<=n;s++){const t=e.resourceStore.getAt(s),n={className:new Ai({"b-resourceheader-cell":1}),dataset:{resourceId:t.id},style:{left:s*e.columnWidth,width:e.columnWidth},children:[]};if(e.headerRenderer){const r=e.headerRenderer({elementConfig:n,resourceRecord:t});null!=r&&(n.html=r)}else{if(null!=e.imagePath){const r=t.name?e.imagePath+(t.imageUrl||t.name.toLowerCase()+".jpg"):e.missingImgUrl;n.children.push({tag:"img",className:"b-resource-image",src:r})}t.iconCls&&n.children.push({tag:"i",className:t.iconCls}),n.children.push({tag:"span",className:"b-resource-name",html:t.name})}r.push(n)}yt.sync({elementConfig:{onlyChildren:!0,children:r},targetElement:e.element,useSyncId:"resourceId"})}}return e._$name="ResourceHeader",e}();uo.registerColumnType(function(){class e extends(ue(co)){constructor(e,t){super(...arguments);const n=this;n.initialRender=!0,n.thisObj=n,n.timeAxisViewModel=n.timeline.timeAxisViewModel,n.mode=n.mode}static get autoExposeFields(){return!0}static get fields(){return["mode"]}static get defaults(){return{draggable:!1,groupable:!1,hideable:!1,showColumnPicker:!1,filterable:!1,sortable:!1,resizable:!1,searchable:!1,editor:!1,enableCellContextMenu:!1,tooltipRenderer:!1,cls:"b-sch-timeaxiscolumn",needWidth:!0,mode:null,region:"normal"}}static get type(){return"timeAxis"}set mode(e){const t=this,{timeline:n}=t;t.set("mode",e),"horizontal"===e?t.timeAxisView=new dl({model:t.timeAxisViewModel,timeAxis:n.timeAxis,compactCellWidthThreshold:t.compactCellWidthThreshold}):"vertical"===e&&(t.resourceColumns=new ul(Object.assign({column:t,resourceStore:n.resourceStore,imagePath:n.resourceImagePath,defaultImageName:n.defaultResourceImageName},n.resourceColumns||{})))}get mode(){return this.get("mode")}set subGrid(e){this._subGrid=e,e.on({paint:this.onTimelinePaint,thisObj:this,once:!0})}get subGrid(){return this._subGrid}get subGridElement(){return this.subGrid.element}onViewModelUpdate({source:e}){const t=this;"horizontal"===t.mode?(t.refreshHeader(!0),t.width=e.totalSize,t.isPainting||t.timeline.refresh()):"vertical"===t.mode&&(t.isPainting||t.timeline.refreshRows())}onTimelinePaint(){const e=this;e.subGrid.insertRowsBefore&&(e.isPainting=!0,e.timeAxisViewModel.on({update:e.onViewModelUpdate,thisObj:e}),e.timeAxisViewModel.update(G.isIE11?"vertical"===e.mode?e.subGrid.element.parentElement.offsetHeight:e.subGrid.width:"vertical"===e.mode?e.subGrid.height:e.subGrid.width,!1,!0),e.subGridElement.classList.add("b-timeline-subgrid"),Kt.on({element:e.element,thisObj:e,click:"onContainerElementClick",dblclick:"onContainerElementClick",contextmenu:"onContainerElementClick"}),"vertical"===e.mode&&e.refreshHeader(),e.isPainting=!1)}refreshHeader(e){const t=this,{element:n}=t;n&&("horizontal"===t.mode?(!e&&t.timeAxisViewModel.update(null,!0),t.timeAxisView.renderTo(n)):"vertical"===t.mode&&(t.resourceColumns.currentElement||(n.innerHTML="",t.resourceColumns.render(n))))}renderer(e){return this.timeline.currentOrientation.renderer(e)}onContainerElementClick(e){const t=e.target;if(t.matches(".b-sch-header-timeaxis-cell")){const n=Array.from(t.parentElement.children).indexOf(t),r=t.parentElement.getAttribute("headerPosition"),s=this.timeAxisViewModel.columnConfig[r][n],i=this.grid.features.contextMenu;i&&e.type===i.triggerEvent||this.trigger("timeAxisHeader"+$.capitalizeFirstLetter(e.type),{startDate:s.start,endDate:s.end,event:e})}}}return e._$name="TimeAxisColumn",e}()),uo.registerColumnType(function(){class e extends co{static get type(){return"resourceInfo"}static get fields(){return["showEventCount","showRole","showImage","imagePath","validNames","defaultImageName","autoScaleThreshold"]}static get defaults(){return{showImage:!0,showEventCount:!0,showRole:!1,imagePath:null,validNames:["amit","angelo","arcady","arnold","celia","chang","dan","dave","emilia","george","gloria","henrik","hitomi","jong","kate","lee","linda","lisa","lola","macy","madison","malik","mark","maxim","mike","rob","steve"],defaultImageName:null,autoScaleThreshold:40,field:"name",htmlEncode:!1,width:140,autoSyncHtml:!0}}construct(){const e=this;super.construct(...arguments),e.grid.element?e.addErrorListener():e.grid.on({paint:e.addErrorListener,thisObj:e,once:!0})}set imagePath(e){this.set("imagePath",e)}get imagePath(){return this.get("imagePath")||this.grid.resourceImagePath}set defaultImageName(e){this.set("defaultImageName",e)}get defaultImageName(){return this.get("defaultImageName")||this.grid.defaultResourceImageName}addErrorListener(){const e=`${this.imagePath}${this.defaultImageName}`;Kt.on({element:this.grid.element,delegate:".b-resource-image",error:t=>t.target.src=e,capture:!0})}template(e){const t=this,{showImage:n,showRole:r,showEventCount:s}=t,i=e["string"==typeof r?r:"role"],o=e.events.length,a=e.get(t.field);let l;if(n)if(e.imageUrl)l=e.imageUrl;else{let r="string"==typeof n?n:e.image||a&&a.toLowerCase()||t.defaultImageName;l=t.imagePath+r,r.includes(".")||(!t.validNames||t.validNames.includes(r)?l+=".jpg":l=t.imagePath+t.defaultImageName)}return` \n            <div class="b-resource-info">\n                ${l?`<img class="b-resource-image" draggable="false" src="${l}">`:""}\n                <dl>\n                <dt>${a}</dt>\n                ${r?`<dd class="b-resource-role">${i}</dd>`:""}\n                ${s?`<dd class="b-resource-events">${t.L("eventCountText",o)}</dd>`:""}\n                </dl>\n            </div>\n        `}renderer({grid:e,record:t,cellElement:n}){return t.meta.specialRow?"":(n.style.fontSize=this.autoScaleThreshold&&e.rowHeight<this.autoScaleThreshold?e.rowHeight/40+"em":"",this.template(t))}}return e._$name="ResourceInfoColumn",e}());const hl=function(){class e extends(ue()){static get defaultConfig(){return{timeAxis:null,availableSpace:null,tickSize:100,snap:!1,forceFit:!1,headerConfig:null,calendar:null,mode:"horizontal",suppressFit:!1,columnConfig:{},viewPreset:null,columnLinesFor:"middle",eventStore:null,originalTickSize:null,headersDatesCache:{}}}construct(e){const t=this;t.unitToPixelsCache={},super.construct(e);let n=t.timeAxis.viewPreset||t.viewPreset;if(n)if(n instanceof La)t.consumeViewPreset(n);else{let e=_a.getPreset(n);e&&t.consumeViewPreset(e)}t.timeAxis.on("reconfigure",t.onTimeAxisReconfigure,t),t.configured=!0}doDestroy(){this.timeAxis.un("reconfigure",this.onTimeAxisReconfigure,this)}get columnConfig(){return this._columnConfig}set columnConfig(e){this._columnConfig=e}get isHorizontal(){return"vertical"!==this.mode}get isVertical(){return"vertical"===this.mode}set forceFit(e){e!==this._forceFit&&(this._forceFit=e,this.update())}reconfigure(e){this._headers=null,Object.assign(this,e),this.trigger("reconfigure")}onTimeAxisReconfigure({source:e,suppressRefresh:t}){this.viewPreset!==e.viewPreset&&this.consumeViewPreset(e.viewPreset),t||this.update()}update(e,t=!1,n=!1){const r=this,{timeAxis:s,headerConfig:i}=r;if(r.isConfiguring||r._availableSpace===e)return void(n&&r.trigger("update"));if(r._availableSpace=Math.max(e||r.availableSpace||0,0),"number"!=typeof r.availableSpace)throw new Error("Invalid available space provided to TimeAxisModel");r.availableSpace<=0&&console.warn("No available space provided for time axis. Make sure you have set width for horizontal mode and height for vertical"),r.columnConfig={};const o=r._tickSize=r.calculateTickSize(r.originalTickSize);if("number"!=typeof o||o<=0)throw new Error("Invalid timeAxis tick size");r.unitToPixelsCache={},r._totalSize=null;for(const a in i)r.columnConfig[a]=i[a].cellGenerator?i[a].cellGenerator.call(r,s.startDate,s.endDate):r.createHeaderRow(a,i[a]);t||r.trigger("update")}getDistanceBetweenDates(e,t){return Math.round(this.getPositionFromDate(t)-this.getPositionFromDate(e))}getDistanceForDuration(e){let t=this.timeAxis.getAt(0);return this.tickSize/(t.endDate-t.startDate)*e}getPositionFromDate(e,t={}){const n=this.getScaledTick(e,t);return-1===n?-1:Math.round(this.tickSize*(n-this.timeAxis.visibleTickStart))}getScaledTick(e,{respectExclusion:t,snapToNextIncluded:n,isEnd:r,min:s,max:i}){const{timeAxis:o}=this,{include:a,unit:l,weekStartDay:c}=o;let d=o.getTickFromDate(e);if(-1!==d&&t&&a){let t=!1;if(a.hour&&Ne.compareUnits(l,"hour")>0&&"day"!==l){const{from:r,to:s,lengthFactor:i,center:o}=a.hour,l=e.getHours(),c=Math.min(Math.max(l,r),s);if(!n&&c!==l)return-1;const d=c+e.getMinutes()/60;e=Ne.add(e,o-(o-d)*i-l,"h"),t=!0}if(a.day&&Ne.compareUnits(l,"day")>0){const{from:o,to:l,lengthFactor:d,center:u}=a.day;let h=e.getDay();r&&0===e.getHours()&&0===e.getMinutes()&&0===e.getSeconds()&&0===e.getMilliseconds()&&--h<0&&(h=6);let g=0;if(h<o||h>=l){if(!n)return-1;if(e=Ne.add(e,g=r?(l-h-8)%7:(o-h+7)%7,"d"),e=Ne.startOf(e,"d",!1),i&&e.getTime()>=i||s&&e.getTime()<=s)return-1}const m=0===e.getDay()?0:u,p=e.getDay()+e.getHours()/24;e=Ne.add(e,m-(m-p)*d-p+c,"d"),t=!0}t&&(e=Ne.constrain(e,o.startDate,o.endDate),d=o.getTickFromDate(e))}return d}getDateFromPosition(e,t){const n=this.timeAxis,r=this.getScaledPosition(e)/this.tickSize+n.visibleTickStart;return r<0||r>n.count?null:n.getDateFromTick(r,t)}getScaledPosition(e){const{include:t,unit:n,weekStartDay:r}=this.timeAxis;if(t){const s=this.getSingleUnitInPixels("day");if(t.day&&Ne.compareUnits(n,"day")>0){const{from:n,lengthFactor:i}=t.day,o=e%(7*s);e=o/i+(n-r)*s+(e-o)}if(t.hour&&Ne.compareUnits(n,"hour")>0&&"day"!==n){const{from:n,lengthFactorExcl:r}=t.hour,i=e%s;e=i/r+n*this.getSingleUnitInPixels("hour")+(e-i)}}return e}getSingleUnitInPixels(e){const t=this;return t.unitToPixelsCache[e]||(t.unitToPixelsCache[e]=Ne.getUnitToBaseUnitRatio(t.timeAxis.unit,e,!0)*t.tickSize/t.timeAxis.increment)}get snapPixelAmount(){if(this.snap){const{resolution:e}=this.timeAxis;return(e.increment||1)*this.getSingleUnitInPixels(e.unit)}return 1}get tickSize(){return this._tickSize}set tickSize(e){this.setTickSize(e,!1)}setTickSize(e,t){this._tickSize=this.originalTickSize=e,this.update(void 0,t)}get timeResolution(){return this.timeAxis.resolution}calculateTickSize(e){const t=this,{forceFit:n,timeAxis:r}=t;let s=0,i=1;if(t.snap){const e=r.resolution;i=Ne.getUnitToBaseUnitRatio(r.unit,e.unit)*e.increment}if(t.suppressFit)s=e;else{const o=Math[n?"floor":"round"](t.availableSpace/r.visibleTickTimeSpan);s=n||e<o?o:e,i>0&&(!n||i<1)&&(s=Math.round(Math.max(1,Math[n?"floor":"round"](i*s))/i))}return s}get totalSize(){return this._totalSize||(this._totalSize=Math.round(this.tickSize*this.timeAxis.visibleTickTimeSpan))}get availableSpace(){return this._availableSpace}set availableSpace(e){const t=this;if(t._availableSpace=Math.max(0,e),t._availableSpace>0){const e=t.calculateTickSize(t.originalTickSize);e>0&&e!==t.tickSize&&t.update()}}getDates(e=this.columnLinesFor,t=!1,n=!1){const r=this,s=[],i=t?r.lowestHeader:e,o=r.majorHeaderName,a=o&&Ne.doesUnitsAlign(o&&r.headerConfig&&r.headerConfig[o].unit,r.headerConfig&&r.headerConfig[e].unit);if(r.headerConfig&&r.headerConfig[i].cellGenerator){const e=r.columnConfig[i];for(let t=1,n=e.length;t<n;t++)s.push({date:e[t].startDate})}else r.forEachInterval(i,(t,i)=>{s.push({date:n?i:t,isMajor:o!==e&&a&&r.isMajorTick(n?i:t)})});return s}get forceFit(){return this._forceFit}fitToAvailableSpace(e){const t=Math.floor(this.availableSpace/this.timeAxis.visibleTickTimeSpan);this.setTickSize(t,e)}get snap(){return this._snap}set snap(e){e!==this._snap&&(this._snap=e,this.configured&&this.update())}createHeaderRow(e,t){const n=this,r=[],s=t.align,i=Ne.clearTime(new Date),o=t.headerCellCls||"";let a=0;return n.headersDatesCache[e]={},n.forEachInterval(e,(l,c,d)=>{let u=Ne.format(l,t.dateFormat),h={align:s,start:l,end:c,value:u,headerCellCls:o,width:this.getDistanceBetweenDates(l,c),index:d};0!==h.width&&(h.coord=a,a+=h.width,n.headersDatesCache[e][l.getTime()]=1,t.renderer&&(u=t.renderer.call(t.thisObj||n,l,c,h,d,n.eventStore),h.value=null==u?"":u),"day"!==t.unit||t.increment&&1!==t.increment||(h.headerCellCls+=" b-sch-dayheadercell-"+l.getDay(),n.calendar&&n.calendar.isWeekend(l)&&(h.headerCellCls+=" b-sch-dayheadercell-nonworking"),Ne.clearTime(l,!0)-i==0&&(h.headerCellCls+=" b-sch-dayheadercell-today")),r.push(h))}),r}get headers(){const e=this;if(!e._headers){const t=e._headers=[],{top:n,middle:r,bottom:s}=e.headerConfig;n&&t.push(n),r&&t.push(r),s&&t.push(s)}return e._headers}get mainHeader(){return this.headerConfig.middle}get bottomHeader(){return this.headers[this.headers.length-1]}get lowestHeader(){return"bottom"in this.headerConfig?"bottom":"middle"}get majorHeaderName(){const e=this.headerConfig;return e.bottom?"middle":e.top?"top":null}isMajorTick(e){const t=this.majorHeaderName;return t&&this.headersDatesCache[t]&&this.headersDatesCache[t][e.getTime()]||!1}forEachInterval(e,t,n=this){const{headerConfig:r}=this;if(r)if("top"===e||"middle"===e&&r.bottom){const s=r[e];this.timeAxis.forEachAuxInterval(s.unit,s.increment,t,n)}else this.timeAxis.forEach((e,r)=>t.call(n,e.startDate,e.endDate,r))}forEachMainInterval(e,t){this.forEachInterval("middle",e,t)}consumeViewPreset(e){const t=this;t._headers=null,t._thisIsAUsedExpression(t.tickSize),t._viewPreset=e,Object.assign(t,{headerConfig:e.headerConfig,columnLinesFor:e.columnLinesFor||"middle",_tickSize:t.isHorizontal?e.tickWidth:e.tickHeight}),t.originalTickSize=t.tickSize}}return e._$name="TimeAxisViewModel",e}(),gl=function(){class e extends Lo{refreshContent(){this.headersElement&&0===this.headersElement.childNodes.length&&super.refreshContent()}}return e._$name="Header",e}(),ml=new Date;var pl=e=>(class extends(e||W){getDateFromCoordinate(e,t,n=!0){return n||(e=this.currentOrientation.translateToScheduleCoordinate(e)),this.timeAxisViewModel.getDateFromPosition(e,t)}getDateFromX(e,t,n=!0){return this.getDateFromCoordinate(e,t,n)}getDateFromXY(e,t,n=!0){return this.currentOrientation.getDateFromXY(e,t,n)}get displayDateFormat(){return this._displayDateFormat}set displayDateFormat(e){this._displayDateFormat=e,this.trigger("displayDateFormatChange",{format:e})}getFormattedDate(e){return Ne.format(e,this.displayDateFormat)}getDisplayEndDate(e,t){const n=this.displayDateFormat;return 0!==e.getHours()||0!==e.getMinutes()||t&&e.getYear()===t.getYear()&&e.getMonth()===t.getMonth()&&e.getDate()===t.getDate()||/([gGhHisucUOPZ]|MS)/.test(n.replace(/(\\.)/g,""))||(e=Ne.add(e,-1,"day")),e}getFormattedEndDate(e,t){return this.getFormattedDate(this.getDisplayEndDate(e,t))}getCoordinateFromDate(e,t=!0){const{timeAxisViewModel:n}=this,{isContinuous:r,startMS:s,endMS:i,startDate:o,unit:a}=this.timeAxis,l=e.valueOf();let c;if(!0===t?t={local:!0}:t?"local"in t||(t.local=!0):t={local:!1},e instanceof Date||(ml.setTime(e),e=ml),r&&e.getTimezoneOffset()===o.getTimezoneOffset()&&-1!==Ne.getUnitToBaseUnitRatio(a,"day")){if(l<s||l>i)return-1;c=Math.round((l-s)/(i-s)*n.totalSize)}else c=n.getPositionFromDate(e,t);return t.local||(c=this.currentOrientation.translateToPageCoordinate(c)),c}getDateFromDomEvent(e,t,n=!0){return this.getDateFromXY([n?e.offsetX:e.x,n?e.offsetY:e.y],t,n)}getTimeSpanDistance(e,t){return this.timeAxisViewModel.getDistanceBetweenDates(e,t)}get viewportCenterDate(){const e=this,t=e.timeAxis,n=e.timeAxisSubGrid,r=n.scrollable,s=r.x+n.width/2,i=r.y+n.height/2;return t.isContinuous?new Date(t.startMS+(t.endMS-t.startMS)*(e.isHorizontal?s/r.scrollWidth:i/r.scrollHeight)):e.getDateFromXY(e.isHorizontal?[s,0]:[0,i],null,!0)}get viewportCenterDateCached(){return this.cachedCenterDate||(this.cachedCenterDate=this.viewportCenterDate)}get timeResolution(){return this.timeAxis.resolution}set timeResolution(e){this.timeAxis.resolution={increment:e,unit:this.timeAxis.resolution.unit}}set snap(e){this.isConfiguring?this._snap=e:this.timeAxisViewModel.snap=e}get snap(){return this.isConfiguring?this._snap:this.timeAxisViewModel.snap}onSchedulerHorizontalScroll({}){this.scrollingToCenter||(this.cachedCenterDate=null)}get widgetClass(){}});const fl={mousedown:"MouseDown",mouseup:"MouseUp",click:"Click",dblclick:"DblClick",contextmenu:"ContextMenu",mouseover:"MouseOver",mouseout:"MouseOut"};var vl=e=>(class extends(e||W){static get defaultConfig(){return{scheduledBarEvents:{mousedown:"handleScheduledBarEvent",mouseup:"handleScheduledBarEvent",click:"handleScheduledBarEvent",dblclick:"handleScheduledBarEvent",contextmenu:"handleScheduledBarEvent",mouseover:"handleScheduledBarEvent",mouseout:"handleScheduledBarEvent"},schedulerEvents:{click:"handleScheduleEvent",dblclick:"handleScheduleEvent",contextmenu:"handleScheduleEvent"}}}initDomEvents(){const e=this;e.scheduledBarEvents.element=e.schedulerEvents.element=e.timeAxisSubGridElement,e.scheduledBarEvents.thisObj=e.schedulerEvents.thisObj=e,Kt.on(e.scheduledBarEvents),Kt.on(e.schedulerEvents)}getTimeSpanMouseEventParams(e,t){throw new Error("Implement in subclass")}getScheduleMouseEventParams(e,t){throw new Error("Implement in subclass")}handleScheduledBarEvent(e){const t=yt.up(e.target,this.eventSelector),n=fl[e.type]||$.capitalizeFirstLetter(e.type);t&&this.trigger(this.scheduledEventName+n,this.getTimeSpanMouseEventParams(t,e))}handleScheduleEvent(e){const t=this,n=!yt.up(e.target,t.eventSelector)&&yt.up(e.target,"."+t.timeCellCls),r=fl[e.type]||$.capitalizeFirstLetter(e.type);if(n){const s=t.getDateFromDomEvent(e,"floor"),i=fs.get(n);t.trigger("schedule"+r,Object.assign({date:s,row:i.row,index:i.row.dataIndex,event:e},t.getScheduleMouseEventParams(i,e)))}}onElementMouseOver(e){super.onElementMouseOver(e);const t=this,n=e.target;if(n.closest(t.eventInnerSelector)){const r=n.closest(t.eventSelector);if(r.classList.add(t.overScheduledEventClass),r!==t.hoveredEventNode&&!t.preventOverCls){t.hoveredEventNode=r;const n=t.getTimeSpanMouseEventParams(r,e);n&&t.trigger(t.scheduledEventName+"MouseEnter",n)}}else t.hoveredEventNode=null}onElementMouseOut(e){super.onElementMouseOut(e);const t=this;if(e.target.closest(t.eventInnerSelector)&&t.resolveTimeSpanRecord(e.target)&&t.hoveredEventNode){if(e.relatedTarget&&yt.isDescendant(e.target.closest(t.eventInnerSelector),e.relatedTarget))return;t.unhover(e)}}unhover(e){const t=this,n=t.hoveredEventNode;n&&(n.classList.remove(t.overScheduledEventClass),t.trigger(t.scheduledEventName+"MouseLeave",t.getTimeSpanMouseEventParams(n,e)),t.hoveredEventNode=null)}get widgetClass(){}}),yl=e=>(class extends(e||W){static get defaultConfig(){return{viewPreset:"weekAndDayLetter",displayDateFormat:null}}get viewPreset(){return this._viewPreset}set viewPreset(e){this._viewPreset!==e&&this.setViewPreset(e)}setViewPreset(e,t,n,r,s={}){const i=this;r=r||i.isConfiguring;let o=s.centerDate,a=i._timeAxis;if(e=_a.normalizePreset(e),r||!1!==i.trigger("beforePresetChange",{preset:e,startDate:t,endDate:n})){i._viewPreset=e,i.displayDateFormat=i.config.displayDateFormat||e.displayDateFormat;const l=i.isHorizontal;if(a){if(i.suspendRefresh(),!r||!a.isConfigured){const s={weekStartDay:i.weekStartDay,startTime:i.startTime,endTime:i.endTime};r?(0===a.count||t)&&(s.startDate=t||new Date,s.endDate=n):t?(s.startDate=t,s.endDate=n,!o&&n&&(o=new Date((t.getTime()+n.getTime())/2))):(s.startDate=a.startDate,s.endDate=n||a.endDate,o||(o=i.viewportCenterDate)),a.isConfigured=!1,a.viewPreset=e,a.reconfigure(s,!0),i.timeAxisViewModel.reconfigure({viewPreset:i.viewPreset,headerConfig:e.headerConfig,columnLinesFor:e.columnLinesFor||"middle",rowHeightHorizontal:i.readRowHeightFromPreset?e.rowHeight:i.rowHeight,tickSize:l?e.tickWidth:e.tickHeight||e.tickWidth||60}),i.resumeRefresh()}if(i.refresh(),!s.notScroll&&i.rendered)if(o){i.cachedCenterDate=o;let e=null;e=Math.max(Math.floor(i.getCoordinateFromDate(o,!0)-i.timeAxisSubGrid.width/2),0),i.viewPresetActiveScroll={left:e},i.scrollingToCenter=!0,i.scrollHorizontallyTo(e,!1),i.setTimeout(()=>{i.scrollingToCenter=!1},100)}else i.scrollHorizontallyTo(0,!1);i.trigger("presetChange",{preset:e,startDate:t,endDate:n,centerDate:o})}}}get widgetClass(){}}),bl=e=>(class extends(e||W){static get defaultConfig(){return{zoomOnMouseWheel:!0,zoomOnTimeAxisDoubleClick:!0,preventScrollZoom:!1,zoomLevels:[{width:40,increment:1,resolution:1,preset:"manyYears",resolutionUnit:"YEAR"},{width:80,increment:1,resolution:1,preset:"manyYears",resolutionUnit:"YEAR"},{width:30,increment:1,resolution:1,preset:"year",resolutionUnit:"MONTH"},{width:50,increment:1,resolution:1,preset:"year",resolutionUnit:"MONTH"},{width:100,increment:1,resolution:1,preset:"year",resolutionUnit:"MONTH"},{width:200,increment:1,resolution:1,preset:"year",resolutionUnit:"MONTH"},{width:100,increment:1,resolution:7,preset:"monthAndYear",resolutionUnit:"DAY"},{width:30,increment:1,resolution:1,preset:"weekDateAndMonth",resolutionUnit:"DAY"},{width:50,increment:1,resolution:1,preset:"weekAndMonth",resolutionUnit:"DAY"},{width:20,increment:1,resolution:1,preset:"weekAndDayLetter"},{width:54,increment:1,resolution:1,preset:"weekAndDay",resolutionUnit:"HOUR"},{width:100,increment:1,resolution:1,preset:"weekAndDay",resolutionUnit:"HOUR"},{width:64,increment:6,resolution:30,preset:"hourAndDay",resolutionUnit:"MINUTE"},{width:100,increment:6,resolution:30,preset:"hourAndDay",resolutionUnit:"MINUTE"},{width:64,increment:2,resolution:30,preset:"hourAndDay",resolutionUnit:"MINUTE"},{width:64,increment:1,resolution:30,preset:"hourAndDay",resolutionUnit:"MINUTE"},{width:30,increment:15,resolution:5,preset:"minuteAndHour"},{width:60,increment:15,resolution:5,preset:"minuteAndHour"},{width:130,increment:15,resolution:5,preset:"minuteAndHour"},{width:60,increment:5,resolution:5,preset:"minuteAndHour"},{width:100,increment:5,resolution:5,preset:"minuteAndHour"},{width:30,increment:10,resolution:5,preset:"secondAndMinute"},{width:60,increment:10,resolution:5,preset:"secondAndMinute"},{width:130,increment:5,resolution:5,preset:"secondAndMinute"}],minZoomLevel:!0,maxZoomLevel:!0,visibleZoomFactor:5,zoomKeepsOriginalTimespan:!1}}construct(e){const t=this;super.construct(e),t.zoomOnMouseWheel&&Kt.on({element:t.timeAxisSubGridElement,wheel:"onWheel",thisObj:t,capture:!0,passive:!1}),t.zoomOnTimeAxisDoubleClick&&t.on("timeaxisheaderdblclick",({startDate:e,endDate:n})=>{t.isVertical||t.zoomToSpan({startDate:e,endDate:n})})}getZoomLevelUnit(e){return _a.getPreset(e.preset).bottomHeader.unit}get maxZoomLevel(){return this._maxZoomLevel}set maxZoomLevel(e){if("number"!=typeof e&&(e=this.zoomLevels.length-1),e<0||e>=this.zoomLevels.length)throw new Error("Invalid range for `setMinZoomLevel`");this._maxZoomLevel=e}get minZoomLevel(){return this._minZoomLevel}set minZoomLevel(e){if("number"!=typeof e&&(e=0),e<0||e>=this.zoomLevels.length)throw new Error("Invalid range for `minZoomLevel`");this._minZoomLevel=e}presetToZoomLevel(e){const t=_a.getPreset(e);return{preset:e,increment:t.bottomHeader.increment||1,resolution:t.timeResolution.increment,resolutionUnit:t.timeResolution.unit,width:t.tickWidth}}calculateCurrentZoomLevel(){let e=this,t=e.presetToZoomLevel(e.viewPreset.name),n=Number.MAX_VALUE,r=e.timeAxisViewModel,s=r.tickSize;t.width=s,t.increment=r.bottomHeader.increment||1;for(let i=0,o=e.zoomLevels.length;i<o;i++){const r=e.zoomLevels[i];if(r.preset!==t.preset)continue;const o=Math.abs(r.width-s);o<n&&(n=o,t.actualWidth=r.actualWidth,t.width=r.width)}return t}get zoomLevel(){const e=this,t=e.calculateCurrentZoomLevel(),n=e.getMilliSecondsPerPixelForZoomLevel(t),r=e.zoomLevels;for(let s=0;s<r.length;s++){const t=e.getMilliSecondsPerPixelForZoomLevel(r[s]);if(t===n)return s;if(0===s&&n>t)return-.5;if(s===r.length-1&&n<t)return r.length-1+.5;const i=e.getMilliSecondsPerPixelForZoomLevel(r[s+1]);if(t>n&&n>i)return s+.5}throw new Error("Can't find current zoom level index")}set zoomLevel(e){this.zoomToLevel(e)}getMilliSecondsPerPixelForZoomLevel(e,t){return Math.round((Ne.add(new Date(1,0,1),e.increment,this.getZoomLevelUnit(e))-new Date(1,0,1))/(t?e.width:e.actualWidth||e.width))}zoomTo(e){const t=this;if("object"==typeof e)if(e.preset){const n=t.presetToZoomLevel(e.preset);this.internalZoomToLevel(n,e)}else null!=e.level?t.zoomToLevel(e.level,e):t.zoomToSpan(e);else if("number"==typeof e)t.zoomToLevel(e);else{const n=t.presetToZoomLevel(e);this.internalZoomToLevel(n)}}zoomToLevel(e,t={}){const n=this;e=Math.min(Math.max(e,n.minZoomLevel),n.maxZoomLevel);const r=n.calculateCurrentZoomLevel(),s=n.getMilliSecondsPerPixelForZoomLevel(r),i=n.zoomLevels[e];return s!==n.getMilliSecondsPerPixelForZoomLevel(i)||t.startDate||t.endDate?(n.internalZoomToLevel(i,t),e):null}internalZoomToLevel(e,t={}){const n=this;n.trigger("beforeZoomChange",{level:e});let r=n.isVertical,s=t.startDate,i=t.endDate,o=s&&i?{startDate:s,endDate:i}:null,a=t.centerDate||(o?new Date((s.getTime()+i.getTime())/2):n.viewportCenterDateCached),l=n.timeAxisSubGrid.width,c=_a.getPreset(e.preset).clone(),d=c.bottomHeader;o=o||n.calculateOptimalDateRange(a,l,e),c.name=e.preset,c[r?"tickHeight":"tickWidth"]=t.width||e.width,d.increment=e.increment,n.isZooming=!0,c.increment=e.increment,c.timeResolution.unit=Ne.getUnitByName(e.resolutionUnit||c.timeResolution.unit||d.unit),c.timeResolution.increment=e.resolution,n.setViewPreset(c,o.startDate||n.startDate,o.endDate||n.endDate,!1,{centerDate:a}),e.actualWidth=n.timeAxisViewModel.tickSize,n.isZooming=!1,n.trigger("zoomChange",{level:n.zoomLevels.indexOf(e),levelConfig:e})}zoomToFit(e){const t=this.eventStore.getTotalTimeSpan();(e=Object.assign({leftMargin:0,rightMargin:0},e,t)).startDate&&e.endDate&&this.zoomToSpan(e)}zoomToSpan(e={}){if((e.leftMargin||e.rightMargin)&&(e.adjustStart=0,e.adjustEnd=0),e.leftMargin||(e.leftMargin=0),e.rightMargin||(e.rightMargin=0),!e.startDate||!e.endDate)throw new Error("zoomToSpan: must provide startDate + endDate dates");let t=this,n=e.startDate,r=e.endDate,s=e.adjustStart>=0||e.adjustEnd>=0;if(s&&(n=Ne.add(n,-e.adjustStart,t.timeAxis.mainUnit),r=Ne.add(r,e.adjustEnd,t.timeAxis.mainUnit)),n<=r){const{availableSpace:i}=t.timeAxisViewModel;let o=Math.floor(t.zoomLevel);-1===o&&(o=0);const a=t.zoomLevels;let l,c=r-n||1,d=t.getMilliSecondsPerPixelForZoomLevel(a[o],!0),u=c/d+e.leftMargin+e.rightMargin>i?-1:1,h=o+u,g=null;for(;h>=0&&h<=a.length-1;){const n=c/(d=t.getMilliSecondsPerPixelForZoomLevel(l=a[h],!0))+e.leftMargin+e.rightMargin;if(-1===u){if(n<=i){g=h;break}}else{if(!(n<=i))break;o!==h-u&&(g=h)}h+=u}const m=_a.getPreset((l=a[g=null!=g?g:h-u]).preset).bottomHeader.unit;(e.leftMargin||e.rightMargin)&&(n=new Date(n.getTime()-d*e.leftMargin),r=new Date(r.getTime()+d*e.rightMargin));const p=Ne.getDurationInUnit(n,r,m,!0)/l.increment;if(0===p)return null;let f,v=Math.floor(i/p),y=e.centerDate||new Date((n.getTime()+r.getTime())/2);return f=s?{startDate:n,endDate:r}:t.calculateOptimalDateRange(y,i,l),t.zoomToLevel(g,Object.assign(f,{width:v,centerDate:y}))}return null}zoomIn(e=1){const t=this.zoomLevel;return t>=this.zoomLevels.length-1?null:this.zoomToLevel(Math.floor(t)+e)}zoomOut(e=1){const t=this.zoomLevel;return t<=0?null:this.zoomToLevel(Math.ceil(t)-e)}zoomInFull(){return this.zoomToLevel(this.maxZoomLevel)}zoomOutFull(){return this.zoomToLevel(this.minZoomLevel)}calculateOptimalDateRange(e,t,n,r){if(r)return r;const s=this.timeAxis;if(this.zoomKeepsOriginalTimespan)return{startDate:s.startDate,endDate:s.endDate};const i=this.getZoomLevelUnit(n),o=Math.ceil(t/n.width*n.increment*this.visibleZoomFactor/2),a=Ne.add(e,-o,i),l=Ne.add(e,o,i);return{startDate:s.floorDate(a,!1,i,n.increment),endDate:s.ceilDate(l,!1,i,n.increment)}}onWheel(e){const t=this;e.ctrlKey&&(e.preventDefault(),t.preventScrollZoom||(e.deltaY>0?t.zoomOut():e.deltaY<0&&t.zoomIn(),t.preventScrollZoom=!0,t.setTimeout(()=>t.preventScrollZoom=!1,30)))}setTimeSpan(e,t){this.timeAxis.setTimeSpan(e,t)}shift(e,t){this.timeAxis.shift(e,t)}shiftNext(e){this.timeAxis.shiftNext(e)}shiftPrevious(e){this.timeAxis.shiftPrevious(e)}get widgetClass(){}}),Cl=e=>(class extends(e||W){static get defaultConfig(){return{barMargin:10,resourceMargin:null,managedEventSizing:!0,generatedIdCls:"b-sch-dirty-new",dirtyCls:"b-sch-dirty",committingCls:"b-sch-committing",endsOutsideViewCls:"b-sch-event-endsoutside",startsOutsideViewCls:"b-sch-event-startsoutside",fixedEventCls:"b-sch-event-fixed",eventStyle:"plain",eventColor:"green"}}get barMargin(){return this._barMargin}set barMargin(e){const t=this;We.assertNumber(e,"barMargin"),t.isHorizontal&&t.rowHeight&&(e=Math.min(Math.ceil(t.rowHeight/2),e)),t._barMargin!==e&&(t._barMargin=e,t.rendered&&(t.currentOrientation.onBeforeRowHeightChange(),t.refreshWithTransition()))}get resourceMargin(){return null==this._resourceMargin?this.barMargin:this._resourceMargin}set resourceMargin(e){const t=this;We.assertNumber(e,"resourceMargin"),t.isHorizontal&&t.rowHeight&&(e=Math.min(Math.ceil(t.rowHeight/2),e)),t._resourceMargin!==e&&(t._resourceMargin=e,t.rendered&&(t.currentOrientation.onBeforeRowHeightChange(),t.refreshWithTransition()))}set tickWidth(e){this.tickSize=e}get tickWidth(){return this.tickSize}set tickSize(e){We.assertNumber(e,"tickSize"),this.timeAxisViewModel.tickSize=e}get tickSize(){return this.timeAxisViewModel.tickSize}static get eventColors(){return["red","pink","purple","violet","indigo","blue","cyan","teal","green","lime","yellow","orange","gray"]}static get eventStyles(){return["plain","border","hollow","colored","line","dashed","minimal"]}get widgetClass(){}}),wl=e=>(class extends(e||W){scrollToDate(e,t={}){const n=this,r=n.timeAxisSubGrid.scrollable.viewport,s=n.getCoordinateFromDate(e,!0),i=n.isHorizontal?new oe(n.getCoordinateFromDate(e,!1),r.y,n.timeAxisViewModel.tickSize,r.height):new oe(r.x,n.getCoordinateFromDate(e,!1),r.width,n.timeAxisViewModel.tickSize);return n.scrollToCoordinate(s,i,e,t)}scrollToNow(e={}){return this.scrollToDate(new Date,e)}scrollToCoordinate(e,t,n,r={}){const s=this;if(e<0){const e=(s.timeAxis.endDate-s.timeAxis.startDate)/2,t=new Date(n.getTime()-e),i=new Date(n.getTime()+e);return t-s.startDate!=0&&i-s.endDate!=0?(s.setTimeSpan(t,i),s.scrollToDate(n,r)):void 0}return s.timeAxisSubGrid.scrollable.scrollIntoView(t,r)}set scrollLeft(e){this.timeAxisSubGrid.scrollable.x=e}set scrollTop(e){this.scrollable.y=e}get scrollLeft(){return this.timeAxisSubGrid.scrollable.x}get scrollTop(){return this.scrollable.y}scrollHorizontallyTo(e,t=!0){return this.timeAxisSubGrid.scrollable.scrollTo(e,null,t)}scrollVerticallyTo(e,t=!0){return this.scrollable.scrollTo(null,e,t)}scrollTo(e,t=!0){return this.timeAxisSubGrid.scrollable.scrollTo(e,null,t)}get widgetClass(){}});const Sl=["viewPreset","eventBarTextField","eventRenderer","eventRendererThisObj","eventBodyTemplate"],Dl={fn:"exitTransition",delay:0,cancelOutstanding:!0},El=function(){class e extends(Dr(oa).mixes(pl,vl,Cl,wl,yl,bl)){static get defaultConfig(){return{weekStartDay:Ne.weekStartDay,workingTime:null,timeAxis:null,timeAxisViewModel:null,autoAdjustTimeAxis:!0,startDate:null,endDate:null,snap:!1,snapRelativeToEventStartDate:!1,forceFit:!1,eventCls:null,getDateConstraints:null,timeCellCls:null,timeCellSelector:null,scheduledEventName:null,createEventOnDblClick:!0,overScheduledEventClass:null,preventOverCls:!1,hoveredEventNode:null,useBackgroundCanvas:!1,enableEventAnimations:!G.isIE11,disableGridRowModelWarning:!0,animateRemovingRows:!1,partner:null,schedulerRegion:"normal",transitionDuration:200,animationTimeout:null,milestoneLayoutMode:"default",defaultRegion:"locked"}}construct(e={}){const t=this,n=e.schedulerRegion||"normal",{subGridConfigs:r={}}=e;e.subGridConfigs=r,r[n]=r[n]||{},r[n].headerClass=gl,"flex"in r[n]||"width"in r[n]||(r[n].flex=1),super.construct(e),t.onSchedulerViewportResize=t.throttle(t.onSchedulerViewportResize,250),t.initDomEvents(),t.currentOrientation.init(),t.rowManager.on("refresh",()=>{t.forceLayout=!1}),t.loadMask&&t.crudManager&&t.crudManager.isLoading&&t.maskBody(t.loadMask)}doDestroy(){const e=this,{currentOrientation:t}=this;t&&t.destroy(),e.partneredWith&&(e.partneredWith.forEach(t=>{e.removePartner(t)}),e.partneredWith.destroy()),super.doDestroy()}startConfigure(e){super.startConfigure(e),this._thisIsAUsedExpression(this.partner)}initSubGrids(){super.initSubGrids();const e=this,t=e.timeAxisSubGrid=e.timeAxisColumn.subGrid=e.subGrids[e.timeAxisColumn.region];t.sealedColumns=!0,t.on({resize:e.onTimeAxisSubGridResize,thisObj:e})}initScroll(){let e=this,t=0;super.initScroll(),e.on("horizontalscroll",({subGrid:n,scrollLeft:r})=>{e.rendered&&n===e.timeAxisSubGrid&&e.onSchedulerHorizontalScroll(n,r),t++}),"horizontal"===e.testPerformance&&setTimeout(()=>{let n=performance.now(),r=5,s=1,i=setInterval(()=>{if(r+=5,e.scrollLeft+=(10+Math.floor(r))*s,1===s&&e.scrollLeft>5500&&(s=-1,r=5),-1===s&&e.scrollLeft<=0){let r=1e3/((performance.now()-n)/t);r=Math.round(10*r)/10,clearInterval(i),console.log(e.eventPositionMode,e.eventScrollMode,r+"fps")}},0)},500)}get hasVisibleEvents(){return!this.noFeatureElementsInAxis()||this.eventStore.storage.values.some(e=>this.timeAxis.isTimeSpanInAxis(e))}noFeatureElementsInAxis(){}get capitalizedEventName(){return this._capitalizedEventName||(this._capitalizedEventName=$.capitalizeFirstLetter(this.scheduledEventName)),this._capitalizedEventName}set partner(e){const t=this,n=t.partneredWith||(t.partneredWith=new cn);t._partner=e,n.includes(e)||(n.add(e),(e.partneredWith||(e.partneredWith=new cn)).add(t),e.on({presetchange:"onPartnerPresetChange",thisObj:t}),t.on({presetchange:"onPartnerPresetChange",thisObj:e}),t.setConfig({viewPreset:e.viewPreset,timeAxis:e.timeAxis,timeAxisViewModel:e.timeAxisViewModel}),t.initScroll=At.createSequence(t.initScroll,()=>{t.scrollable.addPartner(e.scrollable,"x")},t))}removePartner(e){const t=this,n=t.partneredWith;n&&n.includes(e)&&(n.remove(e),e.partneredWith.remove(t),e.scrollable.removePartner(t.scrollable),e.un({presetchange:"onPartnerPresetChange",thisObj:t}),t.un({presetchange:"onPartnerPresetChange",thisObj:e}))}onPartnerPresetChange({preset:e,startDate:t,endDate:n,centerDate:r}){this.viewPreset!==e&&this.setViewPreset(e,t,n,!1,{centerDate:r})}get partner(){return this._partner}get timeAxisColumn(){return this.columns&&this._timeAxisColumn}get columns(){return super.columns}set columns(e){const t=this;let n,r,s=e&&e.length,i={};e&&(e.forEach((e,t)=>{"timeAxis"===e.type&&(s=t,i=e)}),t.isVertical?(t._horizontalColumns=e,e=[{type:"verticalTimeAxis",locked:!0,timeline:t},e[s]],s=1):e=e.slice(),i=e[s]=Object.assign({type:"timeAxis",locked:!1,timeline:t,cellCls:t.timeCellCls,mode:t.mode},i),Sl.forEach(e=>{null!=(r=t[e])&&(i[e]=r)})),super.columns=e,e&&(n=t._timeAxisColumn=t.columns.getAt(s)).relayAll(t)}set eventCls(e){const t=this;t._eventCls=e,t.eventSelector||(t.eventSelector=`.${e}-wrap`,t.unreleasedEventSelector=`${t.eventSelector}:not(.b-sch-released)`),t.eventInnerSelector||(t.eventInnerSelector="."+e)}get eventCls(){return this._eventCls}set timeAxisViewModel(e){const t=this,n={update:"onTimeAxisViewModelUpdate",prio:100,thisObj:t};t.partner&&!e||(e instanceof hl?e.on(n):(e=Object.assign({mode:t._mode,snap:t.snap,forceFit:t.forceFit,timeAxis:t.timeAxis,listeners:n},e),e=new hl(e)),t._timeAxisViewModel=e)}get timeAxisViewModel(){return this._timeAxisViewModel||(this.timeAxisViewModel=null),this._timeAxisViewModel}set timeAxis(e){const t=this;t.partner&&!e||(t.timeAxisDetacher&&t.timeAxisDetacher(),e instanceof Pa||(e=We.assign({viewPreset:t.viewPreset,autoAdjust:t.autoAdjustTimeAxis,mode:"plain",weekStartDay:t.weekStartDay},e),t.startDate&&(e.startDate=t.startDate),t.endDate&&(e.endDate=t.endDate),t.workingTime&&t.applyWorkingTime(e),e=new Pa(e)),t.timeAxisDetacher=e.on({thisObj:t,reconfigure({config:e}){t.trigger("timeAxisChange",{config:e})}}),t._timeAxis=e)}get timeAxis(){return this._timeAxis||(this.timeAxis=null),this._timeAxis}set workingTime(e){this._workingTime=e,this.isConfiguring||this.applyWorkingTime(this.timeAxis)}get workingTime(){return this._workingTime}applyWorkingTime(e){const t=this,n=t._workingTime;if(n){let t=null;n.fromHour>=0&&n.fromHour<24&&n.toHour>n.fromHour&&n.toHour<=24&&n.toHour-n.fromHour<24&&(t={from:n.fromHour,to:n.toHour});let r=null;n.fromDay>=0&&n.fromDay<7&&n.toDay>n.fromDay&&n.toDay<=7&&n.toDay-n.fromDay<7&&(r={from:n.fromDay,to:n.toDay}),e.include=t||r?{hour:t,day:r}:null}else e.include=null;t.rendered&&(t.timeAxisColumn.refreshHeader(),t.features.columnLines&&t.features.columnLines.drawLines(),t.refreshWithTransition())}set startDate(e){this.setStartDate(e)}setStartDate(e,t=!0){const n=this._timeAxis||{},{startDate:r,endDate:s,mainUnit:i}=n;if(this._timeAxis&&s){if(e){let o=s;if(t&&r){const t=Ne.diff(r,s,i,!0);o=Ne.add(e,t,i)}n.setTimeSpan(e,o)}}else this._tempStartDate=e}get startDate(){return this._timeAxis?this._timeAxis.startDate:this._tempStartDate||new Date}set endDate(e){this.setEndDate(e)}setEndDate(e,t=!1){const n=this._timeAxis||{},{startDate:r,endDate:s,mainUnit:i}=n;if(this._timeAxis&&r){if(e){let o=r;if(t&&s){const t=Ne.diff(r,s,i,!0);o=Ne.add(e,-t,i)}n.setTimeSpan(o,e)}}else this._tempEndDate=e}get endDate(){const e=this;return e._timeAxis?e._timeAxis.endDate:e._tempEndDate||Ne.add(e.startDate,e.viewPreset.defaultSpan,e.viewPreset.mainHeader.unit)}get features(){return super.features}set features(e){"regionResize"in(e=!0===e?{}:e)||(e.regionResize=!0),super.features=e}get eventStyle(){return this._eventStyle}set eventStyle(e){this._eventStyle=e,this.rendered&&this.refreshWithTransition()}get eventColor(){return this._eventColor}set eventColor(e){this._eventColor=e,this.rendered&&this.refreshWithTransition()}onLocaleChange(){super.onLocaleChange(),this.timeAxisColumn.refreshHeader()}onInternalResize(e,t,n,r,s){const i=this._bodyRectangle;super.onInternalResize(e,t,n,r,s),i&&n!==s&&this.onSchedulerViewportResize(i.width,this.bodyContainer.offsetHeight,i.width,i.height)}onTimeAxisSubGridResize({width:e,oldWidth:t}){if(e!==t){const n=this._bodyRectangle;this.onSchedulerViewportResize(e,n.height,t,n.height)}}onSchedulerViewportResize(e,t,n,r){const s=this,i=s.timeAxisSubGrid;s.rendered&&(s.currentOrientation.onViewportResize(e,t,n,r),null!=s._lastOverflow&&s._lastOverflow!==i.overflowingHorizontally||(s.setTimeout(()=>{s.timeAxisViewModel.availableSpace=s.isHorizontal?i.width:i.height},0),s.partneredWith&&!s.isSyncingFromPartner&&s.partneredWith.forEach(e=>{e.isSyncingFromPartner||(e.isSyncingFromPartner=!0,s.eachSubGrid(t=>{const n=e.subGrids[t.region];n.width!==t.width&&(t.collapsed?n.collapse():(n.collapsed&&n.expand(),t.flex?t.flex!==n.flex&&(n.flex=t.flex):n.width=t.width))}),e.isSyncingFromPartner=!1)})),s.trigger("timelineViewportResize",{width:e,height:t,oldWidth:n,oldHeight:r}),s._lastOverflow=i.overflowingHorizontally)}onTimeAxisViewModelUpdate(){this.updateCanvasSize(),this.isHorizontal&&(this.callEachSubGrid("refreshFakeScroll"),this.refreshVirtualScrollbars())}get currentOrientation(){throw new Error("Implement in subclass")}get isHorizontal(){return!0}get backgroundCanvas(){return this._backgroundCanvas}get foregroundCanvas(){return this._foregroundCanvas}get svgCanvas(){const e=this;if(!e._svgCanvas){const t=e._svgCanvas=document.createElementNS("http://www.w3.org/2000/svg","svg");e.foregroundCanvas.appendChild(t),e.trigger("svgCanvasCreated")}return e._svgCanvas}get timeAxisSubGridElement(){return this.timeAxisColumn&&this.timeAxisColumn.subGridElement}updateCanvasSize(){const e=this;e.isHorizontal?(e.backgroundCanvas&&(e.backgroundCanvas.style.width=`${e.timeAxisViewModel.totalSize}px`),e.foregroundCanvas.style.width=`${e.timeAxisViewModel.totalSize}px`):(e.backgroundCanvas&&(e.backgroundCanvas.style.width=yt.setLength(e.timeAxisColumn.width)),e.foregroundCanvas.style.width=yt.setLength(e.timeAxisColumn.width))}refresh(e=!0,t=null){const n=this;n.rendered&&!n.refreshSuspended&&(n.hasVisibleEvents?(n.refreshRows(!1,e),t&&t()):n.rowManager.trigger("refresh"))}render(e){const t=this,n=t.timeAxisSubGridElement;t.useBackgroundCanvas&&(t._backgroundCanvas=yt.createElement({className:"b-sch-background-canvas",parent:n,nextSibling:n.firstElementChild}));const r=t._foregroundCanvas=yt.createElement({className:"b-sch-foreground-canvas",style:`font-size:${t.rowHeight-2*t.barMargin}px`,parent:n});t.timeAxisSubGrid.insertRowsBefore=r,super.render(e)}refreshRows(e=!1,t=!0){this.isConfiguring||(this.currentOrientation.refreshRows(t),super.refreshRows(e))}reRender(e=!1){this.refreshFromRerender=!0,super.reRender(e),this.initDomEvents()}getDateConstraints(){}runWithTransition(e,t){const n=this;n.isVisible&&(null!=t&&!0!==t||(t=n.transitionDuration),t&&n.enableEventAnimations&&(n.isAnimating=!0,Dl.delay=t,n.setTimeout(Dl))),e()}exitTransition(){this.isAnimating=!1,this.trigger("transitionend")}refreshWithTransition(e){this.runWithTransition(()=>this.refresh(e))}getVisibleDateRange(){return this.currentOrientation.getVisibleDateRange()}}return e._$name="TimelineBase",e}(),xl={ExcelExporter:{"No resource assigned":"No resource assigned"},ResourceInfoColumn:{eventCountText:function(e){return e+" event"+(1!==e?"s":"")}},Dependencies:{from:"From",to:"To",valid:"Valid",invalid:"Invalid",Checking:"Checking\u2026"},DependencyEdit:{From:"From",To:"To",Type:"Type",Lag:"Lag","Edit dependency":"Edit dependency",Save:"Save",Delete:"Delete",Cancel:"Cancel",StartToStart:"Start to Start",StartToEnd:"Start to End",EndToStart:"End to Start",EndToEnd:"End to End"},EventEdit:{Name:"Name",Resource:"Resource",Start:"Start",End:"End",Save:"Save",Delete:"Delete",Cancel:"Cancel","Edit Event":"Edit event"},Scheduler:{"Add event":"Add event","Delete event":"Delete event","Unassign event":"Unassign event"},HeaderContextMenu:{pickZoomLevel:"Zoom",activeDateRange:"Date range",startText:"Start date",endText:"End date",todayText:"Today"},EventFilter:{filterEvents:"Filter tasks",byName:"By name"},TimeRanges:{showCurrentTimeLine:"Show current timeline"},PresetManager:{minuteAndHour:{topDateFormat:"ddd MM/DD, hA"},hourAndDay:{topDateFormat:"ddd MM/DD"},weekAndDay:{displayDateFormat:"hh:mm A"}}};for(let hp in fn)xl[hp]=fn[hp];he.registerLocale("En",{desc:"English",locale:xl});var Tl=e=>(class extends(e||W){getElementFromAssignmentRecord(e){return this.currentOrientation.getElementFromEventRecord(e.event,e.resource)}getElementFromEventRecord(e,t){return this.currentOrientation.getElementFromEventRecord(e,t)}getElementsFromEventRecord(e,t){return this.currentOrientation.getElementsFromEventRecord(e,t)}getEventIdFromDomNodeId(e){const t=e.substring(this.eventPrefix.length).split("-")[0];return t&&t.replace(/\._\./g,"-")}getEventRecordFromDomId(e){return e=this.getEventIdFromDomNodeId(e),this.eventStore.getById(e)}getResourceIdFromDomNodeId(e){const t=e.substring(this.eventPrefix.length).split("-")[1];return t&&t.replace(/\._\./g,"-")}getResourceRecordFromDomId(e){return e=this.getResourceIdFromDomNodeId(e),this.resourceStore.getById(e)}resolveResourceRecord(e,t){return this.currentOrientation.resolveRowRecord(e,t)}resolveEventRecord(e){if(e=yt.up(e,this.eventSelector)){if(e.dataset.eventId)return this.eventStore.getById(e.dataset.eventId);if(e.dataset.assignmentId)return this.assignmentStore.getById(e.dataset.assignmentId).event}return null}resolveTimeSpanRecord(e){return this.resolveEventRecord(e)}resolveAssignmentRecord(e){const{assignmentStore:t}=this.eventStore;let n=null;if(t){const r=yt.up(e,this.eventSelector),s=this.resolveEventRecord(r),i=this.resolveResourceRecord(r);s&&i&&(n=t.getAssignmentForEventAndResource(s,i))}return n}isRowVisible(e){return this.store.indexOf(e)>=0}getMilestoneLabelWidth(e){const t=this,n=t.milestoneLayoutMode;if("measure"===n){const n=t.milestoneMeasureElement||(t.milestoneMeasureElement=yt.createElement({className:"b-sch-event-wrap b-milestone-wrap b-measure",children:[{className:"b-sch-event b-milestone",html:"<label></label>"}],parent:t.foregroundCanvas}));return n.firstElementChild.firstElementChild.innerHTML=e.name,n.offsetWidth}return"estimate"===n?Math.max(e.name.length*t.milestoneCharWidth,t.milestoneMinWidth):"data"===n?Math.max(e.milestoneWidth,t.milestoneMinWidth):0}set milestoneLayoutMode(e){this._milestoneLayoutMode=e,this.element.classList["default"!==e?"add":"remove"]("b-sch-layout-milestones"),this.refresh()}get milestoneLayoutMode(){return this._milestoneLayoutMode}set milestoneAlign(e){this._milestoneAlign=e,this.refresh()}get milestoneAlign(){return this._milestoneAlign}set milestoneCharWidth(e){this._milestoneCharWidth=e,this.refresh()}get milestoneCharWidth(){return this._milestoneCharWidth}get widgetClass(){}}),Rl=e=>(class extends(e||W){getTimeSpanMouseEventParams(e,t){return{eventRecord:this.resolveEventRecord(e),resourceRecord:this.resolveResourceRecord(e),assignmentRecord:this.resolveAssignmentRecord(e),eventElement:e,event:t}}getScheduleMouseEventParams(e,t){return{resourceRecord:this.isVertical?this.resolveResourceRecord(t):this.store.getById(e.id)}}onElementKeyDown(e){super.onElementKeyDown(e),this.selectedEvents.length&&this.trigger(this.scheduledEventName+"KeyDown",{eventRecord:this.selectedEvents})}onElementKeyUp(e){super.onElementKeyUp(e),this.selectedEvents.length&&this.trigger(this.scheduledEventName+"KeyUp",{eventRecord:this.selectedEvents})}get widgetClass(){}}),kl=e=>(class extends(e||W){construct(e){super.construct(e),this.hasFeature("eventDragCreate")&&this.on({dragcreateend:this.internalOnDragCreateEnd,thisObj:this})}internalOnDragCreateEnd({newEventRecord:e,resourceRecord:t}){const n=this;if(!n.eventEdit){const r=t?[t]:[];!1!==n.trigger("beforeEventAdd",{eventRecord:e,resourceRecords:r,resources:r})&&(n.onEventCreated(e),n.eventStore.add(e),e.assign(t))}}get eventEditor(){return this._eventEditor}set eventEditor(e){this._eventEditor=e}get widgetClass(){}});const Ml=function(){class e extends W{static get defaultConfig(){return{nbrOfBandsByResource:{},bandIndexToPxConvertFn:null,bandIndexToPxConvertThisObj:null}}clearCache(e){e?delete this.nbrOfBandsByResource[e.id]:this.nbrOfBandsByResource={}}getNumberOfBands(e,t){const n=this.nbrOfBandsByResource;if(n.hasOwnProperty(e.id))return n[e.id];const r=("function"==typeof t?t():t).map(e=>({start:e.startDate,end:e.endDate,event:e}));return this.applyLayout(r,e)}applyLayout(e,t){const n=e.slice(),r=this.layoutEventsInBands(n);return this.nbrOfBandsByResource[t.id]=r}}return e._$name="HorizontalLayout",e}(),Il=function(){class e extends Ml{layoutEventsInBands(e){let t=0;do{let n=e[0];for(;n;)n.top=this.bandIndexToPxConvertFn.call(this.bandIndexToPxConvertThisObj||this,t,n.event),e.splice(e.indexOf(n),1),n=this.findClosestSuccessor(n,e);t++}while(e.length>0);return t}findClosestSuccessor(e,t){let n,r,s,i=1/0,o=e.endMs,a=0===e.event.duration;for(let l=0,c=t.length;l<c;l++)(r=(s=t[l]).startMs-o)>=0&&r<i&&(r>0||s.endMs-s.startMs>0||!a)&&(n=s,i=r);return n}}return e._$name="HorizontalLayoutStack",e}();var Al=e=>(class extends(e||W){static get defaultConfig(){return{coordProp:"top",sizeProp:"height"}}applyLayout(e,t){const n=this,{coordProp:r,sizeProp:s}=n;let i,o,a,l;for(let c=0,d=e.length;c<d;c++){if(i=n.findStartSlot(e,o=e[c]),(a=n.getCluster(e,c)).length>1){for(o[r]=i.start,o[s]=i.end-i.start,l=1;l<a.length-1&&a[l+1].start-o.start==0;)l++;const t=n.findStartSlot(e,a[l]);t&&t.start<.8&&(a.length=l)}const d=a.length,u=(i.end-i.start)/d;for(l=0;l<d;l++)t(a[l],l,i,u);c+=d-1}}findStartSlot(e,t){const{sizeProp:n,coordProp:r}=this,s=this.getPriorOverlappingEvents(e,t);let i;if(0===s.length)return{start:0,end:1};for(i=0;i<s.length;i++){if(0===i&&s[0][r]>0)return{start:0,end:s[0][r]};if(s[i][r]+s[i][n]<(i<s.length-1?s[i+1][r]:1))return{start:s[i][r]+s[i][n],end:i<s.length-1?s[i+1][r]:1}}return!1}getPriorOverlappingEvents(e,t){const n=t.start,r=t.end,s=[];for(let i=0,o=e.indexOf(t);i<o;i++)Ne.intersectSpans(n,r,e[i].start,e[i].end)&&s.push(e[i]);return s.sort(this.sortOverlappers.bind(this)),s}sortOverlappers(e,t){return e[this.coordProp]<t[this.coordProp]?-1:1}getCluster(e,t){const n=e[t];if(t>=e.length-1)return[n];const r=[n],s=e.length;let{start:i,end:o}=n,a=t+1;for(;a<s&&Ne.intersectSpans(i,o,e[a].start,e[a].end);)r.push(e[a]),i=Ne.max(i,e[a].start),o=Ne.min(e[a].end,o),a++;return r}});const Fl=function(){class e extends(Al(Ml)){applyLayout(e){super.applyLayout(e,(e,t,n,r)=>{e.height=r,e.top=n.start+t*r}),e.forEach(e=>{Object.assign(e,this.bandIndexToPxConvertFn.call(this.bandIndexToPxConvertThisObj||this,e.top,e.height,null,e.event))})}}return e._$name="HorizontalLayoutPack",e}(),Ol=/-/g;var Ll=e=>(class extends(e||W){static get defaultConfig(){return{eventRenderer:null,eventRendererThisObj:null,eventPrefix:"",eventLayout:"stack",horizontalLayoutPackClass:Fl,horizontalLayoutStackClass:Il,horizontalEventSorterFn:null,eventBarTextField:"name",eventBodyTemplate:null,eventPositionMode:"translate",eventScrollMode:"move",fillTicks:!1,useInitialAnimation:!0,resourceColumns:null,resourceImagePath:null,defaultResourceImageName:"none.png",resourceMargin:null,isFirstRender:!0}}get eventPrefix(){return this._eventPrefix}set eventPrefix(e){this._eventPrefix=e||this.id+"-"}get layouts(){const e=this;return e._eventLayout||(e._eventLayout={},e.horizontalLayoutPackClass&&(e._eventLayout.horizontalPack=new e.horizontalLayoutPackClass(Object.assign({scheduler:e,timeAxisViewModel:e.timeAxisViewModel,bandIndexToPxConvertFn:e.horizontal.layoutEventVerticallyPack,bandIndexToPxConvertThisObj:e.horizontal},e.horizontalEventSorterFn?{sortEvents:this.horizontalEventSorterFn}:{}))),e.horizontalLayoutStackClass&&(e._eventLayout.horizontalStack=new e.horizontalLayoutStackClass(Object.assign({scheduler:e,timeAxisViewModel:e.timeAxisViewModel,bandIndexToPxConvertFn:e.horizontal.layoutEventVerticallyStack,bandIndexToPxConvertThisObj:e.horizontal},e.horizontalEventSorterFn?{sortEvents:this.horizontalEventSorterFn}:{})))),e._eventLayout}get eventLayout(){return this._overlapMode}set eventLayout(e){const t=this;e!=t._overlapMode&&(t.element.classList.remove(`b-eventlayout-${t._overlapMode}`),t._overlapMode=e,t.runWithTransition(()=>{t.element.classList.add(`b-eventlayout-${t._overlapMode}`),t.refresh()}))}get fillTicks(){return this._fillTicks}set fillTicks(e){e!=this._fillTicks&&(this._fillTicks=e,this.refreshWithTransition())}get currentEventLayout(){const e=this;if(!e.isHorizontal)return null;switch(e.eventLayout){case"stack":return e.layouts.horizontalStack;case"pack":return e.layouts.horizontalPack;default:return null}}get useInitialAnimation(){return this._useInitialAnimation}set useInitialAnimation(e){const t=this;t._useInitialAnimation&&t.element.classList.remove(`b-initial-${t._useInitialAnimation}`),t._useInitialAnimation=!0===e?"fade-in":e,e&&t.element.classList.add(`b-initial-${t._useInitialAnimation}`)}set isFirstRender(e){const t=this;t._isFirstRender=e,!t._firstRenderDone&&e&&(t._firstRenderDone=t.createOnFrame(()=>{t._isFirstRender=!1,t._firstRenderDone=null}))}get isFirstRender(){return this._isFirstRender}set resourceColumns(e){this._resourceColumns=e}get resourceColumns(){return this.timeAxisColumn&&this.timeAxisColumn.resourceColumns||this._resourceColumns}get resourceColumnWidth(){return this.resourceColumns?this.resourceColumns.columnWidth:null}getEventsToRender(e,t){return t}repaintEventsForResource(e){const t=this;if(t.isHorizontal){t.currentOrientation.cache.clearRow(e.id);const n=t.getRowFor(e);n&&n.render()}}repaintEvent(e){this.eventStore.getResourcesForEvent(e).forEach(e=>this.repaintEventsForResource(e))}generateTplData(e,t,n={viewport:!0}){const r=this,s=r.currentOrientation.getTimeSpanRenderData(e,t,n);let i="";if(s){let n=e.isResizable;s.startsOutsideView&&(!0===n?n="end":"start"===n&&(n=!1)),s.endsOutsideView&&(!0===n?n="start":"end"===n&&(n=!1));const o=e.isResourceTimeRange?new Ai:e.cls.clone(),a=e.isResourceTimeRange?e.cls.clone():new Ai;if(Object.assign(o,{[t.cls]:t.cls,[r.generatedIdCls]:e.hasGeneratedId,[r.dirtyCls]:e.modifications,[r.committingCls]:e.isCommitting,[r.endsOutsideViewCls]:s.endsOutsideView,[r.startsOutsideViewCls]:s.startsOutsideView,"b-clipped-start":s.clippedStart,"b-clipped-end":s.clippedEnd}),Object.assign(a,{[`${r.eventCls}-parent`]:t.isParent}),e.isEvent||e.isTask){Object.assign(o,{[r.eventCls]:1,"b-milestone":e.isMilestone,"b-sch-event-narrow":s.width<10,[r.fixedEventCls]:!1===e.isDraggable,[`b-sch-event-resizable-${n}`]:Boolean(r.features.eventResize),[r.eventSelectedCls]:r.isEventSelected(e)}),s.eventId=e.id,s.id=r.getEventRenderId(e,t),"id"in e.meta.modified&&(s.oldId=r.getEventRenderId(e.meta.modified.id,t)),Object.assign(a,{[`${r.eventCls}-wrap`]:1,"b-milestone-wrap":e.isMilestone});const i=e.eventStyle||t.eventStyle||r.eventStyle;s.eventColor=e.eventColor||t.eventColor||r.eventColor,s.eventStyle=i,r.assignmentStore&&e.assignments&&(s.assignment=e.assignments.find(e=>e.resourceId===t.id))}if(s.wrapperCls=a,s.cls=o,s.iconCls=new Ai(e.get(r.eventBarIconClsField)||e.iconCls),e.isResourceTimeRange?(s.style="",s.wrapperStyle=e.style||""):s.style=e.style||"",s.resource=t,s.resourceId=s.rowId,e.isEvent||e.isTask){if(r.eventRenderer){const n=r.eventRenderer.call(r.eventRendererThisObj||r,{eventRecord:e,resourceRecord:t,assignmentRecord:s.assignment,tplData:s});"string"==typeof s.cls&&(s.cls=new Ai(s.cls)),"string"==typeof s.wrapperCls&&(s.wrapperCls=new Ai(s.wrapperCls)),"string"==typeof s.iconCls&&(s.iconCls=new Ai(s.iconCls)),i=r.eventBodyTemplate&&r.eventBodyTemplate(n)||(null==n?"":String(n))}else r.eventBodyTemplate?i=r.eventBodyTemplate(e):r.eventBarTextField&&(i=e.data[r.eventBarTextField]||"");r.eventBodyTemplate||(e.isMilestone&&i&&(i=`<label>${i}</label>`),s.iconCls&&s.iconCls.length&&(i=`<i class="${s.iconCls}"></i>${i}`)),s.wrapperCls[`b-sch-style-${s.eventStyle}`]=s.eventStyle,s.eventColor&&s.eventColor.startsWith("#")?s.style=`background-color:${s.eventColor};`+s.style:s.wrapperCls[`b-sch-color-${s.eventColor}`]=s.eventColor}s.cls["b-sch-event-withicon"]=s.iconCls.length,i.includes("<")?s.body=yt.createElementFromTemplate(i,{fragment:!0}):(s.body=document.createDocumentFragment(),s.body.textContent=i),s.eventContent=i,r.onEventDataGenerated(s)}return s}onEventDataGenerated(e){}getEventRenderId(e,t){const n=(e instanceof va?e.id:e).toString().replace(Ol,"._."),r=(t instanceof wa?t.id:t).toString().replace(Ol,"._.");return this.eventPrefix+`${n}-${r}-x`}get widgetClass(){}});const _l=Math.MAX_SAFE_INTEGER||Math.pow(2,53)-1,Pl={add:1,update:1,remove:1,filter:1};var $l=e=>(class extends(e||W){static get defaultConfig(){return{eventStore:null,resourceStore:null,assignmentStore:null,dependencyStore:null,store:null,startParamName:"startDate",endParamName:"endDate",passStartEndParameters:!1,crudManager:null,events:null,resources:null,assignments:null,removeUnassignedEvent:!0}}onStoreDataChange({}){this.currentOrientation.clearEvents(),super.onStoreDataChange(...arguments)}refreshFromRowOnStoreAdd(e,{isExpand:t}){const n=arguments;this.runWithTransition(()=>super.refreshFromRowOnStoreAdd(e,...n),!t)}onStoreAdd({source:e,records:t,isChild:n}){const r=this,{rowManager:s}=r;if(n&&!t[0].parent.isExpanded(r))return;s.calculateRowCount(!1,!0,!0);const i=Math.max(s.topIndex+s.rowCount,Math.min(s.visibleRowCount,e.count));t=t.sort((t,n)=>e.indexOf(t)-e.indexOf(n));let o=e.indexOf(t[0]);if(o<i)for(let a=o=Math.max(o,s.topIndex);a<i;a++)r.currentOrientation.onRowRecordUpdate({record:e.getAt(a)});else s.estimateTotalHeight();super.onStoreAdd(...arguments)}onStoreUpdateRecord(){this.suspendStoreRedraw||(this.currentOrientation.onRowRecordUpdate(...arguments),super.onStoreUpdateRecord(...arguments))}onStoreRemove(){this.currentOrientation.onRowRecordRemove(...arguments),super.onStoreRemove(...arguments)}onStoreRemoveAll(){this.currentOrientation.clearEvents(),super.onStoreRemoveAll()}doDestroy(){super.doDestroy();const e=this;e.destroyStores&&(e.assignmentStore&&e.assignmentStore.destroy(),e.resourceStore&&e.resourceStore.destroy(),e.dependencyStore&&e.dependencyStore.destroy(),e.eventStore&&e.eventStore.destroy())}get store(){const e=this;return e._thisIsAUsedExpression(e.resources),!e._store&&e.isVertical&&(e._store=new Nr({data:[{id:"verticalTimeAxisRow"}]})),super.store}set store(e){super.store=e}get resources(){const e=this.resourceStore;return e&&e.records}set resources(e){this.resourceStore.data=e}get resourceStore(){const e=this;return e._resourceStore||e.crudManager&&e.crudManager.resourceStore||(e.resourceStore=new Sa),e._resourceStore}set resourceStore(e){const t=this,n=t._resourceStore;if(e!==n){if(e instanceof Sa||(e=new Sa(e)),n){const r=n===t.store;t._resourceStore=e,e&&t.isHorizontal&&(r?(t.store=t.resourceStore,t.store.metaMapId=t.id):t.refresh())}else t._resourceStore=e;e&&(t.isVertical&&e.on("load",()=>t.unmaskBody()),t.trigger("resourceStoreChange",{newResourceStore:e,oldResourceStore:n})),t.isHorizontal&&!t._store&&(t.store=e)}}get events(){return this._eventStore.records}set events(e){this.eventStore.data=e}get eventStore(){const e=this;return e._eventStore||e.crudManager&&e.crudManager.eventStore||(e.eventStore=new Ra({resourceStore:e.resourceStore})),this._eventStore}set eventStore(e){const t=this,n=t._eventStore;let r=!1;if(e===n)return;let s=t.resourceStore;if(n){const n=t.eventStore,{assignmentStore:r,dependencyStore:i}=t;if(e===n)return;t.eventStoreDetacher&&t.eventStoreDetacher(),t._eventStore=e,t.timeAxisViewModel.eventStore=e,e&&(s&&!e.resourceStore&&(e.resourceStore=s),r&&!e.assignmentStore&&(e.assignmentStore=r),i&&!e.dependencyStore&&(e.dependencyStore=i),t.trigger("eventStoreChange",{newEventStore:e,oldEventStore:n}),t.refresh())}else{if(e.isEventStore){if(s&&e.resourceStore!==s){if(e.resourceStore)throw new Error(`eventStore ${e.id} is already linked to resourceStore ${e.resourceStore.id}`);e.resourceStore=s}}else r=e.autoLoad,e.autoLoad=!1,e=new Ra(Object.assign({resourceStore:t.resourceStore},e));t._eventStore=e}if(e){const n={thisObj:t,detachable:!0,change:"onInternalEventStoreChange",clearchanges:"onEventClearChanges",beforecommit:"onEventBeforeCommit",commit:"onEventCommit",beforeRemove:"onBeforeEventRemove",refresh:"onEventStoreRefresh",exception:"onEventException",idchange:"onEventIdChange"};t.passStartEndParameters&&(n.beforeload=t.applyStartEndParameters),t.eventStoreDetacher&&t.eventStoreDetacher(),t.eventStoreDetacher=e.on(n),e.assignmentStore&&(t.assignmentStore=e.assignmentStore),r&&e.load().catch(()=>{})}t.eventStore.count>0&&(t.eventsRendered=!0)}get assignments(){return this.assignmentStore&&this.assignmentStore.records}set assignments(e){this.assignmentStore||(this.eventStore.assignmentStore=this.assignmentStore=new pa),this.assignmentStore.data=e}get assignmentStore(){const e=this.eventStore;return e&&e.assignmentStore}set assignmentStore(e){const t=this,n=t.assignmentStore;t.eventStore.assignmentStore!==e&&(t.eventStore.assignmentStore=e),t.assignmentStoreDetacher&&t.assignmentStoreDetacher(),e&&(t.assignmentStoreDetacher=e.on({thisObj:t,refresh:t.onAssignmentRefresh,update:t.onAssignmentUpdate,add:t.onAssignmentAdd,beforeRemove:{fn:t.onBeforeAssignmentRemove,prio:-1e3},remove:t.onAssignmentRemove,filter:t.onAssignmentFilter,removeall:t.onAssignmentRemoveAll}),t.trigger("assignmentStoreChange",{newAssignmentStore:e,oldAssignmentStore:n}),t.refresh())}get dependencyStore(){const e=this.eventStore;return e&&e.dependencyStore||this._dependencyStore}set dependencyStore(e){const t=this;if(t.isConfigured){const n=t.dependencyStore;t.eventStore.dependencyStore=e,e&&(t.trigger("dependencyStoreChange",{newDependencyStore:e,oldDependencyStore:n}),t.refresh())}else t._dependencyStore=e}get crudManager(){return this._crudManager}set crudManager(e){e instanceof Fa?this._crudManager=e:e=new Fa(Object.assign({scheduler:this},e))}onEventIdChange(e){this.currentOrientation.onEventStoreIdChange&&this.currentOrientation.onEventStoreIdChange(e)}onInternalEventStoreChange(e){const t=this;if(t._mode)if(t.isVertical)t.currentOrientation.onEventStoreChange(e);else{const n=t.currentOrientation,r=e.source,{rowManager:s,resourceStore:i}=t,{action:o,changes:a,isCollapse:l}=e,c=e.records||(e.record?[e.record]:null),d=[];let u,h,g=new Set,m=!1;if(!t.rendered)return;if(l||"update"===o&&c.length&&c[0].meta.removingResource)return;if(("filter"!==o||!t.hasFeature("resourceTimeRanges"))&&Pl[o]&&c){if(a&&"resourceId"in a&&null!=a.resourceId.oldValue){const e=i.getById(a.resourceId.oldValue),t=e&&s.getRowFor(e);t&&(d.push(e),g.add(t))}for(h=0,u=c.length;h<u;h++)d.push(...r.getResourcesForEvent(c[h]).filter(e=>{if(e){const t=s.getRowFor(e);if(t)return g.add(t),!0}return!1}));if(d.length){if(g.size>1)g=new Set([...g].sort((e,t)=>e.dataIndex-t.dataIndex));else if(!g.size)return}else if("filter"!==o||c.length)return void s.estimateTotalHeight();e.resources=d}switch(o){case"dataset":n.onEventDataset();break;case"add":n.onEventAdd(e),m=!0;break;case"update":n.onEventUpdate(e),m=!0;break;case"remove":n.onEventRemove(e),m=!0;break;case"removeall":n.onEventRemoveAll();break;case"filter":n.onEventFilter(e);break;case"clearchanges":n.onEventClearChanges(e)}t.runWithTransition(()=>{g.size?s.renderRows(g):s.renderFromRow()},m)}}onEventStoreRefresh({action:e}){"batch"===e&&this.rowManager.rowCount&&(this.currentOrientation.onEventDataset&&this.currentOrientation.onEventDataset(),this.refresh())}onBeforeEventRemove({records:e}){const t=this;if(t.activeEvent&&e.includes(t.activeEvent)){let n;if("key"===Cn.lastInteractionType)for(let r=0,s=e.length;r<s&&(!n||e.includes(n));r++)if(t.eventStore.getResourcesForEvent(e[r]).length){const s=e[r],i=s.assignments&&s.assignments.length?s.assignments[0]:s;n=t.getNext(i,!0)||t.getPrevious(i,!0)}n?t.navigateTo(n):t.element.focus()}}onEventCommit({changes:e}){[...e.added,...e.modified].forEach(e=>this.repaintEvent(e))}onEventBeforeCommit({changes:e}){[...e.added,...e.modified].forEach(e=>this.getElementsFromEventRecord(e).forEach(e=>e.classList.add(this.committingCls)))}onEventException({action:e}){if("commit"===e){const{changes:e}=this.eventStore;[...e.added,...e.modified,...e.removed].forEach(e=>this.repaintEvent(e))}}onEventClearChanges(){this.refresh()}onAssignmentRefresh(e){!this.isHorizontal||"dataset"!==e.action&&"batch"!==e.action||this.refresh()}onAssignmentAdd({records:e}){this.isHorizontal&&e.forEach(e=>{const t=e.resource;t&&this.repaintEventsForResource(t)})}onAssignmentUpdate({record:e,changes:t}){if(this.isHorizontal){const{rowManager:n}=this,r=this.currentOrientation.cache,s="resourceId"in t&&t.resourceId.oldValue,i=e.resourceId;let o,a=_l;null!=s&&(o=n.getRowFor(s))&&(r.clearRow(s),a=Math.min(a,o.index)),i&&(o=n.getRowFor(i))&&(r.clearRow(i),a=Math.min(a,o.index)),a!==_l&&n.renderFromRow(n.rows[a])}}onBeforeAssignmentRemove({source:e,records:t}){if(e.isRemovingEvent)return;const n=this,r=t.reduce((e,t)=>{const n=t.event;return!n||n.placeHolder||e.includes(n)||e.push(n),e},[]);let s;if(n.activeEvent&&r.includes(n.activeEvent)){if("key"===Cn.lastInteractionType)for(let e=0,r=t.length;e<r&&(!s||t.includes(s));e++)if(n.eventStore.getResourcesForEvent(t[e].event).length){const r=t[e],i=r.assignments&&r.assignments.length?r.assignments[0]:r;s=n.getNext(i)||n.getPrevious(i)}s?n.navigateTo(s):n.element.focus()}if(n.removeUnassignedEvent&&!n.isRemoving){const e=r.reduce((e,n)=>{let r=n.assignments?n.assignments.length:0;return(r-=t.filter(e=>e.event===n).length)||e.push(n),e},[]);n.eventStore.remove(e)}}onAssignmentRemove({records:e}){this.isHorizontal&&e.forEach(e=>{const t=e.resource;t&&this.repaintEventsForResource(t)})}onAssignmentRemoveAll(){this.isHorizontal&&this.refresh()}onAssignmentFilter(){this.isHorizontal&&this.refresh()}applyStartEndParameters({source:e,params:t}){const n=e.modelClass.fieldMap.startDate.dateFormat;t[this.startParamName]=Ne.format(this.startDate,n),t[this.endParamName]=Ne.format(this.endDate,n)}get widgetClass(){}});const jl=new Promise(e=>e()),Hl={block:"nearest",edgeOffset:20};var Nl=e=>(class extends(e||W){scrollEventIntoView(e,t=Hl){const n=e.resources||[e];if(n.length>1)throw new Error("scrollEventIntoView() is not applicable for events with multiple assignments, please use scrollResourceEventIntoView() instead.");return n.length?this.scrollResourceEventIntoView(n[0],e,null,t):(console.warn("You have asked to scroll to an event which is not assigned to a resource"),jl)}scrollResourceEventIntoView(e,t,n,r=Hl){const s=this,i=t.startDate,o=t.endDate,a=i<s.timeAxis.startDate|(o>s.timeAxis.endDate)<<1;let l;if(null==r.edgeOffset&&(r.edgeOffset=20),a&&!1!==r.extendTimeAxis){let e,n,r=s.timeAxis.endDate-s.timeAxis.startDate;3===a?s.timeAxis.setTimeSpan(new Date(i.valueOf()-r/2),new Date(o.getTime()+r/2)):(e=s.getCoordinateFromDate(1&a?t.endDate:t.startDate),1&a?s.timeAxis.setTimeSpan(new Date(i),new Date(i.valueOf()+r)):s.timeAxis.setTimeSpan(new Date(o.valueOf()-r),new Date(o)),n=s.getCoordinateFromDate(1&a?t.endDate:t.startDate),s.timeAxisSubGrid.scrollable.scrollBy(n-e))}return(l=s.getElementFromEventRecord(t,e))?(yt.isFocusable(l)||(l=l.parentNode),s.timeAxisSubGrid.scrollable.scrollIntoView(l,We.assign({silent:!0},r))):a&&!1===r.extendTimeAxis?(console.warn("You have asked to scroll to an event which is outside the current view and extending timeaxis is disabled"),jl):s.eventStore.isAvailable(t)?s.scrollUnrenderedEventIntoView(e,t,r):(console.warn("You have asked to scroll to an event which is not available"),jl)}scrollUnrenderedEventIntoView(e,t,n=Hl){null==n.edgeOffset&&(n.edgeOffset=20);const r=this,s=r.timeAxisSubGrid.scrollable,i=r.getResourceEventBox(t,e),o=s.viewport,a=new oe(i.start,i.top,i.end-i.start,i.bottom-i.top).translate(o.x-s.x,o.y-s.y),l=s.scrollIntoView(a,Object.assign({},n,{highlight:!1}));if(n.highlight||n.focus){const e=r.on({eventrepaint({eventRecord:r,element:s}){r===t&&(e(),l.then(()=>{n.highlight&&yt.highlight(s),n.focus&&s.focus()}))}})}return l}scrollResourceIntoView(e,t=Hl){return this.isVertical?this.currentOrientation.scrollResourceIntoView(e,t):this.scrollRowIntoView(e,t)}get widgetClass(){}}),zl=e=>(class extends(e||W){getScheduleRegion(e,t,n=!0){return this.currentOrientation.getScheduleRegion(e,t,n)}getResourceRegion(e,t,n){return this.currentOrientation.getRowRegion(e,t,n)}getStartEndDatesFromRectangle(e,t){return this.currentOrientation.getStartEndDatesFromRectangle(e,t)}getResourceEventBox(e,t,n=!1){const r=this,s=r.currentOrientation.getResourceEventBox(e.id,t.id);if(s)return s;const i=e.startDate,o=e.endDate;let a,l,c,d,u,h,g,m,p,f=null;if(i&&o&&(n||Ne.intersectSpans(i,o,r.timeAxis.startDate,r.timeAxis.endDate))&&this.isRowVisible(t)){if(d=r.getRowFor(t))r.managedEventSizing?(a=r.currentEventLayout,l=r.eventStore.getEventsForResource(t).reduce((e,s)=>{const i=r[r.mode].getTimeSpanRenderData(s,t,n);return i&&e.push(i),e},[]),a&&a.applyLayout(l,t),(c=l.find(t=>t.event==e))&&(u=r.getRecordCoords(t,!0).y,f={layout:!0,start:c.hasOwnProperty("left")?c.left:c.right,end:(c.hasOwnProperty("left")?c.left:c.right)+c.width,top:u+c.top,bottom:u+c.top+c.height})):(h=r.getElementsFromEventRecord(e,e!==t&&t)).length&&(m=(g=h[0]).getOffsetsTo(r.getEl()),p=g.getBox(),f={layout:!0,start:m[0],end:m[0]+p.width,top:m[1],bottom:m[1]+p.height});else{f={layout:!1,start:r.getCoordinateFromDate(Math.max(e.startDateMS,r.timeAxis.startMS)),end:r.getCoordinateFromDate(Math.min(e.endDateMS,r.timeAxis.endMS))};const n=r.rowManager.getRecordCoords(t,!0);f.top=n.y+r.barMargin,f.height=Math.max(r.rowManager.rowHeight-2*r.barMargin,1),f.bottom=f.top+f.height}f&&(f=r.adjustItemBox(e,f))}return f}getItemBox(e,t=!1){return e.resources.map(n=>this.getResourceEventBox(e,n,t))}adjustItemBox(e,t){const n=this.timeAxis.startMS,r=this.timeAxis.endMS,s=e.startDateMS,i=e.endDateMS,o=this.timeAxisViewModel.totalSize;return n>s&&(t.start=-40),n>i&&(t.end=-40),r<s&&(t.start=o+40),r<i&&(t.end=o+40),t}get widgetClass(){}});const Bl=["eventLayout","barMargin","mode","tickSize","zoomLevel","eventColor","eventStyle","fillTicks"];var Vl=e=>(class extends(e||W){getState(){return We.copyProperties(super.getState(),this,Bl)}applyState(e){We.copyProperties(this,e,Bl),super.applyState(e)}get widgetClass(){}}),Wl=e=>(class extends(e||W){static get defaultConfig(){return{multiEventSelect:!1,eventSelectionDisabled:!1,eventSelectedCls:"b-sch-event-selected",triggerSelectionChangeOnRemove:!1,maintainSelectionOnDatasetChange:!0,eventAssignHighlightCls:"b-sch-event-assign-selected",selectedCollection:{}}}afterConstruct(){super.afterConstruct(),this.navigator.on({navigate:"onEventNavigate",thisObj:this})}set selectedCollection(e){e instanceof cn||(e=new cn(e)),this._selectedCollection=e,e.on({change:"onSelectedCollectionChange",thisObj:this})}get selectedCollection(){return this._selectedCollection}get selectedEvents(){return this.selectedCollection.values}set selectedEvents(e){this.selectedCollection.splice(0,this.selectedCollection.count,e||[])}isEventSelected(e){return this.selectedCollection.includes(e)}selectEvent(e,t=!1){this.isEventSelected(e)||(t?this.selectedCollection.add(e):this.selectedEvents=e)}deselectEvent(e,t=!1){this.isEventSelected(e)&&this.selectedCollection.remove(e)}selectEvents(e){this.selectedCollection.add(e)}deselectEvents(e){this.selectedCollection.remove(e)}clearEventSelection(){this.selectedEvents=[]}onSelectedCollectionChange({added:e,removed:t}){const n=this,r=n.selectedEvents,s=e||[],i=t||[];function o(e,t){const r=e.isTask?e:e.resource,s=e.isAssignment?e.event:e;if(s){const i=n.getElementFromEventRecord(s,r);n.currentOrientation.toggleCls(s,r,n.eventSelectedCls,t),e.isAssignment&&n.getElementsFromEventRecord(s).forEach(e=>{e!==i&&e.classList[t?"add":"remove"](n.eventAssignHighlightCls)})}}s.forEach(e=>o(e,!0)),i.forEach(e=>o(e,!1)),n.silent||n.trigger("eventSelectionChange",{action:r.length>0?s.length>0&&i.length>0?"update":s.length>0?"select":"deselect":"clear",selection:r,selected:s,deselected:i})}onInternalEventStoreChange({action:e,records:t,source:n}){super.onInternalEventStoreChange(...arguments);const r=this;r.silent=!r.triggerSelectionChangeOnRemove,"remove"===e?r.deselectEvents(t):"dataset"===e&&(r.maintainSelectionOnDatasetChange?r.selectedEvents=r.selectedEvents.filter(e=>n.includes(e)):r.clearEventSelection()),r.silent=!1}onAssignmentRemove({records:e}){super.onAssignmentRemove(...arguments),this.silent=!this.triggerSelectionChangeOnRemove,this.deselectEvents(e),this.silent=!1}onEventSelectionClick(e,t){const n=this;n.isEventSelected(t)?e.ctrlKey&&n.deselectEvent(t,n.multiEventSelect):n.selectEvent(t,e.ctrlKey&&n.multiEventSelect)}onEventNavigate({event:e,item:t}){if(!this.eventSelectionDisabled){const n=this,r=t&&(1===t.nodeType?n.assignmentStore?n.resolveAssignmentRecord(t):n.resolveEventRecord(t):t);r?n.onEventSelectionClick(e,r):n.clearEventSelection()}}get widgetClass(){}});const Ul=(e,t)=>e.startDate-t.startDate,Gl=e=>e.preventDefault();var Yl=e=>(class extends(e||W){static get defaultConfig(){return{navigator:null,focusCls:"b-active",enableDeleteKey:!0}}construct(e){const t=this,n=At.createThrottled(t.onDeleteKey,500,t);t.isInTimeAxis=t.isInTimeAxis.bind(t),super.construct(e);const r=We.merge({ownerCmp:t,target:t.timeAxisSubGridElement,processEvent:t.processEvent,itemSelector:`.${t.eventCls}-wrap`,focusCls:t.focusCls,navigatePrevious:At.createThrottled(t.navigatePrevious,200,t,null,Gl),navigateNext:At.createThrottled(t.navigateNext,200,t,null,Gl),allowCtrlKey:!0,scrollSilently:!0,keys:{Space:"onEventSpaceKey",Enter:"onEventEnterKey",Delete:n,Backspace:n}},t.navigator);t.navigator=new Vr(r)}doDestroy(){this.navigator.destroy(),super.doDestroy()}isInTimeAxis(e){return!e.instanceMeta(this).excluded&&this.timeAxis.isTimeSpanInAxis(e)}accessibleFocusCell(e,t){if((e=this.normalizeCellContext(e)).columnId!==this.timeAxisColumn.id)return super.focusCell(e,t)}getPrevious(e,t){const n=this,r=n.resourceStore,s=e.isAssignment;if(e.isTask)return n.eventStore.getAt(n.eventStore.indexOf(e)-1);let i=e.resource||n.eventStore.getResourcesForEvent(e)[0],o=i.getEvents().filter(n.isInTimeAxis).sort(Ul),a=s?e.event:e,l=o[o.indexOf(a)-1];if(!l)for(let c=r.indexOf(i)-1;(!l||t&&l===a)&&c>=0;c--){let e=(i=r.getAt(c)).getEvents().filter(n.isInTimeAxis).sort(Ul);l=e.length&&e[e.length-1]}return s?n.assignmentStore.getAssignmentForEventAndResource(l,i):l}navigatePrevious(e){const t=this.getPrevious(e.assignmentRecord||e.eventRecord);e.preventDefault(),t&&(e.ctrlKey||this.clearEventSelection(),this.navigateTo(t,e))}getNext(e,t){const n=this,r=n.resourceStore,s=e.isAssignment;if(e.isTask)return n.eventStore.getAt(n.eventStore.indexOf(e)+1);let i=s?e.resource:e.resources[0],o=i.getEvents().filter(n.isInTimeAxis).sort(Ul),a=s?e.event:e,l=o[o.indexOf(a)+1];if(!l)for(let c=r.indexOf(i)+1;(!l||t&&l===a)&&c<r.count;c++)l=(i=r.getAt(c)).getEvents().filter(n.isInTimeAxis).sort(Ul)[0];return s?n.assignmentStore.getAssignmentForEventAndResource(l,i):l}navigateNext(e){const t=this.getNext(e.assignmentRecord||e.eventRecord);e.preventDefault(),t&&(e.ctrlKey||this.clearEventSelection(),this.navigateTo(t,e))}navigateTo(e,t={}){const n=this;if(e){n.navigator.disabled=!0;const r=e.resource;n.scrollResourceEventIntoView(r,e.isAssignment?e.event:e,null,{animate:100}).then(()=>{n.isDestroyed||(n.navigator.disabled=!1,n.activeEvent=e,n.navigator.trigger("navigate",{event:t,item:yt.up(n.getElementFromEventRecord(e,r),n.navigator.itemSelector)}))})}}set activeEvent(e){const t=this.getElementFromEventRecord(e.isAssignment?e.event:e,e.resource);this.navigator.activeItem=t.parentNode}get activeEvent(){const e=this.navigator.activeItem;if(e)return this.resolveEventRecord(e)}processEvent(e){const t=this,n=yt.up(e.target,t.eventSelector);return!t.navigator.disabled&&n&&(e.assignmentRecord=t.resolveAssignmentRecord(n),e.eventRecord=t.resolveEventRecord(n),e.resourceRecord=t.resolveResourceRecord(n)),e}onDeleteKey(e){const t=e.assignmentRecord||e.eventRecord;!this.readOnly&&this.enableDeleteKey&&t&&this.removeRecords([t])}removeRecords(e){!this.readOnly&&e.length&&e.forEach(e=>e.remove())}onEventSpaceKey(e){}onEventEnterKey(e){}get isActionableLocation(){if(!this.navigator.activeItem)return super.isActionableLocation}get widgetClass(){}});const ql={},Xl=document.createRange(),Kl=9999999;function Zl(e){return!(e.classList.contains("b-dragging")||e.classList.contains("b-resizing"))}const Jl=function(){class e extends(U(W)){construct(e){const t=this;t.view=e,t.innerElCls=`${e.eventCls}`,t.availableDivs=new Er,t.reservedIds={},t.divCount=0}init(){const e=this;e.view.rowManager.on({beforetranslaterow:e.onBeforeTranslateRow,translaterow:e.onTranslateRow,beforerowheight:e.onBeforeRowHeightChange,thisObj:e}),e.view.on({beforetogglenode:e.onBeforeToggleNode,togglenode:e.onToggleNode,beforetoggleallnodes:e.onBeforeToggleAllNodes,toggleallnodes:e.onToggleAllNodes,thisObj:e})}get column(){return this.view.timeAxisColumn}get timeAxis(){return this.view.timeAxis}get timeAxisViewModel(){return this.view.timeAxisViewModel}translateToPageCoordinate(e){const t=this.column.subGridElement;return e+t.getBoundingClientRect().left-t.scrollLeft}refreshRows(e){e&&(this.cache.clear(this.refreshFromRerender),this.view.refreshFromRerender=!1)}onDragAbort(e){this.view.currentOrientation.availableDivs.includes(e.element)&&e.element.classList.add("b-sch-released")}onLocaleChange(){this.cache.clear()}calculateMS(e){throw new Error("Implement in subclass")}getTimeSpanRenderData(e,t,n=!1){const r=this,{timeAxis:s}=r,i=!0===n||n.viewport;if(!0===n||n.timeAxis||s.isTimeSpanInAxis(e)){const n=r.view,o=n.getRowById(t);if(o||i){const a=n.scrollable.y,l=Math.max(a-50,0),c=Math.min(a+n._bodyRectangle.height+50,n.virtualScrollHeight);if(i||o.top<c&&o.top+(o.height||o.lastHeight)>=l){const i=r.timeAxisViewModel.getSingleUnitInPixels("minute"),a=e.startDate,l=e.endDate||a,c=s.startMS,d=s.endMS,{startMS:u,endMS:h,durationMS:g}=r.calculateMS(e),m=u<c|(u>d)<<1,p=h>d|(h<=c)<<1,f=g/6e4,v=p?i*f:null;let y,b=n.getCoordinateFromDate(h,{local:!0,respectExclusion:!0,isEnd:!0}),C=!1,w=!1;if(m?y=(u-c)/6e4*i:C=-1===(y=n.getCoordinateFromDate(u,{local:!0,respectExclusion:!0,isEnd:!1,snapToNextIncluded:-1!==b})),p?b=y+v:w=-1===b,w&&!C&&(b=n.getCoordinateFromDate(h,{local:!0,respectExclusion:!0,isEnd:!0,snapToNextIncluded:!0})),v>Kl&&(1===m?1===p?(y=-100,b=n.timeAxisColumn.width+100):y=b-Kl:1===p&&(b=y+Kl)),C&&w&&(y=n.getCoordinateFromDate(u,{local:!0,respectExclusion:!0,isEnd:!1,snapToNextIncluded:!0,max:h}))===(b=n.getCoordinateFromDate(h,{local:!0,respectExclusion:!0,isEnd:!0,snapToNextIncluded:!0,min:u})))return e.instanceMeta(n).excluded=!0,null;const S={[r.view.scheduledEventName]:e,left:Math.min(y,b),width:Math.abs(b-y),start:a,end:l,startMs:u,endMs:h,rowId:t.id,startsOutsideView:m,endsOutsideView:p,clippedStart:C,clippedEnd:w,row:o};return r.view.fillTicks&&(S.dataStartMs=S.start.getTime(),S.dataEndMs=S.end.getTime()),S.top=Math.max(0,n.resourceMargin),n.managedEventSizing&&(S.height=Math.max(n.rowManager.rowHeight-2*n.resourceMargin,1)),S}}}}onTranslateRow({}){}onBeforeRowHeightChange(e){const t=this.view,n=e?e.height:this.rowHeight;this.cache.clear(),t.foregroundCanvas&&(t.element.classList.add("b-notransition"),t.foregroundCanvas.style.fontSize=`${n-2*t.resourceMargin}px`,this._thisIsAUsedExpression(window.getComputedStyle(t.foregroundCanvas).fontSize),t.element.classList.remove("b-notransition")),t.milestoneWidth=null}onBeforeTranslateRow({row:e}){this.cache.clearRow(e.id)}onViewportResize(){this.lastUpdateScrollPos=null,this.update()}positionTimeSpan(e,t,n){switch(this.view.eventPositionMode||"translate"){case"position":return e.style.left=`${t}px`,void(e.style.top=`${n}px`);case"translate":return void(e.style.transform=`translate(${t}px,${n}px)`);case"translate3d":e.style.transform=`translate3d(${t}px,${n}px,0)`}}getTimeSpanDiv(e){const{availableDivs:t}=this,{id:n,oldId:r}=e;if("move"===this.view.eventScrollMode){let e;return n&&(e=t.get(n)||t.get(r)),e&&!Zl(e)&&(e=null),e||(e=t.find(Zl)),e&&(t.remove(e),e.classList.remove("b-sch-released")),e}return null}releaseTimeSpanDiv(e,t=!1){const n=e.style;"move"===this.view.eventScrollMode?(this.availableDivs.add(e),!t&&Zl(e)&&e.classList.add("b-sch-released")):t||(n.opacity=0,n.pointerEvents="none",this.setTimeout(()=>{e.remove(),n.opacity=1,n.pointerEvents=""},200))}updateElementId(e,t){const{availableDivs:n}=this;n.includes(e)&&(n.changeId(e,t),n.items.delete(e),n.items.add(e))}triggerPaint(e,t){throw new Error("Implement in subclass")}renderTimeSpan(e,t,n,r=!1){const s=this,i=s.view;let o,{cls:a,id:l}=e,c=t&&t.div,d=!1,u=!1,h=!1,g=t&&t.eventEl;if(r||c||!(c=s.getTimeSpanDiv(e))||(d=c.id!==l),o=c&&c.classList.contains("b-sch-dragcreator-proxy"),!c||d)d?((g=c.innerElement||c.firstElementChild).innerHTML="",g.style.cssText="",g.nextSibling&&(Xl.setStartAfter(g),Xl.setEndAfter(c.lastChild),Xl.deleteContents())):([c,g]=yt.createElement({tabIndex:0,children:[{className:`${s.innerElCls}`}]},!0),c.innerElement=g),c.id=l,e[i.scheduledEventName+"Id"]&&(c.dataset[i.scheduledEventName+"Id"]=e[i.scheduledEventName+"Id"]),yt.syncClassList(c,e.wrapperCls),c.parentNode!==i.foregroundCanvas&&i.foregroundCanvas.appendChild(c),yt.syncClassList(g,a),(e.style||e.internalStyle)&&(g.style.cssText=(e.internalStyle||"")+(e.style||"")),e.body&&g.appendChild(e.body.cloneNode(!0)),c.style.cssText=`width:${e.width}px;height:${e.height}px;${e.wrapperStyle||""}`,s.positionTimeSpan(c,e.left,e.top),u=!0;else{const r=n&&t.div?n:ql;if(g=c.querySelector(`.${s.innerElCls}`)||c.firstElementChild,yt.syncClassList(c,e.wrapperCls),yt.syncClassList(g,e.cls),g.style.cssText=e.style?e.style:"",e.body){const t=g.innerHTML,n=g.featureEls;n&&n.forEach(t=>e.body.appendChild(t)),g.innerHTML="",g.appendChild(e.body.cloneNode(!0)),u=g.innerHTML!==t}document.activeElement&&document.activeElement.id===e.id&&c.classList.add(i.focusCls),h=!0,e.wrapperStyle&&(c.style.cssText+=e.wrapperStyle),(r.left!==e.left||r.top!==e.top||e.style)&&(s.positionTimeSpan(c,e.left,e.top),u=!0),(r.width!==e.width||e.style)&&(c.style.width=`${e.width}px`,u=!0),(r.height!==e.height||e.style)&&(c.style.height=`${e.height}px`,u=!0)}return t.div=c,t.eventEl=g,u&&(h&&o&&(h=!1,c.classList.remove("b-sch-dragcreator-proxy")),s.triggerPaint(e,c,h)),c}cacheTimeSpanElement(e,t,n){const{availableDivs:r,view:s}=this,i=s.getEventRenderId(e,t);r.includes(i)||(n?(n.id=i,s.foregroundCanvas.appendChild(n)):n=yt.createElement({id:i,tabIndex:0,children:[{className:`${this.innerElCls}`}]}),r.add(n))}updateRowTimeSpans(e,t,n=!1,r=!1){}renderer(e){}updateFromHorizontalScroll(e){const t=this,n=t.view,r=n.timeAxisSubGrid.width,s=n.getDateFromX(Math.max(0,e-100)),i=n.getDateFromX(e+r+100)||n.timeAxis.endDate,o=t.view.timeAxisSubGrid.scrollable.x,a=t.lastUpdateScrollPos;t.viewportStart=s&&s.getTime(),t.viewportEnd=i&&i.getTime(),(!a||Math.abs(o-a.x)>50)&&t.update()}update(){const e=this,t=e.view;e.lastUpdateScrollPos={x:t.timeAxisSubGrid.scrollable.x,y:t.scrollable.y};for(const n of t.rowManager){const r=n.getCell(t.timeAxisColumn.id),s=fs.get(r),i=t.store.getById(s.id);i&&e.updateRowTimeSpans(s.row,i,!1,!0)}}getDateFromXY(e,t,n){let r=e[0];return n||(r=this.translateToScheduleCoordinate(r)),this.timeAxisViewModel.getDateFromPosition(r,t)}translateToScheduleCoordinate(e){return e-this.column.subGridElement.getBoundingClientRect().left+this.view.scrollLeft}onBeforeToggleNode({record:e}){const t=this;if(e.children&&e.children.length){let n=t.view.store.getNext(e);for(;n&&t.view.getRowFor(n);)t.cache.clearRow(n.id),n=t.view.store.getNext(n.id)}t.togglingNode=!0}onToggleNode(){this.togglingAllNodes||(this.togglingNode=!1)}onBeforeToggleAllNodes(){this.cache.clear(),this.togglingAllNodes=this.togglingNode=!0}onToggleAllNodes(){this.togglingAllNodes=this.togglingNode=!1}onRowRecordUpdate({record:e}){this.cache.clearRow(e.id,!1,!0)}onRowRecordRemove({records:e}){e.forEach(e=>e.traverse(e=>this.cache.clearRow(e.id)))}getRowRegion(e,t,n){const{view:r,column:s}=this,i=r.getRowById(e.id);if(!i)return null;let o=i.getElement(s.region),a=this.timeAxis.startDate,l=this.timeAxis.endDate,c=t?Ne.max(a,t):a,d=n?Ne.min(l,n):l,u=r.getCoordinateFromDate(c),h=r.getCoordinateFromDate(d,!0,!0),g=i.top+r.verticalScroller.scrollTop,m=Math.min(u,h),p=g+o.offsetHeight;return new oe(m,g,Math.max(u,h)-m,p-g)}getStartEndDatesFromRectangle(e,t){const n=this.view,r=n.getDateFromCoordinate(e.x,t,!0),s=n.getDateFromCoordinate(e.right,t,!0);return r&&s?{start:Ne.min(r,s),end:Ne.max(r,s)}:null}getVisibleDateRange(){const e=this.view,t=e.timeAxisSubGrid.scrollable.x,n=e.timeAxisSubGrid.width;return{startDate:e.getDateFromX(t),endDate:e.getDateFromX(t+n)||e.timeAxis.endDate}}getConnectorStartSide(e){}getConnectorEndSide(e){}}return e._$name="BaseHorizontalMapper",e}(),Ql=function(){class e{constructor(e){this.mapper=e,this.renderedEventsMap={},this.rowLayoutCache={}}clear(e=!1){const t=this;t.renderedEventsMap={},Object.keys(t.rowLayoutCache).forEach(n=>t.clearRow(n,!!e&&"immediate"))}addRenderedEvents(e,t){this.renderedEventsMap[e]=t}addRenderedEvent(e){e.resourceId in this.renderedEventsMap&&((this.renderedEventsMap[e.resourceId]||(this.renderedEventsMap[e.resourceId]={}))[e.id]=e)}getRenderedTimeSpan(e,t){const n=this.renderedEventsMap[e];return n&&n[t]}clearRenderedTimeSpan(e,t){if(this.renderedEventsMap[e]){const n=this.renderedEventsMap[e][t];return delete this.renderedEventsMap[e][t],n}}getRenderedEvents(e){return this.renderedEventsMap[e]}clearRenderedEvents(e){this.renderedEventsMap[e]=null}getTimeSpan(e,t){const n=this.rowLayoutCache[t],r=n&&n[e];return r?r.layoutCache:null}clearEvent(e,t,n=!1,r=!1){const s=this.getTimeSpan(e,t);if(!s)return null;s.div&&this.mapper.clearDiv(s.div,n,r),this.rowLayoutCache[t][e].layoutCache=null}getRow(e){return this.rowLayoutCache[e]}addRow(e,t){this.rowLayoutCache[e]=t}clearRow(e,t=!1,n=!1){const r=this,s=r.rowLayoutCache[e];s&&(r.renderedEventsMap[e]&&delete r.renderedEventsMap[e],Object.keys(s).forEach(s=>{"_allEvents"!==s&&"_rowHeight"!==s&&r.clearEvent(s,e,t,n)}),delete r.rowLayoutCache[e])}}return e._$name="HorizontalEventMapperCache",e}(),ec=(e,t,n,r,s)=>{if(e.fillTicks){const e=Math.floor(t.getTickFromDate(n)),r=t.getAt(e);if(r)return r[s?"endDate":"startDate"].getTime()}return r},tc=function(){class e extends Jl{construct(e){this.scheduler=e,super.construct(e),this.cache=new Ql(this)}init(){super.init(),this.scheduler.on({togglegroup:this.onToggleGroup,rowremove:this.onRowRemove,prio:2,thisObj:this})}clearDiv(e,t,n){const r=e.style;!t||n?this.releaseTimeSpanDiv(e,n):"immediate"!==t&&this.scheduler.enableEventAnimations?(e.id=k.generateId("obsolete-event"),r.opacity=0,r.pointerEvents="none",this.setTimeout(()=>{e.remove(),r.opacity=1,r.pointerEvents=""},200)):e.remove()}clearAllDivs(){this.availableDivs.forEach(e=>e.remove()),this.availableDivs.clear()}clearEvents(){this.cache.clear(!0)}releaseEvent(e,t,n=!1){const r=this.cache.getRenderedTimeSpan(e,t),s=r&&this.cache.getTimeSpan(r.eventId,e);return s&&s.div&&(this.releaseTimeSpanDiv(s.div,n),s.div=s.eventEl=null),this.cache.clearRenderedTimeSpan(e,t)}getElementFromEventRecord(e,t=this.scheduler.eventStore.getResourcesForEvent(e)[0]){if(t){const n=this.cache.getRenderedEvents(t.id);if(n){const r=n[this.scheduler.getEventRenderId(e,t)],s=r&&r.layoutCache;return s&&s.eventEl}}}getElementsFromEventRecord(e,t){const n=this;return t?[n.getElementFromEventRecord(e,t)]:n.scheduler.eventStore.getResourcesForEvent(e).reduce((t,r)=>{const s=n.getElementFromEventRecord(e,r);return s&&t.push(s),t},[])}resolveRowRecord(e){const{view:t}=this,n=e instanceof Event?e.target:e,r=3===n.nodeType?n.parentElement:n,s=r.matches(t.eventSelector)&&r||yt.up(r,t.eventSelector);return s?t.getResourceRecordFromDomId(s.id):t.getRecordFromElement(r)}toggleCls(e,t,n,r=!0){if(!t)return;const s=this.cache.getRenderedTimeSpan(t.id,this.scheduler.getEventRenderId(e,t)),i=this.getElementFromEventRecord(e,t);s&&(s.cls[n]=r?1:0),i&&i.classList[r?"add":"remove"](n)}getResourceEventBox(e,t){const n=this.cache.getTimeSpan(e,t);if(n)return n}getScheduleRegion(e,t,n=!0){let r,s=this,i=s.view,o=s.column;if(e){const n=t&&s.getElementsFromEventRecord(t,e)[0];if(r=oe.from(i.getRowById(e.id).getElement("locked")),n){const e=oe.from(n,o.subGridElement);r.y=e.y,r.bottom=e.bottom}else r.y=r.y+i.resourceMargin,r.bottom=r.bottom-i.resourceMargin}else(r=oe.from(o.subGridElement).moveTo(null,0)).width=o.subGridElement.scrollWidth,r.y=r.y+i.resourceMargin,r.bottom=r.bottom-i.resourceMargin;let a=s.timeAxis.startDate,l=s.timeAxis.endDate,c=i.getDateConstraints(e,t)||{start:a,end:l},d=i.getCoordinateFromDate(Ne.max(a,c.start)),u=i.getCoordinateFromDate(Ne.min(l,c.end)),h=r.y,g=r.bottom;return n||(d=s.translateToPageCoordinate(d),u=s.translateToPageCoordinate(u)),{top:h,right:Math.max(d,u),bottom:g,left:Math.min(d,u)}}getResoureEventBox(e,t){return this.cache.getTimeSpan(e,t)}layoutEventVerticallyStack(e){const{resourceMargin:t,rowHeight:n,barMargin:r}=this.scheduler;return 0===e?t:t+e*(n-2*t)+e*r}layoutEventVerticallyPack(e,t){const{resourceMargin:n,rowHeight:r,barMargin:s}=this.scheduler,i=1/t,o=e*i,a=(r-2*n-(i-1)*s)*t;return{top:n+o*a+o*s,height:a}}calculateMS(e){const t=this,n=t.view;let r=ec(n,t.timeAxis,e.startDate,e.startDateMS,!1),s=ec(n,t.timeAxis,e.endDate,e.endDateMS,!0),i=s-r;if("default"!==n.milestoneLayoutMode&&0===i){const o=t.timeAxisViewModel.getSingleUnitInPixels("minute");switch(i=n.getMilestoneLabelWidth(e)*(1/o)*60*1e3,n.milestoneAlign){case"start":case"left":s=r+i;break;case"end":case"right":r=(s=r)-i;break;default:r=(s=r+i/2)-i}}return{startMS:r,endMS:s,durationMS:i}}layoutEvents(e,t,n){const r=this,{timeAxis:s}=r,{eventStore:i}=e,o=t.id,a=i.getEventsForResource(o),l=i.isFiltered?a.filter(e=>i.indexOf(e)>-1):a,c=(e.getEventsToRender(t,l)||[]).filter(e=>s.isTimeSpanInAxis(e)).reduce((n,s)=>{const i=e.generateTplData(s,t);return i?n.push(i):r.cache.getRenderedEvents(o)&&r.releaseEvent(o,e.getEventRenderId(s,t)),n},[]);if(!c.length)return r.cache.clearRenderedEvents(o),!1;c.sort(r.eventSorter);let d=e.rowHeight;const u=e.currentEventLayout,h=c.filter(e=>e.event.isEvent||e.event.isTask);if("stack"===e.eventLayout){const n=u.applyLayout(h,t);d=n*(e.rowHeight-2*e.resourceMargin)+(n-1)*e.barMargin+2*e.resourceMargin}else"pack"===e.eventLayout&&u.applyLayout(h,t);let g=n.top;d!==n.height&&n.estimatedTop&&(g=n.top+n.height-d);const m={_allEvents:c,_rowHeight:d};return c.forEach(e=>{const t=r.cache.getTimeSpan(e.eventId,o),n=e.top;e.top+=g,e.rowTop=g,e.fillSize&&(e.height=d),e.layoutCache={layout:!0,div:t&&t.div,eventEl:t&&t.eventEl,width:e.width,height:e.height,start:e.left,end:e.left+e.width,relativeTop:n,top:e.top,relativeBottom:n+e.height,bottom:e.top+e.height},m[e.eventId]=e}),r.cache.addRow(o,m),!0}eventSorter(e,t){const n=e.dataStartMs||e.startMs,r=e.dataEndMs||e.endMs,s=t.dataStartMs||t.startMs,i=t.dataEndMs||t.endMs;return n===s?r-i==0?e.event.name<t.event.name?-1:1:r>i?-1:1:n<s?-1:1}onTranslateRow({row:e}){this.matchRowTranslation(e)}renderEvent(e){const t=this,n=t.view.scheduledEventName+"Id",r=e[n],s=t.cache.getTimeSpan(r,e.resourceId),i=t.cache.getRenderedEvents(e.resourceId),o=e.event.instanceMeta(t.scheduler),a=t.renderTimeSpan(e,s,i[e.id],o.requireElement&&!o.fromDragProxy);e.assignment&&(a.dataset.assignmentId=e.assignment.id),r&&(a.dataset[n]=r),i[e.id]=e,o.requireElement&&(delete o.requireElement,delete o.fromDragProxy),t.scheduler.trigger("renderEvent",{eventRecord:e.event,resourceRecord:e.resource,assignmentRecord:e.assignment,element:a,tplData:e})}triggerPaint(e,t,n=!1){const{scheduler:r}=this;r.trigger(n?"eventRepaint":"eventPaint",{scheduler:r,eventRecord:e.event,resourceRecord:e.resource,element:t})}isEventInView(e){return e.startMs===e.endMs?e.startMs<=this.viewportEnd&&e.endMs>this.viewportStart:e.startMs<this.viewportEnd&&e.endMs>this.viewportStart}updateRowTimeSpans(e,t,n=!1,r=!1){const s=this,i=s.scheduler,o=t.id;let a=s.cache.getRenderedEvents(o),l=s.cache.getRow(o);if((i.forceLayout||n||!l)&&!s.layoutEvents(i,t,e))return l&&l._rowHeight||0;if(!(l=s.cache.getRow(o)))return 0;const c=l._allEvents.filter(e=>e.event.instanceMeta(i).retainElement||e.assignment&&e.assignment.instanceMeta(i).retainElement||s.isEventInView(e));a||s.cache.addRenderedEvents(o,a={});for(let u=0;u<c.length;u++){const e=c[u];i._firstRenderDone&&i._firstRenderDone(),(!r&&!e.event.instanceMeta(i).retainElement||r&&!e.layoutCache.div)&&(i.isFirstRender&&e.top<i.bodyHeight&&i.useInitialAnimation&&(e.wrapperCls.add("b-first-render"),e.internalStyle=`animation-delay: ${e.row.index/20}s;`),s.renderEvent(e),e.wrapperCls["b-first-render"]=null)}const d=Object.keys(a);for(let u=0;u<d.length;u++){const e=d[u];c.some(t=>t.id===e)||s.releaseEvent(o,e)}return l._rowHeight}renderer(e){e.size.height=this.updateRowTimeSpans(e.row,e.record)}matchRowTranslation(e){const t=this,n=t.scheduler.store.getAt(e.dataIndex).id,r=t.cache.getRow(n),s=r&&r._allEvents.length>0&&r._allEvents[0];if(s&&s.rowTop!==e.top){const n=e.top-s.rowTop;r._allEvents.forEach(r=>{const s=r.layoutCache;s.top+=n,s.bottom+=n,s.div&&t.positionTimeSpan(s.div,s.start,s.top),r.top+=n,r.rowTop=e.top})}}onTimeAxisViewModelUpdate(){this.cache.clear(),this.updateFromHorizontalScroll(this.scheduler.timeAxisSubGrid.scrollable.x)}onRowRemove({isCollapse:e}){const{scheduler:t}=this;e||t.runWithTransition(()=>{t.rowManager.forEach(e=>this.matchRowTranslation(e))})}onToggleGroup({groupRecord:e,collapse:t}){let n=this.scheduler.store,r=n.indexOf(e)+(t?1:e.groupChildren.length);for(t&&e.groupChildren.forEach(e=>{this.cache.clearRow(e.id)});r<n.count;r++)this.cache.clearRow(n.getAt(r).id)}onEventDataset(){this.cache.clear(!0)}onEventAdd({records:e,resources:t}){let n,r,s=this;e.forEach(e=>{if(r=e.endDate,(n=e.startDate)&&r&&s.timeAxis.timeSpanInAxis(n,r)){const n=e.resources;n&&n.some(e=>s.scheduler.getRowFor(e))&&(e.instanceMeta(s.scheduler).requireElement=!0),t.forEach(e=>{this.cache.clearRow(e.id,!1,!0)})}})}onEventRemove({resources:e}){const t=this;e.forEach(e=>t.cache.clearRow(e.id,!0))}onEventUpdate({source:e,record:t,changes:n={},resources:r}){const s=this,i="resourceId"in n;if(i||r.length){if(i){const r=e.resourceStore.getById(n.resourceId.oldValue),i=t.resource,o=i&&!i.placeHolder,a=t.resource&&Boolean(s.getTimeSpanRenderData(t,t.resource));if(r){const e=s.cache.getTimeSpan(t.id,r.id);e&&(o?(e.div&&i&&(e.div.id=s.scheduler.getEventRenderId(t,i)),s.cache.clearRow(r.id,!1,o)):s.cache.clearEvent(t.id,n.resourceId.oldValue,!0))}else o&&(t.instanceMeta(s.scheduler).requireElement=!0);o&&s.cache.clearRow(i.id,!1,a),s.scheduler.rowManager.averageRowHeight=null}else("startDate"in n||"endDate"in n)&&r.forEach(e=>{s.scheduler.eventStore.getEventsForResource(e).length>1&&(s.scheduler.rowManager.averageRowHeight=null)});r.forEach(e=>{const n=s.getTimeSpanRenderData(t,e),r=Boolean(n&&s.isEventInView(n));s.cache.clearRow(e.id,!1,r)})}}onEventStoreIdChange({oldValue:e,value:t}){const{view:n}=this;yt.forEachSelector(n.element,`[data-event-id="${e}"]`,e=>{e.id=n.getEventRenderId(t,n.getResourceIdFromDomNodeId(e.id))})}onEventClearChanges(){this.cache.clear()}onEventFilter(){this.cache.clear()}onEventRemoveAll(){this.view.rowManager.averageRowHeight=null,this.cache.clear(!0)}getConnectorStartSide(e){return"left"}getConnectorEndSide(e){return"right"}}return e._$name="HorizontalEventMapper",e}(),nc=function(){class e extends(Al()){static get defaultConfig(){return{coordProp:"leftFactor",sizeProp:"widthFactor"}}applyLayout(e,t,n,r,s){super.applyLayout(e,(e,s,i,o)=>{if("none"===this.scheduler.eventLayout)e.width=t-2*n,e.left+=n;else{e.widthFactor=o;const a=e.leftFactor=i.start+s*o,l=Math.round(1/o),c=a/o,d=t-2*n-r*(l-1);"mixed"===this.scheduler.eventLayout&&2===l?(e.left+=a*t/5+r,e.width=t-a*t/5-2*r,e.zIndex=5+c):(e.width=o*d,e.left+=a*d+n+r*c)}})}}return e._$name="VerticalLayout",e}(),rc={releaseElement:1,reuseElement:1},sc={newElement:1,reuseOwnElement:1,reuseElement:1},ic=function(){class e extends(U(W)){static get properties(){return{eventMap:{},resourceMap:{},releasedElements:{}}}construct(e){this.scheduler=e,this.timeAxisViewModel=e.timeAxisViewModel,this.verticalLayout=new nc({scheduler:e}),super.construct({})}init(){const e=this,{scheduler:t}=e;e.resourceColumns=t.timeAxisColumn.resourceColumns,e.timeView=t.timeView,t.element.classList.add("b-sch-vertical"),t.on({assignmentstorechange:e.onChangeAssignmentStore,resourcestorechange:e.onChangeResourceStore,thisObj:e}),e.resourceColumns.on({columnWidthChange:e.onResourceColumnWidthChange,thisObj:e}),e.resourceStore=t.resourceStore,e.assignmentStore=t.assignmentStore,e.initialized=!0,e.renderer(),e.resourceColumns.availableWidth=t.timeAxisSubGrid.width}resolveRowRecord(e,t){const{scheduler:n}=this,r=e instanceof Event?e:null,s=r?r.target:e,i=r?[r.offsetX,r.offsetY]:t,o=yt.up(3===s.nodeType?s.parentElement:s,n.eventSelector);if(o)return n.resourceStore.getById(o.dataset.resourceId);if(!yt.up(s,".b-sch-timeaxis-cell"))return null;const a=Math.floor(i[0]/this.resourceColumns.columnWidth);return n.resourceStore.getAt(a)}getElementFromEventRecord(e,t){const n=this.getElementsFromEventRecord(e,t);return n.length?n[0]:null}getElementsFromEventRecord(e){return Object.values(this.eventMap[e.id]).map(e=>e.element)}toggleCls(e,t,n,r=!0){const s=We.getPath(this.eventMap,`${e.id}.${t.id}`);s&&(s.tplData.cls[n]=r?1:0,s.element&&s.element.querySelector(this.scheduler.eventInnerSelector).classList[r?"add":"remove"](n))}getDateFromXY(e,t,n){let r=e[1];return n||(r=this.translateToScheduleCoordinate(r)),this.timeAxisViewModel.getDateFromPosition(r,t)}translateToScheduleCoordinate(e){return e-this.scheduler._bodyRectangle.y+this.scheduler.scrollTop}translateToPageCoordinate(e){return e+this.scheduler._bodyRectangle.y-this.scheduler.scrollTop}getResourceEventBox(e,t){let{tplData:n}=We.getPath(this.eventMap,`${e}.${t}`)||{};return n||(this.layoutResource(this.scheduler.resourceStore.getById(t)),n=We.getPath(this.eventMap,`${e}.${t}`).tplData),n?{start:n.left,end:n.left+n.width,top:n.top,bottom:n.bottom}:null}getScheduleRegion(e,t,n){const{scheduler:r}=this;let s=oe.from(r.timeAxisSubGridElement);e&&(s.left=this.resourceStore.indexOf(e)*r.resourceColumnWidth,s.right=s.left+r.resourceColumnWidth);const i=r.timeAxis.startDate,o=r.timeAxis.endDate,a=r.getDateConstraints(e,t)||{start:i,end:o},l=r.getCoordinateFromDate(Ne.max(i,a.start)),c=r.getCoordinateFromDate(Ne.min(o,a.end));return n?(s.top=l,s.bottom=c):(s.top=this.translateToPageCoordinate(l),s.bottom=this.translateToPageCoordinate(c)),s}getRowRegion(e,t,n){const{scheduler:r}=this,s=this.resourceStore.indexOf(e)*r.resourceColumnWidth,i=r.timeAxis.startDate,o=r.timeAxis.endDate,a=t?Ne.max(i,t):i,l=n?Ne.min(o,n):o,c=r.getCoordinateFromDate(a),d=r.getCoordinateFromDate(l,!0,!0),u=Math.min(c,d),h=Math.abs(c-d);return new oe(s,u,r.resourceColumnWidth,h)}getVisibleDateRange(){const e=this.scheduler,t=e.scrollable.y,n=e.scrollable.clientHeight;return{startDate:e.getDateFromCoordinate(t),endDate:e.getDateFromCoordinate(t+n)||e.timeAxis.endDate}}onResourceColumnWidthChange({width:e,oldWidth:t}){const n=this,{scheduler:r}=n;n.resourceColumns.width=r.timeAxisColumn.width=n.resourceStore.count*e,n.clearAll(),r.runWithTransition(()=>n.renderer(),Math.abs(e-t)>30)}onEventStoreChange({action:e,records:t,record:n,replaced:r,changes:s}){const i=this,o=t||(n?[n]:[]),a=new Set;let l=!0;switch(o.forEach(e=>{e.resources.forEach(e=>a.add(e.id))}),e){case"sort":case"group":case"move":return;case"dataset":i.clearAll(),l=!1;break;case"add":case"remove":case"updateMultiple":i.clearResources(a);break;case"replace":r.forEach(([e,t])=>{e.resources.map(e=>a.add(e.id)),t.resources.map(e=>a.add(e.id))}),i.clearResources(a);break;case"removeall":case"filter":i.clearAll();break;case"update":if(n.meta.removingResource)return;let t=!1;("startDate"in s||"endDate"in s||"duration"in s)&&(i.clearResources(a),t=!0),"resourceId"in s&&(a.add(s.resourceId.oldValue),i.clearResources(a),t=!0),t||Object.values(i.eventMap[n.id]).forEach(e=>{const{tplData:t}=e;e.tplData=i.scheduler.generateTplData(t.eventRecord,t.resourceRecord),e.tplData.left=t.left,e.tplData.width=t.width})}i.scheduler.runWithTransition(()=>i.renderer(),l)}set resourceStore(e){const t=this;t.resourceStoreDetacher&&t.resourceStoreDetacher(),t.resourceColumns.resourceStore=t._resourceStore=e,t.resourceStoreDetacher=e.on({change:t.onResourceStoreChange,refresh:t.onResourceStoreRefresh,thisObj:t,prio:1})}get resourceStore(){return this._resourceStore}onChangeResourceStore({newResourceStore:e}){const t=this;t.firstResource=t.lastResource=null,t.clearAll(),t.resourceStore=e,t.renderer()}onResourceStoreChange({source:e,action:t,records:n,record:r}){const s=this,i=n||(r?[r]:[]);switch(s.firstResource=s.lastResource=null,t){case"add":for(let t=i.reduce((t,n)=>Math.min(t,e.indexOf(n)),e.count);t<e.count;t++)s.clearResources([e.getAt(t).id]);return;case"remove":case"removeall":return void s.clearAll();case"replace":case"update":break;case"filter":s.clearAll()}s.scheduler.runWithTransition(()=>s.renderer(),!0)}onResourceStoreRefresh({action:e}){const t=this;if("group"===e)throw new Error("Grouping of resources not supported in vertical mode");"sort"===e&&(t.firstResource=t.lastResource=null,t.clearAll(),t.scheduler.runWithTransition(()=>t.renderer()))}set assignmentStore(e){const t=this;t.assignmentStoreDetacher&&t.assignmentStoreDetacher(),t._assignmentStore=e,e&&(t.assignmentStoreDetacher=e.on({change:t.onAssignmentStoreChange,thisObj:t}))}get assignmentStore(){return this._assignmentStore}onChangeAssignmentStore({newAssignmentStore:e}){this.assignmentStore=e}onAssignmentStoreChange({action:e,records:t,replaced:n,record:r,changes:s}){const i=this,o=new Set((t||(r?[r]:[])).map(e=>e.resourceId));switch(e){case"add":case"remove":case"updateMultiple":i.clearResources(o);break;case"filter":case"removeall":i.clearAll();break;case"replace":n.forEach(([e,t])=>{o.add(e.resourceId),o.add(t.resourceId)}),i.clearResources(o);break;case"update":"resourceId"in s&&o.add(s.resourceId.oldValue),i.clearResources(o)}i.scheduler.runWithTransition(()=>i.renderer(),!0)}refreshRows(e){e&&(this.clearAll(),this.scheduler.refreshFromRerender=!1)}updateFromHorizontalScroll(e){e!==this.prevScrollLeft&&(this.renderer(),this.prevScrollLeft=e)}updateFromVerticalScroll(){this.renderer()}scrollResourceIntoView(e,t){const{scheduler:n}=this,r=n.resourceStore.indexOf(e)*n.resourceColumnWidth;return n.scrollHorizontallyTo(r,t)}onViewportResize(e){this.resourceColumns.availableWidth=e,this.renderer()}onLocaleChange(){this.clearAll()}onDragAbort(){}onBeforeRowHeightChange(){}onTimeAxisViewModelUpdate(){}clearEvents(){}updateElementId(){}releaseTimeSpanDiv(){}get resourceRange(){const{scheduler:e,resourceStore:t}=this;return t&&t.count?{firstResource:Math.max(Math.floor(e.scrollLeft/e.resourceColumnWidth)-1,0),lastResource:Math.min(Math.floor((e.scrollLeft+e.timeAxisSubGrid.width)/e.resourceColumnWidth)+1,t.count-1)}:{firstResource:-1,lastResource:-1}}get dateRange(){const{scheduler:e}=this;let t=e.getDateFromCoordinate(Math.min(e.scrollTop+e.bodyHeight+e.tickSize-1,(e.virtualScrollHeight||e.scrollable.scrollHeight)-1));return t||(t=e.timeAxis.last.endDate),{topDate:e.getDateFromCoordinate(Math.max(e.scrollTop-e.tickSize,0)),bottomDate:t}}getTimeSpanRenderData(e,t,n=!1){const{scheduler:r}=this,{startDate:s,endDate:i}=e,o=r.getCoordinateFromDate(s),a=this.resourceStore.indexOf(t)*r.resourceColumnWidth,l=r.resourceColumnWidth-2*r.resourceMargin,c=s.getTime(),d=i.getTime();let u=r.getCoordinateFromDate(i),h=u-o;return-1===u&&(u=o+(h=Math.round((d-c)*r.timeAxisViewModel.getSingleUnitInPixels("ms")))),{eventRecord:e,resourceRecord:t,left:a,top:o,bottom:u,width:l,height:h,startDate:s,endDate:i,startDateMS:c,endDateMS:d,start:s,end:i,startMs:c,endMs:d}}eventSorter(e,t){const n=e.dataStartMs||e.startDateMS,r=e.dataEndMs||e.endDateMS,s=t.dataStartMs||t.startDateMS,i=t.dataEndMs||t.endDateMS;return n===s?r-i==0?e.eventRecord.name<t.eventRecord.name?-1:1:r>i?-1:1:n<s?-1:1}layoutResource(e){const t=this,{scheduler:n}=t,r=t.resourceMap[e.id]={},s=n.resourceStore.indexOf(e);let i=n.eventStore.getEventsForResource(e);const o=(i=n.getEventsToRender(e,i)).reduce((i,o)=>{const a=n.generateTplData(o,e),l={tplData:a};return We.setPath(t.eventMap,`${a.eventId}.${e.id}`,l),r[a.eventId]=l,a.fillSize?(a.left=s*n.resourceColumnWidth,a.width=n.resourceColumnWidth):i.push(a),i},[]);return o.sort(t.eventSorter),t.verticalLayout.applyLayout(o,n.resourceColumnWidth,n.resourceMargin,n.barMargin,s),r}renderEvent(e){const t=e.tplData,{resourceRecord:n,eventRecord:r}=t,s={className:t.wrapperCls,tabIndex:"0",children:[{className:t.cls,style:(t.internalStyle||"")+(t.style||""),html:t.body.cloneNode(!0),compareHtml:t.eventContent}],style:{transform:`translate(${t.left}px, ${t.top}px)`,height:t.height,width:t.width,zIndex:t.zIndex},dataset:{resourceId:n.id,eventId:t.eventId,syncId:t.assignment?t.assignment.id:t.eventId},elementData:e,retainElement:r.instanceMeta(this.scheduler).retainElement};return t.assignment&&(s.dataset.assignmentId=t.assignment.id),s}renderResource(e){const t=this,{topDateMS:n,bottomDateMS:r}=t,s=[];let i=t.resourceMap[e.id];i||(i=t.layoutResource(e));for(let o in i){const e=i[o];e.tplData.endDateMS>=n&&e.tplData.startDateMS<=r&&s.push(t.renderEvent(e))}return s}renderer(){const e=this,{scheduler:t}=e,{resourceStore:n}=t,{firstResource:r,lastResource:s}=e.resourceRange,{topDate:i,bottomDate:o}=e.dateRange,a=[];if(e.initialized){if(Ne.isEqual(i,e.topDate)&&Ne.isEqual(o,e.bottomDate)||(e.topDate=i,e.bottomDate=o,e.topDateMS=i.getTime(),e.bottomDateMS=o.getTime(),e.timeView.range={topDate:i,bottomDate:o}),-1!==r&&-1!==s)for(let t=r;t<=s;t++)a.push.apply(a,e.renderResource(n.getAt(t)));yt.sync({elementConfig:{onlyChildren:!0,children:a},targetElement:t.foregroundCanvas,useSyncId:!0,callback({action:e,config:n,oldConfig:r,element:s}){if(n&&n.className&&n.className[t.eventCls+"-wrap"]){const i=sc[e];if(rc[e]&&r){const e=r.elementData.tplData;t.trigger("releaseEvent",{tplData:e,assignmentRecord:e.assignment,eventRecord:e.eventRecord,resourceRecord:e.resourceRecord,element:s})}if(i){const r=n.elementData.tplData,i={tplData:r,assignmentRecord:r.assignment,eventRecord:r.eventRecord,resourceRecord:r.resourceRecord,element:s};s.elementData.element=s,i.reusingElement="reuseElement"===e,t.trigger("renderEvent",i)}"none"===e&&(n.elementData.element=s)}}}),e.firstResource===r&&e.lastResource===s||(e.resourceColumns.range={firstResource:r,lastResource:s},e.firstResource=r,e.lastResource=s)}}clearResources(e){e.forEach(e=>{this.resourceMap[e]&&(Object.keys(this.resourceMap[e]).forEach(t=>{delete this.eventMap[t][e]}),delete this.resourceMap[e])})}clearAll(){this.resourceMap={},this.eventMap={}}}return e._$name="VerticalEventMapper",e}();function oc(e,t){return e===t.length-1}function ac(e,t){return t===e.cells[e.cells.length-1]}const lc=function(){class e extends An{static get properties(){return{topDate:null,bottomDate:null,levels:[]}}buildCells(){const e=this;return{className:"b-widget b-verticaltimeaxis",style:{height:e._height},children:e.levels.map((t,n)=>({className:new Ai({"b-sch-header-row":1,[`b-sch-header-row-${t.position}`]:1,"b-lowest":oc(n,e.levels)}),dataset:{tickIndex:n,headerPosition:t.position},children:t.cells.filter(t=>t.start<e.bottomDate&&t.end>e.topDate).map(e=>({className:new Ai({"b-sch-header-timeaxis-cell":1,[e.headerCellCls]:e.headerCellCls,[`b-align-${e.align}`]:e.align,"b-last":ac(t,e)}),dataset:{tickIndex:e.index},style:{top:e.coord,height:e.width,minHeight:e.width},children:[{className:"b-sch-header-text",html:e.value}]}))}))}}render(e){super.render(e),this.refresh(!0)}get height(){return this._height}set range(e){this.topDate=e.topDate,this.bottomDate=e.bottomDate,this.refresh()}refresh(e=!this.levels.length){const t=this,{columnConfig:n}=t.timeAxisViewModel,{levels:r}=t;e&&(r.length=0,n.top&&r.push({position:"top",cells:n.top}),n.middle&&r.push({position:"middle",cells:n.middle}),n.bottom&&r.push({position:"bottom",cells:n.bottom}),t._height=r[0].cells.reduce((e,t)=>e+=t.width,0)),t.topDate&&t.bottomDate&&yt.sync({elementConfig:t.buildCells(),targetElement:t.element,useSyncId:"tickIndex"})}}return e._$name="VerticalTimeAxis",e}();uo.registerColumnType(function(){class e extends co{static get type(){return"verticalTimeAxis"}static get defaults(){return{draggable:!1,groupable:!1,hideable:!1,showColumnPicker:!1,filterable:!1,sortable:!1,searchable:!1,editor:!1,enableCellContextMenu:!1,tooltipRenderer:!1,cellCls:"b-verticaltimeaxiscolumn"}}constructor(e,t){super(...arguments),this.timeAxisViewModel=e.timeline.timeAxisViewModel}renderer({cellElement:e,size:t}){const n=this;n.view||(n.grid.timeView=n.view=new lc({timeAxisViewModel:n.timeAxisViewModel})),n.view.render(e),t.height=n.view.height}}return e._$name="VerticalTimeAxisColumn",e}()),To.registerFeature(function(){class e extends Wa{static get defaultConfig(){return{items:null,processItems:null,defaultItems:{addEvent:!0}}}construct(e,t){super.construct(e,t),this.scheduler=e}showEventContextMenu(e){const t=this.scheduler,n=t.getEventData(e),r=n?t.columns.getById(n.columnId)===t.timeAxisColumn:t.timeAxisSubGrid.element===e.target,s=t.resolveResourceRecord(e)||t.resourceStore.last;r&&(this.showContextMenu({menuType:"schedule",date:t.getDateFromDomEvent(e,"floor"),resourceRecord:s,event:e}),e.preventDefault())}get namedItems(){const e=this.client;return this._namedItems||(this._namedItems={addEvent:{text:e.L("Add event",null),icon:"b-icon b-icon-add",disabled:0===e.resourceStore.count,weight:100,onItem({date:t,resourceRecord:n}){e.internalAddEvent(t,n,e.getRowFor(n))}}}),this._namedItems}}return e.featureClass="",e._$name="ScheduleContextMenu",e}(),!0,"Scheduler"),To.registerFeature(function(){class e extends ur{static get defaultConfig(){return{messageTemplate:e=>`<div class="b-sch-hovertip-msg">${e.message}</div>`}}static get pluginConfig(){return{chain:["render"]}}render(){const e=this,t=e.client;let n;e.hoverTip&&e.hoverTip.destroy();const r=e.hoverTip=new er({id:`${t.id}-schedule-tip`,cls:"b-sch-scheduletip",allowOver:!0,hoverDelay:0,hideDelay:100,showOnHover:!0,forElement:t.timeAxisSubGridElement,anchorToTarget:!1,trackMouse:!0,forSelector:".b-scheduler:not(.b-animating):not(.b-dragging-event):not(.b-dragcreating) .b-timeline-subgrid > :not(.b-sch-foreground-canvas):not(.b-group-footer):not(.b-group-row) *",constrainTo:null,getHtml:e.getHoverTipHtml.bind(e),onDocumentMouseDown(e){r.forElement.contains(e.event.target)&&(n=Kt.on({element:t.timeAxisSubGridElement,mousemove:e=>r.internalOnPointerOver(e),capture:!0}));const s=r.hideAnimation;r.hideAnimation=!1,r.constructor.prototype.onDocumentMouseDown.call(r,e),r.hideAnimation=s},listeners:{pointerover:({event:r})=>{const s="buttons"in r?r.buttons>0:r.which>0;return!s&&n&&n(),!e.disabled&&!t.readOnly&&!s}}}),s=r.onMouseMove;r.onMouseMove=(t=>{s.call(r,t),e.onTipMove(r,t)}),e.clockTemplate=new Ua({timeAxisViewModel:t.timeAxisViewModel})}doDestroy(){this.clockTemplate&&this.clockTemplate.destroy(),this.hoverTip&&this.hoverTip.destroy(),super.doDestroy()}onTipMove(e,t){this.clockTemplate.updateDateIndicator(e.element,this.lastTime)}getHoverTipHtml({tip:e,event:t}){const n=this,r=n.client,s=t&&r.getDateFromDomEvent(t,"floor",!0);let i=n.lastHtml;if(s){const e=r.resolveResourceRecord(t);s-n.lastTime==0&&e===n.lastResource||(n.lastResource=e,i=n.lastHtml=n.updateHoverTip(s,t))}else e.hide(),n.lastTime=null,n.lastResource=null;return i}updateHoverTip(e,t){if(e){const n=this,r=n.clockTemplate.template({date:e,text:n.client.getFormattedDate(e)}),s=n.messageTemplate({message:n.getText(e,t)||""});return n.lastTime=e,r+s}}getText(e,t){}get disabled(){return this._disabled}set disabled(e){this._disabled=e}}return e.featureClass="b-scheduletip",e._$name="ScheduleTooltip",e}(),!0,"Scheduler");const cc=function(){class e extends(Dr(El).mixes(Tl,Rl,kl,$l,Nl,Vl,Ll,zl,Wl,Yl)){static get defaultConfig(){return{mode:"horizontal",eventCls:"b-sch-event",timeCellCls:"b-sch-timeaxis-cell",timeCellSelector:".b-sch-timeaxis-cell",scheduledEventName:"event",overScheduledEventClass:"b-sch-event-hover",allowOverlap:!0,rowHeight:60,milestoneCharWidth:10,milestoneAlign:"center",milestoneMinWidth:40}}construct(e={}){super.construct(e),this.createEventOnDblClick&&this.on("scheduledblclick",this.onSchedulerDblClick)}set timeAxisViewModel(e){super.timeAxisViewModel=e,this.eventStore&&(this.timeAxisViewModel.eventStore=this.eventStore)}get timeAxisViewModel(){return super.timeAxisViewModel}get store(){return super.store}set store(e){super.store=e}onLocaleChange(){this.currentOrientation.onLocaleChange(),super.onLocaleChange()}onSchedulerHorizontalScroll(e,t){this.currentOrientation.updateFromHorizontalScroll(t),super.onSchedulerHorizontalScroll(e,t)}onSchedulerDblClick({date:e,resourceRecord:t,row:n}){this.readOnly||t.meta.specialRow||this.internalAddEvent(e,t,n)}onTimeAxisViewModelUpdate(){super.onTimeAxisViewModelUpdate(),this.currentOrientation.onTimeAxisViewModelUpdate()}onColumnsChanged({changes:e,record:t}){t===this.timeAxisColumn&&"width"in e&&this.updateCanvasSize(),super.onColumnsChanged(...arguments)}onVerticalScroll({scrollTop:e}){this.currentOrientation.updateFromVerticalScroll(e)}onEventCreated(e){}get isHorizontal(){return"horizontal"===this.mode}get isVertical(){return"vertical"===this.mode}get mode(){return this._mode}set mode(e){const t=this;t._mode=e,t[e]||("horizontal"===e?(t.horizontal=new tc(t),t.rendered&&t.horizontal.init(),t.un("scroll",t.onVerticalScroll,t)):"vertical"===e&&(t.zoomOnTimeAxisDoubleClick=t.zoomOnMouseWheel=!1,t.vertical=new ic(t),t.rendered&&t.vertical.init(),t.on("scroll",t.onVerticalScroll,t)))}get currentOrientation(){return this[this.mode]}onElementKeyDown(e){super.onElementKeyDown(e)}onElementKeyUp(e){super.onElementKeyUp(e)}onElementMouseOver(e){super.onElementMouseOver(e)}onElementMouseOut(e){super.onElementMouseOut(e)}getEventMenuItems(){}getScheduleMenuItems(){}internalAddEvent(e,t,n){const r=this,s=[t],i=new r.eventStore.modelClass({startDate:e,endDate:Ne.add(e,1,r.timeAxis.unit)});if(r.onEventCreated(i),r.eventEdit){const e=r.currentOrientation.getTimeSpanRenderData(i,t),s=r.eventEdit.dragProxyElement=yt.createElement({parent:r.foregroundCanvas,className:"b-sch-dragcreator-proxy",style:`width:${e.width}px;height:${e.height}px`});return yt.setTranslateXY(s,e.left,(n&&n.top||0)+e.top),void r.editEvent(i,t,s)}!1!==r.trigger("beforeEventAdd",{eventRecord:i,resourceRecords:s,resources:s})&&(r.eventStore.add(i),r.eventStore.assignEventToResource(i,t))}isDateRangeAvailable(e,t,n,r){return this.eventStore.isDateRangeAvailable(e,t,n,r)}}return e._$name="Scheduler",e}();E.register("scheduler",cc),Ni.setVersion("scheduler","2.2.4"),uo.registerColumnType(function(){class e extends co{static get type(){return"addnew"}static get defaults(){return{cls:"b-new-column-column",draggable:!1,sortable:!1,field:null,editor:null}}get columnCombo(){const e=this,t=e.grid.columns;return e._columnCombo||(e._columnCombo=new Zr({cls:"b-new-column-combo",placeholder:e.L("New Column"),triggers:!1,autoExpand:!0,store:e.ganttColumnStore,displayField:"text",monitorResize:!1,picker:{align:"t0-b0",minWidth:200,onItem({record:n}){const r=new n.value({region:e.region},t);t.insert(t.indexOf(e),r),r.element.focus()}},syncInputFieldValue(){this.input.value=""}}))}get ganttColumnStore(){return new Nr({data:Object.values(uo.columnTypes).reduce((e,t)=>(t.propertiesExposedForData||t.exposeProperties({}),t.isGanttColumn&&t.text&&e.push({id:t.type,text:t.L(t.text),value:t}),e),[]),filters:[e=>!this.grid.columns.some(t=>t.constructor===e.value)],sorters:[{field:"text"}]})}headerRenderer({column:e,headerElement:t}){const{columnCombo:n}=e;n.render(t),n.picker.forElement=t}onKeyDown(e){"Enter"===e.key&&this.columnCombo.focus()}updateLocalization(){this._columnCombo&&(this._columnCombo.destroy(),this._columnCombo=null),super.updateLocalization()}}return e._$name="AddNewColumn",e}());const dc=function(){class e extends Zr{static get type(){return"calendarpicker"}refreshCalendars(e){this.store.data=e.map(e=>({id:e.id,text:e.name}))}get store(){return this._store||(this.store=new Nr),this._store}set store(e){super.store=e}get value(){return super.value}set value(e){e&&(e.isDefault&&e.isDefault()?e=null:e.id&&(e=e.id)),super.value=e}}return e._$name="CalendarPicker",e}();E.register(dc.type,dc),uo.registerColumnType(function(){class e extends co{static get type(){return"calendar"}static get isGanttColumn(){return!0}static get defaults(){return{field:"calendar",text:"Calendar",editor:{type:dc.type,clearable:!0,allowInvalid:!1}}}afterConstruct(){const e=this;super.afterConstruct();const t=e.grid.project;e.defaultCalendar=t.defaultCalendar,e.refreshCalendars(),t.calendarManagerStore.on({change:e.refreshCalendars,refresh:e.refreshCalendars,thisObj:e})}refreshCalendars(){this.editor.refreshCalendars(this.grid.project.calendarManagerStore.getRange())}renderer({value:e}){const t=this;if(e===t.defaultCalendar)return"";if(e&&e.id){const n=t.editor.store.getById(e.id);return n&&n[t.editor.displayField]||""}return""}}return e._$name="CalendarColumn",e}());const uc=function(){class e extends po{static get defaults(){return{instantUpdate:!0,format:null}}construct(e,t){const n=this;n.gantt=t.grid,super.construct(e,t),e.format?n.explicitFormat=!0:n.gantt.on({displayDateFormatChange({format:e}){n.explicitFormat||n.set("format",e)}})}set format(e){this.explicitFormat=!0,this.set("format",e)}get format(){return this.explicitFormat&&this.data.format||this.gantt.displayDateFormat}}return e._$name="GanttDateColumn",e}();uo.registerColumnType(function(){class e extends uc{static get type(){return"constraintdate"}static get isGanttColumn(){return!0}static get defaults(){return{field:"constraintDate",text:"Constraint Date",width:146}}}return e._$name="ConstraintDateColumn",e}());const hc=function(){class e extends Zr{static get type(){return"constrainttypepicker"}updateLocalization(){super.updateLocalization(),this.store.data=this.buildStoreData()}buildStoreData(){return[{id:"muststarton",text:this.L("Must start on")},{id:"mustfinishon",text:this.L("Must finish on")},{id:"startnoearlierthan",text:this.L("Start no earlier than")},{id:"startnolaterthan",text:this.L("Start no later than")},{id:"finishnoearlierthan",text:this.L("Finish no earlier than")},{id:"finishnolaterthan",text:this.L("Finish no later than")}]}get store(){return this._store||(this.store=new Nr({data:this.buildStoreData()})),this._store}set store(e){super.store=e}}return e._$name="ConstraintTypePicker",e}();E.register(hc.type,hc),uo.registerColumnType(function(){class e extends co{static get type(){return"constrainttype"}static get isGanttColumn(){return!0}static get defaults(){return{field:"constraintType",text:"Constraint Type",width:146,editor:{type:hc.type,clearable:!0,allowInvalid:!1}}}afterConstruct(){const e=this;super.afterConstruct(),e.grid.on({startCellEdit:e.onStartCellEdit,finishCellEdit:e.onDoneCellEdit,cancelCellEdit:e.onDoneCellEdit,thisObj:e}),At.createSequence(e.editor.updateLocalization,e.onEditorLocaleChange,e)}onStartCellEdit({editorContext:{editor:e,record:t}}){e.inputField instanceof hc&&(e.inputField.store.filter(e=>t.run("isConstraintTypeApplicable",e.id)),this._filterDetacher=(()=>e.inputField.store.clearFilters()))}onDoneCellEdit(){this._filterDetacher&&this._filterDetacher()}renderer({value:e}){const t=this.editor.store.getById(e);return t&&t.text||""}onEditorLocaleChange(){this.grid.refreshColumn(this)}}return e._$name="ConstraintTypeColumn",e}());const gc=function(){class e extends fo{static get type(){return"duration"}static get isGanttColumn(){return!0}get durationUnitField(){return`${this.field}Unit`}static get fields(){return[{name:"decimalPrecision",defaultValue:null}]}static get defaults(){return{field:"fullDuration",text:"Duration",min:0,step:1,instantUpdate:!0}}defaultRenderer({record:e}){const t=e[this.field],n=typeof t,r="number"===n?t:t&&t.magnitude;if("number"==typeof r)switch(n){case"number":return this.round(r)+" "+Ne.getLocalizedNameOfUnit(e[this.durationUnitField],1!==t);case"object":return this.round(r)+" "+Ne.getLocalizedNameOfUnit(t.unit,1!==t.magnitude)}}round(e){let{decimalPrecision:t}=this;if(!1===t)return e;null==t&&(t=this.grid.durationDisplayPrecision||1);const n=Math.pow(10,t);return Math.round(e*n)/n}get defaultEditor(){return{type:"duration",name:this.field}}canEdit(e){return e.isLeaf}}return e._$name="DurationColumn",e}();uo.registerColumnType(gc),uo.registerColumnType(function(){class e extends uc{static get type(){return"earlyenddate"}static get isGanttColumn(){return!0}static get defaults(){return{field:"earlyEndDate",text:"Early End"}}canEdit(e){return!1}}return e._$name="EarlyEndDateColumn",e}()),uo.registerColumnType(function(){class e extends uc{static get type(){return"earlystartdate"}static get isGanttColumn(){return!0}static get defaults(){return{field:"earlyStartDate",text:"Early Start"}}canEdit(e){return!1}}return e._$name="EarlyStartDateColumn",e}());const mc=function(){class e extends lo{static get type(){return"effort"}}return e._$name="EffortField",e}();E.register(mc.type,mc),E.register(`${mc.type}field`,mc),uo.registerColumnType(function(){class e extends gc{static get type(){return"effort"}static get defaults(){return{field:"fullEffort",text:"Effort"}}get defaultEditor(){return{type:mc.type,name:this.field}}canEdit(e){return e.isLeaf}}return e._$name="EffortColumn",e}()),uo.registerColumnType(function(){class e extends mo{static get type(){return"showintimeline"}static get isGanttColumn(){return!0}static get defaults(){return{field:"showInTimeline",text:"Show in timeline"}}}return e._$name="ShowInTimelineColumn",e}()),uo.registerColumnType(function(){class e extends uc{static get type(){return"enddate"}static get isGanttColumn(){return!0}static get defaults(){return{field:"endDate",text:"Finish"}}canEdit(e){return e.isLeaf}}return e._$name="EndDateColumn",e}()),uo.registerColumnType(function(){class e extends uc{static get type(){return"lateenddate"}static get isGanttColumn(){return!0}static get defaults(){return{field:"lateEndDate",text:"Late End"}}canEdit(e){return!1}}return e._$name="LateEndDateColumn",e}()),uo.registerColumnType(function(){class e extends uc{static get type(){return"latestartdate"}static get isGanttColumn(){return!0}static get defaults(){return{field:"lateStartDate",text:"Late Start"}}canEdit(e){return!1}}return e._$name="LateStartDateColumn",e}()),uo.registerColumnType(function(){class e extends mo{static get type(){return"manuallyscheduled"}static get isGanttColumn(){return!0}static get defaults(){return{field:"manuallyScheduled",text:"Manually scheduled"}}}return e._$name="ManuallyScheduledColumn",e}()),uo.registerColumnType(function(){class e extends mo{static get type(){return"milestone"}static get isGanttColumn(){return!0}static get defaults(){return{field:"milestone",text:"Milestone"}}}return e._$name="MilestoneColumn",e}());const pc=function(){class e extends wo{static get type(){return"name"}static get isGanttColumn(){return!0}static get defaults(){return{htmlEncode:!1,width:200,field:"name",text:"Name"}}}return e._$name="NameColumn",e}();uo.registerColumnType(pc),uo.registerColumnType(function(){class e extends co{static get type(){return"note"}static get isGanttColumn(){return!0}static get defaults(){return{field:"note",text:"Note",width:150,editor:{type:"textareafield",inline:!1}}}renderer({value:e}){if(e)return e.trim()}get disableHtmlEncode(){return!0}}return e._$name="NoteColumn",e}()),uo.registerColumnType(function(){class e extends fo{static get type(){return"percentdone"}static get isGanttColumn(){return!0}static get fields(){return["showCircle"]}static get defaults(){return{field:"percentDone",text:"% Done",unit:"%",step:1,min:0,max:100,width:90}}construct(e){super.construct(...arguments),this.showCircle&&(this.htmlEncode=!1)}defaultRenderer(e){if(this.showCircle){const t=Math.round(e.record.renderedPercentDone),n=.8*this.grid.rowHeight;return`<div class="b-percentdone-circle" style="animation-delay: -${t-.1}s;width: ${n}px;height: ${n}px" data-value="${t}"></div>`}return e.record.renderedPercentDone+this.unit}canEdit(e){return e.isLeaf}}return e._$name="PercentDoneColumn",e}());const fc={from:[2,3,0,1],to:[1,0,3,2]};let vc=["SS","SF","FS","FF"],yc=()=>new RegExp(`(${vc.join("|")})?((?:[+-])\\d+[a-z]*)?`,"i"),bc=yc();he.on({locale:({locale:e})=>{vc=e.GanttCommon.dependencyTypes,bc=yc()}});const Cc=function(){class e extends Zr{static get defaultConfig(){return{listCls:"b-predecessor-list",valueField:"name",displayField:"name",delimiter:";",otherSide:null,ourSide:null}}construct(e){const t=this,{otherSide:n}=e;t.dependencies=new cn({extraKeys:n}),t.startCollection=new cn({extraKeys:n}),super.construct(e),t.delimiterRegEx=new RegExp(`\\s*${t.delimiter}\\s*`),he.on({locale(){t.syncInputFieldValue()},thisObj:t})}internalOnInput(){this.isValid?(this.clearError(),zr.prototype.internalOnInput.call(this)):this.setError("Invalid dependency format")}onInternalKeyDown(e){const{key:t}=e;"Enter"!==t&&super.onInternalKeyDown(e),this.pickerVisible&&"ArrowDown"===t&&this.filterField.focus()}onTriggerClick(){this.pickerVisible?super.onTriggerClick():this.doFilter(this.filterInput?this.filterInput.value:null)}set store(e){const t=this;(e=e.makeChained(e=>!t.owner||!t.owner.record||e.id!==t.owner.record.id)).tree=!1,super.store=e}get store(){return super.store}get picker(){return this._picker||(this._picker=this.createPicker())}createPicker(){const e=this,t=e.input,n=e.filterField=new zr({owner:e,clearable:!0,placeholder:"Filter",triggers:{filter:{cls:"b-icon b-icon-filter",align:"start"}},listeners:{input({value:n}){e.input=r,e.filterList(n),e.input=t},clear(){e.input=r,e.filterList(),e.input=t}},style:"position:sticky;top:0;z-index:1"}),r=e.filterInput=n.input,s=new Ur({owner:e,floating:!0,scrollAction:"realign",itemsFocusable:!1,activateOnMouseover:!0,store:e.store,cls:e.listCls,itemTpl:e.listItemTpl,forElement:e[e.pickerAlignElement],align:{align:"t0-b0",axisLock:!0,anchor:e.overlayAnchor,target:e[e.pickerAlignElement]},navigator:{keyEventTarget:r,processEvent:t=>{if("Escape"!==t.key)return t;e.hidePicker()}},onItem:e.onPredecesssorClick,maxHeight:324,minHeight:161,scrollable:{overflowY:!0},autoShow:!1,focusOnHover:!1,getItemClasses:function(t){const n=Ur.prototype.getItemClasses.call(this,t),r=e.dependencies.getBy(e.otherSide+"Event",t);return n+(r?` b-selected b-${r.getConnectorString(1).toLowerCase()}`:"")}});return n.render(s.contentElement),s}showPicker(e){this.store.fillFromMaster(),super.showPicker(e)}onPickerShow({source:e}){const t=this,n=t.filterField,r=t.input;e.minWidth=t[t.pickerAlignElement].offsetWidth,e.contentElement.insertBefore(n.element,e.contentElement.firstChild),t.input=t.filterInput,super.onPickerShow(),t.input=r}listItemTpl(e){return`<div class="b-predecessor-item-text">${e.name}</div>\n            <div class="b-sch-box b-from" data-side="from"></div>\n            <div class="b-sch-box b-to" data-side="to"></div>`}get isValid(){return Boolean(!this.owner||this.parseDependencies(this.input.value))}set value(e){const t=this,n=t.dependencies,r=t.startCollection;if("string"==typeof e){if(t.input.value=e,!(e=t.parseDependencies(e)))return void t.updateInvalid();for(let n=0;n<e.length;n++){let s=new t.dependencyStore.modelClass(e[n]),i=r.getBy(t.otherSide,s.fromEvent);i&&((i=i.copy(i.id)).type=s.type,i.fullLag=s.fullLag),e[n]=i||s}}else t.startCollection.clear(),t.startCollection.values=e;n.clear(),n.values=e,t.inputting||t.syncInputFieldValue()}get value(){return this.dependencies.values}onPredecesssorClick({source:e,item:t,record:n,event:r}){const s=this.owner,i=s.dependencies,o=r.target.closest(".b-sch-box"),a=o&&o.dataset.side;let l=i.getBy(s.otherSide+"Event",n);t.dataset.noselect=!0,l&&!o?i.remove(l):l?((l=l.copy(l.id)).type=fc[a][l.type],i.add(l)):i.add(s.dependencyStore.createRecord({[`${s.otherSide}Event`]:n,[`${s.ourSide}Event`]:s.owner.record},!0)),s.syncInputFieldValue(),e.refresh()}syncInputFieldValue(){this.input.value=this.constructor.predecessorsToString(this.dependencies.values,this.otherSide,this.delimiter)}static predecessorsToString(e,t,n=";"){const r=[];if(e&&e.length)for(const s of e){const e=s[t+"Event"];r.push(`${e?e.id:e||""}${s.getConnectorString()}${s.getLag()}`)}return r.join(n)}parseDependencies(e){const t=this,n=t.grid,r=t.owner.record,s=t.store,i=t.dependencyStore,o=e.split(t.delimiterRegEx),a=i.modelClass,l=[];for(let c=0;c<o.length;c++){const e=o[c];if(e){let i,o,c,d,u=e.length+1;for(;u&&!o;u--)i=e.substr(0,u),o=s.getById(i);if(!o)return null;if(c=e.substr(u+1),d={[`${t.otherSide}Event`]:o,[`${t.ourSide}Event`]:r,type:a.Type.EndToStart},c.length){const e=bc.exec(c);if(!e||!e[1]&&!e[2])return null;if(e[1]&&(d.type=vc.indexOf(e[1].toUpperCase())),e[2]){const t=Ne.parseDuration(e[2],!0,n.timeAxis.unit);d.lag=t.magnitude,d.lagUnit=t.unit}}l.push(d)}}return l}}return e._$name="DependencyField",e}();E.register("dependencyfield",Cc);const wc=function(){class e extends(U(co)){static get type(){return"dependency"}static get fields(){return[{name:"delimiter",defaultValue:";"}]}static get defaults(){return{htmlEncode:!1,width:120,renderer({record:e}){return Cc.predecessorsToString(e[this.field],"predecessors"===this.field?"from":"to",this.delimiter)}}}afterConstruct(){super.afterConstruct(),this.grid.on({cancelcelleditasync:"onGridCancelCellEditAsync",thisObj:this})}onGridCancelCellEditAsync({editorContext:e}){this===e.column&&I.toast(this.L("Invalid dependency found, change is reverted"))}get defaultEditor(){const e=this,t="predecessors"===e.field;return{type:"dependencyfield",grid:e.grid,name:e.field,delimiter:e.delimiter,ourSide:t?"to":"from",otherSide:t?"from":"to",store:e.grid.eventStore||e.grid.taskStore,dependencyStore:e.grid.features.dependencies.store}}}return e._$name="DependencyColumn",e}();uo.registerColumnType(wc),uo.registerColumnType(function(){class e extends wc{static get type(){return"predecessor"}static get isGanttColumn(){return!0}static get defaults(){return{text:"Predecessors",field:"predecessors"}}}return e._$name="PredecessorColumn",e}());class Sc{initialize(e){e&&Object.assign(this,e)}static new(e){const t=new this;return t.initialize(e),t}}var Dc,Ec;!function(e){e[e.Cancel=0]="Cancel",e[e.Restart=1]="Restart",e[e.Resume=2]="Resume"}(Dc||(Dc={}));class xc extends Sc{}class Tc extends xc{}class Rc extends xc{}class kc extends xc{}!function(e){e[e.Cancel=0]="Cancel",e[e.Resume=1]="Resume"}(Ec||(Ec={}));class Mc extends Sc{onNode(e){}onTopologicalNode(e){}onCycle(e,t){return Ec.Cancel}}const Ic=e=>(class extends e{walkDepth(e){const t=new Map,n=new Set,r=[{node:this,from:this}];let s;for(;s=r.length;){const i=r[s-1].node;if(n.has(i)){r.pop();continue}const o=t.get(i);if(null!=o){if(o<s){if(e.onCycle(i,r)!==Ec.Resume)break}else n.add(i),e.onTopologicalNode(i);r.pop()}else{t.set(i,s),e.onNode(i);const o=r.length;e.forEachNext(i,e=>r.push({node:e,from:i})),r.length===o&&(n.add(i),e.onTopologicalNode(i),r.pop())}}}}),Ac=e=>{const t=e[e.length-1].node,n=[t];let r=e.length-1,s=e.length-1;do{for(;r>=0&&e[r].from===e[s].from;r--);r>=0&&(n.push(e[r].node),s=r,r--)}while(r>=0&&e[r].node!==t);return n.push(t),n.reverse()};class Fc extends Mc{forEachNext(e,t){e.forEachOutgoing(this,t)}}const Oc=e=>(class extends e{forEachOutgoing(e,t){this.getOutgoing(e).forEach(t)}}),Lc=e=>(class extends e{forEachIncoming(e,t){this.getIncoming(e).forEach(t)}}),_c=e=>(class extends e{constructor(){super(...arguments),this.outgoing=new Set}hasEdgeTo(e){return this.outgoing.has(e)}addEdgeTo(e){this.outgoing.add(e)}removeEdgeTo(e){this.outgoing.delete(e)}addEdgesTo(e){e.forEach(e=>this.addEdgeTo(e))}getOutgoing(e){return Array.from(this.outgoing)}forEachOutgoing(e,t){this.outgoing.forEach(t)}}),Pc=e=>(class extends e{constructor(){super(...arguments),this.incoming=new Set}hasEdgeFrom(e){return this.incoming.has(e)}addEdgeFrom(e){this.incoming.add(e)}removeEdgeFrom(e){this.incoming.delete(e)}addEdgesFrom(e){e.forEach(e=>this.addEdgeFrom(e))}getIncoming(e){return Array.from(this.incoming)}forEachIncoming(e,t){this.incoming.forEach(t)}}),$c=e=>(class extends e{addEdgeTo(e){super.addEdgeTo(e),e.incoming.add(this)}removeEdgeTo(e){super.removeEdgeTo(e),e.incoming.delete(this)}addEdgeFrom(e){super.addEdgeFrom(e),e.outgoing.add(this)}removeEdgeFrom(e){super.removeEdgeFrom(e),e.outgoing.delete(this)}});class jc extends($c(_c(Pc(Oc(Lc(Ic(Sc))))))){}const Hc=e=>(class extends e{constructor(){super(...arguments),this.nodes=new Set}getNodes(){return this.nodes}hasDirectNode(e){return this.getNodes().has(e)}addNodes(e){e.forEach(e=>this.addNode(e))}addNode(e){return this.nodes.add(e),e}removeNodes(e){e.forEach(e=>this.removeNode(e))}removeNode(e){if(!this.hasDirectNode(e))throw new Error(`This [${e}] does not exists in the graph`);e.outgoing.forEach(t=>t.removeEdgeFrom(e)),e.incoming.forEach(t=>t.removeEdgeTo(e)),this.nodes.delete(e)}getIncoming(){return Array.from(this.nodes)}getOutgoing(){return Array.from(this.nodes)}forEachIncoming(e,t){this.nodes.forEach(t)}forEachOutgoing(e,t){this.nodes.forEach(t)}});class Nc extends(Hc(_c(Pc(Oc(Lc(Ic(Sc))))))){}const zc=e=>e.slice(0,1).toUpperCase()+e.slice(1),Bc=e=>Object(e)!==e,Vc=(e,t,n)=>(Object.defineProperty(e,t,{value:n}),n);var Wc;!function(e){e[e.Canceled=0]="Canceled",e[e.Completed=1]="Completed",e[e.Passed=2]="Passed"}(Wc||(Wc={}));const Uc=e=>(class extends e{constructor(){super(...arguments),this.nodesMap=new Map,this.needRecalculationAtoms=new Set,this.stableAtoms=new Set,this.isPropagating=!1,this.propagateCompletedListeners=[],this.propagateSuspended=0}isAtomNeedRecalculation(e){return this.needRecalculationAtoms.has(e)}markAsNeedRecalculation(e){this.needRecalculationAtoms.add(e)}markProcessed(e){this.needRecalculationAtoms.delete(e)}markStable(e){this.stableAtoms.add(e)}isAtomStable(e){return this.stableAtoms.has(e)}commit(){this.needRecalculationAtoms.forEach(e=>e.clearUserInput()),this.needRecalculationAtoms.clear(),this.changedAtoms.forEach(e=>e.commitValue()),this.stableAtoms.forEach(e=>e.commitEdges()),this.stableAtoms.clear()}reject(){this.rejectPartialProgress(),this.needRecalculationAtoms.forEach(e=>e.clearUserInput()),this.needRecalculationAtoms.clear()}rejectPartialProgress(){this.touchedAtoms.forEach((e,t)=>t.reject()),this.stableAtoms.clear()}addNode(e){const t=super.addNode(e);return this.nodesMap.set(e.id,e),this.markAsNeedRecalculation(e),e.onEnterGraph(this),t}removeNode(e){e.outgoing.forEach(e=>this.markAsNeedRecalculation(e));const t=super.removeNode(e);return this.nodesMap.delete(e.id),this.needRecalculationAtoms.delete(e),this.stableAtoms.delete(e),e.onLeaveGraph(this),t}startAtomCalculation(e){const t=e.calculate(e.proposedValue);let n=t.next();const r=n.value;return r instanceof xc?{effect:r,continuation:{iterator:t}}:n.done?{value:r}:{continuation:{atom:r,iterator:t}}}continueAtomCalculation(e,t,n){const r=this,s=t.iterator;let i=t.atom;do{let t;if(i)if(e.observedDuringCalculation.push(i),n.has(i)&&!this.isAtomStable(i)){let e;r.walkDepth(Fc.new({forEachNext:function(e,t){e===r?r.needRecalculationAtoms.forEach(t):e.observedDuringCalculation.forEach(t)},onCycle:(t,n)=>(e=Ac(n),Ec.Cancel)})),t={value:kc.new({cycle:e}),done:!0}}else t=s.next(i.hasNextStableValue()?i.getNextStableValue():i.getConsistentValue());else t=s.next();const o=t.value;if(o instanceof xc)return{effect:o,continuation:{iterator:s}};if(t.done)return{value:o};i=o}while(!n.has(i)||this.isAtomStable(i));return{continuation:{iterator:s,atom:i}}}*propagateSingle(){const e=[],t=new Set,n=this;let r,s=null;if(this.walkDepth(Fc.new({forEachNext:function(e,t){e===n?n.needRecalculationAtoms.forEach(t):Fc.prototype.forEachNext.call(this,e,t)},onNode:e=>{},onCycle:(e,t)=>(s=Ac(t),Ec.Cancel),onTopologicalNode:n=>{n!==this&&(t.add(n),e.push(n))}})),s)return kc.new({cycle:s});const i=this.touchedAtoms=new Map,o=new Map,a=this.changedAtoms=[];for(;r=e.length;){const n=e[r-1];if(this.isAtomStable(n)||!t.has(n)){e.pop();continue}let s;if(null!=o.get(n)){const e=i.get(n);s=this.continueAtomCalculation(n,e,t)}else o.set(n,r),s=this.startAtomCalculation(n);if(s.effect&&(yield s.effect),s.continuation){i.set(n,s.continuation);const t=s.continuation.atom;t&&(n.observedDuringCalculation.push(t),e.push(t))}else{i.set(n,null);const t=s.value;n.equality(t,n.getConsistentValue())||(a.push(n),n.nextStableValue=t),this.markStable(n),e.pop()}}return{success:!0}}async onEffect(e){if(e instanceof Tc)return Dc.Cancel;if(e instanceof Rc)return Dc.Restart;if(e instanceof kc)throw new Error("Graph cycle detected");return Dc.Resume}waitForPropagateCompleted(){return this.isPropagating?new Promise(e=>{this.propagateCompletedListeners.push(e)}):Promise.resolve(null)}suspendPropagate(){this.propagateSuspended++}async resumePropagate(e){if(this.propagateSuspended){if(--this.propagateSuspended)return this.resumePromise;if(this.resumePromise&&!1!==e)return this.propagate()}return Promise.resolve(Wc.Completed)}async propagate(e,t=!1){const n=this;if(n.propagateSuspended)return n.resumePromise||(n.resumePromise=new Promise((e,t)=>{n.resumeResolved=e,n.resumeRejected=t})),n.resumePromise;if(n.resumePromise){const r=n.resumeResolved,s=n.resumeRejected;return n.resumePromise=n.resumeResolved=n.resumeRejected=null,n.propagateUnsuspended(e,t).then(e=>(r(e),e),e=>(s(e),e))}return n.propagateUnsuspended(e,t)}async propagateUnsuspended(e,t=!1){if(this.isPropagating)throw new Error("Can not nest calls to `propagate`, use `waitForPropagateCompleted`");let n,r;this.isPropagating=!0;do{n=!1;const r=this.propagateSingle();let s;do{const i=(s=r.next()).value;if(i instanceof xc){let r;if((r=e?await e(i):await this.onEffect(i))===Dc.Cancel)return"function"==typeof t&&t(),this.reject(),this.isPropagating=!1,await this.propagationCompletedHook(),this.onPropagationCompleted(Wc.Canceled),Wc.Canceled;if(r===Dc.Restart){this.rejectPartialProgress(),n=!0;break}}}while(!s.done)}while(n);return t?("function"==typeof t&&t(),this.reject(),this.isPropagating=!1,await this.propagationCompletedHook(),this.onPropagationCompleted(Wc.Completed),r=Wc.Passed):(this.commit(),this.isPropagating=!1,await this.propagationCompletedHook(),this.onPropagationCompleted(Wc.Completed),r=Wc.Completed),r}async tryPropagateWithNodes(e,t,n){t&&t.length&&(t=t.filter(e=>e.graph!==this)).length&&this.addNodes(t);const r=await this.propagate(e,n||!0);return t&&t.length&&t&&this.removeNodes(t),r}async propagationCompletedHook(){}onPropagationCompleted(e){this.propagateCompletedListeners.forEach(t=>t(e)),this.propagateCompletedListeners=[]}commitAllEdges(){this.nodes.forEach(e=>e.commitEdges())}toDotOnCycleException(){return this.commitAllEdges(),this.toDot()}toDotAtomName(e){let[t,n]=String(e.id).split("/");if(e.self){const n=e.self;n.name&&(t=n.name)}return`${t}/${n||"self"}`}toDotAtomValue(e){let t;if(e.newRefs&&e.oldRefs){const n=e.get();t=`Set(${n&&n.size||0})`}else t=e.get();return t instanceof Date?t=[t.getFullYear(),".",t.getMonth()+1,".",t.getDate()," ",t.getHours()+":"+t.getMinutes()].join(""):Array.isArray(t)&&(t=`Array(${t.length})`),t}toDotAtomColor(e){return!this.isAtomNeedRecalculation(e)||this.isAtomStable(e)?"darkgreen":"red"}toDotObtainCycle(){let e={};return this.walkDepth(Fc.new({onCycle:(t,n)=>{const r=Ac(n);return e=r.reduce(([e,t],n)=>(t&&(e[t.id]=n.id),[e,n]),[e,null])[0],Ec.Cancel}})),e}toDot(){let e=["digraph ChronoGraph {","splines=spline"];const t=Array.from(this.nodesMap.entries()),n=t.reduce((e,[t,n])=>{let[r,s]=String(t).split("/");const{id:i,name:o}=n.self||{},{field:a}=n;return s=a&&a.name||s,e.has(r=o||i||r)?e.get(r).add([s,n]):e.set(r,new Set([[s||"",n]])),e},new Map);e=Array.from(n.entries()).reduce((e,[t,n],r)=>(e.push(`subgraph cluster_${r} {`),e.push(`label="${t}"`),(e=Array.from(n.values()).reduce((e,[t,n])=>{let r=this.toDotAtomValue(n),s=this.toDotAtomColor(n);return e.push(`"${n.id}" [label="${t}=${r}", fontcolor="${s}"]`),e},e)).push("}"),e),e);let r=this.toDotObtainCycle();return(e=t.reduce((e,[t,n])=>(Array.from(n.outgoing).reduce((e,s)=>{let i=!this.isAtomNeedRecalculation(n)||this.isAtomStable(n)?"darkgreen":"red";return e.push(`"${t}" -> "${s.id}" [label="", color="${i}", penwidth=${r[t]==s.id?5:1}]`),e},e),e),e)).push("}"),e.join("\n")}toDotAtomIncoming(e){let t=["digraph ChronoGraph {","splines=spline"],n=new Set;((t,n,r)=>{let s,i,o=[e];for(;o.length;)r(s=o.pop()),(i=n(s))&&(o=o.concat(i.slice().reverse()))})(0,e=>Array.from(e.incoming),e=>n.add(e)),t=Array.from(n).reduce((t,n)=>{const r=this.toDotAtomName(n),s=this.toDotAtomValue(n);let i,o;return n==e?(i="orange",o=5):(i=this.toDotAtomColor(n),o=1),t.push(`"${n.id}" [label="${r}=${s}", fontcolor="${i}", penwidth=${o}]`),t},t);const r=this.toDotObtainCycle();return(t=Array.from(n).reduce((e,t)=>Array.from(t.incoming).reduce((e,n)=>{const s=n.id,i=t.id,o=this.toDotAtomColor(n);return e.push(`"${s}" -> "${i}" [label="", color="${o}", penwidth=${r[s]==i?5:1}]`),e},e),t)).push("}"),t.join("\n")}});class Gc extends(Uc(Nc)){}const Yc=Symbol("IteratorReturnedEarly");class qc extends Sc{constructor(){super(...arguments),this.fields=new Map}hasField(e){return void 0!==this.getField(e)}getField(e){let t=void 0;return this.forEachParent(n=>{const r=n.fields.get(e);if(r)return t=r,Yc}),t}addField(e){const t=e.name;if(!t)throw new Error("Field must have a name");if(this.fields.has(t))throw new Error(`Field with name [${String(t)}] already exists`);return e.entity=this,this.fields.set(t,e),e}forEachParent(e){let t=this;for(;t;){if(e(t)===Yc)return Yc;t=t.parentEntity}}forEachField(e){const t=new Set;this.forEachParent(n=>{n.fields.forEach((n,r)=>{t.has(r)||(t.add(r),e(n,r))})})}}let Xc=1;const Kc=e=>(class extends e{constructor(){super(...arguments),this.id=(()=>`chrono${Xc++}`)()}}),Zc=(e,t)=>e instanceof Date&&t instanceof Date?e-t==0:e===t,Jc=e=>(class extends e{constructor(){super(...arguments),this.equality=Zc,this.observedDuringCalculation=[]}clearUserInput(){this.proposedValue=void 0,this.proposedArgs=void 0}commitValue(){const e=this.nextStableValue;this.nextStableValue=void 0,this.value=e}commitEdges(){this.incoming.forEach(e=>this.removeEdgeFrom(e)),this.observedDuringCalculation.forEach(e=>this.addEdgeFrom(e)),this.observedDuringCalculation=[]}reject(){this.nextStableValue=void 0,this.observedDuringCalculation=[]}*calculate(e){return this.calculation?yield*this.calculation.call(this.calculationContext||this,e):void 0!==e?e:this.value}hasValue(){return this.hasNextStableValue()||this.hasProposedValue()||this.hasConsistentValue()}hasStableValue(){return this.hasNextStableValue()||this.hasConsistentValue()}hasNextStableValue(){return void 0!==this.nextStableValue}hasConsistentValue(){return void 0!==this.value}hasProposedValue(){return void 0!==this.proposedArgs}get(){return this.hasNextStableValue()?this.getNextStableValue():this.hasProposedValue()?this.getProposedValue():this.getConsistentValue()}put(e,...t){this.proposedValue=e,this.proposedArgs=Array.prototype.slice.call(arguments),this.graph&&this.graph.markAsNeedRecalculation(this)}getNextStableValue(){return this.nextStableValue}getConsistentValue(){return this.value}getProposedValue(){return this.proposedValue}async set(e,...t){const n=this.graph;return this.put(e,...t),n?n.propagate():Promise.resolve(Wc.Completed)}onEnterGraph(e){this.graph=e}onLeaveGraph(e){this.graph=void 0}});class Qc extends(Jc(Kc(jc))){}const ed=e=>(class extends e{put(e,...t){return super.put(this.field.converter?this.field.converter(e,this.field):e,...t)}toString(){return`Field atom [${this.field.name}] of entity [${this.self}}]`}});class td extends(ed(Qc)){}const nd=e=>(class extends e{toString(){return`Entity atom [${this.self.id}]`}});class rd extends(nd(Qc)){}class sd extends Sc{constructor(){super(...arguments),this.persistent=!0,this.createAccessors=!0,this.atomCls=td}}const id=Symbol("isReplica"),od=e=>(class extends e{[id](){}addEntity(e){e.enterGraph(this)}addEntities(e){e.forEach(e=>this.addEntity(e))}removeEntity(e){e.leaveGraph()}removeEntities(e){e.forEach(e=>this.removeEntity(e))}async tryPropagateWithEntities(e,t,n){t&&t.length&&(t=t.filter(e=>e.$$.graph!==this),this.addEntities(t));const r=await this.propagate(e,n||!0);return t&&t.length&&this.removeEntities(t),r}});class ad extends(od(Gc)){}const ld=Symbol("isEntity"),cd=e=>(class extends e{[ld](){}get $entity(){return dd(this.constructor.prototype)}get $(){const e={};return this.$entity.forEachField((t,n)=>{e[n]=this.createFieldAtom(t)}),Vc(this,"$",e)}get $$(){return Vc(this,"$$",rd.new({entity:this.$entity,self:this,equality:()=>!1,calculation:this.calculateSelf,calculationContext:this}))}*calculateSelf(){return this}createFieldAtom(e){const t=e.name,n=this.$calculations&&this[this.$calculations[t]];return e.atomCls.new({id:`${this.$$.id}/${t}`,field:e,self:this,calculationContext:n?this:void 0,calculation:n})}getGraph(){return this.$$.graph}forEachFieldAtom(e){const t=this.$;for(let n in t)e.call(this,t[n],n)}enterGraph(e){this.forEachFieldAtom(t=>e.addNode(t)),e.addNode(this.$$)}leaveGraph(){const e=this.$$.graph;e&&(this.forEachFieldAtom(t=>e.removeNode(t)),e.removeNode(this.$$))}isPropagating(){return this.getGraph().isPropagating}suspendPropagate(){const e=this.getGraph();e&&e.suspendPropagate()}async resumePropagate(e){const t=this.getGraph();return t&&t.resumePropagate(e)||Promise.resolve(Wc.Completed)}async propagate(e,t=!1){const n=this.getGraph();return n&&n.propagate(e,t)||Promise.resolve(Wc.Completed)}async waitForPropagateCompleted(){return this.getGraph().waitForPropagateCompleted()}async tryPropagateWithNodes(e,t,n){return this.getGraph().tryPropagateWithNodes(e,t,n)}async tryPropagateWithEntities(e,t,n){const r=this.getGraph();if(!(e=>Boolean(e&&e[id]))(r))throw new Error("Entity is not part of replica");return r.tryPropagateWithEntities(e,t,n)}markAsNeedRecalculation(e){this.getGraph().markAsNeedRecalculation(e)}markStable(e){this.getGraph().markStable(e)}static getField(e){return this.getEntity().getField(e)}static getEntity(){return ud(this.prototype)}run(e,...t){const n=this[e](...t);let r,s;for(;;){const e=(r=n.next(s)).value;if(e instanceof xc)throw new Error("Helper methods can not yield effects during computation");if(r.done)return e;const t=e;if(this.getGraph().isAtomNeedRecalculation(t))throw new Error("Can not use stale atom for calculations");s=t.get()}}}),dd=e=>{let t=Object.getPrototypeOf(e);return Vc(e,"$entity",qc.new({parentEntity:t.hasOwnProperty(ld)?null:t.$entity}))},ud=e=>{let t=e.$entity;return e.hasOwnProperty("$entity")||(t=dd(e)),t},hd=(e,t=sd)=>(function(n,r){if(ud(n).addField(t.new(Object.assign(e||{},{name:r}))).createAccessors){Object.defineProperty(n,r,{get:function(){return this.$[r].get()},set:function(e){return this.$[r].put(e)}});const e=`get${zc(r)}`,t=`set${zc(r)}`;e in n||(n[e]=function(...e){return this.$[r].get(...e)}),t in n||(n[t]=function(...e){return this.$[r].set(...e)})}}),gd=hd,md=function(e){return function(t,n,r){let s=t.$calculations;s||(s=t.$calculations={}),s[e]=n}},pd=e=>(class extends e{constructor(){super(...arguments),this.atomCls=Ed}});class fd extends(pd(sd)){}const vd=e=>(class extends e{constructor(){super(...arguments),this.persistent=!1,this.atomCls=Sd}});class yd extends(vd(sd)){}const bd=(e,t=yd)=>hd(e,t),Cd=(e,t=fd)=>hd(e,t),wd=e=>(class extends e{constructor(){super(...arguments),this.oldRefs=new Set,this.newRefs=new Set,this.value=new Set}commitValue(){super.commitValue(),this.oldRefs.clear(),this.newRefs.clear()}reject(){super.reject(),this.oldRefs.clear(),this.newRefs.clear()}*calculate(e){const t=new Set;let n;for(n of this.incoming)if(!this.oldRefs.has(n)){const e=yield n;null!=e&&t.add(e)}for(n of this.newRefs){const e=yield n;null!=e&&t.add(e)}return t}});class Sd extends(wd(td)){}const Dd=e=>(class extends e{hasBucket(){return Boolean(this.field.bucket)}addToBucket(e){e.newRefs.add(this.self.$$),this.graph&&this.graph.markAsNeedRecalculation(e)}removeFromBucket(e){e.oldRefs.add(this.self.$$),this.graph&&this.graph.markAsNeedRecalculation(e)}*calculate(e){const t=this.resolve(void 0!==e?e:this.value);return Bc(t)||(yield t.$$),t}resolve(e){const t=this.field.resolver;return t&&void 0!==e&&Bc(e)?t.call(this.self,e):e}getBucket(e){return e.$[this.field.bucket]}onEnterGraph(e){const t=this.get();let n=!0;if(void 0!==t&&Bc(t)){n=!1;const e=this.resolve(t);Bc(e)||(this.put(e),n=!0)}if(super.onEnterGraph(e),void 0!==this.get()&&n&&this.hasBucket()){const e=this.getBucket(this.get());this.addToBucket(e)}}onLeaveGraph(e){if(this.hasValue()&&this.hasBucket()){const e=this.get();if(!Bc(e)){const t=this.getBucket(e);this.removeFromBucket(t)}}super.onLeaveGraph(e)}put(e){const t=this.value;if(this.hasBucket()&&(null==t||Bc(t)||this.removeFromBucket(this.getBucket(t)),null!=e))if(Bc(e)){const t=this.resolve(e);null!=t&&(this.addToBucket(this.getBucket(t)),e=t)}else this.addToBucket(this.getBucket(e));super.put(e)}});class Ed extends(Dd(ed(Qc))){}class xd extends sd{constructor(){super(...arguments),this.atomCls=kd,this.modelFieldConfig={}}}class Td extends(pd(xd)){constructor(){super(...arguments),this.atomCls=Md}}class Rd extends(vd(xd)){constructor(){super(...arguments),this.atomCls=Id}initialize(...e){super.initialize(...e),this.modelFieldConfig=Object.assign({isEqual:()=>!1,defaultValue:new Set,persist:!1},this.modelFieldConfig)}}class kd extends td{get value(){return this.self.get(this.field.name)}set value(e){this.self.set(this.field.name,e)}}class Md extends(Dd(kd)){}class Id extends(wd(kd)){get value(){if(this.self)return this.self.get(this.field.name)}set value(e){this.self&&this.self.set(this.field.name,e)}}const Ad=function(e={},t={}){return function(n,r){hd(Object.assign({modelFieldConfig:e},t),xd)(n,r),Fd(n.constructor)}},Fd=e=>{e.hasOwnProperty("fields")||Object.defineProperty(e,"fields",{get:function(){return Od(this)}})},Od=e=>{let t=[];const n=e.prototype;return n.hasOwnProperty("$entity")&&n.$entity.fields.forEach(e=>{e instanceof xd&&t.push(Object.assign(e.modelFieldConfig||{},{name:e.name}))}),t},Ld=(e,t)=>null===e?null:(e instanceof Date||(e=Ne.parse(e,t.modelFieldConfig.format||t.modelFieldConfig.dateFormat)),e||void 0),_d=e=>(class extends e{calculateProject(){throw new Error("Implement me")}setProject(e){return this.project=e}getProject(){return this.project?this.project:this.setProject(this.calculateProject())}getGraph(){const e=this.getProject();return e&&e.getGraph()}getEventStore(){const e=this.getProject();return e&&e.eventStore}getDependencyStore(){const e=this.getProject();return e&&e.dependencyStore}getAssignmentStore(){const e=this.getProject();return e&&e.assignmentStore}getResourceStore(){const e=this.getProject();return e&&e.resourceStore}getCalendarManagerStore(){const e=this.getProject();return e&&e.calendarManagerStore}getEventById(e){return this.getEventStore()&&this.getEventStore().getById(e)}getDependencyById(e){return this.getDependencyStore()&&this.getDependencyStore().getById(e)}getResourceById(e){return this.getResourceStore()&&this.getResourceStore().getById(e)}getAssignmentById(e){return this.getAssignmentStore()&&this.getAssignmentStore().getById(e)}getCalendarById(e){return this.getCalendarManagerStore()&&this.getCalendarManagerStore().getById(e)}});var Pd=function(e,t,n,r){var s,i=arguments.length,o=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(i<3?s(o):i>3?s(t,n,o):s(t,n))||o);return i>3&&o&&Object.defineProperty(t,n,o),o};const $d=e=>{class t extends e{constructor(){super(...arguments),this.calendarInherited=!0}async setCalendar(e){return this.calendar=e,this.propagate()}getCalendar(){return this.calendar}*calculateCalendar(e){const t=this.getCalendarManagerStore();let n,r;if(null!=e)Bc(e)&&(e=n=t.getById(e)||null),this.calendarInherited=!1,r=e;else if(void 0===e&&this.$.calendar.hasConsistentValue()&&!this.calendarInherited)r=this.$.calendar.getConsistentValue();else{const e=this.getProject();e!==this&&(r=yield e.$.calendar,this.calendarInherited=!0)}return!Bc(r)&&(yield r.$$),r}}return Pd([Ad({serialize:e=>e.id})],t.prototype,"calendar",void 0),Pd([md("calendar")],t.prototype,"calculateCalendar",null),t},jd=e=>(class extends e{construct(e,...t){this.constructor.exposeProperties();const n={},r={};this.originalData=e=e||{};for(let s in e){const t=this.$entity.getField(s);this.getFieldDefinition(s)&&!t||"expanded"==s||"children"==s?n[s]=e[s]:r[s]=e[s]}super.construct(n,...t),Object.assign(this,r)}copy(e=null,t=!0){const n=super.copy(e);return t&&this.forEachFieldAtom((e,t)=>{n.$[t].put(e.get())}),n}}),Hd=Symbol("PartOfProjectStoreMixin"),Nd=e=>(class extends e{[Hd](){}calculateProject(){return this.project}loadData(e){super.loadData(e);const t=this.getProject();t&&t.trigger("storerefresh",{store:this})}}),zd=e=>Boolean(e&&e[Hd]),Bd=e=>(class extends e{joinStore(e){let t=!1;if(zd(e)){const n=e.getProject();!n||this.getProject()||this.isShadowed()||(this.setProject(n),t=!0)}super.joinStore(e),t&&this.joinProject()}unJoinStore(e){super.unJoinStore(e);const t=this.isShadowed()?this.shadowedProject:this.getProject();zd(e)&&t&&t===e.getProject()&&(this.leaveProject(),this.setProject(null),this.shadowedProject=null)}joinProject(){this.getGraph().addEntity(this)}leaveProject(){this.isShadowed()||this.getGraph().removeEntity(this)}shadow(){const e=this.getProject();return e&&(this.leaveProject(),this.setProject(null),this.shadowedProject=e),this}unshadow(){return this.shadowedProject&&(this.setProject(this.shadowedProject),this.shadowedProject=null,this.joinProject()),this}isShadowed(){return!!this.shadowedProject}getProject(){return this.isShadowed()?null:super.getProject()}calculateProject(){const e=this.stores.find(e=>zd(e)&&!!e.getProject());return e&&e.getProject()}afterSet(e,t,n,r,s,i){i&&this.getProject()&&this.getProject().getStm().isRestoring&&Object.keys(i).forEach(e=>{const t=this.$[e];t&&t.graph&&t.graph.markAsNeedRecalculation(t)}),super.afterSet&&super.afterSet(e,t,n,r,s,i)}});var Vd=function(e,t,n,r){var s,i=arguments.length,o=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(i<3?s(o):i>3?s(t,n,o):s(t,n))||o);return i>3&&o&&Object.defineProperty(t,n,o),o};const Wd=Symbol("ResourceMixin"),Ud=e=>{class t extends e{[Wd](){}get assignments(){return[...this.assigned]}leaveProject(){const e=this.getAssignmentStore();this.assigned.forEach(t=>e.remove(t)),super.leaveProject()}}return Vd([Ad({type:"string"})],t.prototype,"name",void 0),Vd([hd({},Rd)],t.prototype,"assigned",void 0),t},Gd=(e=Sr)=>Ud($d(Bd(_d(jd(cd(e))))));class Yd extends(Gd()){}const qd=e=>{const t=new Map;return e.filter(e=>!t.has(e)&&(t.set(e,!0),!0))};var Xd,Kd,Zd,Jd,Qd;!function(e){e.Millisecond="millisecond",e.Second="second",e.Minute="minute",e.Hour="hour",e.Day="day",e.Week="week",e.Month="month",e.Quarter="quarter",e.Year="year"}(Xd||(Xd={})),function(e){e.MustStartOn="muststarton",e.MustFinishOn="mustfinishon",e.StartNoEarlierThan="startnoearlierthan",e.StartNoLaterThan="startnolaterthan",e.FinishNoEarlierThan="finishnoearlierthan",e.FinishNoLaterThan="finishnolaterthan"}(Kd||(Kd={})),function(e){e.Normal="Normal",e.FixedDuration="FixedDuration",e.FixedEffort="FixedEffort",e.FixedUnits="FixedUnits"}(Zd||(Zd={})),function(e){e[e.StartToStart=0]="StartToStart",e[e.StartToEnd=1]="StartToEnd",e[e.EndToStart=2]="EndToStart",e[e.EndToEnd=3]="EndToEnd"}(Jd||(Jd={})),function(e){e.Project="Project",e.FromEvent="FromEvent",e.ToEvent="ToEvent"}(Qd||(Qd={}));const eu=new Date(-864e13),tu=new Date(864e13);var nu,ru;!function(e){e[e.Left=0]="Left",e[e.Right=1]="Right"}(nu||(nu={})),function(e){e[e.FullRangeIterated=0]="FullRangeIterated",e[e.StoppedByIterator=1]="StoppedByIterator",e[e.MaxCacheExtendCyclesReached=2]="MaxCacheExtendCyclesReached"}(ru||(ru={}));class su{constructor(e){this.cacheFilledStartDate=tu,this.cacheFilledEndDate=eu,this.intervalsCachingChunkDuration=30,this.intervalsCachingChunkUnit=Xd.Day,this.maxCacheExtendCycles=1e3,e&&Object.assign(this,e)}includeWrappingRangeFrom(e,t,n){e.ensureCacheFilledForInterval(t,n),this.intervalCache.includeWrappingRange(e.intervalCache,t,n)}ensureCacheFilledForInterval(e,t){const n=this.cacheFilledStartDate.getTime(),r=this.cacheFilledEndDate.getTime();if(n!==tu.getTime()){const s=e.getTime(),i=t.getTime();if(n<=s&&i<=r)return;if(i<=n)t=new Date(n-1);else if(s>=r)e=new Date(r+1);else if(n<=s&&s<=r)e=new Date(r+1);else{if(!(n<=i&&i<=r))return this.ensureCacheFilledForInterval(e,new Date(n-1)),void this.ensureCacheFilledForInterval(new Date(r+1),t);t=new Date(n-1)}}(n===tu.getTime()||e.getTime()<r)&&(this.cacheFilledStartDate=e),(r===eu.getTime()||r<t.getTime())&&(this.cacheFilledEndDate=t),this.fillCache(e,t)}fillCache(e,t){throw new Error("Abstract method")}clear(){this.cacheFilledStartDate=tu,this.cacheFilledEndDate=eu,this.intervalCache.clear()}forEachAvailabilityInterval(e,t,n){n=n||this;const r=e.startDate,s=e.endDate,i=r&&r.getTime(),o=s&&s.getTime(),a=!1!==e.isForward;if(a?!r:!s)throw new Error("At least `startDate` or `endDate` is required, depending from the `isForward` option");const l=this.intervalCache;let c=a?r:s,d=a?r:s;for(let u=1;u<this.maxCacheExtendCycles;u++){a?this.ensureCacheFilledForInterval(c,s||Ne.add(c,this.intervalsCachingChunkDuration,this.intervalsCachingChunkUnit)):this.ensureCacheFilledForInterval(r||Ne.add(c,-this.intervalsCachingChunkDuration,this.intervalsCachingChunkUnit),c);let e=l.getIntervalOf(d,a?nu.Left:nu.Right);for(;e;){const c=e.startDate,u=e.endDate;if(a&&o&&c.getTime()>=o||!a&&i&&u.getTime()<=i)return ru.FullRangeIterated;if(a&&c.getTime()>this.cacheFilledEndDate.getTime()||!a&&u.getTime()<this.cacheFilledStartDate.getTime())break;d=a?u:c;const h=i&&c.getTime()<i?r:c,g=o&&u.getTime()>o?s:u;if(!1===t.call(n,h,g,e.cacheInterval))return ru.StoppedByIterator;e=a?l.getNextInterval(e):l.getPrevInterval(e)}if(a&&d.getTime()===tu.getTime()||!a&&d.getTime()===eu.getTime())return ru.FullRangeIterated;c=a?this.cacheFilledEndDate:this.cacheFilledStartDate}return ru.MaxCacheExtendCyclesReached}}class iu{constructor(e){this.intervalGroups=[],e&&Object.assign(this,e)}combineWith(e){const t=this.intervalGroups.slice();return t.push([e.calendar,e]),new iu({intervalGroups:t})}getIsWorkingForEvery(){if(null!=this.isWorkingForEvery)return this.isWorkingForEvery;for(let[e,t]of this.getGroups())if(!t[0].isWorking)return this.isWorkingForEvery=!1;return this.isWorkingForEvery=!0}getIsWorkingForSome(){if(null!=this.isWorkingForSome)return this.isWorkingForSome;for(let[e,t]of this.getGroups())if(t[0].isWorking)return this.isWorkingForSome=!0;return this.isWorkingForSome=!1}getCalendars(){return this.getGroups(),this.calendars}isCalendarWorking(e){return this.getCalendarsWorkStatus().get(e)}getCalendarsWorkStatus(){if(this.calendarsWorkStatus)return this.calendarsWorkStatus;const e=new Map;for(let[t,n]of this.getGroups())e.set(t,n[0].isWorking);return this.calendarsWorkStatus=e}getCalendarsWorking(){if(this.calendarsWorking)return this.calendarsWorking;const e=[];for(let[t,n]of this.getGroups())n[0].isWorking&&e.push(t);return this.calendarsWorking=e}getCalendarsNonWorking(){if(this.calendarsNonWorking)return this.calendarsNonWorking;const e=[];for(let[t,n]of this.getGroups())n[0].isWorking||e.push(t);return this.calendarsNonWorking=e}getGroups(){if(this.intervalsByCalendar)return this.intervalsByCalendar;const e=this.calendars=[],t=new Map;return this.intervalGroups.forEach(([n,r])=>{let s=t.get(n);s||(e.push(n),t.set(n,s=[])),s.push.apply(s,r.intervals)}),t.forEach((e,n)=>{const r=qd(e);r.sort((e,t)=>t.getPriorityField()-e.getPriorityField()),t.set(n,r)}),this.intervalsByCalendar=t}}const ou=(e,t,n=((e,t)=>e-t))=>{let r=0,s=t.length;for(;r<s;){const i=(r+s)/2|0,o=n(e,t[i]);if(0===o)return{found:!0,index:i};o<0?s=i:r=i+1}return{found:!1,index:s}};var au,lu;!function(e){e[e.Exact=0]="Exact",e[e.Next=1]="Next"}(au||(au={}));class cu{constructor(e){this.keys=[],this.values=[],this.comparator=e||((e,t)=>e-t)}set(e,t){const n=ou(e,this.keys,this.comparator);return n.found?this.values[n.index]=t:(this.keys.splice(n.index,0,e),this.values.splice(n.index,0,t)),n.index}insertAt(e,t,n){this.keys.splice(e,0,t),this.values.splice(e,0,n)}setValueAt(e,t){this.values[e]=t}get(e){const t=ou(e,this.keys,this.comparator);return t.found?this.values[t.index]:void 0}getEntryAt(e){return e<this.keys.length?{key:this.keys[e],value:this.values[e]}:void 0}getKeyAt(e){return this.keys[e]}getValueAt(e){return this.values[e]}delete(e){const t=ou(e,this.keys,this.comparator);t.found&&this.deleteAt(t.index)}size(){return this.keys.length}deleteAt(e){this.keys.splice(e,1),this.values.splice(e,1)}indexOfKey(e){const t=ou(e,this.keys,this.comparator);return{found:t.found?au.Exact:au.Next,index:t.index}}map(e){const t=this.keys,n=this.values,r=[];for(let s=0;s<t.length;s++)r.push(e(n[s],t[s],s));return r}getAllEntries(){return this.map((e,t)=>({value:e,key:t}))}clear(){this.keys.length=0,this.values.length=0}}!function(e){e[e.Left=0]="Left",e[e.Right=1]="Right"}(lu||(lu={}));class du{constructor(e){if(this.points=new cu((e,t)=>e.getTime()-t.getTime()),this.leftInfinityKey=eu,this.rightInfinityKey=tu,Object.assign(this,e),void 0===this.emptyInterval||!this.combineIntervalsFn)throw new Error("All of `emptyPoint`, `combineIntervalsFn` are required");this.points.set(this.leftInfinityKey,this.emptyInterval)}size(){return this.points.size()}indexOf(e){return this.points.indexOfKey(e)}getDateAt(e){return this.points.getKeyAt(e)}getPointAt(e){return this.points.getValueAt(e)}getIntervalOf(e,t=lu.Left){let n,{found:r,index:s}=this.indexOf(e);return this.getIntervalWithStartDateIndex(n=t===lu.Left&&r===au.Exact?s:s-1)}getPrevInterval(e){return 0===e.startDateIndex?null:this.getIntervalWithStartDateIndex(e.startDateIndex-1)}getNextInterval(e){return e.startDateIndex>=this.size()-1?null:this.getIntervalWithStartDateIndex(e.startDateIndex+1)}getIntervalWithStartDateIndex(e){return{startDateIndex:e,startDate:this.getDateAt(e),endDate:e+1<this.size()?this.getDateAt(e+1):this.rightInfinityKey,cacheInterval:this.getPointAt(e)}}addInterval(e,t,n){const r=this.points,{found:s,index:i}=r.indexOfKey(e);let o,a;if(s==au.Exact){const e=n(a=r.getValueAt(i));r.setValueAt(i,e),o=i+1}else{const t=n(a=r.getValueAt(i-1));r.insertAt(i,e,t),o=i+1}for(;o<r.size()&&!(r.getKeyAt(o).getTime()>=t.getTime());){const e=n(a=r.getValueAt(o));r.setValueAt(o,e),o++}o===r.size()?r.insertAt(r.size(),t,this.emptyInterval):r.getKeyAt(o).getTime()===t.getTime()||r.insertAt(o,t,a)}includeWrappingRange(e,t,n){let r=e.getIntervalOf(t);for(;r&&(this.addInterval(r.startDate,r.endDate,e=>this.combineIntervalsFn(e,r.cacheInterval)),!(r.endDate.getTime()>n.getTime()));)r=e.getNextInterval(r)}getSummary(){return this.points.map((e,t)=>({label:e,date:t}))}clear(){this.points.clear(),this.points.set(this.leftInfinityKey,this.emptyInterval)}}class uu extends su{constructor(e){super(e),this.calendarCaches=qd(this.calendarCaches),this.intervalCache=new du({emptyInterval:new iu,combineIntervalsFn:(e,t)=>e.combineWith(t)})}fillCache(e,t){this.calendarCaches.forEach(n=>{n.fillCache(e,t),this.includeWrappingRangeFrom(n,e,t)})}}const hu=new Map,gu=e=>{const t=qd(e);if(0===t.length)throw new Error("No calendars to combine");t.sort((e,t)=>e.internalId<t.internalId?-1:1);const n=t.map(e=>e.internalId+"/").join(""),r=t.map(e=>e.version+"/").join("");let s,i=hu.get(n);return i&&i.versionsHash===r?s=i.cache:(s=new uu({calendarCaches:t.map(e=>e.calendarCache)}),hu.set(n,{versionsHash:r,cache:s})),s};var mu=function(e,t,n,r){var s,i=arguments.length,o=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(i<3?s(o):i>3?s(t,n,o):s(t,n))||o);return i>3&&o&&Object.defineProperty(t,n,o),o};const pu=Symbol("HasAssignments"),fu=e=>{class t extends e{constructor(){super(...arguments),this.assignmentsByCalendar=new Map}[pu](){}get assignments(){return[...this.assigned]}*hasFirstAssignment(){return(yield this.$.assigned).size>0&&!(this.$.assigned.value.size>0)}*calculateEffortDriven(e){return(yield this.$.schedulingMode)!=Zd.Normal&&(void 0!==e?e:this.$.effortDriven.getConsistentValue())}*calculateTotalUnits(){let e=0;const t=yield this.$.assigned;for(let n of t)e+=(yield n.$.units);return e}*calculateEffortByAssignments(e,t){const n=yield this.$.assignmentsByCalendar;if((yield this.$.schedulingMode)===Zd.Normal||0===n.size)return yield*this.calculateProjectedDuration(e,t);let r=0;const s=new Map;for(const[o,a]of n){let e=0;for(const t of a)e+=(yield t.$.units);s.set(o,e)}const i=Object.assign(yield*this.getBaseOptionsForEffortCalculations(),{startDate:e,endDate:t});return yield*this.forEachAvailabilityInterval(i,(e,t,n)=>{const i=n.getCalendarsWorking(),o=e.getTime(),a=t.getTime()-o;let l=0;for(const r of i)l+=s.get(r)||0;r+=l*a*.01}),yield*this.$convertDuration(r,Xd.Millisecond,yield this.$.effortUnit)}*calculateUnitsByDurationAndEffort(e,t){const n=yield this.$.effort,r=yield this.$.effortUnit,s=yield*this.$convertDuration(n,r,Xd.Millisecond);let i=0;const o=Object.assign(yield*this.getBaseOptionsForEffortCalculations(),{startDate:yield this.$.startDate,endDate:yield this.$.endDate}),a=yield this.$.assignmentsByCalendar;return yield*this.forEachAvailabilityInterval(o,(e,t,n)=>{const r=n.getCalendarsWorking(),s=e.getTime(),o=t.getTime()-s;for(const l of r)i+=(a.has(l)?a.get(l).length:0)*o}),i?100*s/i:100}getEffort(e){const t=this.effort;return void 0!==e?this.calendar.convertDuration(t,this.effortUnit,e):t}async setEffort(e,t){return null!=t&&t!==this.effortUnit&&this.$.effortUnit.put(t),this.$.effort.put(e),this.propagate()}getEffortUnit(){return this.effortUnit}setEffortUnit(e){throw new Error("Use `setEffort` instead")}async setAssignmentUnits(e,t){return e.$.units.put(t),e.propagate()}*calculateAssignmentUnits(e,t){return void 0!==t?t:(yield*this.shouldRecalculateAssignmentUnits(e))?yield*this.calculateUnitsByDurationAndEffort(e,t):e.$.units.value}*calculateEffort(e){if((yield this.$.childEvents).size)return yield*this.calculateTotalEffort();if(void 0!==e)return e;if(yield*this.shouldRecalculateEffort()){const e=yield this.$.startDate;if(e){const t=yield*this.calculateProjectedEndDate(e);return yield*this.calculateEffortByAssignments(e,t)}return null}return this.$.effort.value}*canRecalculateDuration(){return(yield this.$.schedulingMode)===Zd.Normal?yield*super.canRecalculateDuration():this.$.effort.hasProposedValue()||this.$.effort.hasConsistentValue()}*shouldRecalculateEffort(){return(yield this.$.childEvents).size>0||!this.$.effort.hasConsistentValue()&&(yield*this.canRecalculateEffort())}*canRecalculateEffort(){return!!(yield this.$.childEvents).size||this.$.duration.hasValue()}*shouldRecalculateAssignmentUnits(e){return!1}*calculateTotalEffort(){const e=yield this.$.childEvents;let t=0;for(const n of e)t+=(yield n.$.effort);return t}*forEachAvailabilityInterval(e,t){const n=yield this.$.calendar,r=yield this.$.assignmentsByCalendar;(yield this.$.effectiveCalendarsCombination).forEachAvailabilityInterval(e,(s,i,o)=>{const a=o.getCalendarsWorkStatus(),l=o.getCalendarsWorking();if(a.get(n)&&(e.ignoreResourceCalendars||l.some(e=>r.has(e))))return t(s,i,o)})}*getBaseOptionsForEffortCalculations(){return{ignoreResourceCalendars:!1}}*getBaseOptionsForDurationCalculations(){return{ignoreResourceCalendars:!1}}*skipNonWorkingTime(e,t=!0){if((yield this.$.assignmentsByCalendar).size>0){const n=Object.assign(yield*this.getBaseOptionsForDurationCalculations(),t?{startDate:e,isForward:t}:{endDate:e,isForward:t});let r;return yield*this.forEachAvailabilityInterval(n,(e,n,s)=>(r=t?e:n,!1)),new Date(r)}return yield*super.skipNonWorkingTime(e,t)}*calculateDurationBetweenDates(e,t,n){if((yield this.$.assignmentsByCalendar).size>0){const r=Object.assign(yield*this.getBaseOptionsForDurationCalculations(),{startDate:e,endDate:t,isForward:!0});let s=0;return yield*this.forEachAvailabilityInterval(r,(e,t)=>{s+=t.getTime()-e.getTime()}),yield*this.$convertDuration(s,Xd.Millisecond,n)}return yield*super.calculateDurationBetweenDates(e,t,n)}*calculateEffectiveCalendarsCombination(){const e=[...(yield this.$.assignmentsByCalendar).keys(),yield this.$.calendar];return gu(e)}*calculateAssignmentsByCalendar(){const e=yield this.$.assigned,t=new Map;for(const n of e){const e=yield n.$.resource;if(e){const r=yield e.$.calendar;let s=t.get(r);s||t.set(r,s=[]),s.push(n)}}return t}*calculateProjectedXDateByDuration(e,t=!0){const n=yield this.$.duration;if(null==n||isNaN(n))return null;if(0==n)return e;const r=yield this.$.durationUnit,s=yield*this.$convertDuration(n,r,Xd.Millisecond);let i=e.getTime(),o=s;const a=yield this.$.calendar;if((yield this.$.assignmentsByCalendar).size>0){const n=Object.assign(yield*this.getBaseOptionsForDurationCalculations(),t?{startDate:e,isForward:t}:{endDate:e,isForward:t});return yield*this.forEachAvailabilityInterval(n,(e,n,r)=>{const s=e.getTime(),a=n.getTime(),l=a-s;if(l>=o)return i=t?s+o:a-o,!1;{const t=e.getTimezoneOffset()-n.getTimezoneOffset();o-=l+60*t*1e3}}),new Date(i)}return a.accumulateWorkingTime(e,s,Xd.Millisecond,t).finalDate}*calculateProjectedXDateByEffort(e,t=!0){const n=yield this.$.effort,r=yield this.$.effortUnit,s=yield*this.$convertDuration(n,r,Xd.Millisecond);let i=e.getTime(),o=s;const a=yield this.$.calendar,l=yield this.$.assignmentsByCalendar,c=new Map;for(const[d,u]of l){let e=0;for(const t of u)e+=(yield t.$.units);c.set(d,e)}if(l.size>0){const n=Object.assign(yield*this.getBaseOptionsForDurationCalculations(),t?{startDate:e,isForward:t}:{endDate:e,isForward:t});return yield*this.forEachAvailabilityInterval(n,(e,n,r)=>{const s=r.getCalendarsWorking(),a=e.getTime(),l=n.getTime(),d=l-a;let u=0;for(const t of s)u+=c.get(t)||0;const h=u*d*.01;if(h>=o)return i=t?a+o/(.01*u):l-o/(.01*u),!1;o-=h}),new Date(i)}return a.accumulateWorkingTime(e,s,Xd.Millisecond,t).finalDate}*doCalculateDuration(){const e=yield this.$.assignmentsByCalendar,t=yield this.$.schedulingMode;return 0!==(yield this.$.childEvents).size||t!==Zd.Normal&&0!==e.size||this.$.duration.hasValue()||!this.$.effort.hasValue()?yield*super.doCalculateDuration():yield*this.$convertDuration(yield this.$.effort,yield this.$.effortUnit,yield this.$.durationUnit)}*calculateProjectedDuration(e,t){const n=yield this.$.assignmentsByCalendar;if((yield this.$.schedulingMode)===Zd.Normal||0===n.size)return yield*super.calculateProjectedDuration(e,t);const r=yield this.$.effort,s=yield this.$.effortUnit,i=yield*this.$convertDuration(r,s,Xd.Millisecond);let o=0,a=i;const l=new Map;for(const[c,d]of n){let e=0;for(const t of d)e+=(yield t.$.units);l.set(c,e)}return Object.assign(yield*this.getBaseOptionsForDurationCalculations(),{startDate:e,endDate:t}),yield*this.forEachAvailabilityInterval({startDate:e,endDate:t},(e,t,n)=>{const r=n.getCalendarsWorking(),s=e.getTime(),i=t.getTime()-s;let c=0;for(const o of r)c+=l.get(o)||0;const d=c*i*.01;if(d>=a)return o+=a/(.01*c),!1;a-=d,o+=i}),yield*this.$convertDuration(o,Xd.Millisecond,yield this.$.durationUnit)}*canCalculateProjectedXDate(){const e=yield*this.useDurationForProjectedXDateCalculation(),t=yield*this.shouldRecalculateDuration();return e&&!t&&(this.$.duration.hasProposedValue()||this.$.duration.hasConsistentValue())}*useDurationForProjectedXDateCalculation(){const e=yield this.$.schedulingMode,t=yield this.$.assignmentsByCalendar;return e===Zd.Normal||0===t.size||this.$.duration.hasProposedValue()&&this.$.duration.hasConsistentValue()}*useDurationForProjectedStartDateCalculation(){return yield*this.useDurationForProjectedXDateCalculation()}*useDurationForProjectedEndDateCalculation(){return yield*this.useDurationForProjectedXDateCalculation()}*calculateProjectedStartDate(e){return(yield*this.useDurationForProjectedStartDateCalculation())?yield*this.calculateProjectedXDateByDuration(e,!1):yield*this.calculateProjectedXDateByEffort(e,!1)}*calculateProjectedEndDate(e){return(yield*this.useDurationForProjectedEndDateCalculation())?yield*this.calculateProjectedXDateByDuration(e,!0):yield*this.calculateProjectedXDateByEffort(e,!0)}getAssignmentFor(e){let t;return this.assigned.forEach(n=>{n.resource===e&&(t=n)}),t}isAssignedTo(e){return Boolean(this.getAssignmentFor(e))}reassign(e,t){const n=this.getAssignmentFor(e);this.removeAssignment(n);const r=this.getProject().assignmentStore.modelClass;return this.addAssignment(new r({event:this,resource:t})),this.propagate()}async assign(e,t=100){const n=this.getProject().assignmentStore.modelClass;return this.addAssignment(new n({event:this,resource:e,units:t})),this.propagate()}async unassign(e){const t=this.getAssignmentFor(e);return this.removeAssignment(t),this.propagate()}addAssignment(e){return this.getProject().assignmentStore.add(e),e}removeAssignment(e){return this.getProject().assignmentStore.remove(e),e}leaveProject(){const e=this.getAssignmentStore();this.assigned.forEach(t=>e.remove(t)),super.leaveProject()}}return mu([Ad({type:"number",allowNull:!0})],t.prototype,"effort",void 0),mu([Ad({type:"string",defaultValue:Xd.Hour},{converter:Ne.normalizeUnit})],t.prototype,"effortUnit",void 0),mu([Ad({type:"boolean",defaultValue:!1})],t.prototype,"effortDriven",void 0),mu([hd({},Rd)],t.prototype,"assigned",void 0),mu([gd()],t.prototype,"effectiveCalendarsCombination",void 0),mu([gd()],t.prototype,"assignmentsByCalendar",void 0),mu([md("effortDriven")],t.prototype,"calculateEffortDriven",null),mu([md("effort")],t.prototype,"calculateEffort",null),mu([md("effectiveCalendarsCombination")],t.prototype,"calculateEffectiveCalendarsCombination",null),mu([md("assignmentsByCalendar")],t.prototype,"calculateAssignmentsByCalendar",null),t},vu=function(){class e extends Sr{static get fields(){return[{name:"assignment",type:"object"},{name:"resource",type:"object"},{name:"event",type:"object"},{name:"units",type:"number",defaultValue:0}]}get name(){return this.resource?this.resource.name:""}get assigned(){return this.firstStore.projectEvent===this.event}set assigned(e){this.set(e?{event:this.firstStore.projectEvent,units:100}:{event:null,units:0})}}return e._$name="AssignmentsManipulationModel",e}(),{defineParser:yu,alt:bu,seq:Cu,string:wu,regexp:Su,succeed:Du,red:Eu,isSuccess:xu}=io,Tu=yu(Eu(Su("[^\\[\\,]+"),e=>({name:e.trim(),units:100,match:e}))),Ru=yu(Eu(Su("[0-9\\s]+"),e=>({value:e.split(/\s*/).join(""),match:e}))),ku=yu(Eu(bu(wu("."),wu(",")),e=>({value:e,match:e}))),Mu=yu(bu(Eu(Cu(()=>Ru,()=>ku,()=>Ru),(e,t,n)=>({value:Number(`${e.value}.${n.value}`),match:[e.match,t.match,n.match].join("")})),Eu(Cu(()=>ku,()=>Ru),(e,t)=>({value:Number(`0.${t.value}`),match:[e.match,t.match].join("")})),Eu(()=>Ru,e=>({value:Number(`${e.value}`),match:e.match})))),Iu=yu(bu(Eu(Cu(()=>Mu,Su("\\s*\\%")),(e,t)=>({value:e.value,match:[e.match,t].join("")})),Eu(()=>Mu,e=>({value:e.value,match:e.match})))),Au=yu(Eu(Cu(Su("\\s*\\[\\s*"),()=>Iu,Su("\\s*\\]")),(e,t,n)=>({units:t.value,match:[e,t.match,n].join("")}))),Fu=yu(Eu(Su("\\s*,\\s*"),e=>({value:e,match:e}))),Ou=yu(bu(Cu(()=>Tu,()=>Au,bu(Cu(()=>Fu,()=>Ou),Du(""))),Cu(()=>Tu,bu(Cu(()=>Fu,()=>Ou),Du(""))))),Lu=e=>{let t=!1,n=[],r="";Ou(e,e=>{if(xu(e)){const[,s,i]=e;s.length>n.length&&(n=s,r=i,t=!0)}});let s=0;return!!t&&{rest:r,assignments:n.reduce((e,t)=>{let n;return"object"==typeof t&&(t.hasOwnProperty("name")?(n=Object.assign({position:s},t),e.push(n)):(n=e[e.length-1],t.hasOwnProperty("units")&&(n.units=t.units),n.match+=t.match),s+=t.match.length),e},[])}},_u=(e,t=!1)=>{let n="";return e.assignments&&(n+=e.assignments.reduce((e,{name:n,units:r,match:s})=>e+=s&&t?s:(e.length?", ":"")+`${n} [${r}%]`,n)),e.rest&&(n+=e.rest),t||(n=n.trim()),n};var Pu={parse:Lu,compose:_u,normalize:e=>_u(Lu(e))};const{compose:$u}=Pu,ju=function(){class e extends Nr{static get defaultConfig(){return{modelClass:vu,storeId:"assignmentsmanipulation",storage:{extraKeys:["resource"]},callOnFunctions:!0,projectEvent:null,floatAssignedResources:!0,liveFloatAssignedResources:!1}}afterConfigure(){super.afterConfigure(),this.addSorter({fn:this.defaultSort.bind(this)})}get projectEvent(){return this._projectEvent}set projectEvent(e){e!=this._projectEvent&&(this._projectEvent=e,e?this.fillFromMaster():this.removeAll())}get floatAssignedResources(){return this._floatAssignedResources}set floatAssignedResources(e){e!==this.floatAssignedResources&&(this._floatAssignedResources=e,this.sort())}get assignmentStore(){return this.projectEvent&&this.projectEvent.getAssignmentStore()||null}get resourceStore(){return this.projectEvent&&this.projectEvent.getResourceStore()||null}get areAllAssigned(){return this._lastAllAssigned}get areNoneAssigned(){return this._lastNoneAssigned}get areSomeAssigned(){return this._lastSomeAssigned}updateAllNoneSomeAssignedFlags(){const e=this,{projectEvent:t,allRecords:n}=e,r=e._lastAllAssigned,s=e._lastNoneAssigned,i=e._lastSomeAssigned;e._lastAllAssigned=n.every(e=>e.event===t),e._lastNoneAssigned=n.every(e=>null==e.event),e._lastSomeAssigned=!e._lastAllAssigned&&!e._lastNoneAssigned,void 0!==r&&e._lastAllAssigned!==r&&e._lastAllAssigned&&e.trigger("allAssigned"),void 0!==s&&e._lastNoneAssigned!==s&&e._lastNoneAssigned&&e.trigger("noneAssigned"),void 0!==i&&e._lastSomeAssigned!==i&&e._lastSomeAssigned&&e.trigger("someAssigned")}fillFromMaster(){const e=this,t=e.projectEvent;if(t){const n=e.resourceStore,r=new Map(Array.from(t.assignments).reduce((e,t)=>(e.push([t.resource,t]),e),[]));e.data=n.map(n=>{const s=r.get(n);return new e.modelClass({assignment:s,event:s?t:null,resource:n,units:s&&s.units||0})}),e.floatAssignedResources&&e.sort()}}set valueCollection(e){this._valueCollection!==e&&(this._valueCollection=e,e.splice(0,e.count,this.activeAssignments),e.on({change:"onValueCollectionChange",thisObj:this}))}get valueCollection(){return this._valueCollection||(this.valueCollection=new cn),this._valueCollection}onValueCollectionChange({removed:e}){e&&e.length&&e.forEach(e=>e.assigned=!1)}async applyChanges(){const e=this,{projectEvent:t,assignmentStore:n,changes:r}=e,s=[],i=[];let o;if(r&&r.modified){r.modified.forEach(e=>{if(e.event===t){const t=e.assignment;t?t.$.units.put(e.units):s.push({resource:e.resource,event:e.event,units:e.units})}else i.push(e.assignment)}),e.commit(),i.length&&n.remove(i),s.length&&n.add(s);const a=t.project.replica,l=a.projectRefreshThreshold;a.projectRefreshThreshold=0,o=await t.propagate(),a.projectRefreshThreshold=l,n.trigger("refresh",{action:"dataset"}),o===Wc.Completed&&(e.floatAssignedResources&&e.sort(),e.trigger("changesApplied"))}else o=Wc.Complete;return o}getResourceAssignment(e){return this.storage.getBy("resource",e)}assignResource(e,t=100){this.getResourceAssignment(e).set({event:this.projectEvent,units:t})}unassignResource(e){this.storage.getBy("resource",e).set({event:null,units:0})}assignAllResources(e=100,t=!1){const n=this.projectEvent;this.beginBatch(),this.forEach(r=>{r.event=n,r.units&&!t||(r.units=e)}),this.endBatch()}unassignAllResources(){this.beginBatch(),this.forEach(e=>{e.event=null,e.units=0}),this.endBatch()}findMostMatchingResourceByName(e){}get activeAssignments(){const e=this.projectEvent;return this.query(t=>t.event===e)}toValueString(){const{activeAssignments:e}=this;return $u({rest:"",assignments:e})}fromValueString(e){}proposeStringValues(e,t=Number.MAX_VALUE){}defaultSort(e,t){return this.floatAssignedResources?!t.event&&e.event?-1:!e.event&&t.event?1:e.name.localeCompare(t.name):e.name.localeCompare(t.name)}onRefresh(){const e=this;e.isConfiguring||(e.updateAllNoneSomeAssignedFlags(),e.valueCollection.splice(0,e.valueCollection.count,e.activeAssignments))}onUpdate({changes:e}){const t=this;t.isConfiguring||(e.hasOwnProperty("event")&&(t.updateAllNoneSomeAssignedFlags(),t.floatAssignedResources&&t.liveFloatAssignedResources&&t.sort()),t.valueCollection.splice(0,t.valueCollection.count,t.activeAssignments))}onRemoveAll(){this.isConfiguring||(this.updateAllNoneSomeAssignedFlags(),this.valueCollection.clear())}}return e._$name="AssignmentsManipulationStore",e}(),Hu=function(){class e extends oa{static get type(){return"assignmentgrid"}static get defaultConfig(){return{columns:[{field:"assigned",type:mo.type,width:50,sortable:!1,align:"center",cls:"b-assignmentgrid-assign-all-column",headerRenderer:e=>e.column.grid.renderCheckColumnHeader(e),filterable:!1},{cls:"b-assignmentgrid-resource-column",field:"resourceId",flex:1,editor:null,renderer:e=>e.grid.renderResourceName(e),filterable:{filterField:{placeholder:this.L("Name"),triggers:{filter:{align:"start",cls:"b-icon b-icon-filter"}}},filterFn:({value:e,record:t})=>-1!==t.name.toLowerCase().indexOf(e.toLowerCase())},sortable:(e,t)=>e.name<t.name?-1:e.name>t.name?1:0},{field:"units",type:fo.type,text:this.L("Units"),width:70,min:0,max:100,step:10,unit:this.L("%"),renderer:e=>e.grid.renderUnits(e),filterable:!1}],features:{group:!1,filterBar:!0,contextMenu:!1},disableGridRowModelWarning:!0,projectEvent:null}}doDestroy(){const e=this,t=e.checkAllColumnCheckbox;t&&(t.destroy(),e.checkAllColumnCheckBox=null),e._assignmentGridStoreDetacher&&(e._assignmentGridStoreDetacher(),e._assignmentGridStoreDetacher=null),super.doDestroy()}get projectEvent(){const e=this.store;let t=this._projectEvent;return e&&t!==e.projectEvent&&(t=this._projectEvent=e.projectEvent),t}set projectEvent(e){const t=this.store;this._projectEvent=e,t&&(t.projectEvent=e)}get store(){return super.store}set store(e){const t=this;t.store!==e&&(t._assignmentGridStoreDetacher&&(t._assignmentGridStoreDetacher(),t._assignmentGridStoreDetacher=null),e instanceof ju||(e=new ju(Object.assign({projectEvent:t.projectEvent},e))),t._assignmentGridStoreDetacher=e.on({allAssigned:t.onStoreAllAssigned,noneAssigned:t.onStoreNoneAssigned,someAssigned:t.onStoreSomeAssigned},t),super.store=e)}get checkAllColumnCheckBox(){const e=this.columns.find(e=>"check"===e.type&&"assigned"===e.field);return e&&e.element&&e.element.widget}set checkAllColumnCheckBox(e){const t=this.columns.find(e=>"check"===e.type&&"assigned"===e.field);t&&t.element&&(t.element.widget=e)}renderCheckColumnHeader(e){const{column:t,headerElement:n}=e,r=t.grid;n.widget||(n.widget=I.append({type:"checkbox",cls:t.checkCls,readOnly:r.readOnly,owner:r,onChange:r.onHeaderCheckboxChange.bind(r),checked:r.store.isAllAssigned,value:"all"},n)[0]),n.widget.checked=r.store.isAllAssigned}renderResourceName({record:e}){return e.name}renderUnits({value:e}){return this.L("unitsTpl",{value:e})}onHeaderCheckboxChange({checked:e}){this._skipHeaderCheckboxEvent||(e?this.store.assignAllResources():this.store.unassignAllResources())}onStoreAllAssigned(){const e=this.checkAllColumnCheckBox;e&&(this._skipHeaderCheckboxEvent=!0,e.checked=!0,this._skipHeaderCheckboxEvent=!1)}onStoreNoneAssigned(){const e=this.checkAllColumnCheckBox;e&&(this._skipHeaderCheckboxEvent=!0,e.checked=!1,this._skipHeaderCheckboxEvent=!1)}onStoreSomeAssigned(){const e=this.checkAllColumnCheckBox;e&&(this._skipHeaderCheckboxEvent=!0,e.checked=!1,this._skipHeaderCheckboxEvent=!1)}}return e._$name="AssignmentGrid",e}();E.register(Hu.type,Hu);const Nu=function(){class e extends Bn{static get type(){return"assignmentpicker"}static get defaultConfig(){return{grid:null,focusable:!0,trapFocus:!0,height:"20em",minWidth:"25em",items:[{ref:"grid",type:Hu.type}],bbar:[{type:"button",text:this.L("Save"),ref:"saveBtn",color:"b-green"},{type:"button",text:this.L("Cancel"),ref:"cancelBtn",color:"b-gray"}],projectEvent:null,store:null}}afterConfigure(){const e=this;super.afterConfigure(),e.bbar.widgetMap.saveBtn.on("click",e.onSaveClick,e),e.bbar.widgetMap.cancelBtn.on("click",e.onCancelClick,e)}get focusElement(){return this.element.querySelector("input[type=text]")}get grid(){return this.isConfiguring?this._grid:this.widgetMap.grid}set grid(e){this._grid=e}createWidget(e){if(e&&"grid"===e.ref){const t=E.getClass(e.type).defaultConfig;let n=this.grid;n&&(n.columns&&(e.columns=[...t.columns,...n.columns],delete(n=Object.assign({},n)).columns),We.merge(e,n)),e.projectEvent=this.projectEvent,e.store=this.store}return super.createWidget(e)}onSaveClick(){this.store.applyChanges(),this.hide()}onCancelClick(){this.store.fillFromMaster(),this.hide()}}return e._$name="AssignmentPicker",e}();E.register(Nu.type,Nu);const zu=function(){class e extends Zr{static type(){return"assignmentfield"}static get defaultConfig(){return{chipView:{cls:"b-assignment-chipview",itemTpl:(e,t)=>`${e.name} ${e.units}%`},triggers:{expand:{cls:"b-icon-down",handler:"onTriggerClick"}},multiSelect:!0,clearable:!1,editable:!1,value:null,pickerWidth:null,projectEvent:null,store:null}}onChipClose(e){this.onTriggerClick();for(let t=0,n=e.length;t<n;t++)this.store.findRecord("resource",e[t].resource).set({event:null,units:0})}syncInputFieldValue(){super.syncInputFieldValue(),this.store&&(this.tooltip=this.store.toValueString())}onTriggerClick(e){this.pickerVisible?this.hidePicker():Br.prototype.showPicker.call(this,e&&"key"in e)}focusPicker(){this.picker.focus()}get picker(){const e=this;return e._picker instanceof Nu||(e._picker=I.createWidget(Object.assign({type:Nu.type,projectEvent:e.projectEvent,store:e.store,readOnly:e.readOnly,owner:e,forElement:e[e.pickerAlignElement],floating:!0,scrollAction:"realign",align:{align:"t0-b0",axisLock:!0,anchor:e.overlayAnchor,target:e[e.pickerAlignElement]}},e._picker))),e._picker}set picker(e){const t=this;e!=t._picker&&(t._picker&&t._picker.destroy(),t._picker=e,e instanceof Nu&&(t.store=e.store,t.projectEvent=e.projectEvent))}get projectEvent(){return this._projectEvent}set projectEvent(e){const t=this;e!=t._projectEvent&&(t._projectEvent=e,t.store.projectEvent=e,t._picker&&(t._picker.projectEvent=e))}get store(){return this._store||(this.store={}),this._store}set store(e){const t=this;e!=t._store&&(e instanceof ju?(t._store=e,t.projectEvent=e.projectEvent):e&&(t._store=new ju(Object.assign({valueCollection:t.valueCollection},e)),t._store.projectEvent=t.projectEvent))}get value(){}set value(e){}onPickerKeyDown(e){const t=this.picker.grid;"ArrowDown"===e.key&&e.target.compareDocumentPosition(t.bodyContainer)===document.DOCUMENT_POSITION_FOLLOWING&&t.element.focus()}}return e._$name="AssignmentField",e}();E.register(zu.type,zu),uo.registerColumnType(function(){class e extends co{static get type(){return"resourceassignment"}static get isGanttColumn(){return!0}static get defaults(){return{field:"assignments",instantUpdate:!1,text:"Assigned Resources",width:250,cellCls:"b-resourceassignment-cell"}}afterConstruct(){const e=this;super.afterConstruct(),e.grid.on({startCellEdit:e.onStartCellEdit,finishCellEdit:e.onDoneCellEdit,cancelCellEdit:e.onDoneCellEdit,thisObj:e})}doDestroy(){super.doDestroy(),this._editorStoreDetacher&&(this._editorStoreDetacher(),this._editorStoreDetacher=null)}get defaultEditor(){return{type:zu.type}}onStartCellEdit({editorContext:{record:e,column:t}}){const n=this;t===n&&(n.editor.projectEvent=e,n._editorStoreDetacher&&(n._editorStoreDetacher(),n._editorStoreDetacher=null),n._editorStoreDetacher=n.editor.store.on("changesApplied",n.onEditorChangesApplied,n))}onDoneCellEdit(){this._editorStoreDetacher&&(this._editorStoreDetacher(),this._editorStoreDetacher=null)}onEditorChangesApplied(){const e=this,t=e.grid.getCell({id:e.editor.projectEvent.id,columnId:e.id});t&&e.renderer({value:e.editor.projectEvent.assignments,cellElement:t})}get chipView(){return this._chipView||(this._chipView=new Gr({cls:"b-assignment-chipview",itemsFocusable:!1,closable:!1,itemTpl:this.itemTpl,store:{}}),Object.defineProperty(this.chipView,"isVisible",{get:()=>!0})),this._chipView}itemTpl(e,t){return`${e.resourceName} ${e.units}%`}renderer({cellElement:e,value:t}){const{chipView:n}=this;n.store.storage.replaceValues(t.reduce((e,t)=>(t.resource&&e.push(t),e),[]).sort((e,t)=>e.resourceName.localeCompare(t.resourceName)),!0),n.refresh();const r=n.element.cloneNode(!0);r.removeAttribute("id"),e.innerHTML='<div class="b-assignment-chipview-wrap"></di>',e.firstElementChild.appendChild(r)}}return e._$name="ResourceAssignmentColumn",e}());const Bu=function(){class e extends Zr{static get type(){return"schedulingmodecombo"}buildStoreData(){return[{id:Zd.Normal,text:this.L("Normal")},{id:Zd.FixedDuration,text:this.L("Fixed Duration")},{id:Zd.FixedUnits,text:this.L("Fixed Units")},{id:Zd.FixedEffort,text:this.L("Fixed Effort")}]}get store(){return this._store||(this.store=new Nr({data:this.buildStoreData()})),this._store}set store(e){super.store=e}updateLocalization(){super.updateLocalization(),this.store.data=this.buildStoreData()}}return e._$name="SchedulingModePicker",e}();E.register(Bu.type,Bu),uo.registerColumnType(function(){class e extends co{static get type(){return"schedulingmodecolumn"}static get isGanttColumn(){return!0}static get defaults(){return{field:"schedulingMode",text:"Scheduling Mode",editor:{type:Bu.type,allowInvalid:!1,picker:{minWidth:"8.5em"}}}}afterConstruct(){super.afterConstruct(),At.createSequence(this.editor.updateLocalization,this.onEditorLocaleChange,this)}renderer({value:e}){const t=this.editor.store.getById(e);return t&&t.text||""}onEditorLocaleChange(){this.grid.refreshColumn(this)}}return e._$name="SchedulingModeColumn",e}()),uo.registerColumnType(function(){class e extends co{static get type(){return"sequence"}static get isGanttColumn(){return!0}static get defaults(){return{field:"sequenceNumber",text:"Sequence",sortable:!1,groupable:!1,filterable:!1,width:70,editor:null}}}return e._$name="SequenceColumn",e}()),uo.registerColumnType(function(){class e extends uc{static get type(){return"startdate"}static get isGanttColumn(){return!0}static get defaults(){return{field:"startDate",text:"Start"}}}return e._$name="StartDateColumn",e}()),uo.registerColumnType(function(){class e extends wc{static get type(){return"successor"}static get isGanttColumn(){return!0}static get defaults(){return{text:"Successors",field:"successors"}}}return e._$name="SuccessorColumn",e}()),uo.registerColumnType(function(){class e extends gc{static get type(){return"totalslack"}static get isGanttColumn(){return!0}get durationUnitField(){return"slackUnit"}static get defaults(){return{field:"totalSlack",text:"Total Slack"}}canEdit(e){return!1}}return e._$name="TotalSlackColumn",e}()),uo.registerColumnType(function(){class e extends co{static get type(){return"wbs"}static get isGanttColumn(){return!0}static get defaults(){return{field:"wbsCode",text:"WBS",width:70,editor:null}}}return e._$name="WBSColumn",e}()),uo.registerColumnType(function(){class e extends mo{static get type(){return"eventmode"}static get isGanttColumn(){return!0}static get defaults(){return{field:"manuallyScheduled",align:"left",text:"Event mode"}}constructor(e,t){super(...arguments),this.internalCellCls="b-eventmode-cell"}renderer({value:e,cellElement:t}){super.renderer(...arguments),t.widget&&(t.widget.text=this.renderText(e))}onCheckboxChange({source:e,checked:t}){super.onCheckboxChange(...arguments),e.text=this.renderText(t)}renderText(e){return this.L(e?"Manual":"Auto")}}return e._$name="EventModeColumn",e}());var Vu=function(e,t,n,r){var s,i=arguments.length,o=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(i<3?s(o):i>3?s(t,n,o):s(t,n))||o);return i>3&&o&&Object.defineProperty(t,n,o),o};const Wu=Symbol("AssignmentMixin"),Uu=e=>{class t extends e{[Wu](){}getUnits(){return this.units}setUnits(e){return this.event.setAssignmentUnits(this,e)}*calculateUnits(e){const t=yield this.$.event;return t?yield*t.calculateAssignmentUnits(this,e):void 0!==e?e:this.$.units.getConsistentValue()}}return Vu([Ad({type:"number",defaultValue:100})],t.prototype,"units",void 0),Vu([hd({bucket:"assigned",resolver:function(e){return this.getEventById(e)},modelFieldConfig:{serialize:e=>e.id}},Td)],t.prototype,"event",void 0),Vu([hd({bucket:"assigned",resolver:function(e){return this.getResourceById(e)},modelFieldConfig:{serialize:e=>e.id}},Td)],t.prototype,"resource",void 0),Vu([md("units")],t.prototype,"calculateUnits",null),t},Gu=(e=Sr)=>Uu(Bd(_d(jd(cd(e)))));class Yu extends(Gu()){}var qu=e=>(class extends(e||W){static get relationConfig(){return[]}get taskStore(){return this.getEventStore()}get eventStore(){return this.getEventStore()}set eventStore(e){const t=this.getEventStore();if(t&&e!==t)throw new Error("Setting the event store directly is no longer supported. Please set it on the project instance instead")}set taskStore(e){const t=this.getEventStore();if(t&&e!==t)throw new Error("Setting the event store directly is no longer supported. Please set it on the project instance instead")}get dependencyStore(){return this.getDependencyStore()}get assignmentStore(){return this.getAssignmentStore()}get resourceStore(){return this.getResourceStore()}get calendarManagerStore(){return this.getCalendarManagerStore()}});const Xu=function(){class e extends(qu(Gu(ma))){static get fields(){return[]}static get relationConfig(){return[]}get units(){return Math.max(0,this.get("units"))}set units(e){if(e<0)throw new Error("`Units` value for an assignment can't be less than 0");this.set("units",e)}get task(){return this.event}set task(e){this.event=e}get taskName(){return this.task&&this.task.name||""}get eventId(){return this.event.id}get resourceId(){return this.resource.id}}return e._$name="AssignmentModel",e}(),Ku=e=>(class extends e{}),Zu=(e=Nr)=>(e=>(class extends e{static get defaultConfig(){return{modelClass:Yu}}}))(Nd(_d(Ku(e))));class Ju extends(Zu()){}const Qu=function(){class e extends(qu(Zu(pa))){static get defaultConfig(){return{modelClass:Xu,loadPriority:500,syncPriority:400,storeId:"assignments"}}mapAssignmentsForTask(e,t,n){return this.mapAssignmentsForEvent(e,t,n)}getAssignmentsForTask(e){return this.getAssignmentsForEvent(e)}removeAssignmentsForTask(e){return this.removeAssignmentsForEvent(e)}getResourcesForTask(e){return this.getResourcesForEvent(e)}getTasksForResource(e){return this.getEventsForResource(e)}assignTaskToResource(e,t,n){return this.assignEventToResource(e,t,e=>(e.units=n,e))}unassignTaskFromResource(e,t){return this.unassignEventFromResource(e,t)}isTaskAssignedToResource(e,t,n){return this.isEventAssignedToResource(e,t,n)}getAssignmentForTaskAndResource(e,t){return this.getAssignmentForEventAndResource(e,t)}}return e._$name="AssignmentStore",e}();var eh=function(e,t,n,r){var s,i=arguments.length,o=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(i<3?s(o):i>3?s(t,n,o):s(t,n))||o);return i>3&&o&&Object.defineProperty(t,n,o),o};const th=Symbol("hasMixin"),nh=e=>{class t extends e{[th](){}*calculateSelf(){return yield this.$.lag,yield this.$.lagUnit,yield this.$.type,this}*calculateCalendar(){let e;switch(yield this.getProject().$.dependenciesCalendar){case Qd.Project:e=yield this.getProject().$.calendar;break;case Qd.FromEvent:const t=yield this.$.fromEvent;e=t&&!Bc(t)?yield t.$.calendar:null;break;case Qd.ToEvent:const n=yield this.$.toEvent;e=n&&!Bc(n)?yield n.$.calendar:null}return e||(e=yield this.getProject().$.calendar),yield e.$$,e}async setLag(e,t=this.lagUnit){return this.$.lag.put(e),this.$.lagUnit.put(t),this.propagate()}}return eh([hd({bucket:"outgoingDeps",resolver:function(e){return this.getEventById(e)},modelFieldConfig:{persist:!0,serialize:e=>e.id}},Td)],t.prototype,"fromEvent",void 0),eh([hd({bucket:"incomingDeps",resolver:function(e){return this.getEventById(e)},modelFieldConfig:{persist:!0,serialize:e=>e.id}},Td)],t.prototype,"toEvent",void 0),eh([Ad({type:"number",defaultValue:0})],t.prototype,"lag",void 0),eh([Ad({type:"string",defaultValue:Xd.Day},{converter:Ne.normalizeUnit})],t.prototype,"lagUnit",void 0),eh([Ad({type:"string",defaultValue:Jd.EndToStart})],t.prototype,"type",void 0),eh([gd()],t.prototype,"calendar",void 0),eh([md("calendar")],t.prototype,"calculateCalendar",null),t},rh=(e=Sr)=>nh(Bd(_d(jd(cd(e)))));class sh extends(rh()){}const ih=["SS","SF","FS","FF"],oh=function(){class e extends(rh(Ma)){static get relationConfig(){return[]}constructor(...e){const[t]=e;t&&t.fromTask&&(t.fromEvent=t.fromTask),t&&t.toTask&&(t.toEvent=t.toTask),super(...e)}set sourceTask(e){this.fromEvent=e}get sourceTask(){return this.fromEvent}get sourceEvent(){return this.fromEvent}get from(){return this.fromEvent.id}get fromTask(){return this.fromEvent}set fromTask(e){this.fromEvent=e}getFromTask(){return this.getFromEvent()}setFromTask(...e){return this.setFromEvent(...e)}set targetTask(e){this.toEvent=e}get to(){return this.toEvent.id}get targetTask(){return this.toEvent}get targetEvent(){return this.toEvent}get toTask(){return this.toEvent}set toTask(e){this.toEvent=e}getToTask(){return this.getToEvent()}setToTask(...e){return this.setToEvent(...e)}getTypeFromSides(e,t,n){const r=Ma.Type,s=n?"right":"left";return e===s?t===s?r.StartToStart:r.StartToEnd:t===(n?"left":"right")?r.EndToEnd:r.EndToStart}getConnectorString(e){const t=ih[this.type];if(e)return t;if(this.type===Ma.Type.EndToStart)return"";const n=he.locale;if(n){const e=n.GanttCommon&&n.GanttCommon[t];if(e)return e}return t}}return e._$name="DependencyModel",e}(),ah=Symbol("DependencyValidationMixin"),lh=e=>(class extends e{[ah](){}async isValidDependency(e,t,n){const r=this,s=r.getProject();if(await s.waitForPropagateCompleted(),!(e=>Boolean(e&&e[th]))(e)){const s=r.getEventStore();e=new(0,r.getDependencyStore().modelClass)("object"==typeof e?e:{fromEvent:s.getById(e),toEvent:s.getById(t),type:n})}const i=e.getProject();e.setProject(s);let o=await s.tryPropagateWithEntities(async e=>e instanceof kc?Dc.Cancel:Dc.Resume,[e]);return e.setProject(i),o==Wc.Passed}}),ch=(e=Nr)=>(e=>(class extends e{}))(lh((e=>(class extends e{static get defaultConfig(){return{modelClass:sh}}}))(Nd(_d(Ku(e))))));class dh extends(ch()){}const uh=function(){class e extends(qu(ch(Aa))){static get defaultConfig(){return Object.assign(super.defaultConfig,{modelClass:oh,loadPriority:300,syncPriority:500})}reduceTaskDependencies(e,t,n,r,s){return this.reduceEventDependencies(e,t,n,r,s)}reduceTaskPredecessors(e,t,n,r){return this.reduceEventPredecessors(e,t,n,r)}reduceTaskSuccessors(e,t,n,r){return this.reduceEventSuccessors(e,t,n,r)}mapTaskDependencies(e,t,n,r,s){return this.mapEventDependencies(e,t,n,r,s)}mapTaskPredecessors(e,t,n,r){return this.mapEventPredecessors(e,t,n,r)}mapTaskSuccessors(e,t,n,r){return this.mapEventSuccessors(e,t,n,r)}getTaskDependencies(e,t){return this.getEventDependencies(e,t)}getTaskPredecessors(e,t){return this.getEventPredecessors(e,t)}getTaskSuccessors(e,t){return this.getEventSuccessors(e,t)}removeTaskDependencies(e,t){this.removeEventDependencies(e,t)}removeTaskPredecessors(e,t){this.removeEventPredecessors(e,t)}removeTaskSuccessors(e,t){this.removeEventSuccessors(e,t)}getDependencyForSourceAndTargetTasks(e,t){return this.getDependencyForSourceAndTargetEvents(e,t)}getTasksLinkingDependency(e,t){return this.getEventsLinkingDependency(e,t)}getTaskById(e){const t=this.taskStore;return t&&t.getById(e)||null}getSourceTask(e){return this.getTaskById(e instanceof oh?e.sourceId:e)}getTargetTask(e){return this.getTaskById(e instanceof oh?e.targetId:e)}}return e._$name="DependencyStore",e}(),hh=function(){class e extends(qu(Gd(wa))){static get fields(){return[]}get tasks(){return this.events}}return e._$name="ResourceModel",e}(),gh=(e=Nr)=>(e=>(class extends e{static get defaultConfig(){return{modelClass:Yd}}}))(Nd(_d(Ku(e))));class mh extends(gh()){}const ph=function(){class e extends(qu(gh(Sa))){static get defaultConfig(){return{modelClass:hh,loadPriority:400,syncPriority:200,storeId:"resources"}}}return e._$name="ResourceStore",e}();class fh extends xc{}class vh extends Sc{getDescription(){throw new Error("Abstract method")}resolve(){throw new Error("Abstract method")}}class yh extends Sc{initialize(...e){super.initialize(...e),this.startDate||(this.startDate=eu),this.endDate||(this.endDate=tu)}startDateIsFinite(){return!this.isIntervalEmpty()&&this.startDate.getTime()!==eu.getTime()}endDateIsFinite(){return!this.isIntervalEmpty()&&this.endDate.getTime()!==tu.getTime()}containsDate(e,t=nu.Left){return t===nu.Left&&e>=this.startDate&&e<this.endDate||t===nu.Right&&e>this.startDate&&e<=this.endDate}isIntervalEmpty(){return this.startDate>this.endDate}intersect(e){const t=e.startDate,n=e.endDate,r=this.startDate,s=this.endDate;if(s<t||r>n)return bh;const i=new Date(Math.max(r.getTime(),t.getTime())),o=new Date(Math.min(s.getTime(),n.getTime()));return this.constructor.new({startDate:i,endDate:o})}}const bh=yh.new({startDate:tu,endDate:eu}),Ch=e=>e.reduce((e,t)=>e.intersect(t),yh.new());var wh=function(e,t,n,r){var s,i=arguments.length,o=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(i<3?s(o):i>3?s(t,n,o):s(t,n))||o);return i>3&&o&&Object.defineProperty(t,n,o),o};class Sh extends yh{toString(){return`from ${this.startDate} till ${this.endDate}`}}class Dh extends vh{get originDescription(){return this.interval.originDescription}resolve(){if(!this.interval)throw new Error("Can't use this resolution option - no constraint interval available");if(!this.interval.onRemoveAction)throw new Error("Can't use this resolution option - no `onRemoveAction` available");this.interval.onRemoveAction()}}class Eh extends fh{get description(){return`The change causes scheduling conflict with the constraining interval ${this.conflictingInterval},\nwhich is created by the ${this.conflictingInterval.originDescription}`}get resolutions(){const e=[];return this.conflictingInterval.onRemoveAction&&e.push(Dh.new({interval:this.conflictingInterval})),Object.defineProperty(this,"resolutions",{value:e}),e}}class xh extends Eh{get description(){return`The date ${this.proposedDate} is outside of the constraining interval ${this.conflictingInterval},\nwhich is created by the ${this.conflictingInterval.originDescription}`}}const Th=e=>{class t extends e{async setManuallyScheduled(e){return this.$.manuallyScheduled.put(e),this.propagate()}*validateProposedStartDate(e){if(e){const t=yield*this.skipNonWorkingTime(e,!0),n=yield this.$.combinedStartDateConstraintIntervals;let r=yh.new();for(let e of n)(r=r.intersect(e)).containsDate(t)||(yield xh.new({proposedDate:t,conflictingInterval:e}))}}*validateProposedEndDate(e){if(e){const t=yield*this.skipNonWorkingTime(e,!1),n=yield this.$.combinedEndDateConstraintIntervals;let r=yh.new();for(let e of n)(r=r.intersect(e)).containsDate(t)||(yield xh.new({proposedDate:t,conflictingInterval:e}))}}*calculateEarlyStartDateRaw(){const e=this.getProject(),t=yield e.$.startDate,n=(yield this.$.validInitialIntervals).startDateInterval;return n.startDateIsFinite()?n.startDate:t}*calculateEarlyStartDate(){const e=yield this.$.earlyStartDateRaw;return yield*this.maybeSkipNonWorkingTime(e,!0)}*calculateEarlyEndDateRaw(){const e=this.getProject(),t=yield e.$.startDate,n=(yield this.$.validInitialIntervals).endDateInterval,r=yield*this.canCalculateProjectedXDate();let s=null;return n.startDateIsFinite()?s=n.startDate:t&&r&&(s=yield*this.calculateProjectedEndDate(t)),s}*calculateEarlyEndDate(){const e=yield this.$.earlyEndDateRaw;return yield*this.maybeSkipNonWorkingTime(e,!1)}*calculateLateStartDateRaw(){const e=this.getProject(),t=yield e.$.endDate,n=(yield this.$.validInitialIntervals).startDateInterval,r=yield*this.canCalculateProjectedXDate();let s=null;return n.endDateIsFinite()?s=n.endDate:t&&r&&(s=yield*this.calculateProjectedStartDate(t)),s}*calculateLateStartDate(){const e=yield this.$.lateStartDateRaw;return yield*this.maybeSkipNonWorkingTime(e,!0)}*calculateLateEndDateRaw(){const e=this.getProject(),t=yield e.$.endDate,n=(yield this.$.validInitialIntervals).endDateInterval;return n.endDateIsFinite()?n.endDate:t}*calculateLateEndDate(){const e=yield this.$.lateEndDateRaw;return yield*this.maybeSkipNonWorkingTime(e,!1)}*calculateTotalSlack(){const e=yield this.$.earlyStartDateRaw,t=yield this.$.lateStartDateRaw,n=yield this.$.earlyEndDateRaw,r=yield this.$.lateEndDateRaw,s=yield this.$.slackUnit;let i,o;return(e&&t||n&&r)&&(e&&t?(o=yield*this.calculateDurationBetweenDates(e,t,s),n&&r&&(i=yield*this.calculateDurationBetweenDates(n,r,s))<o&&(o=i)):n&&r&&(o=yield*this.calculateDurationBetweenDates(n,r,s))),o}*calculateCritical(){return(yield this.$.totalSlack)<=0}*calculateStartDateInitial(){const e=this.$.startDate.proposedValue;return(yield this.$.manuallyScheduled)?yield*super.calculateStartDateInitial():(yield this.$.combinedStartDateConstraintIntervals,yield this.$.combinedEndDateConstraintIntervals,this.$.duration.hasConsistentValue()||this.$.duration.hasProposedValue()||!e?null===e?null:(yield*this.validateProposedStartDate(e),(yield this.$.earlyStartDateRaw)||(yield*super.calculateStartDateInitial())):e)}*calculateEndDateInitial(){const e=this.$.endDate.proposedValue;return(yield this.$.manuallyScheduled)?yield*super.calculateEndDateInitial():(yield this.$.combinedStartDateConstraintIntervals,yield this.$.combinedEndDateConstraintIntervals,this.$.duration.hasConsistentValue()||this.$.duration.hasProposedValue()||!e?null===e?null:(yield*this.validateProposedEndDate(e),(yield this.$.earlyEndDateRaw)||(yield*super.calculateEndDateInitial())):e)}*validateIntervalsIntersection(e){let t=yh.new();for(let n of e)(t=t.intersect(n)).isIntervalEmpty()&&(yield Eh.new({conflictingInterval:n}));return t}*calculateStartDateIntervalsByEndDateIntervals(e){let t=[];for(let n of e)t.push(Sh.new({onRemoveAction:n.onRemoveAction,originDescription:n.originDescription,startDate:n.startDateIsFinite()?yield*this.calculateProjectedStartDate(n.startDate):null,endDate:n.endDateIsFinite()?yield*this.calculateProjectedStartDate(n.endDate):null}));return t}*calculateEndDateIntervalsByStartDateIntervals(e){let t=[];for(let n of e)t.push(Sh.new({onRemoveAction:n.onRemoveAction,originDescription:n.originDescription,startDate:n.startDateIsFinite()?yield*this.calculateProjectedEndDate(n.startDate):null,endDate:n.endDateIsFinite()?yield*this.calculateProjectedEndDate(n.endDate):null}));return t}*canCalculateProjectedXDate(){return!(yield*this.shouldRecalculateDuration())}*calculateValidInitialIntervals(){const e=yield this.$.combinedStartDateConstraintIntervals,t=yield this.$.combinedEndDateConstraintIntervals;let n=Ch(e),r=Ch(t);if(!(yield*this.canCalculateProjectedXDate())&&!n.isIntervalEmpty()&&!r.isIntervalEmpty())return{startDateInterval:n,endDateInterval:r};const s=yh.new({startDate:r.startDateIsFinite()?yield*this.calculateProjectedStartDate(r.startDate):null,endDate:r.endDateIsFinite()?yield*this.calculateProjectedStartDate(r.endDate):null});if((n=n.intersect(s)).isIntervalEmpty()){const n=yield*this.calculateStartDateIntervalsByEndDateIntervals(t);let r;r=e.length>1?e.slice(0,e.length-1).concat(n).concat(e[e.length-1]):e.concat(n),yield*this.validateIntervalsIntersection(r)}else{const e=yh.new({startDate:n.startDateIsFinite()?yield*this.calculateProjectedEndDate(n.startDate):null,endDate:n.endDateIsFinite()?yield*this.calculateProjectedEndDate(n.endDate):null});r=r.intersect(e)}return{startDateInterval:n,endDateInterval:r}}*calculateStartDateConstraintIntervals(){return[]}*calculateCombinedStartDateConstraintIntervals(){return(yield this.$.startDateConstraintIntervals).concat(yield this.$.earlyStartDateConstraintIntervals)}*calculateEarlyStartDateConstraintIntervals(){return[]}*calculateLateStartDateConstraintIntervals(){return[]}*calculateEndDateConstraintIntervals(){return[]}*calculateCombinedEndDateConstraintIntervals(){return(yield this.$.endDateConstraintIntervals).concat(yield this.$.earlyEndDateConstraintIntervals)}*calculateEarlyEndDateConstraintIntervals(){return[]}*calculateLateEndDateConstraintIntervals(){return[]}putEndDate(e,t=!1){this.markAsNeedRecalculation(this.$.validInitialIntervals),super.putEndDate(e,t)}}return wh([gd()],t.prototype,"earlyStartDateRaw",void 0),wh([Ad({type:"date",dateFormat:"YYYY-MM-DDTHH:mm:ssZ",persist:!1},{converter:Ld,persistent:!1})],t.prototype,"earlyStartDate",void 0),wh([gd()],t.prototype,"earlyEndDateRaw",void 0),wh([Ad({type:"date",dateFormat:"YYYY-MM-DDTHH:mm:ssZ",persist:!1},{converter:Ld,persistent:!1})],t.prototype,"earlyEndDate",void 0),wh([gd()],t.prototype,"lateStartDateRaw",void 0),wh([Ad({type:"date",dateFormat:"YYYY-MM-DDTHH:mm:ssZ",persist:!1},{converter:Ld,persistent:!1})],t.prototype,"lateStartDate",void 0),wh([gd()],t.prototype,"lateEndDateRaw",void 0),wh([Ad({type:"date",dateFormat:"YYYY-MM-DDTHH:mm:ssZ",persist:!1},{converter:Ld,persistent:!1})],t.prototype,"lateEndDate",void 0),wh([Ad({type:"number",persist:!1},{persistent:!1})],t.prototype,"totalSlack",void 0),wh([Ad({type:"string",defaultValue:Xd.Day,persist:!1},{converter:Ne.normalizeUnit,persistent:!1})],t.prototype,"slackUnit",void 0),wh([Ad({type:"boolean",defaultValue:!1,persist:!1},{persistent:!1})],t.prototype,"critical",void 0),wh([Ad({type:"boolean",defaultValue:!1})],t.prototype,"manuallyScheduled",void 0),wh([gd()],t.prototype,"startDateConstraintIntervals",void 0),wh([gd()],t.prototype,"earlyStartDateConstraintIntervals",void 0),wh([gd()],t.prototype,"lateStartDateConstraintIntervals",void 0),wh([gd()],t.prototype,"combinedStartDateConstraintIntervals",void 0),wh([gd()],t.prototype,"endDateConstraintIntervals",void 0),wh([gd()],t.prototype,"earlyEndDateConstraintIntervals",void 0),wh([gd()],t.prototype,"lateEndDateConstraintIntervals",void 0),wh([gd()],t.prototype,"combinedEndDateConstraintIntervals",void 0),wh([gd()],t.prototype,"validInitialIntervals",void 0),wh([md("earlyStartDateRaw")],t.prototype,"calculateEarlyStartDateRaw",null),wh([md("earlyStartDate")],t.prototype,"calculateEarlyStartDate",null),wh([md("earlyEndDateRaw")],t.prototype,"calculateEarlyEndDateRaw",null),wh([md("earlyEndDate")],t.prototype,"calculateEarlyEndDate",null),wh([md("lateStartDateRaw")],t.prototype,"calculateLateStartDateRaw",null),wh([md("lateStartDate")],t.prototype,"calculateLateStartDate",null),wh([md("lateEndDateRaw")],t.prototype,"calculateLateEndDateRaw",null),wh([md("lateEndDate")],t.prototype,"calculateLateEndDate",null),wh([md("totalSlack")],t.prototype,"calculateTotalSlack",null),wh([md("critical")],t.prototype,"calculateCritical",null),wh([md("validInitialIntervals")],t.prototype,"calculateValidInitialIntervals",null),wh([md("startDateConstraintIntervals")],t.prototype,"calculateStartDateConstraintIntervals",null),wh([md("combinedStartDateConstraintIntervals")],t.prototype,"calculateCombinedStartDateConstraintIntervals",null),wh([md("earlyStartDateConstraintIntervals")],t.prototype,"calculateEarlyStartDateConstraintIntervals",null),wh([md("lateStartDateConstraintIntervals")],t.prototype,"calculateLateStartDateConstraintIntervals",null),wh([md("endDateConstraintIntervals")],t.prototype,"calculateEndDateConstraintIntervals",null),wh([md("combinedEndDateConstraintIntervals")],t.prototype,"calculateCombinedEndDateConstraintIntervals",null),wh([md("earlyEndDateConstraintIntervals")],t.prototype,"calculateEarlyEndDateConstraintIntervals",null),wh([md("lateEndDateConstraintIntervals")],t.prototype,"calculateLateEndDateConstraintIntervals",null),t};var Rh=function(e,t,n,r){var s,i=arguments.length,o=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(i<3?s(o):i>3?s(t,n,o):s(t,n))||o);return i>3&&o&&Object.defineProperty(t,n,o),o};const kh=Symbol("EventMixin"),Mh=e=>{class t extends e{[kh](){}*calculateSchedulingMode(e){return(void 0!==e?e:this.$.schedulingMode.getConsistentValue())||Zd.Normal}*maybeSkipNonWorkingTime(e,t=!0){let n=!0;return(yield*this.shouldRecalculateDuration())||(n=(yield this.$.duration)>0),e&&n?yield*this.skipNonWorkingTime(e,t):e}*skipNonWorkingTime(e,t=!0){return(yield this.$.calendar).skipNonWorkingTime(e,t)}*calculateDurationBetweenDates(e,t,n){return(yield this.$.calendar).calculateDuration(e,t,n)}convertDuration(e,t,n){return this.getProject().calendar.convertDuration(e,t,n)}*$convertDuration(e,t,n){const r=this.getProject();return(yield r.$.calendar).convertDuration(e,t,n)}*calculateStartDateInitial(){const e=this.$.startDate.proposedValue;return void 0!==e?e:(yield*this.shouldRecalculateStartDate())?yield*this.calculateProjectedStartDate(yield this.$.endDate):this.$.startDate.getConsistentValue()}*canRecalculateStartDate(){return(this.$.endDate.hasProposedValue()||this.$.endDate.hasConsistentValue())&&(this.$.duration.hasProposedValue()||this.$.duration.hasConsistentValue())}*shouldRecalculateStartDate(){return(!this.$.startDate.value||this.$.endDate.proposedArgs&&!0===this.$.endDate.proposedArgs[1]||this.$.duration.proposedArgs&&!1===this.$.duration.proposedArgs[1])&&(yield*this.canRecalculateStartDate())}*calculateStartDate(e){const t=yield this.$.startDateInitial;return yield*this.maybeSkipNonWorkingTime(t)}*calculateProjectedStartDate(e){const t=yield this.$.calendar,n=yield this.$.duration,r=yield this.$.durationUnit,s=yield*this.$convertDuration(n,r,Xd.Millisecond);return t.calculateStartDate(e,s,Xd.Millisecond)}*calculateEndDateInitial(){const e=this.$.endDate.proposedValue;return void 0!==e?e:(yield*this.shouldRecalculateEndDate())?yield*this.calculateProjectedEndDate(yield this.$.startDate):this.$.endDate.getConsistentValue()}*canRecalculateEndDate(){return(this.$.startDate.hasProposedValue()||this.$.startDate.hasConsistentValue())&&(this.$.duration.hasProposedValue()||this.$.duration.hasConsistentValue()||(yield*this.canRecalculateDuration()))}*shouldRecalculateEndDate(){return(!this.$.endDate.hasConsistentValue()||this.$.startDate.hasProposedValue()&&!0===this.$.startDate.proposedArgs[1]||this.$.duration.hasProposedValue()&&!0===this.$.duration.proposedArgs[1]||!this.$.startDate.hasProposedValue()&&!this.$.endDate.hasProposedValue()&&!this.$.duration.hasProposedValue()&&this.$.startDate.hasConsistentValue()&&this.$.endDate.hasConsistentValue()&&this.$.duration.hasConsistentValue())&&(yield*this.canRecalculateEndDate())}*calculateEndDate(e){const t=yield this.$.endDateInitial;let n=yield*this.maybeSkipNonWorkingTime(t,!1);if(this.$.startDateInitial.hasNextStableValue()){const e=yield this.$.startDateInitial;n instanceof Date&&n<e&&(n=e)}return n}*calculateProjectedEndDate(e){const t=yield this.$.calendar,n=yield this.$.duration,r=yield this.$.durationUnit,s=yield*this.$convertDuration(n,r,Xd.Millisecond);return t.calculateEndDate(e,s,Xd.Millisecond)}*calculateDuration(e){return void 0!==e?e:(yield*this.shouldRecalculateDuration())?yield*this.doCalculateDuration():this.$.duration.getConsistentValue()}*doCalculateDuration(){const e=yield this.$.startDate,t=yield this.$.endDate;return yield*this.calculateProjectedDuration(e,t)}*calculateProjectedDuration(e,t){if(!e||!t||e>t)return null;const n=yield this.$.calendar,r=yield this.$.durationUnit;return yield*this.$convertDuration(n.calculateDuration(e,t,Xd.Millisecond),Xd.Millisecond,r)}*canRecalculateDuration(){return(this.$.startDate.hasProposedValue()||this.$.startDate.hasConsistentValue())&&(this.$.endDate.hasProposedValue()||this.$.endDate.hasConsistentValue())}*shouldRecalculateDuration(){return(!this.$.duration.hasConsistentValue()&&(!this.$.startDate.getProposedValue()||!this.$.endDate.getProposedValue()||null==this.$.duration.getProposedValue()||this.$.startDate.hasConsistentValue()||this.$.endDate.hasConsistentValue())||this.$.startDate.proposedArgs&&!1===this.$.startDate.proposedArgs[1]||this.$.endDate.proposedArgs&&!1===this.$.endDate.proposedArgs[1])&&(yield*this.canRecalculateDuration())}getStartDate(){return this.startDate}async setStartDate(e,t=!0){return this.$.startDate.put(e,t=null!==e&&t),this.markAsNeedRecalculation(this.$.startDateInitial),this.markAsNeedRecalculation(t?this.$.endDateInitial:this.$.duration),this.propagate()}getEndDate(){return this.endDate}putEndDate(e,t=!1){t=null!==e&&t;const n=this.getStartDate();!t&&e&&n&&n.getTime()===e.getTime()?this.putDuration(0):(t||!e||!n||n<=e)&&(this.$.endDate.put(e,t),this.markAsNeedRecalculation(this.$.endDateInitial),this.markAsNeedRecalculation(t?this.$.startDateInitial:this.$.duration))}async setEndDate(e,t=!1){return this.putEndDate(e,t),this.propagate()}getDuration(e){let t=this.duration;return e&&(t=this.convertDuration(t,this.durationUnit,e)),t}putDuration(e,t,n=!0){n=!(!this.$.startDate.hasProposedValue()&&!this.$.startDate.hasConsistentValue())&&n,null!=t&&t!==this.durationUnit&&this.$.durationUnit.put(t),this.$.duration.put(e,n),this.markAsNeedRecalculation(n?this.$.endDateInitial:this.$.startDateInitial)}async setDuration(e,t,n=!0){return this.putDuration(e,t,n),this.propagate()}getDurationUnit(){return this.durationUnit}setDurationUnit(e){throw new Error("Use `setDuration` instead")}toString(){return`Event ${this.id}`}}return Rh([Ad({type:"date",dateFormat:"YYYY-MM-DDTHH:mm:ssZ",persist:!1},{converter:Ld,persistent:!1})],t.prototype,"startDateInitial",void 0),Rh([Ad({type:"date",dateFormat:"YYYY-MM-DDTHH:mm:ssZ"},{converter:Ld})],t.prototype,"startDate",void 0),Rh([Ad({type:"date",dateFormat:"YYYY-MM-DDTHH:mm:ssZ",persist:!1},{converter:Ld,persistent:!1})],t.prototype,"endDateInitial",void 0),Rh([Ad({type:"date",dateFormat:"YYYY-MM-DDTHH:mm:ssZ"},{converter:Ld})],t.prototype,"endDate",void 0),Rh([Ad({type:"number",allowNull:!0})],t.prototype,"duration",void 0),Rh([Ad({type:"string",defaultValue:Xd.Day},{converter:Ne.normalizeUnit})],t.prototype,"durationUnit",void 0),Rh([Ad({type:"string",defaultValue:Zd.Normal})],t.prototype,"schedulingMode",void 0),Rh([md("schedulingMode")],t.prototype,"calculateSchedulingMode",null),Rh([md("startDateInitial")],t.prototype,"calculateStartDateInitial",null),Rh([md("startDate")],t.prototype,"calculateStartDate",null),Rh([md("endDateInitial")],t.prototype,"calculateEndDateInitial",null),Rh([md("endDate")],t.prototype,"calculateEndDate",null),Rh([md("duration")],t.prototype,"calculateDuration",null),t},Ih=e=>(class extends e{*shouldRecalculateDuration(){const e=yield this.$.schedulingMode,t=yield this.$.assigned;return e===Zd.FixedDuration&&t.size?null==this.$.duration.value:yield*super.shouldRecalculateDuration()}*shouldRecalculateEffort(){const e=yield this.$.schedulingMode,t=yield this.$.assigned;return e===Zd.FixedDuration&&t.size?null==this.$.effort.value||!(yield*this.shouldRecalculateDuration())&&!(yield*this.shouldRecalculateAssignmentUnits(null)):yield*super.shouldRecalculateEffort()}*shouldRecalculateAssignmentUnits(e){return(yield this.$.schedulingMode)===Zd.FixedDuration?(yield this.$.effortDriven)?!(!this.$.effort.hasProposedValue()&&!this.$.duration.hasProposedValue())||(this.$.assigned.newRefs.size>0||this.$.assigned.oldRefs.size>0)&&null!=this.$.effort.value:this.$.effort.hasProposedValue():yield*super.shouldRecalculateAssignmentUnits(e)}async setEffort(e,t){return this.schedulingMode===Zd.FixedDuration&&this.assigned.forEach(e=>{this.markAsNeedRecalculation(e.$.units)}),super.setEffort(e,t)}async setDuration(e,t){return this.schedulingMode===Zd.FixedDuration&&this.effortDriven&&this.assigned.forEach(e=>{this.markAsNeedRecalculation(e.$.units)}),super.setDuration(e,t)}async setAssignmentUnits(e,t){return this.schedulingMode===Zd.FixedDuration?(e.$.units.put(t),e.markAsNeedRecalculation(e.event.$.effort),e.propagate()):super.setAssignmentUnits(e,t)}addAssignment(e){return this.schedulingMode===Zd.FixedDuration&&this.effortDriven&&(e.$.units.clearUserInput(),this.assigned.forEach(e=>{this.markAsNeedRecalculation(e.$.units),e.$.units.clearUserInput()})),super.addAssignment(e)}removeAssignment(e){return this.schedulingMode===Zd.FixedDuration&&this.effortDriven&&(e.$.units.clearUserInput(),this.assigned.forEach(e=>{this.markAsNeedRecalculation(e.$.units),e.$.units.clearUserInput()})),super.removeAssignment(e)}*useDurationForProjectedXDateCalculation(){return(yield this.$.schedulingMode)===Zd.FixedDuration||(yield*super.useDurationForProjectedXDateCalculation())}*getBaseOptionsForDurationCalculations(){return(yield this.$.schedulingMode)===Zd.FixedDuration?{ignoreResourceCalendars:!0}:yield*super.getBaseOptionsForDurationCalculations()}}),Ah=e=>(class extends e{*calculateEffortDriven(e){return(yield this.$.schedulingMode)===Zd.FixedEffort||(yield*super.calculateEffortDriven(e))}*shouldRecalculateDuration(){const e=yield this.$.schedulingMode,t=yield this.$.assigned;return e===Zd.FixedEffort&&t.size>0?!(yield*this.shouldRecalculateEffort()):yield*super.shouldRecalculateDuration()}*shouldRecalculateEffort(){return(yield this.$.schedulingMode)===Zd.FixedEffort?null==this.$.effort.value:yield*super.shouldRecalculateEffort()}async setAssignmentUnits(e,t){return this.schedulingMode===Zd.FixedEffort?(e.$.units.put(t),e.markAsNeedRecalculation(e.event.$.duration),e.propagate()):super.setAssignmentUnits(e,t)}*shouldRecalculateAssignmentUnits(e){return this.schedulingMode===Zd.FixedEffort?!!this.$.duration.hasProposedValue():yield*super.shouldRecalculateAssignmentUnits(e)}async setDuration(e,t,...n){return this.schedulingMode===Zd.FixedEffort&&this.assigned.forEach(e=>{this.markAsNeedRecalculation(e.$.units),e.$.units.clearUserInput()}),super.setDuration(e,t,...n)}addAssignment(e){return this.schedulingMode===Zd.FixedEffort&&this.markAsNeedRecalculation(this.$.duration),super.addAssignment(e)}removeAssignment(e){return this.schedulingMode===Zd.FixedEffort&&this.assigned.size>1&&this.markAsNeedRecalculation(this.$.duration),super.removeAssignment(e)}}),Fh=e=>(class extends e{*shouldRecalculateDuration(){const e=yield this.$.schedulingMode,t=yield this.$.assigned;return e===Zd.FixedUnits&&t.size>0?null==this.$.duration.value||!!this.$.effort.hasProposedValue()||!(yield*this.shouldRecalculateEffort()):yield*super.shouldRecalculateDuration()}*shouldRecalculateEffort(){const e=yield this.$.schedulingMode,t=yield this.$.assigned;return e===Zd.FixedUnits&&t.size>0?!(null!=this.$.effort.value||!(yield*this.canRecalculateEffort()))||!!this.$.duration.hasProposedValue()||!(yield this.$.effortDriven):yield*super.shouldRecalculateEffort()}addAssignment(e){return this.schedulingMode===Zd.FixedUnits&&this.markAsNeedRecalculation(this.effortDriven?this.$.duration:this.$.effort),super.addAssignment(e)}removeAssignment(e){return this.schedulingMode===Zd.FixedUnits&&this.markAsNeedRecalculation(this.effortDriven?this.$.duration:this.$.effort),super.removeAssignment(e)}async setEffort(e,t){return this.schedulingMode===Zd.FixedUnits&&this.markAsNeedRecalculation(this.$.duration),super.setEffort(e,t)}async setDuration(e,t,...n){return this.schedulingMode===Zd.FixedUnits&&this.markAsNeedRecalculation(this.$.effort),super.setDuration(e,t,...n)}*useDurationForProjectedXDateCalculation(){const e=yield this.$.schedulingMode,t=yield this.$.assigned;return e===Zd.FixedUnits&&t.size>0?(!(yield this.$.effortDriven)||!this.$.effort.hasValue()||this.$.duration.hasProposedValue())&&(!this.$.effort.hasProposedValue()||!this.$.effort.hasConsistentValue()):yield*super.useDurationForProjectedXDateCalculation()}});var Oh=function(e,t,n,r){var s,i=arguments.length,o=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(i<3?s(o):i>3?s(t,n,o):s(t,n))||o);return i>3&&o&&Object.defineProperty(t,n,o),o};const Lh=e=>{class t extends e{*shouldRecalculateStartDate(){return 0===(yield this.$.childEvents).size&&(yield*super.shouldRecalculateStartDate())}*shouldRecalculateEndDate(){return 0===(yield this.$.childEvents).size&&(yield*super.shouldRecalculateEndDate())}*shouldRecalculateDuration(){return 0!==(yield this.$.childEvents).size||(yield*super.shouldRecalculateDuration())}*calculateEarlyStartDateRaw(){const e=yield this.$.childEvents;let t;if(e.size){t=tu;for(let n of e){const e=yield n.$.earlyStartDateRaw;e&&e<t&&(t=e)}t=t.getTime()-tu.getTime()?t:null}else t=yield*super.calculateEarlyStartDateRaw();return t}*calculateEarlyEndDateRaw(){const e=yield this.$.childEvents;let t;if(e.size){t=eu;for(let n of e){const e=yield n.$.earlyEndDateRaw;e&&e>t&&(t=e)}t=t.getTime()-eu.getTime()?t:null}else t=yield*super.calculateEarlyEndDateRaw();return t}*calculateLateStartDateRaw(){const e=yield this.$.childEvents;let t;if(e.size){t=tu;for(let n of e){const e=yield n.$.lateStartDateRaw;e&&e<t&&(t=e)}t=t.getTime()-tu.getTime()?t:null}else t=yield*super.calculateLateStartDateRaw();return t}*calculateLateEndDateRaw(){const e=yield this.$.childEvents;let t;if(e.size){t=eu;for(let n of e){const e=yield n.$.lateEndDateRaw;e&&e>t&&(t=e)}t=t.getTime()-eu.getTime()?t:null}else t=yield*super.calculateLateEndDateRaw();return t}*calculateStartDateConstraintIntervals(){const e=yield*super.calculateStartDateConstraintIntervals(),t=yield this.$.parentEvent;if(t){const n=yield t.$.startDateConstraintIntervals;e.push.apply(e,n)}return e}*calculateEndDateConstraintIntervals(){const e=yield*super.calculateEndDateConstraintIntervals(),t=yield this.$.parentEvent;if(t){const n=yield t.$.endDateConstraintIntervals;e.push.apply(e,n)}return e}*calculateEarlyStartDateConstraintIntervals(){const e=yield*super.calculateEarlyStartDateConstraintIntervals(),t=yield this.$.parentEvent;if(t){const n=yield t.$.earlyStartDateConstraintIntervals;e.push.apply(e,n)}return e}*calculateEarlyEndDateConstraintIntervals(){const e=yield*super.calculateEarlyEndDateConstraintIntervals(),t=yield this.$.parentEvent;if(t){const n=yield t.$.earlyEndDateConstraintIntervals;e.push.apply(e,n)}return e}*calculateLateStartDateConstraintIntervals(){const e=yield*super.calculateLateStartDateConstraintIntervals(),t=yield this.$.parentEvent;if(t){const n=yield t.$.lateStartDateConstraintIntervals;e.push.apply(e,n)}return e}*calculateLateEndDateConstraintIntervals(){const e=yield*super.calculateLateEndDateConstraintIntervals(),t=yield this.$.parentEvent;if(t){const n=yield t.$.lateEndDateConstraintIntervals;e.push.apply(e,n)}return e}*calculateStartDate(e){return 0===(yield this.$.childEvents).size?yield*super.calculateStartDate(e):yield*this.calculateMinChildrenStartDate()}*calculateEndDate(e){return 0===(yield this.$.childEvents).size?yield*super.calculateEndDate(e):yield*this.calculateMaxChildrenEndDate()}*calculateDuration(e){const t=yield this.$.childEvents;return yield*super.calculateDuration(0===t.size?e:void 0)}*calculateMinChildrenStartDate(){const e=yield this.$.childEvents,t=[];for(let r of e)t.push(yield r.$.startDate);let n=t.reduce((e,t)=>t?Math.min(e,t.getTime()):e,tu.getTime());return n===eu.getTime()||n===tu.getTime()?null:new Date(n)}*calculateMaxChildrenEndDate(){const e=yield this.$.childEvents,t=[];for(let r of e)t.push(yield r.$.endDate);let n=t.reduce((e,t)=>t?Math.max(e,t.getTime()):e,eu.getTime());return n===eu.getTime()||n===tu.getTime()?null:new Date(n)}*calculateInitialMinChildrenStartDateDeep(){const e=yield this.$.childEvents;if(!e.size)return this.startDate;const t=[];for(let r of e){const e=yield*r.calculateInitialMinChildrenStartDateDeep();e&&t.push(e)}let n=t.reduce((e,t)=>Math.min(e,t.getTime()),tu.getTime());return n===eu.getTime()||n===tu.getTime()?null:new Date(n)}get parent(){return this._parent}set parent(e){this._parent=e,this.$.parentEvent.put(e)}}return Oh([Cd({bucket:"childEvents"})],t.prototype,"parentEvent",void 0),Oh([bd()],t.prototype,"childEvents",void 0),t};var _h=function(e,t,n,r){var s,i=arguments.length,o=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(i<3?s(o):i>3?s(t,n,o):s(t,n))||o);return i>3&&o&&Object.defineProperty(t,n,o),o};const Ph=e=>{class t extends e{*calculateConstraintType(e){let t=null;if(void 0!==e&&(yield*this.isConstraintTypeApplicable(e)))t=e;else{const e=this.$.constraintType.getConsistentValue();(yield*this.isConstraintTypeApplicable(e))&&(t=e)}return t}getStartDatePinConstraintType(){return this.isTaskPinnableWithConstraint()&&Kd.StartNoEarlierThan||null}getEndDatePinConstraintType(){return this.isTaskPinnableWithConstraint()&&Kd.FinishNoEarlierThan||null}isTaskPinnableWithConstraint(){let e=!1;if(!this.manuallyScheduled){const t=this.constraintType;if(t)switch(t){case Kd.StartNoEarlierThan:case Kd.FinishNoEarlierThan:e=!0}else e=!0}return e}async setStartDate(e,t=!0){const n=this.getStartDatePinConstraintType();return n&&(this.$.constraintType.put(n),this.$.constraintDate.put(e)),super.setStartDate(e,t)}async setEndDate(e,t=!1){if(t){const t=this.getEndDatePinConstraintType();t&&(this.$.constraintType.put(t),this.$.constraintDate.put(e))}return super.setEndDate(e,t)}*calculateConstraintDate(e){const t=yield this.$.constraintType;return void 0!==e?e:t?this.getConstraintTypeDefaultDate(t)||this.$.constraintDate.getConsistentValue():null}getConstraintTypeDefaultDate(e){switch(e){case Kd.StartNoEarlierThan:case Kd.StartNoLaterThan:case Kd.MustStartOn:return this.startDate;case Kd.FinishNoEarlierThan:case Kd.FinishNoLaterThan:case Kd.MustFinishOn:return this.endDate}return null}*isConstraintTypeApplicable(e){const t=(yield this.$.childEvents).size>0;switch(e){case Kd.FinishNoEarlierThan:case Kd.StartNoLaterThan:case Kd.MustFinishOn:case Kd.MustStartOn:return!t}return!0}async setConstraint(e,t){return this.$.constraintType.put(e),void 0!==t&&this.$.constraintDate.put(t),this.propagate()}*calculateEndDateConstraintIntervals(){const e=yield*super.calculateEndDateConstraintIntervals(),t=yield this.$.constraintType;if(t){const n=yield this.$.constraintDate;if(n)switch(t){case Kd.MustFinishOn:e.unshift(Sh.new({startDate:n,endDate:n,originDescription:'"Must Finish On" constraint'}));break;case Kd.FinishNoEarlierThan:e.unshift(Sh.new({startDate:n,originDescription:'"Finish No Ealier Than" constraint'}));break;case Kd.FinishNoLaterThan:e.unshift(Sh.new({endDate:n,originDescription:'"Finish No Ealier Than" constraint'}))}}return e}*calculateStartDateConstraintIntervals(){const e=yield*super.calculateStartDateConstraintIntervals(),t=yield this.$.constraintType;if(t){const n=yield this.$.constraintDate;if(n)switch(t){case Kd.MustStartOn:e.unshift(Sh.new({startDate:n,endDate:n,originDescription:'"Must Start On" constraint'}));break;case Kd.StartNoEarlierThan:e.unshift(Sh.new({startDate:n,originDescription:'"Start No Ealier Than" constraint'}));break;case Kd.StartNoLaterThan:e.unshift(Sh.new({endDate:n,originDescription:'"Start No Later Than" constraint'}))}}return e}}return _h([Ad({type:"string"})],t.prototype,"constraintType",void 0),_h([Ad({type:"date",dateFormat:"YYYY-MM-DDTHH:mm:ssZ"},{converter:Ld})],t.prototype,"constraintDate",void 0),_h([md("constraintType")],t.prototype,"calculateConstraintType",null),_h([md("constraintDate")],t.prototype,"calculateConstraintDate",null),t};var $h=function(e,t,n,r){var s,i=arguments.length,o=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(i<3?s(o):i>3?s(t,n,o):s(t,n))||o);return i>3&&o&&Object.defineProperty(t,n,o),o};const jh=e=>{class t extends e{*calculateEarlyStartDateConstraintIntervals(){const e=yield*super.calculateEarlyStartDateConstraintIntervals();let t;for(t of yield this.$.incomingDeps){const n=yield t.$.fromEvent;if(null==n||Bc(n))continue;let r;switch(t.type){case Jd.EndToStart:const e=yield n.$.earlyEndDateRaw;if(e){const s=yield t.$.lag,i=yield t.$.lagUnit,o=yield t.$.calendar;r=Sh.new({startDate:o.calculateEndDate(e,s,i),endDate:null,originDescription:`"end to start" dependency from task ${n}`,onRemoveAction:this.getOnRemoveAction(t)})}break;case Jd.StartToStart:const s=yield n.$.earlyStartDateRaw;if(s){const e=yield t.$.lag,i=yield t.$.lagUnit,o=yield t.$.calendar;r=Sh.new({startDate:o.calculateEndDate(s,e,i),endDate:null,originDescription:`"start to start" dependency from task ${n}`,onRemoveAction:this.getOnRemoveAction(t)})}}r&&e.unshift(r)}return e}*calculateEarlyEndDateConstraintIntervals(){const e=yield*super.calculateEarlyEndDateConstraintIntervals();let t;for(t of yield this.$.incomingDeps){const n=yield t.$.fromEvent;if(null==n||Bc(n))continue;let r;switch(t.type){case Jd.EndToEnd:const e=yield n.$.earlyEndDateRaw;if(e){const s=yield t.$.lag,i=yield t.$.lagUnit,o=yield t.$.calendar;r=Sh.new({startDate:o.calculateEndDate(e,s,i),endDate:null,originDescription:`"end to end" dependency from task ${n}`,onRemoveAction:this.getOnRemoveAction(t)})}break;case Jd.StartToEnd:const s=yield n.$.earlyStartDateRaw;if(s){const e=yield t.$.lag,i=yield t.$.lagUnit,o=yield t.$.calendar;r=Sh.new({startDate:o.calculateEndDate(s,e,i),endDate:null,originDescription:`"start to end" dependency from task ${n}`,onRemoveAction:this.getOnRemoveAction(t)})}}r&&e.unshift(r)}return e}*calculateLateStartDateConstraintIntervals(){const e=yield*super.calculateLateStartDateConstraintIntervals();let t;for(t of yield this.$.outgoingDeps){const n=yield t.$.toEvent;if(null==n||Bc(n))continue;let r;switch(t.type){case Jd.StartToStart:const e=yield n.$.lateStartDateRaw;if(e){const s=yield t.$.lag,i=yield t.$.lagUnit,o=yield t.$.calendar;r=Sh.new({startDate:null,endDate:o.calculateStartDate(e,s,i),originDescription:`"start to start" dependency to task ${n}`,onRemoveAction:this.getOnRemoveAction(t)})}break;case Jd.StartToEnd:const s=yield n.$.lateEndDateRaw;if(s){const e=yield t.$.lag,i=yield t.$.lagUnit,o=yield t.$.calendar;r=Sh.new({startDate:null,endDate:o.calculateStartDate(s,e,i),originDescription:`"start to end" dependency to task ${n}`,onRemoveAction:this.getOnRemoveAction(t)})}}r&&e.unshift(r)}return e}*calculateLateEndDateConstraintIntervals(){const e=yield*super.calculateLateEndDateConstraintIntervals();let t;for(t of yield this.$.outgoingDeps){const n=yield t.$.toEvent;if(null==n||Bc(n))continue;let r;switch(t.type){case Jd.EndToEnd:const e=yield n.$.lateEndDateRaw;if(e){const s=yield t.$.lag,i=yield t.$.lagUnit,o=yield t.$.calendar;r=Sh.new({startDate:null,endDate:o.calculateStartDate(e,s,i),originDescription:`"end to end" dependency to task ${n}`,onRemoveAction:this.getOnRemoveAction(t)})}break;case Jd.EndToStart:const s=yield n.$.lateStartDateRaw;if(s){const e=yield t.$.lag,i=yield t.$.lagUnit,o=yield t.$.calendar;r=Sh.new({startDate:null,endDate:o.calculateStartDate(s,e,i),originDescription:`"end to start" dependency to task ${n}`,onRemoveAction:this.getOnRemoveAction(t)})}}r&&e.unshift(r)}return e}getOnRemoveAction(e){return()=>{this.getDependencyStore().remove(e)}}async setIncomingDeps(e){const t=this.getDependencyStore();return this.incomingDeps.forEach(e=>t.remove(e)),e.forEach(e=>{e.toEvent=this,t.add(e)}),this.propagate()}async setOutgoingDeps(e){const t=this.getDependencyStore();return this.outgoingDeps.forEach(e=>t.remove(e)),e.forEach(e=>{e.fromEvent=this,t.add(e)}),this.propagate()}*calculateLateStartDateRaw(){let e=yield*super.calculateLateStartDateRaw();const t=Ch(yield this.$.lateStartDateConstraintIntervals),n=Ch(yield this.$.lateEndDateConstraintIntervals),r=Ch([t,yh.new({startDate:n.startDateIsFinite()?yield*this.calculateProjectedStartDate(n.startDate):null,endDate:n.endDateIsFinite()?yield*this.calculateProjectedStartDate(n.endDate):null})]);return r.endDateIsFinite()&&r.endDate&&(!e||e>r.endDate)&&(e=r.endDate),e}*calculateLateEndDateRaw(){let e=yield*super.calculateLateEndDateRaw();const t=Ch(yield this.$.lateEndDateConstraintIntervals),n=Ch(yield this.$.lateStartDateConstraintIntervals),r=Ch([t,yh.new({startDate:n.startDateIsFinite()?yield*this.calculateProjectedEndDate(n.startDate):null,endDate:n.endDateIsFinite()?yield*this.calculateProjectedEndDate(n.endDate):null})]);return r.endDateIsFinite()&&r.endDate&&(!e||e>r.endDate)&&(e=r.endDate),e}leaveProject(){const e=this.getDependencyStore();this.incomingDeps.forEach(t=>e.remove(t)),this.outgoingDeps.forEach(t=>e.remove(t)),super.leaveProject()}}return $h([Ad()],t.prototype,"dontRemoveMe",void 0),$h([hd({},Rd)],t.prototype,"outgoingDeps",void 0),$h([hd({},Rd)],t.prototype,"incomingDeps",void 0),$h([md("earlyStartDateConstraintIntervals")],t.prototype,"calculateEarlyStartDateConstraintIntervals",null),$h([md("earlyEndDateConstraintIntervals")],t.prototype,"calculateEarlyEndDateConstraintIntervals",null),$h([md("lateStartDateConstraintIntervals")],t.prototype,"calculateLateStartDateConstraintIntervals",null),$h([md("lateEndDateConstraintIntervals")],t.prototype,"calculateLateEndDateConstraintIntervals",null),t};var Hh=function(e,t,n,r){var s,i=arguments.length,o=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(i<3?s(o):i>3?s(t,n,o):s(t,n))||o);return i>3&&o&&Object.defineProperty(t,n,o),o};const Nh=e=>{class t extends e{*calculatePercentDone(e){const t=yield this.$.childEvents,n=this.getProject(),r=yield n.$.autoCalculatePercentDoneForParentTasks;if(t.size&&r){const e=yield this.$.percentDoneSummaryData;return e.totalDuration>0?e.completedDuration/e.totalDuration:e.milestonesTotalPercentDone/e.milestonesNum}return void 0!==e?e:this.$.percentDone.value}*calculatePercentDoneSummaryData(){const e=yield this.$.childEvents;if(e.size){let t={totalDuration:0,completedDuration:0,milestonesNum:0,milestonesTotalPercentDone:0};for(const n of e){const e=yield n.$.percentDoneSummaryData;e&&(t.totalDuration+=e.totalDuration,t.completedDuration+=e.completedDuration,t.milestonesNum+=e.milestonesNum,t.milestonesTotalPercentDone+=e.milestonesTotalPercentDone)}return t}{const e=yield this.$.duration;if("number"==typeof e){const t=yield*this.$convertDuration(e,yield this.$.durationUnit,Xd.Millisecond),n=yield this.$.percentDone;return{totalDuration:t,completedDuration:t*n,milestonesNum:0===t?1:0,milestonesTotalPercentDone:0===t?n:0}}return null}}}return Hh([Ad({type:"number",defaultValue:0})],t.prototype,"percentDone",void 0),Hh([gd()],t.prototype,"percentDoneSummaryData",void 0),Hh([md("percentDone")],t.prototype,"calculatePercentDone",null),Hh([md("percentDoneSummaryData")],t.prototype,"calculatePercentDoneSummaryData",null),t},zh=(e=Sr)=>Ph(Fh(Ah(Ih(fu(Nh(Lh(jh(Th(Mh($d(Bd(_d(jd(cd(e)))))))))))))));class Bh extends(zh(Sr)){}const Vh=function(){class e extends va{static get fields(){return[{name:"task",persist:!1}]}get isBaseline(){return!0}get milestone(){if(!this.leaf){const{startDate:e,endDate:t}=this;if(e&&t)return t.getTime()===e.getTime()}return 0===this.duration}set milestone(e){e?this.convertToMilestone():this.convertToRegular()}async setMilestone(e){return e?this.convertToMilestone():this.convertToRegular()}async convertToMilestone(){return this.setDuration(0,this.durationUnit,!1)}async convertToRegular(){if(this.milestone)return this.setDuration(1,this.durationUnit,!1)}}return e._$name="Baseline",e}(),Wh=(e,t)=>{const{startDate:n,durationUnit:r,endDate:s}=e;return t?t.map(t=>Object.assign({task:e,startDate:n,durationUnit:r,endDate:s},t)):[]},Uh=function(){class e extends(qu(zh(va))){static get fields(){return[{name:"cls",serialize:e=>e.isDomClassList?e.toString():e,persist:!0},{name:"fullEffort",persist:!1},{name:"baselines"},{name:"note",type:"string"},{name:"percentDone",type:"number",defaultValue:0},{name:"parentId",serialize:(e,t)=>{const n=t.getEventStore(),r=t.getProject();return n&&n.getById(e)===r&&(e=null),e}},{name:"phantomId",type:"string"},{name:"phantomParentId",type:"string"},{name:"parentIndex",type:"int",persist:!0},{name:"iconCls"},{name:"draggable",type:"boolean",persist:!1,defaultValue:!0},{name:"resizable",persist:!1,defaultValue:!0},{name:"showInTimeline",defaultValue:!1}]}static get defaultConfig(){return{convertEmptyParentToLeaf:!0}}get isTask(){return!0}get hasBaselines(){return this.baselinesStore&&this.baselinesStore.count||Boolean(this.originalData.baselines)}setBaseline(e){if(e>this.baselines.count+1)throw new Error(`Attempt to set baseline ${e} when there are only ${this.baselines.count} baselines`);if(e===this.baselines.count+1)return this.baselines.add(Wh(this,[{}]));this.baselines.getAt(e-1).set(Wh(this,[{}])[0])}get baselines(){return this.baselinesStore||(this.baselinesStore=new Nr({modelClass:Vh,data:Wh(this,this.originalData.baselines)})),this.baselinesStore}get successors(){return Array.from(this.outgoingDeps)}set successors(e){this.setOutgoingDeps(e)}get predecessors(){return Array.from(this.incomingDeps)}set predecessors(e){this.setIncomingDeps(e)}get renderedPercentDone(){return this.percentDone<=99?Math.round(this.percentDone):Math.floor(this.percentDone)}get isDraggable(){return this.draggable}get isResizable(){return this.resizable&&!this.milestone&&!this.isParent}get isStarted(){return this.percentDone>0}get isCompleted(){return this.percentDone>=100}get isInProgress(){return this.isStarted&&!this.isCompleted}get milestone(){if(!this.leaf){let e=this.startDate,t=this.endDate;if(e&&t)return t.getTime()===e.getTime()}return 0===this.duration}set milestone(e){e?this.convertToMilestone():this.convertToRegular()}async setMilestone(e){return e?this.convertToMilestone():this.convertToRegular()}async convertToMilestone(){return this.setDuration(0,this.durationUnit,!1)}async convertToRegular(){if(this.milestone)return this.setDuration(1,this.durationUnit,!1)}get allDependencies(){return[...this.predecessors||[],...this.successors||[]]}get predecessorTasks(){return this.predecessors.map(e=>e.fromEvent)}get successorTasks(){return this.successors.map(e=>e.toEvent)}get previousSiblingsTotalCount(){let e=this.previousSibling,t=this.parentIndex;for(;e;)t+=e.descendantCount,e=e.previousSibling;return t}get sequenceNumber(){let e=0,t=this;for(;t.parent;)e+=t.previousSiblingsTotalCount+1,t=t.parent;return e}get isSubProject(){return!1}get subProject(){let e=null;return this.isProject?e=this:this.bubbleWhile(t=>(t.isProject&&(e=t),!e)),e}get fullEffort(){return{unit:this.effortUnit,magnitude:this.effort}}set fullEffort(e){this.setEffort(e.magnitude,e.unit)}get fullDuration(){return{unit:this.durationUnit,magnitude:this.duration}}set fullDuration(e){this.setDuration(e.magnitude,e.unit)}normalize(){}inSetNormalize(e){}}return e._$name="TaskModel",e}(),Gh=e=>(class extends e{static get defaultConfig(){return{tree:!0,modelClass:Bh}}buildRootNode(){return this.getProject()||{}}}),Yh=(e=Nr)=>Gh(Nd(_d(Ku(e))));class qh extends(Yh()){}const Xh=function(){class e extends(qu(Yh(xa(ps)))){static get defaultConfig(){return{tree:!0,modelClass:Uh,loadPriority:200,syncPriority:300,storeId:"tasks"}}updateIdMap(){super.updateIdMap()}getEvents(e){let t=this.getById(e);return t&&[t]}getEventsForResource(e){const t=this.resourceStore.getById(e);return[...t&&t.assignments||[]].map(e=>e.event)}getResourcesForEvent(e){return e.assignments.map(e=>e.resource)}setBaseline(e){const t=this.storage.values;this.forEach(t=>t.setBaseline(e)),this.trigger("refresh",{action:"batch",records:t,data:t})}}return e._$name="TaskStore",e}();class Kh extends Sc{constructor(){super(...arguments),this.entities=new Map}hasEntity(e){return this.entities.has(e)}getEntity(e){return this.entities.get(e)}addEntity(e){const t=e.name;if(!t)throw new Error("Entity must have a name");if(this.hasEntity(t))throw new Error(`Entity with name [${String(t)}] already exists`);return e.schema=this,this.entities.set(t,e),e}getEntityDecorator(){return e=>{const t=e.name;if(!t)throw new Error("Can't add entity - the target class has no name");let n=ud(e.prototype);if(n.name&&n.name!=t)throw new Error("Invalid state");return n.name=t,this.addEntity(n),e}}}const Zh=function(){var e={version:"1.2.0"};return Array.prototype.indexOf||(Array.prototype.indexOf=function(e){if(null==this)throw new TypeError;var t=Object(this),n=t.length>>>0;if(0===n)return-1;var r=0;if(arguments.length>1&&((r=Number(arguments[1]))!=r?r=0:0!=r&&r!=1/0&&r!=-1/0&&(r=(r>0||-1)*Math.floor(Math.abs(r)))),r>=n)return-1;for(var s=r>=0?r:Math.max(n-Math.abs(r),0);s<n;s++)if(s in t&&t[s]===e)return s;return-1}),String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")}),e.array={},e.array.sort=function(e,t){e.sort(function(e,t){return+e-+t}),t&&0===e[0]&&e.push(e.shift())},e.array.next=function(e,t,n){for(var r,s=0!==n[0],i=0,o=t.length-1;o>-1;--o){if((r=t[o])===e)return r;if(!(r>e||0===r&&s&&n[1]>e))break;i=o}return t[i]},e.array.nextInvalid=function(e,t,n){for(var r=n[0],s=n[1],i=t.length,o=0===t[i-1]&&0!==r?s:0,a=e,l=t.indexOf(e),c=a;a===(t[l]||o);)if(++a>s&&(a=r),++l===i&&(l=0),a===c)return;return a},e.array.prev=function(e,t,n){for(var r,s=t.length,i=0!==n[0],o=s-1,a=0;a<s;a++){if((r=t[a])===e)return r;if(!(r<e||0===r&&i&&n[1]<e))break;o=a}return t[o]},e.array.prevInvalid=function(e,t,n){for(var r=n[0],s=n[1],i=t.length,o=0===t[i-1]&&0!==r?s:0,a=e,l=t.indexOf(e),c=a;a===(t[l]||o);)if(--a<r&&(a=s),-1==--l&&(l=i-1),a===c)return;return a},e.day=e.D={name:"day",range:86400,val:function(t){return t.D||(t.D=e.date.getDate.call(t))},isValid:function(t,n){return e.D.val(t)===(n||e.D.extent(t)[1])},extent:function(t){if(t.DExtent)return t.DExtent;var n=e.M.val(t),r=e.DAYS_IN_MONTH[n-1];return 2===n&&366===e.dy.extent(t)[1]&&(r+=1),t.DExtent=[1,r]},start:function(t){return t.DStart||(t.DStart=e.date.next(e.Y.val(t),e.M.val(t),e.D.val(t)))},end:function(t){return t.DEnd||(t.DEnd=e.date.prev(e.Y.val(t),e.M.val(t),e.D.val(t)))},next:function(t,n){n=n>e.D.extent(t)[1]?1:n;var r=e.date.nextRollover(t,n,e.D,e.M),s=e.D.extent(r)[1];return n=n>s?1:n||s,e.date.next(e.Y.val(r),e.M.val(r),n)},prev:function(t,n){var r=e.date.prevRollover(t,n,e.D,e.M),s=e.D.extent(r)[1];return e.date.prev(e.Y.val(r),e.M.val(r),n>s?s:n||s)}},e.dayOfWeekCount=e.dc={name:"day of week count",range:604800,val:function(t){return t.dc||(t.dc=Math.floor((e.D.val(t)-1)/7)+1)},isValid:function(t,n){return e.dc.val(t)===n||0===n&&e.D.val(t)>e.D.extent(t)[1]-7},extent:function(t){return t.dcExtent||(t.dcExtent=[1,Math.ceil(e.D.extent(t)[1]/7)])},start:function(t){return t.dcStart||(t.dcStart=e.date.next(e.Y.val(t),e.M.val(t),Math.max(1,7*(e.dc.val(t)-1)+1||1)))},end:function(t){return t.dcEnd||(t.dcEnd=e.date.prev(e.Y.val(t),e.M.val(t),Math.min(7*e.dc.val(t),e.D.extent(t)[1])))},next:function(t,n){n=n>e.dc.extent(t)[1]?1:n;var r=e.date.nextRollover(t,n,e.dc,e.M);n=n>e.dc.extent(r)[1]?1:n;var s=e.date.next(e.Y.val(r),e.M.val(r),0===n?e.D.extent(r)[1]-6:1+7*(n-1));return s.getTime()<=t.getTime()?(r=e.M.next(t,e.M.val(t)+1),e.date.next(e.Y.val(r),e.M.val(r),0===n?e.D.extent(r)[1]-6:1+7*(n-1))):s},prev:function(t,n){var r=e.date.prevRollover(t,n,e.dc,e.M),s=e.dc.extent(r)[1];return n=n>s?s:n||s,e.dc.end(e.date.prev(e.Y.val(r),e.M.val(r),1+7*(n-1)))}},e.dayOfWeek=e.dw=e.d={name:"day of week",range:86400,val:function(t){return t.dw||(t.dw=e.date.getDay.call(t)+1)},isValid:function(t,n){return e.dw.val(t)===(n||7)},extent:function(){return[1,7]},start:function(t){return e.D.start(t)},end:function(t){return e.D.end(t)},next:function(t,n){return n=n>7?1:n||7,e.date.next(e.Y.val(t),e.M.val(t),e.D.val(t)+(n-e.dw.val(t))+(n<=e.dw.val(t)?7:0))},prev:function(t,n){return n=n>7?7:n||7,e.date.prev(e.Y.val(t),e.M.val(t),e.D.val(t)+(n-e.dw.val(t))+(n>=e.dw.val(t)?-7:0))}},e.dayOfYear=e.dy={name:"day of year",range:86400,val:function(t){return t.dy||(t.dy=Math.ceil(1+(e.D.start(t).getTime()-e.Y.start(t).getTime())/e.DAY))},isValid:function(t,n){return e.dy.val(t)===(n||e.dy.extent(t)[1])},extent:function(t){var n=e.Y.val(t);return t.dyExtent||(t.dyExtent=[1,n%4?365:366])},start:function(t){return e.D.start(t)},end:function(t){return e.D.end(t)},next:function(t,n){n=n>e.dy.extent(t)[1]?1:n;var r=e.date.nextRollover(t,n,e.dy,e.Y),s=e.dy.extent(r)[1];return n=n>s?1:n||s,e.date.next(e.Y.val(r),e.M.val(r),n)},prev:function(t,n){var r=e.date.prevRollover(t,n,e.dy,e.Y),s=e.dy.extent(r)[1];return n=n>s?s:n||s,e.date.prev(e.Y.val(r),e.M.val(r),n)}},e.hour=e.h={name:"hour",range:3600,val:function(t){return t.h||(t.h=e.date.getHour.call(t))},isValid:function(t,n){return e.h.val(t)===n},extent:function(){return[0,23]},start:function(t){return t.hStart||(t.hStart=e.date.next(e.Y.val(t),e.M.val(t),e.D.val(t),e.h.val(t)))},end:function(t){return t.hEnd||(t.hEnd=e.date.prev(e.Y.val(t),e.M.val(t),e.D.val(t),e.h.val(t)))},next:function(t,n){n=n>23?0:n;var r=e.date.next(e.Y.val(t),e.M.val(t),e.D.val(t)+(n<=e.h.val(t)?1:0),n);return!e.date.isUTC&&r.getTime()<=t.getTime()&&(r=e.date.next(e.Y.val(r),e.M.val(r),e.D.val(r),n+1)),r},prev:function(t,n){return n=n>23?23:n,e.date.prev(e.Y.val(t),e.M.val(t),e.D.val(t)+(n>=e.h.val(t)?-1:0),n)}},e.minute=e.m={name:"minute",range:60,val:function(t){return t.m||(t.m=e.date.getMin.call(t))},isValid:function(t,n){return e.m.val(t)===n},extent:function(e){return[0,59]},start:function(t){return t.mStart||(t.mStart=e.date.next(e.Y.val(t),e.M.val(t),e.D.val(t),e.h.val(t),e.m.val(t)))},end:function(t){return t.mEnd||(t.mEnd=e.date.prev(e.Y.val(t),e.M.val(t),e.D.val(t),e.h.val(t),e.m.val(t)))},next:function(t,n){var r=e.m.val(t),s=e.s.val(t),i=n>59?60-r:n<=r?60-r+n:n-r,o=new Date(t.getTime()+i*e.MIN-s*e.SEC);return!e.date.isUTC&&o.getTime()<=t.getTime()&&(o=new Date(t.getTime()+(i+120)*e.MIN-s*e.SEC)),o},prev:function(t,n){return n=n>59?59:n,e.date.prev(e.Y.val(t),e.M.val(t),e.D.val(t),e.h.val(t)+(n>=e.m.val(t)?-1:0),n)}},e.month=e.M={name:"month",range:2629740,val:function(t){return t.M||(t.M=e.date.getMonth.call(t)+1)},isValid:function(t,n){return e.M.val(t)===(n||12)},extent:function(){return[1,12]},start:function(t){return t.MStart||(t.MStart=e.date.next(e.Y.val(t),e.M.val(t)))},end:function(t){return t.MEnd||(t.MEnd=e.date.prev(e.Y.val(t),e.M.val(t)))},next:function(t,n){return n=n>12?1:n||12,e.date.next(e.Y.val(t)+(n>e.M.val(t)?0:1),n)},prev:function(t,n){return n=n>12?12:n||12,e.date.prev(e.Y.val(t)-(n>=e.M.val(t)?1:0),n)}},e.second=e.s={name:"second",range:1,val:function(t){return t.s||(t.s=e.date.getSec.call(t))},isValid:function(t,n){return e.s.val(t)===n},extent:function(){return[0,59]},start:function(e){return e},end:function(e){return e},next:function(t,n){var r=e.s.val(t),s=n>59?60-r:n<=r?60-r+n:n-r,i=new Date(t.getTime()+s*e.SEC);return!e.date.isUTC&&i.getTime()<=t.getTime()&&(i=new Date(t.getTime()+(s+7200)*e.SEC)),i},prev:function(t,n,r){return n=n>59?59:n,e.date.prev(e.Y.val(t),e.M.val(t),e.D.val(t),e.h.val(t),e.m.val(t)+(n>=e.s.val(t)?-1:0),n)}},e.time=e.t={name:"time",range:1,val:function(t){return t.t||(t.t=3600*e.h.val(t)+60*e.m.val(t)+e.s.val(t))},isValid:function(t,n){return e.t.val(t)===n},extent:function(){return[0,86399]},start:function(e){return e},end:function(e){return e},next:function(t,n){n=n>86399?0:n;var r=e.date.next(e.Y.val(t),e.M.val(t),e.D.val(t)+(n<=e.t.val(t)?1:0),0,0,n);return!e.date.isUTC&&r.getTime()<t.getTime()&&(r=e.date.next(e.Y.val(r),e.M.val(r),e.D.val(r),e.h.val(r),e.m.val(r),n+7200)),r},prev:function(t,n){return n=n>86399?86399:n,e.date.next(e.Y.val(t),e.M.val(t),e.D.val(t)+(n>=e.t.val(t)?-1:0),0,0,n)}},e.weekOfMonth=e.wm={name:"week of month",range:604800,val:function(t){return t.wm||(t.wm=(e.D.val(t)+(e.dw.val(e.M.start(t))-1)+(7-e.dw.val(t)))/7)},isValid:function(t,n){return e.wm.val(t)===(n||e.wm.extent(t)[1])},extent:function(t){return t.wmExtent||(t.wmExtent=[1,(e.D.extent(t)[1]+(e.dw.val(e.M.start(t))-1)+(7-e.dw.val(e.M.end(t))))/7])},start:function(t){return t.wmStart||(t.wmStart=e.date.next(e.Y.val(t),e.M.val(t),Math.max(e.D.val(t)-e.dw.val(t)+1,1)))},end:function(t){return t.wmEnd||(t.wmEnd=e.date.prev(e.Y.val(t),e.M.val(t),Math.min(e.D.val(t)+(7-e.dw.val(t)),e.D.extent(t)[1])))},next:function(t,n){n=n>e.wm.extent(t)[1]?1:n;var r=e.date.nextRollover(t,n,e.wm,e.M),s=e.wm.extent(r)[1];return n=n>s?1:n||s,e.date.next(e.Y.val(r),e.M.val(r),Math.max(1,7*(n-1)-(e.dw.val(r)-2)))},prev:function(t,n){var r=e.date.prevRollover(t,n,e.wm,e.M),s=e.wm.extent(r)[1];return n=n>s?s:n||s,e.wm.end(e.date.next(e.Y.val(r),e.M.val(r),Math.max(1,7*(n-1)-(e.dw.val(r)-2))))}},e.weekOfYear=e.wy={name:"week of year (ISO)",range:604800,val:function(t){if(t.wy)return t.wy;var n=e.dw.next(e.wy.start(t),5),r=e.dw.next(e.Y.prev(n,e.Y.val(n)-1),5);return t.wy=1+Math.ceil((n.getTime()-r.getTime())/e.WEEK)},isValid:function(t,n){return e.wy.val(t)===(n||e.wy.extent(t)[1])},extent:function(t){if(t.wyExtent)return t.wyExtent;var n=e.dw.next(e.wy.start(t),5),r=e.dw.val(e.Y.start(n)),s=e.dw.val(e.Y.end(n));return t.wyExtent=[1,5===r||5===s?53:52]},start:function(t){return t.wyStart||(t.wyStart=e.date.next(e.Y.val(t),e.M.val(t),e.D.val(t)-(e.dw.val(t)>1?e.dw.val(t)-2:6)))},end:function(t){return t.wyEnd||(t.wyEnd=e.date.prev(e.Y.val(t),e.M.val(t),e.D.val(t)+(e.dw.val(t)>1?8-e.dw.val(t):0)))},next:function(t,n){n=n>e.wy.extent(t)[1]?1:n;var r=e.dw.next(e.wy.start(t),5),s=e.date.nextRollover(r,n,e.wy,e.Y);1!==e.wy.val(s)&&(s=e.dw.next(s,2));var i=e.wy.extent(s)[1],o=e.wy.start(s);return n=n>i?1:n||i,e.date.next(e.Y.val(o),e.M.val(o),e.D.val(o)+7*(n-1))},prev:function(t,n){var r=e.dw.next(e.wy.start(t),5),s=e.date.prevRollover(r,n,e.wy,e.Y);1!==e.wy.val(s)&&(s=e.dw.next(s,2));var i=e.wy.extent(s)[1],o=e.wy.end(s);return n=n>i?i:n||i,e.wy.end(e.date.next(e.Y.val(o),e.M.val(o),e.D.val(o)+7*(n-1)))}},e.year=e.Y={name:"year",range:31556900,val:function(t){return t.Y||(t.Y=e.date.getYear.call(t))},isValid:function(t,n){return e.Y.val(t)===n},extent:function(){return[1970,2099]},start:function(t){return t.YStart||(t.YStart=e.date.next(e.Y.val(t)))},end:function(t){return t.YEnd||(t.YEnd=e.date.prev(e.Y.val(t)))},next:function(t,n){return n>e.Y.val(t)&&n<=e.Y.extent()[1]?e.date.next(n):e.NEVER},prev:function(t,n){return n<e.Y.val(t)&&n>=e.Y.extent()[0]?e.date.prev(n):e.NEVER}},e.fullDate=e.fd={name:"full date",range:1,val:function(e){return e.fd||(e.fd=e.getTime())},isValid:function(t,n){return e.fd.val(t)===n},extent:function(){return[0,3250368e7]},start:function(e){return e},end:function(e){return e},next:function(t,n){return e.fd.val(t)<n?new Date(n):e.NEVER},prev:function(t,n){return e.fd.val(t)>n?new Date(n):e.NEVER}},e.modifier={},e.modifier.after=e.modifier.a=function(e,t){var n=t[0];return{name:"after "+e.name,range:(e.extent(new Date)[1]-n)*e.range,val:e.val,isValid:function(e,t){return this.val(e)>=n},extent:e.extent,start:e.start,end:e.end,next:function(t,r){return r!=n&&(r=e.extent(t)[0]),e.next(t,r)},prev:function(t,r){return r=r===n?e.extent(t)[1]:n-1,e.prev(t,r)}}},e.modifier.before=e.modifier.b=function(e,t){var n=t[t.length-1];return{name:"before "+e.name,range:e.range*(n-1),val:e.val,isValid:function(e,t){return this.val(e)<n},extent:e.extent,start:e.start,end:e.end,next:function(t,r){return r=r===n?e.extent(t)[0]:n,e.next(t,r)},prev:function(t,r){return r=r===n?n-1:e.extent(t)[1],e.prev(t,r)}}},e.compile=function(t){var n,r=[],s=0;for(var i in t){var o=i.split("_"),a=o[0],l=o[1],c=t[i],d=l?e.modifier[l](e[a],c):e[a];r.push({constraint:d,vals:c}),s++}return r.sort(function(e,t){var n=e.constraint.range,r=t.constraint.range;return r<n?-1:r>n?1:0}),n=r[s-1].constraint,{start:function(t,i){for(var o,a=i,l=e.array[t],c=1e3;c--&&!o&&a;){o=!0;for(var d=0;d<s;d++){var u=r[d].constraint,h=u.val(a),g=u.extent(a),m=l(h,r[d].vals,g);if(!u.isValid(a,m)){a=u[t](a,m),o=!1;break}}}return a!==e.NEVER&&(a="next"===t?n.start(a):n.end(a)),a},end:function(t,n){for(var i,o=e.array[t+"Invalid"],a=function(e){return"next"===e?function(e,t){return e.getTime()>t.getTime()}:function(e,t){return t.getTime()>e.getTime()}}(t),l=s-1;l>=0;l--){var c,d=r[l].constraint,u=d.val(n),h=d.extent(n),g=o(u,r[l].vals,h);void 0!==g&&(!(c=d[t](n,g))||i&&!a(i,c)||(i=c))}return i},tick:function(t,r){return new Date("next"===t?n.end(r).getTime()+e.SEC:n.start(r).getTime()-e.SEC)},tickStart:function(e){return n.start(e)}}},e.schedule=function(t){if(!t)throw new Error("Missing schedule definition.");if(!t.schedules)throw new Error("Definition must include at least one schedule.");for(var n=[],r=t.schedules.length,s=[],i=t.exceptions?t.exceptions.length:0,o=0;o<r;o++)n.push(e.compile(t.schedules[o]));for(var a=0;a<i;a++)s.push(e.compile(t.exceptions[a]));function l(t,r,o,a,l){var b,C,w,S=v(t),D=r,E=1e3,x=[],T=[],R=[],k="next"===t,M=k?0:1,I=k?1:0;if(!(o=o?new Date(o):new Date)||!o.getTime())throw new Error("Invalid start date.");for(function(e,t,n,r){for(var s=0,i=t.length;s<i;s++)n[s]=t[s].start(e,r)}(t,n,x,o),function(t,n,r,s){for(var i=0,o=n.length;i<o;i++){var a=n[i].start(t,s);r[i]=a?[a,n[i].end(t,a)]:e.NEVER}}(t,s,T,o);E--&&D&&(b=y(x,S))&&(!a||!S(b,a));)if(i&&(u(t,s,T,b),C=m(t,T,b)))d(t,n,x,C);else{if(l){var A=p(T,S);C=f(t,n,x,b,A);var F=k?[new Date(Math.max(o,b)),C?new Date(a?Math.min(C,a):C):void 0]:[C?new Date(a?Math.max(a,C.getTime()+e.SEC):C.getTime()+e.SEC):void 0,new Date(Math.min(o,b.getTime()+e.SEC))];if(w&&F[M].getTime()===w[I].getTime()?(w[I]=F[I],D++):R.push(w=F),!C)break;d(t,n,x,C)}else R.push(k?new Date(Math.max(o,b)):g(n,x,b,a)),h(t,n,x,b);D--}for(var O=0,L=R.length;O<L;O++){var _=R[O];R[O]="[object Array]"===Object.prototype.toString.call(_)?[c(_[0]),c(_[1])]:c(_)}return 0===R.length?e.NEVER:1===r?R[0]:R}function c(e){if(e instanceof Date&&!isNaN(e.valueOf()))return new Date(e)}function d(e,t,n,r){for(var s=v(e),i=0,o=t.length;i<o;i++)n[i]&&!s(n[i],r)&&(n[i]=t[i].start(e,r))}function u(t,n,r,s){for(var i=v(t),o=0,a=n.length;o<a;o++)if(r[o]&&!i(r[o][0],s)){var l=n[o].start(t,s);r[o]=l?[l,n[o].end(t,l)]:e.NEVER}}function h(e,t,n,r){for(var s=0,i=t.length;s<i;s++)n[s]&&n[s].getTime()===r.getTime()&&(n[s]=t[s].start(e,t[s].tick(e,r)))}function g(e,t,n,r){for(var s,i=0,o=t.length;i<o;i++)if(t[i]&&t[i].getTime()===n.getTime()){var a=e[i].tickStart(n);if(r&&a<r)return r;(!s||a>s)&&(s=a)}return s}function m(e,t,n){for(var r,s=v(e),i=0,o=t.length;i<o;i++){var a=t[i];!a||s(a[0],n)||a[1]&&!s(a[1],n)||r&&!s(a[1],r)||(r=a[1])}return r}function p(e,t){for(var n,r=0,s=e.length;r<s;r++)!e[r]||n&&!t(n,e[r][0])||(n=e[r][0]);return n}function f(e,t,n,r,s){for(var i,o=v(e),a=0,l=t.length;a<l;a++){var c=n[a];if(c&&c.getTime()===r.getTime()){var d=t[a].end(e,c);if(s&&(!d||o(d,s)))return s;i&&!o(d,i)||(i=d)}}return i}function v(e){return"next"===e?function(e,t){return!t||e.getTime()>t.getTime()}:function(e,t){return!e||t.getTime()>e.getTime()}}function y(e,t){for(var n=e[0],r=1,s=e.length;r<s;r++)e[r]&&t(n,e[r])&&(n=e[r]);return n}return{isValid:function(t){return l("next",1,t,t)!==e.NEVER},next:function(e,t,n){return l("next",e||1,t,n)},prev:function(e,t,n){return l("prev",e||1,t,n)},nextRange:function(e,t,n){return l("next",e||1,t,n,!0)},prevRange:function(e,t,n){return l("prev",e||1,t,n,!0)}}},e.setTimeout=function(t,n){var r,s=e.schedule(n);return t&&function e(){var n=Date.now(),i=s.next(2,n);if(i[0]){var o=i[0].getTime()-n;o<1e3&&(o=i[1]?i[1].getTime()-n:1e3),r=o<2147483647?setTimeout(t,o):setTimeout(e,2147483647)}else r=void 0}(),{isDone:function(){return!r},clear:function(){clearTimeout(r)}}},e.setInterval=function(t,n){if(t){var r=e.setTimeout(function i(){s||(t(),r=e.setTimeout(i,n))},n),s=r.isDone();return{isDone:function(){return r.isDone()},clear:function(){s=!0,r.clear()}}}},e.date={},e.date.timezone=function(t){e.date.build=t?function(e,t,n,r,s,i){return new Date(e,t,n,r,s,i)}:function(e,t,n,r,s,i){return new Date(Date.UTC(e,t,n,r,s,i))};var n=t?"get":"getUTC",r=Date.prototype;e.date.getYear=r[n+"FullYear"],e.date.getMonth=r[n+"Month"],e.date.getDate=r[n+"Date"],e.date.getDay=r[n+"Day"],e.date.getHour=r[n+"Hours"],e.date.getMin=r[n+"Minutes"],e.date.getSec=r[n+"Seconds"],e.date.isUTC=!t},e.date.UTC=function(){e.date.timezone(!1)},e.date.localTime=function(){e.date.timezone(!0)},e.date.UTC(),e.SEC=1e3,e.MIN=60*e.SEC,e.HOUR=60*e.MIN,e.DAY=24*e.HOUR,e.WEEK=7*e.DAY,e.DAYS_IN_MONTH=[31,28,31,30,31,30,31,31,30,31,30,31],e.NEVER=0,e.date.next=function(t,n,r,s,i,o){return e.date.build(t,void 0!==n?n-1:0,void 0!==r?r:1,s||0,i||0,o||0)},e.date.nextRollover=function(t,n,r,s){var i=r.val(t),o=r.extent(t)[1];return(n||o)<=i||n>o?new Date(s.end(t).getTime()+e.SEC):s.start(t)},e.date.prev=function(t,n,r,s,i,o){var a=arguments.length;return n=a<2?11:n-1,r=a<3?e.D.extent(e.date.next(t,n+1))[1]:r,e.date.build(t,n,r,s=a<4?23:s,i=a<5?59:i,o=a<6?59:o)},e.date.prevRollover=function(e,t,n,r){var s=n.val(e);return r.start(t>=s||!t?r.prev(e,r.val(e)-1):e)},e.parse={},e.parse.cron=function(e,t){var n={JAN:1,FEB:2,MAR:3,APR:4,MAY:5,JUN:6,JUL:7,AUG:8,SEP:9,OCT:10,NOV:11,DEC:12,SUN:1,MON:2,TUE:3,WED:4,THU:5,FRI:6,SAT:7},r={"* * * * * *":"0/1 * * * * *","@YEARLY":"0 0 1 1 *","@ANNUALLY":"0 0 1 1 *","@MONTHLY":"0 0 1 * *","@WEEKLY":"0 0 * * 0","@DAILY":"0 0 * * *","@HOURLY":"0 * * * *"},s={s:[0,0,59],m:[1,0,59],h:[2,0,23],D:[3,1,31],M:[4,1,12],Y:[6,1970,2099],d:[5,1,7,1]};function i(e,t,r){return isNaN(e)?n[e]||null:Math.min(+e+(t||0),r||9999)}function o(e,t,n,r,s){var i=n;for(e[t]||(e[t]=[]);i<=r;)e[t].indexOf(i)<0&&e[t].push(i),i+=s||1;e[t].sort(function(e,t){return e-t})}function a(e,t,n,r){(t.d&&!t.dc||t.dc&&t.dc.indexOf(r)<0)&&(e.push(function(e){var t,n={};for(t in e)"dc"!==t&&"d"!==t&&(n[t]=e[t].slice(0));return n}(t)),t=e[e.length-1]),o(t,"d",n,n),o(t,"dc",r,r)}function l(e){return e.indexOf("#")>-1||e.indexOf("L")>0}function c(e,t){return l(e)&&!l(t)?1:e-t}var d=function(e){var t=e.toUpperCase();return r[t]||t}(e);return function(e){var r,l,u,h,g,m,p,f,v,y,b,C,w,S,D={schedules:[{}],exceptions:[]},E=(t?d:"0 "+d).replace(/(\s)+/g," ").split(" ");for(r in s)if((u=E[(l=s[r])[0]])&&"*"!==u&&"?"!==u){var x,T=(h=u.split(",").sort(c)).length;for(x=0;x<T;x++)p=r,f=l[1],b=void 0,C=void 0,void 0,void 0,S=(w=(m=D).schedules)[w.length-1],"L"===(g=h[x])&&(g=f-1),null!==(b=i(g,y=l[3],v=l[2]))?o(S,p,b,b):null!==(b=i(g.replace("W",""),y,v))?function(e,t,r){var s={},i={};1===r?(o(t,"D",1,3),o(t,"d",n.MON,n.FRI),o(s,"D",2,2),o(s,"d",n.TUE,n.FRI),o(i,"D",3,3),o(i,"d",n.TUE,n.FRI)):(o(t,"D",r-1,r+1),o(t,"d",n.MON,n.FRI),o(s,"D",r-1,r-1),o(s,"d",n.MON,n.THU),o(i,"D",r+1,r+1),o(i,"d",n.TUE,n.FRI)),e.exceptions.push(s),e.exceptions.push(i)}(m,S,b):null!==(b=i(g.replace("L",""),y,v))?a(w,S,b,f-1):2===(C=g.split("#")).length?a(w,S,b=i(C[0],y,v),i(C[1])):function(e,t,n,r,s,a){var l=e.split("/"),c=+l[1],d=l[0];if("*"!==d&&"0"!==d){var u=d.split("-");r=i(u[0],a,s),s=i(u[1],a,s)||s}o(t,n,r,s,c)}(g,S,p,f,v,y)}return D}()},e.parse.recur=function(){var t,n,r,s,i,o,a,l,c,d=[],u=[],h=d;function g(e,d,u){if(e=i?e+"_"+i:e,t||(h.push({}),t=h[0]),t[e]||(t[e]=[]),n=t[e],s){for(r=[],l=d;l<=u;l+=s)r.push(l);c={n:e,x:s,c:n.length,m:u}}var g=(r=o?[d]:a?[u]:r).length;for(l=0;l<g;l+=1){var m=r[l];n.indexOf(m)<0&&n.push(m)}r=s=i=o=a=0}return{schedules:d,exceptions:u,on:function(){return r=arguments[0]instanceof Array?arguments[0]:arguments,this},every:function(e){return s=e||1,this},after:function(e){return i="a",r=[e],this},before:function(e){return i="b",r=[e],this},first:function(){return o=1,this},last:function(){return a=1,this},time:function(){for(var e=0,t=r.length;e<t;e++){var n=r[e].split(":");n.length<3&&n.push(0),r[e]=3600*+n[0]+60*+n[1]+ +n[2]}return g("t"),this},second:function(){return g("s",0,59),this},minute:function(){return g("m",0,59),this},hour:function(){return g("h",0,23),this},dayOfMonth:function(){return g("D",1,a?0:31),this},dayOfWeek:function(){return g("d",1,7),this},onWeekend:function(){return r=[1,7],this.dayOfWeek()},onWeekday:function(){return r=[2,3,4,5,6],this.dayOfWeek()},dayOfWeekCount:function(){return g("dc",1,a?0:5),this},dayOfYear:function(){return g("dy",1,a?0:366),this},weekOfMonth:function(){return g("wm",1,a?0:5),this},weekOfYear:function(){return g("wy",1,a?0:53),this},month:function(){return g("M",1,12),this},year:function(){return g("Y",1970,2450),this},fullDate:function(){for(var e=0,t=r.length;e<t;e++)r[e]=r[e].getTime();return g("fd"),this},customModifier:function(t,n){if(!e.modifier[t])throw new Error("Custom modifier "+t+" not recognized!");return i=t,r=arguments[1]instanceof Array?arguments[1]:[arguments[1]],this},customPeriod:function(t){var n=e[t];if(!n)throw new Error("Custom time period "+t+" not recognized!");return g(t,n.extent(new Date)[0],n.extent(new Date)[1]),this},startingOn:function(e){return this.between(e,c.m)},between:function(e,n){return t[c.n]=t[c.n].splice(0,c.c),s=c.x,g(c.n,e,n),this},and:function(){return t=h[h.push({})-1],this},except:function(){return h=u,t=null,this}}},e.parse.text=function(t){var n,r=e.parse.recur,s=0,i="",o={eof:/^$/,rank:/^((\d\d\d\d)|([2-5]?1(st)?|[2-5]?2(nd)?|[2-5]?3(rd)?|(0|[1-5]?[4-9]|[1-5]0|1[1-3])(th)?))\b/,time:/^((([0]?[1-9]|1[0-2]):[0-5]\d(\s)?(am|pm))|(([0]?\d|1\d|2[0-3]):[0-5]\d))\b/,dayName:/^((sun|mon|tue(s)?|wed(nes)?|thu(r(s)?)?|fri|sat(ur)?)(day)?)\b/,monthName:/^(jan(uary)?|feb(ruary)?|ma((r(ch)?)?|y)|apr(il)?|ju(ly|ne)|aug(ust)?|oct(ober)?|(sept|nov|dec)(ember)?)\b/,yearIndex:/^(\d\d\d\d)\b/,every:/^every\b/,after:/^after\b/,before:/^before\b/,second:/^(s|sec(ond)?(s)?)\b/,minute:/^(m|min(ute)?(s)?)\b/,hour:/^(h|hour(s)?)\b/,day:/^(day(s)?( of the month)?)\b/,dayInstance:/^day instance\b/,dayOfWeek:/^day(s)? of the week\b/,dayOfYear:/^day(s)? of the year\b/,weekOfYear:/^week(s)?( of the year)?\b/,weekOfMonth:/^week(s)? of the month\b/,weekday:/^weekday\b/,weekend:/^weekend\b/,month:/^month(s)?\b/,year:/^year(s)?\b/,between:/^between (the)?\b/,start:/^(start(ing)? (at|on( the)?)?)\b/,at:/^(at|@)\b/,and:/^(,|and\b)/,except:/^(except\b)/,also:/(also)\b/,first:/^(first)\b/,last:/^last\b/,in:/^in\b/,of:/^of\b/,onthe:/^on the\b/,on:/^on\b/,through:/(-|^(to|through)\b)/},a={jan:1,feb:2,mar:3,apr:4,may:5,jun:6,jul:7,aug:8,sep:9,oct:10,nov:11,dec:12,sun:1,mon:2,tue:3,wed:4,thu:5,fri:6,sat:7,"1st":1,fir:1,"2nd":2,sec:2,"3rd":3,thi:3,"4th":4,for:4};function l(e,t,n,r){return{startPos:e,endPos:t,text:n,type:r}}function c(e){var t,n,r,o,a,c,d=e instanceof Array?e:[e],u=/\s+/;for(d.push(u),a=s;!t||t.type===u;){c=-1,n=i.substring(a),t=l(a,a,i.split(u)[0]);var h,g=d.length;for(h=0;h<g;h++)(r=(o=d[h]).exec(n))&&0===r.index&&r[0].length>c&&(t=l(a,a+(c=r[0].length),n.substring(0,c),o));t.type===u&&(a=t.endPos)}return t}function d(e){var t=c(e);return s=t.endPos,t}function u(e){for(var t=+y(e),n=f(o.through)?+y(e):t,r=[],s=t;s<=n;s++)r.push(s);return r}function h(e){for(var t=u(e);f(o.and);)t=t.concat(u(e));return t}function g(e){var t,n,r,s;f(o.weekend)?e.on(a.sun,a.sat).dayOfWeek():f(o.weekday)?e.on(a.mon,a.tue,a.wed,a.thu,a.fri).dayOfWeek():(t=y(o.rank),e.every(t),n=p(e),f(o.start)?(t=y(o.rank),e.startingOn(t),v(n.type)):f(o.between)&&(r=y(o.rank),f(o.and)&&(s=y(o.rank),e.between(r,s))))}function m(e){f(o.first)?e.first():f(o.last)?e.last():e.on(h(o.rank)),p(e)}function p(e){var t=v([o.second,o.minute,o.hour,o.dayOfYear,o.dayOfWeek,o.dayInstance,o.day,o.month,o.year,o.weekOfMonth,o.weekOfYear]);switch(t.type){case o.second:e.second();break;case o.minute:e.minute();break;case o.hour:e.hour();break;case o.dayOfYear:e.dayOfYear();break;case o.dayOfWeek:e.dayOfWeek();break;case o.dayInstance:e.dayOfWeekCount();break;case o.day:e.dayOfMonth();break;case o.weekOfMonth:e.weekOfMonth();break;case o.weekOfYear:e.weekOfYear();break;case o.month:e.month();break;case o.year:e.year();break;default:n=s}return t}function f(e){var t=c(e).type===e;return t&&d(e),t}function v(e){var t=d(e);return t.type?t.text=function(e,t){var n=e;switch(t){case o.time:var r=e.split(/(:|am|pm)/),s="pm"===r[3]&&r[0]<12?parseInt(r[0],10)+12:r[0],i=r[2].trim();n=(1===s.length?"0":"")+s+":"+i;break;case o.rank:n=parseInt(/^\d+/.exec(e)[0],10);break;case o.monthName:case o.dayName:n=a[e.substring(0,3)]}return n}(t.text,e):n=s,t}function y(e){return v(e).text}return function(e){s=0,i=e,n=-1;for(var t=r();s<i.length&&n<0;)switch(v([o.every,o.after,o.before,o.onthe,o.on,o.of,o.in,o.at,o.and,o.except,o.also]).type){case o.every:g(t);break;case o.after:void 0!==c(o.time).type?(t.after(y(o.time)),t.time()):(t.after(y(o.rank)),p(t));break;case o.before:void 0!==c(o.time).type?(t.before(y(o.time)),t.time()):(t.before(y(o.rank)),p(t));break;case o.onthe:m(t);break;case o.on:t.on(h(o.dayName)).dayOfWeek();break;case o.of:t.on(h(o.monthName)).month();break;case o.in:t.on(h(o.yearIndex)).year();break;case o.at:for(t.on(y(o.time)).time();f(o.and);)t.on(y(o.time)).time();break;case o.and:break;case o.also:t.and();break;case o.except:t.except();break;default:n=s}return{schedules:t.schedules,exceptions:t.exceptions,error:n}}(t.toLowerCase())},e}();Zh.date.localTime();class Jh{constructor(e){if(this.intervals=[],e&&Object.assign(this,e),!this.calendar)throw new Error("Required attribute `calendar` is missing")}includeInterval(e){if(-1==this.intervals.indexOf(e)){const t=this.intervals.slice();return t.push(e),new Jh({intervals:t,calendar:this.calendar})}return this}combineWith(e){return new Jh({intervals:this.intervals.concat(e.intervals),calendar:this.calendar})}getIsWorking(){if(null!=this.isWorking)return this.isWorking;const e=this.intervals=this.normalizeIntervals(this.intervals);return this.isWorking=e[0].isWorking}normalizeIntervals(e){const t=qd(e);return t.sort((e,t)=>t.getPriorityField()-e.getPriorityField()),t}}class Qh extends su{constructor(e){if(super(e),this.staticIntervalsCached=!1,!this.unspecifiedTimeInterval)throw new Error("Required attribute `unspecifiedTimeInterval` is missing");this.intervalCache=new du({emptyInterval:new Jh({intervals:[this.unspecifiedTimeInterval],calendar:this.calendar}),combineIntervalsFn:(e,t)=>e.combineWith(t)})}fillCache(e,t){this.staticIntervalsCached||(this.cacheStaticIntervals(),this.staticIntervalsCached=!0),this.parentCache&&this.includeWrappingRangeFrom(this.parentCache,e,t);const n=e.getTime(),r=t.getTime();if(n>r)throw new Error("Invalid cache fill interval");this.forEachRecurrentInterval(s=>{const i=s.getStartDateSchedule(),o=s.getEndDateSchedule();let a=i.prev(1,e),l=o.next(1,t);if(a!==Zh.NEVER&&a.getTime()===n){const t=i.prev(2,e);t!==Zh.NEVER&&2===t.length&&(a=t[1])}if(l!==Zh.NEVER&&l.getTime()===r){const e=o.next(2,t);e!==Zh.NEVER&&2===e.length&&(l=e[1])}const c=i.next(1/0,a!==Zh.NEVER?a:e,l!==Zh.NEVER?new Date(l.getTime()-1):t);if(c===Zh.NEVER)return;const d=o.next(1/0,new Date(c[0].getTime()+1),l!==Zh.NEVER?l:t);if(d.length!=c.length)throw new Error("Recurrent interval inconsistency: "+s+", caching startDate: "+e+", caching endDate: "+t);c.forEach((e,t)=>{const n=e,r=d[t];if(n.getTime()>r.getTime())throw new Error("Recurrent interval inconsistency: "+s+", startDate: "+e+", endDate: "+d[t]);this.intervalCache.addInterval(n,r,e=>e.includeInterval(s))})})}clear(){this.staticIntervalsCached=!1,super.clear()}cacheStaticIntervals(){this.forEachStaticInterval(e=>{this.intervalCache.addInterval(e.startDate,e.endDate,t=>t.includeInterval(e))})}forEachStaticInterval(e){this.intervalStore.forEach(t=>{t.isStatic()&&e(t)})}forEachRecurrentInterval(e){this.intervalStore.forEach(t=>{t.isRecurrent()&&e(t)})}}var eg=function(e,t,n,r){var s,i=arguments.length,o=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(i<3?s(o):i>3?s(t,n,o):s(t,n))||o);return i>3&&o&&Object.defineProperty(t,n,o),o};const tg=e=>{class t extends e{getCalendar(){return this.stores[0].calendar}resetPriority(){this.priorityField=null}getPriorityField(){if(null!=this.priorityField)return this.priorityField;let e=1e4+100*this.getCalendar().getDepth(),t=this.priority;return null==t&&(t=this.isRecurrent()?20:30),this.priorityField=e+t}isRecurrent(){return Boolean(this.recurrentStartDate&&this.recurrentEndDate&&this.getStartDateSchedule()&&this.getEndDateSchedule())}isStatic(){return Boolean(this.startDate&&this.endDate)}parseDateSchedule(e){if(e&&e!==Object(e)&&((e=Zh.parse.text(e))!==Object(e)||e.error>0))try{e=JSON.parse(e)}catch(t){return null}return e}getStartDateSchedule(){if(this.startDateSchedule)return this.startDateSchedule;const e=this.parseDateSchedule(this.recurrentStartDate);return this.startDateSchedule=Zh.schedule(e)}getEndDateSchedule(){if(this.endDateSchedule)return this.endDateSchedule;const e=this.parseDateSchedule(this.recurrentEndDate);return this.endDateSchedule=Zh.schedule(e)}}return eg([Ad({type:"date",dateFormat:"YYYY-MM-DDTHH:mm:ssZ"},{converter:Ld})],t.prototype,"startDate",void 0),eg([Ad({type:"date",dateFormat:"YYYY-MM-DDTHH:mm:ssZ"},{converter:Ld})],t.prototype,"endDate",void 0),eg([Ad({type:"string"})],t.prototype,"recurrentStartDate",void 0),eg([Ad({type:"string"})],t.prototype,"recurrentEndDate",void 0),eg([Ad({type:"boolean",defaultValue:!1})],t.prototype,"isWorking",void 0),eg([Ad({type:"number"})],t.prototype,"priority",void 0),t},ng=(e=Sr)=>tg(Bd(_d(jd(cd(e)))));class rg extends(ng()){}class sg extends(Nd(_d(Nr))){static get defaultConfig(){return{modelClass:rg}}}class ig extends rg{getCalendar(){return this.calendar}getPriorityField(){return null!=this.priorityField?this.priorityField:this.priorityField=this.getCalendar().getDepth()}}!function(e,t,n,r){var s,i=arguments.length,o=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(i<3?s(o):i>3?s(t,n,o):s(t,n))||o);i>3&&o&&Object.defineProperty(t,n,o)}([Ad({type:"number",defaultValue:10})],ig.prototype,"priority",void 0);var og=function(e,t,n,r){var s,i=arguments.length,o=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(i<3?s(o):i>3?s(t,n,o):s(t,n))||o);return i>3&&o&&Object.defineProperty(t,n,o),o};const ag=Symbol("CalendarMixin"),lg=e=>{class t extends e{constructor(){super(...arguments),this.version=1}[ag](){}*calculateSelf(){return yield this.$.version,this}afterConstruct(){super.afterConstruct();const e=this.hoursPerDay,t=this.daysPerMonth;this.unitsInMs={millisecond:1,second:1e3,minute:6e4,hour:36e5,day:60*e*60*1e3,week:this.daysPerWeek*e*60*60*1e3,month:t*e*60*60*1e3,quarter:3*t*e*60*60*1e3,year:12*t*e*60*60*1e3},this.intervalStore=new sg({calendar:this}),this.intervals&&this.intervals.length&&this.addIntervals(this.intervals),this.clearCache()}isDefault(){const e=this.getProject();return!!e&&this===e.defaultCalendar}getDepth(){return this.childLevel+1}forEachAvailabilityInterval(e,t,n){return this.calendarCache.forEachAvailabilityInterval(e,t,n)}accumulateWorkingTime(e,t,n,r){if(0===t)return{finalDate:new Date(e),remainingDurationInMs:0};if(isNaN(t))throw new Error("Invalid duration");let s=this.convertDuration(t,n,Xd.Millisecond),i=e;return this.forEachAvailabilityInterval(r?{startDate:e,isForward:!0}:{endDate:e,isForward:!1},(e,t,n)=>{let o=!0;if(n.getIsWorking()){const n=e.getTimezoneOffset()-t.getTimezoneOffset(),a=t.getTime()-e.getTime()+60*n*1e3;s<=a?(i=r?new Date(e.getTime()+s):new Date(t.getTime()-s),s=0,o=!1):(i=r?t:e,s-=a)}return o}),{finalDate:new Date(i),remainingDurationInMs:s}}calculateDuration(e,t,n){let r=0;return this.forEachAvailabilityInterval({startDate:e,endDate:t},(e,t,n)=>{if(n.getIsWorking()){const n=e.getTimezoneOffset()-t.getTimezoneOffset();r+=t.getTime()-e.getTime()+60*n*1e3}}),this.convertDuration(r,Xd.Millisecond,n)}calculateEndDate(e,t,n){const r=this.accumulateWorkingTime(e,t,n,!0);return 0===r.remainingDurationInMs?r.finalDate:null}calculateStartDate(e,t,n){const r=this.accumulateWorkingTime(e,t,n,!1);return 0===r.remainingDurationInMs?r.finalDate:null}skipNonWorkingTime(e,t=!0){let n;return this.forEachAvailabilityInterval(t?{startDate:e,isForward:!0}:{endDate:e,isForward:!1},(e,r,s)=>{if(s.getIsWorking())return n=t?e:r,!1}),n?new Date(n):new Date(e)}convertDuration(e,t,n){let r=e;return t!==n&&(r=e*this.unitsInMs[t]/this.unitsInMs[n]),r}addInterval(e){return this.addIntervals([e])}addIntervals(e){return this.bumpVersion(),this.intervalStore.add(e)}bumpVersion(){this.clearCache(),this.version++}clearCache(){this.calendarCache&&this.calendarCache.clear();const e=new ig({isWorking:this.unspecifiedTimeIsWorking});e.calendar=this,this.calendarCache=new Qh({calendar:this,unspecifiedTimeInterval:e,intervalStore:this.intervalStore,parentCache:this.parent&&!this.parent.isRoot?this.parent.calendarCache:null})}resetPriorityOfAllIntervals(){this.traverse(e=>{e.intervalStore.forEach(e=>e.resetPriority())})}appendChild(e){let t=super.appendChild(e);return Array.isArray(t)||(t=[t]),t.forEach(e=>{e.bumpVersion(),e.resetPriorityOfAllIntervals()}),t}insertChild(e,t){let n=super.insertChild(e,t);return Array.isArray(n)||(n=[n]),n.forEach(e=>{e.bumpVersion(),e.resetPriorityOfAllIntervals()}),n}joinProject(){super.joinProject(),this.intervalStore.setProject(this.getProject())}leaveProject(){super.leaveProject(),this.intervalStore.setProject(null)}}return og([gd({persistent:!1})],t.prototype,"version",void 0),og([Ad({type:"string"})],t.prototype,"name",void 0),og([Ad({type:"number",defaultValue:24})],t.prototype,"hoursPerDay",void 0),og([Ad({type:"number",defaultValue:7})],t.prototype,"daysPerWeek",void 0),og([Ad({type:"number",defaultValue:30})],t.prototype,"daysPerMonth",void 0),og([Ad({type:"boolean",defaultValue:!0})],t.prototype,"unspecifiedTimeIsWorking",void 0),og([Ad()],t.prototype,"intervals",void 0),t},cg=(e=Sr)=>lg(Bd(_d(cd(e))));class dg extends(cg()){}const ug=(e=Nr)=>(e=>(class extends e{static get defaultConfig(){return{tree:!0,modelClass:dg}}}))(Nd(_d(Ku(e))));class hg extends(ug()){}const gg=e=>(class extends e{constructor(){super(...arguments),this.projectRefreshThreshold=500}async propagate(e,t=!1){const n=this.project;let r;return this.isPropagating?r=await super.propagate(e,t):(n.trigger("propagationStart",{dryRun:!!t}),r=await super.propagate(e,t),n.trigger("propagationComplete",{dryRun:!!t,result:r})),r}commit(){const e=this.project,t=this.changedAtoms,n=new Set(t.map(e=>e.self));n.forEach(e=>e.beginBatch()),e.trigger("beforeCommit",{records:n,changedAtoms:t}),super.commit(),e.trigger("commit",{records:n,changedAtoms:t});const r=n.size>this.projectRefreshThreshold;n.forEach(e=>e.endBatch(r)),r&&e.trigger("refresh",{records:n})}async onEffect(e){const t=this.project;return e instanceof fh?t.hasListener("schedulingconflict")?new Promise((n,r)=>{t.trigger("schedulingconflict",{conflict:e,continueWithResolutionResult:n})}):Promise.resolve(Dc.Resume):super.onEffect(e)}});var mg=function(e,t,n,r){var s,i=arguments.length,o=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(i<3?s(o):i>3?s(t,n,o):s(t,n))||o);return i>3&&o&&Object.defineProperty(t,n,o),o};const pg=e=>{class t extends e{construct(e={}){this.replica=gg(ad).new({project:this,schema:Kh.new()}),e.hasOwnProperty("expanded")||(e.expanded=!0);const t=Boolean(e.calendarManagerStore||e.eventStore||e.dependencyStore||e.resourceStore||e.assignmentStore);super.construct(e),this.eventModelClass||(this.eventModelClass=Bh),this.eventStoreClass||(this.eventStoreClass=qh),this.dependencyModelClass||(this.dependencyModelClass=sh),this.dependencyStoreClass||(this.dependencyStoreClass=dh),this.resourceModelClass||(this.resourceModelClass=Yd),this.resourceStoreClass||(this.resourceStoreClass=mh),this.assignmentModelClass||(this.assignmentModelClass=Yu),this.assignmentStoreClass||(this.assignmentStoreClass=Ju),this.calendarModelClass||(this.calendarModelClass=dg),this.calendarManagerStoreClass||(this.calendarManagerStoreClass=hg),this.replica.addEntity(this),this.stm=new xi({disabled:!0}),this.calendarManagerStore?this.setCalendarManagerStore(this.calendarManagerStore):this.calendarManagerStore=new this.calendarManagerStoreClass({modelClass:this.calendarModelClass,idField:"id",project:this,stm:this.stm}),this.defaultCalendar=new this.calendarManagerStore.modelClass({hoursPerDay:24,daysPerWeek:7,daysPerMonth:30,unspecifiedTimeIsWorking:this.unspecifiedTimeIsWorking}),this.defaultCalendar.project=this,this.eventStore?this.setEventStore(this.eventStore):this.eventStore=new this.eventStoreClass({modelClass:this.eventModelClass,tree:!0,idField:"id",project:this,stm:this.stm}),this.dependencyStore?this.setDependencyStore(this.dependencyStore):this.dependencyStore=new this.dependencyStoreClass({modelClass:this.dependencyModelClass,idField:"id",project:this,stm:this.stm}),this.resourceStore?this.setResourceStore(this.resourceStore):this.resourceStore=new this.resourceStoreClass({modelClass:this.resourceModelClass,idField:"id",project:this,stm:this.stm}),this.assignmentStore?this.setAssignmentStore(this.assignmentStore):this.assignmentStore=new this.assignmentStoreClass({modelClass:this.assignmentModelClass,idField:"id",project:this,stm:this.stm});const n=Boolean(this.calendarsData||this.eventsData||this.dependenciesData||this.resourcesData||this.assignmentsData);n&&(this.loadInlineData({calendarsData:this.calendarsData,eventsData:this.eventsData,dependenciesData:this.dependenciesData,resourcesData:this.resourcesData,assignmentsData:this.assignmentsData}),delete this.calendarsData,delete this.eventsData,delete this.dependenciesData,delete this.resourcesData,delete this.assignmentsData),t&&!n&&this.propagate()}loadInlineData(e){return e.calendarsData&&(this.calendarManagerStore.data=e.calendarsData),e.eventsData&&(this.eventStore.data=e.eventsData),e.dependenciesData&&(this.dependencyStore.data=e.dependenciesData),e.resourcesData&&(this.resourceStore.data=e.resourcesData),e.assignmentsData&&(this.assignmentStore.data=e.assignmentsData),this.propagate()}getGraph(){return this.replica}getStm(){return this.stm}calculateProject(){return this}*calculateCalendar(e){let t=yield*super.calculateCalendar(e);return t||(t=this.defaultCalendar,yield t.$$),t}joinStoreRecords(e){const t=e=>{e.setProject(this),e.joinProject()};e.rootNode?e.rootNode.traverse(t):e.forEach(t)}setEventStore(e){this.eventStore&&this.stm.hasStore(this.eventStore)&&this.stm.removeStore(this.eventStore),this.eventStore=e,e&&(e.setProject(this),this.stm.addStore(e),e.rootNode!==this&&(this.appendChild(e.rootNode.children||[]),e.rootNode=this),this.joinStoreRecords(e))}setDependencyStore(e){this.dependencyStore&&this.stm.hasStore(this.dependencyStore)&&this.stm.removeStore(this.dependencyStore),this.dependencyStore=e,e&&(e.setProject(this),this.stm.addStore(e),this.joinStoreRecords(e))}setResourceStore(e){this.resourceStore&&this.stm.hasStore(this.resourceStore)&&this.stm.removeStore(this.resourceStore),this.resourceStore=e,e&&(e.setProject(this),this.stm.addStore(e),this.joinStoreRecords(e))}setAssignmentStore(e){this.assignmentStore&&this.stm.hasStore(this.assignmentStore)&&this.stm.removeStore(this.assignmentStore),this.assignmentStore=e,e&&(e.setProject(this),this.stm.addStore(e),this.joinStoreRecords(e))}setCalendarManagerStore(e){this.calendarManagerStore&&this.stm.hasStore(this.calendarManagerStore)&&this.stm.removeStore(this.calendarManagerStore),this.calendarManagerStore=e,e&&(e.setProject(this),this.stm.addStore(e),this.joinStoreRecords(e))}*calculateStartDateInitial(){const e=this.$.startDate.proposedValue;return void 0!==e?e:this.$.startDate.getConsistentValue()?this.startDate:yield*this.calculateInitialMinChildrenStartDateDeep()}*calculateEndDateInitial(){const e=this.$.endDate.proposedValue;return void 0!==e?e:this.$.endDate.getConsistentValue()}*calculateEarlyStartDateConstraintIntervals(){const e=[],t=yield this.$.startDateInitial;return t&&e.push(Sh.new({originDescription:"the project start date",startDate:t})),e}*calculateEarlyEndDateConstraintIntervals(){return[]}*calculateLateStartDateConstraintIntervals(){return[]}*calculateLateEndDateConstraintIntervals(){const e=[],t=yield this.$.endDateInitial;return t&&e.push(Sh.new({originDescription:"the project end date",endDate:t})),e}*calculateStartDate(e){return e||this.$.startDate.getConsistentValue()||(yield this.$.startDateInitial)}*calculateCriticalPaths(){const e=[],t=[],n=[...yield this.$.childEvents],r=yield this.$.endDate;let s,i;for(;s=n.shift();){const e=yield s.$.childEvents,i=yield s.$.critical;s.endDate-r==0&&i&&t.push([{event:s}]),n.push(...e)}for(;i=t.shift();){let n,r=i.length-1;for(;n=i[r];){const e=[];for(const t of yield n.event.$.incomingDeps){const n=yield t.$.fromEvent;n&&(yield n.$.critical)&&e.push({event:n,dependency:t})}if(e.length){const n=i.slice();i.push(e[0]);for(var o=1;o<e.length;o++)t.push(n.concat(e[o]));r++}else r=-1}e.push(i.reverse())}return e}}return mg([Ad({type:"boolean",defaultValue:!0})],t.prototype,"unspecifiedTimeIsWorking",void 0),mg([Ad({type:"string",defaultValue:Qd.ToEvent})],t.prototype,"dependenciesCalendar",void 0),mg([Ad({type:"boolean",defaultValue:!0})],t.prototype,"autoCalculatePercentDoneForParentTasks",void 0),mg([gd()],t.prototype,"criticalPaths",void 0),mg([md("criticalPaths")],t.prototype,"calculateCriticalPaths",null),t},fg=(e=Sr)=>pg(fu(Lh(Th(Mh($d(Bd(_d(jd(cd(ue(e))))))))))),vg=".b-task-baseline";To.registerFeature(function(){class e extends nl{static get defaultConfig(){return{cls:"b-gantt-task-tooltip",align:"t-b",forSelector:vg,recordType:"baseline"}}construct(e,t){const n=this;n.tipId=`${e.id}-baselines-tip`,n.gantt=e,super.construct(e,t),n.ganttDetatcher=e.on({taskpaint:"onTaskPaint",taskrepaint:"onTaskPaint",taskDrag:"onTaskDrag",afterTaskDrop:"onAfterTaskDrop",thisObj:n}),n.storeDetacher=e.taskStore.on({update:{fn:"onStoreUpdateRecord",thisObj:n,prio:1e3}}),n.updateHostClasslist()}updateHostClasslist(){this.gantt.element.classList[this.disabled?"remove":"add"]("b-show-baselines")}doDestroy(){this.ganttDetatcher&&this.ganttDetatcher(),this.storeDetacher&&this.storeDetacher(),super.doDestroy()}onAfterTaskDrop({valid:e}){e||this.monitorBaselineSync(300)}onStoreUpdateRecord({record:e,changes:t}){(t.startDate||t.endDate)&&this.gantt.getElementFromTaskRecord(e)&&this.monitorBaselineSync(300)}monitorBaselineSync(e){this.baselineMonitor&&this.baselineMonitor.cancel(),this.baselineMonitor=At.animate(e,this.syncAllBaselines,this)}syncAllBaselines(){!this.isDestroyed&&this.gantt.taskStore.forEach(e=>this.syncTaskBaselines(e))}resolveTimeSpanRecord(e){const t=this.client.resolveTimeSpanRecord(e),n=e.closest(vg);if(t&&n)return t.baselines.getAt(parseInt(n.dataset.index))}template(e){const t=this,{baseline:n}=e,{task:r}=n;let{decimalPrecision:s}=t;null==s&&(s=t.client.durationDisplayPrecision);const i=Math.pow(10,s),o=Math.round(n.duration*i)/i;return`\n            <div class="b-gantt-task-title">${r.name} (baseline ${n.parentIndex+1})</div>\n            <table>\n            <tr><td>${t.L("Start")}:</td><td>${e.startClockHtml}</td></tr>\n            ${n.milestone?"":`\n                <tr><td>${t.L("End")}:</td><td>${e.endClockHtml}</td></tr>\n                <tr><td>${t.L("Duration")}:</td><td class="b-right">${o+" "+Ne.getLocalizedNameOfUnit(n.durationUnit,1!==n.duration)}</td></tr>\n            `}\n            </table>\n            `}get disabled(){return this._disabled}set disabled(e){const t=this,{dependencies:n}=t.client.features;t._disabled=e,t.tooltip&&(t.tooltip.disabled=e),t.updateHostClasslist(),n&&t.client.setTimeout(()=>n.scheduleDraw(!0),300)}onTaskDrag({taskRecords:e,dragData:t}){const n=e[0],r=t.context,s=this.gantt.currentOrientation.cache.getRenderedTimeSpan(n.id);this.syncTaskBaselines(n,Object.setPrototypeOf({left:r.newX},s),t.context.grabbed)}onTaskPaint({taskData:e,taskRecord:t,element:n}){const r=this,{gantt:s}=r;s.isAnimating?s.on({transitionend(){r.syncTaskBaselines(t,e,n)},once:!0}):r.syncTaskBaselines(t,e,n)}syncTaskBaselines(e,t,n){if(t||(t=this.gantt.currentOrientation.cache.getRenderedTimeSpan(e.id)),t&&t.layoutCache){let r=!1;n||(n=t.layoutCache&&t.layoutCache.div,r=!0);const{gantt:s}=this,i=s.currentOrientation,o=e.baselines.allRecords,a=o.length,l=n.baselineElements||(n.baselineElements=[]),c=l.slice(a),d=r?yt.getOffsetX(n,s.timeAxisSubGridElement)+s.timeAxisSubGrid.scrollable.x:t.left;if(c.length)c.forEach(e=>e.remove()),l.length=a;else for(let e=l.length;e<o.length;e++)l.push(yt.createElement({dataset:{index:e},parent:n}));if(o.length&&l[0].parentNode!==n){const e=document.createDocumentFragment();for(let t=0;t<o.length;t++)e.appendChild(l[t]);n.insertBefore(e,t.layoutCache.eventEl.nextSibling)}if(a)for(let t=0;t<a;t++){const n=o[t],r=i.getTimeSpanRenderData(n,e,{viewport:!0});l[t].className=n.cls+"b-task-baseline",l[t].style=r?`width:${r.width}px;left:${r.left-d}px`:"width:0"}}}}return e._$name="Baselines",e}(),!1,"Gantt");const yg=function(){class e extends ea{async onEditComplete(){const e=this,{record:t,dataField:n,inputField:r,oldValue:s,lastAlignSpec:i,owner:o}=e,{target:a}=i;let{value:l}=r;if(r instanceof Cc){if(!e.isFinishing){if(e.isFinishing=!0,e.hide(),t&&l){l=l.slice();const r=o.dependencyStore,i=l.filter(e=>!e.project),a=[];if(await async function e(){const t=i.shift();t&&(a.push(await r.isValidDependency({fromEvent:t.fromEvent,toEvent:t.toEvent,lag:t.lag,lagUnit:t.lagUnit,type:t.type})),await e())}(),a.every(e=>e)){const r=`set${$.capitalizeFirstLetter(n)}`;t[r]?t[r](l):t[n]=l,e.trigger("completeAsync",{value:l,oldValue:s})}else e.trigger("cancelAsync",{value:l,oldValue:s})}e.trigger("complete",{value:l,oldValue:s}),1===a.nodeType&&a.classList.remove("b-editing"),e.isFinishing=!1}}else super.onEditComplete()}}return e._$name="Editor",e}();E.register("gantteditor",yg),To.registerFeature(function(){class e extends ra{static get defaultConfig(){return{editorClass:yg}}getEditorListeners(){return Object.assign(super.getEditorListeners(),{completeasync:"onEditorCompleteAsync",cancelasync:"onEditorCancelAsync"})}onEditorCompleteAsync({source:e}){const{grid:t}=this;t.trigger("finishCellEditAsync",{grid:t,editorContext:e.cellEditorContext})}onEditorCancelAsync({source:e}){const{grid:t}=this;t.trigger("cancelCellEditAsync",{grid:t,editorContext:e.cellEditorContext})}getAdjacentEditableCell(e,t){let n=this.addNewAtEnd,r=this.grid,s=r.store,i=e.id,o=e.columnId,a=r.columns,l=a.getAdjacentLeaf(o,t);for(;i;){const r=s.getById(i);if(l){if(o=l.id,!l.hidden&&l.editor&&l.canEdit(r))return{id:i,columnId:l.id};l=a.getAdjacentLeaf(o,t)}else{let r=s.getAdjacent(e.id,t,!1,!0);if(!r&&t&&n)return this.doAddNewAtEnd().then(()=>{const t=this.getAdjacentEditableCell(e,!0);t&&this.startEditing(t)}),this.finishEditing(),null;i=r&&r.id,r&&(l=t?a.first:a.leaves[a.leaves.length-1])}}return null}async doAddNewAtEnd(){const e=this.addNewAtEnd,t=this.grid,n=t.taskStore,r=t.rowManager,s=n.rootNode.appendChild(Object.assign({name:"New task",startDate:n.getProject().startDate},e));return await n.getProject().propagate(),r.getRowFor(s)||r.displayRecordAtBottom(),s}}return e._$name="CellEdit",e}(),!0),To.registerFeature(function(){class e extends(U(ur)){static get defaultConfig(){return{cls:"b-gantt-critical-paths",criticalDependencyCls:"b-critical",disabled:!0}}static get pluginConfig(){return{chain:["render"]}}render(){this.client.project.on({commit:this.onProjectCommit,thisObj:this})}getDependenciesFeature(){const e=this.client;return e.foregroundCanvas&&e.features.dependencies}highlightCriticalPaths(){const e=this,t=e.client,n=t.project,r=e.getDependenciesFeature();t.element.classList.contains(e.cls)&&e.unhighlightCriticalPaths(),r&&n.criticalPaths.forEach(t=>{t.forEach(t=>{t.dependency&&r.highlight(t.dependency,e.criticalDependencyCls)})}),t.element.classList.add(e.cls),e.client.trigger("criticalPathsHighlighted")}unhighlightCriticalPaths(){const e=this,t=e.client,n=t.project,r=e.getDependenciesFeature();r&&n.dependencyStore.forEach(t=>r.unhighlight(t,e.criticalDependencyCls)),t.element.classList.remove(e.cls),e.client.trigger("criticalPathsUnhighlighted")}onProjectCommit({records:e,changedAtoms:t}){const n=this.client.project;!this.disabled&&e.has(n)&&t.includes(n.$.criticalPaths)&&this.highlightCriticalPaths()}get disabled(){return super.disabled}set disabled(e){super.disabled=e,e?this.unhighlightCriticalPaths():this.highlightCriticalPaths()}}return e._$name="CriticalPaths",e}(),!0,"Gantt");const bg=function(){class e{constructor(e){this.taskRendering=e,this.renderedTasksMap={},this.rowLayoutCache={}}clear(e=!1){const t=this;t.renderedTasksMap={},Object.keys(t.rowLayoutCache).forEach(n=>t.clearRow(n,e)),e&&t.taskRendering.clearAllDivs()}addRenderedTask(e,t){this.renderedTasksMap[e]=t}getRenderedTimeSpan(e){return this.renderedTasksMap[e]}getTimeSpan(e){const t=this.rowLayoutCache[e];return t?t.layoutCache:null}clearTask(e,t=!1,n=!1){const r=this.getTimeSpan(e,e);if(!r)return null;r.div&&this.taskRendering.clearDiv(r.div,t,n),this.rowLayoutCache[e].layoutCache=null}changeRowId(e,t){const n=this.getRow(e);n&&(delete this.rowLayoutCache[e],this.addRow(t,n))}getRow(e){return this.rowLayoutCache[e]}addRow(e,t){this.rowLayoutCache[e]=t}clearRow(e,t=!1,n=!1){const r=this;r.rowLayoutCache[e]&&(r.renderedTasksMap[e]&&delete r.renderedTasksMap[e],r.clearTask(e,t,n),delete r.rowLayoutCache[e])}}return e._$name="TaskCache",e}(),Cg=function(){class e extends Jl{construct(e){this.gantt=e,super.construct(e),this.cache=new bg(this)}bindTaskStore(e){const t=this;t.taskStoreDetacher&&t.taskStoreDetacher(),t.taskStoreDetacher=e.on({thisObj:t,add:t.onTaskStoreAdd,remove:t.onTaskStoreRemove,update:t.onTaskStoreUpdate,idChange:t.onTaskStoreIdChange,refresh:t.onTaskStoreRefresh,removeall:t.onTaskStoreRefresh,prio:1})}clearCacheBelowTask(e){const{gantt:t}=this,{taskStore:n}=t;let r=t.getRowFor(e);for(;!r&&(e=n.getNext(e));)r=t.getRowFor(e);if(r)for(;e&&t.getRowFor(e);)this.cache.clearRow(e.id),e=n.getNext(e)}onTaskStoreAdd({records:e,isExpand:t,isChild:n}){t||n&&!e[0].parent.isExpanded(this.gantt.taskStore)||this.clearCacheBelowTask(e[0])}onTaskStoreIdChange({oldValue:e,value:t}){this.cache.changeRowId(e,t)}onTaskStoreUpdate({record:e}){const t=this,{id:n}=e;if(t.cache.getRow(n)){const r=t.getTimeSpanRenderData(e,e),s=Boolean(r&&t.isEventInView(r));t.gantt.runWithTransition(()=>t.cache.clearRow(n,!1,s),t.gantt.transitionDuration)}}onTaskStoreRemove({allRecords:e,isCollapse:t,index:n}){if(!t&&-1!==n){e.forEach(e=>{this.cache.clearRow(e.id,!0)});const t=this.gantt.taskStore.getAt(Math.max(n,0));t&&this.clearCacheBelowTask(t)}}onTaskStoreRefresh(){this.cache.clear()}onTranslateRow({source:e}){const t=e.id;if(t){const n=this,r=n.cache.getRow(t);if(r&&r.rowTop!==e.top){const t=e.top-r.rowTop,s=r.layoutCache;s.top+=t,s.bottom+=t,s.div&&n.positionEvent(s.div,s.start,s.top),r.top+=t,r.rowTop=e.top}}}calculateMS(e){const t=e.startDate.getTime(),n=e.endDate.getTime();return{startMS:t,endMS:n,durationMS:n-t}}generateTplData(e){const{gantt:t}=this,n=this.getTimeSpanRenderData(e,e,{viewport:!0});let r="";if(n){let s=void 0===e.isResizable||e.isResizable;n.startsOutsideView&&(!0===s?s="end":"start"===s&&(s=!1)),n.endsOutsideView&&(!0===s?s="start":"end"===s&&(s=!1)),n.cls=e.isResourceTimeRange?new Ai:e.cls.clone(),Object.assign(n.cls,{[t.eventCls]:1,[t.generatedIdCls]:e.hasGeneratedId,[t.dirtyCls]:e.modifications,[t.committingCls]:e.isCommitting,[t.endsOutsideViewCls]:n.endsOutsideView,[t.startsOutsideViewCls]:n.startsOutsideView,[t.fixedEventCls]:!1===e.isDraggable,[`b-sch-event-resizable-${s}`]:1,"b-milestone":e.milestone,"b-critical":e.critical,"b-task-started":e.percentDone>0,"b-task-finished":e.isCompleted,"b-task-selected":t.selectedRecords.includes(e)}),n.iconCls=new Ai(e.get(t.eventBarIconClsField)||e.iconCls),n.id=t.getEventRenderId(e),n.style=e.style||"",n.taskId=e.id,n.wrapperCls=new Ai({[t.eventCls+"-wrap"]:1,[`${t.eventCls}-parent`]:e.isParent,"b-milestone-wrap":e.milestone,"b-has-baselines":e.hasBaselines});const i=e.eventStyle||t.eventStyle;if(n.eventColor=e.eventColor||t.eventColor,n.eventStyle=i,t.taskRenderer){const s=t.taskRenderer.call(t.taskRendererThisObj||t,{taskRecord:e,tplData:n});"string"==typeof n.cls&&(n.cls=new Ai(n.cls)),"string"==typeof n.iconCls&&(n.iconCls=new Ai(n.iconCls)),r=t.taskBodyTemplate&&t.taskBodyTemplate(s)||(null==s?"":String(s))}else t.taskBodyTemplate&&(r=t.taskBodyTemplate(e));n.cls["b-sch-event-withicon"]=n.iconCls.length,n.wrapperCls[`b-sch-style-${n.eventStyle}`]=n.eventStyle,n.eventColor&&n.eventColor.startsWith("#")?n.style=`background-color:${n.eventColor};`+n.style:n.wrapperCls[`b-sch-color-${n.eventColor}`]=n.eventColor,t.taskBodyTemplate||(e.milestone&&r&&(r=`<label>${r}</label>`),n.iconCls&&n.iconCls.length&&(r=`<i class="${n.iconCls}"></i>${r}`)),r.includes("<")?n.body=yt.createElementFromTemplate(r,{fragment:!0}):(n.body=document.createDocumentFragment(),n.body.textContent=r)}return t.onTaskDataGenerated(n),n}layoutTask(e,t,n){const r=this,s=t.id;if(!r.timeAxis.isTimeSpanInAxis(t))return r.cache.clearRow(s),!1;const i=r.generateTplData(t);let o=r.gantt.rowHeight||0,a=n.top;o!==n.height&&n.estimatedTop&&(a=n.top+n.height-o);const l=r.cache.getTimeSpan(s),c=i.top;return i.top+=a,i.rowTop=a,i.layoutCache={layout:!0,div:l&&l.div,eventEl:l&&l.eventEl,width:i.width,height:i.height,start:i.left,end:i.left+i.width,relativeTop:c,top:i.top,relativeBottom:c+i.height,bottom:i.top+i.height},r.cache.addRow(s,i),!0}triggerPaint(e,t,n=!1){const{gantt:r}=this;r.trigger(n?"taskRepaint":"taskPaint",{taskData:e,taskRecord:e.task,element:t})}renderTask(e){const{cache:t}=this,n=t.getTimeSpan(e.taskId),r=t.getRenderedTimeSpan(e.taskId);this.renderTimeSpan(e,n,r),t.addRenderedTask(e.id,e)}updateRowTimeSpans(e,t,n=!1){const r=this.gantt,s=this.cache,i=t.id;let o=s.getRow(i);(!r.forceLayout&&!n&&o||this.layoutTask(r,t,e))&&(o=s.getRow(i))&&(s.addRenderedTask(i,o),this.renderTask(o))}renderer(e){this.updateRowTimeSpans(e.row,e.record),e.size.height=this.gantt.rowHeight}clearDiv(e,t,n){!t||n?this.releaseTimeSpanDiv(e,n):(e.style.opacity=0,this.setTimeout(()=>{e.remove(),e.style.opacity=1},200))}clearAllDivs(){this.availableDivs.forEach(e=>e.remove()),this.availableDivs.length=0,this.availableDivsById={}}getConnectorStartSide(e){return"left"}getConnectorEndSide(e){return"right"}isEventInView(e){const t=this.view.timeAxis.startDate,n=this.view.timeAxis.endDate;return e.startMs===e.endMs?e.startMs<=n&&e.endMs>t:e.startMs<n&&e.endMs>t}}return e._$name="TaskRendering",e}(),wg=/-/g;var Sg=e=>(class extends(e||W){resolveEventRecord(e){return this.resolveTaskRecord(e)}resolveTaskRecord(e){return(e=yt.up(e,this.eventSelector))?this.getTaskRecordFromDomId(e.id):null}getTaskRecordFromDomId(e){return e=this.getTaskIdFromDomNodeId(e),this.taskStore.getById(e)}getTaskIdFromDomNodeId(e){return e.substr(this.id.toString().length+1)}getElementFromTaskRecord(e){const t=this.currentOrientation.cache.getRenderedTimeSpan(e.id);if(t&&t.layoutCache)return t.layoutCache.eventEl}getElementFromEventRecord(e){return this.getElementFromTaskRecord(e)}getEventRenderId(e){return`${this.id.toString().replace(wg,"_")}-${e.id}`}get widgetClass(){}}),Dg=e=>(class extends(e||W){getScheduleRegion(e,t){const n=this,r=n.timeAxisSubGridElement;let s;if(e){const t=n.getElementFromTaskRecord(e);if(s=oe.from(n.getRowById(e.id).getElement("locked")),t){const e=oe.from(t,r);s.y=e.y,s.bottom=e.bottom}else s.y=s.y+n.barMargin,s.bottom=s.bottom-n.barMargin}else(s=oe.from(r).moveTo(null,0)).width=r.scrollWidth,s.y=s.y+n.barMargin,s.bottom=s.bottom-n.barMargin;const i=n.timeAxis.startDate,o=n.timeAxis.endDate,a=n.getDateConstraints(e)||{start:i,end:o},l=s.y,c=s.bottom;let d=n.getCoordinateFromDate(Ne.max(i,a.start)),u=n.getCoordinateFromDate(Ne.min(o,a.end));return t||(d=n.currentOrientation.translateToPageCoordinate(d),u=n.currentOrientation.translateToPageCoordinate(u)),{top:l,right:Math.max(d,u),bottom:c,left:Math.min(d,u)}}isRowVisible(e){return this.store.indexOf(e)>=0}getTaskBox(e,t=!1,n=!1){const r=this;let s,i=r.currentOrientation.cache.getTimeSpan(e.id);if(i){if(!n)return i;s=i.eventEl}const o=r.timeAxis.startDate,a=r.timeAxis.endDate,l=e.startDate,c=e.endDate;let d=null;if(l&&c&&(t||Ne.intersectSpans(l,c,o,a))&&this.isRowVisible(e)){if(n){s||(s=r.getElementFromTaskRecord(e));const t=s&&oe.from(s,r.timeAxisSubGridElement);if(t)return t.moveTo(yt.getTranslateX(s.parentNode)),{layout:!0,start:t.x,end:t.right,top:t.y,bottom:t.bottom}}let t,i,u=e.milestone?r.features.dependencies.pathFinder.startArrowMargin:0;d={layout:!1,start:t=l<o?r.getCoordinateFromDate(o)-u:l>a?r.getCoordinateFromDate(a)+u:r.getCoordinateFromDate(l),end:i=c<o?r.getCoordinateFromDate(o)-u:c>a?r.getCoordinateFromDate(a)+u:r.getCoordinateFromDate(c)};const h=r.rowManager.getRecordCoords(e,!0);d.top=h.y+r.barMargin,d.height=Math.max(r.rowManager.rowHeight-2*r.barMargin,1),d.bottom=d.top+d.height}return d}get widgetClass(){}});const Eg={block:"nearest",edgeOffset:20};var xg=e=>(class extends(e||W){scrollTaskIntoView(e,t=Eg){let n,r=this,s=e.startDate,i=e.endDate,o=s<r.timeAxis.startDate|(i>r.timeAxis.endDate)<<1;if(null==t.edgeOffset&&(t.edgeOffset=20),o&&!1!==t.extendTimeAxis){let t,n,a=r.timeAxis.endDate-r.timeAxis.startDate;3===o?r.timeAxis.setTimeSpan(new Date(s.valueOf()-a/2),new Date(i.getTime()+a/2)):(t=r.getCoordinateFromDate(1&o?i:s),1&o?r.timeAxis.setTimeSpan(new Date(s),new Date(s.valueOf()+a)):r.timeAxis.setTimeSpan(new Date(i.valueOf()-a),new Date(i)),n=r.getCoordinateFromDate(1&o?e.endDate:e.startDate),r.timeAxisSubGrid.scrollable.scrollBy(n-t))}return(n=r.getElementFromTaskRecord(e))?r.timeAxisSubGrid.scrollable.scrollIntoView(n,We.assign({silent:!0},t)):r.scrollUnrenderedTaskIntoView(e,t)}scrollUnrenderedTaskIntoView(e,t=Eg){null==t.edgeOffset&&(t.edgeOffset=20);const n=this,r=n.timeAxisSubGrid.scrollable,s=n.getTaskBox(e),i=r.viewport,o=new oe(s.start,s.top,s.end-s.start,s.bottom-s.top).translate(i.x-r.x,i.y-r.y);let a=r.scrollIntoView(o,Object.assign({},t,{highlight:!1}));if(t.highlight||t.focus){const r=n.on({taskpaint({taskRecord:n,element:s}){n===e&&(r(),a=a.then(()=>{t.highlight&&yt.highlight(s),t.focus&&s.focus()}))}})}else a=Promise.all([a,new Promise(t=>{const r=n.on({taskpaint({taskRecord:n}){n===e&&(r(),t())}})})]);return a}get widgetClass(){}});const Tg=["barMargin","tickWidth","zoomLevel"];var Rg=e=>(class extends(e||W){getState(){return We.copyProperties(super.getState(),this,Tg)}applyState(e){We.copyProperties(this,e,Tg),super.applyState(e)}get widgetClass(){}}),kg=e=>(class extends(e||W){get project(){return this._project}set project(e){this._project=e,this.onTaskStoreChange(e.eventStore)}set tasks(e){this.taskStore.data=e}get eventStore(){return this.project.eventStore}get taskStore(){return this.eventStore}get assignmentStore(){return this.project.assignmentStore}get resourceStore(){return this.project.resourceStore}onTaskStoreChange(e){const t=this;e.metaMapId=t.id,t.store=t.timeAxisViewModel.store=e,t.dependencyStore=this.project.dependencyStore,t.features.dependencies&&(t.features.dependencies.store=t.dependencyStore),t.currentOrientation.bindTaskStore(e)}bindAssignmentStore(e,t){}bindResourceStore(e,t){}}),Mg=e=>(class extends(e||W){getDisplayEndDate(e,t){return e}get widgetClass(){}}),Ig=e=>(class extends(e||W){static get defaultConfig(){return{navigator:{inlineFlow:!1,prevKey:"ArrowUp",nextKey:"ArrowDown",keys:{ArrowLeft:()=>{},ArrowRight:()=>{}}}}}processEvent(e){const t=yt.up(e.target,this.eventSelector);return!this.navigator.disabled&&t&&(e.taskRecord=e.eventRecord=this.resolveTaskRecord(t),"click"===e.type&&this.selectRow(e.taskRecord.id,!0,e.ctrlKey||e.metaKey)),e}getNext(e){const t=this,{taskStore:n}=t;for(let r=n.indexOf(e)+1;r<n.count;r++){const e=n.getAt(r);if(t.isInTimeAxis(e))return e}}getPrevious(e){const t=this,{taskStore:n}=t;for(let r=n.indexOf(e)-1;r>=0;r--){const e=n.getAt(r);if(t.isInTimeAxis(e))return e}}navigateTo(e,t={}){const n=this;e&&(n.navigator.disabled=!0,n.scrollTaskIntoView(e,{animate:100}).then(()=>{n.navigator.disabled=!1,n.activeEvent=e,n.navigator.trigger("navigate",{event:t,item:n.getElementFromTaskRecord(e).parentNode})}))}clearEventSelection(){this.deselectAll()}});const Ag=function(){class e extends(qu(cg(Sr))){static get fields(){return[]}}return e._$name="CalendarModel",e}(),Fg=function(){class e extends(qu(ug(ps))){static get defaultConfig(){return{tree:!0,modelClass:Ag,loadPriority:100,syncPriority:100,storeId:"calendars"}}}return e._$name="CalendarManagerStore",e}();var Og=e=>(class extends(ba(aa(ha(ue(e))))){construct(...e){const t=this;super.construct(...e),t.addPrioritizedStore(t.calendarManagerStore),t.addPrioritizedStore(t.assignmentStore),t.addPrioritizedStore(t.dependencyStore),t.addPrioritizedStore(t.resourceStore),t.addPrioritizedStore(t.eventStore),t.addPrioritizedStore(t.timeRangeStore)}async applyResponse(e,t,n){await super.applyResponse(e,t,n),t&&t.project&&Object.assign(this,t.project),await this.propagate(()=>Dc.Resume),this.clearCrudStoresChanges()}clearCrudStoresChanges(){this.crudStores.forEach(e=>{const t=e.store;t.remove(t.added.values,!0),t.modified.forEach(e=>e.clearChanges(!1)),t.added.clear(),t.modified.clear(),t.removed.clear()})}applyProjectResponse(e){this.loadProjectFields(e)}});const Lg=function(){class e extends(Og(fg(Sr))){static get defaults(){return{expanded:!0}}construct(...e){Object.assign(this,{eventModelClass:null,taskModelClass:Uh,dependencyModelClass:oh,resourceModelClass:hh,assignmentModelClass:Xu,calendarModelClass:Ag,eventStoreClass:null,taskStoreClass:Xh,dependencyStoreClass:uh,resourceStoreClass:ph,assignmentStoreClass:Qu,calendarManagerStoreClass:Fg,convertEmptyParentToLeaf:!1});const t=e[0]||{};e[0]=t,"tasksData"in t&&(t.eventsData=t.tasksData,delete t.tasksData),"taskStore"in t&&(t.eventStore=t.taskStore,delete t.taskStore),t.eventModelClass=t.taskModelClass||t.eventModelClass||Uh,t.eventStoreClass=t.taskStoreClass||t.eventStoreClass||Xh,t.timeRangeStore||(t.timeRangeStore={modelClass:va,storeId:"timeRanges"}),super.construct(...e)}get taskStore(){return this.getEventStore()}get timeRangeStore(){return this._timeRangeStore}set timeRangeStore(e){this._timeRangeStore=Nr.getStore(e,Nr),this._timeRangeStore.storeId||(this._timeRangeStore.storeId="timeRanges")}}return e._$name="ProjectModel",e}(),_g={AddNewColumn:{"New Column":"New Column"},CalendarColumn:{Calendar:"Calendar"},EarlyStartDateColumn:{"Early Start":"Early Start"},EarlyEndDateColumn:{"Early End":"Early End"},LateStartDateColumn:{"Late Start":"Late Start"},LateEndDateColumn:{"Late End":"Late End"},TotalSlackColumn:{"Total Slack":"Total Slack"},ConstraintDateColumn:{"Constraint Date":"Constraint Date"},ConstraintTypeColumn:{"Constraint Type":"Constraint Type"},DependencyColumn:{"Invalid dependency found, change is reverted":"Invalid dependency found, change is reverted"},DurationColumn:{Duration:"Duration"},EffortColumn:{Effort:"Effort"},EndDateColumn:{Finish:"Finish"},EventModeColumn:{"Event mode":"Event mode",Manual:"Manual",Auto:"Auto"},ManuallyScheduledColumn:{"Manually scheduled":"Manually scheduled"},MilestoneColumn:{Milestone:"Milestone"},NameColumn:{Name:"Name"},NoteColumn:{Note:"Note"},PercentDoneColumn:{"% Done":"% Done"},PredecessorColumn:{Predecessors:"Predecessors"},ResourceAssignmentColumn:{"Assigned Resources":"Assigned Resources"},SchedulingModeColumn:{"Scheduling Mode":"Scheduling Mode"},SequenceColumn:{Sequence:"Sequence"},ShowInTimelineColumn:{"Show in timeline":"Show in timeline"},StartDateColumn:{Start:"Start"},SuccessorColumn:{Successors:"Successors"},WBSColumn:{WBS:"WBS"},ProjectLines:{"Project Start":"Project start","Project End":"Project end"},TaskTooltip:{Start:"Start",End:"End",Duration:"Duration",Complete:"Complete"},AssignmentGrid:{Name:"Resource name",Units:"Units","%":"%",unitsTpl:({value:e})=>e?e+"%":""},AssignmentPicker:{Save:"Save",Cancel:"Cancel"},AssignmentEditGrid:{Name:"Resource name",Units:"Units"},ConstraintTypePicker:{"Must start on":"Must start on","Must finish on":"Must finish on","Start no earlier than":"Start no earlier than","Start no later than":"Start no later than","Finish no earlier than":"Finish no earlier than","Finish no later than":"Finish no later than"},Gantt:{Add:"Add...","New Task":"New task","Task above":"Task above","Task below":"Task below","Delete task":"Delete task",Milestone:"Milestone","Sub-task":"Subtask",Successor:"Successor",Predecessor:"Predecessor"},GanttCommon:{SS:"SS",SF:"SF",FS:"FS",FF:"FF",StartToStart:"Start-to-Start",StartToEnd:"Start-to-End",EndToStart:"End-to-Start",EndToEnd:"End-to-End",dependencyTypes:["SS","SF","FS","FF"],dependencyTypesLong:["Start-to-Start","Start-to-End","End-to-Start","End-to-End"]},TaskEdit:{Edit:"Edit"},TaskEditor:{editorWidth:"45em",Information:"Information",Save:"Save",Cancel:"Cancel",Delete:"Delete"},GeneralTab:{labelWidth:"6.5em",General:"General",Name:"Name","% complete":"% complete",Duration:"Duration",Start:"Start",Finish:"Finish",Effort:"Effort",Dates:"Dates"},AdvancedTab:{labelWidth:"11.5em",Advanced:"Advanced",Calendar:"Calendar","Scheduling mode":"Scheduling mode","Effort driven":"Effort driven","Manually scheduled":"Manually scheduled","Constraint type":"Constraint type","Constraint date":"Constraint date",Constraint:"Constraint"},DependencyTab:{Predecessors:"Predecessors",Successors:"Successors",ID:"ID",Name:"Name",Type:"Type",Lag:"Lag","Cyclic dependency has been detected":"Cyclic dependency has been detected"},ResourcesTab:{unitsTpl:({value:e})=>`${e}%`,Resources:"Resources",Resource:"Resource",Units:"Units"},NotesTab:{Notes:"Notes"},SchedulingModePicker:{Normal:"Normal","Fixed Duration":"Fixed Duration","Fixed Units":"Fixed Units","Fixed Effort":"Fixed Effort"}};for(let hp in xl)_g[hp]=xl[hp];he.registerLocale("En",{desc:"English",locale:_g}),To.registerFeature(function(){class e extends ur{static get defaultConfig(){return{allowDrag:!0}}static get pluginConfig(){return{chain:["render","onTaskDataGenerated"]}}render(){const e=this,t=e.client;e.resize&&e.resize.destroy(),e.resize=new Hi({name:"percentBarResize",outerElement:t.timeAxisSubGridElement,targetSelector:".b-gantt-task-percent",handleSelector:".b-gantt-task-percent-handle",allowResize:e.isResizable.bind(e),dragThreshold:0,listeners:{resizeStart:e.onResizeStart,resizing:e.onResizing,resize:e.onFinishResize,cancel:e.onCancelResize,thisObj:e}})}doDestroy(){this.resize&&this.resize.destroy(),super.doDestroy()}isResizable(e){return!e.closest(".b-gantt-task-parent")}cleanup(e){const t=this.client;e.element.closest(t.eventSelector).classList.remove("b-gantt-task-percent-resizing"),t.element.classList.remove("b-gantt-resizing-task-percent")}onTaskDataGenerated(e){const{task:t,row:n}=e;t.milestone||(n.percentBarElement||(n.percentBarElement=yt.createElement({className:"b-gantt-task-percent",children:[{className:"b-gantt-task-percent-handle"}]})),e.body.insertBefore(n.percentBarElement,e.body.firstChild),n.percentBarElement.dataset.percent=Math.round(t.percentDone),n.percentBarElement.style.width=t.percentDone+"%")}onResizeStart({context:e}){e.element.closest(this.client.eventSelector).classList.add("b-gantt-task-percent-resizing"),this.client.element.classList.add("b-gantt-resizing-task-percent")}onResizing({context:e}){const t=e.element,n=t.closest(this.client.eventSelector);t.dataset.percent=Math.min(100,Math.round(100*(1===t.offsetWidth?0:t.offsetWidth)/n.offsetWidth))}onFinishResize({context:e}){const t=e.element,n=this.client.resolveTaskRecord(t);this.cleanup(e),n.setPercentDone(parseInt(t.dataset.percent))}onCancelResize({context:e}){this.cleanup(e)}}return e._$name="PercentBar",e}(),!0,"Gantt"),To.registerFeature(function(){class e extends Ga{static get defaultConfig(){return{validatorFn:(e,t,n,r)=>!0,validatorFnThisObj:null,tooltipCls:"b-gantt-taskdrag-tooltip"}}construct(e,t){this.gantt=e,this.store=e.taskStore,super.construct(e,t)}isElementDraggable(e,t){const{gantt:n}=this,r=yt.up(e,n.eventSelector),{eventResize:s}=n.features;if(!r)return!1;if(yt.up(e,n.eventSelector).matches('[class$="-handle"]'))return!1;const i=n.resolveTaskRecord(r);return!(s&&!i.milestone&&(s.resize.overLeftHandle(t,r)||s.resize.overRightHandle(t,r))||!i||!i.isDraggable||!1===n.trigger("beforeTaskDrag",{taskRecord:i}))}triggerEventDrag(e,t){this.gantt.trigger("taskDrag",{taskRecords:e.draggedRecords,startDate:e.startDate,endDate:e.endDate,dragData:e,changed:e.startDate-t!=0})}getProductDragContext(e){return{valid:!0}}setupProductDragData(e){const t=this.gantt,n=e.element,r=t.resolveTaskRecord(n),s=oe.from(n),i=this.getRelatedRecords(r)||[],o=t.getDateConstraints(r);let a=[t.getElementFromTaskRecord(r,!0).parentNode];this.setupConstraints(t.getScheduleRegion(r),s,t.timeAxisViewModel.snapPixelAmount,Boolean(o)),i.forEach(e=>{a.push(t.getElementFromTaskRecord(e).parentNode)}),a=[...new Set(a)];const l=[r].concat(i);return{record:r,dateConstraints:o,eventBarEls:a,draggedRecords:l}}getCoordinate(e,t,n){return n[0]}checkDragValidity(e,t){return this.validatorFn.call(this.validatorFnThisObj||this,e.draggedRecords,e.startDate,e.duration,t)}isValidDrop(e){return!0}async updateRecords(e){const t=this.gantt,n=e.draggedRecords[0],r=n.startDate,s=n.setStartDate(e.startDate,!0);return await s,n.startDate-r?t.trigger("taskDrop",{taskRecords:e.draggedRecords}):this.dragData.valid=!1,s}}return e._$name="TaskDrag",e}(),!0,"Gantt"),To.registerFeature(function(){class e extends Wa{static get defaultConfig(){return{defaultItems:{add:!0,deleteTask:!0}}}resolveRecord(e){return this.client.resolveTaskRecord(e)||this.client.getRecordFromElement(e)}showContextMenuFor(e,{targetElement:t,event:n}={}){e&&(t||(t=this.client.getElementFromTaskRecord(e)))&&this.showContextMenu({menuType:"task",taskElement:t,targetElement:t,taskRecord:e,event:n})}get namedItems(){const{client:e}=this;return this._namedItems||((this._namedItems={addTaskAbove:{text:e.L("Task above"),icon:"b-icon b-icon-up",onItem:({taskRecord:t})=>{e.addTaskAbove(t)}},addTaskBelow:{text:e.L("Task below"),icon:"b-icon b-icon-down",onItem:({taskRecord:t})=>{e.addTaskBelow(t)}},milestone:{text:e.L("Milestone"),icon:"b-icon b-fa-flag",name:"milestone",onItem:({taskRecord:t})=>{e.addMilestonBelow(t)}},subtask:{text:e.L("Sub-task"),name:"subtask",onItem:({taskRecord:t})=>{e.addSubtask(t)}},successor:{text:e.L("Successor"),onItem:({taskRecord:t})=>{e.addSuccessor(t)}},predecessor:{text:e.L("Predecessor"),name:"predecessor",onItem:({taskRecord:t})=>{e.addPredecessor(t)}},deleteTask:{text:e.L("Delete task"),icon:"b-icon b-icon-trash",name:"deleteTask",onItem:({taskRecord:e})=>{e.remove()}},convertToMilestone:{text:e.L("Convert to milestone"),onItem:({taskRecord:e})=>{e.convertToMilestone()}}}).add={text:e.L("Add"),icon:"b-icon b-icon-add",menu:{items:{addTaskAbove:!0,addTaskBelow:!0,milestone:!0,subtask:!0,successor:!0,predecessor:!0}}}),this._namedItems}}return e.featureClass="",e._$name="TaskContextMenu",e}(),!0,"Gantt"),To.registerFeature(function(){class e extends qa{static get defaultConfig(){return{preventMultiple:!0,validatorFn:()=>{}}}construct(e,t){this.gantt=e,this.store=e.taskStore,super.construct(e,t)}finalizeDragCreate(e){const{taskRecord:t}=e;t.setStartEndDate(e.startDate,e.endDate),this.gantt.trigger("dragCreateEnd",{taskRecord:t,event:e.event,proxyElement:this.proxy})}handleBeforeDragCreate(e,t){const n=this,r=n.gantt.trigger("beforeDragCreate",{taskRecord:n.createContext.taskRecord,date:e,event:t});if(r){const e=n.gantt.features.scheduleTooltip;e&&e.hoverTip&&e.hoverTip.hide()}return n.dateConstraints=n.gantt.getDateConstraints(n.createContext.rowRecord,e),r}checkValidity(e,t){return e.taskRecord=e.rowRecord,this.validatorFn.call(this.validatorFnThisObj||this,e,t)}isRowEmpty(e){return!e.startDate||!e.endDate}}return e._$name="TaskDragCreate",e}(),!0,"Gantt");var Pg=e=>(class extends(e||W){getProject(){if(!super.getProject)throw new Error("Abstract method call!");return super.getProject()}captureStm(){const e=this,t=e.getProject().getStm();e.stmInitiallyDisabled=t.disabled,e.stmInitiallyAutoRecord=t.autoRecord,e.stmInitiallyDisabled?t.enable():(e.stmInitiallyAutoRecord&&(t.autoRecord=!1),t.isRecording&&t.stopTransaction())}startStmTransaction(){this.getProject().getStm().startTransaction()}commitStmTransaction(){const e=this.getProject().getStm();e.stopTransaction(),this.stmInitiallyDisabled&&e.resetQueue()}rejectStmTransaction(){const e=this.getProject().getStm(),{client:t}=this;e.transaction.length?(t.suspendRefresh(),e.forEachStore(e=>e.beginBatch()),e.rejectTransaction(),e.forEachStore(e=>e.endBatch()),t.resumeRefresh(!0)):e.stopTransaction()}enableStm(){this.getProject().getStm().enable()}disableStm(){this.getProject().getStm().disable()}freeStm(){const e=this.getProject().getStm();e.disabled=this.stmInitiallyDisabled,e.autoRecord=this.stmInitiallyAutoRecord}}),$g=e=>(class extends(e||ue(W)){get isReadyStatePropagator(){return!0}get canSave(){return!0}requestReadyStateChange(){this.trigger("readystatechange",{canSave:this.canSave})}}),jg=e=>(class extends(e||$n){getProject(){return this.record&&this.record.getProject()}loadEvent(e){this.record=e}resetData(){this.record=null}beforeSave(){}afterSave(){this.resetData()}beforeCancel(){}afterCancel(){this.resetData()}beforeDelete(){}afterDelete(){this.resetData()}}),Hg=e=>(class extends(e||ue(W)){get isEventChangePropagator(){return!0}requestPropagation(){this.trigger("requestPropagation")}}),Ng=e=>(class extends e{startConfigure(e){e.extraItems&&e.items&&(e.items.push(...e.extraItems),e.items.sort((e,t)=>(0|e.index)-(t.index-0))),super.afterConfigure()}});const zg=function(){class e extends(Hg(Ng(jg($n)))){static get defaultConfig(){return{layoutStyle:{flexFlow:"row wrap",alignItems:"flex-start",alignContent:"flex-start"},defaults:{labelWidth:"7em"}}}afterConfigure(){const e=this;super.afterConfigure(),Object.values(e.widgetMap).forEach(t=>{t.name&&t.on("change",e.onWidgetValueChange,e)}),he.on({locale:e.onLocaleChange,thisObj:e})}loadEvent(e){this._loading=!0,super.loadEvent(e),this._loading=!1}resetData(){this._loading=!0,super.resetData(),this._loading=!1}onWidgetValueChange({source:e,value:t,checked:n,valid:r}){const s=this,i=s.getProject();if(r=void 0!==r?r:"function"==typeof e.isValid?e.isValid():e.isValid,!s._loading&&r&&i&&!i.isPropagating()){const r=s.record,i=`set${$.capitalizeFirstLetter(e.name)}`;e instanceof ao&&(t=n),(i in r||e.name in r||r.$[e.name])&&(i in r?r[i](t):e.name in r?r[e.name]=t:r.$[e.name].put(t),s.requestPropagation())}}onLocaleChange(){Object.values(this.widgetMap).forEach(e=>{e instanceof cr&&e.parent===this&&(e.labelWidth=this.L("labelWidth"))})}}return e._$name="FormTab",e}(),Bg=function(){class e extends(ge()){}return e._$name="GanttCommon",e}(),Vg=e=>e.map((e,t)=>[t,e]),Wg=function(){class e extends Zr{static get type(){return"dependencytypepicker"}construct(e){super.construct(e),he.on({locale:({locale:e})=>{this.items=Vg(e.GanttCommon.dependencyTypesLong)},thisObj:this})}get store(){return this._items||(this.items=this._items=Vg(Bg.L("dependencyTypesLong"))),super.store}set store(e){super.store=e}}return e._$name="DependencyTypePicker",e}();E.register(Wg.type,Wg);const Ug=function(){class e extends zg{static get type(){return"generaltab"}static get defaultConfig(){return{localeClass:this,title:"L{General}",ref:"generaltab",defaults:{localeClass:this,labelWidth:this.L("labelWidth")},items:[{type:"text",required:!0,label:"L{Name}",clearable:!0,name:"name",ref:"nameField",cls:"b-name"},{type:"number",label:"L{% complete}",name:"percentDone",ref:"percentDoneField",cls:"b-percent-done b-inline",flex:"1 0 50%",min:0,max:100},{type:"effort",label:"L{Effort}",name:"fullEffort",ref:"effortField",flex:"1 0 50%"},{html:"",dataset:{text:this.L("Dates")},cls:"b-divider",flex:"1 0 100%"},{type:"date",label:"L{Start}",name:"startDate",ref:"startDateField",cls:"b-start-date b-inline",flex:"1 0 50%"},{type:"date",label:"L{Finish}",name:"endDate",ref:"endDateField",cls:"b-end-date",flex:"1 0 50%"},{type:"durationfield",label:"L{Duration}",name:"fullDuration",ref:"fullDurationField",flex:".5 0",cls:"b-inline"}]}}loadEvent(e){const t={unit:e.durationUnit,magnitude:1},{isParent:n}=e,{fullDurationField:r,percentDoneField:s,startDateField:i,endDateField:o,effortField:a}=this.widgetMap;r&&(r.disabled=n),s&&(s.disabled=n),i&&(i.step=t),o&&(o.step=t,o.disabled=n),a&&(a.unit=e.effortUnit,a.disabled=n),super.loadEvent(e)}}return e._$name="GeneralTab",e}();E.register(Ug.type,Ug);const Gg=function(){class e extends Zr{static get type(){return"modelcombo"}get value(){const e=super.value;return this.store.getById(e)||e}set value(e){super.value=e}}return e._$name="ModelCombo",e}();E.register(Gg.type,Gg);const Yg=(e,t)=>{e.instanceMeta(t).valid=!0},qg=(e,t)=>{e.instanceMeta(t).valid=!1},Xg=(e,t)=>!1!==e.instanceMeta(t).valid,Kg=function(){class e extends($g(Hg(Ng(jg(U($n)))))){static makeDefaultConfig(e){const t="fromEvent"===e?"predecessorstab":"successorstab";return{direction:e,negDirection:"fromEvent"===e?"toEvent":"fromEvent",ref:t,localeClass:this,title:"fromEvent"===e?"L{Predecessors}":"L{Successors}",layoutStyle:{flexFlow:"column nowrap"},items:[{type:"container",flex:"0 0 auto",items:[{type:"button",cls:"b-add-button b-green",icon:"b-icon b-icon-add",ref:`${t}-add`},{type:"button",cls:"b-remove-button b-red",icon:"b-icon b-icon-trash",disabled:!0,ref:`${t}-remove`}]},{type:"grid",flex:"1 1 auto",ref:`${t}-grid`,emptyText:"",columns:[{localeClass:this,text:"L{ID}",flex:1,editor:!1,htmlEncode:!1,renderer:({record:t,row:n,grid:r})=>{let s;if(Xg(t,r)){const n=t[e];s=!n||n.hasGeneratedId?"*":n.id}else n.addCls("b-invalid"),s='<div class="b-icon b-icon-warning"></div>';return s}},{localeClass:this,text:"L{Name}",field:e,flex:5,renderer:({value:e})=>e&&e.name||"",editor:{type:"modelcombo",displayField:"name",valueField:"id",editable:!1,allowInvalid:!0}},{localeClass:this,text:"L{Type}",field:"type",flex:3,editor:"dependencytypepicker",renderer:({value:e})=>Bg.L("dependencyTypesLong")[e]},{localeClass:this,text:"L{Lag}",type:"duration",field:"fullLag",flex:2,editor:{allowNegative:!0}}],disableGridRowModelWarning:!0}]}}afterConstruct(){super.afterConstruct();const e=this,t=e.addButton=e.widgetMap[`${e.ref}-add`],n=e.removeButton=e.widgetMap[`${e.ref}-remove`],r=e.grid=e.widgetMap[`${e.ref}-grid`];t&&t.on("click",e.onAddClick,e),n&&n.on("click",e.onRemoveClick,e),r.on({selectionChange:e.onGridSelectionChange,startCellEdit:e.onGridStartCellEdit,finishCellEdit:e.onGridFinishCellEdit,cancelCellEdit:e.onGridCancelCellEdit,thisObj:e})}get dependencyGrid(){return this.widgetMap&&this.widgetMap[`${this.ref}-grid`]}get taskCombo(){const e=this.dependencyGrid,t=e&&e.columns.get(this.direction);return t&&t.editor}loadEvent(e){const t=this,n=t.dependencyGrid,r=!n.store.chained,s=!r&&e!==t.record;super.loadEvent(e);const i=t.taskCombo,o=t.getProject().getDependencyStore(),a=t.getProject().getEventStore();r?(t.depStoreGeneration=o.storage.generation,t.eventStoreGeneration=a.storage.generation,n.store=o.makeChained(e=>e[t.negDirection]===t.record,null),i.store=a.makeChained(e=>e!==t.record&&!n.store.find(n=>n[t.direction]===e),null,{doRelayToMaster:[]})):((s||o.storage.generation!==t.depStoreGeneration)&&(n.store.fillFromMaster(),t.depStoreGeneration=o.storage.generation),(s||a.storage.generation!==t.eventStoreGeneration)&&(i.store.fillFromMaster(),t.eventStoreGeneration=a.storage.generation)),t.requestReadyStateChange()}unshadowAll(){this.dependencyGrid.store.forEach(e=>{e.isShadowed&&(e.forEachFieldAtom(e=>{e.clearUserInput()}),Yg(e,this.dependencyGrid),e.unshadow())})}beforeSave(){this.unshadowAll(),super.beforeSave()}beforeCancel(){this.unshadowAll(),super.beforeCancel()}async insertNewDependency(){const e=this,t=e.dependencyGrid,n=t.store,r=e.getProject().getDependencyStore(),[s]=n.insert(0,{type:Jd.EndToStart,lag:0,lagUnit:Xd.Day,[e.negDirection]:e.record});return e.depStoreGeneration=r.storage.generation,t.features.cellEdit.startEditing({field:e.direction,id:s.id}),qg(s,t),s}onAddClick(){this.insertNewDependency()}onRemoveClick(){const e=this,t=e.dependencyGrid.selectedRecords,n=t.some(e=>!e.isShadowed());e.getProject().getDependencyStore().remove(t),e.dependencyGrid.selectedRecords=null,e.taskCombo.store.fillFromMaster(),e.removeButton.disable(),n&&e.requestPropagation()}onGridSelectionChange({selection:e}){e&&e.length?this.removeButton.enable():this.removeButton.disable()}onGridStartCellEdit({editorContext:e}){const t=this._editingDependency=e.record,n=this.direction;e.column.field==n&&(Xg(t,this.dependencyGrid)?[this.L("Invalid dependency"),this.L("Cyclic dependency has been detected")].forEach(t=>e.editor.inputField.clearError(t)):e.editor.inputField.setError(this.L(t[n]?"Cyclic dependency has been detected":"Invalid dependency")),t.shadow())}onGridFinishCellEdit({editorContext:e}){const t=this,{record:n,column:r}=e,s=t.direction,i=t.dependencyGrid;r.field===s?n[s]?t.getProject().getDependencyStore().isValidDependency({[t.direction]:n[t.direction],[t.negDirection]:n[t.negDirection],lag:n.lag,lagUnit:n.lagUnit,type:n.type}).then(e=>{e?(Yg(n,t.dependencyGrid),n.unshadow(),t.taskCombo.store.fillFromMaster(),t.redrawDependencyRow(n),t.requestPropagation(),t.requestReadyStateChange()):(qg(n,i),t.redrawDependencyRow(n),Jn.show({html:t.L("Cyclic dependency has been detected")}),t.requestReadyStateChange())}):(qg(n,i),t.redrawDependencyRow(n),t.requestReadyStateChange()):(t.redrawDependencyRow(n),n[s]&&Xg(n,i)&&(n.unshadow(),t.requestPropagation()),t.requestReadyStateChange()),t._editingDependency=null}onGridCancelCellEdit(e){const t=this;if(t._editingDependency){const e=t._editingDependency,n=t.dependencyGrid;e[t.direction]?Xg(e,n)&&e.unshadow():(qg(e,n),t.redrawDependencyRow(e)),t._editingDependency=null}this.requestReadyStateChange()}redrawDependencyRow(e){const t=this.dependencyGrid;t.rowManager.getRowById(e).render(t.store.indexOf(e),e)}get canSave(){const e=this.dependencyGrid;return e.store.reduce((t,n)=>t&&Xg(n,e),!0)}}return e._$name="DependencyTab",e}(),Zg=function(){class e extends Kg{static get type(){return"successorstab"}static get defaultConfig(){return Object.assign(this.makeDefaultConfig("toEvent"),{cls:"b-successors-tab"})}}return e._$name="SuccessorsTab",e}();E.register(Zg.type,Zg);const Jg=function(){class e extends Kg{static get type(){return"predecessorstab"}static get defaultConfig(){return Object.assign(this.makeDefaultConfig("fromEvent"),{cls:"b-predecessors-tab"})}}return e._$name="PredecessorsTab",e}();E.register(Jg.type,Jg);const Qg=function(){class e extends(Hg(Ng(jg($n)))){static get type(){return"resourcestab"}static get defaultConfig(){return{localeClass:this,title:"L{Resources}",layoutStyle:{flexFlow:"column nowrap"},items:[{type:"container",flex:"0 0 auto",items:[{type:"button",cls:"b-add-button b-green",icon:"b-icon b-icon-add",ref:"resourcestab-add"},{type:"button",cls:"b-remove-button b-red",icon:"b-icon b-icon-trash",disabled:!0,ref:"resourcestab-remove"}]},{type:"grid",flex:"1 1 auto",ref:"resourcestab-grid",columns:[{localeClass:this,text:"L{Resource}",field:"resource",flex:7,renderer:({value:e})=>e&&e.name||"",editor:{type:"modelcombo",displayField:"name",valueField:"id",editable:!1}},{localeClass:this,text:"L{Units}",field:"units",flex:3,renderer:e=>this.L("unitsTpl",e),editor:{type:"numberfield",min:0,max:100,step:10}}],disableGridRowModelWarning:!0}]}}afterConstruct(){super.afterConstruct();const e=this,t=e.addButton=e.widgetMap["resourcestab-add"],n=e.removeButton=e.widgetMap["resourcestab-remove"],r=e.grid=e.widgetMap["resourcestab-grid"];t&&t.on("click",e.onAddClick,e),n&&n.on("click",e.onRemoveClick,e),r.on({selectionChange:e.onGridSelectionChange,startCellEdit:e.onGridStartCellEdit,finishCellEdit:e.onGridFinishCellEdit,cancelCellEdit:e.onGridCancelCellEdit,thisObj:e})}get assignmentGrid(){return this.widgetMap&&this.widgetMap["resourcestab-grid"]}get resourceCombo(){const e=this.assignmentGrid,t=e&&e.columns.get("resource");return t&&t.editor}loadEvent(e){const t=this,n=t.assignmentGrid,r=!n.store.chained,s=!r&&e!==t.record;super.loadEvent(e);const i=t.resourceCombo,o=t.getProject().getAssignmentStore(),a=t.getProject().getResourceStore();r?(t.assignmentStoreGeneration=o.storage.generation,t.resourceStoreGeneration=a.storage.generation,n.store=o.makeChained(e=>e.event===t.record,["resource"]),i.store=a.makeChained(e=>t.record&&e!==t.record.resource)):((s||o.storage.generation!==t.assignmentStoreGeneration)&&n.store.fillFromMaster(),(s||a.storage.generation!==t.resourceStoreGeneration)&&i.store.fillFromMaster())}async insertNewAssignment(){const e=this.getProject().getAssignmentStore(),t=this.assignmentGrid,[n]=e.insert(0,{event:this.record,resource:null,units:100});return this.assignmentStoreGeneration=e.storage.generation,t.features.cellEdit.startEditing({field:"resource",id:n.id}),n}onAddClick(){this.insertNewAssignment()}onRemoveClick(){this.assignmentGrid.store.remove(this.assignmentGrid.selectedRecords),this.assignmentGrid.selectedRecords=null,this.removeButton.disable(),this.requestPropagation()}onGridSelectionChange({selection:e}){e&&e.length?this.removeButton.enable():this.removeButton.disable()}onGridStartCellEdit({editorContext:e}){"resource"===e.column.field&&(this._editingAssignment=e.record)}onGridFinishCellEdit(){this._editingAssignment?(this._editingAssignment.resource?this.requestPropagation():this._editingAssignment.remove(),this._editingAssignment=null):this.requestPropagation()}onGridCancelCellEdit(){this._editingAssignment&&(this._editingAssignment.resource||this._editingAssignment.remove(),this._editingAssignment=null)}}return e._$name="ResourcesTab",e}();E.register(Qg.type,Qg);const em=function(){class e extends Gg{static get type(){return"calendarfield"}static get defaultConfig(){return{valueField:"id",displayField:"name",editable:!1,listItemTpl:e=>e&&e.name?e.name:this.L("Default calendar"),displayValueRenderer:e=>e?e.name:this.L("Default calendar")}}get value(){return super.value}set value(e){e&&e.isDefault&&e.isDefault()&&(e=null),super.value=e}}return e._$name="CalendarField",e}();E.register(em.type,em);const tm=function(){class e extends zg{static get type(){return"advancedtab"}static get defaultConfig(){return{localeClass:this,title:"L{Advanced}",ref:"advancedtab",defaults:{localeClass:this,labelWidth:this.L("labelWidth")},items:[{type:"calendarfield",ref:"calendarField",name:"calendar",label:"L{Calendar}",flex:"1 0 50%",cls:"b-inline"},{type:"flagfield",ref:"manuallyScheduledField",name:"manuallyScheduled",label:"L{Manually scheduled}",flex:"1 0 50%"},{type:"schedulingmodecombo",ref:"schedulingModeField",name:"schedulingMode",label:"L{Scheduling mode}",flex:"1 0 50%",cls:"b-inline"},{type:"flagfield",ref:"effortDrivenField",name:"effortDriven",label:"L{Effort driven}",flex:"1 0 50%"},{html:"",dataset:{text:this.L("Constraint")},cls:"b-divider",flex:"1 0 100%"},{type:"constrainttypepicker",ref:"constraintTypeField",name:"constraintType",label:"L{Constraint type}",clearable:!0,flex:"1 0 50%",cls:"b-inline"},{type:"date",ref:"constraintDateField",name:"constraintDate",label:"L{Constraint date}",flex:"1 0 50%",cls:"b-inline"}]}}get calendarField(){return this.widgetMap.calendarField}get constraintTypeField(){return this.widgetMap.constraintTypeField}get constraintDateField(){return this.widgetMap.constraintDateField}loadEvent(e){!this.record&&(this.calendarField.store=e.getProject().getCalendarManagerStore()),super.loadEvent(e)}}return e._$name="AdvancedTab",e}();E.register(tm.type,tm);const nm=function(){class e extends zg{static get type(){return"notestab"}static get defaultConfig(){return{localeClass:this,title:"L{Notes}",ref:"notestab",layoutConfig:{alignItems:"flex-start",alignContent:"stretch"},items:[{type:"textareafield",cls:"b-taskeditor-notes-field",name:"note"}]}}}return e._$name="NotesTab",e}();E.register(nm.type,nm);const rm=function(){class e extends($g(Vn)){static get defaultConfig(){return{localeClass:this,title:"L{Information}",width:this.L("editorWidth"),cls:"b-gantt-taskeditor",closable:!0,draggable:{handleSelector:":not(button,.b-field-inner)"},axisLock:"flexible",autoClose:!0,record:null,onChange:null,onCancel:null,onSave:null,autoShow:!1,height:"30em",closeAction:"cancelAndHide",items:[{type:"tabpanel",ref:"tabs",flex:"1 0 100%",layoutConfig:{alignItems:"stretch",alignContent:"stretch"},items:[{type:"generaltab"},{type:"successorstab"},{type:"predecessorstab"},{type:"resourcestab"},{type:"advancedtab"},{type:"notestab"}]}],bbar:[{localeClass:this,text:"L{Save}",type:"button",color:"b-green",ref:"saveButton"},{localeClass:this,text:"L{Delete}",type:"button",color:"b-gray",ref:"deleteButton"},{localeClass:this,text:"L{Cancel}",type:"button",color:"b-gray",ref:"cancelButton"}],durationDecimalPrecision:1,extraItems:null,tabsConfig:null,extraWidgets:null}}get extraWidgets(){return console.warn("`extraWidgets` was deprecated in 1.0.1, please change your code to use `extraItems`"),this.extraItems}set extraWidgets(e){console.warn("`extraWidgets` was deprecated in 1.0.1, please change your code to use `extraItems`"),this.extraItems=e}processWidgetConfig(e){switch(e.ref){case"fullDurationField":e.decimalPrecision=this.durationDecimalPrecision;break;case"predecessorstab-grid":case"successorstab-grid":e.durationDisplayPrecision=this.durationDisplayPrecision;break;case"tabs":e.items.forEach(e=>{e.extraItems=(this.extraItems||{})[e.type]})}return!("deleteButton"===e.ref&&!this.showDeleteButton)&&e}startConfigure(e){const t=e.tabsConfig||{},n=e.items[0].items;Object.keys(t).forEach(e=>{let r;const s=t[e],i=n.find((t,n)=>(r=n,(e||"").toLowerCase()===t.type));i?!1===s?n.splice(r,1):"object"==typeof s&&Object.assign(i,s):n.push(s)}),super.startConfigure(e)}afterConfigure(){const e=this,t=e.widgetMap,n=e.bbar&&e.bbar.widgetMap||{},{cancelButton:r,deleteButton:s,saveButton:i}=n;i&&i.on("click",e.onSaveClick,e),r&&r.on("click",e.onCancelClick,e),s&&s.on("click",e.onDeleteClick,e),Object.values(t).forEach(t=>{t.isEventChangePropagator&&t.on("requestPropagation",e.onPropagationRequested,e),t.isReadyStatePropagator&&t.on("readystatechange",e.onReadyStateChange,e)}),he.on({locale:e.onLocaleChange,thisObj:e})}onSaveClick(){this.canSave?this.trigger("save"):Jn.show({html:this.L("Can't save, please correct errors first.")})}onCancelClick(){this.trigger("cancel")}onDeleteClick(){this.trigger("delete")}onPropagationRequested(){this.trigger("requestPropagation")}onReadyStateChange({source:e,canSave:t}){this.requestReadyStateChange(),e.couldSaveTitle||(e.couldSaveTitle=e.title),e.parent===this.widgetMap.tabs&&(t?(e.titleElement.classList.remove("b-invalid"),e.title=e.couldSaveTitle,e.couldSaveTitle=null):(e.titleElement.classList.add("b-invalid"),e.title=`<span class='b-icon b-icon-warning'></span>${e.couldSaveTitle}`))}get canSave(){let e=!0;return Object.values(this.widgetMap).forEach(t=>{t.isReadyStatePropagator&&(e=e&&t.canSave)}),e}get canCancel(){let e=!0;return Object.values(this.widgetMap).forEach(t=>{t.isReadyStatePropagator&&(e=e&&t.canCancel)}),e}cancelAndHide(){this.onCancelClick()}loadEvent(e){this.eachWidget(t=>("function"==typeof t.loadEvent&&t.loadEvent(e),!0))}beforeSave(){this.callWidgetHook("beforeSave")}afterSave(){this.callWidgetHook("afterSave")}beforeCancel(){this.callWidgetHook("beforeCancel")}afterCancel(){this.callWidgetHook("afterCancel")}beforeDelete(){this.callWidgetHook("beforeDelete")}afterDelete(){this.callWidgetHook("afterDelete")}callWidgetHook(e,t=[]){this.eachWidget(n=>{"function"==typeof n[e]&&n[e](...t)})}onInternalKeyDown(e){"Enter"===e.key&&this.owner.features.taskEdit.saveAndCloseOnEnter&&"input"===e.target.tagName.toLowerCase()&&(e.preventDefault(),this.onSaveClick()),super.onInternalKeyDown(e)}onLocaleChange(){this.width=this.L("editorWidth")}}return e._$name="TaskEditor",e}();To.registerFeature(function(){class e extends(Pg(U(ur))){static get pluginConfig(){return{chain:["getTaskMenuItems","onEventEnterKey"],assign:["editTask"]}}static get defaultConfig(){return{editorConfig:null,showDeleteButton:!0,saveAndCloseOnEnter:!0,tabsConfig:null}}construct(e,t){const n=this;e.taskEdit=n,n.gantt=e,super.construct(e,t),n._clientListenersDetacher=e.on({taskdblclick:n.onActivateEditor,thisObj:n})}getProject(){return this.gantt.project}doDestroy(){this._clientListenersDetacher(),this.detachFromProject(),this.editor&&this.editor.destroy(),super.doDestroy()}get isEditing(){return!!this._editing}onActivateEditor({taskRecord:e}){this.editTask(e)}editTask(e){const t=this,n=t.gantt;if(!n.readOnly&&!t._editing){const r=t.getEditor(),s=yt.down(n.getElementFromTaskRecord(e),n.eventInnerSelector);if(!1===n.trigger("beforeTaskEdit",{taskEdit:t,taskRecord:e,taskElement:s}))return;t._editing=!0,n.element.classList.add("b-taskeditor-editing"),r.centered=!s,n.trigger("beforeTaskEditShow",{taskEdit:t,taskRecord:e,taskElement:s,editor:r}),t.load(e),s?r.showBy({target:s,anchor:!0,offset:-5}):r.show(),t.captureStm(),t.startStmTransaction(),t.attachToProject()}}getEditor(){const e=this;return e.editor||(e.editor=new rm(We.merge({showDeleteButton:e.showDeleteButton,owner:e.gantt,project:e.getProject(),durationDisplayPrecision:e.gantt.durationDisplayPrecision,tabsConfig:e.tabsConfig,listeners:{cancel:e.onCancel,delete:e.onDelete,save:e.onSave,requestPropagation:e.onRequestPropagation,thisObj:e}},e.editorConfig))),e.editor}load(e){const t=this.getEditor();this._loading=!0,this.record=e,t.loadEvent(e),this._loading=!1}async save(){const e=this;if(e._editing&&!e._saving){if(e._saving=!0,!1===e.gantt.trigger("beforeTaskSave",{taskRecord:e.record,editor:e.getEditor()}))return;const t=e.getProject();t.isPropagating()&&await t.waitForPropagateCompleted();const n=e.getEditor();n.beforeSave(),e.commitStmTransaction(),e.freeStm(),n.hide(),e.detachFromProject(),n.afterSave(),e.gantt.element.classList.remove("b-taskeditor-editing"),e._saving=!1,e._editing=!1}}async cancel(){const e=this;if(e._editing&&!e._canceling){e._canceling=!0;const t=e.getProject();t.isPropagating()&&await t.waitForPropagateCompleted();const n=e.getEditor();n.beforeCancel(),await n.hide(),e.rejectStmTransaction(),e.disableStm(),await t.propagate(),e.freeStm(),e.detachFromProject(),n.afterCancel(),e.gantt.element.classList.remove("b-taskeditor-editing"),e._canceling=!1,e._editing=!1,e.gantt.trigger("afterEditCanceled",{taskRecord:e.record})}}async delete(){const e=this,t=e.getEditor();if(!1===e.gantt.trigger("beforeTaskDelete",{taskRecord:e.record,editor:t}))return;const n=e.getProject();n.isPropagating()&&await n.waitForPropagateCompleted(),e.detachFromProject(),t.beforeDelete(),e.record.remove(),e.freeStm(),await n.propagate(),t.hide(),t.afterDelete(),e.gantt.element.classList.remove("b-taskeditor-editing"),e._editing=!1}onSave(){this.requestAnimationFrame(()=>this.save())}onCancel(){this.requestAnimationFrame(()=>this.cancel())}onDelete(){this.requestAnimationFrame(()=>this.delete())}onRequestPropagation(){const e=this.getProject();this.requestAnimationFrame(()=>{e.isPropagating()||e.propagate()})}attachToProject(){const e=this,t=e.getProject();e._projectEventDetacher=t.on({propagationStart:e.onPropagationStart,propagationComplete:e.onPropagationComplete,thisObj:e,detachable:!0})}detachFromProject(){this._projectEventDetacher&&(this._projectEventDetacher(),this._projectEventDetacher=null)}onPropagationStart(){this.getEditor().mask("Calculating\u2026")}onPropagationComplete({dryRun:e}){const t=this.getEditor();!e&&!this._canceling&&this.load(this.record),t.unmask()}getTaskMenuItems({taskRecord:e},t){return this.gantt.readOnly||(t.editTask={text:this.L("Edit"),icon:"b-icon b-icon-edit",weight:-200,onItem:()=>this.editTask(e)}),t}onEventEnterKey({taskRecord:e}){this.editTask(e)}}return e._$name="TaskEdit",e}(),!0,"Gantt"),To.registerFeature(function(){class e extends tl{getTimespanRecord(e){return e.taskRecord}getRowRecord(e){return e.taskRecord}setupProductResizeContext(e,t){const n=this.client,r=n.resolveTaskRecord(e.element);Object.assign(e,{taskRecord:r,dateConstraints:n.getDateConstraints(r)})}get store(){return this.client.taskStore}internalUpdateRecord(e,t){const n=t.run("calculateProjectedDuration",e.startDate,e.endDate);return n!==t.duration&&(t.setDuration(n),!0)}createResizeHelper(){const e=this,t=e.client;return new Hi({name:e.constructor.name,isElementResizable:(t,n)=>e.isElementResizable(t,n),targetSelector:t.eventSelector,resizingCls:"b-sch-event-resizing",allowResize:e.isElementResizable.bind(e),outerElement:t.timeAxisSubGridElement,scrollManager:t.scrollManager,leftHandle:!1,dragThreshold:0,listeners:{beforeresizestart:e.onBeforeResizeStart,resizestart:e.onResizeStart,resizing:e.onResizing,resize:e.onFinishResize,cancel:e.onCancelResize,thisObj:e},highlightHandle(){const e=yt.up(this.currentElement,this.targetSelector),n=yt.up(this.currentElement,t.eventInnerSelector);n&&(n.classList.add("b-resize-handle"),e.classList.add("b-over-resize-handle"))},unHighlightHandle(){const e=yt.up(this.currentElement,this.targetSelector);e&&e.classList.remove("b-over-resize-handle");const n=yt.up(this.currentElement,t.eventInnerSelector);n&&n.classList.remove("b-resize-handle"),this.currentElement=null}})}}return e._$name="TaskResize",e}(),!0,"Gantt"),To.registerFeature(function(){class e extends nl{static get defaultConfig(){return{template(e){const t=this,{taskRecord:n}=e;let{decimalPrecision:r}=t;null==r&&(r=t.client.durationDisplayPrecision);const s=Math.pow(10,r),i=Math.round(n.duration*s)/s;return`\n                    ${n.name?`<div class="b-gantt-task-title">${n.name}</div>`:""}\n                    <table border="0" cellspacing="0" cellpadding="0">\n                    <tr><td>${t.L("Start")}:</td><td>${e.startClockHtml}</td></tr>\n                    ${n.milestone?"":`\n                        <tr><td>${t.L("End")}:</td><td>${e.endClockHtml}</td></tr>\n                        <tr><td>${t.L("Duration")}:</td><td class="b-right">${i+" "+Ne.getLocalizedNameOfUnit(n.durationUnit,1!==n.duration)}</td></tr>\n                        <tr><td>${t.L("Complete")}:</td><td class="b-right">${n.renderedPercentDone}%</td></tr>\n                    `}\n                    </table>\n                `},decimalPrecision:null,cls:"b-gantt-task-tooltip"}}}return e._$name="TaskTooltip",e}(),!0,"Gantt");const sm=Object.freeze({});let im=0;const om=function(){class e extends(Dr(El).mixes(Sg,Dg,xg,Rg,kg,Mg,Yl,Ig)){static get defaultConfig(){return{project:null,calendars:null,resources:null,tasks:null,dependencies:null,assignments:null,eventCls:"b-gantt-task",eventBarTextField:null,eventLayout:"none",eventSelectionDisable:!0,eventColor:null,eventStyle:null,rowHeight:45,scheduledEventName:"task",eventScrollMode:"move",overScheduledEventClass:"b-gantt-task-hover",mode:"horizontal",timeCellCls:"b-sch-timeaxis-cell",timeCellSelector:".b-sch-timeaxis-cell",focusCls:"b-active",durationDisplayPrecision:1,taskRenderer:null}}construct(e){const t=this;e.features||(e.features={}),"tree"in e.features||(e.features.tree=!0);let n=e.project;const r=Boolean(e.calendars||e.taskStore||e.dependencyStore||e.resourceStore||e.assignmentStore),s=Boolean(e.calendars||e.tasks||e.dependencies||e.resources||e.assignments);if(n&&(r||s))throw new Error("Providing both project and inline data is not supported");n||(n=e.project=new Lg({calendarsData:e.calendars,eventsData:e.tasks,dependenciesData:e.dependencies,resourcesData:e.resources,assignmentsData:e.assignments,resourceStore:e.resourceStore,eventStore:e.taskStore,assignmentStore:e.assignmentStore,dependencyStore:e.dependencyStore,timeRangeStore:e.timeRangeStore}),delete e.resourceStore,delete e.taskStore,delete e.assignmentStore,delete e.dependencyStore,delete e.timeRangeStore,delete e.calendars,delete e.resources,delete e.tasks,delete e.assignments,delete e.dependencies),n.getEventStore().on({add:t.onTaskStoreAddOrRemove,remove:t.onTaskStoreAddOrRemove,prio:-1,thisObj:t}),n.on({eventstorechanged:t.onTaskStoreChange,refresh:t.onProjectRefresh,load:t.onProjectLoad,thisObj:t}),super.construct(e),t.features.cellEdit&&(t.features.cellEdit.addNewAtEnd={name:t.L("New Task"),startDate:n.startDate,duration:1,durationUnit:t.timeAxis.unit}),t.on("taskclick",t.onTaskBarClick,t),n.isCrudManagerLoading&&t.onStoreLoadStart()}get columns(){return super.columns}set columns(e){e&&!e.some(e=>{const t=e instanceof co?e.constructor:uo.getColumnClass(e.type);return t===pc||t.prototype instanceof pc})&&e.unshift({type:"name"}),super.columns=e}set timeAxisViewModel(e){super.timeAxisViewModel=e,this.taskStore&&(this.timeAxisViewModel.store=this.taskStore)}get timeAxisViewModel(){return super.timeAxisViewModel}onTaskStoreAddOrRemove({isExpand:e,isCollapse:t}){e||t||this.project.stm.isRestoring||this.requestAnimationFrame(()=>{this.project.isPropagating()||this.project.propagate()})}onProjectRefresh(){this.refreshRows();const e=this.features.dependencies;this.dependencies.forEach(t=>e.addToGridCache(t))}onProjectLoad(){"startDate"in this.initialConfig||!this.project.startDate||(this.startDate=this.project.startDate)}onTaskDataGenerated(){}onTaskBarClick({taskRecord:e}){e.isLeaf||this.toggleCollapse(e)}triggerChangeEvent(e,t){super.triggerChangeEvent(e,t);const n=this;function r(e,t){const r=n.getElementFromTaskRecord(e);r&&r.classList[t?"add":"remove"]("b-task-selected")}"row"===e.mode&&(e.selected.map(e=>r(e,!0)),e.deselected.map(e=>r(e,!1)))}get currentOrientation(){const e=this;return e._currentOrientation||(e.taskRendering=e._currentOrientation=new Cg(e)),e._currentOrientation}getTimeSpanMouseEventParams(e,t){const n=this.resolveTaskRecord(e);return n?{taskRecord:n,taskElement:e,event:t}:null}getScheduleMouseEventParams(e){return{taskRecord:this.store.getById(e.id)}}resolveTimeSpanRecord(e){return this.resolveTaskRecord(e)}repaintEventsForResource(e){this.taskRendering.cache.clearRow(e.id);const t=this.getRowFor(e);t&&this.rowManager.renderFromRow(t)}async addTask(e,t=sm){const n=this,{milestone:r,above:s,asChild:i,asPredecessor:o,asSuccessor:a}=t,l=n.store.getProject(),c=e.parent,d=e.copy();return c.isRoot&&(d.startDate=l.startDate),d.name=r?`${n.L("New milestone")} ${++im}`:`${n.L("New task")} ${++im}`,i?e.insertChild(d,e.firstChild):s?e.parent.insertChild(d,e):c.insertChild(d,e.nextSibling),r?await d.convertToMilestone():await l.propagate(),a?n.dependencyStore.add({fromEvent:e,toEvent:d,type:Jd.EndToStart,fromSide:"right",toSide:"left"}):o&&n.dependencyStore.add({fromEvent:d,toEvent:e,type:Jd.EndToStart,fromSide:"right",toSide:"left"}),(a||o)&&await l.propagate(),d}addTaskAbove(e){return this.addTask(e,{above:!0})}addTaskBelow(e){return this.addTask(e)}addMilestonBelow(e){return this.addTask(e,{milestone:!0})}addSubtask(e){const t=this.addTask(e,{asChild:!0});return this.toggleCollapse(e,!1),t}addSuccessor(e){return this.addTask(e,{asSuccessor:!0})}addPredecessor(e){return this.addTask(e,{above:!0,asPredecessor:!0})}}return e._$name="Gantt",e}();E.register("gantt",om),Ni.setVersion("gantt","1.1.5");const am=["left","left","right","right"],lm=["left","right","left","right"];To.registerFeature(function(){class e extends Ba{static get defaultConfig(){return{terminalSides:["left","right"],storeClass:uh,highlightDependenciesOnEventHover:!0}}construct(e,t={}){e instanceof om&&(this.gantt=e),t.hasOwnProperty("pathFinderConfig")?(t.pathFinderConfig.hasOwnProperty("otherHorizontalMargin")||(t.pathFinderConfig.otherHorizontalMargin=0),t.pathFinderConfig.hasOwnProperty("otherVerticalMargin")||(t.pathFinderConfig.otherVerticalMargin=0)):t.pathFinderConfig={otherHorizontalMargin:0,otherVerticalMargin:0},super.construct(e,t)}getDependencyAssignments(e){return this.gantt?[null]:super.getDependencyAssignments(e)}isDependencyVisible(e,t=null){const{client:n}=this,r=e.sourceTask,s=e.targetTask;if(r&&s&&Object(r)===r&&Object(s)===s)return r instanceof Uh&&!t?!(r.placeHolder||r.instanceMeta(n.store).hidden||s.placeHolder||s.instanceMeta(n.store).hidden):super.isDependencyVisible(e,t)}getBox(e,t,n=null){const r=this.getTimeSpanRecordFromDependency(e,t);return this.gantt?this.gantt.getTaskBox(r,!0,!0):r.isEvent||n?super.getBox(e,t,n):r.assignments.length?this.client.getResourceEventBox(r,r.assignments[0].resource,!0):null}getRowRecordFromDependency(e,t){if(!this.gantt){const n=this.getTimeSpanRecordFromDependency(e,t);return n.isEvent?super.getRowRecordFromDependency(e,t):n.assignments.length?n.assignments[0].resource:null}return this.getTimeSpanRecordFromDependency(e,t)}drawLine(e,t,n,r=null){super.drawLine(e,t,n,r);const{client:s}=this,i=this.getMetaId(r),o=t.instanceMeta(i).lineElement,a=t.toEvent;(!a.milestone&&(a.endDate<=s.startDate||s.endDate<=a.startDate)||a.milestone&&(a.endDate<s.startDate||s.endDate<a.startDate))&&o.classList.add("b-sch-dependency-ends-outside")}prepareLineDef(e,t,n=null){const r=this,s=r.getTimeSpanRecordFromDependency(e,!0),i=r.getTimeSpanRecordFromDependency(e,!1),o=e.type,a=this.pathFinder.startArrowMargin;let l=e.fromSide,c=e.toSide;if(!l)switch(!0){case o===Jd.StartToEnd:case o===Jd.StartToStart:l=r.getConnectorStartSide(s);break;case o===Jd.EndToStart:case o===Jd.EndToEnd:l=r.getConnectorEndSide(s);break;default:throw new Error("Invalid dependency type: "+o)}if(!c)switch(!0){case o===Jd.StartToEnd:c=r.getConnectorEndSide(i);break;case o===Jd.StartToStart:case o===Jd.EndToStart:c=r.getConnectorStartSide(i);break;case o===Jd.EndToEnd:c=r.getConnectorEndSide(i);break;default:throw new Error("Invalid dependency type: "+o)}const{startRectangle:d,endRectangle:u}=t;o===Jd.EndToStart&&d.bottom<u.y&&d.right-u.x<=0&&(c="top",e.targetTask.milestone||(u.right=u.x+2*a));const h=r.client.getRecordCoords(s,!0),g=r.client.getRecordCoords(i,!0);return{endBox:{start:d.x,end:d.right,top:d.y,bottom:d.bottom},startBox:{start:u.x,end:u.right,top:u.y,bottom:u.bottom},endSide:l,startSide:c,boxesReversed:!0,otherBoxes:[{start:d.x,end:d.right,top:h.y,bottom:h.y+h.height},{start:u.x,end:u.right,top:g.y,bottom:g.y+g.height}]}}drawForTask(e){this.drawForTimeSpan(e)}getHoverTipHtml({forElement:e}){const t=this.getDependencyForElement(e);if(!t)return null;const n=t.sourceTask,r=t.targetTask;return Gn.tpl`
             <table class="b-sch-dependency-tooltip">
                <tr>
                    <td>${this.L("from")}: </td>
                    <td>${n.name} ${n.id}</td>
                    <td><div class="b-sch-box b-${am[t.type]}"></div></td>
                </tr>
                <tr>
                    <td>${this.L("to")}: </td>
                    <td>${r.name} ${r.id}</td>
                    <td><div class="b-sch-box b-${lm[t.type]}"></div></td>
                </tr>
            </table>
        `}createDependency(){const e=this.creationData,t=e.sourceTerminal.dataset.side,n=e.targetTerminal.dataset.side;this.store.add({fromEvent:e.source,toEvent:e.target,type:("left"===t?0:2)+("right"===n?1:0),fromSide:t,toSide:n}),this.store.getProject().propagate()}createMarkers(){super.createMarkers();const e=(this.startMarker||this.endMarker).cloneNode(!0);e.setAttribute("id","arrowEndCritical"),this.client.svgCanvas.appendChild(e)}}return e._$name="Dependencies",e._$name="Dependencies",e}(),!0,"Gantt"),E.register("display",function(){class e extends zr{static get defaultConfig(){return{readOnly:!0,editable:!1,cls:"b-display-field"}}get focusElement(){}set readOnly(e){}get readOnly(){return!0}}return e._$name="DisplayField",e}());const cm=function(){class e extends Vn{static get defaultConfig(){return{items:[],draggable:{handleSelector:":not(button,.b-field-inner)"},axisLock:"flexible"}}processWidgetConfig(e){const t=this.dependencyEditFeature;return!("lagField"===e.ref&&!t.showLagField)&&!("deleteButton"===e.ref&&!t.showDeleteButton)&&(Object.assign(e,{}),super.processWidgetConfig(e))}afterShow(...e){const t=this.widgetMap.deleteButton;t&&(t.hidden=!this.record.isPartOfStore()),super.afterShow(...e)}onInternalKeyDown(e){this.trigger("keyDown",{event:e}),super.onInternalKeyDown(e)}}return e._$name="DependencyEditor",e}(),dm=function(){class e extends ur{static get defaultConfig(){return{autoClose:!0,saveAndCloseOnEnter:!0,showDeleteButton:!0,triggerEvent:"dependencydblclick",showLagField:!1,dependencyRecord:null,editorConfig:{title:"L{Edit dependency}",localeClass:this,closable:!0,items:[{type:"display",localeClass:this,label:"L{From}",editable:!1,ref:"fromNameField"},{type:"display",localeClass:this,label:"L{To}",ref:"toNameField"},{type:"combo",localeClass:this,label:"L{Type}",name:"type",ref:"typeField",editable:!1,valueField:"id",displayField:"name",items:Object.keys(Ia.Type).map(e=>({id:Ia.Type[e],name:this.L(e)}))},{type:"duration",localeClass:this,label:"L{Lag}",name:"lag",ref:"lagField"}],bbar:[{type:"widget",cls:"b-label-filler"},{color:"b-green",localeClass:this,text:"L{Save}",ref:"saveButton"},{color:"b-gray",localeClass:this,text:"L{Delete}",ref:"deleteButton"},{color:"b-gray",localeClass:this,text:"L{Cancel}",ref:"cancelButton"}]}}}construct(e,t){const n=this;if(e.dependencyEdit=n,n.dependencyStore=e.dependencyStore,super.construct(e,t),!e.features.dependencies)throw new Error("Dependencies feature required when using DependencyEdit");n.clientListenersDetacher=e.on({[n.triggerEvent]:n.onActivateEditor,thisObj:n})}doDestroy(){this.clientListenersDetacher(),this.editor&&this.editor.destroy(),super.doDestroy()}get editorConfig(){return this._editorConfig}set editorConfig(e){const t=this.getDefaultConfiguration().editorConfig;(e=We.assign({},t,e)).items=e.items||[],this._editorConfig=e}get isValid(){return Object.values(this.editor.widgetMap).every(e=>!(e.name&&!e.hidden)||!1!==e.isValid)}get values(){const e={};return this.editor.eachWidget(t=>{t.name&&!t.hidden&&(e[t.name]=t.value)},!0),e}onBeforeSave(e){}onAfterSave(e){}updateRecord(e){const t=this.values;if(e.beginBatch(),e.set(t),this.lagField){const t=this.lagField.value;e.setLag(t.magnitude,t.unit)}this.typeField&&"type"in t&&e.set({fromSide:null,toSide:null}),e.endBatch()}onPopupKeyDown({event:e}){"Enter"===e.key&&this.saveAndCloseOnEnter&&"input"===e.target.tagName.toLowerCase()&&(e.preventDefault(),this.onSaveClick())}onSaveClick(){this.save()&&this.editor.hide()}onDeleteClick(){this.deleteDependency(),this.editor.hide()}onCancelClick(){this.editor.hide()}internalShowEditor(e){const t=this,n=t.client;let r=t.lastPointerDownCoordinate;if(!1===n.trigger("beforeDependencyEdit",{dependencyEdit:t,dependencyRecord:e}))return;const s=t.getEditor(e);if(t.loadRecord(e),n.trigger("beforeDependencyEditShow",{dependencyEdit:t,dependencyRecord:e,editor:s}),!r){const e=oe.from(t.client.element).center;r=[e.x-s.width/2,e.y-s.height/2]}s.showByPoint(r)}editDependency(e){this.client.readOnly||this.internalShowEditor(e)}getEditor(){const e=this;let{editor:t}=e;return t||(0===(t=e.editor=new cm(We.assign({dependencyEditFeature:e,autoShow:!1,anchor:!0,scrollAction:"realign",clippedBy:[e.client.timeAxisSubGridElement,e.client.bodyContainer],constrainTo:window,autoClose:e.autoClose,cls:e.cls,listeners:{keydown:e.onPopupKeyDown,thisObj:e}},e.editorConfig))).items.length&&console.warn("Editor configured without any `items`"),t.eachWidget(t=>{const n=t.ref||t.id;n&&!e[n]&&(e[n]=t)}),e.saveButton&&e.saveButton.on("click",e.onSaveClick,e),e.deleteButton&&e.deleteButton.on("click",e.onDeleteClick,e),e.cancelButton&&e.cancelButton.on("click",e.onCancelClick,e),e.editor)}loadRecord(e){const t=this;t.fromNameField.value=e.sourceEvent.name,t.toNameField.value=e.targetEvent.name,t.lagField&&(t.lagField.unit=e.lagUnit),t.editor.record=t.dependencyRecord=e}save(){const e=this,{client:t,dependencyRecord:n}=e;if(!n||!e.isValid)return;const r=e.dependencyStore;if(!1!==t.trigger("beforeDependencySave",{dependencyRecord:n,values:e.values})){if(e.onBeforeSave(n),e.updateRecord(n),r&&!n.stores.length){if(!1===t.trigger("beforeDependencyAdd",{dependencyRecord:n,dependencyEdit:e}))return;r.add(n)}t.project&&t.project.propagate(),t.trigger("afterDependencySave",{dependencyRecord:n}),e.onAfterSave(n)}return n}deleteDependency(){const e=this;return!1!==e.client.trigger("beforeDependencyDelete",{dependencyRecord:e.dependencyRecord})&&(e.editor.containsFocus&&e.editor.revertFocus(),e.client.dependencyStore.remove(e.dependencyRecord),e.client.project&&e.client.project.propagate(),!0)}onActivateEditor({dependency:e,event:t}){this.disabled||(this.lastPointerDownCoordinate=[t.clientX,t.clientY],this.editDependency(e))}get disabled(){return this._disabled}set disabled(e){this._disabled=e}}return e._$name="DependencyEdit",e}();To.registerFeature(dm,!1),To.registerFeature(function(){class e extends dm{static get defaultConfig(){return{showLagField:!0}}}return e._$name="DependencyEdit",e}(),!1),To.registerFeature(function(){class e extends(U(ur)){static get defaultConfig(){return{statusDate:new Date,drawLineOnlyWhenStatusDateVisible:!1,lineCls:"b-gantt-progress-line",containerCls:"b-progress-line-canvas"}}static get pluginConfig(){return{chain:["render"]}}construct(e,t={}){const n=this;n.doScheduleDraw=n.createOnFrame("draw",[],n,!0),super.construct(e,t),this.lineSegments=[],e.store.on({refresh:n.onRowStoreRefresh,thisObj:n}),e.rowManager.on({translaterow:n.onTranslateRow,refresh:n.scheduleDraw,rerender:n.scheduleDraw,changetotalheight:n.scheduleDraw,thisObj:n}),e.on({horizontalscroll:n.scheduleDraw,togglenode:n.scheduleDraw,taskdrag:n.onTaskDrag,timelineviewportresize:n.scheduleDraw,thisObj:n})}get statusDate(){return this._statusDate}set statusDate(e){e instanceof Date&&(this._statusDate=e,this.scheduleDraw())}render(){const{client:e}=this;e.taskStore.on({change:this.scheduleDraw,thisObj:this})}getSVGCanvas(){const e=this,{client:t}=e;if(!e._svgCanvas){const n=e._svgCanvas=document.createElementNS("http://www.w3.org/2000/svg","svg");n.classList.add(e.containerCls),t.foregroundCanvas.appendChild(n)}return e._svgCanvas}onRowStoreRefresh({action:e}){switch(e){case"sort":case"filter":this.scheduleDraw()}}onTranslateRow({row:e}){e.lastTop>=0&&e.top!==e.lastTop&&this.scheduleDraw()}onTaskDrag({taskRecords:e,dragData:t}){e.forEach(e=>{this.updateLineForTask(e,{[e.id]:Ne.add(e.startDate,t.timeDiff)})})}shouldDrawProgressLine(){return!this.disabled&&(!this.drawLineOnlyWhenStatusDateVisible||this.client.timeAxis.dateInAxis(this.statusDate))}getStatusDateX(){let{client:e}=this,t=this.statusDate;return e.timeAxis.dateInAxis(t)||(t=t<e.timeAxis.startDate?e.timeAxis.startDate:e.timeAxis.endDate),e.getCoordinateFromDate(t)}getRenderData(){const e=this.getStatusDateX(),t=this.client.subGrids.normal.element.getBoundingClientRect();return{statusDateX:e,viewXY:[this.client.scrollLeft-t.left,-t.top]}}scheduleDraw(){this.doScheduleDraw()}draw(){const e=this,{client:t}=e;if(e.lineSegments.forEach(e=>e.remove()),e.lineSegments=[],!e.shouldDrawProgressLine())return;const n=e.getRenderData(),r=[];t.rowManager.forEach(t=>{r.push(...e.getLineSegmentRenderData(t,n))}),r.forEach(t=>e.drawLineSegment(t)),t.trigger("progressLineDrawn")}updateLineForTask(e,t){const n=this;if(n.disabled)return;const r=n.client.getRowFor(e);if(r){const s=[];n.lineSegments.forEach(t=>{t.dataset.taskId==e.id&&(s.push(t),t.remove())}),le.remove(n.lineSegments,...s),n.getLineSegmentRenderData(r,n.getRenderData(),t).forEach(e=>n.drawLineSegment(e))}}getLineSegmentRenderData(e,t,n={}){const{statusDateX:r,viewXY:s}=t,i=this.client.getRecordFromElement(e.elements.normal),o=i.id;let a,l=[];return this.isStatusLineTask(i,n[i.id])&&(a=this.calculateCoordinateForTask(i,s))&&l.push({dataset:{taskId:o},x1:r,y1:e.top,x2:a.x,y2:a.y},{dataset:{taskId:o},x1:a.x,y1:a.y,x2:r,y2:e.bottom}),a||l.push({dataset:{taskId:o},x1:r,y1:e.top,x2:r,y2:e.bottom}),l}drawLineSegment(e){this.lineSegments.push(yt.createElement(Object.assign({tag:"line",ns:"http://www.w3.org/2000/svg",class:this.lineCls,parent:this.getSVGCanvas()},e)))}isStatusLineTask(e,t){const n=this.statusDate;return t=t||e.startDate,e&&this.client.timeAxis.isTimeSpanInAxis(e)&&!e.milestone&&(e.isInProgress||!e.isStarted&&t<n||e.isCompleted&&t>n)}calculateCoordinateForTask(e,t){const{client:n}=this,r=n.getElementFromTaskRecord(e),s=n.timeAxisViewModel.totalSize,i=r.querySelector(".b-gantt-task-percent");if(i){const e=i.getBoundingClientRect();return{x:Math.min(e.right+t[0],s),y:e.top+e.height/2+t[1]}}}get disabled(){return this._disabled}set disabled(e){this._disabled=e,this.client.rendered&&this.draw()}}return e._$name="ProgressLine",e}()),To.registerFeature(function(){class e extends ol{static get defaultConfig(){return{showHeaderElements:!0,cls:"b-gantt-project-line"}}startConfigure(){}render(){const e=this;[e.startDateLine,e.endDateLine]=e.store.add([{name:e.L("Project Start")},{name:e.L("Project End")}]),e.updateDateFromProject(),super.render(...arguments),e.client.project.taskStore.on({update:e.onProjectTaskStoreRecordUpdate,refresh:e.onProjectTaskStoreRefresh,thisObj:e})}updateLocalization(){const e=this;e.client.rendered&&(e.startDateLine.name=e.L("Project Start"),e.endDateLine.name=e.L("Project End"))}updateDateFromProject(){const e=this.client.project;this.startDateLine.startDate=e.startDate,this.endDateLine.startDate=e.endDate}onProjectTaskStoreRecordUpdate({record:e}){e===this.client.project&&this.updateDateFromProject()}onProjectTaskStoreRefresh(e){this.updateDateFromProject()}}return e._$name="ProjectLines",e}(),!0,"Gantt");const um=/([a-z])([A-Z])/g,hm=/[.*+?^${}()|[\]\\]/g,gm=/(^[^a-z]+|[^\w]+)/gi,mm=(e,t,n)=>t+"-"+n.toLowerCase(),pm=e=>e?`_x${e.charCodeAt(0).toString(16)}`:"__blank__",fm={},vm=function(){class e{static capitalizeFirstLetter(e){return e?e[0].toUpperCase()+e.substr(1):null}static lowercaseFirstLetter(e){return e?e[0].toLowerCase()+e.substr(1):null}static hyphenate(e){return fm[e]||(fm[e]=e.replace(um,mm))}static safeJsonParse(e){let t=null;try{t=JSON.parse(e)}catch(n){console.error(n)}return t}static safeJsonStringify(e){let t=null;try{t=JSON.stringify(e)}catch(n){console.error(n)}return t}static createId(e){return String(e).replace(gm,pm)}static escapeRegExp(e){return e.replace(hm,"\\$&")}}return e._$name="StringHelper",e}(),ym=Symbol("defaultConfig"),bm=Symbol("propertyInitializers"),Cm=Symbol("classHierarchy"),wm=Symbol("configuration"),Sm=Symbol("originalConfig"),Dm=Symbol("instanceProperties"),Em=function(){class e{constructor(...e){this.construct(...e),this.afterConstruct()}construct(...e){null!==e[0]&&this.configure(...e),this.afterConfigure()}destroy(){const e=this;e.isDestroying=!0,e.doDestroy(),Object.setPrototypeOf(this,null);for(let t in e)delete e[t];delete e[Sm],e.isDestroyed=!0}_thisIsAUsedExpression(e){}static get $name(){return this.hasOwnProperty("_$name")&&this._$name||this.name}get $name(){return this.constructor.$name}startConfigure(e){}finishConfigure(e){}afterConfigure(){}afterConstruct(){}callback(e,t,n){"this"===t&&(t=this);const{handler:r,thisObj:s}=this.resolveCallback(e,t);return n?r.apply(s,n):r.call(s)}resolveCallback(e,t=this){if(e.substr){if(e.startsWith("up."))for(e=e.substr(3),t=this.owner;t&&!t[e];t=t.owner);else e.startsWith("this.")&&(t=this);e=t[e]}return{handler:e,thisObj:t}}doDestroy(){}destroyProperties(...e){const t=this;let n,r;for(n of e)!(n in t)||t[wm]&&t[wm][n]||((r=t[n])&&r.destroy&&r.destroy(),delete t[n])}configure(t={}){const n=this;n.initialConfig=t,n.isConfiguring=!0,Object.assign(n,n.getProperties()),n.setConfig(n[Sm]=e.assign(n.getDefaultConfiguration(),t),!0),n.isConfiguring=!1}setConfig(t,n){const r=this,s=r[wm],i=s?r.configDone:r.configDone={},o=r[Dm]={};let a,l;for(a in r[wm]=s?Object.setPrototypeOf(Object.assign({},t),s):t,t)null!=t[a]||t.hasOwnProperty(a)?(o[a]||!(l=Reflect.getOwnPropertyDescriptor(r,a))||"value"in l||(o[a]=l),Reflect.defineProperty(r,a,e.createPropInitializer(a)),n||(i[a]=!1)):i[a]=!0;for(a in n&&r.startConfigure(t),t)i[a]||(r[a]=t[a]);s?r[wm]=s:delete r[wm],n&&r.finishConfigure(t)}get config(){let e,t={},n=this[Sm];for(e in n)t[e]=n[e];return t}getDefaultConfiguration(){return this.constructor.getDefaultConfiguration()}static getDefaultConfiguration(){const e=this.getConfigDescriptor();return e.needsFork?this.fork(e.defaultConfig):Object.setPrototypeOf({},e.defaultConfig)}static getConfigDescriptor(t){const n=this;let r,s,i,o,a,l=!t&&n.hasOwnProperty(ym)?n[ym]:null;if(!l){for(s in l={defaultConfig:r=n.hasOwnProperty("defaultConfig")?n.defaultConfig:{},needsFork:0},t||(n[ym]=l),r)if((o=r[s])&&(o.constructor===Object||Array.isArray(o))&&!Object.isFrozen(o)){l.needsFork=1;break}if(!t)for(i=n.superclass;i&&i!==e;i=i.superclass)a=i.getConfigDescriptor(!0),Object.keys(a.defaultConfig).length&&(l.needsFork|=a.needsFork,Object.setPrototypeOf(r,r=a.defaultConfig))}return l}static fork(e){var t,n,r;if(e&&e.constructor===Object&&!Object.isFrozen(e))for(n in t=Object.setPrototypeOf({},e),e)(r=e[n])&&(r.constructor===Object?t[n]=this.fork(r):r instanceof Array&&(t[n]=r.slice()));else t=e;return t}static assign(e,...t){for(var n,r,s=0,i=t.length;s<i;s++)for(r in n=t[s])e[r]=n[r];return e}getProperties(){const e=this.classHierarchy(),t=e.length;let n,r,s={};for(n=0;n<t;n++)(r=e[n]).hasOwnProperty("properties")&&Object.assign(s,r.properties);return s}static get superclass(){return Object.getPrototypeOf(this)}static createPropInitializer(e){var t=(this[bm]||(this[bm]={}))[e];if(!t){let n="initializing"+vm.capitalizeFirstLetter(e);t=this[bm][e]={configurable:!0,get(){const t=this,r=t[Dm][e];return r?Reflect.defineProperty(t,e,r):delete t[e],t[n]=!0,t[e]=t[wm][e],t[n]=!1,t.configDone[e]=!0,t[e]},set(t){const n=this,r=n[Dm][e];r?Reflect.defineProperty(n,e,r):delete n[e],n.configDone[e]=!0,n[e]=t}}}return t}classHierarchy(t){let n,r=this.constructor,s=r.hasOwnProperty(Cm)?r[Cm]:null;if(!s){for(s=r[Cm]=[];r!==e;r=Object.getPrototypeOf(r))s.unshift(r);Object.freeze(s)}if(t)for(let e=0;!n&&e<s.length;e++)s[e]===t&&(n=s.slice(e));else n=s;return n}classNameHierarchy(e){return this.classHierarchy(e).map(e=>e.$name)}static isOfTypeName(e){return this.classNameHierarchy().includes(e)}}return e._$name="Base",e}(),xm=function(){class e{static get(e,t){return this.fetch(e,t)}static post(e,t,n={}){return t instanceof FormData||"string"==typeof t||(t=JSON.stringify(t)),this.fetch(e,Object.assign({method:"POST",body:t},n))}static fetch(e,t={}){const n=new AbortController;if(t.signal=n.signal,"credentitals"in t||(t.credentials="include"),t.queryParams){const n=Object.entries(t.queryParams);n.length&&(e+="?"+n.map(([e,t])=>`${e}=${encodeURIComponent(t)}`).join("&"))}const r=new Promise((n,r)=>{fetch(e,t).then(e=>{t.parseJson?e.json().then(t=>{e.parsedJson=t,n(e)}).catch(t=>{e.parsedJson=null,e.error=t,r(e)}):n(e)}).catch(e=>{r(e)})});return r.abort=function(){n.abort()},r}}return e._$name="AjaxHelper",e}(),Tm=function(){class e{static clean(e){return e.reduce((e,t)=>(null==t||Array.isArray(t)&&0===t.length||""===t||e.push(t),e),[])}static remove(e,...t){let n,r,s=!1;for(let i=0;i<t.length;i++)-1!==(n=e.indexOf(r=t[i]))&&(e.splice(n,1),s=!0);return s}static findInsertionIndex(e,t,n=this.lexicalCompare,r){const s=t.length;let i,o;return r<s&&(i=r>0?n(t[r-1],e):0,o=r<s-1?n(e,t[r]):0,i<1&&o<1)?r:this.binarySearch(t,e,n)}static binarySearch(e,t,n=0,r=e.length,s=this.lexicalCompare){let i,o;for(n instanceof Function?(s=n,n=0):r instanceof Function&&(s=r,r=e.length),--r;n<=r;)(o=s(t,e[i=n+r>>1]))>=0?n=i+1:o<0&&(r=i-1);return n}magnitudeCompare(e,t){return e<t?-1:e>t?1:0}lexicalCompare(e,t){return(e=String(e))<(t=String(t))?-1:e>t?1:0}static fill(e,t={},n=null){const r=[],s=Array.isArray(t)?t:[t];for(let i=0;i<e;i++)for(let e of s){const t=Object.assign({},e);n&&n(t,i),r.push(t)}return r}static populate(e,t){const n=[];for(let r=0;r<e;r++)n.push(t(r));return n}static include(e,t){e.includes(t)||e.push(t)}static allowNegative(e){return new Proxy(e,{get(e,t,n){if("string"!=typeof t)return Reflect.get(e,t,n);const r=Number(t);return Number.isNaN(r)?Reflect.get(e,t,n):e[r<0?e.length+r:r]},set(e,t,n,r){if("string"!=typeof t)return Reflect.set(e,t,n,r);const s=Number(t);return Number.isNaN(s)?Reflect.set(e,t,n,r):(e[s<0?e.length+s:s]=n,!0)}})}}return e._$name="ArrayHelper",e}(),Rm={thisObj:1,detachable:1,once:1,detacher:1,prio:1,args:1,_oldDestructor:1},km=(e,t)=>t.prio-e.prio;var Mm=e=>(class extends(e||Em){destroy(){this.trigger("beforeDestroy"),super.destroy()}construct(...e){super.construct(...e),this.processConfiguredListeners()}processConfiguredListeners(e=this.listeners){const t=this;if(t.listeners=e,t.listeners&&!t.defaultListenersInitialized){const e=t.addListener(t.listeners,t);!1!==t.listeners.detachable&&(t.listeners.detacher=e),t.defaultListenersInitialized=!0}}doDestroy(){const e=this;e.trigger("destroy"),e.listeners&&e.listeners.detacher&&e.listeners.detacher(),e.removeAllListeners(),super.doDestroy()}addListener(e,t,n){const r=this,s=r.eventListeners||(r.eventListeners={});if("string"==typeof e)return r.addListener({[e]:t,detachable:!1!==t.detachable,thisObj:n});t=void 0!==e.thisObj?e.thisObj:e.thisObj=t;for(const i in e)if(!Rm[i]){const n=e[i],r={fn:"object"==typeof n?n.fn:n,thisObj:void 0!==n.thisObj?n.thisObj:t,args:n.args||e.args,prio:void 0!==n.prio?n.prio:void 0!==e.prio?e.prio:0,once:void 0!==n.once?n.once:void 0!==e.once&&e.once,catchAll:"catchAll"===i},o=i.toLowerCase(),a=s[o]||(s[o]=[]);a.splice(Tm.findInsertionIndex(r,a,km,a.length),0,r)}return e.relayAll&&r.relayAll(e.relayAll),t&&r.attachAutoDetacher(e),!1!==e.detachable?()=>r.removeListener(e):void 0}on(){return this.addListener(...arguments)}un(){this.removeListener(...arguments)}removeListener(e,t=e.thisObj,...n){const r=this;"string"!=typeof e?(Object.entries(e).forEach(([e,n])=>{if(Rm[e])return;const s=e.toLowerCase(),i=r.eventListeners&&r.eventListeners[s];if(i){const e=i.findIndex(e=>!(e.fn!==n&&e.fn!==n.fn||e.thisObj!==t&&e.thisObj!==n.thisObj&&t));e>=0&&(i.splice(e,1),i.length||delete r.eventListeners[s])}}),e.thisObj&&!e.thisObj.isDestroyed&&r.detachAutoDetacher(e)):r.removeListener({[e]:t},!(n.length>0)||n[0])}hasListener(e){return Boolean(this.eventListeners&&this.eventListeners[e])}relayAll(e,t,n=!0){this.relayAllTargets||(this.relayAllTargets=[]),this.relayAllTargets.push({through:e,prefix:t,transformCase:n})}removeAllListeners(){const e=this,t=e.eventListeners||(e.eventListeners={});for(let n in t)t[n].forEach(t=>e.removeListener(n,t))}relayEvents(e,t,n){const r=this,s={detachable:!0};return t.forEach(e=>{s[e]=((...t)=>(function(e,...t){return r.trigger((n||"")+e,...t)})(e,...t))}),e.on(s)}attachAutoDetacher(e){const t=e.thisObj,n="doDestroy"in t?"doDestroy":"destroy";n in t?(e._oldDestructor=t[n],t[n]=(()=>{this.isDestroyed||this.removeListener(e),e._oldDestructor.call(t)})):t[n]=(()=>{this.removeListener(e)})}detachAutoDetacher(e){const t=e.thisObj;e._oldDestructor&&(t["doDestroy"in t?"doDestroy":"destroy"]=e._oldDestructor)}await(e,t={checkLog:!0,resetLog:!0}){const n=this;return new Promise(r=>{t.checkLog&&n._triggered&&n._triggered[e]&&(r(),t.resetLog&&n.clearLog(e)),n.on({[e]:(...s)=>{r(...s),t.resetLog&&n.clearLog(e)},prio:-1e4,once:!0})})}clearLog(e){this._triggered&&(e?delete this._triggered[e]:this._triggered={})}callPreventable(e,t,n,r=[],s=!1){if(!s&&!1===this.trigger("before"+vm.capitalizeFirstLetter(e),t))return!1;const i=n(t,...r);return s||this.trigger(e,t),i}trigger(e,t){const n=this,r=e.toLowerCase(),{eventsSuspended:s,relayAllTargets:i,callOnFunctions:o}=n;let a=n.eventListeners&&n.eventListeners[r],l=!0;if(n._triggered||(n._triggered={}),n._triggered[e]=!0,s)return s.shouldQueue&&s.queue.push(arguments),!0;if(n.eventListeners&&n.eventListeners.catchall&&((a=a?a.slice():[]).push(...n.eventListeners.catchall),a.sort(km),l=!1),!a&&!i&&!o)return!0;if(t?"source"in t||(Object.isExtensible(t)?t.source=n:t=Object.setPrototypeOf({source:n},t)):t={source:n},t.type!==r&&(t.constructor!==Object?Reflect.defineProperty(t,"type",{get:()=>r}):t.type=r),o){const r="on"+vm.capitalizeFirstLetter(e);if(r in n&&(n.callback(n[r],n,[t]),!n.isDestroyed&&n.hasOwnProperty(r))){const e=Object.getPrototypeOf(n);if(r in e&&(e[r].call(n,t),n.isDestroyed))return}}if(a){let e,s,i=0;for(l&&(a=a.slice());i<a.length&&!n.isDestroyed;i++){let o=(e=a[i]).thisObj;if(!o||!o.isDestroyed){if(e.once&&n.removeListener(r,e),"string"==typeof e.fn){if(o&&(s=o[e.fn]),!s){const t=n.resolveCallback(e.fn);s=t.handler,o=t.thisObj}}else s=e.fn;if(e.args){if(!1===s.call(o||n,...e.args,t))return!1}else if(!1===s.call(o||n,t))return!1}}}if(i&&i.forEach(n=>{let r=e;if(n.transformCase&&(r=vm.capitalizeFirstLetter(r)),n.prefix&&(r=n.prefix+r),!1===n.through.trigger(r,t))return!1}),t.bubbles){const r=n.owner;if(r)return r.trigger(e,t)}return!0}suspendEvents(e=!1){(this.eventsSuspended||(this.eventsSuspended={shouldQueue:e,queue:[],count:0})).count++}resumeEvents(){const e=this.eventsSuspended;if(e&&0==--e.count&&(this.eventsSuspended=null,e.shouldQueue))for(let t of e.queue)this.trigger(...t);return!Boolean(this.eventsSuspended)}});let Im=new class extends(Mm(Em)){static get defaultConfig(){return{locales:{}}}construct(...e){const t=this;super.construct(...e);let n=document.querySelector("script[data-default-locale]");n&&(t.defaultLocaleName=n.dataset.defaultLocale),window.bryntum&&window.bryntum.locales&&(Object.keys(window.bryntum.locales).forEach(e=>{if(!e.startsWith("moment")){let n=window.bryntum.locales[e];n.extends?t.extendLocale(n.extends,n):t.registerLocale(n.localeName,{desc:n.localeDesc,locale:n})}}),t.locale||"En"!==t.defaultLocaleName&&t.applyLocale(t.defaultLocaleName||Object.keys(t.locales)[0]))}set locales(e){this._locales=e}get locales(){return this._locales}set locale(e){"string"==typeof e?this.applyLocale(e):(e.locale||(e={locale:e,localeName:e.localeName||"custom"}),this.registerLocale(e.localeName,e),this.applyLocale(e.localeName))}get locale(){return this._locale}registerLocale(e,t){const n=this,r=n.defaultLocaleName===e,s=n.locale&&n.locale.localeName===e,i=0===Object.keys(n.locales).length;n.locales[e]=t,(r||!n.defaultLocaleName&&(i||s))&&n.internalApplyLocale(t)}extendLocale(e,t){const n=this.locales[e];return!!n&&(Object.keys(t).forEach(e=>{n.locale[e]?Object.assign(n.locale[e],t[e]):n.locale[e]=t[e]}),delete n.locale.extends,!0)}internalApplyLocale(e){this._locale=e.locale,this.trigger("locale",e)}applyLocale(e,t=!1,n=!1){const r=this,s=r.locales[e];if(s&&s.locale&&r._locale===s.locale&&!t)return!0;if(!s){if(n)return!0;throw new Error(`Locale ${e} not registered`)}function i(){r.internalApplyLocale(s)}return s.locale?(i(),!0):new Promise((t,n)=>{r.loadLocale(s.path).then(n=>{n.text().then(n=>{new Function(n)(),s.locale=window.bryntum.locales[e],i(),t(s)})}).catch(e=>n(e))})}loadLocale(e){return xm.get(e)}};var Am=e=>(class t extends(e||Em){static get defaultConfig(){return{localeClass:null,localizableProperties:[]}}static get inTextLocaleRegExp(){return/L\{([^}]+)\}/g}static parseText(e){const t=this.inTextLocaleRegExp.exec(e);return t?t[1]:e}construct(e={},...t){super.construct(e,...t),Im.on("locale",this.updateLocalization,this),this.updateLocalization()}get localeClass(){return this._localeClass||this.parent&&this.parent.localeClass||null}set localeClass(e){this._localeClass=e}updateLocalization(){const e=this;e.localizableProperties&&e.localizableProperties.forEach(n=>{void 0!==e[n]&&(e.originalLocales=e.originalLocales||{},e.originalLocales[n]=e.originalLocales[n]||e[n],e.originalLocales[n]&&(e[n]=t.L.call(e,e.originalLocales[n])))})}static L(e,n,r=this.localeClass||this){if(Im.locale)for(;r;){const s=Im.locale[r.$name||r.name],i=s&&s[t.parseText(e)];if(i)return"function"==typeof i&&null!=n?i(n):i;r=Object.getPrototypeOf(r)}return e}L(e,n){return t.L(e,n,this.constructor)}get localeManager(){return Im}});const Fm=function(){class e{static cacheFlags(e=navigator.platform,t=navigator.userAgent){const n=this;n._isLinux=Boolean(e.match(/Linux/)),n._isMac=Boolean(e.match(/Mac/)),n._isWindows=Boolean(e.match(/Win32/)),n._isIE11=Boolean(t.match(/rv:11/)),n._edgeVersion=n.getVersion(t,/Edge\/(\d+)\./),n._isEdge=n._edgeVersion>0,n._isWebkit=Boolean(t.match(/WebKit/))&&!n._isEdge,n._firefoxVersion=n.getVersion(t,/Firefox\/(\d+)\./),n._isFirefox=n._firefoxVersion>0,n._chromeVersion=n._isEdge?0:n.getVersion(t,/Chrom(?:e|ium)\/(\d+)\./),n._isChrome=n._chromeVersion>0,n._isSafari=Boolean(t.match(/Safari/))&&!n._isChrome&&!n._isEdge,n._isMobileSafari=Boolean(t.match(/Mobile.*Safari/));try{document.querySelector(":scope"),n.supportsQueryScope=!n._isFirefox}catch(r){n.supportsQueryScope=!1}n._supportsPassive=!1;try{document.addEventListener("__notvalid__",null,{get passive(){n._supportsPassive=!0}})}catch(r){}}static getVersion(e,t){const n=e.match(t);return n?parseInt(n[1]):0}static get isTouchDevice(){return"_isTouchDevice"in this?this._isTouchDevice:"ontouchstart"in window||!this.isEdge&&navigator.maxTouchPoints>0||this.isEdge&&window.TouchEvent||navigator.msMaxTouchPoints>0}static set isTouchDevice(e){this._isTouchDevice=e}static get isMac(){return this._isMac}static get isWindows(){return this._isWindows}static get isLinux(){return this._isLinux}static get isIE11(){return this._isIE11}static get isEdge(){return this._isEdge}static get edgeVersion(){return this._edgeVersion}static get isWebkit(){return this._isWebkit}static get isChrome(){return this._isChrome}static get chromeVersion(){return this._chromeVersion}static get isFirefox(){return this._isFirefox}static get firefoxVersion(){return this._firefoxVersion}static get isSafari(){return this._isSafari}static get isMobileSafari(){return this._isMobileSafari}static get supportsPassive(){return this._supportsPassive}static get storageAvailable(){let e,t;try{return(e=localStorage).setItem(t="__storage_test__",t),e.removeItem(t),!0}catch(n){return n instanceof DOMException&&(22===n.code||1014===n.code||"QuotaExceededError"===n.name||"NS_ERROR_DOM_QUOTA_REACHED"===n.name)&&0!==e.length}}static setLocalStorageItem(e,t){this.storageAvailable&&localStorage.setItem(e,t)}static getLocalStorageItem(e){return this.storageAvailable&&localStorage.getItem(e)}static removeLocalStorageItem(e){this.storageAvailable&&localStorage.removeItem(e)}}return e._$name="BrowserHelper",e}();Fm.cacheFlags();const Om=e=>e+({1:"st",2:"nd",3:"rd"}[e[e.length-1]]||"th"),Lm=new RegExp("\u200e");let _m="en-US",Pm=Om,$m={},jm={},Hm={};function Nm(e,t,n){let r=(jm[e]||(jm[e]=new Intl.DateTimeFormat(_m,t))).format(n);return Fm.isIE11&&(r=r.replace(Lm,"")),r}const zm="YYYY-MM-DDTHH:mm:ss.SSSZ",Bm={M:e=>e.getMonth()+1,Mo:e=>Pm(Bm.M(e).toString()),MM:e=>(e.getMonth()+1).toString().padStart(2,"0"),MMM:e=>Nm("MMM",{month:"short"},e),MMMM:e=>Nm("MMMM",{month:"long"},e),Q:e=>Math.ceil((e.getMonth()+1)/4),Qo:e=>Pm(Bm.Q(e).toString()),D:e=>e.getDate(),Do:e=>Pm(Bm.D(e).toString()),DD:e=>e.getDate().toString().padStart(2,"0"),DDD:e=>Math.ceil((new Date(e.getFullYear(),e.getMonth(),e.getDate(),12,0,0)-new Date(e.getFullYear(),0,0,12,0,0))/864e5),DDDo:e=>Pm(Bm.DDD(e).toString()),DDDD:e=>Bm.DDD(e).toString().padStart(3,"0"),d:e=>e.getDay(),do:e=>Pm(e.getDay().toString()),dd:e=>Bm.ddd(e).substring(0,2),ddd:e=>Nm("ddd",{weekday:"short"},e),dddd:e=>Nm("dddd",{weekday:"long"},e),e:e=>e.getDay(),E:e=>e.getDay()+1,W:e=>{const t=new Date(e.valueOf());t.setDate(t.getDate()-(e.getDay()+6)%7+3);const n=t.valueOf();return t.setMonth(0,1),4!==t.getDay()&&t.setMonth(0,1+(4-t.getDay()+7)%7),1+Math.ceil((n-t)/6048e5)},Wo:e=>Pm(Bm.W(e).toString()),WW:e=>Bm.W(e).toString().padStart(2,"0"),Y:e=>e.getFullYear(),YY:e=>e.getFullYear()%100,YYYY:e=>e.getFullYear(),A:e=>e.getHours()<12?"AM":"PM",a:e=>e.getHours()<12?"am":"pm",H:e=>e.getHours(),HH:e=>e.getHours().toString().padStart(2,"0"),h:e=>e.getHours()%12||12,hh:e=>Bm.h(e).toString().padStart(2,"0"),k:e=>e.getHours()+1,kk:e=>Bm.k(e).toString().padStart(2,"0"),K:e=>Nm("K",{hour:"numeric"},e),KK:e=>Nm("KK",{hour:"2-digit"},e),m:e=>e.getMinutes(),mm:e=>Bm.m(e).toString().padStart(2,"0"),s:e=>e.getSeconds(),ss:e=>Bm.s(e).toString().padStart(2,"0"),S:e=>e.getMilliseconds().toString().substr(0,1),SS:e=>e.getMilliseconds().toString().substr(0,2).padEnd(2,"0"),SSS:e=>e.getMilliseconds().toString().substr(0,3).padEnd(3,"0"),z:e=>Nm("z",{timeZoneName:"short"},e),zz:e=>Nm("zz",{timeZoneName:"long"},e),LT:e=>Nm("LT",{hour:"2-digit",minute:"2-digit"},e),LTS:e=>Nm("LTS",{hour:"2-digit",minute:"2-digit",second:"2-digit"},e),L:e=>Nm("L",{year:"numeric",month:"2-digit",day:"2-digit"},e),l:e=>Nm("l",{year:"numeric",month:"numeric",day:"numeric"},e),LL:e=>Nm("LL",{year:"numeric",month:"long",day:"numeric"},e),ll:e=>Nm("ll",{year:"numeric",month:"short",day:"numeric"},e),LLL:e=>Nm("LLL",{year:"numeric",month:"long",day:"numeric",hour:"numeric",minute:"2-digit"},e),lll:e=>Nm("lll",{year:"numeric",month:"short",day:"numeric",hour:"numeric",minute:"2-digit"},e),LLLL:e=>Nm("LLLL",{year:"numeric",month:"long",day:"numeric",hour:"numeric",minute:"2-digit",weekday:"long"},e),llll:e=>Nm("llll",{year:"numeric",month:"short",day:"numeric",hour:"numeric",minute:"2-digit",weekday:"short"},e)},Vm=`^(?:${Object.keys(Bm).sort((e,t)=>t.length-e.length).join("|")})`,Wm=()=>({}),Um={YYYY:e=>({year:parseInt(e)}),Y:e=>({year:parseInt(e)}),YY:e=>{const t=parseInt(e);return{year:t+(t>1968?1900:2e3)}},MM:e=>({month:parseInt(e)-1}),Mo:e=>({month:parseInt(e)-1}),DD:e=>({date:parseInt(e)}),M:e=>({month:parseInt(e)-1}),D:e=>({date:parseInt(e)}),Do:e=>({date:parseInt(e)}),DDD:Wm,MMM:Wm,MMMM:Wm,DDDo:Wm,DDDD:Wm,d:Wm,do:Wm,dd:Wm,ddd:Wm,dddd:Wm,Q:Wm,Qo:Wm,W:Wm,Wo:Wm,WW:Wm,e:Wm,E:Wm,HH:e=>({hours:parseInt(e)}),mm:e=>({minutes:parseInt(e)}),H:e=>({hours:parseInt(e)}),m:e=>({minutes:parseInt(e)}),ss:e=>({seconds:parseInt(e)}),s:e=>({seconds:parseInt(e)}),S:e=>({milliseconds:parseInt(e)}),SS:e=>({milliseconds:parseInt(e)}),SSS:e=>({milliseconds:parseInt(e)}),A:e=>({amPm:e.toLowerCase()}),a:e=>({amPm:e.toLowerCase()}),L:"MM/DD/YYYY",LT:"HH:mm A",Z:e=>{if(!e)return{};let t=0;if(!e.endsWith("Z")){const n=rp.exec(e);t=n?("+"===n[1]?1:-1)*(60*(parseInt(n[2])||0)+(parseInt(n[3])||0)):-1*(new Date).getTimezoneOffset()}return{timeZone:t}}},Gm=Object.keys(Um).sort((e,t)=>t.length-e.length),Ym=new RegExp(`(${Gm.join("|")})`),qm=new RegExp("(l|LL|ll|LLL|lll|LLLL|llll)"),Xm={year:{year:1,quarter:4,month:12,week:52,day:365,hour:8760,minute:525600,second:31536e3,millisecond:31536e6},quarter:{year:.25,quarter:1,month:3,week:4,day:91,hour:2184,minute:131040,second:7862400,millisecond:78624e5},month:{year:1/12,quarter:1/3,month:1,week:4,day:-30,hour:-720,minute:-43200,second:-2592e3,millisecond:-2592e6},week:{year:-1/52,quarter:-1/13,month:-.25,day:7,hour:168,minute:10080,second:604800,millisecond:6048e5},day:{year:-1/365,quarter:-1/91,month:-1/30,week:1/7,hour:24,minute:1440,second:86400,millisecond:864e5},hour:{year:-1/8760,quarter:-1/2184,month:-1/720,week:1/168,day:1/24,minute:60,second:3600,millisecond:36e5},minute:{year:-1/525600,quarter:-1/131040,month:-1/43200,week:1/10080,day:1/1440,hour:1/60,second:60,millisecond:6e4},second:{year:-1/31536e3,quarter:-1/7862400,month:-1/2592e3,week:1/604800,day:1/86400,hour:1/3600,minute:1/60,millisecond:1e3},millisecond:{year:-1/31536e6,quarter:-1/78624e5,month:-1/2592e6,week:1/6048e5,day:1/864e5,hour:1/36e5,minute:1/6e4,second:.001}},Km={ms:"millisecond",milliseconds:"millisecond",s:"second",seconds:"second",m:"minute",minutes:"minute",h:"hour",hours:"hour",d:"day",days:"day",w:"week",weeks:"week",M:"month",months:"month",q:"quarter",quarters:"quarter",y:"year",years:"year"},Zm=/^\s*([-+]?\d+(?:[.,]\d*)?|[-+]?(?:[.,]\d+))\s*([^\s]+)?/i,Jm=/^\s*([-+]?\d+)(?![.,])\s*([^\s]+)?/i,Qm=["millisecond","second","minute","hour","day","week","month","quarter","year"],ep=["year","month","week","day","hour","minute","second","millisecond"],tp=["milliseconds","seconds","minutes","hours","date","month","year"],np=e=>{const t=parseFloat(e);return isNaN(t)?null:t},rp=/([+-])(\d\d):*(\d\d)*$/,sp={millisecond:0,second:1,minute:2,hour:3,day:4,week:5,month:6,quarter:7,year:8},ip=function(){class e extends(Am()){static buildParser(t){const n=t.split(Ym),r=[];return 1===n.length||qm.test(t)?[]:(n.reduce((n,s,i,o)=>{if(0!==i||""!==s)if(Ym.test(s)){const a=("parsers"!==this.L("parsers")&&this.L("parsers")||{})[s]||Um[s];if("Z"===s&&i<o.length-2)throw new Error(`Invalid format ${t} TimeZone (Z) must be last token`);if("string"==typeof a){const t=e.buildParser(a),s=t.pop();delete s.last,r.push(...t),n=s}else n.pattern=s,n.fn=Um[s]}else n.splitter=s,r.push(n),n={};else n.hasOwnProperty("pattern")&&r.push(n);return n},{}),r[r.length-1].last=!0,r)}static parse(t,n=zm){if(!t)return null;if(t instanceof Date)return t;let r={year:0,month:0,date:0,hours:0,minutes:0,seconds:0,milliseconds:0},s=Hm[n];return s||(s=Hm[n]=e.buildParser(n)),s.reduce((e,t)=>{if(!t.last){let n,s,i;if(-1===(n="T"===t.splitter&&-1===e.indexOf("T")?e.indexOf(" "):e.indexOf(t.splitter))||""===t.splitter){let t=e.split(/([Z\-+])/);1===t.length?(s=e,i=""):(s=t[0],i=`${t[1]}${t[2]}`)}else s=e.substring(0,n)||e,i=e.substring(n+t.splitter.length);return t.fn&&Object.assign(r,t.fn(s)),i}Object.assign(r,t.fn(e))},t),this.create(r)||new Date(t)}static create(e){const t=Object.assign({},e);let n=!0,r=!1;if(tp.forEach(e=>{e in t&&!isNaN(t[e])||(t[e]=0),t[e]>0&&(n=!1)}),"pm"===t.amPm&&(t.hours=t.hours%12+12),"timeZone"in t&&(r=!0,t.minutes-=t.timeZone),n)return null;const s=[t.year,t.month,t.date,t.hours,t.minutes,t.seconds,t.milliseconds];return r?new Date(Date.UTC(...s)):new Date(...s)}static format(e,t=zm){if(!e)return null;let n=$m[t],r="";if(!n){n=$m[t]=[];for(let e=0;e<t.length;e++){const r=t.substr(e).match(Vm),s=r&&r[0];if(s){const t="formats"!==this.L("formats")&&this.L("formats")||{};n.push(t[s]||Bm[s]),e+=s.length-1}else if("{"===t[e]){const r=t.indexOf("}",e+1);-1===r?(n.push(t.substr(e+1)),e=t.length):(n.push(t.substring(e+1,r)),e=r)}else n.push(t[e])}}return n.forEach(t=>{r+="string"==typeof t?t:t(e)}),(Fm.isEdge||Fm.isIE11)&&(r=r.replace(/\u200E/g,"")),r}static asMilliseconds(e,t=null){return"string"==typeof e&&(t=e,e=1),this.as("millisecond",e,t)}static formatDelta(e,t=!1){const n=[],r=t?this.getShortNameOfUnit:this.getLocalizedNameOfUnit,s=t?"":" ";for(const i of ep){const t=Math.floor(this.as(i,e));if(t&&(n.push(`${t}${s}${r.call(this,i,t>1)}`),e-=this.as("ms",t,i)),!e)break}return n.join(", ")}static as(e,t,n="ms"){return e===n?t:(e=this.normalizeUnit(e),n=this.normalizeUnit(n),sp[n]>sp[e]?t*Math.abs(Xm[n][e]):t/Math.abs(Xm[e][n]))}formatContainsHourInfo(e){return e.match(/[Hhk]/)}static is24HourFormat(e){return this.format(new Date(1970,0,0,13,0,0),e).includes("13")}static add(t,n,r="ms"){const s=this;let i;if(i="string"==typeof t?s.parse(t):new Date(t.getTime()),!r||0===n)return i;switch(r=e.normalizeUnit(r)){case"millisecond":i=new Date(i.getTime()+n);break;case"second":i=new Date(i.getTime()+1e3*n);break;case"minute":i=new Date(i.getTime()+6e4*n);break;case"hour":i=new Date(i.getTime()+36e5*n);break;case"day":n%1==0?i.setDate(i.getDate()+n):i=new Date(i.getTime()+864e5*n),23===i.getHours()&&0===i.getHours()&&(i=s.add(i,1,"hour"));break;case"week":i.setDate(i.getDate()+7*n);break;case"month":let t=i.getDate();t>28&&(t=Math.min(t,s.getLastDateOfMonth(s.add(s.getFirstDateOfMonth(i),n,"month")).getDate())),i.setDate(t),i.setMonth(i.getMonth()+n);break;case"quarter":i=s.add(i,3*n,"month");break;case"year":i.setFullYear(i.getFullYear()+n)}return i}static diff(t,n,r="ms",s=!0){if(r=e.normalizeUnit(r),!t||!n)return 0;let i;switch(r){case"year":i=this.diff(t,n,"month")/12;break;case"quarter":i=this.diff(t,n,"month")/3;break;case"month":i=12*(n.getFullYear()-t.getFullYear())+(n.getMonth()-t.getMonth());break;case"week":i=this.diff(t,n,"day")/7;break;case"day":const e=t.getTimezoneOffset()-n.getTimezoneOffset();i=(n-t+60*e*1e3)/864e5;break;case"hour":i=(n-t)/36e5;break;case"minute":i=(n-t)/6e4;break;case"second":i=(n-t)/1e3;break;case"millisecond":i=n-t}return s?i:Math.round(i)}static startOf(e,t="day",n=!0){if(!e)return null;t=this.normalizeUnit(t),n&&(e=this.clone(e));const r={},s=Qm.indexOf(t);for(let i=0;i<s;i++){const e=Qm[i];"quarter"!==e&&"week"!==e&&(r[e]="day"===e?1:0)}if("quarter"===t)r.month=3*(this.get(e,"quarter")-1);else if("week"===t){const t=e.getDay()-this.weekStartDay;r.day=e.getDate()-t}return this.set(e,r)}static clone(e){return new Date(e.getTime())}static clearTime(t,n=!0){return e.startOf(t,"day",n)}static set(e,t,n){if(!t)return e;if("string"==typeof t)switch(this.normalizeUnit(t)){case"millisecond":(0!==n||e.getMilliseconds()>0)&&e.setMilliseconds(n);break;case"second":(0!==n||e.getSeconds()>0)&&e.setSeconds(n);break;case"minute":(0!==n||e.getMinutes()>0)&&e.setMinutes(n);break;case"hour":e.setHours(n);break;case"day":case"date":e.setDate(n);break;case"week":throw new Error("week not implemented");case"month":e.setMonth(n);break;case"quarter":e.setDate(1),e.setMonth(3*(n-1));break;case"year":e.setFullYear(n)}else Object.entries(t).sort((e,t)=>Qm.indexOf(e[0])-Qm.indexOf(t[0])).forEach(([t,n])=>{this.set(e,t,n)});return e}static constrain(e,t,n){return this.min(this.max(e,t),n)}static getTime(e,t=0,n=0){return new Date(1970,0,1,e,t,n)}static isDST(e){const t=new Date(e.getFullYear(),0,1),n=new Date(e.getFullYear(),6,1);return e.getTimezoneOffset()<Math.max(t.getTimezoneOffset(),n.getTimezoneOffset())}static isBefore(e,t){return e<t}static isAfter(e,t){return e>t}static isEqual(e,t,n=null){return null===n?e-t==0:this.startOf(e,n)-this.startOf(t,n)==0}static compare(e,t,n=null){return n&&(e=this.startOf(e,n),t=this.startOf(t,n)),this.isBefore(e,t)?-1:this.isAfter(e,t)?1:0}static isStartOf(e,t){return this.isEqual(e,this.startOf(e,t))}static betweenLesser(e,t,n){return t.getTime()<=e.getTime()&&e.getTime()<n.getTime()}static betweenLesserEqual(e,t,n){return t.getTime()<=e.getTime()&&e.getTime()<=n.getTime()}static intersectSpans(e,t,n,r){return this.betweenLesser(e,n,r)||this.betweenLesser(n,e,t)}static compareUnits(e,t){const n=Qm.indexOf(e),r=Qm.indexOf(t);return Math.sign(n-r)}static timeSpanContains(e,t,n,r){return n-e>=0&&t-r>=0}static get weekStartDay(){let e=this.L("weekStartDay");return"weekStartDay"!==e?e:0}static get(e,t){switch(this.normalizeUnit(t)){case"millisecond":return e.getMilliseconds();case"second":return e.getSeconds();case"minute":return e.getMinutes();case"hour":return e.getHours();case"date":case"day":return e.getDate();case"week":return Bm.W(e);case"month":return e.getMonth();case"quarter":return Math.floor(e.getMonth()/3)+1;case"year":return e.getFullYear()}return null}static daysInMonth(e){const t=this.clone(e);return t.setDate(1),t.setMonth(e.getMonth()+1),t.setDate(0),t.getDate()}static getFirstDateOfMonth(e){return new Date(e.getFullYear(),e.getMonth(),1)}static getLastDateOfMonth(e){return new Date(e.getFullYear(),e.getMonth()+1,0)}static min(e,t){return e.getTime()<t.getTime()?e:t}static max(e,t){return e.getTime()>t.getTime()?e:t}static getNext(e,t,n=1,r=this.weekStartDay){const s=this;if("week"===t){let t=s.clone(e),i=t.getDay();return t=s.startOf(t,"day"),(t=s.add(t,r-i+7*(n-(r<=i?0:1)),"day")).getDay()!==r&&s.add(t,1,"hour"),t}return s.startOf(s.add(e,n,t),t)}static getStartOfNextDay(t,n,r){let s=e.add(r?t:e.clearTime(t,n),1,"day");if(s.getDate()==t.getDate()){let r=e.add(e.clearTime(t,n),"day",2).getTimezoneOffset(),i=t.getTimezoneOffset();s=e.add(s,i-r,"minute")}return s}static getEndOfPreviousDay(t,n){let r=n?t:e.clearTime(t,!0);return r-t?r:this.add(r,-1,"day")}static formatCount(t,n){return n=e.normalizeUnit(n),1!==t&&(n+="s"),t+" "+n}static getUnitToBaseUnitRatio(t,n,r=!1){return(t=e.normalizeUnit(t))===(n=e.normalizeUnit(n))?1:Xm[t]&&Xm[t][n]&&(r||Xm[t][n]>0)?1/e.as(n,1,t):Xm[n]&&Xm[n][t]&&(r||Xm[n][t]>0)?e.as(t,1,n):-1}static getMeasuringUnit(e){return"week"===e?"day":e}static getShortNameOfUnit(e){return e=this.parseTimeUnit(e),this.unitLookup[e].abbrev}static getLocalizedNameOfUnit(e,t){return e=this.normalizeUnit(e),e=this.parseTimeUnit(e),this.unitLookup[e][t?"plural":"single"]}static normalizeUnit(e){return e?"date"===e.toLowerCase()?e.toLowerCase():Qm.includes(e.toLowerCase())?e.toLowerCase():Km[e]||Km[e.toLowerCase()]:null}static getUnitByName(t){return e.normalizeUnit(t)||e.normalizeUnit(this.parseTimeUnit(t))}static getDurationInUnit(e,t,n,r){return this.diff(e,t,n,r)}static doesUnitsAlign(e,t){return e===t||"week"!==t}static getSmallerUnit(e){return Qm[sp[this.normalizeUnit(e)]-1]||null}static getLargerUnit(e){return Qm[sp[this.normalizeUnit(e)]+1]||null}static parseDuration(e,t=!0,n){const r=(t?Zm:Jm).exec(e);if(null==e||!r)return null;const s=np(r[1]),i=this.parseTimeUnit(r[2])||n;return i?{magnitude:s,unit:i}:null}static parseTimeUnit(e){const t=null==e?null:this.durationRegEx.exec(e.toLowerCase());if(!t)return null;for(let n=0;n<Qm.length;n++)if(t[n+1])return Qm[n]}static set locale(e){_m=e}static get locale(){return _m}static applyLocale(){const e=this,t=e.L("unitAbbreviations"),n=e.unitNames=e.L("unitNames");if("unitNames"===n)return;"en-US"===(_m=e.L("locale")||"en-US")?Pm=Om:"ordinalSuffix"!==e.L("ordinalSuffix")&&(Pm=e.L("ordinalSuffix")),$m={},Hm={},jm={};let r="";e.unitLookup={};for(let s=0;s<t.length;s++){const i=t[s],o=n[s];o.canonicalUnitName=Qm[s],e.unitLookup[o.single]=e.unitLookup[o.single.toUpperCase()]=e.unitLookup[o.canonicalUnitName]=e.unitLookup[o.canonicalUnitName.toUpperCase()]=o,r+=`${s?"|":""}(`;for(let e=0;e<i.length;e++)r+=`${i[e]}|`;r+=`${o.single}|${o.plural}|${o.canonicalUnitName})`}e.durationRegEx=new RegExp(`^(?:${r})$`)}}return e._$name="DateHelper",e._$name="DateHelper",e}();Im.on({locale:"applyLocale",thisObj:ip}),Im.locale&&ip.applyLocale();const op=function(){class e{constructor(){this.random100=[46,2,36,46,54,59,18,20,71,55,88,98,13,61,61,40,2,15,3,32,51,45,64,25,81,85,54,13,57,49,64,22,81,94,0,62,17,7,11,2,33,99,85,26,83,83,96,26,20,89,91,38,26,13,11,79,32,30,5,51,70,7,5,56,58,77,37,89,40,80,78,59,26,36,8,51,60,23,86,5,11,96,64,94,87,64,4,78,17,85,35,0,90,86,23,55,53,9,35,59,29,2,64,42,8,49,43,73,6,53,38,9,39,31,32,40,49,13,78,68,20,99,24,78,35,91,73,46,67,76,89,69,30,69,25,3,4,55,1,65,66,76,83,19,67,1,95,24,54,45,56,40,67,92,72,4,69,8,47,50,27,2,38,9,14,83,12,14,62,95,22,47,35,18,38,14,86,64,68,61,52,69,39,93,20,73,32,52,74,6,56,68,99,29,24,92,40,67,6,72,31,41,91,53,80,55,33,97,97,99,18,20,5,27,82,84,61,78,27,67,7,42,75,95,91,25,63,21,70,36,46,0,1,45,84,6,86,15,10,62,96,94,10,23,93,83,94,47,5,29,29,52,51,37,77,96,43,72,43,14,54,14,72,52,4,39,15,26,68,28,25,76,60,50,22,40,72,74,68,58,8,48,40,62,52,24,9,26,47,44,49,96,7,77,90,45,76,47,5,86,1,36,18,42,19,90,34,23,70,32,69,79,0,99,57,80,72,21,19,72,85,68,4,40,86,62,0,63,4,11,69,31,78,31,21,78,29,84,13,53,57,10,26,50,24,30,90,42,51,96,93,21,99,23,81,0,89,43,86,63,93,19,54,71,92,36,4,95,37,99,60,29,23,50,68,95,57,95,77,53,99,78,75,12,92,47,23,14,0,41,98,11,34,64,26,90,50,23,38,31,74,76,16,76,66,23,22,72,48,50,20,36,37,58,5,43,49,64,81,30,8,21,98,75,60,17,50,42,27,38,90,74,45,68,67,27,31,15,58,76,41,99,23,98,53,98,56,19,79,2,4,38,96,24,65,51,43,42,41,60,46,7,90,65,3,27,63,99,51,44,86,1,54,40,15,74,3,81,51,63,87,79,84,72,22,38,96,95,33,41,21,99,21,69,7,49,40,52,41,6,91,19,76,40,54,17,33,11,11,0,1,32,94,33,13,18,45,7,85,61,42,54,45,72,78,96,17,9,80,87,41,96,66,0,8,59,18,21,2,28,64,75,97,32,80,86,97,97,55,2,73,75,11,89,67,58,70,76,12,46,64,17,22,97,25,35,93,57,82,46,57,61,31,74,27,4,32,85,53,86,53,53,42,5,28,50,65,63,70,61,73,37,13,80,7,34,22,3,26,6,62,78,12,56,87,41,58,64,31,27,45,35,18,66,62,43,89,69,94,93,33,74,2,43,85,37,82,41,74,9,15,44,33,42,65,19,1,49,78,12,29,9,78,7,55,12,45,40,33,16,86,14,52,16,73,76,0,98,75,91,78,46,99,95,90,69,78,45,62,55,37,88,49,77,27,83,38,73,39,1,75,40,65,83,54,95,7,73,4,30,26,36,89,21,5,95,11,14,87,45,36,21,77,55,5,66,51,98,48,62,74,58,23,82,30,28,19,53,89,76,98,8,34,70,28,54,16,52,35,93,54,54,72,49,18,93,72,90,71,73,15,60,38,80,76,53,70,39,69,25,5,31,61,46,6,54,34,31,52,33,36,79,76,44,29,28,38,1,66,2,90,91,1,76,78,31,55,37,71,2,3,38,85,0,95,42,2,39,57,87,61,77,98,2,24,80,48,27,47,71,15,7,49,60,86,3,2,29,38,54,36,59,83,27,47,9,36,42,8,73,85,9,16,73,60,39,12,43,25,23,29,28,47,40,77,20,89,22,30,41,59,96,19,56,20,76,73,39,46,72,40,47,37,52,29,79,37,39,50,41,87,66,17,75,31,45,26,88,70,11,90,40,74,9,32,65,72,61,6,93,54,15,84,22,99,47,10,96,4,84,19,85,73,45,25,16,8,94,99,39,28,26,68,87,48,1,65,86,46,86,7,60,82,45,75,38,56,41,35,30,86,91,97,85,45,5,14,69,85,96,37,18,26,16,38,16,1,44,94,85,58,60,20,5,47,52,41,50,71,43,42,67,64,38,65,83,99,78,96,33,20,98,24,6,2,25,16,16,44,63,24,68,56,49,91,15,59,99,27,43,34,28,36,45,1,10,19,54,26,75,17,88,96,63,24,71,93,72,97,66,87,18,86],this.randomCache={},this.rndIndex=0}nextRandom(e){let t,n=this.randomCache;return n[e]?t=n[e]:(t=this.random100.filter(t=>t<e),n[e]=t),t[this.rndIndex++%t.length]}reset(){this.rndIndex=0}fromArray(e){return e[this.nextRandom(e.length)]}}return e._$name="RandomGenerator",e}(),ap=new Date;new Date(ap.getFullYear(),0,1),new op;const lp=function(){class e extends cc{static get type(){return"timeline"}construct(e){const t=this;if(t.startDateLabel=document.createElement("label"),t.startDateLabel.className="b-timeline-startdate",t.endDateLabel=document.createElement("label"),t.endDateLabel.className="b-timeline-enddate",super.construct(e),!t.project)throw new Error("You need to configure the Timeline with a Project");t.project instanceof Lg||(t.project=new Lg(t.project)),t.taskStore=t.project.taskStore,t.features.timeRanges.store=new Nr,t.fillFromTaskStore(),t.fillFromTaskStore=t.buffer(t.fillFromTaskStore,100),t.taskStore.on({refresh:t.fillFromTaskStore,change:t.onTaskStoreChange,thisObj:t}),t.on({resize:t.onSizeChanged,thisObj:t}),t.bodyContainer.appendChild(t.startDateLabel),t.bodyContainer.appendChild(t.endDateLabel),he.on({locale:"onLocaleChange",thisObj:t})}static get defaultConfig(){return{height:"13em",eventLayout:"pack",barMargin:1,readOnly:!0,forceFit:!0,zoomOnMouseWheel:!1,zoomOnTimeAxisDoubleClick:!1,eventColor:null,eventStyle:null,rowHeight:48,features:{columnLines:!1,eventContextMenu:!1,contextMenu:!1,scheduleContextMenu:!1,timeRanges:{showCurrentTimeLine:!0}},resources:[{id:1}],columns:[]}}onSizeChanged({width:e,oldWidth:t}){this.suspendRefresh(),this.updateRowHeight(),this.resumeRefresh(),e!==t&&this.fitTimeline()}updateRowHeight(){this.rowHeight=this.bodyContainer.offsetHeight}fitTimeline(){this.eventStore.count>0&&this.zoomToFit({leftMargin:50,rightMargin:50}),this.updateStartEndLabels()}updateStartEndLabels(){const e=this;e.startDateLabel.innerHTML=e.getFormattedDate(e.startDate),e.endDateLabel.innerHTML=e.getFormattedDate(e.endDate)}async onTaskStoreChange(e){const t=this,n=t.eventStore;let r;switch(e.action){case"add":e.records.forEach(e=>{e.showInTimeline&&(n.add(t.cloneTask(e)),r=!0)});break;case"remove":e.records.forEach(e=>{e.showInTimeline&&(n.remove(e.id),r=!0)});break;case"removeall":t.fillFromTaskStore();break;case"update":const s=e.record;if(e.changes.showInTimeline)s.showInTimeline?n.add(t.cloneTask(s)):n.remove(n.getById(s.id)),r=!0;else if(s.showInTimeline){const e=n.getById(s.id);if(e){const t=Object.assign({},s.data);delete t.expanded,e.set(t),r=!0}}}r&&t.fitTimeline()}cloneTask(e){return{id:e.id,resourceId:1,startDate:e.startDate,endDate:e.endDate,duration:e.duration,durationUnit:e.durationUnit,name:e.name}}render(){super.render(),this.updateRowHeight()}fillFromTaskStore(){const e=this,t=[];e.taskStore.traverse(n=>{n.showInTimeline&&n.isScheduled&&t.push(e.cloneTask(n))}),e.suspendRefresh(),e.events=t,e.resumeRefresh(),e.fitTimeline()}onLocaleChange(){this.updateStartEndLabels()}}return e._$name="Timeline",e}();E.register(lp.type,lp);const cp=function(){class e extends(window.customElements?HTMLElement:Object){constructor(){super();const e=this,t=[],n={};let r;for(let l of e.children)if("COLUMN"===l.tagName){const e=parseInt(l.dataset.width),n=parseInt(l.dataset.flex),r={field:l.dataset.field,text:l.innerHTML,type:l.dataset.type};e?r.width=e:r.flex=n||1,t.push(r)}else if("PROJECT"===l.tagName)r=new Lg({transport:{load:{url:l.dataset.loadUrl}}});else if("FEATURE"===l.tagName){const e=l.dataset.name,t=Object.assign({},l.dataset);delete t.name,n[e]=Object.keys(t).length?t:"false"!==l.textContent}const s=Object.assign({},e.dataset),i=s.theme||"stockholm",o=this.attachShadow({mode:"open"}),a=document.createElement("link");delete s.theme,a.rel="stylesheet",a.href=`../../build/gantt.${i}.css`,a.onload=(()=>{const e=document.createElement("div");e.id="container",e.style.width="100%",e.style.height="100%",o.appendChild(e),En(o),Object.assign(s,{appendTo:e,columns:t,features:n,project:r});const i=new om(s);r instanceof Lg&&r.load(),window.gantt||(window.gantt=i)}),o.appendChild(a)}}return e._$name="GanttTag",e}();try{window.customElements&&window.customElements.define("bryntum-gantt",cp)}catch(up){}window.bryntum||(window.bryntum={})},bOAy:function(e,t,n){"use strict";n.d(t,"a",function(){return b});var r=n("mrSG"),s=n("UMly"),i=n("wd/R"),o=n("K9Ia"),a=n("VNr4"),l=n("ad02"),c=n("ny24"),d=(n("6/4J"),n("7R3d"),n("nOye")),u=n("5RMJ"),h=n("qYLG"),g=(n("nhdH"),n("cxgq"),n("QLLi"),n("UOq0"),n("60Vt"),n("Vut0")),m=n("tZza"),p=n("8jAZ"),f=(n("+Gaf"),n("D7aD"),function(){return(f=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var s in t=arguments[n])Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s]);return e}).apply(this,arguments)}),v=function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,s,i=n.call(e),o=[];try{for(;(void 0===t||t-- >0)&&!(r=i.next()).done;)o.push(r.value)}catch(a){s={error:a}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(s)throw s.error}}return o},y=function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(v(arguments[t]));return e},b=function(e){function t(t,n,r,s,i,a,l,c,d){var u=e.call(this,h.a.Write,t,n,r,s,i)||this;return u.workOrdersCalendarFormService=a,u.ganttService=l,u.wpFormService=c,u.translateService=d,u.TIME_RESOLUTION_MAX_ZOOM=15,u.TIME_RESOLUTION_MIN_ZOOM=5,u.ganttTimeResolutionChanged=new o.a,u.onBeforeLoadOnce(),u.wpFormService.getBidmWorkOrdersStructureByProject("").subscribe(),u}return Object(r.__extends)(t,e),t.prototype.getComponentName=function(){return d.a.MAI_WORK_ORDERS_CALENDAR_FORM},t.prototype.onBeforeLoadOnce=function(){this.setGanttColumnList()},t.prototype.ngOnInit=function(){e.prototype.ngOnInit.call(this),this.componentData&&this.componentData.objectId&&(this.workPackage=this.serializationService.deserialize(this.componentData.objectId),this.workPackage&&this.workPackage.projectId&&(this.workPackageId=this.workPackage.projectId)),this.init()},t.prototype.init=function(){this.ganttLoading=!1,this.eventList=[],this.listAnteriorOrPosterior=[],this.dependencies=[],this.numberEvent=0,this.workOrderDataList=[],this.woMap=new Map,this.durationMap=new Map,this.ganttZoomLevel=this.TIME_RESOLUTION_MIN_ZOOM,this.showEditWorkOrder=!1,this.workOrderList=[],this.intiProject()},t.prototype.initGanttEngine=function(){this.gantt.ganttEngine.localeManager.locale=this.translateService.currentLang===u.a.FRENCH_CODE?"Fr":"En",this.registerGanttListeners(),this.registerGanttTimeResolutionObservable(),this.registerGanttUpdate(),this.registerGanttBeforeTaskDropFinalize(),this.registerGanttTaskAfterDrop(),this.registerGanttBeforeTaskResizeFinalize(),this.registerGanttAfterTaskResize(),this.registerGanttBeforeEdit(),this.setGanttTimeSpan(),this.setGanttEnginedefaultProperties()},t.prototype.setGanttTimeSpan=function(){m.a.isDefined(this.startDate)&&m.a.isDefined(this.endDate)&&this.gantt.ganttEngine.setTimeSpan(this.startDate,this.endDate)},t.prototype.setGanttEnginedefaultProperties=function(){this.gantt.ganttEngine.getSubGrid("locked").width=t.COLUMN_DESCRITPION_WIDTH-1,this.gantt.ganttEngine.features.rowReorder.disabled=!0,this.gantt.ganttEngine.expandAll()},t.prototype.intiProject=function(){var e=this;this.ganttLoading=!0,this.workPackageId&&this.workOrdersCalendarFormService.getBidmWorkOrdersByProject(this.workPackageId).subscribe(function(t){e.getWorkOrderDataList(t),e.fillDurationMap(e.workOrderDataList,t)})},t.prototype.fillDurationMap=function(e,t){var n=this,r=[];e.forEach(function(e){r.push(n.workOrdersCalendarFormService.getOpreationDurationTotalWorkOrder(e.bidmWorkOrder))}),Object(a.a)(r).subscribe(function(e){e.forEach(function(e){e.duration>0&&n.durationMap.set(e.workOrder.woCode,e.duration)}),n.buildWorkOrderMap(t),n.buildProjectModel(t),n.buildGanttConfig(),n.updateGanttView(),setTimeout(function(){n.gantt.ganttEngine.zoomToFit(),n.ganttZoomLevel=n.gantt.ganttEngine.zoomLevel>n.TIME_RESOLUTION_MAX_ZOOM?n.TIME_RESOLUTION_MAX_ZOOM:n.gantt.ganttEngine.zoomLevel<n.TIME_RESOLUTION_MIN_ZOOM?n.TIME_RESOLUTION_MIN_ZOOM:n.gantt.ganttEngine.zoomLevel,n.ganttLoading=!1})})},t.prototype.getWorkOrderDataList=function(e){var t=this;e.forEach(function(e){t.workOrderDataList.push(e),e.bidmWorkOrderDataList&&e.bidmWorkOrderDataList.length>0&&t.getWorkOrderDataList(e.bidmWorkOrderDataList)})},t.prototype.buildGanttConfig=function(){var e=this;this.ganttConfig={columns:this.columnList,project:this.project,labels:{left:{field:"name",editor:{type:"textfield"}}},projectLines:{enableResizing:!0},taskContextMenu:{items:{add:!1,deleteTask:!1},processItems:function(t){e.setTaskContextMenu(t.eventRecord,t.items)}}},setTimeout(function(){e.initGanttEngine()})},t.prototype.setTaskContextMenu=function(e,t){this.setEditContextMenu(e,t)},t.prototype.setEditContextMenu=function(e,t){var n=this;t.editTask.text=this.translateService.instant(this.getTranslateKey("editWorkOrder")),t.editTask.onItem=function(e){n.selectedEventModel=e.taskRecord,n.selectedWorkOrder=e.taskRecord.workOrder,n.showEditWorkOrder=!0}},t.prototype.onAddWorkOrder=function(e){this.gantt.ganttEngine.refreshWithTransition()},t.prototype.buildWorkOrderMap=function(e){var t=this,n=0,r=function(e){e.forEach(function(e){t.workOrderList.push({code:e.bidmWorkOrder.woCode,woId:e.bidmWorkOrder.woId}),t.woMap.set(n.toString(),e.bidmWorkOrder),n++,e.bidmWorkOrderDataList&&r(e.bidmWorkOrderDataList)})};r(e)},t.prototype.buildProjectModel=function(e){if(this.workPackage.projectStartDate){var t={eventsData:this.createEventList(e),dependenciesData:this.dependencies};this.project=new s.c(t)}},t.prototype.createEventList=function(e){var t=this,n=e.map(function(e){return t.createEvent(e)}),r=this.createAnteriorOrPosterior(n);return r.sort(function(e,t){return e.id-t.id}),r},t.prototype.createAnteriorOrPosterior=function(e){var t=this,n=y(e);return this.listAnteriorOrPosterior.forEach(function(r){var s=f({},e.find(function(e){return e.code===r.parentCode}));switch(r.data.woLinkType){case"1":t.addAnterior(n,s),n.push(t.createAnterior(r.data,Number(s.id),s)),t.addDependence(s.id,s.id+1);break;case"2":t.addPosterior(n,s),n.push(t.createPosterior(r.data,Number(s.id)+1,s)),t.addDependence(s.id,s.id+1)}}),n},t.prototype.addDependence=function(e,t){this.dependencies.push({fromEvent:e,toEvent:t})},t.prototype.addAnterior=function(e,t){e.forEach(function(e){e.id>=t.id&&(e.id=e.id+1,e.children&&e.children.forEach(function(e){e.id>=t.id&&(e.id=e.id+1)}))})},t.prototype.addPosterior=function(e,t){e.forEach(function(e){e.id>t.id&&(e.id=e.id+1,e.children&&e.children.forEach(function(e){e.id>t.id&&(e.id=e.id+1)}))})},t.prototype.createAnterior=function(e,t,n){this.numberEvent++;var r={id:t||this.numberEvent,name:e.bidmWorkOrder.woCode,code:e.bidmWorkOrder.woCode,draggable:!!e.bidmWorkOrderDataList&&this.isDraggable(e.bidmWorkOrderDataList),description:e.bidmWorkOrder.woDescription,workOrder:e.bidmWorkOrder,startDate:e.bidmWorkOrder.woScheduledStartDate?e.bidmWorkOrder.woScheduledStartDate:i(n?n.startDate:i().toDate()).subtract(this.durationMap.get(e.bidmWorkOrder.woCode),"h").toDate(),endDate:e.bidmWorkOrder.woScheduledEndDate?e.bidmWorkOrder.woScheduledEndDate:i(n?n.endDate:i().toDate()).add(this.durationMap.get(e.bidmWorkOrder.woCode),"h").toDate(),children:e.bidmWorkOrderDataList?this.checkIfChildren(e.bidmWorkOrderDataList,e):void 0};return this.eventList.push(r),r},t.prototype.createPosterior=function(e,t,n){this.numberEvent++;var r={id:t||this.numberEvent,name:e.bidmWorkOrder.woCode,code:e.bidmWorkOrder.woCode,draggable:!!e.bidmWorkOrderDataList&&this.isDraggable(e.bidmWorkOrderDataList),description:e.bidmWorkOrder.woDescription,workOrder:e.bidmWorkOrder,startDate:e.bidmWorkOrder.woScheduledStartDate?e.bidmWorkOrder.woScheduledStartDate:n?n.endDate:i().toDate(),endDate:e.bidmWorkOrder.woScheduledEndDate?e.bidmWorkOrder.woScheduledEndDate:i(n?n.endDate:i().toDate()).add(this.durationMap.get(e.bidmWorkOrder.woCode),"h").toDate(),children:e.bidmWorkOrderDataList?this.checkIfChildren(e.bidmWorkOrderDataList,e):void 0};return this.eventList.push(r),r},t.prototype.createEvent=function(e,t,n){this.numberEvent++;var r={id:t||this.numberEvent,name:e.bidmWorkOrder.woCode,code:e.bidmWorkOrder.woCode,draggable:!!e.bidmWorkOrderDataList&&this.isDraggable(e.bidmWorkOrderDataList),description:e.bidmWorkOrder.woDescription,workOrder:e.bidmWorkOrder,startDate:e.bidmWorkOrder.woScheduledStartDate?e.bidmWorkOrder.woScheduledStartDate:n?n.bidmWorkOrder.woScheduledStartDate:i().toDate(),endDate:e.bidmWorkOrder.woScheduledEndDate?e.bidmWorkOrder.woScheduledEndDate:this.durationMap.get(e.bidmWorkOrder.woCode)?i(e.bidmWorkOrder.woScheduledStartDate).add(this.durationMap.get(e.bidmWorkOrder.woCode),"h").toDate():i().toDate(),children:e.bidmWorkOrderDataList?this.checkIfChildren(e.bidmWorkOrderDataList,e):void 0};return this.eventList.push(r),r},t.prototype.isDraggable=function(e){return!(e.filter(function(e){return p.a.isNullOrEmpty(e.woLinkType)}).length>0)},t.prototype.checkIfChildren=function(e,t){var n=this,r=e.filter(function(e){return p.a.isNullOrEmpty(e.woLinkType)}),s=e.filter(function(e){return!p.a.isNullOrEmpty(e.woLinkType)&&n.isWoLinkTypeIsImportant(e.woLinkType)}).map(function(e){return{parentCode:t.bidmWorkOrder.woCode,data:e}});return this.listAnteriorOrPosterior=y(this.listAnteriorOrPosterior,s),r.map(function(e){return n.createEvent(e)})},t.prototype.isWoLinkTypeIsImportant=function(e){return!p.a.isNullOrEmpty(e)&&("1"===e||"2"===e)},t.prototype.setGanttColumnList=function(){var e=this;this.columnList=[{enableCellContextMenu:!1,htmlEncode:!1,locked:!0,editor:!1,text:this.translateService.instant("code"),draggable:!1,type:"name",width:t.COLUMN_CODE_WIDTH,renderer:function(n){var r,s=n.record;return e.woMap.forEach(function(e,t){e.woCode===s.data.name&&(r=t)}),'\n            <div class="work-order">\n              <div>\n                <a\n                  id="'+r+'"\n                  class="'+t.WOCODE_NAME_CLS+'"\n                  style="cursor: pointer; font-style: italic; font-weight: 600;"\n                >\n                  '+s.data.name+"\n                </a>\n              </div>\n            </div>\n            "}},{enableCellContextMenu:!1,editor:!1,draggable:!1,field:"description",text:this.translateService.instant(this.getTranslateKey("description")),width:t.COLUMN_DESCRITPION_WIDTH}]},t.prototype.openWorkOrderLink=function(e){e&&e.woId&&e.projectId&&this.openWorkOrder({woId:e.woId,projectId:e.projectId},h.a.Read)},t.prototype.openWorkOrder=function(e,t){var n={id:this.tabService.generateId(),componentId:d.a.MAI_WORK_ORDER_FORM,openMode:t,objectId:this.serializationService.serialize(e)};this.tabService.open(this.tabService.create(n,"transaction."+n.componentId,!0))},t.prototype.registerGanttListeners=function(){var e=this;s.a.addListener(this.gantt.ganttEngine.element,{element:this.gantt.ganttEngine.element,click:function(n){var r=n.target;r.classList.contains(t.WOCODE_NAME_CLS)&&m.a.isDefined(e.woMap.get(r.id))&&e.openWorkOrderLink(e.woMap.get(r.id))}})},t.prototype.registerGanttTimeResolutionObservable=function(){var e=this;this.ganttTimeResolutionChanged.pipe(Object(l.a)(),Object(c.a)(this.unsubscribe)).subscribe({next:function(t){e.gantt.ganttEngine.zoomTo(t)}})},t.prototype.registerGanttUpdate=function(){this.gantt.ganttEngine.project.taskStore.on("update",function(e){})},t.prototype.registerGanttBeforeEdit=function(){this.gantt.ganttEngine.on("beforeTaskEdit",function(e){return!1})},t.prototype.registerGanttBeforeTaskResizeFinalize=function(){this.gantt.ganttEngine.on("beforeTaskResizeFinalize",function(e){var t=e.context;t.async=!0,t.finalize(!0)})},t.prototype.registerGanttAfterTaskResize=function(){var e=this;this.gantt.ganttEngine.on("taskResizeEnd",function(t){e.workOrderListToUpdate=[],e.saveTaskWorkOrder(t.source.data),e.workOrdersCalendarFormService.updateBidmWorkOrders(e.workOrderListToUpdate).subscribe()})},t.prototype.registerGanttTaskAfterDrop=function(){var e=this;this.gantt.ganttEngine.on("afterTaskDrop",function(t){e.workOrderListToUpdate=[],t.valid&&(e.saveTaskWorkOrder(t.source.data),e.workOrdersCalendarFormService.updateBidmWorkOrders(e.workOrderListToUpdate).subscribe())})},t.prototype.registerGanttBeforeTaskDropFinalize=function(){var e=this;this.gantt.ganttEngine.on("beforeTaskDropFinalize",function(t){var n=t.context;n.async=!0;var r=!0,s=n.startDate;n.record.predecessorTasks.forEach(function(t){t.workOrder.woScheduledEndDate&&t.workOrder.woScheduledEndDate>s&&(e.messageService.showWarningMessage(e.getTranslateKey("warningOnInvalidOperation")),r=!1)}),n.finalize(r)})},t.prototype.saveTaskWorkOrder=function(e){var t=this;e.forEach(function(e){e.workOrder.woScheduledStartDate=i(e.startDate).toDate(),e.workOrder.woScheduledEndDate=i(e.endDate).toDate(),t.workOrderListToUpdate.push(e.workOrder),e.children&&e.children.length>0&&t.saveTaskWorkOrder(e.children)})},t.prototype.onChangeTimeResolution=function(e){this.ganttTimeResolutionChanged.next(e.value)},t.prototype.showToday=function(){this.gantt.ganttEngine.zoomTo({centerDate:new Date,preset:this.gantt.ganttEngine.viewPreset})},t.prototype.updateGanttView=function(){this.getGanttStartDate(),this.getGanttEndDate()},t.prototype.getGanttEndDate=function(){this.endDate=this.ganttService.getLastEventEndDate(this.eventList)},t.prototype.getGanttStartDate=function(){this.startDate=this.ganttService.getFirstEventStartDate(this.eventList)},t.WOCODE_NAME_CLS="wocode",t.COLUMN_CODE_WIDTH=200,t.COLUMN_DESCRITPION_WIDTH=300,t}(g.a)}}]);