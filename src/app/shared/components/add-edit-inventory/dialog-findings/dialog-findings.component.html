<a-modal class="aw-modal" [(visible)]="display" [width]="35">
  <a-header>
    <div class="modal-title">{{ getComponentName() + ".title" | translate }}</div>
  </a-header>

  <a-content>
    <div class="column">
      <div class="row">
        <div class="form-group">
          <label class="form-label">
            {{ getComponentName() + ".damage" | translate }}
          </label>

          <div class="form-control">
            <p-dropdown
              class="aw-dropdown fixed-width"
              placeholder="&nbsp;"
              [options]="damagesList"
              [showClear]="true"
              [(ngModel)]="finding.damageCode"
              (onChange)="onChangeDamage()"
              [disabled]="isReadOpenMode"
            ></p-dropdown>
          </div>
        </div>
        <div class="form-group">
          <label class="form-label">
            {{ getComponentName() + ".quantity" | translate }}
          </label>

          <div class="form-control">
            <input type="number" class="aw-input" [(ngModel)]="finding.quantity" [disabled]="isReadOpenMode" />
          </div>
        </div>
      </div>
      <div class="row">
        <div class="form-group">
          <label class="form-label">
            {{ getComponentName() + ".localisation" | translate }}
          </label>

          <div class="form-control">
            <p-dropdown
              class="aw-dropdown fixed-width"
              placeholder="&nbsp;"
              [options]="locationList"
              [showClear]="true"
              [(ngModel)]="finding.localisationCode"
              [disabled]="isReadOpenMode"
            ></p-dropdown>
          </div>
        </div>
      </div>
      <div class="row">
        <div class="form-group">
          <label class="form-label">
            {{ getComponentName() + ".criticality" | translate }}
          </label>

          <div class="form-control">
            <p-dropdown
              class="aw-dropdown fixed-width"
              placeholder="&nbsp;"
              [showClear]="true"
              [options]="criticalityList"
              [(ngModel)]="finding.criticality"
              [disabled]="isReadOpenMode"
            ></p-dropdown>
          </div>
        </div>
      </div>

      <div class="row">
        <div class="form-group">
          <label class="form-label">
            {{ getComponentName() + ".comment" | translate }}
          </label>

          <div class="form-control">
            <textarea
              class="aw-textarea"
              [rows]="3"
              pInputTextarea
              [disabled]="isReadOpenMode"
              [(ngModel)]="finding.findingComment"
            ></textarea>
          </div>
        </div>
      </div>

      <div class="row">
        <div class="section search-criteria-section">
          <h4 class="section-title">
            {{ getComponentName() + ".document" | translate }} ({{
              documentTableDataSource ? documentTableDataSource.dataCount : 0
            }})
          </h4>

          <div class="section-content">
            <a-table [dataSource]="documentTableDataSource">
              <ng-template tableActionsDef>
                <button
                  *ngIf="documentTableDataSource.hasDataSelection"
                  type="button"
                  mat-raised-button
                  (click)="downloadFiles()"
                >
                  {{ "global.download" | translate }}
                </button>

                <button
                  *ngIf="!isReadOpenMode && documentTableDataSource.hasDataSelection"
                  type="button"
                  mat-raised-button
                  color="warn"
                  (click)="deleteDocuments()"
                  [disabled]="isReadOpenMode"
                >
                  {{ "global.delete" | translate }}
                </button>

                <button
                  *ngIf="!isReadOpenMode && documentTableDataSource.dataSelectionCount === 1"
                  type="button"
                  mat-raised-button
                  (click)="editDocument()"
                  [disabled]="isReadOpenMode"
                >
                  {{ "global.edit" | translate }}
                </button>

                <button
                  *ngIf="documentTableDataSource.dataSelectionCount === 1"
                  type="button"
                  mat-raised-button
                  (click)="openDocument()"
                  [disabled]="isReadOpenMode"
                >
                  {{ "global.open" | translate }}
                </button>

                <p-fileUpload
                  #fileUploader
                  *ngIf="!isReadOpenMode && !documentTableDataSource.hasDataSelection"
                  chooseLabel="{{ 'global.upload' | translate }}"
                  name="document[]"
                  customUpload="true"
                  mode="basic"
                  auto="true"
                  (uploadHandler)="uploadDocument($event, fileUploader)"
                ></p-fileUpload>
              </ng-template>
            </a-table>
          </div>
        </div>
      </div>
    </div>
  </a-content>

  <a-footer>
    <button type="button" mat-raised-button (click)="closeDialog()">{{ "global.cancel" | translate }}</button>

    <button type="button" color="primary" mat-raised-button (click)="validate()">
      {{ "global.validate" | translate }}
    </button>
  </a-footer>
</a-modal>

<aw-dialog-cockpit-bido-document
  *ngIf="showDocumentDialog"
  [(display)]="showDocumentDialog"
  [document]="currentDocument"
  [openMode]="documentDialogOpenMode"
  [types]="documentTypes"
  (onValidated)="onAddDocument($event)"
>
</aw-dialog-cockpit-bido-document>
