<div class="page-header">
  <div class="page-info">
    <div>
      <div class="page-title">
        <span *ngIf="!!pageComponentData.title">
          {{ getComponentName() + ".inventoryTitle" | translate }} {{ pageComponentData.title }}
        </span>
      </div>

      <div class="page-subtitle">
        <div class="page-subtitle">
          <span *ngIf="!!pageComponentData.subtittle"> - {{ pageComponentData.subtittle }} </span>
        </div>
      </div>
    </div>
  </div>

  <div class="page-primary-actions">
    <button
      id="favorites"
      *ngIf="(!isAddInventory || !addNewInventory) && selectedInventoryList.length > 0"
      mat-raised-button
      color="warn"
      (click)="deleteInventories()"
    >
      {{ getComponentName() + ".deleteInventory" | translate }}
    </button>
    <button color="primary" type="button" mat-raised-button (click)="saveInventory()">
      {{ "global.save" | translate }}
    </button>
    <button
      id="actions"
      mat-icon-button
      class="mat-elevation-z1"
      matTooltip="{{ 'global.showAllActionTooltip' | translate }}"
      matTooltipPosition="above"
      aria-label="Show all actions"
      [matMenuTriggerFor]="actions"
    >
      <mat-icon>more_horiz</mat-icon>
    </button>

    <mat-menu #actions="matMenu">
      <button id="favorites" mat-menu-item (click)="updateFavoriteState()">
        {{ (isFavoriteEntry ? "page.removeFromFavorites" : "page.addToFavorites") | translate }}
      </button>
    </mat-menu>
  </div>
</div>

<div class="page-wrapper">
  <div class="page-container">
    <div class="page-content">
      <div class="grid-row" *ngIf="!isAddInventory">
        <div class="grid-cell--12">
          <div class="grid-cell grid-cell--container grid-cell-scope">
            <div class="grid-cell-content">
              <div class="grid-cell--12 row-button">
                <div class="grid-cell--11 buttons">
                  <!-- ACTIONS -->
                  <div class="row">
                    <label *ngIf="!showInventories && cardList.length > 0" class="form-label link-class"
                      ><a (click)="toggleInventoryDisplay()"
                        >+{{ getComponentName() + ".showInventory" | translate }}</a
                      ></label
                    >
                    <label *ngIf="showInventories && cardList.length > 0" class="form-label link-class"
                      ><a (click)="toggleInventoryDisplay()"
                        >-{{ getComponentName() + ".hideInventory" | translate }}</a
                      ></label
                    >
                    <label *ngIf="cardList.length > 1" class="form-label  link-class"
                      ><a (click)="selectAllInventories()">{{
                        getComponentName() + ".selectAll" | translate
                      }}</a></label
                    >
                    <label *ngIf="cardList.length > 1" class="form-label  link-class"
                      ><a (click)="unselectAllInventories()">{{
                        getComponentName() + ".unselectAll" | translate
                      }}</a></label
                    >
                    <label
                      class="form-label link-class"
                      *ngIf="cardList.length > maxVisibleInventories"
                      (click)="expandAll()"
                      ><a
                        ><span *ngIf="!expandInventoryList">+ {{ getComponentName() + ".showAll" | translate }}</span>
                        <span *ngIf="expandInventoryList">- {{ getComponentName() + ".collapse" | translate }}</span></a
                      ></label
                    >
                    <div class="form-group"></div>
                    <div class="form-group"></div>
                  </div>
                </div>
                <div class="grid-cell--1">
                  <div class="row">
                    <!-- Filter -->
                    <span class="row align-custom custom-height">
                      <span class="lds-hourglass" *ngIf="loadInventoriesFlag"></span>
                      <i
                        class="fa fa-fw fa-filter aw-icon aw-icon-with-overlay"
                        aria-hidden="true"
                        pTooltip="{{
                          getComponentName() + (filtersVisible ? '.hideFilters' : '.showFilters') | translate
                        }}"
                        tooltipPosition="top"
                        [ngClass]="{ active: filtersVisible }"
                        (click)="opFilters.toggle($event)"
                      ></i>

                      <p-overlayPanel
                        #opFilters
                        [appendTo]="'body'"
                        class="aw-overlay"
                        [dismissable]="true"
                        (onShow)="filtersVisible = true"
                        (onHide)="filtersVisible = false"
                      >
                        <div class="page-content" *ngIf="overlayContentReady">
                          <div class="grid-row">
                            <div class="grid-cell grid-cell--container">
                              <div class="grid-cell-content">
                                <div class="column">
                                  <div class="row">
                                    <div class="form-group flex--auto">
                                      <label class="form-label">{{ getComponentName() + ".pn" | translate }}</label>

                                      <div class="form-control">
                                        <p-dropdown
                                          class="aw-dropdown fixed-width"
                                          [(ngModel)]="searchCriteria.selectedPN"
                                          [options]="inventoryPNList"
                                          placeholder="&nbsp;"
                                          [showClear]="true"
                                        ></p-dropdown>
                                      </div>
                                    </div>

                                    <div class="form-group flex--auto">
                                      <label class="form-label">{{
                                        getComponentName() + ".workorder" | translate
                                      }}</label>

                                      <div class="form-control">
                                        <p-dropdown
                                          class="aw-dropdown fixed-width"
                                          [(ngModel)]="searchCriteria.selectedWO"
                                          [options]="inventoryWOList"
                                          placeholder="&nbsp;"
                                          [showClear]="true"
                                        ></p-dropdown>
                                      </div>
                                    </div>
                                  </div>

                                  <div class="row">
                                    <div class="form-group flex--auto">
                                      <label class="form-label">{{
                                        getComponentName() + ".sentence" | translate
                                      }}</label>

                                      <div class="form-control">
                                        <p-dropdown
                                          class="aw-dropdown fixed-width"
                                          [(ngModel)]="searchCriteria.selectedSentence"
                                          [options]="inventorySentenceList"
                                          placeholder="&nbsp;"
                                          [showClear]="true"
                                        ></p-dropdown>
                                      </div>
                                    </div>

                                    <div class="form-group flex--auto">
                                      <label class="form-label">{{
                                        getComponentName() + ".decision" | translate
                                      }}</label>

                                      <div class="form-control footer-div">
                                        <p-dropdown
                                          class="aw-dropdown fixed-width"
                                          [(ngModel)]="searchCriteria.selectedDecision"
                                          [options]="inventoryDecisionList"
                                          placeholder="&nbsp;"
                                          [showClear]="true"
                                        ></p-dropdown>
                                      </div>
                                    </div>
                                  </div>

                                  <div class="row">
                                    <div class="form-group">
                                      <label class="form-label"> &nbsp;</label>

                                      <div class="form-control aw-selectbutton-wrapper">
                                        <p-selectButton
                                          [(ngModel)]="searchCriteria.control"
                                          [options]="statusList"
                                          multiple="true"
                                        ></p-selectButton>
                                      </div>
                                    </div>
                                  </div>

                                  <div class="row action-list">
                                    <button type="button" mat-raised-button (click)="reset()">
                                      {{ "global.reset" | translate }}
                                    </button>

                                    <button type="button" mat-raised-button (click)="filter(); opFilters.hide()">
                                      {{ "global.filter" | translate }}
                                    </button>
                                  </div>
                                </div>
                              </div>
                            </div>
                          </div>
                        </div>
                      </p-overlayPanel>
                    </span>
                  </div>
                </div>
              </div>
              <div class="grid-cell--12 custom-control">
                <div class="grid-cell--1 add-inventory" (click)="addInventory()">
                  <p-card>
                    <h1>+</h1>
                  </p-card>
                </div>
                <div class="grid-cell--11 column custom-panel margin-class" *ngIf="!loadInventoriesFlag">
                  <div
                    class="row card-row"
                    [ngClass]="{
                      'custom-card-row': !expandInventoryList
                    }"
                    *ngIf="showInventories"
                  >
                    <div
                      class="card-container"
                      [ngClass]="{
                        'card-serialize-item': isItemSerialized,
                        'card-not-serialize-item': !isItemSerialized
                      }"
                      *ngFor="let inventory of cardList"
                      (click)="selectInventory(inventory)"
                      [class.current]="inventory.isSelected"
                    >
                      <p-card class="card-class"
                      [ngClass]="{
                        'card-class': isItemSerialized,
                        'card-class-not-serialize': !isItemSerialized
                      }"
                      [styleClass]="getStyles(inventory.icon)">
                        <div class="row custom-row">
                          <div *ngIf="!isItemSerialized" title="{{ inventory.quantity }}">
                            <span class="quantity-non-serialized"> (Q= {{ getTrimQty(inventory.quantity) }})</span>
                          </div>
                          <div class="form">
                            <label class="form-label"
                              ><b>{{ getComponentName() + ".pn" | translate }} :</b></label
                            >
                            <span class="margin-class"
                              ><a>{{ getTrimQty(inventory.pn) }}</a>
                            </span>
                          </div>
                          <div class="form" *ngIf="isItemSerialized && !!inventory.sn">
                            <label class="form-label"
                              ><b>{{ getComponentName() + ".sn" | translate }} :</b></label
                            >
                            <span class="margin-class"
                              ><a>{{ getTrimQty(inventory.sn) }}</a></span
                            >
                          </div>
                          <div class="form" *ngIf="!isItemSerialized && !!inventory.trackingNumber">
                            <label class="form-label"
                              ><b>{{ getComponentName() + ".tn" | translate }} :</b></label
                            >
                            <span class="margin-class"
                              ><a>{{ getTrimQty(inventory.trackingNumber) }}</a></span
                            >
                          </div>
                          <div class="form">
                            <i *ngIf="!!inventory.sentenceValue"
                              ><span class="quantity">S:</span>
                              {{ getTrimLabel(getSentenceLabel(inventory.sentenceValue)) }}</i
                            >
                            <i *ngIf="!inventory.sentenceValue"
                              ><span class="quantity">S:</span> {{ getComponentName() + ".notSet" | translate }}</i
                            >
                          </div>
                          <div class="form">
                            <i *ngIf="!!inventory.decisionValue"
                              ><span class="quantity">D:</span>
                              {{ getTrimLabel(getDecisionLabel(inventory.decisionValue)) }}</i
                            >
                            <i *ngIf="!inventory.decisionValue"
                              ><span class="quantity">D:</span> {{ getComponentName() + ".notSet" | translate }}</i
                            >
                          </div>
                          <div class="form footer-div">
                            <i class="wks-float" *ngIf="!!inventory.woCode"
                              ><b>Wks: </b> {{ getTrimQty(inventory.woCode) }}</i
                            >
                          </div>
                        </div>
                      </p-card>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- PANEL 2 -->
      <div class="grid-row">
        <div class="grid-cell--12">
          <div class="grid-cell grid-cell--container grid-cell-scope">
            <div class="grid-cell-header">
              <div class="grid-cell-title-container  loading-indicator">
                <h3 class="grid-cell-title">
                  {{ getComponentName() + ".technicalQuotation" | translate }}
                  <div *ngIf="loadInventoriesFlag" class="lds-hourglass"></div>
                </h3>
              </div>
            </div>

            <div class="grid-cell-content">
              <div class="grid-cell--12">
                <div class="grid-cell--4">
                  <div class="column">
                    <div class="row">
                      <div class="form-group" *ngIf="!showOtherPN">
                        <label class="form-label">{{ getComponentName() + ".pn" | translate }}</label>
                        <div class="form-control" *ngIf="isPNCommon && selectedInventoryList.length > 1 && !selectedPN">
                          <i>{{ getComponentName() + ".differentPN" | translate }}</i>
                        </div>
                        <div class="form-control">
                          <p-autoComplete
                            class="aw-dropdown fixed-width"
                            [(ngModel)]="selectedPN"
                            [suggestions]="pnList"
                            [immutable]="true"
                            [dropdown]="true"
                            [forceSelection]="true"
                            (completeMethod)="searchPN($event)"
                            (onSelect)="onChangePN()"
                          ></p-autoComplete>
                        </div>
                      </div>

                      <div class="form-group" *ngIf="showOtherPN">
                        <label class="form-label">{{ getComponentName() + ".otherPN" | translate }}</label>
                        <div
                          class="form-control"
                          *ngIf="isOtherPNDifferent && selectedInventoryList.length > 1 && !selectedPN"
                        >
                          <i>{{ getComponentName() + ".differentOtherPN" | translate }}</i>
                        </div>
                        <div class="form-control">
                          <input type="text" class="aw-input" [(ngModel)]="otherPN" />
                        </div>
                      </div>

                      <div class="form-group">
                        <label class="form-label">&nbsp;</label>
                        <div class="form-control">
                          <!-- Toggle PN and Other PN -->
                          <button color="primary" type="button" mat-raised-button (click)="togglePNButton()">
                            <span *ngIf="showOtherPN">{{ getComponentName() + ".pnList" | translate }}</span>
                            <span *ngIf="!showOtherPN">{{ getComponentName() + ".otherPN" | translate }}</span>
                          </button>
                        </div>
                      </div>
                    </div>
                    <div class="form-group flex--2" *ngIf="selectedInventoryList.length === 1 && isItemSerialized">
                      <label class="form-label">{{ getComponentName() + ".sn" | translate }}</label>

                      <div class="form-control">
                        <input type="text" class="aw-input" [(ngModel)]="selectedInventoryList[0].sn" />
                      </div>
                    </div>

                    <div *ngIf="isAddInventory || (addNewInventory && selectedInventoryList.length === 0)">
                      <div class="form-group">
                        <label class="form-label"
                          >{{ getComponentName() + ".quantity" | translate }} ({{
                            getComponentName() + ".expected" | translate
                          }}= {{ bireItemDTO.expectedQuantity }})</label
                        >
                        <div class="form-control">
                          <input
                            type="number"
                            class="aw-input"
                            min="0"
                            [(ngModel)]="quantityValue"
                            (input)="onQuantityChange()"
                          />
                        </div>
                      </div>
                      <div class="serial-class">
                        <!-- SERIALIZED -->
                        <div class="form-group" *ngIf="isItemSerialized">
                          <label class="form-label">{{ getComponentName() + ".serialNo" | translate }}</label>
                          <div class="form-control custom-control" *ngFor="let count of snCount; let i = index">
                            <span class="margin-top-class" *ngIf="snCount.length > 1">#{{ i + 1 }} </span>
                            <input type="text" class="aw-input" [(ngModel)]="count.value" />
                          </div>
                        </div>
                      </div>
                    </div>

                    <div
                      *ngIf="
                        !isAddInventory &&
                        !addNewInventory &&
                        (!isItemSerialized || (isItemSerialized && selectedInventoryList.length > 1))
                      "
                    >
                      <div class="form-group">
                        <label class="form-label"
                          >{{ getComponentName() + ".quantity" | translate }} ({{
                            getComponentName() + ".expected" | translate
                          }}= {{ bireItemDTO.expectedQuantity }})</label
                        >
                        <div class="form-control">
                          <input
                            type="number"
                            class="aw-input"
                            min="0"
                            [disabled]="isItemSerialized || (!isItemSerialized && selectedInventoryList.length > 1)"
                            [(ngModel)]="sumRealQuantity"
                            (input)="onQuantityChange()"
                          />
                        </div>
                      </div>
                      <div class="serial-class">
                        <div class="form-group" *ngIf="isItemSerialized">
                          <label class="form-label">{{ getComponentName() + ".serialNo" | translate }}</label>
                          <div
                            class="form-control custom-control"
                            *ngFor="let inventory of selectedInventoryList; let i = index"
                          >
                            <span class="margin-top-class" *ngIf="selectedInventoryList.length > 1">#{{ i + 1 }} </span>
                            <input type="text" class="aw-input" [(ngModel)]="inventory.sn" />
                          </div>
                        </div>

                        <!-- NOT SERIALIZED -->
                        <div class="form-group" *ngIf="!isItemSerialized && selectedInventoryList.length > 1">
                          <label class="form-label">{{ getComponentName() + ".trackingNumber" | translate }}</label>
                          <div class="form-control" *ngIf="isTNCommon">
                            <i>{{ getComponentName() + ".differentTN" | translate }}</i>
                          </div>
                          <span *ngIf="selectedInventoryList.length > 1">
                            <div class="form-control" *ngFor="let inventory of selectedInventoryList">
                              <input
                                type="text"
                                class="aw-input"
                                *ngIf="!!inventory.trackingNumber"
                                disabled
                                [(ngModel)]="inventory.trackingNumber"
                              />
                            </div>
                          </span>
                        </div>

                        <div class="form-group" *ngIf="selectedInventoryList.length === 1 && !isItemSerialized">
                          <label class="form-label">{{ getComponentName() + ".trackingNumber" | translate }}</label>

                          <div class="form-control">
                            <input type="text" class="aw-input" [(ngModel)]="selectedInventoryList[0].trackingNumber" />
                          </div>
                        </div>
                      </div>
                    </div>

                    <div *ngIf="isAddInventory || (addNewInventory && selectedInventoryList.length === 0)">
                      <!-- NOT SERIALIZED -->
                      <div class="form-group" *ngIf="!isItemSerialized">
                        <label class="form-label">{{ getComponentName() + ".trackingNumber" | translate }}</label>

                        <div class="form-control">
                          <input type="text" class="aw-input" [(ngModel)]="newInventory.trackingNumber" />
                        </div>
                      </div>
                    </div>

                    <div class="form-group">
                      <label class="form-label">{{ getComponentName() + ".targetPN" | translate }}</label>
                      <div
                        class="form-control"
                        *ngIf="isTargetPNCommon && selectedInventoryList.length > 1 && !selectedTargetPN"
                      >
                        <i>{{ getComponentName() + ".differentTargetPN" | translate }}</i>
                      </div>
                      <div class="form-control">
                        <p-autoComplete
                          class="aw-dropdown fixed-width"
                          [(ngModel)]="selectedTargetPN"
                          [suggestions]="targetPNList"
                          [immutable]="true"
                          [dropdown]="true"
                          [forceSelection]="true"
                          (completeMethod)="searchTargetPN($event)"
                          (onSelect)="onChangeTargetPN()"
                        ></p-autoComplete>
                      </div>
                    </div>
                  </div>
                </div>

                <div class="grid-cell--11">
                  <div class="column">
                    <div class="row">
                      <div class="form-group flex--2">
                        <label class="form-label">{{ getComponentName() + ".sentence" | translate }}</label>
                        <div
                          class="form-control"
                          *ngIf="isIntersectionSentenceDiff && selectedInventoryList.length > 1 && !selectedSentence"
                        >
                          <i>{{ getComponentName() + ".differentSentence" | translate }}</i>
                        </div>
                        <div class="form-control aw-selectbutton-wrapper select-button-custom">
                          <p-selectButton
                            [(ngModel)]="selectedSentence"
                            [options]="sentenceList"
                            (onChange)="changeSentence()"
                          ></p-selectButton>
                        </div>
                      </div>
                      <div class="form-group" *ngIf="selectedInventoryList.length > 0">
                        <label class="form-label">{{ getComponentName() + ".configurationStatus" | translate }}</label>
                        <span *ngIf="getConfiguration() === ok" class="alert alert--ok">OK</span>
                        <span *ngIf="getConfiguration() === nok" class="alert alert--nok">NOK</span>
                        <span *ngIf="getConfiguration() === warning" class="alert alert--warning">WARNING</span>
                      </div>
                    </div>

                    <div class="row">
                      <div class="form-group flex--2">
                        <label class="form-label">{{ getComponentName() + ".decision" | translate }}</label>
                        <div
                          class="form-control"
                          *ngIf="isIntersectionDecisionDiff && selectedInventoryList.length > 1 && !selectedDecision"
                        >
                          <i>{{ getComponentName() + ".differentDecision" | translate }}</i>
                        </div>
                        <div class="form-control aw-selectbutton-wrapper footer-div select-button-custom">
                          <p-selectButton
                            [(ngModel)]="selectedDecision"
                            [options]="decisionList"
                            (onChange)="changeDecision()"
                          ></p-selectButton>
                        </div>
                      </div>
                      <div class="form-group" *ngIf="selectedInventoryList.length > 0">
                        <label class="form-label">{{ getComponentName() + ".wo" | translate }}</label>
                        <div class="form-control">
                          <a class="link-class" (click)="openWorkOrderLink(selectedInventoryList[0])">{{
                            selectedInventoryList[0].woCode
                          }}</a>
                          <p-progressBar
                            *ngIf="!!selectedInventoryList[0].woCode"
                            [value]="selectedInventoryList[0].progress"
                          >
                          </p-progressBar>
                        </div>
                      </div>
                    </div>

                    <div class="form-group">
                      <label class="form-label">{{ getComponentName() + ".comment" | translate }}</label>
                      <div class="form-control">
                        <textarea
                          class="aw-textarea"
                          [rows]="3"
                          pInputTextarea
                          maxlength="150"
                          [disabled]="isReadOpenMode"
                        ></textarea>
                      </div>
                    </div>
                  </div>
                </div>
                <div class="grid-cell--1" *ngIf="!isAddInventory && selectedInventoryList.length !== 0">
                  <img />
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- PANEL 2 -->
      <div class="grid-row" *ngIf="isFromInspection">
        <!-- FINDINGS -->
        <div class="grid-cell--6">
          <div class="grid-cell grid-cell--container grid-cell-scope">
            <div class="grid-cell-header">
              <div class="grid-cell-title-container loading-indicator">
                <h3 class="grid-cell-title">
                  {{ getComponentName() + ".findings" | translate }}
                  <div *ngIf="loadInventoriesFlag" class="lds-hourglass"></div>
                </h3>
              </div>
            </div>

            <div class="grid-cell-content" *ngIf="!loadInventoriesFlag">
              <p-table
                [resizableColumns]="true"
                #ptableFindingsElement
                class="aw-table2"
                [columns]="findingCols"
                [value]="findingsList"
                [scrollable]="true"
                scrollHeight="25vh"
                [(selection)]="selectedFinding"
              >
                <ng-template pTemplate="emptymessage">
                  <span *ngIf="!isfilterTable"> &nbsp;</span>

                  <div *ngIf="isfilterTable" class="aw-table-loading-indicator">
                    <div class="loading-message">{{ "table.loadingData" | translate }}</div>
                    <div class="lds-hourglass"></div>
                  </div>
                </ng-template>
                <ng-template pTemplate="caption">
                  <div class="aw-table-header">
                    <div class="aw-table-global-filter">
                      <label class="aw-table-global-filter-label">
                        <i class="fa fa-fw fa-search" aria-hidden="true"></i>
                      </label>

                      <input
                        #ptableCusCustomerGlobalFilter
                        class="aw-table-global-filter-input"
                        type="text"
                        placeholder="{{ 'table.globalFilterText' | translate }}"
                        (input)="ptableFindingsElement.filterGlobal($event.target.value, 'contains')"
                      />
                    </div>

                    <div class="aw-table-actions">
                      <button
                        type="button"
                        *ngIf="selectedFinding.length > 0"
                        mat-raised-button
                        color="warn"
                        (click)="deleteFindings()"
                      >
                        {{ "global.delete" | translate }}
                      </button>
                      <button
                        type="button"
                        *ngIf="selectedFinding.length === 1"
                        mat-raised-button
                        (click)="editFindings()"
                      >
                        {{ "global.edit" | translate }}
                      </button>
                      <button
                        *ngIf="selectedFinding.length === 0"
                        type="button"
                        mat-raised-button
                        (click)="openFindingsDialog()"
                      >
                        {{ "global.add" | translate }}
                      </button>

                      <button
                        *ngIf="selectedFinding.length === 1"
                        type="button"
                        mat-raised-button
                        (click)="openFindingsDialogInReadMode()"
                      >
                        {{ "global.open" | translate }}
                      </button>
                    </div>
                  </div>
                </ng-template>

                <ng-template pTemplate="colgroup" let-columns>
                  <colgroup>
                    <col class="aw-table-checkbox-wrapper" />
                    <col *ngFor="let col of columns" [ngStyle]="{ width: col.width }" />
                  </colgroup>
                </ng-template>

                <ng-template pTemplate="header" let-columns>
                  <tr>
                    <th class="aw-table-checkbox-wrapper">
                      <p-tableHeaderCheckbox class="aw-table-checkbox"></p-tableHeaderCheckbox>
                    </th>

                    <th pResizableColumn *ngFor="let col of columns" [ngStyle]="{ 'text-align': col.alignment }">
                      {{ getComponentName() + "." + col.field | translate }}
                    </th>
                  </tr>
                </ng-template>

                <ng-template pTemplate="body" let-rowData let-columns="columns" let-rowIndex="rowIndex">
                  <tr [pSelectableRow]="rowData" [pSelectableRowIndex]="rowIndex">
                    <td class="aw-table-checkbox-wrapper">
                      <p-tableCheckbox class="aw-table-checkbox" [value]="rowData"></p-tableCheckbox>
                    </td>

                    <td *ngFor="let col of columns" [ngSwitch]="col.field" [ngStyle]="{ 'text-align': col.alignment }">
                      <span *ngSwitchCase="'damage'">
                        <div>
                          <a>{{ rowData["damageCode"] }}</a>
                        </div>
                        <div>
                          <i>{{ rowData["damageDescription"] }}</i>
                        </div>

                        <div>
                          {{ getComponentName() + ".criticality" | translate }} : <b>{{ rowData["criticality"] }}</b>
                        </div>
                        <div>
                          {{ getComponentName() + ".quantity" | translate }} : <b>{{ rowData["quantity"] }}</b>
                        </div>
                      </span>
                      <span *ngSwitchCase="'localisation'">
                        <div>
                          <b>{{ rowData["localisationCode"] }}</b>
                        </div>
                        <div>
                          <a>{{ rowData["location"] }}</a>
                        </div>
                      </span>
                      <span *ngSwitchCase="'illustration'">
                        <div class="illustration">
                          <img
                            class="img-class"
                            *ngIf="
                              !!rowData.bireDocumentDTOList &&
                              rowData.bireDocumentDTOList.length > 0 &&
                              !!rowData.bireDocumentDTOList[0].docFile
                            "
                            [src]="rowData.additionalData"
                          />
                        </div>
                      </span>

                      <span *ngSwitchDefault>
                        {{ rowData[col.field] }}
                      </span>
                    </td>
                  </tr>
                </ng-template>
              </p-table>
            </div>
          </div>
        </div>

        <!-- WORKS -->
        <div class="grid-cell--6">
          <div class="grid-cell grid-cell--container grid-cell-scope">
            <div class="grid-cell-header">
              <div class="grid-cell-title-container  loading-indicator">
                <h3 class="grid-cell-title">
                  {{ getComponentName() + ".works" | translate }}
                  <div *ngIf="loadInventoriesFlag" class="lds-hourglass"></div>
                </h3>
              </div>
            </div>

            <div class="grid-cell-content" *ngIf="!loadInventoriesFlag">
              <div class="row">
                <div class="form-group">
                  <label class="form-label">{{ getComponentName() + ".reworkedPN" | translate }}</label>

                  <div class="form-control">
                    <p-dropdown
                      class="aw-dropdown fixed-width"
                      [options]="reworkPNs"
                      placeholder="&nbsp;"
                      [showClear]="true"
                    ></p-dropdown>
                  </div>
                </div>
                <div class="form-group">
                  <label class="form-label">{{ getComponentName() + ".mroCenter" | translate }}</label>
                  <div class="form-control">
                    <p-dropdown
                      class="aw-dropdown fixed-width"
                      [(ngModel)]="selectedMroCenter"
                      [options]="mroCenterList"
                      (onChange)="changeMroCenterAndLoadTask()"
                    ></p-dropdown>
                  </div>
                </div>
                <div class="form-group">
                  <label class="form-label">{{ getComponentName() + ".taskType" | translate }}</label>
                  <div class="form-control">
                    <p-dropdown
                      class="aw-dropdown fixed-width"
                      [(ngModel)]="selectedTask"
                      [options]="taskList"
                      (onChange)="changeTaskType()"
                    ></p-dropdown>
                  </div>
                </div>
              </div>
              <p-table
                [resizableColumns]="true"
                #ptableWorksElement
                class="aw-table2"
                [columns]="worksCols"
                [value]="workList"
                [(selection)]="selectedWork"
                [scrollable]="true"
                scrollHeight="25vh"
              >
                <ng-template pTemplate="emptymessage">
                  <span *ngIf="!isfilterTable"> &nbsp;</span>

                  <div *ngIf="isfilterTable" class="aw-table-loading-indicator">
                    <div class="loading-message">{{ "table.loadingData" | translate }}</div>
                    <div class="lds-hourglass"></div>
                  </div>
                </ng-template>
                <ng-template pTemplate="caption">
                  <div class="aw-table-header">
                    <div class="aw-table-global-filter">
                      <label class="aw-table-global-filter-label">
                        <i class="fa fa-fw fa-search" aria-hidden="true"></i>
                      </label>

                      <input
                        #ptableCusCustomerGlobalFilter
                        class="aw-table-global-filter-input"
                        type="text"
                        placeholder="{{ 'table.globalFilterText' | translate }}"
                        (input)="ptableWorksElement.filterGlobal($event.target.value, 'contains')"
                      />
                    </div>

                    <div class="aw-table-actions">
                      <button type="button" mat-raised-button *ngIf="selectedWork.length > 0" (click)="applyTask()">
                        {{ getComponentName() + ".applied" | translate }}
                      </button>
                    </div>
                    <div class="aw-table-icon-actions">
                      <i
                        class="fa fa-fw fa-filter aw-icon aw-icon-with-border aw-icon-with-overlay"
                        aria-hidden="true"
                        tooltipPosition="top"
                        (click)="workFilters.toggle($event)"
                      ></i>
                    </div>
                  </div>
                </ng-template>

                <ng-template pTemplate="colgroup" let-columns>
                  <colgroup>
                    <col class="aw-table-checkbox-wrapper" />
                    <col *ngFor="let col of columns" [ngStyle]="{ width: col.width, display: col.display }" />
                  </colgroup>
                </ng-template>

                <ng-template pTemplate="header" let-columns>
                  <tr>
                    <th class="aw-table-checkbox-wrapper">
                      <p-tableHeaderCheckbox class="aw-table-checkbox"></p-tableHeaderCheckbox>
                    </th>

                    <th
                      pResizableColumn
                      *ngFor="let col of columns"
                      [ngStyle]="{ 'text-align': col.alignment, display: col.display }"
                    >
                      {{ getComponentName() + "." + col.field | translate }}
                    </th>
                  </tr>
                </ng-template>

                <ng-template pTemplate="body" let-rowData let-columns="columns" let-rowIndex="rowIndex">
                  <tr [pSelectableRow]="rowData" [pSelectableRowIndex]="rowIndex">
                    <td class="aw-table-checkbox-wrapper">
                      <p-tableCheckbox class="aw-table-checkbox" [value]="rowData"></p-tableCheckbox>
                    </td>

                    <td
                      *ngFor="let col of columns"
                      [ngSwitch]="col.field"
                      [ngStyle]="{ 'text-align': col.alignment, display: col.display }"
                    >
                      <span *ngSwitchCase="'task'">
                        <div>
                          <b>{{ rowData["taskCode"] }}</b>
                        </div>
                        <div title="{{ rowData['designation'] }}" class="description">
                          <i>{{ rowData["taskDesignation"] }}</i>
                        </div>
                        <div>
                          {{ getComponentName() + ".type" | translate }} : <b>{{ rowData["taskTypeLabel"] }}</b>
                        </div>
                      </span>
                      <span *ngSwitchCase="'workorder'">
                        <div>
                          <a>{{ rowData["workorder"] }}</a>
                        </div>
                        <div *ngIf="!!rowData['progress']">
                          <p-progressBar [value]="rowData['progress']"></p-progressBar>
                        </div>
                        <div>
                          <i>{{ rowData["woText"] }}</i>
                        </div>
                      </span>
                      <span *ngSwitchCase="'applied'">
                        <p-inputSwitch [(ngModel)]="rowData[col.field]" (onChange)="taskApplied()"></p-inputSwitch>
                      </span>
                      <span *ngSwitchDefault>{{ rowData[col.field] }}</span>
                    </td>
                  </tr>
                </ng-template>
              </p-table>
            </div>
          </div>
        </div>
      </div>

      <!-- DOCUMENT TAB -->
      <div
        class="grid-row"
        *ngIf="selectedInventoryList.length === 1 || ((isAddInventory || addNewInventory) && quantityValue === 1)"
      >
        <div class="grid-cell--12">
          <div class="grid-cell grid-cell--container grid-cell-scope">
            <div class="grid-cell-header">
              <div class="grid-cell-title-container  loading-indicator">
                <h3 class="grid-cell-title">
                  {{ getComponentName() + ".documents" | translate }}
                  ({{ documentTableDataSource ? documentTableDataSource.dataCount : 0 }})
                </h3>
              </div>
            </div>

            <div class="grid-cell-content">
              <a-table [dataSource]="documentTableDataSource">
                <ng-template tableActionsDef>
                  <button
                    *ngIf="documentTableDataSource.hasDataSelection"
                    type="button"
                    mat-raised-button
                    (click)="downloadFiles()"
                  >
                    {{ "global.download" | translate }}
                  </button>
                  <button
                    *ngIf="!isReadOpenMode && documentTableDataSource.hasDataSelection"
                    type="button"
                    mat-raised-button
                    color="warn"
                    (click)="deleteDocuments()"
                  >
                    {{ "global.delete" | translate }}
                  </button>
                  <button
                    *ngIf="!isReadOpenMode && documentTableDataSource.dataSelectionCount === 1"
                    type="button"
                    mat-raised-button
                    (click)="editDocument()"
                  >
                    {{ "global.edit" | translate }}
                  </button>

                  <button
                    *ngIf="!isReadOpenMode && documentTableDataSource.dataSelectionCount === 1"
                    type="button"
                    mat-raised-button
                    (click)="openDocument()"
                  >
                    {{ "global.open" | translate }}
                  </button>
                  <p-fileUpload
                    #fileUploader
                    *ngIf="!isReadOpenMode && !documentTableDataSource.hasDataSelection"
                    chooseLabel="{{ 'global.upload' | translate }}"
                    name="document[]"
                    customUpload="true"
                    mode="basic"
                    auto="true"
                    (uploadHandler)="uploadDocument($event, fileUploader)"
                  ></p-fileUpload>
                </ng-template>
                <ng-template columnDef="docEndOfValidityDate" let-rowData="rowData">
                  {{ rowData.docEndOfValidityDate | date: "yyyy/MM/dd" }}
                </ng-template>
                <ng-template columnDef="docExtension" let-rowData="rowData">
                  <span> {{ showDocExtension(rowData) }} </span>
                </ng-template>
                <ng-template columnDef="docPublicationDate" let-rowData="rowData">
                  <span>
                    {{ rowData.docPublicationDate | date: "yyyy/MM/dd" }}
                  </span>
                </ng-template>
              </a-table>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<p-overlayPanel #workFilters class="aw-overlay" (onShow)="showFilterPanel = true" (onHide)="showFilterPanel = false">
  <div class="grid-row">
    <div class="grid-cell--12">
      <div class="row">
        <div class="form-group">
          <label class="form-label">&nbsp;</label>

          <div class="form-control aw-selectbutton-wrapper">
            <p-selectButton
              [(ngModel)]="worksSearchCriteria.selectedToggle"
              [options]="toggleList"
              multiple="true"
            ></p-selectButton>
          </div>
        </div>
      </div>
      <div class="row">
        <div class="form-group">
          <label class="form-label">{{ getComponentName() + ".reworkedPN" | translate }}</label>

          <div class="form-control">
            <p-dropdown
              class="aw-dropdown fixed-width"
              [(ngModel)]="worksSearchCriteria.selectedReworkPN"
              [options]="reworkPNList"
              placeholder="&nbsp;"
              [showClear]="true"
            ></p-dropdown>
          </div>
        </div>
      </div>
      <div class="row">
        <div class="form-group">
          <label class="form-label">{{ getComponentName() + ".taskCode" | translate }}</label>

          <div class="form-control">
            <p-autoComplete
              *ngIf="showFilterPanel"
              class="aw-dropdown fixed-width"
              [(ngModel)]="worksSearchCriteria.selectedCode"
              [suggestions]="taskCodeList"
              field="label"
              [immutable]="true"
              [dropdown]="true"
              [forceSelection]="true"
              (completeMethod)="searchTaskCodeList($event)"
            ></p-autoComplete>
          </div>
        </div>
      </div>
      <div class="row">
        <div class="form-group">
          <label class="form-label"> {{ getComponentName() + ".taskDesignation" | translate }}</label>

          <div class="form-control aw-selectbutton-wrapper">
            <p-autoComplete
              *ngIf="showFilterPanel"
              class="aw-dropdown fixed-width"
              [(ngModel)]="worksSearchCriteria.selectedDesignation"
              [suggestions]="designationList"
              field="label"
              [immutable]="true"
              [dropdown]="true"
              [forceSelection]="true"
              (completeMethod)="searchDesignationList($event)"
            ></p-autoComplete>
          </div>
        </div>
      </div>

      <div class="row action-list">
        <button type="button" mat-raised-button (click)="resetWorks()">
          {{ "global.reset" | translate }}
        </button>

        <button type="button" mat-raised-button (click)="workFilters.hide(); showFilterPanel = false; filterWorks()">
          {{ "global.filter" | translate }}
        </button>
      </div>
    </div>
  </div>
</p-overlayPanel>

<aw-dialog-findings
  *ngIf="showFindingsDialog"
  [openMode]="findingsDialogOpenMode"
  [(display)]="showFindingsDialog"
  [finding]="finding"
  (onAddFindings)="addFindings($event)"
></aw-dialog-findings>

<aw-document-upload-dialog
  *ngIf="showAddDocumentDialog"
  [(display)]="showAddDocumentDialog"
  [openMode]="documentDialogOpenMode"
  [document]="currentDocument"
  [types]="documentTypes"
  (onValidated)="addNewDocument($event)"
>
</aw-document-upload-dialog>
