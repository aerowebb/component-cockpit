<div class="page-header">
  <div class="page-info">
    <div>
      <h2 class="page-title">
        {{ "transaction." + componentData.componentId | translate }}
      </h2>

      <div class="page-subtitle-container">
        <div *ngIf="itemDesignation" class="page-subtitle">- {{ itemDesignation }}</div>
      </div>
    </div>
  </div>

  <div class="page-actions">
    <button
      mat-icon-button
      *ngIf="!isCreateOpenMode"
      class="mat-elevation-z1"
      matTooltip="{{ 'global.showAllActionTooltip' | translate }}"
      matTooltipPosition="above"
      aria-label="Show all actions"
      [matMenuTriggerFor]="actions"
    >
      <mat-icon>more_horiz</mat-icon>
    </button>
    <mat-menu #actions="matMenu">
      <button type="button" mat-menu-item (click)="reload()">
        {{ "global.refresh" | translate }}
      </button>
      <button type="button" mat-menu-item (click)="updateFavoriteState()">
        {{ "page." + (isFavoriteEntry ? "removeFromFavorites" : "addToFavorites") | translate }}
      </button>
    </mat-menu>
  </div>
</div>

<div class="page-wrapper">
  <div class="page-container">
    <div class="page-content">
      <mat-tab-group animationDuration="0ms" dynamicHeight>
        <mat-tab>
          <ng-template mat-tab-label>
            {{ "global.home" | translate }}
          </ng-template>

          <div class="grid-row">
            <!-- CONFIGURATION SIMULATION -->
            <div
              #configurationSimulationAnchor
              class="grid-cell--equally"
              (click)="selectPageTocEntry(component.CONFIGURATION_SIMULATION_ANCHOR_ID)"
            >
              <div
                class="grid-cell grid-cell--container configuration-generation"
                [ngClass]="{ active: isPageTocEntrySelected(component.CONFIGURATION_SIMULATION_ANCHOR_ID) }"
              >
                <div class="grid-cell-header">
                  <div class="grid-cell-title-container">
                    <h3 class="grid-cell-title">
                      {{ getComponentName() + ".configurationSimulation" | translate }}
                    </h3>
                  </div>
                </div>

                <div class="grid-cell-content">
                  <div class="column">
                    <!-- ROW 1 -->
                    <div class="row">
                      <p-table
                        [resizableColumns]="true"
                        #ptableEvolution
                        class="aw-table2 table-evolution"
                        [columns]="itemEvolutionsCols"
                        [value]="evolutionTable"
                        [scrollable]="true"
                      >
                        <ng-template pTemplate="colgroup" let-columns>
                          <colgroup>
                            <col *ngFor="let col of columns" [ngStyle]="{ width: col.width }" />
                          </colgroup>
                        </ng-template>

                        <ng-template pTemplate="header" let-columns>
                          <tr>
                            <th
                              pResizableColumn
                              *ngFor="let col of columns"
                              [ngStyle]="{ 'text-align': col.alignment }"
                            >
                              {{ componentData.componentId + "." + col.field | translate }}
                            </th>
                          </tr>
                        </ng-template>

                        <ng-template pTemplate="body" let-rowData>
                          <tr (click)="toggleEvolutionHighlight(rowData)">
                            <td [ngStyle]="{ 'text-align': 'left' }">
                              {{ rowData.evolution }}
                            </td>

                            <td [ngStyle]="{ 'text-align': 'left' }">
                              <p-checkbox
                                binary="true"
                                class="aw-table-checkbox"
                                [(ngModel)]="rowData.inConfiguration"
                              ></p-checkbox>
                            </td>
                          </tr>
                        </ng-template>
                      </p-table>
                    </div>

                    <!-- ROW 2 -->
                    <div class="row">
                      <div>
                        <div class="action-list">
                          <button type="button" mat-raised-button (click)="generateConfiguration()">
                            {{ getComponentName() + ".simulate" | translate }}
                          </button>

                          <button type="button" mat-raised-button (click)="resetConfiguration()">
                            {{ getComponentName() + ".reset" | translate }}
                          </button>
                        </div>
                      </div>
                    </div>

                    <!-- ROW 3 -->
                    <div class="row">
                      <p-table
                        [resizableColumns]="true"
                        #ptableTargetPn
                        class="aw-table2 table-target-pn"
                        [columns]="itemTargetPnCols"
                        [value]="targetPnTable"
                        [scrollable]="true"
                      >
                        <ng-template pTemplate="colgroup" let-columns>
                          <colgroup>
                            <col *ngFor="let col of columns" [ngStyle]="{ width: col.width }" />
                          </colgroup>
                        </ng-template>

                        <ng-template pTemplate="header" let-columns>
                          <tr>
                            <th
                              pResizableColumn
                              *ngFor="let col of columns"
                              [ngStyle]="{ 'text-align': col.alignment }"
                            >
                              {{ componentData.componentId + "." + col.field | translate }}
                            </th>
                          </tr>
                        </ng-template>

                        <ng-template pTemplate="body" let-rowData class="ui-table-scrollable-body">
                          <tr (click)="togglePnHighlight(rowData)">
                            <td [ngStyle]="{ 'text-align': 'left' }">
                              {{ rowData.pn }}
                            </td>

                            <td [ngStyle]="{ 'text-align': 'left' }">
                              {{ rowData.quantity }}
                            </td>
                          </tr>
                        </ng-template>
                      </p-table>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- PARTS PROGRESSION -->
            <div
              #pnAndEvolutionSelectionAnchor
              class="grid-cell--grow2"
              (click)="selectPageTocEntry(component.PN_AND_EVOLUTION_SELECTION_ANCHOR_ID)"
            >
              <div
                class="grid-cell grid-cell--container"
                [ngClass]="{ active: isPageTocEntrySelected(component.PN_AND_EVOLUTION_SELECTION_ANCHOR_ID) }"
              >
                <div class="grid-cell-header">
                  <div class="grid-cell-title-container">
                    <h3 class="grid-cell-title">
                      {{ getComponentName() + ".partsProgression" | translate }}
                    </h3>
                  </div>
                </div>

                <!-- ROW 1 -->
                <div class="grid-cell-content">
                  <div class="row">
                    <div class="form-group">
                      <label class="form-label">{{ getComponentName() + ".approvalDate" | translate }}</label>

                      <div class="form-control">
                        <p-calendar
                          showButtonBar="true"
                          [monthNavigator]="true"
                          [yearNavigator]="true"
                          [yearRange]="sessionService.calendarYearRange"
                          class="aw-calendar"
                          [dateFormat]="sessionService.dateFormatPrimeNG"
                          [locale]="sessionService.calendarFormat"
                          [(ngModel)]="applicabilityDate"
                          [readonlyInput]="true"
                          (onSelect)="onSelectApplicabilityDate()"
                        ></p-calendar>
                      </div>
                    </div>

                    <div class="form-group">
                      <label class="form-label">{{
                        getComponentName() + ".retrievePnInConfiguration" | translate
                      }}</label>

                      <div class="form-control">
                        <p-dropdown
                          class="aw-dropdown fixed-width"
                          [options]="pnList"
                          [(ngModel)]="pnSelected"
                          [showClear]="true"
                          placeholder="&nbsp;"
                          (onChange)="onSelectPn()"
                        ></p-dropdown>
                      </div>
                    </div>

                    <div class="form-group">
                      <label class="form-label">{{
                        getComponentName() + ".retrieveEvolutionInConfiguration" | translate
                      }}</label>

                      <div class="form-control">
                        <p-dropdown
                          class="aw-dropdown fixed-width"
                          [options]="evolutionList"
                          [(ngModel)]="evolutionSelected"
                          [showClear]="true"
                          placeholder="&nbsp;"
                          (onChange)="onSelectEvolution(evolutionSelected ? evolutionSelected.evolution : undefined)"
                        ></p-dropdown>
                      </div>
                    </div>
                  </div>
                </div>

                <!-- ROW 2 - PARTS PROGRESSION-->
                <div class="grid-cell-content">
                  <div class="column">
                    <div *ngFor="let pnLinkList of pnLinkListList" class="row">
                      <p-tree class="pn-link-schema" [value]="pnLinkList" layout="horizontal">
                        <ng-template let-node pTemplate="default">
                          <div class="pn-node">
                            <span *ngIf="node.data.actionType.length > 0">{{ node.data.actionType }}</span>

                            <a
                              (click)="openPartNumberLink(node.data.code)"
                              class="pn"
                              [ngClass]="{ selected: node.data._isSelectedByPn }"
                            >
                              {{ node.data.code }}
                            </a>

                            <span *ngIf="node.data.quantity.length > 0">
                              ({{ getComponentName() + ".quantity" | translate }} = {{ node.data.quantity }})
                            </span>

                            <a
                              *ngIf="node.data.evolution.length > 0"
                              class="evolution"
                              (click)="openAdDialog($event, node.data)"
                              [ngClass]="{ selected: node.data._isSelectedByEvolution }"
                            >
                              {{ node.data.evolution }}
                            </a>
                          </div>
                        </ng-template>
                      </p-tree>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </mat-tab>
      </mat-tab-group>
    </div>
  </div>
</div>
