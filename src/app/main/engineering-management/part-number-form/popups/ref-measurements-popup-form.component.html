<a-modal class="aw-modal" [(visible)]="display" [width]="70">
  <a-header>
    <div class="modal-title">{{ getComponentName() + ".titlePopup" | translate }}</div>
  </a-header>

  <a-content>
    <div class="column">
      <div class="section">
        <h4 class="section-title">{{ getComponentName() + ".refMeasurementsManagement" | translate }}</h4>

        <div class="section-content">
          <div class="row">
            <div class="form-group" [ngClass]="{ required: !isReadOpenMode }">
              <label class="form-label">{{ getComponentName() + ".counterCode" | translate }}</label>

              <div
                class="form-control form-control-with-modal"
                [ngClass]="{ disabled: isReadOpenMode || isWriteOpenMode }"
              >
                <div class="form-control-data" (click)="showCounterCode()">{{ currentRef.counterCode }}</div>

                <div *ngIf="currentRef.counterCode" class="btn-clear-wrapper">
                  <i
                    class="ui-dropdown-clear-icon pi pi-times aw-icon btn-clear"
                    aria-hidden="true"
                    (click)="currentRef.counterCode = undefined"
                  ></i>
                </div>
                <div class="btn-search-wrapper">
                  <i class="fa fa-fw fa-search aw-icon btn-search" aria-hidden="true" (click)="showCounterCode()"></i>
                </div>
              </div>
            </div>

            <div class="form-group" [ngClass]="{ required: !isReadOpenMode }">
              <label class="form-label">{{ getComponentName() + ".familyCode" | translate }}</label>

              <div
                class="form-control form-control-with-modal"
                [ngClass]="{ disabled: isReadOpenMode || isWriteOpenMode }"
              >
                <div class="form-control-data" (click)="showFamilyCode()">{{ familyCode }}</div>

                <div *ngIf="familyCode" class="btn-clear-wrapper">
                  <i
                    class="ui-dropdown-clear-icon pi pi-times aw-icon btn-clear"
                    aria-hidden="true"
                    (click)="familyCode = undefined"
                  ></i>
                </div>
                <div class="btn-search-wrapper">
                  <i class="fa fa-fw fa-search aw-icon btn-search" aria-hidden="true" (click)="showFamilyCode()"></i>
                </div>
              </div>
            </div>

            <div class="form-group">
              <label class="form-label">{{ getComponentName() + ".ratingCode" | translate }}</label>

              <div
                class="form-control form-control-with-modal"
                [ngClass]="{ disabled: isReadOpenMode || isWriteOpenMode }"
              >
                <div class="form-control-data" (click)="searchRatingsCode()">
                  {{ currentRef.ratingCode }} <span *ngIf="ratingName">- {{ ratingName }}</span>
                </div>

                <div *ngIf="currentRef.ratingCode && !isWriteOpenMode" class="btn-clear-wrapper">
                  <i
                    class="ui-dropdown-clear-icon pi pi-times aw-icon btn-clear"
                    aria-hidden="true"
                    (click)="currentRef.ratingCode = undefined; ratingName = undefined"
                  ></i>
                </div>
                <div class="btn-search-wrapper">
                  <i class="fa fa-fw fa-search aw-icon btn-search" aria-hidden="true" (click)="searchRatingsCode()"></i>
                </div>
              </div>
            </div>

            <div class="form-group">
              <label class="form-label">{{ getComponentName() + ".interventionOption" | translate }}</label>

              <div class="form-control">
                <input type="text" class="aw-input" [(ngModel)]="interventionOption" [disabled]="isReadOpenMode" />
              </div>
            </div>

            <div class="form-group">
              <label class="form-label">{{ getComponentName() + ".isUpdatable" | translate }}</label>

              <div class="form-control">
                <p-checkbox
                  class="aw-checkbox"
                  value="val1"
                  binary="true"
                  [(ngModel)]="isUpdatable"
                  [disabled]="isReadOpenMode"
                ></p-checkbox>
              </div>
            </div>
          </div>
          <div class="row">
            <div class="form-group">
              <label class="form-label">{{ getComponentName() + ".tolerance" | translate }}</label>
              <div class="form-control">
                <input
                  #tolerance="ngModel"
                  type="text"
                  class="aw-input"
                  [(ngModel)]="currentRef.tolerance"
                  [disabled]="isReadOpenMode"
                  [pKeyFilter]="inputValidationService.validatorOfNumber()"
                  [pValidateOnly]="true"
                />
                <p-message
                  *ngIf="tolerance.invalid && (tolerance.dirty || tolerance.touched)"
                  severity="error"
                  [text]="inputValidationService.formatOfNumber()"
                ></p-message>
              </div>
            </div>
            <div class="form-group flex--1"></div>

            <div class="form-group">
              <label class="form-label">{{ getComponentName() + ".sbNumber" | translate }}</label>

              <div class="form-control form-control-with-modal" [ngClass]="{ disabled: isReadOpenMode }">
                <div class="form-control-data" (click)="showSbNumber()">{{ currentRef.sb }}</div>

                <div *ngIf="currentRef.sb" class="btn-clear-wrapper">
                  <i
                    class="ui-dropdown-clear-icon pi pi-times aw-icon btn-clear"
                    aria-hidden="true"
                    (click)="currentRef.sb = undefined"
                  ></i>
                </div>
                <div class="btn-search-wrapper">
                  <i class="fa fa-fw fa-search aw-icon btn-search" aria-hidden="true" (click)="showSbNumber()"></i>
                </div>
              </div>
            </div>
            <div class="form-group flex--1"></div>
          </div>
        </div>
      </div>

      <div class="section">
        <h4 class="section-title">{{ getComponentName() + ".limitDefinition" | translate }}</h4>

        <div class="section-content">
          <div class="column">
            <div class="row">
              <div class="form-group">
                <label class="form-label">{{ getComponentName() + ".pnPotentialReferenceValue" | translate }}</label>

                <div class="form-control form-control-with-radiobutton">
                  <p-radioButton
                    class="aw-radiobutton"
                    (onClick)="changeLimitValue()"
                    [disabled]="isReadOpenMode"
                    value="limitValue"
                    [(ngModel)]="optionLimit"
                    inputId="limitValue"
                  ></p-radioButton>

                  <input
                    type="text"
                    class="aw-input"
                    [(ngModel)]="currentRef.pnPotentialReferenceValue"
                    [disabled]="optionLimit !== 'limitValue' || isReadOpenMode"
                  />
                </div>
              </div>

              <div class="form-group">
                <label class="form-label">{{ getComponentName() + ".pnPotentialLimitDate" | translate }}</label>

                <div class="form-control form-control-with-radiobutton">
                  <p-radioButton
                    class="aw-radiobutton"
                    (onClick)="changeLimitDate()"
                    [disabled]="isReadOpenMode || currentRef.limitIsUpdatable"
                    value="limitDate"
                    [(ngModel)]="optionLimit"
                    inputId="limitDate"
                  ></p-radioButton>

                  <p-calendar
                    showButtonBar="true"
                    [monthNavigator]="true"
                    [yearNavigator]="true"
                    [yearRange]="sessionService.calendarYearRange"
                    class="aw-calendar"
                    [dateFormat]="sessionService.dateFormatPrimeNG"
                    [locale]="sessionService.calendarFormat"
                    [disabled]="optionLimit === 'limitValue' || currentRef.limitIsUpdatable || isReadOpenMode"
                    [(ngModel)]="currentRef.pnPotentialLimitDate"
                    appendTo="body"
                  ></p-calendar>
                </div>
              </div>

              <div class="form-group flex--3"></div>
            </div>

            <div class="row">
              <div class="form-group">
                <label class="form-label">{{ getComponentName() + ".limitIsUpdatable" | translate }}</label>

                <div class="form-control">
                  <p-checkbox
                    class="aw-checkbox"
                    (onChange)="checkLimitUpdatable()"
                    value="val1"
                    binary="true"
                    [(ngModel)]="currentRef.limitIsUpdatable"
                    [disabled]="isReadOpenMode"
                  ></p-checkbox>
                </div>
              </div>

              <div class="form-group flex--2" [ngClass]="{ required: !isReadOpenMode && currentRef.limitIsUpdatable }">
                <label class="form-label">{{ getComponentName() + ".limitDescription" | translate }} </label>

                <div class="form-control">
                  <input
                    type="text"
                    class="aw-input"
                    [(ngModel)]="currentRef.limitDescription"
                    [disabled]="isReadOpenMode"
                  />
                </div>
              </div>

              <div class="form-group flex--2"></div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </a-content>

  <a-footer>
    <button *ngIf="isReadOpenMode" type="button" mat-raised-button (click)="onHide()">
      <span>{{ "global.close" | translate }}</span>
    </button>

    <button *ngIf="!isReadOpenMode" type="button" mat-raised-button (click)="onHide()">
      <span>{{ "global.cancel" | translate }}</span>
    </button>

    <button
      *ngIf="!isReadOpenMode"
      [disabled]="
        currentRef.counterCode === null ||
        currentRef.counterCode === undefined ||
        currentRef.counterCode.trim() === '' ||
        familyCode === null ||
        familyCode === undefined ||
        familyCode.trim() === ''
      "
      type="button"
      mat-raised-button
      color="primary"
      (click)="onValidate()"
    >
      {{ "global.validate" | translate }}
    </button>
  </a-footer>
</a-modal>

<aw-dialog-table
  *ngIf="showFamilyCodeDialog"
  [keyMap]="keyMap"
  [(display)]="showFamilyCodeDialog"
  [data]="dialogTableDataFamilyCode"
  (onSelected)="setSelectedFamilyCode($event)"
></aw-dialog-table>
<aw-dialog-table
  *ngIf="showCounterCodeDialog"
  [keyMap]="keyMap"
  [(display)]="showCounterCodeDialog"
  [data]="dialogTableDataCounterCode"
  (onSelected)="setSelectedCounterCode($event)"
></aw-dialog-table>
<aw-dialog-table
  *ngIf="showRatingsCodeDialog"
  [keyMap]="keyMap"
  [(display)]="showRatingsCodeDialog"
  [data]="dialogTableDataRatingsCode"
  (onSelected)="setSelectedRatingsCode($event)"
></aw-dialog-table>
<aw-dialog-table
  *ngIf="showServiceBulletinDialog"
  [keyMap]="keyMap"
  [(display)]="showServiceBulletinDialog"
  [data]="dialogTableDataServiceBulletin"
  (onSelected)="setSelectedServiceBulletin($event)"
></aw-dialog-table>
