<div class="page-header">
  <div class="page-info">
    <div>
      <h2 class="page-title">
        {{ "transaction." + componentData.componentId | translate }}
      </h2>

      <div class="page-subtitle">
        <div *ngIf="!isCreateOpenMode && componentData && componentData.objectId" class="page-subtitle">
          {{ displayName }}
        </div>
      </div>
    </div>
    <div class="object-status" *ngIf="currentMaintenancePlan.statusState" (click)="showStatus()">
      {{ currentMaintenancePlan.statusState | formatSelectOption: status }}
    </div>
  </div>

  <div class="page-actions">
    <button *ngIf="showCreateAmpButton" type="button" mat-raised-button (click)="createAmp()">
      {{ getComponentName() + ".createAMP" | translate }}
    </button>
    <button
      *ngIf="isReadOpenMode && !isConsultMode && hasUpdateAccessRight"
      type="button"
      mat-raised-button
      (click)="editMaintenanceProgram()"
    >
      {{ "global.edit" | translate }}
    </button>
    <button
      *ngIf="!isReadOpenMode && !isCreateOpenMode"
      color="warn"
      type="button"
      mat-raised-button
      (click)="cancelMaintenanceProgram()"
    >
      {{ "global.cancel" | translate }}
    </button>

    <button
      *ngIf="!isReadOpenMode"
      class="btn-with-spinner"
      color="primary"
      type="button"
      mat-raised-button
      (click)="save()"
    >
      <span class="lds-hourglass" *ngIf="showSaveSpinner"></span>
      {{ "global.save" | translate }}
    </button>
    <button
      mat-icon-button
      class="mat-elevation-z1"
      matTooltip="{{ 'global.showAllActionTooltip' | translate }}"
      matTooltipPosition="above"
      aria-label="Show all actions"
      [matMenuTriggerFor]="actions"
    >
      <mat-icon>more_horiz</mat-icon>
    </button>
    <mat-menu #actions="matMenu">
      <button *ngIf="showAssignAssetsButton" type="button" mat-menu-item (click)="assignAssets()">
        {{ componentData.componentId + ".assignAssets" | translate }}
      </button>

      <button type="button" mat-menu-item (click)="openStatusUpdatesPopup()">
        {{ "global.updates" | translate }}
      </button>
      <button *ngIf="showUpgradeButton" type="button" mat-menu-item (click)="checkUpgradeMaintenancePlan()">
        {{ componentData.componentId + ".upgrade" | translate }}
      </button>

      <button
        *ngIf="isReadOpenMode && !isCreateOpenMode && !isConsultMode"
        type="button"
        mat-menu-item
        (click)="reloadMaintenanceProgram()"
      >
        {{ "global.refresh" | translate }}
      </button>

      <button mat-menu-item (click)="updateFavoriteState()">
        {{ (isFavoriteEntry ? "page.removeFromFavorites" : "page.addToFavorites") | translate }}
      </button>
    </mat-menu>
  </div>
</div>

<div class="page-wrapper">
  <div class="page-container search-page-container">
    <div class="page-content">
      <mat-tab-group animationDuration="0ms" dynamicHeight>
        <mat-tab>
          <ng-template mat-tab-label>
            {{ "home" | translate }}
          </ng-template>
          <!-- Main information -->
          <div class="grid-row">
            <div #mainDataAnchor class="grid-cell--4" (click)="setSelectedAnchor('mainDataAnchor')">
              <div class="grid-cell grid-cell--container" [ngClass]="{ active: isSelectedAnchor('mainDataAnchor') }">
                <div class="grid-cell-header">
                  <div class="grid-cell-title-container">
                    <h3 class="grid-cell-title">
                      {{ "page.mainData" | translate }}
                    </h3>
                  </div>
                </div>

                <div class="grid-cell-content">
                  <div class="column">
                    <div class="row">
                      <div class="form-group" [ngClass]="{ required: !isReadOpenMode }">
                        <label class="form-label">
                          {{ componentData.componentId + ".code" | translate }}
                        </label>

                        <div class="form-control">
                          <input
                            type="text"
                            class="aw-input"
                            maxlength="50"
                            [(ngModel)]="currentMaintenancePlan.planCode"
                            [disabled]="isReadOpenMode || !isCreateOpenMode"
                          />
                        </div>
                      </div>

                      <div class="form-group" [ngClass]="{ required: !isReadOpenMode }">
                        <label class="form-label">
                          {{ componentData.componentId + ".name" | translate }}
                        </label>

                        <div class="form-control">
                          <input
                            type="text"
                            class="aw-input"
                            maxlength="100"
                            [(ngModel)]="currentMaintenancePlan.planName"
                            [disabled]="isReadOpenMode || disableMpEdit"
                          />
                        </div>
                      </div>
                    </div>
                    <div class="row">
                      <div class="form-group" [ngClass]="{ required: !isReadOpenMode }">
                        <label class="form-label">
                          {{ componentData.componentId + ".revisionNumber" | translate }}
                        </label>

                        <div class="form-control">
                          <input
                            type="text"
                            class="aw-input"
                            maxlength="10"
                            [(ngModel)]="currentMaintenancePlan.planRevisionNumber"
                            [disabled]="isReadOpenMode || disableMpEdit"
                          />
                        </div>
                      </div>

                      <div class="form-group">
                        <label class="form-label">
                          {{ componentData.componentId + ".revisionDate" | translate }}
                        </label>

                        <div class="form-control">
                          <p-calendar
                            showButtonBar="true"
                            [monthNavigator]="true"
                            [yearNavigator]="true"
                            [yearRange]="sessionService.calendarYearRange"
                            class="aw-calendar"
                            [dateFormat]="sessionService.dateFormatPrimeNG"
                            [locale]="sessionService.calendarFormat"
                            [(ngModel)]="currentMaintenancePlan.planRevisionDate"
                            [disabled]="isReadOpenMode || disableMpEdit"
                            appendTo="body"
                          ></p-calendar>
                        </div>
                      </div>
                    </div>
                    <div class="row">
                      <div class="form-group">
                        <label class="form-label">
                          {{ componentData.componentId + ".approvalNumber" | translate }}
                        </label>

                        <div class="form-control">
                          <input
                            type="text"
                            class="aw-input"
                            maxlength="10"
                            [(ngModel)]="currentMaintenancePlan.planApprovalNumber"
                            [disabled]="isReadOpenMode || disableMpEdit"
                          />
                        </div>
                      </div>
                      <div class="form-group">
                        <label class="form-label">
                          {{ componentData.componentId + ".approvalDate" | translate }}
                        </label>

                        <div class="form-control">
                          <p-calendar
                            showButtonBar="true"
                            [monthNavigator]="true"
                            [yearNavigator]="true"
                            [yearRange]="sessionService.calendarYearRange"
                            class="aw-calendar"
                            [dateFormat]="sessionService.dateFormatPrimeNG"
                            [locale]="sessionService.calendarFormat"
                            [(ngModel)]="currentMaintenancePlan.planApprovalDate"
                            [disabled]="isReadOpenMode || disableMpEdit"
                            appendTo="body"
                          ></p-calendar>
                        </div>
                      </div>
                    </div>
                    <div class="row">
                      <div class="form-group">
                        <label class="form-label">
                          {{ componentData.componentId + ".validityEndDate" | translate }}
                        </label>

                        <div class="form-control">
                          <p-calendar
                            showButtonBar="true"
                            [monthNavigator]="true"
                            [yearNavigator]="true"
                            [yearRange]="sessionService.calendarYearRange"
                            class="aw-calendar"
                            [dateFormat]="sessionService.dateFormatPrimeNG"
                            [locale]="sessionService.calendarFormat"
                            [(ngModel)]="currentMaintenancePlan.planValidityEndDate"
                            [disabled]="isReadOpenMode || disableMpEdit"
                            appendTo="body"
                          ></p-calendar>
                        </div>
                      </div>
                    </div>

                    <div class="row">
                      <div *ngIf="relatedApplicableMaintenancePlanCode" class="form-group">
                        <label class="form-label">
                          {{ componentData.componentId + ".applicableMaintenancePlan" | translate }}
                        </label>

                        <div class="form-control span-padding">
                          <a
                            (click)="openMaintenanceProgram(relatedApplicableMaintenancePlanCode)"
                            style="cursor: pointer;"
                            >{{ relatedApplicableMaintenancePlanCode }}</a
                          >
                        </div>
                      </div>

                      <div class="form-group" *ngIf="relatedRecommendedMaintenancePlanCode">
                        <label class="form-label">
                          {{ componentData.componentId + ".recommendedMaintenancePlan" | translate }}
                        </label>

                        <div class="form-control span-padding">
                          <a
                            (click)="openMaintenanceProgram(relatedRecommendedMaintenancePlanCode)"
                            style="cursor: pointer;"
                            >{{ relatedRecommendedMaintenancePlanCode }}</a
                          >
                        </div>
                      </div>

                      <div *ngIf="relatedRecommendedMaintenancePlanCode" class="form-group">
                        <label class="form-label">
                          {{ componentData.componentId + ".complianceStatus" | translate }}
                        </label>

                        <div class="form-control span-padding">
                          <span
                            *ngIf="complianceColor === COMPLIANCE_GREEN"
                            class="airworthiness-alert airworthiness-alert--ok"
                          >
                            {{ "global.alertOk" | translate }}
                          </span>

                          <span
                            *ngIf="complianceColor === COMPLIANCE_RED"
                            class="airworthiness-alert airworthiness-alert--nok"
                          >
                            {{ "global.alertNok" | translate }}
                          </span>
                        </div>
                      </div>
                      <div
                        *ngIf="!relatedApplicableMaintenancePlanCode && !relatedRecommendedMaintenancePlanCode"
                        class="form-group"
                      ></div>
                      <div *ngIf="!relatedRecommendedMaintenancePlanCode" class="form-group"></div>
                    </div>
                    <div class="row">
                      <div class="form-group">
                        <label class="form-label">
                          {{ componentData.componentId + ".description" | translate }}
                        </label>
                        <div class="form-control">
                          <textarea
                            class="aw-textarea"
                            [rows]="3"
                            pInputTextarea
                            [(ngModel)]="currentMaintenancePlan.planDescription"
                            [disabled]="isReadOpenMode || disableMpEdit"
                            maxlength="300"
                          ></textarea>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <div id="vertical" class="grid-cell--8 column-cell">
              <div class="grid-cell--12">
                <div class="grid-cell grid-cell--container">
                  <div class="grid-cell-header">
                    <div class="grid-cell-title-container">
                      <h3 class="grid-cell-title">
                        {{ componentData.componentId + ".items" | translate }}
                        ({{ itemsDisplayedRowNb !== undefined ? itemsDisplayedRowNb + " / " : ""
                        }}{{ items ? items.length : 0 }})
                      </h3>
                    </div>
                  </div>
                  <div class="grid-cell-content">
                    <p-table
                      [resizableColumns]="true"
                      #ptableItems
                      class="aw-table2"
                      [columns]="itemsTableCols"
                      [value]="items"
                      [(selection)]="selectedItems"
                      [scrollable]="true"
                      (onFilter)="onItemsFilter($event)"
                    >
                      <ng-template pTemplate="emptymessage">
                        <span *ngIf="!isLoadingItemTable"> &nbsp;</span>

                        <div *ngIf="isLoadingItemTable" class="aw-table-loading-indicator">
                          <div class="loading-message">{{ "table.loadingData" | translate }}</div>
                          <div class="lds-hourglass"></div>
                        </div>
                      </ng-template>

                      <ng-template pTemplate="caption">
                        <div class="aw-table-header" [ngClass]="{ 'rows-selected': selectedItems.length > 0 }">
                          <div class="aw-table-global-filter">
                            <label class="aw-table-global-filter-label">
                              <i class="fa fa-fw fa-search" aria-hidden="true"></i>
                            </label>

                            <input
                              #ptableItemsGlobalFilter
                              class="aw-table-global-filter-input"
                              type="text"
                              placeholder="{{ 'table.globalFilterText' | translate }}"
                              (input)="ptableItems.filterGlobal($event.target.value, 'contains')"
                            />
                          </div>

                          <div class="aw-table-actions">
                            <button
                              *ngIf="
                                planType === MAINTENANCE_PLAN.PLAN_TYPE_RMP &&
                                !disableMpEdit &&
                                !isReadOpenMode &&
                                selectedItems.length > 0
                              "
                              type="button"
                              mat-raised-button
                              (click)="deleteItem()"
                            >
                              {{ "global.delete" | translate }}
                            </button>

                            <!-- <button *ngIf="selectedItems.length === 1" type="button" mat-raised-button (click)="openItem()">
                        {{'global.open' | translate}}
                      </button> -->

                            <button
                              *ngIf="
                                planType === MAINTENANCE_PLAN.PLAN_TYPE_RMP &&
                                !disableMpEdit &&
                                !isReadOpenMode &&
                                selectedItems.length === 0
                              "
                              type="button"
                              mat-raised-button
                              (click)="createItem()"
                            >
                              {{ "global.add" | translate }}
                            </button>
                          </div>
                        </div>
                      </ng-template>

                      <ng-template pTemplate="colgroup" let-columns>
                        <colgroup>
                          <col class="aw-table-checkbox-wrapper" />
                          <col *ngFor="let col of columns" [ngStyle]="{ width: col.width }" />
                        </colgroup>
                      </ng-template>

                      <ng-template pTemplate="header" let-columns>
                        <tr>
                          <th class="aw-table-checkbox-wrapper">
                            <p-tableHeaderCheckbox class="aw-table-checkbox"></p-tableHeaderCheckbox>
                          </th>

                          <th pResizableColumn *ngFor="let col of columns" [ngStyle]="{ 'text-align': col.alignment }">
                            {{ componentData.componentId + "." + col.field | translate }}
                          </th>
                        </tr>
                      </ng-template>

                      <ng-template pTemplate="body" let-rowData let-columns="columns" let-rowIndex="rowIndex">
                        <tr [pSelectableRow]="rowData" [pSelectableRowIndex]="rowIndex">
                          <td class="aw-table-checkbox-wrapper">
                            <p-tableCheckbox class="aw-table-checkbox" [value]="rowData"></p-tableCheckbox>
                          </td>

                          <td
                            *ngFor="let col of columns"
                            [ngSwitch]="col.field"
                            [ngStyle]="{ 'text-align': col.alignment }"
                          >
                            <a *ngSwitchCase="'itemText'" (click)="openItemCode(rowData[col.field])">{{
                              rowData[col.field]
                            }}</a>

                            <span *ngSwitchDefault>
                              {{ rowData[col.field] }}
                            </span>
                          </td>
                        </tr>
                      </ng-template>
                    </p-table>
                  </div>
                </div>
              </div>
              <div class="grid-cell--12">
                <div class="grid-cell grid-cell--container">
                  <div class="grid-cell-header">
                    <div class="grid-cell-title-container">
                      <h3 class="grid-cell-title">
                        {{ componentData.componentId + ".parts" | translate }}
                        ({{ partsDisplayedRowNb !== undefined ? partsDisplayedRowNb + " / " : ""
                        }}{{ parts ? parts.length : 0 }})
                      </h3>
                    </div>
                  </div>
                  <div class="grid-cell-content">
                    <p-table
                      [resizableColumns]="true"
                      #ptableParts
                      class="aw-table2"
                      [columns]="partsTableCols"
                      [value]="parts"
                      [(selection)]="selectedParts"
                      [scrollable]="true"
                      (onFilter)="onPartsFilter($event)"
                    >
                      <ng-template pTemplate="emptymessage">
                        <span *ngIf="!isLoadingPartTable"> &nbsp;</span>

                        <div *ngIf="isLoadingPartTable" class="aw-table-loading-indicator">
                          <div class="loading-message">{{ "table.loadingData" | translate }}</div>
                          <div class="lds-hourglass"></div>
                        </div>
                      </ng-template>

                      <ng-template pTemplate="caption">
                        <div class="aw-table-header" [ngClass]="{ 'rows-selected': selectedParts.length > 0 }">
                          <div class="aw-table-global-filter">
                            <label class="aw-table-global-filter-label">
                              <i class="fa fa-fw fa-search" aria-hidden="true"></i>
                            </label>

                            <input
                              #ptablePartsGlobalFilter
                              class="aw-table-global-filter-input"
                              type="text"
                              placeholder="{{ 'table.globalFilterText' | translate }}"
                              (input)="ptableParts.filterGlobal($event.target.value, 'contains')"
                            />
                          </div>

                          <div class="aw-table-actions">
                            <button
                              *ngIf="
                                planType === MAINTENANCE_PLAN.PLAN_TYPE_RMP &&
                                !disableMpEdit &&
                                !isReadOpenMode &&
                                selectedParts.length > 0
                              "
                              type="button"
                              mat-raised-button
                              (click)="deletePart()"
                            >
                              {{ "global.delete" | translate }}
                            </button>

                            <!-- <button *ngIf="selectedParts.length === 1" type="button" mat-raised-button (click)="openPart()">
                        {{'global.open' | translate}}
                      </button> -->

                            <button
                              *ngIf="
                                planType === MAINTENANCE_PLAN.PLAN_TYPE_RMP &&
                                !isReadOpenMode &&
                                !disableMpEdit &&
                                selectedParts.length === 0
                              "
                              type="button"
                              mat-raised-button
                              (click)="createPart()"
                            >
                              {{ "global.add" | translate }}
                            </button>
                          </div>
                        </div>
                      </ng-template>

                      <ng-template pTemplate="colgroup" let-columns>
                        <colgroup>
                          <col class="aw-table-checkbox-wrapper" />
                          <col *ngFor="let col of columns" [ngStyle]="{ width: col.width }" />
                        </colgroup>
                      </ng-template>

                      <ng-template pTemplate="header" let-columns>
                        <tr>
                          <th class="aw-table-checkbox-wrapper">
                            <p-tableHeaderCheckbox class="aw-table-checkbox"></p-tableHeaderCheckbox>
                          </th>

                          <th pResizableColumn *ngFor="let col of columns" [ngStyle]="{ 'text-align': col.alignment }">
                            {{ componentData.componentId + "." + col.field | translate }}
                          </th>
                        </tr>
                      </ng-template>

                      <ng-template pTemplate="body" let-rowData let-columns="columns" let-rowIndex="rowIndex">
                        <tr [pSelectableRow]="rowData" [pSelectableRowIndex]="rowIndex">
                          <td class="aw-table-checkbox-wrapper">
                            <p-tableCheckbox class="aw-table-checkbox" [value]="rowData"></p-tableCheckbox>
                          </td>

                          <td
                            *ngFor="let col of columns"
                            [ngSwitch]="col.field"
                            [ngStyle]="{ 'text-align': col.alignment }"
                          >
                            <a *ngSwitchCase="'pnCode'" (click)="openPartCode(rowData[col.field], rowData['pnType'])">{{
                              rowData[col.field]
                            }}</a>

                            <span *ngSwitchDefault>
                              {{ rowData[col.field] }}
                            </span>
                          </td>
                        </tr>
                      </ng-template>
                    </p-table>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </mat-tab>

        <mat-tab>
          <ng-template mat-tab-label>
            {{ componentData.componentId + ".visitTaskTab" | translate }}
          </ng-template>
          <!-- Tasks -->
          <div class="grid-row">
            <div #taskAnchor class="grid-cell--12" (click)="setSelectedAnchor('taskAnchor')">
              <div class="grid-cell grid-cell--container" [ngClass]="{ active: isSelectedAnchor('taskAnchor') }">
                <div class="grid-cell-header">
                  <div class="grid-cell-title-container">
                    <h3 class="grid-cell-title">
                      {{ componentData.componentId + ".taskTab" | translate }}
                      ({{ tasksDisplayedRowNb !== undefined ? tasksDisplayedRowNb + " / " : ""
                      }}{{ tasks ? tasks.length : 0 }})
                    </h3>
                  </div>
                </div>

                <div class="grid-cell-content grid-cell-content-with-section">
                  <div class="section">
                    <div class="section-content">
                      <p-table
                        [resizableColumns]="true"
                        #ptableTask
                        class="aw-table2"
                        [columns]="taskTableCols"
                        [value]="tasks"
                        [(selection)]="selectedTasks"
                        [scrollable]="true"
                        (onRowSelect)="checkTasks()"
                        dataKey="dataKey"
                        (onRowUnselect)="checkTasks()"
                        (onHeaderCheckboxToggle)="checkTasks()"
                        (onFilter)="onTasksFilter($event)"
                        [paginator]="true"
                        [rows]="NUMBER_OF_ROWS"
                      >
                        <ng-template pTemplate="emptymessage">
                          <span *ngIf="!isLoadingTaskTable"> &nbsp;</span>

                          <div *ngIf="isLoadingTaskTable" class="aw-table-loading-indicator">
                            <div class="loading-message">{{ "table.loadingData" | translate }}</div>
                            <div class="lds-hourglass"></div>
                          </div>
                        </ng-template>

                        <ng-template pTemplate="caption">
                          <div class="aw-table-header" [ngClass]="{ 'rows-selected': selectedTasks.length > 0 }">
                            <div class="aw-table-global-filter">
                              <label class="aw-table-global-filter-label">
                                <i class="fa fa-fw fa-search" aria-hidden="true"></i>
                              </label>

                              <input
                                #ptableTaskGlobalFilter
                                class="aw-table-global-filter-input"
                                type="text"
                                placeholder="{{ 'table.globalFilterText' | translate }}"
                                (input)="ptableTask.filterGlobal($event.target.value, 'contains')"
                              />
                            </div>

                            <div class="aw-table-actions">
                              <button
                                *ngIf="
                                  !isReadOpenMode && !disableMpEdit && selectedTasks.length > 0 && enableTaskDelete
                                "
                                type="button"
                                color="warn"
                                mat-raised-button
                                (click)="deleteTaskVisit('task')"
                              >
                                {{ "global.delete" | translate }}
                              </button>

                              <button
                                *ngIf="!isReadOpenMode && !disableMpEdit && selectedTasks.length === 1"
                                type="button"
                                mat-raised-button
                                (click)="generateTaskComment()"
                              >
                                {{ componentData.componentId + ".generateComment" | translate }}
                              </button>

                              <button
                                *ngIf="!isReadOpenMode && !disableMpEdit && selectedTasks.length === 1"
                                type="button"
                                mat-raised-button
                                (click)="editTaskVisit('task')"
                              >
                                {{ "global.edit" | translate }}
                              </button>

                              <button
                                *ngIf="selectedTasks.length === 1"
                                type="button"
                                mat-raised-button
                                (click)="openTaskVisit('task')"
                              >
                                {{ "global.open" | translate }}
                              </button>

                              <button
                                *ngIf="
                                  !isReadOpenMode &&
                                  (planType === MAINTENANCE_PLAN.PLAN_TYPE_AMP || !disableMpEdit) &&
                                  selectedTasks.length === 0
                                "
                                type="button"
                                mat-raised-button
                                (click)="createTaskVisit('task')"
                              >
                                {{ "global.add" | translate }}
                              </button>
                            </div>
                          </div>
                        </ng-template>

                        <ng-template pTemplate="colgroup" let-columns>
                          <colgroup>
                            <col class="aw-table-checkbox-wrapper" [ngStyle]="{ width: '2.5rem' }" />
                            <col *ngFor="let col of columns" [ngStyle]="{ width: col.width }" />
                            <col [ngStyle]="{ width: '5%', 'text-align': 'left' }" />
                          </colgroup>
                        </ng-template>

                        <ng-template pTemplate="header" let-columns>
                          <tr>
                            <th class="aw-table-checkbox-wrapper" [ngStyle]="{ width: '2.5rem' }">
                              <p-tableHeaderCheckbox class="aw-table-checkbox"></p-tableHeaderCheckbox>
                            </th>

                            <th
                              pResizableColumn
                              *ngFor="let col of columns"
                              [ngStyle]="{ 'text-align': col.alignment, width: col.width }"
                            >
                              {{ componentData.componentId + "." + col.field | translate }}
                            </th>
                            <th [ngStyle]="{ width: '5%', 'text-align': 'left' }"></th>
                          </tr>
                        </ng-template>

                        <ng-template pTemplate="body" let-rowData let-columns="columns" let-rowIndex="rowIndex">
                          <tr [pSelectableRow]="rowData" [pSelectableRowIndex]="rowIndex">
                            <td class="aw-table-checkbox-wrapper" [ngStyle]="{ width: '2.5rem' }">
                              <p-tableCheckbox class="aw-table-checkbox" [value]="rowData"></p-tableCheckbox>
                            </td>

                            <ng-container *ngFor="let col of columns">
                              <td
                                *ngIf="col.field === 'taskCode'"
                                [attr.rowspan]="rowData['rowSpan']"
                                [ngStyle]="{ 'text-align': col.alignment, width: col.width }"
                              >
                                <a
                                  (click)="
                                    openVisitOrTaskCode(rowData['planTaskCounterTableDTO'], rowData['taskTypeCode'])
                                  "
                                  >{{ rowData[col.field] }}</a
                                >
                              </td>

                              <td
                                *ngIf="col.field === 'version'"
                                [attr.rowspan]="rowData['rowSpan']"
                                [ngStyle]="{ 'text-align': col.alignment, width: col.width }"
                              >
                                {{ rowData[col.field] }}
                              </td>

                              <td
                                *ngIf="col.field === 'designation'"
                                [attr.rowspan]="rowData['rowSpan']"
                                [ngStyle]="{ 'text-align': col.alignment, width: col.width }"
                              >
                                {{ rowData[col.field] }}
                              </td>

                              <td
                                *ngIf="col.field === 'compliance'"
                                [attr.rowspan]="rowData['rowSpan']"
                                [ngStyle]="{ 'text-align': col.alignment, width: col.width }"
                              >
                                <span
                                  *ngIf="rowData[col.field] === COMPLIANCE_GREEN"
                                  class="airworthiness-alert airworthiness-alert--ok"
                                >
                                  {{ "global.alertOk" | translate }}
                                </span>

                                <span
                                  *ngIf="rowData[col.field] === COMPLIANCE_RED"
                                  class="airworthiness-alert airworthiness-alert--nok"
                                  pTooltip="{{ rowData['complianceDetail'] || '' }}"
                                >
                                  {{ "global.alertNok" | translate }}
                                </span>
                              </td>

                              <td
                                *ngIf="
                                  col.field !== 'taskCode' &&
                                  col.field !== 'version' &&
                                  col.field !== 'designation' &&
                                  col.field !== 'compliance'
                                "
                                [ngStyle]="{ 'text-align': col.alignment, width: col.width }"
                              >
                                {{ rowData[col.field] }}
                              </td>
                            </ng-container>
                            <td
                              class="row-expand-wrapper"
                              [pRowToggler]="rowData"
                              [ngStyle]="{ width: '5%', 'text-align': 'left' }"
                            >
                              <i
                                class="fa fa-fw aw-icon aw-icon-with-border"
                                [ngClass]="rowData.expand ? 'fa-minus' : 'fa-plus'"
                                aria-hidden="true"
                                pTooltip="{{ 'global.showTableRowDetails' | translate }}"
                                tooltipPosition="top"
                                (click)="toggleRowDetailsVisibility(rowData)"
                              ></i>
                            </td>
                          </tr>
                          <tr *ngIf="rowData.expand" class="row-expanded">
                            <td [attr.colspan]="columns.length + 2">
                              <div class="column forced-backgroung">
                                <div class="row">
                                  <div class="form-group flex--1">
                                    <label class="form-label">
                                      {{ getComponentName() + "." + "taskType" | translate }}
                                    </label>

                                    <div class="form-control">
                                      <input
                                        type="text"
                                        class="aw-input"
                                        maxlength="50"
                                        [(ngModel)]="rowData.taskType"
                                        [disabled]="true"
                                      />
                                    </div>
                                  </div>

                                  <div class="form-group flex--1">
                                    <label class="form-label">
                                      {{ getComponentName() + "." + "groupCode" | translate }}
                                    </label>

                                    <div class="form-control">
                                      <input
                                        type="text"
                                        class="aw-input"
                                        maxlength="50"
                                        [(ngModel)]="rowData.groupCode"
                                        [disabled]="true"
                                      />
                                    </div>
                                  </div>

                                  <div class="form-group flex--1">
                                    <label class="form-label">
                                      {{ getComponentName() + "." + "firstPeriodicity" | translate }}
                                    </label>

                                    <div class="form-control">
                                      <input
                                        type="text"
                                        class="aw-input"
                                        maxlength="50"
                                        [(ngModel)]="rowData.firstPeriodicity"
                                        [disabled]="true"
                                      />
                                    </div>
                                  </div>

                                  <div class="form-group flex--1">
                                    <label class="form-label">
                                      {{ getComponentName() + "." + "periodicityType" | translate }}
                                    </label>

                                    <div class="form-control">
                                      <input
                                        type="text"
                                        class="aw-input"
                                        maxlength="50"
                                        [(ngModel)]="rowData.periodicityType"
                                        [disabled]="true"
                                      />
                                    </div>
                                  </div>
                                </div>

                                <div class="row">
                                  <div class="form-group flex--1">
                                    <label class="form-label">
                                      {{ getComponentName() + "." + "tolerance" | translate }}
                                    </label>

                                    <div class="form-control">
                                      <input
                                        type="text"
                                        class="aw-input"
                                        maxlength="50"
                                        [(ngModel)]="rowData.tolerance"
                                        [disabled]="true"
                                      />
                                    </div>
                                  </div>

                                  <div class="form-group flex--1">
                                    <label *ngIf="isUnitFh" class="form-label">
                                      {{ getComponentName() + "." + "alertThreshold" | translate }}
                                      {{ "(" + rowData.unit + ")" }}
                                    </label>
                                    <label *ngIf="!isUnitFh" class="form-label">
                                      {{ getComponentName() + "." + "alertThreshold" | translate }} {{ "(%)" }}
                                    </label>
                                    <div class="form-control">
                                      <input
                                        type="text"
                                        class="aw-input"
                                        maxlength="50"
                                        [(ngModel)]="rowData.alertThreshold"
                                        [disabled]="true"
                                      />
                                    </div>
                                  </div>

                                  <div class="form-group flex--1">
                                    <label class="form-label">
                                      {{ getComponentName() + "." + "comments" | translate }}
                                    </label>

                                    <div class="form-control">
                                      <input
                                        type="text"
                                        class="aw-input"
                                        maxlength="50"
                                        [(ngModel)]="rowData.comments"
                                        [disabled]="true"
                                      />
                                    </div>
                                  </div>

                                  <div class="form-group flex--1"></div>
                                </div>
                              </div>

                              <!-- <div class="row">


                                <p-table [resizableColumns]="true" #ptable class="aw-table2" [columns]="remainingTaskTableCols" [value]="rowData.childRow">
                                  <ng-template pTemplate="colgroup" let-columns>
                                    <colgroup>
                                      <col *ngFor="let col of columns" [ngStyle]="{ width: col.width }" />
                                    </colgroup>
                                  </ng-template>

                                  <ng-template pTemplate="header" let-columns>
                                    <tr>
                                      <th pResizableColumn *ngFor="let col of columns" [ngStyle]="{ 'text-align': col.alignment, width: col.width }">
                                        {{ getComponentName() + "." + col.field | translate }}
                                      </th>
                                    </tr>
                                    <tr>
                                      <th pResizableColumn *ngFor="let col of columns" [ngStyle]="{ 'text-align': col.alignment, 'font-weight': 'bold', width: col.width }">
                                        {{ rowData[col.field] }}
                                      </th>
                                    </tr>
                                  </ng-template>
                                </p-table>

                                <p-table [resizableColumns]="true" #ptable class="aw-table2" [columns]="remainingTaskTableCols1" [value]="rowData.childRow">
                                  <ng-template pTemplate="colgroup" let-columns>
                                    <colgroup>
                                      <col *ngFor="let col of columns" [ngStyle]="{ width: col.width }" />
                                    </colgroup>
                                  </ng-template>

                                  <ng-template pTemplate="header" let-columns>
                                    <tr>
                                      <th pResizableColumn *ngFor="let col of columns" [ngStyle]="{ 'text-align': col.alignment, 'width': col.width }">
                                        {{ getComponentName() + "." + col.field | translate }}
                                      </th>
                                      <th></th>
                                    </tr>
                                    <tr>
                                      <th pResizableColumn *ngFor="let col of columns" [ngStyle]="{ 'text-align': col.alignment, 'font-weight': 'bold', 'width': col.width }">
                                        {{ rowData[col.field] }}
                                      </th>
                                      <th></th>
                                    </tr>
                                  </ng-template>
                                </p-table>


                              </div> -->
                            </td>
                          </tr>
                        </ng-template>
                      </p-table>
                    </div>
                  </div>

                  <div *ngIf="removedTasks.length > 0" class="section">
                    <h4 class="section-title">
                      {{ componentData.componentId + ".removedTaskHeading" | translate }}
                      ({{ removedTasksDisplayedRowNb !== undefined ? removedTasksDisplayedRowNb + " / " : ""
                      }}{{ removedTasks ? removedTasks.length : 0 }})
                    </h4>

                    <div class="section-content">
                      <p-table
                        [resizableColumns]="true"
                        #ptableRemovedTask
                        class="aw-table2"
                        [columns]="removedTaskTableCols"
                        [value]="removedTasks"
                        [(selection)]="selectedRemovedTasks"
                        [scrollable]="true"
                        (onFilter)="onRemovedTasksFilter($event)"
                      >
                        <ng-template pTemplate="emptymessage">
                          <span *ngIf="!isLoadingRemovedTaskTabble"> &nbsp;</span>

                          <div *ngIf="isLoadingRemovedTaskTabble" class="aw-table-loading-indicator">
                            <div class="loading-message">{{ "table.loadingData" | translate }}</div>
                            <div class="lds-hourglass"></div>
                          </div>
                        </ng-template>

                        <ng-template pTemplate="caption">
                          <div class="aw-table-header" [ngClass]="{ 'rows-selected': selectedRemovedTasks.length > 0 }">
                            <div class="aw-table-global-filter">
                              <label class="aw-table-global-filter-label">
                                <i class="fa fa-fw fa-search" aria-hidden="true"></i>
                              </label>

                              <input
                                #ptableRemovedTaskGlobalFilter
                                class="aw-table-global-filter-input"
                                type="text"
                                placeholder="{{ 'table.globalFilterText' | translate }}"
                                (input)="ptableRemovedTask.filterGlobal($event.target.value, 'contains')"
                              />
                            </div>

                            <div class="aw-table-actions">
                              <button
                                *ngIf="!isReadOpenMode && selectedRemovedTasks.length > 0"
                                type="button"
                                mat-raised-button
                                (click)="addMissingTasks()"
                              >
                                {{ "global.add" | translate }}
                              </button>
                            </div>
                          </div>
                        </ng-template>

                        <ng-template pTemplate="colgroup" let-columns>
                          <colgroup>
                            <col class="aw-table-checkbox-wrapper" />
                            <col *ngFor="let col of columns" [ngStyle]="{ width: col.width }" />
                          </colgroup>
                        </ng-template>

                        <ng-template pTemplate="header" let-columns>
                          <tr>
                            <th class="aw-table-checkbox-wrapper">
                              <p-tableHeaderCheckbox class="aw-table-checkbox"></p-tableHeaderCheckbox>
                            </th>

                            <th
                              pResizableColumn
                              *ngFor="let col of columns"
                              [ngStyle]="{ 'text-align': col.alignment }"
                            >
                              {{ componentData.componentId + "." + col.field | translate }}
                            </th>
                          </tr>
                        </ng-template>

                        <ng-template pTemplate="body" let-rowData let-columns="columns" let-rowIndex="rowIndex">
                          <tr [pSelectableRow]="rowData" [pSelectableRowIndex]="rowIndex">
                            <td class="aw-table-checkbox-wrapper">
                              <p-tableCheckbox class="aw-table-checkbox" [value]="rowData"></p-tableCheckbox>
                            </td>

                            <ng-container *ngFor="let col of columns">
                              <td
                                *ngIf="col.field === 'taskCode'"
                                [attr.rowspan]="rowData['rowSpan']"
                                [ngStyle]="{ 'text-align': col.alignment }"
                              >
                                <a
                                  (click)="
                                    openVisitOrTaskCode(rowData['planTaskCounterTableDTO'], rowData['taskTypeCode'])
                                  "
                                  >{{ rowData[col.field] }}</a
                                >
                              </td>

                              <td
                                *ngIf="col.field === 'version'"
                                [attr.rowspan]="rowData['rowSpan']"
                                [ngStyle]="{ 'text-align': col.alignment }"
                              >
                                {{ rowData[col.field] }}
                              </td>

                              <td
                                *ngIf="col.field === 'designation'"
                                [attr.rowspan]="rowData['rowSpan']"
                                [ngStyle]="{ 'text-align': col.alignment }"
                              >
                                {{ rowData[col.field] }}
                              </td>

                              <td
                                *ngIf="
                                  col.field !== 'taskCode' && col.field !== 'version' && col.field !== 'designation'
                                "
                                [ngStyle]="{ 'text-align': col.alignment }"
                              >
                                {{ rowData[col.field] }}
                              </td>
                            </ng-container>
                          </tr>
                        </ng-template>
                      </p-table>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Visit -->
          <div class="grid-row">
            <div class="grid-cell--12" #visitAnchor class="grid-cell--12" (click)="setSelectedAnchor('visitAnchor')">
              <div class="grid-cell grid-cell--container" [ngClass]="{ active: isSelectedAnchor('visitAnchor') }">
                <div class="grid-cell-header">
                  <div class="grid-cell-title-container">
                    <h3 class="grid-cell-title">
                      {{ componentData.componentId + ".visitTab" | translate }}
                      ({{ visitsDisplayedRowNb !== undefined ? visitsDisplayedRowNb + " / " : ""
                      }}{{ visits ? visits.length : 0 }})
                    </h3>
                  </div>
                </div>

                <div class="grid-cell-content grid-cell-content-with-section">
                  <div class="section">
                    <div class="section-content">
                      <p-table
                        [resizableColumns]="true"
                        #ptableVisit
                        class="aw-table2"
                        [columns]="visitTableCols"
                        [value]="visits"
                        [(selection)]="selectedVisits"
                        dataKey="visitbloc"
                        [scrollable]="true"
                        (onRowSelect)="checkVisits()"
                        (onRowUnselect)="checkVisits()"
                        (onHeaderCheckboxToggle)="checkVisits()"
                        (onFilter)="onVisitsFilter($event)"
                        [paginator]="true"
                        [rows]="NUMBER_OF_ROWS"
                      >
                        <ng-template pTemplate="emptymessage">
                          <span *ngIf="!isLoadingVisitTable"> &nbsp;</span>
                          <div *ngIf="isLoadingVisitTable" class="aw-table-loading-indicator">
                            <div class="loading-message">{{ "table.loadingData" | translate }}</div>
                            <div class="lds-hourglass"></div>
                          </div>
                        </ng-template>

                        <ng-template pTemplate="caption">
                          <div class="aw-table-header" [ngClass]="{ 'rows-selected': selectedVisits.length > 0 }">
                            <div class="aw-table-global-filter">
                              <label class="aw-table-global-filter-label">
                                <i class="fa fa-fw fa-search" aria-hidden="true"></i>
                              </label>

                              <input
                                #ptableVisitGlobalFilter
                                class="aw-table-global-filter-input"
                                type="text"
                                placeholder="{{ 'table.globalFilterText' | translate }}"
                                (input)="ptableVisit.filterGlobal($event.target.value, 'contains')"
                              />
                            </div>

                            <div class="aw-table-actions">
                              <button
                                *ngIf="
                                  !isReadOpenMode && !disableMpEdit && selectedVisits.length > 0 && enableVisitDelete
                                "
                                type="button"
                                color="warn"
                                mat-raised-button
                                (click)="deleteTaskVisit('visit')"
                              >
                                {{ "global.delete" | translate }}
                              </button>

                              <button
                                *ngIf="!isReadOpenMode && !disableMpEdit && selectedVisits.length === 1"
                                type="button"
                                mat-raised-button
                                (click)="editTaskVisit('visit')"
                              >
                                {{ "global.edit" | translate }}
                              </button>

                              <button
                                *ngIf="selectedVisits.length === 1"
                                type="button"
                                mat-raised-button
                                (click)="openTaskVisit('visit')"
                              >
                                {{ "global.open" | translate }}
                              </button>

                              <button
                                *ngIf="!isReadOpenMode && !disableMpEdit && selectedVisits.length === 0"
                                type="button"
                                mat-raised-button
                                (click)="createTaskVisit('visit')"
                              >
                                {{ "global.add" | translate }}
                              </button>
                            </div>
                          </div>
                        </ng-template>

                        <ng-template pTemplate="colgroup" let-columns>
                          <colgroup>
                            <col class="aw-table-checkbox-wrapper" [ngStyle]="{ width: '2.5rem' }" />
                            <col
                              *ngFor="let col of columns"
                              [ngStyle]="{ 'text-align': col.alignment, width: col.width }"
                            />
                            <col [ngStyle]="{ width: '5%', 'text-align': 'left' }" />
                          </colgroup>
                        </ng-template>

                        <ng-template pTemplate="header" let-columns>
                          <tr>
                            <th class="aw-table-checkbox-wrapper" [ngStyle]="{ width: '2.5rem' }">
                              <p-tableHeaderCheckbox class="aw-table-checkbox"></p-tableHeaderCheckbox>
                            </th>

                            <th
                              pResizableColumn
                              *ngFor="let col of columns"
                              [ngStyle]="{ 'text-align': col.alignment, width: col.width }"
                            >
                              {{ componentData.componentId + "." + col.field | translate }}
                            </th>
                            <th [ngStyle]="{ width: '5%', 'text-align': 'left' }"></th>
                          </tr>
                        </ng-template>

                        <ng-template pTemplate="body" let-rowData let-columns="columns" let-rowIndex="rowIndex">
                          <tr [pSelectableRow]="rowData" [pSelectableRowIndex]="rowIndex">
                            <td class="aw-table-checkbox-wrapper" [ngStyle]="{ width: '2.5rem' }">
                              <p-tableCheckbox class="aw-table-checkbox" [value]="rowData"></p-tableCheckbox>
                            </td>

                            <td
                              *ngFor="let col of columns"
                              [ngStyle]="{ 'text-align': col.alignment, width: col.width }"
                            >
                              <span *ngIf="col.field === 'visitCode'" [attr.rowspan]="rowData['rowSpan']">
                                <i
                                  [pRowToggler]="rowData"
                                  [ngClass]="rowData.expand ? 'fa fa-fw fa-chevron-down' : 'fa fa-fw fa-chevron-right'"
                                  (click)="toggleRowDetailsVisibility(rowData)"
                                ></i>
                                <a
                                  (click)="
                                    openVisitOrTaskCode(rowData['planTaskCounterTableDTO'], rowData['taskTypeCode'])
                                  "
                                  >{{ rowData[col.field] }}</a
                                >
                              </span>

                              <span *ngIf="col.field === 'visitVersion'" [attr.rowspan]="rowData['rowSpan']">
                                {{ rowData[col.field] }}
                              </span>

                              <span *ngIf="col.field === 'visitDesignation'" [attr.rowspan]="rowData['rowSpan']">
                                {{ rowData[col.field] }}
                              </span>

                              <span *ngIf="col.field === 'compliance'" [attr.rowspan]="rowData['rowSpan']">
                                <span
                                  *ngIf="rowData[col.field] === COMPLIANCE_GREEN"
                                  class="airworthiness-alert airworthiness-alert--ok"
                                >
                                  {{ "global.alertOk" | translate }}
                                </span>

                                <span
                                  *ngIf="rowData[col.field] === COMPLIANCE_RED"
                                  class="airworthiness-alert airworthiness-alert--nok"
                                  pTooltip="{{ rowData['complianceDetail'] || '' }}"
                                >
                                  {{ "global.alertNok" | translate }}
                                </span>
                              </span>

                              <span
                                *ngIf="
                                  col.field !== 'visitCode' &&
                                  col.field !== 'visitVersion' &&
                                  col.field !== 'visitDesignation' &&
                                  col.field !== 'compliance'
                                "
                              >
                                {{ rowData[col.field] }}
                              </span>
                            </td>
                            <td class="row-expand-wrapper" [ngStyle]="{ width: '5%', 'text-align': 'left' }">
                              <i
                                [pRowToggler]="rowData"
                                class="fa fa-fw aw-icon aw-icon-with-border"
                                [ngClass]="rowData.showMore ? 'fa-minus' : 'fa-plus'"
                                aria-hidden="true"
                                pTooltip="{{ 'global.showTableRowDetails' | translate }}"
                                tooltipPosition="top"
                                (click)="toggleShowMoreRowDetailsVisibility(rowData)"
                              ></i>
                            </td>
                          </tr>
                          <ng-container *ngIf="rowData['showMore']">
                            <tr class="row-expanded">
                              <td [attr.colspan]="columns.length + 2">
                                <div class="row">
                                  <p-table
                                    [resizableColumns]="true"
                                    #ptable
                                    class="aw-table2"
                                    [columns]="remainingVisitTableCols"
                                    [value]="rowData.childRow"
                                  >
                                    <ng-template pTemplate="colgroup" let-columns>
                                      <colgroup>
                                        <col *ngFor="let col of columns" [ngStyle]="{ width: col.width }" />
                                      </colgroup>
                                    </ng-template>

                                    <ng-template pTemplate="header" let-columns>
                                      <tr>
                                        <th
                                          pResizableColumn
                                          *ngFor="let col of columns"
                                          [ngStyle]="{ 'text-align': col.alignment }"
                                        >
                                          {{ getComponentName() + "." + col.field | translate }}
                                        </th>
                                      </tr>
                                      <tr>
                                        <th
                                          pResizableColumn
                                          *ngFor="let col of columns"
                                          [ngStyle]="{ 'text-align': col.alignment, 'font-weight': 'bold' }"
                                        >
                                          {{ rowData[col.field] }}
                                        </th>
                                      </tr>
                                    </ng-template>
                                  </p-table>
                                  <p-table
                                    [resizableColumns]="true"
                                    #ptable
                                    class="aw-table2"
                                    [columns]="remainingVisitTableCols1"
                                    [value]="rowData.childRow"
                                  >
                                    <ng-template pTemplate="colgroup" let-columns>
                                      <colgroup>
                                        <col *ngFor="let col of columns" [ngStyle]="{ width: col.width }" />
                                      </colgroup>
                                    </ng-template>

                                    <ng-template pTemplate="header" let-columns>
                                      <tr>
                                        <th
                                          pResizableColumn
                                          *ngFor="let col of columns"
                                          [ngStyle]="{ 'text-align': col.alignment, width: col.width }"
                                        >
                                          {{ getComponentName() + "." + col.field | translate }}
                                          <label *ngIf="col.field == alertThreshold && isUnitFh">{{
                                            "(" + rowData.unit + ")"
                                          }}</label>
                                          <label *ngIf="col.field == alertThreshold && !isUnitFh">{{ "(%)" }}</label>
                                        </th>
                                        <th></th>
                                      </tr>
                                      <tr>
                                        <th
                                          pResizableColumn
                                          *ngFor="let col of columns"
                                          [ngStyle]="{
                                            'text-align': col.alignment,
                                            'font-weight': 'bold',
                                            width: col.width
                                          }"
                                        >
                                          {{ rowData[col.field] }}
                                        </th>
                                        <th></th>
                                      </tr>
                                    </ng-template>
                                  </p-table>
                                </div>
                              </td>
                            </tr>
                          </ng-container>
                          <ng-container *ngIf="rowData['expand']">
                            <ng-container *ngFor="let task of rowData.visitTasks">
                              <tr *ngIf="task.taskCode && task.taskCode !== rowData.visitCode">
                                <td></td>
                                <td>{{ task.taskCode }}</td>
                                <td>{{ task.version }}</td>
                                <td>{{ task.designation }}</td>
                                <td [attr.colspan]="columns.length - 3">{{ task.taskType }}</td>
                              </tr>
                            </ng-container>
                          </ng-container>
                        </ng-template>
                      </p-table>
                    </div>
                  </div>

                  <div *ngIf="removedVisits.length > 0" class="section">
                    <h4 class="section-title">
                      {{ componentData.componentId + ".removedVisitHeading" | translate }}
                      ({{ removedVisitsDisplayedRowNb !== undefined ? removedVisitsDisplayedRowNb + " / " : ""
                      }}{{ removedVisits ? removedVisits.length : 0 }})
                    </h4>

                    <div class="section-content">
                      <p-table
                        [resizableColumns]="true"
                        #ptableRemovedVisit
                        class="aw-table2"
                        [columns]="removedVisitTableCols"
                        [value]="removedVisits"
                        [(selection)]="selectedRemovedVisits"
                        dataKey="visitbloc"
                        [scrollable]="true"
                        (onFilter)="onRemovedVisitsFilter($event)"
                      >
                        <ng-template pTemplate="emptymessage">
                          <span *ngIf="!isLoadingRemovedVisitTable"> &nbsp;</span>

                          <div *ngIf="isLoadingRemovedVisitTable" class="aw-table-loading-indicator">
                            <div class="loading-message">{{ "table.loadingData" | translate }}</div>
                            <div class="lds-hourglass"></div>
                          </div>
                        </ng-template>

                        <ng-template pTemplate="caption">
                          <div
                            class="aw-table-header"
                            [ngClass]="{ 'rows-selected': selectedRemovedVisits.length > 0 }"
                          >
                            <div class="aw-table-global-filter">
                              <label class="aw-table-global-filter-label">
                                <i class="fa fa-fw fa-search" aria-hidden="true"></i>
                              </label>

                              <input
                                #ptableRemovedVisitGlobalFilter
                                class="aw-table-global-filter-input"
                                type="text"
                                placeholder="{{ 'table.globalFilterText' | translate }}"
                                (input)="ptableRemovedVisit.filterGlobal($event.target.value, 'contains')"
                              />
                            </div>

                            <div class="aw-table-actions">
                              <button
                                *ngIf="!isReadOpenMode && selectedRemovedVisits.length > 0"
                                type="button"
                                mat-raised-button
                                (click)="addMissingVisits()"
                              >
                                {{ "global.add" | translate }}
                              </button>
                            </div>
                          </div>
                        </ng-template>

                        <ng-template pTemplate="colgroup" let-columns>
                          <colgroup>
                            <col class="aw-table-checkbox-wrapper" />
                            <col *ngFor="let col of columns" [ngStyle]="{ width: col.width }" />
                          </colgroup>
                        </ng-template>

                        <ng-template pTemplate="header" let-columns>
                          <tr>
                            <th class="aw-table-checkbox-wrapper">
                              <p-tableHeaderCheckbox class="aw-table-checkbox"></p-tableHeaderCheckbox>
                            </th>

                            <th
                              pResizableColumn
                              *ngFor="let col of columns"
                              [ngStyle]="{ 'text-align': col.alignment, width: col.width }"
                            >
                              {{ componentData.componentId + "." + col.field | translate }}
                            </th>
                          </tr>
                        </ng-template>

                        <ng-template
                          pTemplate="body"
                          let-rowData
                          let-expanded="expanded"
                          let-columns="columns"
                          let-rowIndex="rowIndex"
                        >
                          <tr [pSelectableRow]="rowData" [pSelectableRowIndex]="rowIndex">
                            <td class="aw-table-checkbox-wrapper">
                              <p-tableCheckbox class="aw-table-checkbox" [value]="rowData"></p-tableCheckbox>
                            </td>

                            <td *ngFor="let col of columns">
                              <span
                                *ngIf="col.field === 'visitCode'"
                                [attr.rowspan]="rowData['rowSpan']"
                                [ngStyle]="{ 'text-align': col.alignment }"
                              >
                                <i
                                  [pRowToggler]="rowData"
                                  [ngClass]="expanded ? 'fa fa-fw fa-chevron-down' : 'fa fa-fw fa-chevron-right'"
                                ></i>
                                <a
                                  (click)="
                                    openVisitOrTaskCode(rowData['planTaskCounterTableDTO'], rowData['taskTypeCode'])
                                  "
                                  >{{ rowData[col.field] }}</a
                                >
                              </span>

                              <span
                                *ngIf="col.field === 'visitVersion'"
                                [attr.rowspan]="rowData['rowSpan']"
                                [ngStyle]="{ 'text-align': col.alignment }"
                              >
                                {{ rowData[col.field] }}
                              </span>

                              <span
                                *ngIf="col.field === 'visitDesignation'"
                                [attr.rowspan]="rowData['rowSpan']"
                                [ngStyle]="{ 'text-align': col.alignment }"
                              >
                                {{ rowData[col.field] }}
                              </span>

                              <span
                                *ngIf="
                                  col.field !== 'visitCode' &&
                                  col.field !== 'visitVersion' &&
                                  col.field !== 'visitDesignation' &&
                                  col.field !== 'compliance'
                                "
                                [ngStyle]="{ 'text-align': col.alignment }"
                              >
                                {{ rowData[col.field] }}
                              </span>
                            </td>
                          </tr>
                        </ng-template>

                        <ng-template pTemplate="rowexpansion" let-rowData let-rowIndex="rowIndex" let-columns="columns">
                          <ng-container *ngFor="let task of rowData.visitTasks">
                            <tr *ngIf="task.taskCode && task.taskCode !== rowData.visitCode">
                              <td></td>
                              <td>{{ task.taskCode }}</td>
                              <td>{{ task.version }}</td>
                              <td>{{ task.designation }}</td>
                              <td [attr.colspan]="columns.length - 3">{{ task.taskType }}</td>
                            </tr>
                          </ng-container>
                        </ng-template>
                      </p-table>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </mat-tab>

        <mat-tab>
          <ng-template mat-tab-label>
            <ng-container *ngIf="dynamicAttributesForMaintenancePlan && dynamicAttributesForMaintenancePlan.length > 0">
              {{ "attributes" | translate }} &amp;
            </ng-container>
            {{ "documents" | translate }}
          </ng-template>
          <!-- Document Import -->
          <div class="grid-row" *ngIf="dynamicAttributesForMaintenancePlan.length > 0">
            <div class="grid-cell--12">
              <div class="grid-cell grid-cell--container">
                <div class="grid-cell-content grid-cell-content-with-section">
                  <aw-dynamic-attributes
                    [attributes]="dynamicAttributesForMaintenancePlan"
                    [isReadOpenMode]="isReadOpenMode"
                  ></aw-dynamic-attributes>
                </div>
              </div>
            </div>
          </div>
          <div class="grid-row">
            <div class="grid-cell--12">
              <div
                #documentsAnchor
                class="grid-cell grid-cell--container"
                [ngClass]="{ active: isSelectedAnchor('documentsAnchor') }"
              >
                <div class="grid-cell-header">
                  <div class="grid-cell-title-container">
                    <h3 class="grid-cell-title">
                      {{ componentData.componentId + ".documents" | translate }} ({{
                        documentsTableDataSource.hasData ? documentsTableDataSource.dataCount : 0
                      }})
                    </h3>
                  </div>
                </div>

                <div class="grid-cell-content">
                  <a-table [dataSource]="documentsTableDataSource">
                    <ng-template tableActionsDef>
                      <button
                        *ngIf="documentsTableDataSource.hasDataSelection"
                        type="button"
                        mat-raised-button
                        color="warn"
                        (click)="deleteDocuments()"
                      >
                        {{ "global.delete" | translate }}
                      </button>

                      <button
                        *ngIf="documentsTableDataSource.dataSelectionCount === 1"
                        type="button"
                        mat-raised-button
                        (click)="editDocument()"
                      >
                        {{ "global.edit" | translate }}
                      </button>

                      <button
                        *ngIf="documentsTableDataSource.dataSelectionCount === 1"
                        type="button"
                        mat-raised-button
                        (click)="openDocument()"
                      >
                        {{ "global.open" | translate }}
                      </button>

                      <button
                        *ngIf="!documentsTableDataSource.hasDataSelection"
                        type="button"
                        mat-raised-button
                        (click)="addDocument()"
                      >
                        {{ "global.add" | translate }}
                      </button>

                      <button
                        *ngIf="showSaveDocumentPlanBtn()"
                        color="primary"
                        type="button"
                        mat-raised-button
                        (click)="saveDocPlans()"
                      >
                        {{ "global.save" | translate }}
                      </button>
                    </ng-template>

                    <ng-template columnDef="docName" let-rowData="rowData">
                      <a (click)="downloadFile(rowData)">{{ rowData.docName }}</a>
                    </ng-template>
                  </a-table>
                </div>
              </div>
            </div>
          </div>
        </mat-tab>
      </mat-tab-group>
    </div>
  </div>

  <!-- <aw-item-popup-form *ngIf="showItemPopup" [(display)]="showItemPopup" [isReadOnlyForm]="isReadOnlyItemDialog"
  [component-data]="dataItem" (onAssociated)="saveItem($event)"></aw-item-popup-form> -->

  <!-- <aw-part-popup-form *ngIf="showPartPopup" [(display)]="showPartPopup" [isReadOnlyForm]="isReadOnlyPartDialog"
  [component-data]="dataPart" (onAssociated)="savePart($event)"></aw-part-popup-form> -->

  <aw-task-visit-popup-form
    *ngIf="showVisitTaskPopup"
    [(display)]="showVisitTaskPopup"
    [isReadOnlyForm]="isReadOnlyVisitTaskDialog"
    [component-data]="dataVisitTask"
    (onAssociated)="saveTaskVisit($event)"
    [popUpType]="popUpType"
    [isCreateMode]="isCreateMode"
  ></aw-task-visit-popup-form>

  <aw-assign-assets-popup-form
    *ngIf="showAssetPopup"
    [(display)]="showAssetPopup"
    [isReadOnlyForm]="isReadOnlyAssetDialog"
    [component-data]="dataAsset"
    (onAssociated)="refreshAfterAssetAssignment($event)"
  ></aw-assign-assets-popup-form>

  <aw-dialog-status
    *ngIf="showStatusUpdatesPopup"
    [isStatusEditable]="false"
    [item]="currentMaintenancePlan"
    [itemId]="statusPopupTitle"
    [(display)]="showStatusUpdatesPopup"
    [isObjectTypeOfBireMaintenancePlanDTO]="true"
  ></aw-dialog-status>
</div>

<aw-dialog-search-item
  *ngIf="showItemPopup"
  [(display)]="showItemPopup"
  (onValidated)="saveItem($event)"
></aw-dialog-search-item>

<aw-dialog-search-part
  *ngIf="showPartPopup"
  [(display)]="showPartPopup"
  (onValidated)="savePart($event)"
></aw-dialog-search-part>

<aw-dialog-generate-comment
  *ngIf="showGenerateCommentPopup"
  [(display)]="showGenerateCommentPopup"
  [componentData]="comment"
  (onValidate)="saveComments($event)"
></aw-dialog-generate-comment>

<aw-dialog-bire-document
  *ngIf="showAddDocumentDialog"
  [document]="
    documentsTableDataSource.dataSelectionCount === 1 ? documentsTableDataSource.dataSelection[0]._obj : undefined
  "
  [(display)]="showAddDocumentDialog"
  [isReadOnlyForm]="isReadOnlyDocumentDialog"
  (onValidated)="onAddDocument($event)"
></aw-dialog-bire-document>
<aw-upgrade-popup-form
  *ngIf="showUpgradePopup"
  [(display)]="showUpgradePopup"
  (changedVersion)="manualUpgradeMaintenancePlan($event)"
></aw-upgrade-popup-form>
