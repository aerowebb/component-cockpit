<a-modal class="aw-modal" [(visible)]="display" width="100">
  <a-header>
    <div class="modal-title">
      {{
        popUpType === "visit"
          ? (componentData.componentId + ".titleVisit" | translate)
          : (componentData.componentId + ".titleTask" | translate)
      }}
    </div>
  </a-header>

  <a-content>
    <div class="column">
      <div *ngIf="popUpType === 'task'" class="row">
        <div class="form-group" [ngClass]="{ required: isCreateMode }">
          <label class="form-label">{{ componentData.componentId + ".taskCode" | translate }}</label>

          <div class="form-control form-control-with-modal" [ngClass]="{ disabled: !isCreateMode }">
            <div class="form-control-data" (click)="!isReadOnlyForm && taskSearch()">
              {{ planTaskCounterTableDTO.birePlanTaskCounterDTO.taskCode }}
            </div>

            <div *ngIf="planTaskCounterTableDTO.birePlanTaskCounterDTO.taskCode" class="btn-clear-wrapper">
              <i
                class="ui-dropdown-clear-icon pi pi-times aw-icon btn-clear"
                aria-hidden="true"
                (click)="planTaskCounterTableDTO.birePlanTaskCounterDTO.taskCode = undefined"
              ></i>
            </div>
            <div class="btn-search-wrapper">
              <i
                class="fa fa-fw fa-search aw-icon btn-search"
                aria-hidden="true"
                (click)="!isReadOnlyForm && taskSearch()"
              ></i>
            </div>
          </div>
        </div>

        <div class="form-group" [ngClass]="{ required: isCreateMode }">
          <label class="form-label">{{ componentData.componentId + ".taskVersion" | translate }}</label>

          <div class="form-control">
            <input
              type="text"
              class="aw-input"
              [(ngModel)]="planTaskCounterTableDTO.birePlanTaskCounterDTO.taskVersion"
              [disabled]="true"
            />
          </div>
        </div>

        <div class="form-group">
          <label class="form-label">{{ componentData.componentId + ".taskDesignation" | translate }}</label>

          <div class="form-control">
            <input
              type="text"
              class="aw-input"
              [(ngModel)]="planTaskCounterTableDTO.bireTaskDTO.taskDesignation"
              [disabled]="true"
            />
          </div>
        </div>

        <div class="form-group">
          <label class="form-label">{{ componentData.componentId + ".taskType" | translate }}</label>

          <div class="form-control">
            <p-dropdown
              [disabled]="true"
              class="aw-dropdown fixed-width"
              [(ngModel)]="planTaskCounterTableDTO.bireTaskDTO.taskTypeCode"
              [options]="taskTypes"
              [showClear]="true"
              placeholder="&nbsp;"
              appendTo="body"
            ></p-dropdown>
          </div>
        </div>
      </div>

      <div *ngIf="popUpType === 'task'" class="row">
        <div class="form-group">
          <label class="form-label">{{ componentData.componentId + ".taskGroup" | translate }}</label>

          <div class="form-control">
            <p-dropdown
              [disabled]="true"
              class="aw-dropdown fixed-width"
              [(ngModel)]="planTaskCounterTableDTO.bireTaskDTO.groupCode"
              [options]="taskGroups"
              [showClear]="true"
              placeholder="&nbsp;"
              appendTo="body"
            ></p-dropdown>
          </div>
        </div>

        <div class="form-group">
          <label class="form-label">{{ componentData.componentId + ".groupCode" | translate }}</label>

          <div class="form-control">
            <input
              type="text"
              class="aw-input"
              [disabled]="isReadOnlyForm"
              [(ngModel)]="planTaskCounterTableDTO.birePlanTaskCounterDTO.groupCode"
            />
          </div>
        </div>

        <div class="form-group"></div>
        <div class="form-group"></div>
      </div>

      <div *ngIf="popUpType === 'visit'" class="row">
        <div class="form-group" [ngClass]="{ required: isCreateMode }">
          <label class="form-label">{{ componentData.componentId + ".visitCode" | translate }}</label>

          <div class="form-control form-control-with-modal" [ngClass]="{ disabled: !isCreateMode }">
            <div class="form-control-data" (click)="!isReadOnlyForm && visitSearch()">
              {{ planTaskCounterTableDTO.visitCode }}
            </div>

            <div *ngIf="planTaskCounterTableDTO.visitCode" class="btn-clear-wrapper">
              <i
                class="ui-dropdown-clear-icon pi pi-times aw-icon btn-clear"
                aria-hidden="true"
                (click)="planTaskCounterTableDTO.visitCode = undefined"
              ></i>
            </div>
            <div class="btn-search-wrapper">
              <i
                class="fa fa-fw fa-search aw-icon btn-search"
                aria-hidden="true"
                (click)="!isReadOnlyForm && visitSearch()"
              ></i>
            </div>
          </div>
        </div>

        <div class="form-group" [ngClass]="{ required: isCreateMode }">
          <label class="form-label">{{ componentData.componentId + ".visitVersion" | translate }}</label>

          <div class="form-control">
            <input type="text" class="aw-input" [(ngModel)]="planTaskCounterTableDTO.visitVersion" [disabled]="true" />
          </div>
        </div>

        <div class="form-group">
          <label class="form-label">{{ componentData.componentId + ".visitDesignation" | translate }}</label>

          <div class="form-control">
            <input
              type="text"
              class="aw-input"
              [(ngModel)]="planTaskCounterTableDTO.visitDesignation"
              [disabled]="true"
            />
          </div>
        </div>
      </div>

      <div class="row">
        <div class="form-group" [ngClass]="{ required: isCreateMode }">
          <label class="form-label">{{ componentData.componentId + ".reference" | translate }}</label>

          <div class="form-control">
            <p-dropdown
              [disabled]="!isCreateMode"
              class="aw-dropdown fixed-width"
              [(ngModel)]="planTaskCounterTableDTO.birePlanTaskCounterDTO.counterCode"
              [options]="references"
              [showClear]="true"
              placeholder="&nbsp;"
              (onChange)="onSelectVisitReference()"
              appendTo="body"
            ></p-dropdown>
          </div>
        </div>

        <div class="form-group" [style.display]="!showPeriodicity ? 'none' : 'inherit'">
          <label class="form-label">{{ componentData.componentId + ".firstPeriodicity" | translate }}</label>

          <div class="form-control">
            <div class="row">
              <div style="width:90%">
                <input
                  #periodicityFirst="ngModel"
                  type="text"
                  class="aw-input"
                  [disabled]="isReadOnlyForm"
                  [(ngModel)]="planTaskCounterTableDTO.birePlanTaskCounterDTO.periodicityFirst"
                  [pKeyFilter]="inputValidationService.validatorOfPositiveNumber()"
                  [pValidateOnly]="true"
                />
              </div>
              <div style="width:10%" class="span-padding">{{ unitCode }}</div>
            </div>
            <p-message
              *ngIf="periodicityFirst.invalid && (periodicityFirst.dirty || periodicityFirst.touched)"
              severity="error"
              [text]="inputValidationService.formatOfPositiveNumber()"
            ></p-message>
          </div>
        </div>
        <div class="form-group" [style.display]="showPeriodicity ? 'none' : 'inherit'"></div>

        <div class="form-group" [style.display]="!showPeriodicity ? 'none' : 'inherit'">
          <label class="form-label">{{ componentData.componentId + ".periodicity" | translate }}</label>

          <div class="form-control">
            <div class="row">
              <div style="width: 90%">
                <input
                  #periodicity="ngModel"
                  type="text"
                  class="aw-input"
                  [disabled]="isReadOnlyForm"
                  [(ngModel)]="planTaskCounterTableDTO.birePlanTaskCounterDTO.periodicity"
                  [pKeyFilter]="inputValidationService.validatorOfPositiveNumber()"
                  [pValidateOnly]="true"
                />
              </div>
              <div class="span-padding" style="width: 10%">{{ unitCode }}</div>
            </div>
            <p-message
              *ngIf="periodicity.invalid && (periodicity.dirty || periodicity.touched)"
              severity="error"
              [text]="inputValidationService.formatOfPositiveNumber()"
            ></p-message>
          </div>
        </div>
        <div class="form-group" [style.display]="showPeriodicity ? 'none' : 'inherit'"></div>

        <div *ngIf="popUpType === 'task' && showPeriodicity" class="form-group">
          <label class="form-label">{{ componentData.componentId + ".periodicityType" | translate }}</label>

          <div class="form-control">
            <p-dropdown
              class="aw-dropdown fixed-width"
              [(ngModel)]="planTaskCounterTableDTO.birePlanTaskCounterDTO.periodicityType"
              [options]="periodicityTypes"
              [showClear]="true"
              [disabled]="isReadOnlyForm"
              placeholder="&nbsp;"
              appendTo="body"
            ></p-dropdown>
          </div>
        </div>
        <div *ngIf="popUpType === 'task' && !showPeriodicity" class="form-group"></div>
      </div>

      <div class="row">
        <div class="form-group" [style.display]="!showPeriodicity ? 'none' : 'inherit'">
          <label class="form-label">{{ componentData.componentId + ".tolerance" | translate }}</label>

          <div class="form-control">
            <input
              #tolerance="ngModel"
              type="text"
              class="aw-input"
              [disabled]="isReadOnlyForm"
              [(ngModel)]="planTaskCounterTableDTO.birePlanTaskCounterDTO.tolerance"
              [pKeyFilter]="inputValidationService.validatorOfNumber()"
              [pValidateOnly]="true"
            />
            <p-message
              *ngIf="tolerance.invalid && (tolerance.dirty || tolerance.touched)"
              severity="error"
              [text]="inputValidationService.formatOfNumber()"
            ></p-message>
          </div>
        </div>

        <div class="form-group" [style.display]="!showPeriodicity ? 'none' : 'inherit'">
          <label class="form-label"
            >{{ componentData.componentId + ".alertThreshold" | translate }} {{ labelUnitCode }}</label
          >
          <div class="form-control">
            <input
              #threshold="ngModel"
              type="text"
              class="aw-input"
              [disabled]="isReadOnlyForm"
              [(ngModel)]="planTaskCounterTableDTO.birePlanTaskCounterDTO.threshold"
              [pKeyFilter]="inputValidationService.validatorOfNumber()"
              [pValidateOnly]="true"
            />
            <p-message
              *ngIf="threshold.invalid && (threshold.dirty || threshold.touched)"
              severity="error"
              [text]="inputValidationService.formatOfNumber()"
            ></p-message>
          </div>
        </div>

        <div class="form-group">
          <label class="form-label">{{ componentData.componentId + ".comments" | translate }}</label>
          <div class="form-control">
            <textarea
              class="aw-textarea"
              [rows]="3"
              pInputTextarea
              [disabled]="true"
              [(ngModel)]="customComments"
            ></textarea>
          </div>
        </div>

        <div class="form-group" *ngIf="popUpType === 'task'"></div>
        <div class="form-group" [style.display]="showPeriodicity ? 'none' : 'inherit'"></div>
        <div class="form-group" [style.display]="showPeriodicity ? 'none' : 'inherit'"></div>
      </div>
    </div>
  </a-content>

  <a-footer>
    <button *ngIf="isReadOnlyForm" type="button" mat-raised-button (click)="cancel()">
      <span>{{ "global.close" | translate }}</span>
    </button>

    <button *ngIf="!isReadOnlyForm" type="button" mat-raised-button (click)="cancel()">
      <span>{{ "global.cancel" | translate }}</span>
    </button>

    <button
      *ngIf="!isReadOnlyForm && popUpType === 'visit'"
      type="button"
      mat-raised-button
      (click)="associate()"
      color="primary"
      [disabled]="
        !planTaskCounterTableDTO.visitCode ||
        !planTaskCounterTableDTO.visitVersion ||
        !planTaskCounterTableDTO.birePlanTaskCounterDTO.counterCode ||
        (periodicityFirst.invalid && (periodicityFirst.dirty || periodicityFirst.touched)) ||
        (periodicity.invalid && (periodicity.dirty || periodicity.touched)) ||
        (tolerance.invalid && (tolerance.dirty || tolerance.touched)) ||
        (threshold.invalid && (threshold.dirty || threshold.touched))
      "
    >
      {{ "global.validate" | translate }}
    </button>
    <button
      *ngIf="!isReadOnlyForm && popUpType === 'task'"
      type="button"
      mat-raised-button
      color="primary"
      (click)="associate()"
      [disabled]="
        !planTaskCounterTableDTO.birePlanTaskCounterDTO.taskCode ||
        !planTaskCounterTableDTO.birePlanTaskCounterDTO.taskVersion ||
        !planTaskCounterTableDTO.birePlanTaskCounterDTO.counterCode ||
        (periodicityFirst.invalid && (periodicityFirst.dirty || periodicityFirst.touched)) ||
        (periodicity.invalid && (periodicity.dirty || periodicity.touched)) ||
        (tolerance.invalid && (tolerance.dirty || tolerance.touched)) ||
        (threshold.invalid && (threshold.dirty || threshold.touched))
      "
    >
      {{ "global.validate" | translate }}
    </button>
  </a-footer>
</a-modal>

<aw-dialog-search-task
  *ngIf="showItemTaskSearchPopup"
  [(display)]="showItemTaskSearchPopup"
  (onSelected)="setSelectedTaskSearchCode($event)"
  [is-visit]="false"
></aw-dialog-search-task>

<aw-dialog-search-task
  *ngIf="showItemVisitSearchPopup"
  [(display)]="showItemVisitSearchPopup"
  (onSelected)="setSelectedVisitSearchCode($event)"
  [is-visit]="true"
></aw-dialog-search-task>
