<div class="page-header">
  <div class="page-info">
    <div>
      <div class="page-title">
        {{ "transaction." + componentData.componentId | translate }}
      </div>

      <div class="page-subtitle">
        <div *ngIf="!isCreateOpenMode && componentData && componentData.objectId" class="page-subtitle">
          <span class="page-subtitle"> - {{ context }} </span>
        </div>
      </div>
    </div>
  </div>

  <div class="page-actions">
    <button
      id="actions"
      mat-icon-button
      class="mat-elevation-z1"
      matTooltip="{{ 'global.showAllActionTooltip' | translate }}"
      matTooltipPosition="above"
      aria-label="Show all actions"
      [matMenuTriggerFor]="actions"
    >
      <mat-icon>more_horiz</mat-icon>
    </button>

    <mat-menu #actions="matMenu">
      <button type="button" mat-menu-item (click)="changeStartDateOfSchedulerAndReloadResourcesAndEvents()">
        {{ "global.refresh" | translate }}
      </button>
      <button id="favorites" mat-menu-item (click)="updateFavoriteState()">
        {{ (isFavoriteEntry ? "page.removeFromFavorites" : "page.addToFavorites") | translate }}
      </button>
    </mat-menu>
  </div>
</div>

<div class="page-wrapper">
  <div class="page-container" style="max-width: 100%">
    <div class="page-content">
      <div class="grid-row">
        <div class="grid-cell--12">
          <div class="grid-cell grid-cell--container">
            <div class="grid-cell-header">
              <div class="grid-cell-title-container">
                <h3 class="grid-cell-title">
                  {{ componentData.componentId + ".information" | translate }}
                </h3>
              </div>
            </div>
            <div class="grid-cell-content">
              <div class="row">
                <div class="form-group">
                  <label class="form-label"> {{ componentData.componentId + ".startDate" | translate }} </label>
                  <div class="form-control">
                    <p-calendar
                      showButtonBar="true"
                      [monthNavigator]="true"
                      [yearNavigator]="true"
                      [yearRange]="sessionService.calendarYearRange"
                      class="aw-calendar"
                      appendTo="body"
                      [dateFormat]="sessionService.dateFormatPrimeNG"
                      [showTime]="true"
                      [locale]="sessionService.calendarFormat"
                      [(ngModel)]="startViewDate"
                      [disabled]="isReadOpenMode"
                    ></p-calendar>
                  </div>
                </div>
                <div class="form-group">
                  <label class="form-label">
                    {{ componentData.componentId + ".departureLocation" | translate }}
                  </label>
                  <div class="form-control">
                    <p-dropdown
                      class="aw-dropdown fixed-width"
                      [options]="flightBaseList"
                      [(ngModel)]="selectedBase"
                      [showClear]="false"
                      placeholder="&nbsp;"
                      [disabled]="isReadOpenMode"
                    ></p-dropdown>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="grid-row">
        <div class="grid-cell--12">
          <div class="grid-cell grid-cell--container">
            <div class="grid-cell-header">
              <div class="grid-cell-title-container">
                <h3 class="grid-cell-title">
                  {{ componentData.componentId + ".schedule" | translate }}
                </h3>
              </div>
            </div>

            <div class="row">
              <div class="form-group">
                <div class="form-control aw-selectbutton-wrapper center-content">
                  <p-selectButton
                    [options]="timeOptionToDisplayList"
                    (onChange)="onTimeOptionChange($event.value)"
                    [(ngModel)]="defaultSplitButtonValue"
                  >
                  </p-selectButton>
                </div>
              </div>
            </div>

            <div class="grid-cell--12">
              <div
                [ngClass]="{
                  'grid-cell--10': showAircraftAssociationColumn,
                  'grid-cell--12': !showAircraftAssociationColumn
                }"
                style="padding-right: 2px !important;"
              >
                <div class="grid-cell-content">
                  <div class="scheduler-wrap show">
                    <bry-scheduler
                      [barMargin]="barMargin"
                      [columns]="schedulerConfig['columns']"
                      [startDate]="schedulerConfig['startDate']"
                      [endDate]="schedulerConfig['endDate']"
                      [timeRanges]="schedulerConfig['timeRanges']"
                      [timeRangesFeature]="schedulerConfig['timeRangesFeature']"
                      [headerContextMenuFeature]="schedulerConfig['headerContextMenuFeature']"
                      [eventContextMenuFeature]="schedulerConfig['eventContextMenuFeature']"
                      [scheduleContextMenuFeature]="schedulerConfig['scheduleContextMenuFeature']"
                      [eventTooltipFeature]="schedulerConfig['eventTooltipFeature']"
                      [resources]="flightResources"
                      [filterBarFeature]="schedulerConfig['filterBarFeature']"
                      [events]="flightEvents"
                      [rowHeight]="schedulerConfig['rowHeight']"
                      [eventRenderer]="schedulerConfig['eventRenderer']"
                      [readOnly]="schedulerConfig['readOnly']"
                      [zoomKeepsOriginalTimespan]="schedulerConfig['zoomKeepsOriginalTimespan']"
                      [zoomOnMouseWheel]="schedulerConfig['zoomOnMouseWheel']"
                      [zoomOnTimeAxisDoubleClick]="schedulerConfig['zoomOnTimeAxisDoubleClick']"
                      [viewPreset]="schedulerConfig['viewPreset']"
                      [zoomLevels]="schedulerConfig['zoomLevels']"
                    >
                    </bry-scheduler>
                  </div>
                </div>
              </div>

              <div class="grid-cell--2 availablesAircrafts" *ngIf="showAircraftAssociationColumn">
                <div *ngFor="let aircraft of availablesAircraftsDisplayedInfo">
                  <div
                    [className]="aircraft.borderClassColor"
                    [pTooltip]="
                      getEventTooltip(aircraft.bidoMissionEquipmentLWO, aircraft.runwaySchedulingFlightInfoOutputDTO)
                    "
                    [tooltipDisabled]="aircraft.aircraftStructureIsLoading || !aircraft.aircraftStructureLoaded"
                    [escape]="false"
                  >
                    <a *ngIf="aircraft.aircraft.sn" (click)="openAircraft(aircraft.aircraft.equipmentCode)">
                      {{ aircraft.aircraft.sn }}
                    </a>

                    <div *ngIf="aircraft.aircraftStructureIsLoading" class="aw-table-loading-indicator">
                      <div class="loading-message center-content">{{ "table.loadingData" | translate }}</div>
                      <div class="lds-hourglass center-content"></div>
                    </div>

                    <div
                      *ngIf="!aircraft.aircraftStructureIsLoading && !aircraft.aircraftStructureLoaded"
                      class="aw-table-loading-indicator"
                    >
                      <div class="loading-message center-content">
                        {{ componentData.componentId + ".errorLoadingData" | translate }}
                      </div>
                    </div>

                    <ng-container *ngIf="!aircraft.aircraftStructureIsLoading && aircraft.aircraftStructureLoaded">
                      <div
                        *ngIf="
                          aircraft.bidoMissionEquipmentLWO && aircraft.bidoMissionEquipmentLWO.requestedOpeConfigCode
                        "
                      >
                        {{ getInstallationsRemovals(aircraft.runwaySchedulingFlightInfoOutputDTO) }}
                      </div>

                      <div [className]="aircraft.potentialLabelClassColor">
                        {{ potentialLabel }}: {{ getPotentialInHours(aircraft.runwaySchedulingFlightInfoOutputDTO) }}
                      </div>

                      <div>
                        <div class="tieProgressBar">
                          <label class="form-label">
                            {{ componentData.componentId + ".aircraftTieTarget" | translate }}
                          </label>
                          <mat-progress-bar mode="determinate" [value]="component.FIFTY_PERCENT_THAT_IS_VISUAL_CUE">
                          </mat-progress-bar>
                        </div>
                        <div class="tieProgressBar">
                          <label class="form-label">
                            {{ componentData.componentId + ".aircraftTieCurrent" | translate }}
                          </label>
                          <mat-progress-bar
                            mode="determinate"
                            [value]="
                              getPercentageOfTieProgressBar(
                                aircraft.runwaySchedulingFlightInfoOutputDTO.aircraftTieTarget,
                                aircraft.runwaySchedulingFlightInfoOutputDTO.aircraftTieCurrent
                              )
                            "
                          >
                          </mat-progress-bar>
                        </div>
                        <div class="tieProgressBar">
                          <label class="form-label">
                            {{ componentData.componentId + ".fleetTieAverage" | translate }}
                          </label>
                          <mat-progress-bar
                            mode="determinate"
                            [value]="
                              getPercentageOfTieProgressBar(
                                aircraft.runwaySchedulingFlightInfoOutputDTO.aircraftTieTarget,
                                aircraft.runwaySchedulingFlightInfoOutputDTO.fleetTieAverage
                              )
                            "
                          >
                          </mat-progress-bar>
                        </div>
                      </div>
                    </ng-container>
                    <div class="center-content">
                      <i
                        class="fa fa-fw fa-link aw-icon ng-star-inserted tooltip"
                        aria-hidden="true"
                        (click)="associateAircraft(aircraft)"
                      >
                        <span class="tooltiptext">{{
                          componentData.componentId + ".tooltipAssociate" | translate
                        }}</span>
                      </i>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
