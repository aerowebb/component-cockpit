<div class="page-header">
  <div class="page-info">
    <div>
      <h2 class="page-title">
        {{ "transaction." + componentData.componentId | translate }}
      </h2>

      <div class="page-subtitle">
        <!-- <div *ngIf="" class="page-subtitle">
            - {{  }}
          </div> -->
      </div>
    </div>

    <!-- <div class="object-status" *ngIf="" (click)="showStatus()">
        {{  | formatSelectOption:  }}
      </div> -->
  </div>

  <div class="page-actions">
    <button *ngIf="!isCreateOpenMode" type="button" mat-raised-button>
      {{ getComponentName() + ".delotir" | translate }}
    </button>

    <button *ngIf="!isCreateOpenMode" type="button" mat-raised-button>
      {{ getComponentName() + ".report" | translate }}
    </button>

    <button *ngIf="isReadOpenMode" type="button" mat-raised-button (click)="editBatch()">
      {{ "global.edit" | translate }}
    </button>

    <button
      id="cancel"
      *ngIf="!isReadOpenMode && !isCreateOpenMode"
      color="warn"
      type="button"
      mat-raised-button
      (click)="onCancel()"
    >
      {{ "global.cancel" | translate }}
    </button>

    <button *ngIf="!isReadOpenMode" type="button" color="primary" mat-raised-button (click)="saveBatch()">
      {{ "global.save" | translate }}
    </button>

    <button
      mat-icon-button
      class="mat-elevation-z1"
      matTooltip="{{ 'global.showAllActionTooltip' | translate }}"
      matTooltipPosition="above"
      aria-label="Show all actions"
      [matMenuTriggerFor]="actions"
    >
      <mat-icon>more_horiz</mat-icon>
    </button>
    <mat-menu #actions="matMenu">
      <button mat-menu-item (click)="reloadBatch()">{{ "global.refresh" | translate }}</button>
      <button mat-menu-item (click)="updateFavoriteState()">{{ "addToFavorite" | translate }}</button>
    </mat-menu>
  </div>
</div>

<div class="page-wrapper">
  <div class="page-container">
    <div class="page-content">
      <mat-tab-group animationDuration="0ms" dynamicHeight>
        <!-- Home -->
        <mat-tab id="homeTab">
          <ng-template mat-tab-label>
            {{ "home" | translate }}
          </ng-template>
          <div class="grid-row">
            <div class="grid-cell--12">
              <div class="grid-cell grid-cell--container">
                <div class="grid-cell-header">
                  <div class="grid-cell-title-container loading-indicator">
                    <div class="grid-cell-title">
                      <span>{{ componentData.componentId + ".mainInfo" | translate }}</span>
                    </div>
                  </div>
                </div>

                <div class="grid-cell-content">
                  <div class="column">
                    <div class="row">
                      <div class="form-group">
                        <label class="form-label">{{ componentData.componentId + ".familyVariant" | translate }}</label>

                        <div class="form-control">
                          <input
                            type="text"
                            maxlength="35"
                            class="aw-input"
                            [disabled]="isReadOpenMode"
                            [(ngModel)]="equipment.bidoEquipmentDTO.familyVariantCode"
                          />
                        </div>
                      </div>
                      <div class="form-group">
                        <label class="form-label">{{ getComponentName() + ".batchNumber" | translate }}</label>

                        <div class="form-control">
                          <input
                            type="text"
                            maxlength="35"
                            class="aw-input"
                            [disabled]="isReadOpenMode"
                            [(ngModel)]="equipment.bidoEquipmentDTO.batchNumber"
                          />
                        </div>
                      </div>
                      <div class="form-group">
                        <label class="form-label">{{ getComponentName() + ".partNumber" | translate }}</label>

                        <div class="form-control">
                          <input
                            type="text"
                            maxlength="35"
                            class="aw-input"
                            [disabled]="isReadOpenMode"
                            [(ngModel)]="equipment.bidoEquipmentDTO.pnCode"
                          />
                        </div>
                      </div>

                      <div class="form-group">
                        <label class="form-label">{{ getComponentName() + ".quantity" | translate }}</label>

                        <div class="form-control">
                          <input
                            type="text"
                            maxlength="35"
                            class="aw-input"
                            [disabled]="isReadOpenMode"
                            [(ngModel)]="equipment.bidoEquipmentDTO.quantity"
                          />
                        </div>
                      </div>

                      <div class="form-group">
                        <label class="form-label">{{ getComponentName() + ".operationalStatus" | translate }}</label>

                        <div class="form-control">
                          <p-dropdown
                            class="aw-dropdown fixed-width"
                            placeholder="&nbsp;"
                            [showClear]="true"
                            [(ngModel)]="equipment.bidoEquipmentDTO.operationalStatus"
                            [options]="statusList"
                            [disabled]="isReadOpenMode"
                          ></p-dropdown>
                        </div>
                      </div>
                    </div>
                    <div class="row">
                      <div class="form-group flex--2">
                        <label class="form-label">{{ getComponentName() + ".designation" | translate }}</label>

                        <div class="form-control">
                          <input
                            type="text"
                            maxlength="35"
                            class="aw-input"
                            [disabled]="isReadOpenMode"
                            [(ngModel)]="equipment.bidoEquipmentDTO.equipmentDesignation"
                          />
                        </div>
                      </div>
                      <div class="form-group">
                        <label class="form-label">{{ getComponentName() + ".expirationDate" | translate }}</label>

                        <div class="form-control">
                          <p-calendar
                            showButtonBar="true"
                            [monthNavigator]="true"
                            [yearNavigator]="true"
                            [yearRange]="sessionService.calendarYearRange"
                            class="aw-calendar"
                            [dateFormat]="sessionService.dateFormatPrimeNG"
                            [locale]="sessionService.calendarFormat"
                            appendTo="body"
                            [(ngModel)]="mainInfo.expirationDate"
                            [disabled]="isReadOpenMode"
                          ></p-calendar>
                        </div>
                      </div>

                      <div class="form-group">
                        <label class="form-label">{{ componentData.componentId + ".owner" | translate }}</label>

                        <div
                          class="form-control form-control-with-modal"
                          [ngClass]="{ disabled: isReadOpenMode || !isCreateOpenMode }"
                        >
                          <div class="form-control-data" (click)="isCreateOpenMode ? searchOwners() : ''">
                            {{ equipment.bidoEquipmentDTO.ownerCustomerCode }}
                            <span *ngIf="ownerCustomerName">({{ ownerCustomerName }})</span>
                          </div>

                          <div *ngIf="equipment.bidoEquipmentDTO.ownerCustomerCode" class="btn-clear-wrapper">
                            <i
                              class="ui-dropdown-clear-icon pi pi-times aw-icon btn-clear"
                              aria-hidden="true"
                              (click)="
                                equipment.bidoEquipmentDTO.ownerCustomerCode = undefined; ownerCustomerName = undefined
                              "
                            ></i>
                          </div>
                          <div class="btn-search-wrapper">
                            <i
                              class="fa fa-fw fa-search aw-icon btn-search"
                              aria-hidden="true"
                              (click)="searchOwners()"
                            ></i>
                          </div>
                        </div>
                      </div>

                      <div class="form-group">
                        <label class="form-label">{{ componentData.componentId + ".operator" | translate }}</label>

                        <div
                          class="form-control form-control-with-modal"
                          [ngClass]="{ disabled: isReadOpenMode || !isCreateOpenMode }"
                        >
                          <div class="form-control-data" (click)="isCreateOpenMode ? searchOperators() : ''">
                            {{ equipment.bidoEquipmentDTO.operatorCustomerCode }}
                            <span *ngIf="operatorCustomerName">({{ operatorCustomerName }})</span>
                          </div>

                          <div *ngIf="equipment.bidoEquipmentDTO.operatorCustomerCode" class="btn-clear-wrapper">
                            <i
                              class="ui-dropdown-clear-icon pi pi-times aw-icon btn-clear"
                              aria-hidden="true"
                              (click)="
                                equipment.bidoEquipmentDTO.operatorCustomerCode = undefined;
                                operatorCustomerName = undefined
                              "
                            ></i>
                          </div>
                          <div class="btn-search-wrapper">
                            <i
                              class="fa fa-fw fa-search aw-icon btn-search"
                              aria-hidden="true"
                              (click)="searchOperators()"
                            ></i>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Engineering References -->
            <div class="grid-cell--12">
              <div class="grid-cell grid-cell--container">
                <div class="grid-cell-header">
                  <div class="grid-cell-title-container">
                    <h3 class="grid-cell-title">
                      {{ componentData.componentId + ".engineeringReferences" | translate }}
                    </h3>
                  </div>
                </div>

                <div class="grid-cell-content  grid-cell-content-with-section">
                  <div class="row">
                    <div class="form-group">
                      <label class="form-label">{{ componentData.componentId + ".itemCode" | translate }}</label>
                      <div class="form-control display--flex-row">
                        <input
                          type="text"
                          class="aw-input flex--1"
                          [disabled]="isReadOpenMode"
                          [(ngModel)]="equipment.bidoEquipmentDTO.chapter"
                          maxlength="2"
                        />
                        <span style="margin-top:10px" class="separator">-</span>
                        <input
                          type="text"
                          class="aw-input flex--1"
                          [disabled]="isReadOpenMode"
                          [(ngModel)]="equipment.bidoEquipmentDTO.section"
                          maxlength="2"
                        />
                        <span style="margin-top:10px" class="separator">-</span>
                        <input
                          type="text"
                          class="aw-input flex--1"
                          [disabled]="isReadOpenMode"
                          [(ngModel)]="equipment.bidoEquipmentDTO.subject"
                          maxlength="2"
                        />
                        <span style="margin-top:10px" class="separator">-</span>
                        <input
                          type="text"
                          class="aw-input flex--1"
                          [disabled]="isReadOpenMode"
                          [(ngModel)]="equipment.bidoEquipmentDTO.sheet"
                          maxlength="5"
                        />
                        <span style="margin-top:10px" class="separator">-</span>
                        <input
                          type="text"
                          class="aw-input flex--1"
                          [disabled]="isReadOpenMode"
                          [(ngModel)]="equipment.bidoEquipmentDTO.marks"
                          maxlength="5"
                        />

                        <div class="btn-search-wrapper" *ngIf="!isReadOpenMode">
                          <i class="fa fa-fw fa-search aw-icon btn-search" aria-hidden="true"></i>
                        </div>
                      </div>
                    </div>

                    <div class="form-group general-field">
                      <label class="form-label">{{ componentData.componentId + ".itemNumber" | translate }}</label>

                      <div class="form-control">
                        <input
                          type="text"
                          class="aw-input"
                          [(ngModel)]="equipment.itemNumber"
                          [disabled]="isReadOpenMode"
                        />
                      </div>
                    </div>

                    <div class="form-group general-field">
                      <label class="form-label">{{ componentData.componentId + ".functionCode" | translate }}</label>

                      <div class="form-control">
                        <input
                          type="text"
                          class="aw-input"
                          [(ngModel)]="equipment.bidoEquipmentDTO.functionCode"
                          [disabled]="isReadOpenMode"
                        />
                      </div>
                    </div>

                    <div class="form-group">
                      <label class="form-label">{{ componentData.componentId + ".position" | translate }}</label>

                      <div class="form-control">
                        <p-dropdown
                          class="aw-dropdown fixed-width"
                          [options]="propertyPositions"
                          [(ngModel)]="equipment.bidoEquipmentDTO.equiPosition"
                          [showClear]="true"
                          placeholder="&nbsp;"
                          [disabled]="isReadOpenMode"
                        ></p-dropdown>
                      </div>
                    </div>

                    <div class="form-group">
                      <label class="form-label">{{ componentData.componentId + ".function" | translate }}</label>
                      <div class="form-control">
                        <p-dropdown
                          class="aw-dropdown fixed-width"
                          [options]="propertyFunctions"
                          [(ngModel)]="equipment.bidoEquipmentDTO.equipmentFunction"
                          [showClear]="true"
                          placeholder="&nbsp;"
                          [disabled]="isReadOpenMode"
                        ></p-dropdown>
                      </div>
                    </div>

                    <div class="form-group">
                      <label class="form-label">{{ componentData.componentId + ".lifeRestriction" | translate }}</label>

                      <div class="form-control">
                        <p-checkbox
                          class="aw-checkbox"
                          binary="true"
                          [disabled]="isReadOpenMode"
                          [(ngModel)]="equipment.bidoEquipmentDTO.lifeRestriction"
                          [disabled]="isReadOpenMode"
                        >
                        </p-checkbox>
                      </div>
                    </div>

                    <div class="form-group general-field">
                      <label class="form-label">{{
                        componentData.componentId + ".manufacturingConfiguration" | translate
                      }}</label>

                      <div class="form-control">
                        <p-checkbox
                          binary="true"
                          class="aw-checkbox"
                          [(ngModel)]="equipment.bidoEquipmentDTO.manufacturingConfiguration"
                          [disabled]="isReadOpenMode"
                        ></p-checkbox>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <div class="grid-cell--6">
              <div class="grid-cell grid-cell--container">
                <div class="grid-cell-header">
                  <div class="grid-cell-title-container loading-indicator ">
                    <div class="grid-cell-title">
                      <span>{{ componentData.componentId + ".geographicalLocation" | translate }}</span>
                    </div>
                  </div>
                </div>

                <div class="grid-cell-content grid-cell-content-with-section">
                  <div class="section">
                    <div class="section-content">
                      <div class="row">
                        <div class="form-group">
                          <label class="form-label">{{ componentData.componentId + ".zone" | translate }}</label>

                          <div *ngIf="isCreateOpenMode" class="form-control">
                            <p-dropdown
                              class="aw-dropdown fixed-width"
                              [options]="propertyZones"
                              [(ngModel)]="equipment.bidoEquipmentDTO.zone"
                              (onChange)="changeZone()"
                              [showClear]="true"
                              placeholder="&nbsp;"
                              [disabled]="isReadOpenMode"
                            ></p-dropdown>
                          </div>

                          <div
                            *ngIf="!isCreateOpenMode"
                            class="form-control form-control-with-modal"
                            [ngClass]="{ disabled: isReadOpenMode }"
                          >
                            <div class="form-control-data" (click)="!isReadOpenMode ? searchGeoLocation() : ''">
                              {{ equipment.bidoEquipmentDTO.zone }}
                            </div>
                            <div *ngIf="equipment.bidoEquipmentDTO.zone" class="btn-clear-wrapper">
                              <i
                                class="ui-dropdown-clear-icon pi pi-times aw-icon btn-clear"
                                aria-hidden="true"
                                (click)="equipment.bidoEquipmentDTO.zone = undefined"
                              ></i>
                            </div>
                            <div class="btn-search-wrapper">
                              <i
                                class="fa fa-fw fa-edit aw-icon btn-search"
                                aria-hidden="true"
                                (click)="searchGeoLocation()"
                              ></i>
                            </div>
                          </div>
                        </div>

                        <div class="form-group">
                          <label class="form-label">{{ componentData.componentId + ".country" | translate }}</label>

                          <div *ngIf="isCreateOpenMode" class="form-control">
                            <p-dropdown
                              class="aw-dropdown fixed-width"
                              [options]="propertyCountries"
                              [(ngModel)]="equipment.bidoEquipmentDTO.country"
                              (onChange)="changeCountry()"
                              [showClear]="true"
                              placeholder="&nbsp;"
                              [disabled]="isReadOpenMode"
                            ></p-dropdown>
                          </div>
                          <div *ngIf="!isCreateOpenMode" class="form-control">
                            <input
                              type="text"
                              class="aw-input"
                              [disabled]="isReadOpenMode"
                              [(ngModel)]="equipment.bidoEquipmentDTO.country"
                            />
                          </div>
                        </div>

                        <div class="form-group">
                          <label class="form-label">{{ componentData.componentId + ".location" | translate }}</label>

                          <div class="form-control">
                            <p-dropdown
                              class="aw-dropdown fixed-width"
                              [options]="propertyLocations"
                              [(ngModel)]="locationValue"
                              [showClear]="true"
                              placeholder="&nbsp;"
                              [disabled]="isReadOpenMode"
                            ></p-dropdown>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <div class="grid-cell--6">
              <div class="grid-cell grid-cell--container">
                <div class="grid-cell-header">
                  <div class="grid-cell-title-container loading-indicator ">
                    <div class="grid-cell-title">
                      <span>{{ componentData.componentId + ".usCounters" | translate }}</span>
                    </div>
                  </div>
                </div>

                <div class="grid-cell-content grid-cell-content-with-section">
                  <div class="section">
                    <div class="section-content">
                      <div class="row">
                        <div class="form-group">
                          <label class="form-label">{{ componentData.componentId + ".usage" | translate }}</label>

                          <div
                            class="form-control"
                            [ngClass]="
                              !equipment.usageCounterCalculationDTO.usageValue ||
                              equipment.usageCounterCalculationDTO.usageValue === NOT_ACTIVATED
                                ? COLOR_RED
                                : COLOR_GREEN
                            "
                          >
                            <input
                              type="text"
                              class="aw-input"
                              [(ngModel)]="equipment.usageCounterCalculationDTO.usageValue"
                              [disabled]="isReadOpenMode"
                            />
                          </div>
                        </div>

                        <div class="form-group">
                          <label class="form-label">{{ componentData.componentId + ".storage" | translate }}</label>

                          <div
                            class="form-control"
                            [ngClass]="
                              !equipment.usageCounterCalculationDTO.storageValue ||
                              equipment.usageCounterCalculationDTO.storageValue === NOT_ACTIVATED
                                ? COLOR_RED
                                : COLOR_GREEN
                            "
                          >
                            <input
                              type="text"
                              class="aw-input"
                              [(ngModel)]="equipment.usageCounterCalculationDTO.storageValue"
                              [disabled]="isReadOpenMode"
                            />
                          </div>
                        </div>

                        <div class="form-group">
                          <label class="form-label">{{
                            componentData.componentId + ".usageStorage" | translate
                          }}</label>

                          <div
                            class="form-control"
                            [ngClass]="
                              !equipment.usageCounterCalculationDTO.usageStorageValue ||
                              equipment.usageCounterCalculationDTO.usageStorageValue === NOT_ACTIVATED
                                ? COLOR_RED
                                : COLOR_GREEN
                            "
                          >
                            <input
                              type="text"
                              class="aw-input"
                              [(ngModel)]="equipment.usageCounterCalculationDTO.usageStorageValue"
                              [disabled]="isReadOpenMode"
                            />
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </mat-tab>
        <mat-tab *ngIf="!isCreateOpenMode" id="structureTab">
          <ng-template mat-tab-label>
            {{ componentData.componentId + ".batchInfo" | translate }}
          </ng-template>
          <div *ngIf="!isCreateOpenMode">
            <div class="grid-row">
              <div class="grid-cell--12">
                <div class="grid-cell grid-cell--container">
                  <div class="grid-cell-header">
                    <div class="grid-cell-title-container loading-indicator">
                      <div class="grid-cell-title">
                        {{ getComponentName() + ".generatedBatches" | translate }} ({{
                          gereratedBatcheTableDataSource.dataCount
                        }})
                      </div>
                    </div>
                  </div>

                  <div class="grid-cell-content">
                    <a-table [dataSource]="gereratedBatcheTableDataSource">
                      <ng-template tableActionsDef>
                        <button type="button" mat-raised-button *ngIf="gereratedBatcheTableDataSource.hasDataSelection">
                          {{ "global.open" | translate }}
                        </button>
                      </ng-template>

                      <ng-template columnDef="batchNumber" let-rowData="rowData">
                        <a>{{ rowData.batchNumber }}</a>
                      </ng-template>
                      <ng-template columnDef="location" let-rowData="rowData">
                        <span class="label-info">
                          <a> {{ rowData.location }}</a>
                          >
                        </span>
                        <span> {{ rowData["locationDescription"] }}</span>
                      </ng-template>
                      <ng-template columnDef="emplacement" let-rowData="rowData">
                        <span class="label-info">
                          <a> {{ rowData.emplacement }}</a>
                        </span>
                        <span> {{ rowData["emplacementDesc"] }}</span>
                      </ng-template>
                    </a-table>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </mat-tab>

        <mat-tab *ngIf="!isCreateOpenMode" id="additionalTab">
          <ng-template mat-tab-label>
            {{ componentData.componentId + ".tabGeneral" | translate }}
          </ng-template>
          <div class="grid-row">
            <div class="grid-cell--12">
              <div class="grid-cell grid-cell--container">
                <div class="grid-cell-header">
                  <div class="grid-cell-title-container loading-indicator ">
                    <div class="grid-cell-title">
                      <span>{{ componentData.componentId + ".tabGeneral" | translate }}</span>
                    </div>
                  </div>
                </div>

                <div class="grid-cell-content grid-cell-content-with-section">
                  <div class="section">
                    <div class="section-content">
                      <div class="column">
                        <div class="row">
                          <div class="form-group">
                            <label class="form-label">{{ componentData.componentId + ".assetCode" | translate }}</label>

                            <div class="form-control">
                              <input
                                type="text"
                                maxlength="25"
                                class="aw-input"
                                [(ngModel)]="equipment.bidoEquipmentDTO.equipmentCode"
                                [disabled]="isReadOpenMode || !isCreateOpenMode"
                              />
                            </div>
                          </div>

                          <div class="form-group">
                            <label class="form-label">{{ componentData.componentId + ".eisDate" | translate }}</label>
                            <div class="form-control">
                              <p-calendar
                                showButtonBar="true"
                                [monthNavigator]="true"
                                [yearNavigator]="true"
                                [yearRange]="sessionService.calendarYearRange"
                                class="aw-calendar"
                                [dateFormat]="sessionService.dateFormatPrimeNG"
                                [locale]="sessionService.calendarFormat"
                                [(ngModel)]="equipment.bidoEquipmentDTO.eisDate"
                                [disabled]="isReadOpenMode"
                                [maxDate]="maxDate"
                              ></p-calendar>
                            </div>
                          </div>

                          <!-- TODO : propagate method  -->
                          <!-- <div *ngIf="!isCreateOpenMode && !isReadOpenMode" class="form-group" style="margin-top:48px">
                            <i
                              class="fa fa-fw fa-level-down aw-icon aw-icon-with-border"
                              aria-hidden="true"
                              pTooltip="{{ componentData.componentId + '.propagate' | translate }}"
                              tooltipPosition="top"
                              (click)="propagate()"
                            ></i>
                          </div> -->
                          <div class="form-group">
                            <label class="form-label">{{ componentData.componentId + ".model" | translate }}</label>

                            <div class="form-control">
                              <input
                                type="text"
                                class="aw-input"
                                [disabled]="true"
                                [(ngModel)]="equipmentModelCodeAndName"
                              />
                            </div>
                          </div>

                          <div class="form-group">
                            <label class="form-label">{{
                              componentData.componentId + ".manufacturer" | translate
                            }}</label>

                            <div class="form-control">
                              <input
                                type="text"
                                maxlength="35"
                                class="aw-input"
                                [disabled]="isReadOpenMode"
                                [(ngModel)]="equipment.bidoEquipmentDTO.snManufacturer"
                              />
                            </div>
                          </div>

                          <div class="form-group general-field">
                            <label class="form-label">{{
                              componentData.componentId + ".manufacturingDate" | translate
                            }}</label>

                            <div class="form-control">
                              <p-calendar
                                showButtonBar="true"
                                [monthNavigator]="true"
                                [yearNavigator]="true"
                                [yearRange]="sessionService.calendarYearRange"
                                class="aw-calendar"
                                [dateFormat]="sessionService.dateFormatPrimeNG"
                                [locale]="sessionService.calendarFormat"
                                [(ngModel)]="equipment.bidoEquipmentDTO.manufacturingDate"
                                [disabled]="isReadOpenMode"
                              >
                              </p-calendar>
                            </div>
                          </div>
                          <div class="form-group">
                            <label class="form-label">{{
                              componentData.componentId + ".configurationTracked" | translate
                            }}</label>

                            <div class="form-control">
                              <p-checkbox
                                class="aw-checkbox"
                                binary="true"
                                [disabled]="isReadOpenMode"
                                [(ngModel)]="configurationTracked"
                                [disabled]="isReadOpenMode"
                              ></p-checkbox>
                            </div>
                          </div>
                          <div class="form-group">
                            <label class="form-label">{{ componentData.componentId + ".rating" | translate }}</label>

                            <div class="form-control">
                              <input
                                type="text"
                                class="aw-input"
                                [disabled]="true"
                                [(ngModel)]="equipmentRatingCodeAndName"
                              />
                            </div>
                          </div>
                        </div>
                        <aw-dynamic-attributes [showHistory]="true"> </aw-dynamic-attributes>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </mat-tab>
        <mat-tab *ngIf="!isCreateOpenMode" id="documentTab">
          <ng-template mat-tab-label>
            {{ componentData.componentId + ".tabDocument" | translate }}
          </ng-template>
          <div class="grid-row">
            <div class="grid-cell--12">
              <div class="grid-cell grid-cell--container">
                <div class="grid-cell-header">
                  <div class="grid-cell-title-container">
                    <h3 class="grid-cell-title">
                      {{ componentData.componentId + ".tabDocument" | translate }} ({{
                        documentTableDataSource ? documentTableDataSource.dataCount : 0
                      }})
                    </h3>
                  </div>
                </div>

                <div class="grid-cell-content">
                  <a-table [dataSource]="documentTableDataSource">
                    <ng-template tableActionsDef>
                      <button
                        *ngIf="documentTableDataSource.hasDataSelection"
                        type="button"
                        mat-raised-button
                        (click)="downloadFiles()"
                      >
                        {{ "global.download" | translate }}
                      </button>
                      <button
                        *ngIf="!isReadOpenMode && documentTableDataSource.hasDataSelection"
                        type="button"
                        mat-raised-button
                        color="warn"
                        (click)="deleteDocuments()"
                      >
                        {{ "global.delete" | translate }}
                      </button>
                      <button
                        *ngIf="!isReadOpenMode && documentTableDataSource.dataSelectionCount === 1"
                        type="button"
                        mat-raised-button
                        (click)="editDocument()"
                      >
                        {{ "global.edit" | translate }}
                      </button>

                      <button
                        *ngIf="!isReadOpenMode && documentTableDataSource.dataSelectionCount === 1"
                        type="button"
                        mat-raised-button
                        (click)="openDocument()"
                      >
                        {{ "global.open" | translate }}
                      </button>
                      <p-fileUpload
                        #fileUploader
                        *ngIf="!isReadOpenMode && !documentTableDataSource.hasDataSelection"
                        chooseLabel="{{ 'global.upload' | translate }}"
                        name="document[]"
                        customUpload="true"
                        mode="basic"
                        auto="true"
                        (uploadHandler)="uploadDocument($event, fileUploader)"
                      ></p-fileUpload>
                    </ng-template>
                    <ng-template columnDef="docEndOfValidityDate" let-rowData="rowData">
                      {{ rowData.docEndOfValidityDate | date: "shortDate":"":translateService.currentLang }}
                    </ng-template>
                    <ng-template columnDef="docExtension" let-rowData="rowData">
                      <span> {{ showDocExtension(rowData) }} </span>
                    </ng-template>
                    <ng-template columnDef="docPublicationDate" let-rowData="rowData">
                      <span>
                        {{ rowData.docPublication | date: "shortDate":"":translateService.currentLang }}
                      </span>
                    </ng-template>
                  </a-table>
                </div>
              </div>
            </div>
          </div>
        </mat-tab>
      </mat-tab-group>
    </div>
  </div>
</div>

<aw-document-upload-dialog
  *ngIf="showAddDocumentDialog"
  [(display)]="showAddDocumentDialog"
  [openMode]="documentDialogOpenMode"
  [document]="currentDocument"
  [types]="documentTypes"
  (onValidated)="addNewDocument($event)"
>
</aw-document-upload-dialog>
