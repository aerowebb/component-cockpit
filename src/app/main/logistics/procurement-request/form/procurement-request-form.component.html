<div class="page-header">
  <div class="page-info">
    <div>
      <h2 class="page-title">
        {{ "transaction." + componentData.componentId | translate }}
      </h2>

      <div class="page-subtitle">
        <div *ngIf="procurementRequest.procCode" class="page-subtitle">- {{ procurementRequest.procCode }}</div>
      </div>
    </div>

    <div
      class="object-status"
      [ngClass]="{
        disabled: procurementRequest.procStatus == aWPropertiesConstants.PROCUREMENT_REQUEST_STATUS_CANCELED
      }"
      *ngIf="procurementRequest.procStatus"
      (click)="showStatus()"
    >
      {{ procurementRequest.procStatus | formatSelectOption: procurementRequestStatuses }}
    </div>
  </div>

  <div class="page-actions">
    <button
      *ngIf="
        isReadOpenMode &&
        (procurementRequest.procStatus == aWPropertiesConstants.PROCUREMENT_REQUEST_STATUS_DRAFT ||
          procurementRequest.procStatus == aWPropertiesConstants.PROCUREMENT_REQUEST_STATUS_PLANNED ||
          procurementRequest.procStatus == aWPropertiesConstants.PROCUREMENT_REQUEST_STATUS_RELEASED ||
          procurementRequest.procStatus == aWPropertiesConstants.PROCUREMENT_REQUEST_STATUS_SIMULATED)
      "
      type="button"
      mat-raised-button
      (click)="edit()"
    >
      {{ "global.edit" | translate }}
    </button>

    <button
      *ngIf="isReadOpenMode && procurementRequest.procStatus != aWPropertiesConstants.PROCUREMENT_REQUEST_STATUS_DRAFT"
      type="button"
      color="primary"
      mat-raised-button
      (click)="duplicate()"
    >
      {{ "duplicate" | translate }}
    </button>

    <button *ngIf="!isReadOpenMode" type="button" color="warn" mat-raised-button (click)="cancel()">
      {{ "global.cancel" | translate }}
    </button>

    <button *ngIf="!isReadOpenMode" type="button" mat-raised-button (click)="save()" [disabled]="!canSave()">
      {{ "save" | translate }}
    </button>

    <button
      mat-icon-button
      class="mat-elevation-z1"
      matTooltip="{{ 'global.showAllActionTooltip' | translate }}"
      matTooltipPosition="above"
      aria-label="Show all actions"
      [matMenuTriggerFor]="actions"
    >
      <mat-icon>more_horiz</mat-icon>
    </button>
    <mat-menu #actions="matMenu">
      <button mat-menu-item (click)="reload()">{{ "global.refresh" | translate }}</button>
      <!-- <button mat-menu-item (click)="remove()">{{ "global.delete" | translate }}</button> -->
      <button mat-menu-item (click)="updateFavoriteState()">
        {{ (isFavoriteEntry ? "page.removeFromFavorites" : "page.addToFavorites") | translate }}
      </button>
    </mat-menu>
  </div>
</div>

<div class="page-wrapper">
  <div class="page-container">
    <mat-tab-group animationDuration="0ms" dynamicHeight>
      <mat-tab>
        <ng-template mat-tab-label>
          {{ "home" | translate }}
        </ng-template>

        <div class="grid-row">
          <div class="grid-cell--6">
            <div class="grid-cell grid-cell--container">
              <div class="grid-cell-header">
                <div class="grid-cell-title-container">
                  <h3 class="grid-cell-title">
                    {{ getComponentName() + ".mainInformations" | translate }}
                  </h3>
                </div>
              </div>

              <div class="grid-cell-content">
                <div class="column">
                  <div class="row">
                    <div class="form-group flex--2">
                      <label class="form-label">{{ getComponentName() + ".type" | translate }}</label>

                      <div class="form-control">
                        <div class="form-control-generic">
                          {{ procurementRequest.procType | formatSelectOption: procurementRequestTypes }}
                        </div>
                      </div>
                    </div>

                    <div class="form-group" [ngClass]="{ required: !isReadOpenMode }">
                      <label class="form-label">{{ getComponentName() + ".criticity" | translate }}</label>

                      <div
                        class="form-control alert"
                        [ngClass]="{
                          'procurement--ok':
                            isReadOpenMode &&
                            procurementRequest.criticality == aWPropertiesConstants.LOGISTICAL_CRITICALITY_ROUTINE,
                          'procurement--warning':
                            isReadOpenMode &&
                            procurementRequest.criticality == aWPropertiesConstants.LOGISTICAL_CRITICALITY_URGENT,
                          'procurement--nok':
                            isReadOpenMode &&
                            procurementRequest.criticality == aWPropertiesConstants.LOGISTICAL_CRITICALITY_IMMEDIATE
                        }"
                      >
                        <p-dropdown
                          class="aw-dropdown fixed-width"
                          [options]="procurementRequestCriticities"
                          placeholder="&nbsp;"
                          [showClear]="true"
                          [(ngModel)]="procurementRequest.criticality"
                          [disabled]="isReadOpenMode"
                        ></p-dropdown>
                      </div>
                    </div>
                  </div>

                  <div class="row">
                    <div class="form-group">
                      <label class="form-label">
                        {{ "criticityReason" | translate }}
                      </label>

                      <div class="form-control">
                        <textarea
                          class="aw-textarea"
                          [rows]="2"
                          pInputTextarea
                          autoResize="autoResize"
                          [disabled]="isReadOpenMode"
                          [(ngModel)]="procurementRequest.criticalityReason"
                        ></textarea>
                      </div>
                    </div>

                    <div class="form-group" [ngClass]="{ 'visibility--hidden': !isExpectedSnVisible() }">
                      <label class="form-label"> {{ getComponentName() + ".expectedSn" | translate }} </label>

                      <div class="form-control">
                        <input
                          class="aw-input"
                          name="value"
                          type="text"
                          [disabled]="true"
                          [(ngModel)]="procurementRequest.procComment"
                        />
                      </div>
                    </div>
                  </div>

                  <div class="row">
                    <div class="form-group">
                      <label class="form-label">{{ getComponentName() + ".applicant" | translate }}</label>

                      <div class="form-control">
                        <div class="form-control-generic">{{ userName }} ({{ userLogin }})</div>
                      </div>
                    </div>

                    <div class="form-group">
                      <label class="form-label">{{ getComponentName() + ".createdOn" | translate }}</label>

                      <div class="form-control">
                        <p-calendar
                          showButtonBar="true"
                          [monthNavigator]="true"
                          [yearNavigator]="true"
                          [yearRange]="sessionService.calendarYearRange"
                          class="aw-calendar"
                          [dateFormat]="sessionService.dateFormatPrimeNG"
                          [locale]="sessionService.calendarFormat"
                          [(ngModel)]="procurementRequest.statusDate"
                          [showTime]="true"
                          [disabled]="true"
                        ></p-calendar>
                      </div>
                    </div>

                    <div class="form-group" [ngClass]="{ required: !isReadOpenMode }">
                      <label class="form-label">{{ getComponentName() + ".requestedDate" | translate }}</label>

                      <div class="form-control">
                        <p-calendar
                          showButtonBar="true"
                          [monthNavigator]="true"
                          [yearNavigator]="true"
                          [yearRange]="sessionService.calendarYearRange"
                          class="aw-calendar"
                          [dateFormat]="sessionService.dateFormatPrimeNG"
                          [locale]="sessionService.calendarFormat"
                          [(ngModel)]="procurementRequest.requestedDate"
                          [disabled]="isReadOpenMode"
                          appendTo="body"
                        ></p-calendar>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <div class="grid-cell--3">
            <div class="grid-cell grid-cell--container">
              <div class="grid-cell-header">
                <div class="grid-cell-title-container">
                  <h3 class="grid-cell-title">
                    {{ getComponentName() + ".shipper" | translate }}
                  </h3>
                </div>
              </div>

              <div class="grid-cell-content">
                <div class="column">
                  <div class="form-group" *ngIf="procurementRequest.bidoCustomer">
                    <label class="form-label">{{ getComponentName() + ".partner" | translate }}</label>

                    <div class="form-control">
                      <div class="form-control-generic">
                        {{ procurementRequest.bidoCustomer.customerName }}
                      </div>
                    </div>
                  </div>

                  <div class="form-group" *ngIf="procurementRequest.bidtSiteIssue">
                    <label class="form-label">{{ getComponentName() + ".site" | translate }}</label>

                    <div class="form-control">
                      <div class="form-control-generic">
                        {{ procurementRequest.bidtSiteIssue.siteCode }} -
                        {{ procurementRequest.bidtSiteIssue.siteName }}
                      </div>
                    </div>
                  </div>

                  <div class="form-group" *ngIf="procurementRequest.bidtWarehouseIssue">
                    <label class="form-label">{{ "warehouse" | translate }}</label>

                    <div class="form-control">
                      <div class="form-control-generic">
                        {{ procurementRequest.bidtWarehouseIssue.whCode }} -
                        {{ procurementRequest.bidtWarehouseIssue.whName }}
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <div class="grid-cell--3">
            <div class="grid-cell grid-cell--container">
              <div class="grid-cell-header">
                <div class="grid-cell-title-container">
                  <h3 class="grid-cell-title">
                    {{ getComponentName() + ".recipient" | translate }}
                  </h3>
                </div>
              </div>

              <div class="grid-cell-content">
                <div class="column">
                  <div class="form-group" *ngIf="procurementRequest.bidtSiteReceipt">
                    <label class="form-label">{{ getComponentName() + ".site" | translate }}</label>

                    <div class="form-control">
                      <div class="form-control-generic">
                        {{ procurementRequest.bidtSiteReceipt.siteCode }}
                        <ng-container *ngIf="procurementRequest.bidtSiteReceipt.siteName">
                          - {{ procurementRequest.bidtSiteReceipt.siteName }}
                        </ng-container>
                      </div>
                    </div>
                  </div>

                  <div class="form-group" *ngIf="procurementRequest.bidtWarehouseReceipt">
                    <label class="form-label">{{ getComponentName() + ".warehouseWorkshop" | translate }}</label>

                    <div class="form-control">
                      <div class="form-control-generic">
                        {{ procurementRequest.bidtWarehouseReceipt.whCode }}
                        <ng-container *ngIf="procurementRequest.bidtWarehouseReceipt.whName">
                          - {{ procurementRequest.bidtWarehouseReceipt.whName }}
                        </ng-container>
                      </div>
                    </div>
                  </div>

                  <div class="form-group" *ngIf="workPackageAsset">
                    <label class="form-label">
                      <ng-container
                        *ngIf="workPackageAsset.equipmentFunction == aWPropertiesConstants.FAMILY_FUNCTION_AIRCRAFT_KEY"
                      >
                        {{ "aircraft" | translate }}
                      </ng-container>
                      <ng-container
                        *ngIf="workPackageAsset.equipmentFunction == aWPropertiesConstants.FAMILY_FUNCTION_ENGINE_KEY"
                      >
                        {{ "engine" | translate }}
                      </ng-container>
                      <ng-container
                        *ngIf="
                          workPackageAsset.equipmentFunction != aWPropertiesConstants.FAMILY_FUNCTION_AIRCRAFT_KEY &&
                          workPackageAsset.equipmentFunction != aWPropertiesConstants.FAMILY_FUNCTION_ENGINE_KEY
                        "
                      >
                        {{ "equipment" | translate }}
                      </ng-container>
                    </label>

                    <div class="form-control">
                      <div class="form-control-generic">
                        <a (click)="openWorkPackageAsset()">{{ workPackageAssetName }}</a>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="grid-row">
          <div class="grid-cell--4">
            <div class="grid-cell grid-cell--container">
              <div class="grid-cell-header">
                <div class="grid-cell-title-container">
                  <h3 class="grid-cell-title">
                    {{ getComponentName() + ".origine" | translate }}
                  </h3>
                </div>
              </div>

              <div class="grid-cell-content">
                <div class="row">
                  <div class="form-group">
                    <label class="form-label">{{ getComponentName() + ".documentNumber" | translate }}</label>

                    <div class="form-control form-control-with-modal" *ngIf="!isReadOpenMode">
                      <div class="form-control-data" (click)="openWoDialog()">
                        <a class="link" (click)="openWorkOrder()" *ngIf="procurementRequest.bidmWorkOrder">
                          {{ procurementRequest.bidmWorkOrder?.woCode }}
                        </a>
                      </div>

                      <div *ngIf="procurementRequest.bidmWorkOrder" class="btn-clear-wrapper">
                        <i
                          class="ui-dropdown-clear-icon pi pi-times aw-icon btn-clear"
                          aria-hidden="true"
                          (click)="eraseWo()"
                        ></i>
                      </div>
                      <div class="btn-search-wrapper">
                        <i
                          class="fa fa-fw fa-search aw-icon btn-search"
                          aria-hidden="true"
                          (click)="openWoDialog()"
                        ></i>
                      </div>
                    </div>

                    <div class="form-control form-control-generic" *ngIf="isReadOpenMode">
                      <a
                        class="link"
                        (click)="openWorkOrder()"
                        *ngIf="procurementRequest.bidmWorkOrder"
                        style="cursor: pointer;"
                      >
                        {{ procurementRequest.bidmWorkOrder?.woCode }}
                      </a>
                    </div>
                  </div>
                  <div class="form-group">
                    <label class="form-label">{{ getComponentName() + ".type" | translate }}</label>

                    <div class="form-control">
                      <div class="form-control-generic">
                        <ng-container
                          *ngIf="procurementRequest.bidmWorkOrder && procurementRequest.bidmWorkOrder.woCode"
                        >
                          {{ "workOrder" | translate }}
                        </ng-container>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <div class="grid-cell--4">
            <div class="grid-cell grid-cell--container">
              <div class="grid-cell-header">
                <div class="grid-cell-title-container">
                  <h3 class="grid-cell-title">
                    {{ getComponentName() + ".desiredPotential" | translate }}
                  </h3>
                </div>
              </div>

              <div class="grid-cell-content">
                <div class="row" *ngIf="procurementRequestUnits.length == 0">
                  <div class="form-group">
                    <div class="form-control">
                      <div class="form-control-generic" style="font-style: italic;">
                        {{ getComponentName() + ".noPotentialUnit" | translate }}
                      </div>
                    </div>
                  </div>
                </div>

                <div class="row">
                  <div class="form-group" *ngIf="procurementRequestUnits.length > 0">
                    <label class="form-label">{{ getComponentName() + ".value" | translate }}</label>

                    <div class="form-control">
                      <input
                        class="aw-input"
                        type="text"
                        [(ngModel)]="procurementRequest.requestedPotential"
                        *ngIf="!isReadOpenMode"
                      />

                      <ng-container *ngIf="isReadOpenMode">
                        {{ procurementRequest.requestedPotential | formatNumber }}
                      </ng-container>
                    </div>
                  </div>

                  <div class="form-group" *ngIf="procurementRequestUnits.length > 0">
                    <label class="form-label">{{ getComponentName() + ".unit" | translate }}</label>

                    <div class="form-control">
                      <p-dropdown
                        class="aw-dropdown fixed-width"
                        [disabled]="isReadOpenMode"
                        [options]="procurementRequestUnits"
                        [(ngModel)]="procurementRequest.potentialUnit"
                        [showClear]="true"
                        placeholder="&nbsp;"
                        appendTo="body"
                      ></p-dropdown>
                    </div>
                  </div>

                  <div class="form-group">
                    <label class="form-label">{{ getComponentName() + ".expiration" | translate }}</label>

                    <div class="form-control">
                      <p-calendar
                        showButtonBar="true"
                        [monthNavigator]="true"
                        [yearNavigator]="true"
                        [yearRange]="sessionService.calendarYearRange"
                        class="aw-calendar"
                        [dateFormat]="sessionService.dateFormatPrimeNG"
                        [locale]="sessionService.calendarFormat"
                        [disabled]="isReadOpenMode"
                        [(ngModel)]="procurementRequest.calendarPotential"
                      >
                      </p-calendar>
                    </div>
                  </div>

                  <div class="form-group flex--2" *ngIf="procurementRequestUnits.length == 0"></div>
                </div>
              </div>
            </div>
          </div>

          <div class="grid-cell--4">
            <div class="grid-cell grid-cell--container">
              <div class="grid-cell-header">
                <div class="grid-cell-title-container">
                  <h3 class="grid-cell-title">
                    {{ getComponentName() + ".progress" | translate }}
                  </h3>
                </div>
              </div>

              <div class="grid-cell-content">
                <div class="column">
                  <div class="row">
                    <div style="margin-left: 20px; max-width: 10rem; min-width: 10rem;">
                      <span class="bold">{{ getComponentName() + ".procurement" | translate }}</span>

                      <div
                        style="padding: 4px; margin-top: 4px; color: #000; border-radius: 4px; max-width: 6rem; min-width: 6rem; text-align: center;"
                        [ngClass]="{
                          'served--nok': servedNb == 0,
                          'served--ok': servedNb > 0 && isServed,
                          'served--warning': servedNb > 0 && !isServed
                        }"
                      >
                        <span *ngIf="servedNb == 0">
                          {{ componentData.componentId + ".notServed" | translate }}
                        </span>
                        <span *ngIf="servedNb > 0 && !isServed">
                          {{ componentData.componentId + ".partiallyServed" | translate }}
                        </span>
                        <span *ngIf="servedNb > 0 && isServed">
                          {{ componentData.componentId + ".served" | translate }}
                        </span>
                      </div>
                    </div>

                    <div class="form-group flex-row--align-center">
                      <div class="form-control">
                        <div class="form-control-generic" style="font-size: 2.5rem; padding-bottom: 1rem;">
                          {{ notBookedNb }}
                        </div>
                      </div>
                      <label class="form-label">
                        <ng-container
                          *ngIf="
                            procurementRequest.procStatus ==
                              aWPropertiesConstants.PROCUREMENT_REQUEST_STATUS_SIMULATED ||
                            procurementRequest.procStatus == aWPropertiesConstants.PROCUREMENT_REQUEST_STATUS_PLANNED ||
                            procurementRequest.procStatus == aWPropertiesConstants.PROCUREMENT_REQUEST_STATUS_DRAFT
                          "
                        >
                          {{ getComponentName() + ".notSelected" | translate }}
                        </ng-container>
                        <ng-container
                          *ngIf="
                            procurementRequest.procStatus !=
                              aWPropertiesConstants.PROCUREMENT_REQUEST_STATUS_SIMULATED &&
                            procurementRequest.procStatus != aWPropertiesConstants.PROCUREMENT_REQUEST_STATUS_PLANNED &&
                            procurementRequest.procStatus != aWPropertiesConstants.PROCUREMENT_REQUEST_STATUS_DRAFT
                          "
                        >
                          {{ getComponentName() + ".notBooked" | translate }}
                        </ng-container>
                      </label>
                    </div>

                    <div class="form-group flex-row--align-center">
                      <div class="form-control">
                        <div class="form-control-generic" style="font-size: 2.5rem; padding-bottom: 1rem">
                          {{ bookedNb }}
                        </div>
                      </div>
                      <label class="form-label">
                        <ng-container
                          *ngIf="
                            procurementRequest.procStatus ==
                              aWPropertiesConstants.PROCUREMENT_REQUEST_STATUS_SIMULATED ||
                            procurementRequest.procStatus == aWPropertiesConstants.PROCUREMENT_REQUEST_STATUS_PLANNED ||
                            procurementRequest.procStatus == aWPropertiesConstants.PROCUREMENT_REQUEST_STATUS_DRAFT
                          "
                        >
                          {{ getComponentName() + ".selected" | translate }}
                        </ng-container>
                        <ng-container
                          *ngIf="
                            procurementRequest.procStatus !=
                              aWPropertiesConstants.PROCUREMENT_REQUEST_STATUS_SIMULATED &&
                            procurementRequest.procStatus != aWPropertiesConstants.PROCUREMENT_REQUEST_STATUS_PLANNED &&
                            procurementRequest.procStatus != aWPropertiesConstants.PROCUREMENT_REQUEST_STATUS_DRAFT
                          "
                        >
                          {{ getComponentName() + ".booked" | translate }}
                        </ng-container>
                      </label>
                    </div>

                    <div class="form-group flex-row--align-center">
                      <div class="form-control">
                        <div class="form-control-generic" style="font-size: 2.5rem; padding-bottom: 1rem">
                          {{ servedNb }}
                        </div>
                      </div>
                      <label class="form-label">{{ getComponentName() + ".served" | translate }}</label>
                    </div>
                  </div>

                  <div
                    class="row"
                    style="margin-top: 16px;"
                    *ngIf="
                      procurementRequest.procType == aWPropertiesConstants.PROCUREMENT_REQUEST_TYPE_MAINTENANCE_ES ||
                      procurementRequest.procType == aWPropertiesConstants.PROCUREMENT_REQUEST_TYPE_STOCK_LEVELING_ES
                    "
                  >
                    <div style="margin-left: 20px; max-width: 10rem; min-width: 10rem;">
                      <span class="bold">{{ getComponentName() + ".reverse" | translate }}</span>

                      <div
                        style="padding: 4px; margin-top: 4px; color: #000; border-radius: 4px; max-width: 6rem; min-width: 6rem; text-align: center;"
                        [ngClass]="{
                          'served--nok': notReversedNb > 0 && reversedNb == 0,
                          'served--ok': notReversedNb == 0 && reversedNb > 0,
                          'served--warning': notReversedNb > 0 && reversedNb > 0
                        }"
                      >
                        <span *ngIf="notReversedNb > 0 && reversedNb == 0">
                          {{ componentData.componentId + ".notReversed" | translate }}
                        </span>
                        <span *ngIf="notReversedNb > 0 && reversedNb > 0">
                          {{ componentData.componentId + ".partiallyReversed" | translate }}
                        </span>
                        <span *ngIf="notReversedNb == 0 && reversedNb > 0">
                          {{ componentData.componentId + ".reversed" | translate }}
                        </span>
                      </div>
                    </div>

                    <div class="form-group flex-row--align-center">
                      <div class="form-control">
                        <div class="form-control-generic" style="font-size: 2.5rem; padding-bottom: 1rem">
                          {{ notReversedNb }}
                        </div>
                      </div>
                      <label class="form-label">{{ getComponentName() + ".notReversed" | translate }}</label>
                    </div>

                    <div class="form-group flex-row--align-center">
                      <div class="form-control">
                        <div class="form-control-generic" style="font-size: 2.5rem; padding-bottom: 1rem">
                          {{ reversedNb }}
                        </div>
                      </div>
                      <label class="form-label">{{ getComponentName() + ".reversed" | translate }}</label>
                    </div>

                    <div class="form-group"></div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </mat-tab>

      <mat-tab>
        <ng-template mat-tab-label>
          {{ componentData.componentId + ".items" | translate }}
        </ng-template>

        <div class="grid-row">
          <div class="grid-cell--12">
            <div class="grid-cell grid-cell--container grid-cell-items">
              <div class="grid-cell-header">
                <div class="grid-cell-title-container">
                  <h3 class="grid-cell-title">
                    {{ componentData.componentId + ".procurementItems" | translate }} ({{
                      procurementRequest.bidtProcReqItems ? procurementRequest.bidtProcReqItems.length : 0
                    }})
                  </h3>
                </div>
              </div>

              <div class="grid-cell-content grid-cell-content-with-section">
                <div class="row flex-row--justify-end">
                  <button type="button" mat-raised-button (click)="showItemDialog()" *ngIf="!isReadOpenMode">
                    {{ componentData.componentId + ".addItem" | translate }}
                  </button>
                </div>

                <div class="row">
                  <div class="section">
                    <h4 class="section-title">
                      {{ componentData.componentId + ".materials" | translate }}
                    </h4>

                    <div class="section-content">
                      <p-table
                        id="items-table"
                        class="aw-table2"
                        [value]="procurementRequestItems"
                        [(selection)]="selectedProcurementRequestItem"
                        selectionMode="single"
                        (onRowSelect)="onSelectProcurementRequestItem()"
                        (onRowUnselect)="onSelectProcurementRequestItem()"
                      >
                        <ng-template pTemplate="body" let-rowData let-rowIndex="rowIndex">
                          <tr
                            [pSelectableRow]="rowData"
                            [pSelectableRowIndex]="rowIndex"
                            [ngStyle]="{ 'background-color': '#ffffff' }"
                          >
                            <td>
                              <div>
                                <div style="display: flex; flex-direction: row;">
                                  <div style="min-width: 3rem; display: inline-block; flex-grow: 1;">
                                    <a style="font-weight: 600" (click)="openArticle(rowData['obj'].birePn?.pnCode)">
                                      {{ rowData["obj"].birePn?.pnCode }}
                                    </a>
                                  </div>

                                  <div>
                                    {{ componentData.componentId + ".requestedQty" | translate }} =
                                    <span style="font-weight: 600">
                                      {{ rowData["obj"].requestedQuantity | formatNumber }}
                                    </span>
                                    <span *ngIf="rowData['obj'].birePn?.quantityUnit">
                                      {{ rowData["obj"].birePn?.quantityUnit }}
                                    </span>
                                  </div>
                                </div>

                                <div style="display: flex; flex-direction: row;">
                                  <div style="min-width: 3rem; display: inline-block; flex-grow: 1;">
                                    {{ rowData["obj"].birePn?.otanPnReference }}
                                  </div>

                                  <div *ngIf="rowData['obj'].birePn?.quantityPerIssue">
                                    ({{ "distributionQuantityShort" | translate }} =
                                    {{ rowData["obj"].birePn.quantityPerIssue | formatNumber }})
                                  </div>
                                </div>
                              </div>

                              <div
                                style="font-style: italic; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; padding-bottom: 1.5rem;"
                              >
                                {{ rowData["obj"].birePn?.articleDesignation }}
                              </div>

                              <div *ngIf="rowData['siteName']" style="display: flex; justify-content: space-between;">
                                <span style="color: #01579b;;">{{ getComponentName() + ".supplier" | translate }}</span>
                                <span class="bold">{{ rowData["siteName"] }}</span>
                              </div>

                              <div style="padding-bottom: 0.6rem; text-align: end;" *ngIf="rowData['warehouseName']">
                                <span class="italic">{{ rowData["warehouseName"] }}</span>
                              </div>

                              <div>
                                <div style="min-width: 8rem; display: inline-block;">
                                  <ng-container
                                    *ngIf="
                                      procurementRequest.procStatus ==
                                        aWPropertiesConstants.PROCUREMENT_REQUEST_STATUS_SIMULATED ||
                                      procurementRequest.procStatus ==
                                        aWPropertiesConstants.PROCUREMENT_REQUEST_STATUS_PLANNED ||
                                      procurementRequest.procStatus ==
                                        aWPropertiesConstants.PROCUREMENT_REQUEST_STATUS_DRAFT
                                    "
                                  >
                                    {{ getComponentName() + ".notSelected" | translate }}
                                  </ng-container>
                                  <ng-container
                                    *ngIf="
                                      procurementRequest.procStatus !=
                                        aWPropertiesConstants.PROCUREMENT_REQUEST_STATUS_SIMULATED &&
                                      procurementRequest.procStatus !=
                                        aWPropertiesConstants.PROCUREMENT_REQUEST_STATUS_PLANNED &&
                                      procurementRequest.procStatus !=
                                        aWPropertiesConstants.PROCUREMENT_REQUEST_STATUS_DRAFT
                                    "
                                  >
                                    {{ getComponentName() + ".notBooked" | translate }}
                                  </ng-container>
                                </div>
                                <span style="font-weight: 600">{{ rowData["notBookedNb"] }}</span>
                              </div>

                              <div>
                                <div style="min-width: 8rem; display: inline-block;">
                                  <ng-container
                                    *ngIf="
                                      procurementRequest.procStatus ==
                                        aWPropertiesConstants.PROCUREMENT_REQUEST_STATUS_SIMULATED ||
                                      procurementRequest.procStatus ==
                                        aWPropertiesConstants.PROCUREMENT_REQUEST_STATUS_PLANNED ||
                                      procurementRequest.procStatus ==
                                        aWPropertiesConstants.PROCUREMENT_REQUEST_STATUS_DRAFT
                                    "
                                  >
                                    {{ getComponentName() + ".selected" | translate }}
                                  </ng-container>
                                  <ng-container
                                    *ngIf="
                                      procurementRequest.procStatus !=
                                        aWPropertiesConstants.PROCUREMENT_REQUEST_STATUS_SIMULATED &&
                                      procurementRequest.procStatus !=
                                        aWPropertiesConstants.PROCUREMENT_REQUEST_STATUS_PLANNED &&
                                      procurementRequest.procStatus !=
                                        aWPropertiesConstants.PROCUREMENT_REQUEST_STATUS_DRAFT
                                    "
                                  >
                                    {{ getComponentName() + ".booked" | translate }}
                                  </ng-container>
                                </div>
                                <span style="font-weight: 600">{{ rowData["bookedNb"] }}</span>
                              </div>

                              <div>
                                <div style="min-width: 8rem; display: inline-block;">
                                  {{ getComponentName() + ".served" | translate }}
                                </div>
                                <span style="font-weight: 600">{{ rowData["servedNb"] }}</span>
                              </div>

                              <div
                                style="display: flex; flex-direction: row; justify-content: space-between; align-items: center;"
                                *ngIf="
                                  procurementRequest.procStatus !=
                                  aWPropertiesConstants.PROCUREMENT_REQUEST_STATUS_CANCELED
                                "
                              >
                                <div
                                  style="padding: 8px; color: #000; border-radius: 4px;"
                                  [ngClass]="{
                                    'served--nok': rowData['servedNb'] == 0,
                                    'served--ok': rowData['servedNb'] > 0 && rowData['servedNb'] == rowData['allNb'],
                                    'served--warning':
                                      rowData['servedNb'] > 0 && rowData['servedNb'] != rowData['allNb']
                                  }"
                                >
                                  <span *ngIf="rowData['servedNb'] == 0">
                                    {{ componentData.componentId + ".notServed" | translate }}
                                  </span>
                                  <span *ngIf="rowData['servedNb'] > 0 && rowData['servedNb'] != rowData['allNb']">
                                    {{ componentData.componentId + ".partiallyServed" | translate }}
                                  </span>
                                  <span *ngIf="rowData['servedNb'] > 0 && rowData['servedNb'] == rowData['allNb']">
                                    {{ componentData.componentId + ".served" | translate }}
                                  </span>
                                </div>

                                <div>
                                  <button
                                    class="actions-btn"
                                    mat-icon-button
                                    class="mat-elevation-z1"
                                    [matMenuTriggerFor]="itemActions"
                                    (click)="stopPropagation($event)"
                                    *ngIf="
                                      selectedProcurementRequestItem &&
                                      rowData.obj === selectedProcurementRequestItem.obj &&
                                      procurementRequest.procStatus !==
                                        aWPropertiesConstants.PROCUREMENT_REQUEST_STATUS_CLOSED
                                    "
                                  >
                                    <mat-icon>more_horiz</mat-icon>
                                  </button>
                                  <mat-menu #itemActions="matMenu">
                                    <button
                                      mat-menu-item
                                      (click)="manageProcurementRequestItem(rowData)"
                                      *ngIf="
                                        procurementRequest.procStatus !=
                                        aWPropertiesConstants.PROCUREMENT_REQUEST_STATUS_DRAFT
                                      "
                                    >
                                      {{ componentData.componentId + ".manage" | translate }}
                                    </button>
                                    <button
                                      mat-menu-item
                                      (click)="editProcReqItemQuantity(rowData)"
                                      *ngIf="
                                        rowData.obj.priStatus !=
                                          aWPropertiesConstants.PROCUREMENT_REQUEST_STATUS_CLOSED ||
                                        rowData.obj.priStatus !=
                                          aWPropertiesConstants.PROCUREMENT_REQUEST_STATUS_CANCELED
                                      "
                                    >
                                      {{ "editQuantity" | translate }}
                                    </button>
                                    <button mat-menu-item (click)="deleteProcurementRequestItem(rowData)">
                                      {{ "delete" | translate }}
                                    </button>
                                  </mat-menu>
                                </div>
                              </div>
                            </td>
                          </tr>
                        </ng-template>
                      </p-table>
                    </div>
                  </div>

                  <div class="section">
                    <h4 class="section-title">
                      {{ componentData.componentId + ".selectedAsset" | translate }}
                    </h4>

                    <div class="section-content">
                      <p-table
                        *ngIf="selectedProcurementRequestItem"
                        class="aw-table2"
                        [value]="workshopEntries"
                        [(selection)]="selectedWorkshopEntry"
                        selectionMode="single"
                        (onRowSelect)="onSelectWorkshopEntry()"
                        (onRowUnselect)="onSelectWorkshopEntry()"
                      >
                        <ng-template pTemplate="body" let-rowData let-rowIndex="rowIndex">
                          <tr [pSelectableRow]="rowData" [pSelectableRowIndex]="rowIndex">
                            <td>
                              <div
                                *ngIf="!rowData.obj['stockMvtSn'] && !rowData.obj['stockMvtBatchNumber']"
                                style="font-style: italic;"
                              >
                                {{ getComponentName() + ".noSelectedAsset" | translate }}
                              </div>

                              <div *ngIf="rowData.obj['stockMvtSn'] || rowData.obj['stockMvtBatchNumber']">
                                <div>
                                  <span style="min-width: 9rem; display: inline-block;">
                                    {{ "packagingNumber" | translate }}
                                  </span>
                                  <a class="bold" (click)="openBatch(rowData)">
                                    {{ rowData.obj["stockMvtBatchNumber"] }}
                                  </a>
                                </div>

                                <div *ngIf="!rowData.obj['stockMvtSn']">
                                  <span style="min-width: 9rem; display: inline-block;">{{
                                    getComponentName() + ".quantity" | translate
                                  }}</span>
                                  <span class="bold" *ngIf="rowData.obj['stockMvtQuantity']">
                                    {{ rowData.obj["stockMvtQuantity"] | formatNumber }}
                                  </span>
                                  <span class="bold" *ngIf="rowData.obj['stockMvtUnit']">
                                    {{ rowData.obj["stockMvtUnit"] }}
                                  </span>
                                </div>

                                <div>
                                  <span style="min-width: 9rem; display: inline-block;">
                                    {{ (rowData.obj["stockMvtSn"] ? "sn" : "manufacturingBatch") | translate }}
                                  </span>
                                  <a class="bold" (click)="openEquipment(rowData)" *ngIf="rowData.obj['stockMvtSn']">
                                    {{ rowData.obj["stockMvtSn"] }}
                                  </a>
                                  <a
                                    class="bold"
                                    (click)="openManufacturingBatch(rowData)"
                                    *ngIf="!rowData.obj['stockMvtSn']"
                                  >
                                    {{ rowData["manufacturingBatch"]?.batchNumber }}
                                  </a>
                                </div>

                                <div>
                                  <span style="min-width: 9rem; display: inline-block;">
                                    {{ "status" | translate }}
                                  </span>
                                  <span class="bold">
                                    {{ rowData.equipment?.operationalStatus | formatSelectOption: operationalStatuses }}
                                  </span>
                                </div>
                              </div>

                              <div
                                style="display: flex; flex-direction: row; justify-content: flex-end;"
                                *ngIf="
                                  (rowData.obj['stockMvtSn'] || rowData.obj['stockMvtBatchNumber']) &&
                                  procurementRequest.procStatus !=
                                    aWPropertiesConstants.PROCUREMENT_REQUEST_STATUS_CANCELED
                                "
                              >
                                <button
                                  class="actions-btn"
                                  mat-icon-button
                                  class="mat-elevation-z1"
                                  [matMenuTriggerFor]="itemActions"
                                  (click)="stopPropagation($event)"
                                  *ngIf="isCancelBookingBtnVisible(rowData)"
                                >
                                  <mat-icon>more_horiz</mat-icon>
                                </button>
                                <mat-menu #itemActions="matMenu">
                                  <button mat-menu-item (click)="cancelBooking(rowData)">
                                    {{ "cancel" | translate }}
                                  </button>
                                </mat-menu>
                              </div>
                            </td>
                          </tr>
                        </ng-template>
                      </p-table>
                    </div>
                  </div>

                  <div class="section">
                    <h4 class="section-title">
                      {{ componentData.componentId + ".servedState" | translate }}
                    </h4>

                    <div class="section-content">
                      <aw-procurement-request-mvt-status
                        *ngIf="
                          selectedWorkshopEntry &&
                          selectedWorkshopEntry?.obj.bidtStockMvtTypeId !== bidtStockMvtTypeConstants.REMOVAL
                        "
                        [mvts]="stockMvtSubject.asObservable()"
                        [componentName]="'ProcurementRequestMvtStatusComponent'"
                        (onClick)="toggleDetailsTable($event)"
                      ></aw-procurement-request-mvt-status>

                      <a-table
                        [dataSource]="stockMvtTableDataSource"
                        *ngIf="
                          selectedWorkshopEntry &&
                          (showDetails ||
                            selectedWorkshopEntry?.obj.bidtStockMvtTypeId === bidtStockMvtTypeConstants.REMOVAL)
                        "
                        style="margin-top: 40px"
                      >
                        <ng-template columnDef="movement" let-rowData="rowData">
                          <div>
                            <a class="bold" (click)="openStovkMvt(rowData)">
                              {{ rowData["stockMvtCode"] }}
                            </a>
                          </div>

                          <div>
                            <span class="italic">{{ rowData["bidtStockMvtType"]?.smtName | extractTranslation }}</span>
                          </div>
                        </ng-template>

                        <ng-template columnDef="type" let-rowData="rowData">
                          <i
                            *ngIf="rowData['bidtStockMvtType']?.smtWay === bidtStockMvtConstants.MVT_WAY_CREDIT"
                            class="fa fa-fw fa-arrow-right procurement-type--in"
                            aria-hidden="true"
                            pTooltip="{{ componentData.componentId + '.receipt' | translate }}"
                          ></i>
                          <i
                            *ngIf="rowData['bidtStockMvtType']?.smtWay === bidtStockMvtConstants.MVT_WAY_DEBIT"
                            class="fa fa-fw fa-arrow-right procurement-type--out"
                            aria-hidden="true"
                            pTooltip="{{ componentData.componentId + '.issue' | translate }}"
                          ></i>
                          <i
                            *ngIf="rowData['bidtStockMvtType']?.smtWay === bidtStockMvtConstants.MVT_WAY_TRANSFER"
                            class="fa fa-fw fa-arrow-right procurement-type--transfer"
                            aria-hidden="true"
                            pTooltip="{{ componentData.componentId + '.transfer' | translate }}"
                          ></i>
                        </ng-template>

                        <ng-template columnDef="warehouseWorkshop" let-rowData="rowData">
                          <div
                            *ngIf="
                              rowData['bidtStockMvtType']?.smtWay === bidtStockMvtConstants.MVT_WAY_CREDIT ||
                              rowData['bidtStockMvtType']?.smtWay === bidtStockMvtConstants.MVT_WAY_TRANSFER
                            "
                          >
                            <span class="bold">{{ rowData["bidtSiteReceipt"]?.siteCode }}</span>
                          </div>
                          <div
                            *ngIf="
                              rowData['bidtStockMvtType']?.smtWay === bidtStockMvtConstants.MVT_WAY_CREDIT ||
                              rowData['bidtStockMvtType']?.smtWay === bidtStockMvtConstants.MVT_WAY_TRANSFER
                            "
                          >
                            <span class="italic">{{ rowData["bidtWarehouseReceipt"]?.whName }}</span>
                          </div>

                          <div *ngIf="rowData['bidtStockMvtType']?.smtWay === bidtStockMvtConstants.MVT_WAY_DEBIT">
                            <span class="bold">{{ rowData["bidtSiteIssue"]?.siteCode }}</span>
                          </div>
                          <div *ngIf="rowData['bidtStockMvtType']?.smtWay === bidtStockMvtConstants.MVT_WAY_DEBIT">
                            <span class="italic">{{ rowData["bidtWarehouseIssue"]?.whName }}</span>
                          </div>
                        </ng-template>

                        <ng-template columnDef="outbound" let-rowData="rowData">
                          <div *ngIf="rowData['bidtStorageBinZoneIssue']?.sbNumber">
                            <span class="bold">
                              {{ rowData["bidtStorageBinZoneIssue"]?.sbNumber }}
                              <ng-container *ngIf="rowData['bidtStorageBinZoneIssue']?.sbDescription">
                                - {{ rowData["bidtStorageBinZoneIssue"]?.sbDescription }}
                              </ng-container>
                            </span>
                          </div>

                          <div *ngIf="rowData['bidtStorageBinBinIssue']?.sbNumber">
                            <span class="bold">{{ rowData["bidtStorageBinBinIssue"]?.sbNumber }}</span>
                          </div>
                        </ng-template>

                        <ng-template columnDef="inbound" let-rowData="rowData">
                          <div *ngIf="rowData['bidtStorageBinZoneReceipt']?.sbNumber">
                            <span class="bold">
                              {{ rowData["bidtStorageBinZoneReceipt"]?.sbNumber }}
                              <ng-container *ngIf="rowData['bidtStorageBinZoneReceipt']?.sbDescription">
                                - {{ rowData["bidtStorageBinZoneReceipt"]?.sbDescription }}
                              </ng-container>
                            </span>
                          </div>

                          <div *ngIf="rowData['bidtStorageBinBinReceipt']?.sbNumber">
                            <span class="bold">{{ rowData["bidtStorageBinBinReceipt"]?.sbNumber }}</span>
                          </div>
                        </ng-template>

                        <ng-template columnDef="status" let-rowData="rowData">
                          <div>
                            <span class="bold">
                              {{ rowData["mvtStatus"] | formatSelectOption: stockMvtStatuses }}
                            </span>
                          </div>

                          <div>
                            {{
                              (rowData["stockMvtDate"] ? rowData["stockMvtDate"] : rowData["stockMvtPlannedDate"])
                                | date: "yyyy/MM/dd HH:mm":"":translateService.currentLang
                            }}
                          </div>
                        </ng-template>
                      </a-table>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div
          class="grid-row"
          *ngIf="
            procurementRequest.procType == aWPropertiesConstants.PROCUREMENT_REQUEST_TYPE_MAINTENANCE_ES ||
            procurementRequest.procType == aWPropertiesConstants.PROCUREMENT_REQUEST_TYPE_STOCK_LEVELING_ES
          "
        >
          <div class="grid-cell--12">
            <div class="grid-cell grid-cell--container grid-cell-items">
              <div class="grid-cell-header">
                <div class="grid-cell-title-container">
                  <h3 class="grid-cell-title">
                    {{ componentData.componentId + ".reverseItems" | translate }}
                    ({{ reverseProcurementRequestItems.length }})
                  </h3>
                </div>
              </div>

              <div class="grid-cell-content grid-cell-content-with-section">
                <!-- <div class="row flex-row--justify-end">
                  <button type="button" mat-raised-button (click)="showItemDialog()" *ngIf="!isReadOpenMode">
                    {{ componentData.componentId + ".addItem" | translate }}
                  </button>
                </div> -->

                <div class="row">
                  <div class="section">
                    <h4 class="section-title">
                      {{ componentData.componentId + ".materials" | translate }}
                    </h4>

                    <div class="section-content">
                      <p-table
                        id="items-table"
                        class="aw-table2"
                        [value]="reverseProcurementRequestItems"
                        [(selection)]="reverseSelectedProcurementRequestItem"
                        selectionMode="single"
                        (onRowSelect)="onSelectReverseProcurementRequestItem()"
                        (onRowUnselect)="onSelectReverseProcurementRequestItem()"
                      >
                        <ng-template pTemplate="body" let-rowData let-rowIndex="rowIndex">
                          <tr
                            [pSelectableRow]="rowData"
                            [pSelectableRowIndex]="rowIndex"
                            [ngStyle]="{ 'background-color': '#ffffff' }"
                          >
                            <td>
                              <div>
                                <div style="display: flex; flex-direction: row;">
                                  <div style="min-width: 3rem; display: inline-block; flex-grow: 1;">
                                    <a style="font-weight: 600" (click)="openArticle(rowData['obj'].birePn?.pnCode)">
                                      {{ rowData["obj"].birePn?.pnCode }}
                                    </a>
                                  </div>

                                  <div>
                                    {{ componentData.componentId + ".requestedQty" | translate }} =
                                    <span style="font-weight: 600">
                                      {{ rowData["obj"].quantity | formatNumber }}
                                    </span>
                                    <span *ngIf="rowData['obj'].birePn?.quantityUnit">
                                      {{ rowData["obj"].birePn?.quantityUnit }}
                                    </span>
                                  </div>
                                </div>

                                <div style="display: flex; flex-direction: row;">
                                  <div style="min-width: 3rem; display: inline-block; flex-grow: 1;">
                                    {{ rowData["obj"].birePn?.otanPnReference }}
                                  </div>

                                  <div *ngIf="rowData['obj'].birePn?.quantityPerIssue">
                                    ({{ "distributionQuantityShort" | translate }} =
                                    {{ rowData["obj"].birePn.quantityPerIssue | formatNumber }})
                                  </div>
                                </div>
                              </div>

                              <div
                                style="font-style: italic; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; padding-bottom: 1.5rem;"
                              >
                                {{ rowData["obj"].birePn?.articleDesignation }}
                              </div>

                              <div
                                *ngIf="rowData['siteIssueName']"
                                style="display: flex; justify-content: space-between;"
                              >
                                <span style="color: #01579b;;">{{ getComponentName() + ".supplier" | translate }}</span>
                                <span class="bold">{{ rowData["siteIssueName"] }}</span>
                              </div>

                              <div
                                style="padding-bottom: 0.6rem; text-align: end;"
                                *ngIf="rowData['warehouseIssueName']"
                              >
                                <span class="italic">{{ rowData["warehouseIssueName"] }}</span>
                              </div>

                              <div
                                *ngIf="rowData['siteReceiptName']"
                                style="display: flex; justify-content: space-between;"
                              >
                                <span style="color: #01579b;;">{{ "recipient" | translate }}</span>
                                <span class="bold">{{ rowData["siteReceiptName"] }}</span>
                              </div>

                              <div
                                style="padding-bottom: 0.6rem; text-align: end;"
                                *ngIf="rowData['warehouseReceiptName']"
                              >
                                <span class="italic">{{ rowData["warehouseReceiptName"] }}</span>
                              </div>

                              <div>
                                <div style="min-width: 8rem; display: inline-block;">
                                  {{ getComponentName() + ".notReversed" | translate }}
                                </div>
                                <span style="font-weight: 600">{{ rowData["notReversedNb"] }}</span>
                              </div>

                              <div>
                                <div style="min-width: 8rem; display: inline-block;">
                                  {{ getComponentName() + ".reversed" | translate }}
                                </div>
                                <span style="font-weight: 600">{{ rowData["reversedNb"] }}</span>
                              </div>

                              <div
                                style="display: flex; flex-direction: row; justify-content: space-between; align-items: center;"
                                *ngIf="
                                  procurementRequest.procStatus !=
                                  aWPropertiesConstants.PROCUREMENT_REQUEST_STATUS_CANCELED
                                "
                              >
                                <div
                                  style="padding: 8px; color: #000; border-radius: 4px;"
                                  [ngClass]="{
                                    'served--nok': rowData['reversedNb'] == 0,
                                    'served--ok':
                                      rowData['reversedNb'] > 0 && rowData['reversedNb'] == rowData['allNb'],
                                    'served--warning':
                                      rowData['reversedNb'] > 0 && rowData['reversedNb'] != rowData['allNb']
                                  }"
                                >
                                  <span *ngIf="rowData['reversedNb'] == 0">
                                    {{ componentData.componentId + ".notReversed" | translate }}
                                  </span>
                                  <span *ngIf="rowData['reversedNb'] > 0 && rowData['reversedNb'] != rowData['allNb']">
                                    {{ componentData.componentId + ".partiallyReversed" | translate }}
                                  </span>
                                  <span *ngIf="rowData['reversedNb'] > 0 && rowData['reversedNb'] == rowData['allNb']">
                                    {{ componentData.componentId + ".reversed" | translate }}
                                  </span>
                                </div>

                                <div>
                                  <button
                                    class="actions-btn"
                                    mat-icon-button
                                    class="mat-elevation-z1"
                                    [matMenuTriggerFor]="itemActions"
                                    (click)="stopPropagation($event)"
                                    *ngIf="
                                      reverseSelectedProcurementRequestItem &&
                                      rowData.obj === reverseSelectedProcurementRequestItem.obj &&
                                      procurementRequest.procStatus !==
                                        aWPropertiesConstants.PROCUREMENT_REQUEST_STATUS_CLOSED
                                    "
                                  >
                                    <mat-icon>more_horiz</mat-icon>
                                  </button>
                                  <mat-menu #itemActions="matMenu">
                                    <button
                                      mat-menu-item
                                      (click)="manageTransfertOrderItem(rowData)"
                                      *ngIf="
                                        !procurementRequest.bidmWorkOrderWoId &&
                                        procurementRequest.procStatus !=
                                          aWPropertiesConstants.PROCUREMENT_REQUEST_STATUS_DRAFT
                                      "
                                    >
                                      {{ componentData.componentId + ".manage" | translate }}
                                    </button>
                                  </mat-menu>
                                </div>
                              </div>
                            </td>
                          </tr>
                        </ng-template>
                      </p-table>
                    </div>
                  </div>

                  <div class="section">
                    <h4 class="section-title">
                      {{ componentData.componentId + ".reversedAsset" | translate }}
                    </h4>

                    <div class="section-content">
                      <p-table
                        *ngIf="reverseSelectedProcurementRequestItem"
                        class="aw-table2"
                        [value]="reverseWorkshopEntries"
                        [(selection)]="reverseSelectedWorkshopEntry"
                        selectionMode="single"
                        (onRowSelect)="onSelectReverseWorkshopEntry()"
                        (onRowUnselect)="onSelectReverseWorkshopEntry()"
                      >
                        <ng-template pTemplate="body" let-rowData let-rowIndex="rowIndex">
                          <tr [pSelectableRow]="rowData" [pSelectableRowIndex]="rowIndex">
                            <td>
                              <div
                                *ngIf="!rowData.obj['stockMvtSn'] && !rowData.obj['stockMvtBatchNumber']"
                                style="font-style: italic;"
                              >
                                {{ getComponentName() + ".noSelectedAsset" | translate }}
                              </div>

                              <div *ngIf="rowData.obj['stockMvtSn'] || rowData.obj['stockMvtBatchNumber']">
                                <div>
                                  <span style="min-width: 9rem; display: inline-block;">
                                    {{ "packagingNumber" | translate }}
                                  </span>
                                  <a class="bold" (click)="openBatch(rowData)">
                                    {{ rowData.obj["stockMvtBatchNumber"] }}
                                  </a>
                                </div>

                                <div *ngIf="!rowData.obj['stockMvtSn']">
                                  <span style="min-width: 9rem; display: inline-block;">{{
                                    getComponentName() + ".quantity" | translate
                                  }}</span>
                                  <span class="bold" *ngIf="rowData.obj['stockMvtQuantity']">
                                    {{ rowData.obj["stockMvtQuantity"] | formatNumber }}
                                  </span>
                                  <span class="bold" *ngIf="rowData.obj['stockMvtUnit']">
                                    {{ rowData.obj["stockMvtUnit"] }}
                                  </span>
                                </div>

                                <div>
                                  <span style="min-width: 9rem; display: inline-block;">
                                    {{ (rowData.obj["stockMvtSn"] ? "sn" : "manufacturingBatch") | translate }}
                                  </span>
                                  <a class="bold" (click)="openEquipment(rowData)" *ngIf="rowData.obj['stockMvtSn']">
                                    {{ rowData.obj["stockMvtSn"] }}
                                  </a>
                                  <a
                                    class="bold"
                                    (click)="openManufacturingBatch(rowData)"
                                    *ngIf="!rowData.obj['stockMvtSn']"
                                  >
                                    {{ rowData["manufacturingBatch"]?.batchNumber }}
                                  </a>
                                </div>

                                <div>
                                  <span style="min-width: 9rem; display: inline-block;">
                                    {{ "status" | translate }}
                                  </span>
                                  <span class="bold">
                                    {{ rowData.equipment?.operationalStatus | formatSelectOption: operationalStatuses }}
                                  </span>
                                </div>
                              </div>
                            </td>
                          </tr>
                        </ng-template>
                      </p-table>
                    </div>
                  </div>

                  <div class="section">
                    <h4 class="section-title">
                      {{ componentData.componentId + ".reversedState" | translate }}
                    </h4>

                    <div class="section-content">
                      <aw-procurement-request-reverse-mvt-status
                        *ngIf="
                          reverseSelectedWorkshopEntry &&
                          reverseSelectedWorkshopEntry?.obj.bidtStockMvtTypeId !== bidtStockMvtTypeConstants.REMOVAL
                        "
                        [mvts]="reverseStockMvtSubject.asObservable()"
                        [procurementRequest]="procurementRequest"
                        (onClick)="toggleReverseDetailsTable($event)"
                      ></aw-procurement-request-reverse-mvt-status>

                      <a-table
                        [dataSource]="reverseStockMvtTableDataSource"
                        *ngIf="
                          reverseSelectedWorkshopEntry &&
                          (reverseShowDetails ||
                            reverseSelectedWorkshopEntry?.obj.bidtStockMvtTypeId === bidtStockMvtTypeConstants.REMOVAL)
                        "
                        style="margin-top: 40px"
                      >
                        <ng-template columnDef="movement" let-rowData="rowData">
                          <div>
                            <a class="bold" (click)="openStovkMvt(rowData)">
                              {{ rowData["stockMvtCode"] }}
                            </a>
                          </div>

                          <div>
                            <span class="italic">{{ rowData["bidtStockMvtType"]?.smtName | extractTranslation }}</span>
                          </div>
                        </ng-template>

                        <ng-template columnDef="type" let-rowData="rowData">
                          <i
                            *ngIf="rowData['bidtStockMvtType']?.smtWay === bidtStockMvtConstants.MVT_WAY_CREDIT"
                            class="fa fa-fw fa-arrow-right procurement-type--in"
                            aria-hidden="true"
                            pTooltip="{{ componentData.componentId + '.receipt' | translate }}"
                          ></i>
                          <i
                            *ngIf="rowData['bidtStockMvtType']?.smtWay === bidtStockMvtConstants.MVT_WAY_DEBIT"
                            class="fa fa-fw fa-arrow-right procurement-type--out"
                            aria-hidden="true"
                            pTooltip="{{ componentData.componentId + '.issue' | translate }}"
                          ></i>
                          <i
                            *ngIf="rowData['bidtStockMvtType']?.smtWay === bidtStockMvtConstants.MVT_WAY_TRANSFER"
                            class="fa fa-fw fa-arrow-right procurement-type--transfer"
                            aria-hidden="true"
                            pTooltip="{{ componentData.componentId + '.transfer' | translate }}"
                          ></i>
                        </ng-template>

                        <ng-template columnDef="warehouseWorkshop" let-rowData="rowData">
                          <div
                            *ngIf="
                              rowData['bidtStockMvtType']?.smtWay === bidtStockMvtConstants.MVT_WAY_CREDIT ||
                              rowData['bidtStockMvtType']?.smtWay === bidtStockMvtConstants.MVT_WAY_TRANSFER
                            "
                          >
                            <span class="bold">{{ rowData["bidtSiteReceipt"]?.siteCode }}</span>
                          </div>
                          <div
                            *ngIf="
                              rowData['bidtStockMvtType']?.smtWay === bidtStockMvtConstants.MVT_WAY_CREDIT ||
                              rowData['bidtStockMvtType']?.smtWay === bidtStockMvtConstants.MVT_WAY_TRANSFER
                            "
                          >
                            <span class="italic">{{ rowData["bidtWarehouseReceipt"]?.whName }}</span>
                          </div>

                          <div *ngIf="rowData['bidtStockMvtType']?.smtWay === bidtStockMvtConstants.MVT_WAY_DEBIT">
                            <span class="bold">{{ rowData["bidtSiteIssue"]?.siteCode }}</span>
                          </div>
                          <div *ngIf="rowData['bidtStockMvtType']?.smtWay === bidtStockMvtConstants.MVT_WAY_DEBIT">
                            <span class="italic">{{ rowData["bidtWarehouseIssue"]?.whName }}</span>
                          </div>
                        </ng-template>

                        <ng-template columnDef="outbound" let-rowData="rowData">
                          <div *ngIf="rowData['bidtStorageBinZoneIssue']?.sbNumber">
                            <span class="bold">
                              {{ rowData["bidtStorageBinZoneIssue"]?.sbNumber }}
                              <ng-container *ngIf="rowData['bidtStorageBinZoneIssue']?.sbDescription">
                                - {{ rowData["bidtStorageBinZoneIssue"]?.sbDescription }}
                              </ng-container>
                            </span>
                          </div>

                          <div *ngIf="rowData['bidtStorageBinBinIssue']?.sbNumber">
                            <span class="bold">{{ rowData["bidtStorageBinBinIssue"]?.sbNumber }}</span>
                          </div>
                        </ng-template>

                        <ng-template columnDef="inbound" let-rowData="rowData">
                          <div *ngIf="rowData['bidtStorageBinZoneReceipt']?.sbNumber">
                            <span class="bold">
                              {{ rowData["bidtStorageBinZoneReceipt"]?.sbNumber }}
                              <ng-container *ngIf="rowData['bidtStorageBinZoneReceipt']?.sbDescription">
                                - {{ rowData["bidtStorageBinZoneReceipt"]?.sbDescription }}
                              </ng-container>
                            </span>
                          </div>

                          <div *ngIf="rowData['bidtStorageBinBinReceipt']?.sbNumber">
                            <span class="bold">{{ rowData["bidtStorageBinBinReceipt"]?.sbNumber }}</span>
                          </div>
                        </ng-template>

                        <ng-template columnDef="status" let-rowData="rowData">
                          <div>
                            <span class="bold">
                              {{ rowData["mvtStatus"] | formatSelectOption: stockMvtStatuses }}
                            </span>
                          </div>

                          <div>
                            {{
                              (rowData["stockMvtDate"] ? rowData["stockMvtDate"] : rowData["stockMvtPlannedDate"])
                                | date: "yyyy/MM/dd HH:mm":"":translateService.currentLang
                            }}
                          </div>
                        </ng-template>
                      </a-table>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </mat-tab>

      <mat-tab>
        <ng-template mat-tab-label>
          {{ componentData.componentId + ".documents" | translate }}
        </ng-template>

        <div class="grid-row">
          <div class="grid-cell--12">
            <div class="grid-cell grid-cell--container">
              <div class="grid-cell-header">
                <div class="grid-cell-title-container">
                  <h3 class="grid-cell-title">
                    {{ componentData.componentId + ".documents" | translate }} ({{ documentTableDataSource.dataCount }})
                  </h3>
                </div>
              </div>

              <div class="grid-cell-content grid-cell-content-with-section">
                <div class="section">
                  <div class="section-content">
                    <a-table [dataSource]="documentTableDataSource">
                      <ng-template tableActionsDef>
                        <p-fileUpload
                          #fileUploader
                          auto="true"
                          chooseLabel="{{ 'global.upload' | translate }}"
                          customUpload="true"
                          mode="basic"
                          name="document[]"
                          (uploadHandler)="uploadDocument($event, fileUploader)"
                          *ngIf="!isReadOpenMode && !documentTableDataSource.hasDataSelection"
                        >
                        </p-fileUpload>

                        <button
                          *ngIf="!isReadOpenMode && documentTableDataSource.hasDataSelection"
                          type="button"
                          mat-raised-button
                          color="warn"
                          (click)="deleteDocuments()"
                        >
                          {{ "global.delete" | translate }}
                        </button>
                      </ng-template>

                      <ng-template columnDef="documentPublicationDate" let-rowData="rowData">
                        {{ rowData["documentPublicationDate"] | date: "shortDate":"":translateService.currentLang }}
                      </ng-template>
                    </a-table>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </mat-tab>
    </mat-tab-group>
  </div>
</div>

<aw-dialog-add-popup
  *ngIf="itemDialogVisible"
  [(display)]="itemDialogVisible"
  (onValidate)="onValidateItem($event)"
></aw-dialog-add-popup>

<aw-dialog-procurement-request-edit-quantity
  *ngIf="editQuantityDialogVisible"
  [(display)]="editQuantityDialogVisible"
  [procurementRequest]="procurementRequest"
  [procReqItem]="selectedProcReqItem"
  [workshopEntries]="workshopEntries"
  (onValidate)="onEditQuantity($event)"
></aw-dialog-procurement-request-edit-quantity>

<aw-dialog-search-work-order
  *ngIf="showWoDialog"
  [(display)]="showWoDialog"
  [sourceSearchObject]="searchWoObject"
  (onSelected)="onSelectWo($event)"
>
</aw-dialog-search-work-order>
