<div class="page-header">
  <div class="page-info">
    <div>
      <h2 class="page-title">
        {{ "transaction." + componentData.componentId | translate }}
      </h2>
    </div>
  </div>

  <div class="page-actions">
    <button type="button" mat-raised-button>
      {{ "create" | translate }}
    </button>

    <button
      mat-icon-button
      class="mat-elevation-z1"
      matTooltip="{{ 'global.showAllActionTooltip' | translate }}"
      matTooltipPosition="above"
      aria-label="Show all actions"
      [matMenuTriggerFor]="actions"
    >
      <mat-icon>more_horiz</mat-icon>
    </button>
    <mat-menu #actions="matMenu">
      <button mat-menu-item (click)="updateFavoriteState()">
        {{ (isFavoriteEntry ? "page.removeFromFavorites" : "page.addToFavorites") | translate }}
      </button>
    </mat-menu>
  </div>
</div>

<div class="page-wrapper">
  <div class="page-container search-page-container">
    <div class="page-content">
      <div class="grid-row">
        <div class="grid-cell--12">
          <div class="grid-cell grid-cell--container">
            <div class="grid-cell-header">
              <div class="grid-cell-title-container">
                <h3 class="grid-cell-title">{{ "search" | translate }}</h3>
              </div>
            </div>

            <div class="grid-cell-content grid-cell-content-with-section">
              <div class="section">
                <div class="section-content">
                  <div class="row">
                    <div class="form-group required">
                      <label class="form-label ">{{ componentNamespace + ".site" | translate }}</label>

                      <div class="form-control">
                        <p-dropdown
                          class="aw-dropdown fixed-width"
                          placeholder="&nbsp;"
                          [options]="sites"
                          [showClear]="true"
                          [(ngModel)]="selectedSite"
                          (onChange)="onChangeSite()"
                        ></p-dropdown>
                      </div>
                    </div>

                    <div class="form-group required may-required" style="height: 47px;">
                      <label class="form-label">
                        {{ selectedWarehouseCategory | formatSelectOption: warehouseCategories }}
                      </label>

                      <div class="form-control aw-selectbutton-wrapper aw-selectbutton-with-dropdown">
                        <p-selectButton
                          [options]="warehouseCategories"
                          [(ngModel)]="selectedWarehouseCategory"
                          (onChange)="onChangeWarehouseCategory()"
                        ></p-selectButton>

                        <p-dropdown
                          appendTo="body"
                          class="aw-dropdown fixed-width"
                          placeholder="&nbsp;"
                          [options]="warehouses"
                          [showClear]="true"
                          [(ngModel)]="selectedWarehouse"
                          (onChange)="onChangeWarehouse()"
                        ></p-dropdown>
                      </div>
                    </div>

                    <div class="form-group" *ngIf="getCurrentComponentContext == componentContext.PICKING">
                      <label class="form-label ">{{ componentNamespace + ".zone" | translate }}</label>
                      <div class="form-control">
                        <p-dropdown
                          appendTo="body"
                          class="aw-dropdown fixed-width"
                          placeholder="&nbsp;"
                          [options]="zonesList"
                          [showClear]="true"
                          [(ngModel)]="selectedZone"
                        ></p-dropdown>
                      </div>
                    </div>

                    <div class="form-group" *ngIf="getCurrentComponentContext != componentContext.PICKING"></div>
                  </div>
                </div>
              </div>

              <div class="section" *ngIf="getCurrentComponentContext == componentContext.STOCK_MOVEMENT">
                <div class="section-content">
                  <div class="row">
                    <div class="form-group required" style="height: 47px;">
                      <label class="form-label"> {{ componentNamespace + ".movementType" | translate }}</label>

                      <div class="form-control aw-selectbutton-wrapper">
                        <p-selectButton
                          [options]="filteredMovementTypes"
                          [(ngModel)]="selectedMovementType"
                        ></p-selectButton>
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <div class="section">
                <h4 class="section-title">{{ componentNamespace + ".statusAndDate" | translate }}</h4>

                <div class="section-content">
                  <div class="row">
                    <div class="form-group" style="height: 47px;">
                      <label class="form-label ">{{ "status" | translate }}</label>

                      <div class="form-control aw-selectbutton-wrapper">
                        <p-selectButton [options]="statuses" [(ngModel)]="selectedStatus"></p-selectButton>
                      </div>
                    </div>

                    <div class="form-group required">
                      <label
                        class="form-label"
                        *ngIf="
                          selectedStatus !== component.EXECUTED_STATUS && selectedStatus != component.CANCEL_STATUS
                        "
                      >
                        {{ componentNamespace + ".beforeDate" | translate }}</label
                      >
                      <label
                        class="form-label"
                        *ngIf="
                          selectedStatus === component.EXECUTED_STATUS || selectedStatus == component.CANCEL_STATUS
                        "
                      >
                        {{ componentNamespace + ".the" | translate }}</label
                      >

                      <div class="form-control">
                        <p-calendar
                          showButtonBar="true"
                          [monthNavigator]="true"
                          [yearNavigator]="true"
                          [yearRange]="sessionService.calendarYearRange"
                          appendTo="body"
                          class="aw-calendar"
                          [dateFormat]="sessionService.dateFormatPrimeNG"
                          [locale]="sessionService.calendarFormat"
                          [(ngModel)]="selectedDate"
                        ></p-calendar>
                      </div>
                    </div>

                    <div class="form-group"></div>
                  </div>
                </div>
              </div>

              <div class="section" *ngIf="getCurrentComponentContext == componentContext.PICKING">
                <h4 class="section-title">{{ componentNamespace + ".criticity" | translate }}</h4>

                <div class="section-content">
                  <div class="row">
                    <div class="form-group">
                      <div class="form-control aw-selectbutton-wrapper">
                        <p-selectButton [options]="criticalList" [(ngModel)]="selectedCritical"></p-selectButton>
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <div class="section">
                <h4 class="section-title">{{ componentNamespace + ".goods" | translate }}</h4>

                <div class="section-content">
                  <div class="row">
                    <div class="form-group required may-required">
                      <label class="form-label">{{ componentNamespace + ".material" | translate }} </label>

                      <div class="form-control form-control-with-modal">
                        <div class="form-control-data" (click)="openPnDialog()">
                          {{ selectedPnCode }}
                        </div>

                        <div *ngIf="selectedPnCode" class="btn-clear-wrapper">
                          <i
                            class="ui-dropdown-clear-icon pi pi-times aw-icon btn-clear"
                            aria-hidden="true"
                            (click)="unselectPn()"
                          ></i>
                        </div>
                        <div class="btn-search-wrapper">
                          <i
                            class="fa fa-fw fa-search aw-icon btn-search"
                            aria-hidden="true"
                            (click)="openPnDialog()"
                          ></i>
                        </div>
                      </div>
                    </div>

                    <div class="form-group">
                      <label class="form-label">
                        {{ componentNamespace + ".alternatives" | translate }}
                      </label>

                      <div class="form-control">
                        <p-checkbox
                          binary="true"
                          class="aw-checkbox"
                          [disabled]="!selectedPnCode"
                          [(ngModel)]="withAlternatives"
                        ></p-checkbox>
                      </div>
                    </div>

                    <div class="form-group">
                      <label class="form-label">{{ componentNamespace + ".serial" | translate }}</label>

                      <div class="form-control">
                        <input class="aw-input" type="text" [(ngModel)]="selectedSn" />
                      </div>
                    </div>

                    <div class="form-group">
                      <label class="form-label">
                        {{ componentNamespace + ".batchNumber" | translate }}
                      </label>

                      <div class="form-control">
                        <input class="aw-input" type="text" [(ngModel)]="selectedBatchNumber" />
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <div class="section" *ngIf="advancedCriteriaVisible">
                <div class="section-content">
                  <div class="advanced-criteria">
                    <div class="section" *ngIf="finalRecipientVisible">
                      <h4 class="section-title">{{ componentNamespace + ".finalRecipient" | translate }}</h4>

                      <div class="section-content">
                        <div class="row">
                          <div class="form-group" style="height: 47px;">
                            <div class="form-control aw-selectbutton-wrapper">
                              <p-selectButton [options]="recipients" [(ngModel)]="selectedRecipient"></p-selectButton>
                            </div>
                          </div>
                        </div>

                        <div class="row" *ngIf="selectedRecipient == component.RECIPIENT_INTERNAL">
                          <div class="form-group">
                            <label class="form-label">{{ componentNamespace + ".site" | translate }}</label>

                            <div class="form-control">
                              <p-dropdown
                                class="aw-dropdown fixed-width"
                                placeholder="&nbsp;"
                                [options]="sites"
                                [showClear]="true"
                                [(ngModel)]="selectedFinalRecipientSite"
                                (onChange)="onChangeFinalRecipientSite()"
                              ></p-dropdown>
                            </div>
                          </div>

                          <div class="form-group" style="height: 47px;">
                            <label class="form-label">
                              {{ selectedWarehouseCategory | formatSelectOption: warehouseCategories }}
                            </label>

                            <div class="form-control aw-selectbutton-wrapper aw-selectbutton-with-dropdown">
                              <p-selectButton
                                [options]="warehouseCategories"
                                [(ngModel)]="selectedFinalRecipientWarehouseCategory"
                                (onChange)="onChangeFinalRecipientWarehouseCategory()"
                              ></p-selectButton>

                              <p-dropdown
                                appendTo="body"
                                class="aw-dropdown fixed-width"
                                placeholder="&nbsp;"
                                [options]="finalRecipientWarehouses"
                                [showClear]="true"
                                [(ngModel)]="selectedFinalRecipientWarehouse"
                              ></p-dropdown>
                            </div>
                          </div>

                          <div class="form-group"></div>
                        </div>

                        <div class="row" *ngIf="selectedRecipient == component.RECIPIENT_EXTERNAL">
                          <div class="form-group">
                            <label class="form-label">{{ componentNamespace + ".partner" | translate }}</label>

                            <div class="form-control form-control-with-modal">
                              <div class="form-control-data" (click)="openCustomerDialog()">
                                {{ selectedFinalRecipientCustomerCode }}
                              </div>

                              <div *ngIf="selectedFinalRecipientCustomerCode" class="btn-clear-wrapper">
                                <i
                                  class="ui-dropdown-clear-icon pi pi-times aw-icon btn-clear"
                                  aria-hidden="true"
                                  (click)="unselectFinalRecipientCustomer()"
                                ></i>
                              </div>
                              <div class="btn-search-wrapper">
                                <i
                                  class="fa fa-fw fa-search aw-icon btn-search"
                                  aria-hidden="true"
                                  (click)="openCustomerDialog()"
                                ></i>
                              </div>
                            </div>
                          </div>

                          <div class="form-group flex--2"></div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <div class="section" *ngIf="finalRecipientVisible">
                <div class="section-content">
                  <div class="row search-criteria-footer">
                    <button mat-button (click)="advancedCriteriaVisible = !advancedCriteriaVisible">
                      <ng-container *ngIf="advancedCriteriaVisible">
                        <mat-icon>remove</mat-icon>
                        {{ "global.collapseCriteria" | translate }}
                      </ng-container>
                      <ng-container *ngIf="!advancedCriteriaVisible">
                        <mat-icon>add</mat-icon>
                        {{ "global.expandCriteria" | translate }}
                      </ng-container>
                    </button>
                  </div>
                </div>
              </div>

              <div class="section">
                <div class="section-content">
                  <div class="row search-criteria-footer">
                    <div class="search-actions">
                      <button
                        appKeyPress
                        mat-raised-button
                        color="primary"
                        type="button"
                        [disabled]="!canSearch()"
                        [keyCode]="'Enter'"
                        (click)="search()"
                        (keyPress)="search()"
                      >
                        {{ "global.toSearch" | translate }}
                      </button>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<aw-dialog-search-material
  *ngIf="pnDialogVisible"
  [(display)]="pnDialogVisible"
  (onSelected)="onSelectMaterial($event)"
></aw-dialog-search-material>

<aw-dialog-search-customer
  *ngIf="customerDialogVisible"
  [(display)]="customerDialogVisible"
  (onSelected)="onSelectCustomer($event)"
></aw-dialog-search-customer>
