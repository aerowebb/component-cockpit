<div class="page-header">
  <div class="page-info">
    <div>
      <h2 class="page-title">
        {{ "transaction." + componentData.componentId | translate }}
      </h2>

      <div class="page-subtitle">
        <div *ngIf="mainInfo.number" class="page-subtitle">- {{ mainInfo.number }}</div>
      </div>
    </div>
    <div
      class="object-status"
      [ngClass]="{
        disabled: mainInfo.status == aWPropertiesConstants.TRANSFER_ORDER_STATUS_CANCELED
      }"
      *ngIf="mainInfo.status"
      (click)="showStatus()"
    >
      {{ mainInfo.status | formatSelectOption: torStatusList }}
    </div>
  </div>

  <div class="page-actions">
    <button type="button" mat-raised-button *ngIf="showMaterialInfo" (click)="goback()">
      {{ componentData.componentId + ".back" | translate }}
    </button>

    <button
      *ngIf="
        isReadOpenMode &&
        !showMaterialInfo &&
        (tor.torType === aWPropertiesConstants.TRANSFER_ORDER_TYPE_REVERSE_MVT || !procRequest) &&
        tor.torStatus === aWPropertiesConstants.TRANSFER_ORDER_STATUS_PLANNED
      "
      type="button"
      mat-raised-button
      (click)="edit()"
    >
      {{ "global.edit" | translate }}
    </button>

    <button
      *ngIf="!isReadOpenMode && !showMaterialInfo"
      type="button"
      color="warn"
      mat-raised-button
      (click)="cancel()"
    >
      {{ "global.cancel" | translate }}
    </button>

    <button
      *ngIf="!isReadOpenMode && !showMaterialInfo"
      color="primary"
      type="button"
      mat-raised-button
      (click)="save()"
    >
      {{ "global.save" | translate }}
    </button>

    <button
      mat-icon-button
      class="mat-elevation-z1"
      matTooltip="{{ 'global.showAllActionTooltip' | translate }}"
      matTooltipPosition="above"
      aria-label="Show all actions"
      [matMenuTriggerFor]="actions"
    >
      <mat-icon>more_horiz</mat-icon>
    </button>
    <mat-menu #actions="matMenu">
      <button mat-menu-item (click)="init()">{{ "global.refresh" | translate }}</button>
      <button mat-menu-item (click)="updateFavoriteState()">{{ "addToFavorite" | translate }}</button>
    </mat-menu>
  </div>
</div>

<div class="page-wrapper">
  <div class="page-container">
    <mat-tab-group animationDuration="0ms" dynamicHeight>
      <mat-tab>
        <ng-template mat-tab-label>
          {{ "home" | translate }}
        </ng-template>

        <div class="grid-row" *ngIf="!showMaterialInfo">
          <!-- MAIN INFO PANEL -->
          <div id="mainPanel" class="grid-cell--6">
            <div class="grid-cell grid-cell--container">
              <div class="grid-cell-header">
                <div class="grid-cell-title-container">
                  <h3 class="grid-cell-title">
                    {{ "page.mainData" | translate }}
                  </h3>
                </div>
              </div>

              <div class="grid-cell-content">
                <div class="column">
                  <!-- ROW 1 -->
                  <div class="row">
                    <div class="form-group flex--4">
                      <label class="form-label">{{ getComponentName() + ".number" | translate }}</label>

                      <div class="form-control custom-anchor">
                        {{ mainInfo.number }}
                      </div>
                    </div>
                    <div class="form-group flex--4">
                      <label class="form-label">{{ getComponentName() + ".type" | translate }}</label>

                      <div class="form-control">
                        <input
                          *ngIf="mainInfo.type"
                          class="aw-input"
                          type="text"
                          disabled
                          (ngModelChange)="mainInfo.type = $event"
                          [ngModel]="mainInfo.type | formatSelectOption: torTypeList | extractTranslation"
                        />
                      </div>
                    </div>
                    <div class="form-group flex--4" [ngClass]="{ required: !isReadOpenMode }">
                      <label class="form-label">{{ getComponentName() + ".control" | translate }}</label>

                      <div
                        class="form-control alert"
                        [ngClass]="{
                          'procurement--ok':
                            isReadOpenMode && tor.criticality == aWPropertiesConstants.LOGISTICAL_CRITICALITY_ROUTINE,
                          'procurement--warning':
                            isReadOpenMode && tor.criticality == aWPropertiesConstants.LOGISTICAL_CRITICALITY_URGENT,
                          'procurement--nok':
                            isReadOpenMode && tor.criticality == aWPropertiesConstants.LOGISTICAL_CRITICALITY_IMMEDIATE
                        }"
                      >
                        <p-dropdown
                          class="aw-dropdown fixed-width"
                          [options]="criticalitiesList"
                          placeholder="&nbsp;"
                          [showClear]="true"
                          [(ngModel)]="tor.criticality"
                          [disabled]="isReadOpenMode"
                        ></p-dropdown>
                      </div>
                    </div>
                  </div>

                  <div class="row">
                    <div class="form-group flex--4">
                      <label class="form-label">{{ getComponentName() + ".applicant" | translate }}</label>

                      <div class="form-control">
                        <div class="form-control-generic">{{ mainInfo.applicant }} ({{ mainInfo.applicantLogin }})</div>
                      </div>
                    </div>

                    <div class="form-group flex--4">
                      <label class="form-label">{{ getComponentName() + ".created" | translate }}</label>

                      <div class="form-control">
                        {{ mainInfo.created | date: "yyyy/MM/dd HH:mm" }}
                      </div>
                    </div>
                    <div class="flex--4"></div>
                  </div>
                </div>
              </div>
              <div class="grid-cell-header">
                <div class="grid-cell-title-container">
                  <h3 class="grid-cell-title">
                    {{ getComponentName() + ".refDocument" | translate }}
                  </h3>
                </div>
              </div>
              <!-- ROW 3 -->
              <div class="grid-cell-content">
                <div class="form-group">
                  <label class="form-label">{{ getComponentName() + ".refDocumentNum" | translate }}</label>

                  <div class="form-control custom-anchor">
                    <a class="link" (click)="openReferenceDocument()">{{ mainInfo.refDocumentNum }}</a>
                  </div>
                </div>
                <div class="form-group">
                  <label class="form-label" stp>{{ getComponentName() + ".refDocType" | translate }}</label>

                  <div class="form-control">
                    <input
                      *ngIf="mainInfo.isProcurementRequestRefDoc && mainInfo.refDocType"
                      class="aw-input"
                      type="text"
                      disabled
                      (ngModelChange)="mainInfo.refDocType = $event"
                      [ngModel]="mainInfo.refDocType | formatSelectOption: procurementRequestTypeList"
                    />
                    <label *ngIf="mainInfo.isWorkPackageRefDoc && mainInfo.refDocumentNum" style="padding-top: 2px;">{{
                      getComponentName() + ".workPackage" | translate
                    }}</label>
                  </div>
                </div>
                <div class="form-group">
                  <label class="form-label">{{ getComponentName() + ".refStatus" | translate }}</label>

                  <div class="form-control">
                    <input
                      *ngIf="mainInfo.isProcurementRequestRefDoc && mainInfo.refStatus"
                      class="aw-input"
                      type="text"
                      disabled
                      (ngModelChange)="mainInfo.refStatus = $event"
                      [ngModel]="mainInfo.refStatus | formatSelectOption: procurementRequestStatusList"
                    />

                    <input
                      *ngIf="mainInfo.isWorkPackageRefDoc && mainInfo.refStatus"
                      class="aw-input"
                      type="text"
                      disabled
                      (ngModelChange)="mainInfo.refStatus = $event"
                      [ngModel]="mainInfo.refStatus | formatSelectOption: workPackageStatuses"
                    />
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- PROVIDER PANEL -->
          <div class="grid-cell--3">
            <div class="grid-cell grid-cell--container">
              <div class="grid-cell-header">
                <div class="grid-cell-title-container">
                  <h3 class="grid-cell-title">
                    {{ getComponentName() + ".supplier" | translate }}
                  </h3>
                </div>
              </div>

              <div class="grid-cell-content">
                <div class="column">
                  <div class="form-group">
                    <label class="form-label">{{ getComponentName() + ".site" | translate }}</label>

                    <div class="form-control" *ngIf="mainInfo.supplierSite">
                      <input class="aw-input" type="text" disabled [(ngModel)]="mainInfo.supplierSite" />
                    </div>
                  </div>
                  <div class="form-group">
                    <label class="form-label">{{ getComponentName() + ".warehouse" | translate }}</label>

                    <div class="form-control" *ngIf="mainInfo.supplierShop">
                      <input class="aw-input" type="text" disabled [(ngModel)]="mainInfo.supplierShop" />
                    </div>
                  </div>
                  <div class="form-group">
                    <label class="form-label">{{ getComponentName() + ".date" | translate }}</label>

                    <div class="form-control">
                      <p-calendar
                        showButtonBar="true"
                        [monthNavigator]="true"
                        [yearNavigator]="true"
                        [yearRange]="sessionService.calendarYearRange"
                        class="aw-calendar"
                        [dateFormat]="sessionService.dateFormatPrimeNG"
                        [locale]="sessionService.calendarFormat"
                        appendTo="body"
                        [(ngModel)]="mainInfo.supplierShipmentDate"
                        [disabled]="isReadOpenMode"
                      ></p-calendar>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- RECIPIENT PANEL -->
          <div class="grid-cell--3">
            <div class="grid-cell grid-cell--container">
              <div class="grid-cell-header">
                <div class="grid-cell-title-container">
                  <h3 class="grid-cell-title">
                    {{ getComponentName() + ".recipient" | translate }}
                  </h3>
                </div>
              </div>

              <div class="grid-cell-content">
                <div class="column">
                  <div class="form-group" *ngIf="!mainInfo.recipientSite">
                    <label class="form-label">{{ getComponentName() + ".partner" | translate }}</label>

                    <div class="form-control form-control-with-modal" *ngIf="!isReadOpenMode">
                      <div class="form-control-data" (click)="openCustomerDialog()">
                        <span *ngIf="bidoCustomerReceipt"
                          >{{ bidoCustomerReceipt?.customerCode }} - {{ bidoCustomerReceipt?.customerName }}</span
                        >
                      </div>

                      <div *ngIf="bidoCustomerReceipt" class="btn-clear-wrapper">
                        <i
                          class="ui-dropdown-clear-icon pi pi-times aw-icon btn-clear"
                          aria-hidden="true"
                          (click)="unselectFinalCustomer()"
                        ></i>
                      </div>
                      <div class="btn-search-wrapper">
                        <i
                          class="fa fa-fw fa-search aw-icon btn-search"
                          aria-hidden="true"
                          (click)="openCustomerDialog()"
                        ></i>
                      </div>
                    </div>
                    <div class="form-control" *ngIf="isReadOpenMode">
                      <div class="form-control-generic">
                        {{ bidoCustomerReceipt?.customerCode }} - {{ bidoCustomerReceipt?.customerName }}
                      </div>
                    </div>
                  </div>
                  <div class="form-group" *ngIf="mainInfo.recipientSite">
                    <label class="form-label">{{ getComponentName() + ".site" | translate }}</label>

                    <div class="form-control">
                      <p-dropdown
                        class="aw-dropdown fixed-width"
                        [options]="siteList"
                        placeholder="&nbsp;"
                        [showClear]="true"
                        [(ngModel)]="mainInfo.recipientSiteId"
                        [disabled]="isReadOpenMode"
                        (onChange)="loadWareHouses(mainInfo.recipientSiteId)"
                      ></p-dropdown>
                    </div>
                  </div>
                  <div class="form-group" *ngIf="mainInfo.recipientShop">
                    <label class="form-label">{{ getComponentName() + ".warehouse" | translate }}</label>

                    <div class="form-control">
                      <p-dropdown
                        class="aw-dropdown fixed-width"
                        [options]="warehouseList"
                        placeholder="&nbsp;"
                        [showClear]="true"
                        [(ngModel)]="mainInfo.recipientWarehouseId"
                        [disabled]="isReadOpenMode"
                        (onChange)="loadWareHouses(mainInfo.recipientSiteId)"
                      ></p-dropdown>
                    </div>
                  </div>
                  <div class="form-group">
                    <label class="form-label">{{ getComponentName() + ".expectedDate" | translate }}</label>

                    <div class="form-control">
                      <p-calendar
                        showButtonBar="true"
                        [monthNavigator]="true"
                        [yearNavigator]="true"
                        [yearRange]="sessionService.calendarYearRange"
                        class="aw-calendar"
                        [dateFormat]="sessionService.dateFormatPrimeNG"
                        [locale]="sessionService.calendarFormat"
                        appendTo="body"
                        [(ngModel)]="mainInfo.recipientDate"
                        [disabled]="isReadOpenMode"
                      ></p-calendar>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="grid-row" *ngIf="!showMaterialInfo">
          <div class="grid-cell--12">
            <div class="grid-cell grid-cell--container  grid-cell-item-movement">
              <div class="grid-cell-header">
                <div class="grid-cell-title-container">
                  <h3 class="grid-cell-title">
                    {{ componentData.componentId + ".postes" | translate }} ({{ articleList ? articleList.length : 0 }})
                  </h3>
                </div>
              </div>

              <div class="grid-cell-content grid-cell-content-with-section">
                <div class="row flex-row--justify-end">
                  <button type="button" mat-raised-button (click)="showItemDialog()" *ngIf="!isReadOpenMode">
                    {{ getComponentName() + ".addItem" | translate }}
                  </button>
                </div>
                <div class="row list-with-details">
                  <div class="list custom-border">
                    <div class="section">
                      <h4 class="section-title">
                        {{ componentData.componentId + ".articles" | translate }}
                      </h4>
                    </div>
                    <p-table
                      #ptableImportReports
                      class="aw-table2"
                      [columns]="articlesTableCols"
                      [value]="articleList"
                      [(selection)]="selectedArticle"
                      selectionMode="single"
                      (onRowSelect)="fillSNList()"
                      (onRowUnselect)="onArticleRowUnselect()"
                    >
                      <ng-template pTemplate="colgroup" let-columns>
                        <colgroup>
                          <col *ngFor="let col of columns" [ngStyle]="{ width: col.width }" />
                        </colgroup>
                      </ng-template>

                      <ng-template pTemplate="header" let-columns> </ng-template>

                      <ng-template pTemplate="body" let-rowData let-columns="columns" let-rowIndex="rowIndex">
                        <tr [pSelectableRow]="rowData" [pSelectableRowIndex]="rowIndex">
                          <td
                            *ngFor="let col of columns"
                            [ngSwitch]="col.field"
                            [ngStyle]="{ 'text-align': col.alignment }"
                          >
                            <div *ngSwitchDefault>
                              <div>
                                <div style="display: flex; flex-direction: row;">
                                  <div style="min-width: 3rem; display: inline-block; flex-grow: 1;">
                                    <a style="font-weight: 600" (click)="openArticle(rowData['pn'])">
                                      {{ rowData["pn"] }}
                                    </a>
                                  </div>

                                  <div>
                                    {{ componentData.componentId + ".qty" | translate }} =
                                    <span style="font-weight: 600">
                                      {{ rowData["quantity"] | formatNumber }}
                                    </span>
                                    <span *ngIf="rowData['quantityUnit']">
                                      {{ rowData["quantityUnit"] }}
                                    </span>
                                  </div>
                                </div>
                                <div style="display: flex; flex-direction: row;">
                                  <div style="min-width: 3rem; display: inline-block; flex-grow: 1;">
                                    {{ rowData["otanPnReference"] }}
                                  </div>

                                  <div *ngIf="rowData['quantityPerIssue']">
                                    ({{ "distributionQuantityShort" | translate }} =
                                    {{ rowData["quantityPerIssue"] | formatNumber }})
                                  </div>
                                </div>
                                <div style="display: flex; flex-direction: row;">
                                  <div style="min-width: 3rem; display: inline-block; flex-grow: 1;">
                                    {{ rowData["articleNum"] }}
                                  </div>
                                </div>
                              </div>

                              <div
                                style="font-style: italic; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; padding-bottom: 1.5rem;"
                              >
                                {{ rowData["articleDesignation"] }}
                              </div>

                              <div>
                                <div style="min-width: 8rem; display: inline-block;">
                                  <ng-container>
                                    {{ getComponentName() + ".notSelected" | translate }}
                                  </ng-container>
                                </div>
                                <span style="font-weight: 600"> {{ rowData["notSelectedNb"] }}</span>
                              </div>

                              <div>
                                <div style="min-width: 8rem; display: inline-block;">
                                  <ng-container>
                                    {{ getComponentName() + ".selected" | translate }}
                                  </ng-container>
                                </div>
                                <span style="font-weight: 600"> {{ rowData["selectedNb"] }}</span>
                              </div>

                              <div>
                                <div style="min-width: 8rem; display: inline-block;">
                                  <ng-container>
                                    {{ getComponentName() + ".inTransit" | translate }}
                                  </ng-container>
                                </div>
                                <span style="font-weight: 600"> {{ rowData["shippedNb"] }}</span>
                              </div>

                              <div>
                                <div style="min-width: 8rem; display: inline-block;">
                                  <ng-container
                                    *ngIf="tor.torType !== aWPropertiesConstants.TRANSFER_ORDER_TYPE_REVERSE_MVT"
                                  >
                                    {{ getComponentName() + ".delivered" | translate }}
                                  </ng-container>
                                  <ng-container
                                    *ngIf="tor.torType === aWPropertiesConstants.TRANSFER_ORDER_TYPE_REVERSE_MVT"
                                  >
                                    {{ getComponentName() + ".reversed" | translate }}
                                  </ng-container>
                                </div>
                                <span style="font-weight: 600"> {{ rowData["receivedNb"] }}</span>
                              </div>
                            </div>

                            <div style="display: flex; flex-direction: row; justify-content: flex-end;">
                              <button
                                class="actions-btn"
                                mat-icon-button
                                class="mat-elevation-z1"
                                [matMenuTriggerFor]="itemActions"
                                (click)="$event.stopPropagation()"
                                *ngIf="
                                  selectedArticle &&
                                  tor.torStatus !== aWPropertiesConstants.TRANSFER_ORDER_STATUS_PERFORMED &&
                                  tor.torStatus !== aWPropertiesConstants.TRANSFER_ORDER_STATUS_CANCELED &&
                                  ((!tor.bidmProjectProjectId &&
                                    (!tor.bidtProcReqItemId ||
                                      tor.torType === aWPropertiesConstants.TRANSFER_ORDER_TYPE_REVERSE_MVT)) ||
                                    selectedBidtDfTypeDTO.transferType ===
                                      aWPropertiesConstants.MM_TRANSFER_TYPE_INTER_SITE_KEY ||
                                    selectedBidtDfTypeDTO.transferType ===
                                      aWPropertiesConstants.MM_TRANSFER_TYPE_EXTERNAL_KEY)
                                "
                              >
                                <mat-icon>more_horiz</mat-icon>
                              </button>
                              <mat-menu #itemActions="matMenu">
                                <button mat-menu-item (click)="manageTransfertOrderItem(rowData)">
                                  {{ componentData.componentId + ".manage" | translate }}
                                </button>
                              </mat-menu>
                            </div>
                          </td>
                        </tr>
                      </ng-template>
                    </p-table>
                  </div>

                  <div class="list">
                    <div class="section">
                      <h4 class="section-title">
                        {{ componentData.componentId + ".selectedAsset" | translate }}
                      </h4>
                    </div>
                    <p-table
                      *ngIf="!!selectedArticle"
                      #ptableImportReports
                      class="aw-table2"
                      [columns]="snTableCols"
                      [value]="snList"
                      [(selection)]="selectedSN"
                      selectionMode="single"
                      (onRowSelect)="fillStockMovementList()"
                      (onRowUnselect)="onSNRowUnselect()"
                    >
                      <ng-template pTemplate="colgroup" let-columns>
                        <colgroup>
                          <col *ngFor="let col of columns" [ngStyle]="{ width: col.width }" />
                        </colgroup>
                      </ng-template>

                      <ng-template pTemplate="header" let-columns> </ng-template>

                      <ng-template pTemplate="body" let-rowData let-columns="columns" let-rowIndex="rowIndex">
                        <tr [pSelectableRow]="rowData" [pSelectableRowIndex]="rowIndex">
                          <td
                            *ngFor="let col of columns"
                            [ngSwitch]="col.field"
                            [ngStyle]="{ 'text-align': col.alignment }"
                          >
                            <div
                              *ngIf="!rowData['stockMvtSn'] && !rowData['stockMvtBatchNumber']"
                              style="font-style: italic;"
                            >
                              {{ getComponentName() + ".noSelectedAsset" | translate }}
                            </div>

                            <div *ngIf="rowData['stockMvtSn'] || rowData['stockMvtBatchNumber']">
                              <div>
                                <span style="min-width: 9rem; display: inline-block;">
                                  {{ "packagingNumber" | translate }}
                                </span>
                                <a class="bold" (click)="openBatch(rowData['stockMvtBatchNumber'])">
                                  {{ rowData["stockMvtBatchNumber"] }}
                                </a>
                              </div>

                              <div *ngIf="rowData['stockMvtSn']">
                                <span style="min-width: 9rem; display: inline-block;">
                                  {{ "sn" | translate }}
                                </span>
                                <a
                                  class="bold"
                                  *ngIf="rowData['stockMvtSn']"
                                  (click)="openEquipment(rowData['stockMvtSn'])"
                                >
                                  {{ rowData["stockMvtSn"] }}
                                </a>
                              </div>

                              <div>
                                <span style="min-width: 9rem; display: inline-block;">
                                  {{ "status" | translate }}
                                </span>
                                <span class="bold">
                                  {{ rowData.equipment?.operationalStatus | formatSelectOption: operationalStatuses }}
                                </span>
                              </div>
                            </div>
                          </td>
                        </tr>
                      </ng-template>
                    </p-table>
                  </div>

                  <div class="details">
                    <div class="section">
                      <h4 class="section-title">
                        {{ componentData.componentId + ".stockMovements" | translate }}
                      </h4>
                      <div class="section-content">
                        <aw-procurement-request-mvt-status
                          *ngIf="
                            stockMovementTableDataSource.data &&
                            tor.torType !== aWPropertiesConstants.TRANSFER_ORDER_TYPE_REVERSE_MVT
                          "
                          [componentName]="'TransferOrderMvtStatusComponent'"
                          [mvts]="stockMvtSubject.asObservable()"
                          (onClick)="toggleDetailsTable($event)"
                          style="padding-bottom: 50px;"
                        ></aw-procurement-request-mvt-status>
                        <aw-procurement-request-reverse-mvt-status
                          *ngIf="
                            stockMovementTableDataSource.data &&
                            tor.torType === aWPropertiesConstants.TRANSFER_ORDER_TYPE_REVERSE_MVT
                          "
                          [mvts]="stockMvtSubject.asObservable()"
                          [procurementRequest]="procRequest"
                          (onClick)="toggleDetailsTable($event)"
                          style="padding-bottom: 50px;"
                        ></aw-procurement-request-reverse-mvt-status>
                        <a-table
                          *ngIf="!!selectedArticle && !!selectedSN && showDetails"
                          [dataSource]="stockMovementTableDataSource"
                        >
                          <ng-template columnDef="movement" let-rowData="rowData">
                            <div>
                              <a class="bold" (click)="openStovkMvt()">
                                {{ rowData["stockMvtCode"] }}
                              </a>
                            </div>

                            <div>
                              <span class="italic">{{
                                rowData["bidtStockMvtType"]?.smtName | extractTranslation
                              }}</span>
                            </div>
                          </ng-template>

                          <ng-template columnDef="type" let-rowData="rowData">
                            <i
                              *ngIf="rowData['bidtStockMvtType']?.smtWay === bidtStockMvtConstants.MVT_WAY_CREDIT"
                              class="fa fa-fw fa-arrow-right procurement-type--in"
                              aria-hidden="true"
                              pTooltip="{{ componentData.componentId + '.receipt' | translate }}"
                            ></i>
                            <i
                              *ngIf="rowData['bidtStockMvtType']?.smtWay === bidtStockMvtConstants.MVT_WAY_DEBIT"
                              class="fa fa-fw fa-arrow-right procurement-type--out"
                              aria-hidden="true"
                              pTooltip="{{ componentData.componentId + '.issue' | translate }}"
                            ></i>
                            <i
                              *ngIf="rowData['bidtStockMvtType']?.smtWay === bidtStockMvtConstants.MVT_WAY_TRANSFER"
                              class="fa fa-fw fa-arrow-right procurement-type--transfer"
                              aria-hidden="true"
                              pTooltip="{{ componentData.componentId + '.transfer' | translate }}"
                            ></i>
                          </ng-template>

                          <ng-template columnDef="warehouseWorkshop" let-rowData="rowData">
                            <div
                              *ngIf="
                                rowData['bidtStockMvtType']?.smtWay === bidtStockMvtConstants.MVT_WAY_CREDIT ||
                                rowData['bidtStockMvtType']?.smtWay === bidtStockMvtConstants.MVT_WAY_TRANSFER
                              "
                            >
                              <span class="bold">{{ rowData["bidtSiteReceipt"]?.siteCode }}</span>
                            </div>
                            <div
                              *ngIf="
                                rowData['bidtStockMvtType']?.smtWay === bidtStockMvtConstants.MVT_WAY_CREDIT ||
                                rowData['bidtStockMvtType']?.smtWay === bidtStockMvtConstants.MVT_WAY_TRANSFER
                              "
                            >
                              <span class="italic">{{ rowData["bidtWarehouseReceipt"]?.whName }}</span>
                            </div>

                            <div *ngIf="rowData['bidtStockMvtType']?.smtWay === bidtStockMvtConstants.MVT_WAY_DEBIT">
                              <span class="bold">{{ rowData["bidtSiteIssue"]?.siteCode }}</span>
                            </div>
                            <div *ngIf="rowData['bidtStockMvtType']?.smtWay === bidtStockMvtConstants.MVT_WAY_DEBIT">
                              <span class="italic">{{ rowData["bidtWarehouseIssue"]?.whName }}</span>
                            </div>
                          </ng-template>

                          <ng-template columnDef="outbound" let-rowData="rowData">
                            <div *ngIf="rowData['bidtStorageBinZoneIssue']?.sbNumber">
                              <span class="bold">
                                {{ rowData["bidtStorageBinZoneIssue"]?.sbNumber }}
                                <ng-container *ngIf="rowData['bidtStorageBinZoneIssue']?.sbDescription">
                                  - {{ rowData["bidtStorageBinZoneIssue"]?.sbDescription }}
                                </ng-container>
                              </span>
                            </div>

                            <div *ngIf="rowData['bidtStorageBinBinIssue']?.sbNumber">
                              <span class="bold">{{ rowData["bidtStorageBinBinIssue"]?.sbNumber }}</span>
                            </div>
                          </ng-template>

                          <ng-template columnDef="inbound" let-rowData="rowData">
                            <div *ngIf="rowData['bidtStorageBinZoneReceipt']?.sbNumber">
                              <span class="bold">
                                {{ rowData["bidtStorageBinZoneReceipt"]?.sbNumber }}
                                <ng-container *ngIf="rowData['bidtStorageBinZoneReceipt']?.sbDescription">
                                  - {{ rowData["bidtStorageBinZoneReceipt"]?.sbDescription }}
                                </ng-container>
                              </span>
                            </div>

                            <div *ngIf="rowData['bidtStorageBinBinReceipt']?.sbNumber">
                              <span class="bold">{{ rowData["bidtStorageBinBinReceipt"]?.sbNumber }}</span>
                            </div>
                          </ng-template>

                          <ng-template columnDef="status" let-rowData="rowData">
                            <div>
                              <span class="bold">
                                {{ rowData["mvtStatus"] | formatSelectOption: stockMvtStatuses }}
                              </span>
                            </div>

                            <div>
                              {{
                                (rowData["stockMvtDate"] ? rowData["stockMvtDate"] : rowData["stockMvtPlannedDate"])
                                  | date: "yyyy/MM/dd HH:mm":"":translateService.currentLang
                              }}
                            </div>
                          </ng-template>
                        </a-table>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </mat-tab>

      <mat-tab>
        <ng-template mat-tab-label>
          {{ "documents" | translate }}
        </ng-template>

        <div class="grid-row">
          <div class="grid-cell--12">
            <div class="grid-cell grid-cell--container">
              <div class="grid-cell-header">
                <div class="grid-cell-title-container">
                  <h3 class="grid-cell-title">
                    {{ componentData.componentId + ".documents" | translate }} ({{ documentTableDataSource.dataCount }})
                  </h3>
                </div>
              </div>

              <div class="grid-cell-content grid-cell-content-with-section">
                <div class="section">
                  <div class="section-content">
                    <a-table [dataSource]="documentTableDataSource">
                      <ng-template tableActionsDef>
                        <button
                          *ngIf="!isReadOpenMode && documentTableDataSource.hasDataSelection"
                          type="button"
                          mat-raised-button
                          (click)="openSelectedDocument()"
                        >
                          {{ "global.open" | translate }}
                        </button>
                      </ng-template>
                    </a-table>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </mat-tab>
    </mat-tab-group>
  </div>

  <aw-material-selection *ngIf="showMaterialInfo"></aw-material-selection>
</div>

<aw-dialog-search-customer
  *ngIf="customerDialogVisible"
  [(display)]="customerDialogVisible"
  (onSelected)="onSelectCustomer($event)"
></aw-dialog-search-customer>

<aw-dialog-add-popup
  *ngIf="itemDialogVisible"
  [(display)]="itemDialogVisible"
  (onValidate)="onValidateAddItem($event)"
></aw-dialog-add-popup>
