<div class="page-header">
  <div class="page-info">
    <div>
      <h2 class="page-title">{{ "transaction." + componentData.componentId | translate }}</h2>

      <div class="page-subtitle">
        <div *ngIf="subtitle" class="page-subtitle">- {{ subtitle }}</div>
      </div>
    </div>
  </div>

  <div class="page-actions">
    <button
      type="button"
      mat-raised-button
      (click)="onChangeCustomer()"
      *ngIf="isUserHasRight(bidoFunctionTypeConstants.UC_MM_SUPPLIER_CHANGE, bidoFunctionTypeConstants.DEGREE_MANAGE)"
    >
      {{ getComponentName() + ".redirectRequest" | translate }}
    </button>

    <button
      type="button"
      mat-raised-button
      (click)="onChangeSupplier()"
      *ngIf="isUserHasRight(bidoFunctionTypeConstants.UC_MM_SUPPLIER_CHANGE, bidoFunctionTypeConstants.DEGREE_UPDATE)"
    >
      {{ getComponentName() + ".changeSupplier" | translate }}
    </button>

    <button
      mat-icon-button
      class="mat-elevation-z1"
      matTooltip="{{ 'global.showAllActionTooltip' | translate }}"
      matTooltipPosition="above"
      aria-label="Show all actions"
      [matMenuTriggerFor]="actions"
    >
      <mat-icon>more_horiz</mat-icon>
    </button>
    <mat-menu #actions="matMenu">
      <button mat-menu-item (click)="reload()">
        {{ "global.refresh" | translate }}
      </button>
      <!-- <button mat-menu-item (click)="updateFavoriteState()">
        {{ (isFavoriteEntry ? "page.removeFromFavorites" : "page.addToFavorites") | translate }}
      </button> -->
    </mat-menu>
  </div>
</div>

<div class="page-wrapper">
  <div class="page-container">
    <div class="page-content">
      <div class="grid-row">
        <div class="grid-cell--8">
          <div class="grid-cell grid-cell--container grid-cell-scope  grid-cell-item-structure">
            <div class="grid-cell-header">
              <div class="grid-cell-title-container loading-indicator">
                <h3 class="grid-cell-title">
                  {{ getComponentName() + ".procurementRequest" | translate }}
                </h3>
              </div>
            </div>

            <div class="grid-cell-content grid-cell-content-with-section">
              <div class="section">
                <div class="section-content">
                  <div class="row">
                    <div class="form-group">
                      <label class="form-label">
                        {{ getComponentName() + ".requestNb" | translate }}
                      </label>

                      <div class="form-control">
                        <div class="form-control-generic">
                          {{ procurementRequest.procCode }}
                        </div>
                      </div>
                    </div>

                    <div class="form-group">
                      <label class="form-label">
                        {{ getComponentName() + ".expirationDate" | translate }}
                      </label>

                      <div class="form-control">
                        <div class="form-control-generic">
                          {{
                            procurementRequest.calendarPotential | date: "yyyy/MM/dd":"":translateService.currentLang
                          }}
                        </div>
                      </div>
                    </div>

                    <div class="form-group">
                      <label class="form-label">
                        {{ "status" | translate }}
                      </label>

                      <div class="form-control">
                        <div class="form-control-generic">
                          {{ formatStatus(procurementRequest.procStatus) }}
                        </div>
                      </div>
                    </div>

                    <div class="form-group">
                      <label class="form-label">
                        {{ getComponentName() + ".criticity" | translate }}
                      </label>

                      <div class="form-control">
                        <div class="form-control-generic">
                          <span
                            *ngIf="
                              procurementRequest.criticality === aWPropertiesConstants.LOGISTICAL_CRITICALITY_ROUTINE
                            "
                            class="ok"
                          >
                            {{ componentData.componentId + ".routine" | translate }}
                          </span>

                          <span
                            *ngIf="
                              procurementRequest.criticality === aWPropertiesConstants.LOGISTICAL_CRITICALITY_IMMEDIATE
                            "
                            class="nok"
                          >
                            {{ componentData.componentId + ".immediate" | translate }}
                          </span>

                          <span
                            *ngIf="
                              procurementRequest.criticality === aWPropertiesConstants.LOGISTICAL_CRITICALITY_URGENT
                            "
                            class="warning"
                          >
                            {{ componentData.componentId + ".urgent" | translate }}
                          </span>
                        </div>
                      </div>
                    </div>
                  </div>

                  <div class="row">
                    <div class="form-group">
                      <label class="form-label">
                        {{ getComponentName() + ".expectedDate" | translate }}
                      </label>

                      <div class="form-control">
                        <div class="form-control-generic">
                          {{ procurementRequest.requestedDate | date: "yyyy/MM/dd":"":translateService.currentLang }}
                        </div>
                      </div>
                    </div>

                    <div class="form-group">
                      <label class="form-label">
                        {{ getComponentName() + ".requestedPotential" | translate }}
                      </label>

                      <div class="form-control">
                        <div class="form-control-generic">
                          {{ formattedRequestedPotential }} {{ procurementRequest.potentialUnit }}
                        </div>
                      </div>
                    </div>

                    <div
                      class="form-group flex--2"
                      [ngClass]="{
                        'visibility--hidden':
                          procurementRequestItem?.birePn?.traceability !=
                            aWPropertiesConstants.PN_TRACEABILITY_BY_BATCH &&
                          procurementRequestItem?.birePn?.traceability != aWPropertiesConstants.PN_TRACEABILITY_BY_SN &&
                          procurementRequestItem?.birePn?.traceability !=
                            aWPropertiesConstants.PN_TRACEABILITY_BY_PACKAGING_BATCH_AND_SN
                      }"
                    >
                      <label class="form-label"> {{ getComponentName() + ".expectedSn" | translate }} </label>

                      <div class="form-control">
                        <input
                          class="aw-input"
                          name="value"
                          type="text"
                          [disabled]="true"
                          [(ngModel)]="procurementRequest.procComment"
                        />
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <div style="display: flex; margin-top: 32px;">
                <div class="section" style="flex-grow: 1; margin-top: 0;">
                  <h4 class="section-title" *ngIf="isProRecSupplierWarehouse">
                    {{ getComponentName() + ".shipper" | translate }}
                  </h4>
                  <h4 class="section-title" *ngIf="!isProRecSupplierWarehouse">
                    {{ getComponentName() + ".itemShipper" | translate }}
                  </h4>

                  <div class="section-content">
                    <div class="row">
                      <div class="form-group" *ngIf="procurementRequest.bidoCustomer">
                        <label class="form-label">{{ getComponentName() + ".partner" | translate }}</label>

                        <div class="form-control">
                          <div class="form-control-generic">
                            {{ procurementRequest.bidoCustomer.customerName }}
                          </div>
                        </div>
                      </div>

                      <div class="form-group" *ngIf="procurementRequest.bidtSiteIssue">
                        <label class="form-label">{{ getComponentName() + ".site" | translate }}</label>

                        <div class="form-control">
                          <div class="form-control-generic">
                            {{ procurementRequest?.bidtSiteIssue?.siteCode }}
                            <ng-container *ngIf="procurementRequest?.bidtSiteIssue?.siteName">
                              - {{ procurementRequest?.bidtSiteIssue?.siteName }}
                            </ng-container>
                          </div>
                        </div>
                      </div>

                      <div class="form-group" *ngIf="currentSupplierWarehouse">
                        <label class="form-label">{{ "warehouse" | translate }}</label>

                        <div class="form-control">
                          <div class="form-control-generic">
                            {{ currentSupplierWarehouse.whCode }}
                            <ng-container *ngIf="currentSupplierWarehouse.whName">
                              - {{ currentSupplierWarehouse.whName }}
                            </ng-container>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>

                <div class="section" style="flex-grow: 1; margin-top: 0;">
                  <h4 class="section-title">
                    {{ componentData.componentId + ".recepient" | translate }}
                  </h4>

                  <div class="section-content">
                    <div class="row">
                      <div class="form-group">
                        <label class="form-label">
                          {{ componentData.componentId + ".site" | translate }}
                        </label>

                        <div class="form-control">
                          <div class="form-control-generic">
                            {{ procurementRequest?.bidtSiteReceipt?.siteCode }}
                            <ng-container *ngIf="procurementRequest?.bidtSiteReceipt?.siteName">
                              - {{ procurementRequest?.bidtSiteReceipt?.siteName }}
                            </ng-container>
                          </div>
                        </div>
                      </div>

                      <div class="form-group">
                        <label class="form-label">
                          {{ componentData.componentId + ".warehouseAndWorkshop" | translate }}
                        </label>

                        <div class="form-control">
                          <div class="form-control-generic">
                            {{ procurementRequest?.bidtWarehouseReceipt?.whCode }}
                            <ng-container *ngIf="procurementRequest?.bidtWarehouseReceipt?.whName">
                              - {{ procurementRequest?.bidtWarehouseReceipt?.whName }}
                            </ng-container>
                          </div>
                        </div>
                      </div>

                      <div class="form-group" *ngIf="workPackageAsset">
                        <label class="form-label">
                          <ng-container
                            *ngIf="
                              workPackageAsset.equipmentFunction == aWPropertiesConstants.FAMILY_FUNCTION_AIRCRAFT_KEY
                            "
                          >
                            {{ "aircraft" | translate }}
                          </ng-container>
                          <ng-container
                            *ngIf="
                              workPackageAsset.equipmentFunction == aWPropertiesConstants.FAMILY_FUNCTION_ENGINE_KEY
                            "
                          >
                            {{ "engine" | translate }}
                          </ng-container>
                          <ng-container
                            *ngIf="
                              workPackageAsset.equipmentFunction !=
                                aWPropertiesConstants.FAMILY_FUNCTION_AIRCRAFT_KEY &&
                              workPackageAsset.equipmentFunction != aWPropertiesConstants.FAMILY_FUNCTION_ENGINE_KEY
                            "
                          >
                            {{ "equipment" | translate }}
                          </ng-container>
                        </label>

                        <div class="form-control">
                          <div class="form-control-generic">
                            <a (click)="openWorkPackageAsset()">{{ workPackageAssetName }}</a>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="grid-cell--4">
          <div class="grid-cell grid-cell--container">
            <div class="grid-cell-header">
              <div class="grid-cell-title-container">
                <h3 class="grid-cell-title">
                  {{ getComponentName() + ".item" | translate }}
                </h3>
              </div>
            </div>

            <div class="grid-cell-content grid-cell-content-with-section">
              <div class="column">
                <div class="row">
                  <div class="column">
                    <div class="row">
                      <div class="form-group">
                        <label class="form-label">
                          {{ componentData.componentId + ".partNumber" | translate }}
                        </label>

                        <div class="form-control">
                          <div class="form-control-generic">
                            {{ procurementRequestItem.birePn?.pnCode }}
                          </div>
                        </div>
                      </div>

                      <div class="form-group">
                        <label class="form-label">
                          {{ componentData.componentId + ".requestedQuantity" | translate }}
                        </label>

                        <div class="form-control">
                          <div class="form-control-generic">
                            {{ formatQuantity(procurementRequestItem.requestedQuantity) }}
                          </div>
                        </div>
                      </div>
                    </div>

                    <div class="row">
                      <div class="form-group">
                        <label class="form-label">
                          {{ componentData.componentId + ".designation" | translate }}
                        </label>

                        <div class="form-control">
                          <div class="form-control-generic">
                            {{ procurementRequestItem.birePn?.articleDesignation }}
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>

                  <!-- <div class="row" *ngIf="itemIllustration">
                    <img [src]="itemIllustration" class="img-dimension" />
                  </div> -->
                </div>

                <div class="section">
                  <h4 class="section-title">
                    {{ componentData.componentId + ".advancement" | translate }}
                  </h4>

                  <div class="section-content">
                    <div class="row" style="margin-bottom: 8px;">
                      <div
                        style="padding: 8px; color: #000; border-radius: 4px; margin-left: 16px;"
                        [ngClass]="{
                          'served--nok': servedNb == 0,
                          'served--ok':
                            servedNb > 0 &&
                            isSameQuantity(servedNb.toString(), procurementRequestItem.requestedQuantity),
                          'served--warning':
                            servedNb > 0 &&
                            !isSameQuantity(servedNb.toString(), procurementRequestItem.requestedQuantity)
                        }"
                      >
                        <span *ngIf="servedNb == 0">
                          {{ componentData.componentId + ".notServed" | translate }}
                        </span>
                        <span
                          *ngIf="
                            servedNb > 0 &&
                            !isSameQuantity(servedNb.toString(), procurementRequestItem.requestedQuantity)
                          "
                        >
                          {{ componentData.componentId + ".partiallyServed" | translate }}
                        </span>
                        <span
                          *ngIf="
                            servedNb > 0 &&
                            isSameQuantity(servedNb.toString(), procurementRequestItem.requestedQuantity)
                          "
                        >
                          {{ componentData.componentId + ".served" | translate }}
                        </span>
                      </div>
                    </div>

                    <div class="row">
                      <div class="form-group flex-row--align-center">
                        <div class="form-control">
                          <div class="form-control-generic" style="font-size: 3rem; padding-bottom: 1rem;">
                            {{ notServedNb }}
                          </div>
                        </div>
                        <label class="form-label">
                          <ng-container
                            *ngIf="
                              procurementRequest.procStatus ==
                                aWPropertiesConstants.PROCUREMENT_REQUEST_STATUS_SIMULATED ||
                              procurementRequest.procStatus ==
                                aWPropertiesConstants.PROCUREMENT_REQUEST_STATUS_PLANNED ||
                              procurementRequest.procStatus == aWPropertiesConstants.PROCUREMENT_REQUEST_STATUS_DRAFT
                            "
                          >
                            {{ getComponentName() + ".notSelected" | translate }}
                          </ng-container>
                          <ng-container
                            *ngIf="
                              procurementRequest.procStatus !=
                                aWPropertiesConstants.PROCUREMENT_REQUEST_STATUS_SIMULATED &&
                              procurementRequest.procStatus !=
                                aWPropertiesConstants.PROCUREMENT_REQUEST_STATUS_PLANNED &&
                              procurementRequest.procStatus != aWPropertiesConstants.PROCUREMENT_REQUEST_STATUS_DRAFT
                            "
                          >
                            {{ getComponentName() + ".notBooked" | translate }}
                          </ng-container>
                        </label>
                      </div>

                      <div class="form-group flex-row--align-center">
                        <div class="form-control">
                          <div class="form-control-generic" style="font-size: 3rem; padding-bottom: 1rem">
                            {{ bookedNb }}
                          </div>
                        </div>
                        <label class="form-label">
                          <ng-container
                            *ngIf="
                              procurementRequest.procStatus ==
                                aWPropertiesConstants.PROCUREMENT_REQUEST_STATUS_SIMULATED ||
                              procurementRequest.procStatus ==
                                aWPropertiesConstants.PROCUREMENT_REQUEST_STATUS_PLANNED ||
                              procurementRequest.procStatus == aWPropertiesConstants.PROCUREMENT_REQUEST_STATUS_DRAFT
                            "
                          >
                            {{ getComponentName() + ".selected" | translate }}
                          </ng-container>
                          <ng-container
                            *ngIf="
                              procurementRequest.procStatus !=
                                aWPropertiesConstants.PROCUREMENT_REQUEST_STATUS_SIMULATED &&
                              procurementRequest.procStatus !=
                                aWPropertiesConstants.PROCUREMENT_REQUEST_STATUS_PLANNED &&
                              procurementRequest.procStatus != aWPropertiesConstants.PROCUREMENT_REQUEST_STATUS_DRAFT
                            "
                          >
                            {{ getComponentName() + ".booked" | translate }}
                          </ng-container>
                        </label>
                      </div>

                      <div class="form-group flex-row--align-center">
                        <div class="form-control">
                          <div class="form-control-generic" style="font-size: 3rem; padding-bottom: 1rem">
                            {{ servedNb }}
                          </div>
                        </div>
                        <label class="form-label">{{ getComponentName() + ".served" | translate }}</label>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="grid-row">
        <div class="grid-cell--12">
          <div class="grid-cell grid-cell--container">
            <div class="grid-cell-header">
              <div class="grid-cell-title-container  loading-indicator">
                <h3 class="grid-cell-title">
                  {{ getComponentName() + ".suggestedAssets" | translate }}
                </h3>
              </div>
            </div>

            <div class="grid-cell-content">
              <div class="column">
                <div class="row">
                  <div class="form-group">
                    <div class="form-control aw-selectbutton-wrapper">
                      <p-selectButton
                        [(ngModel)]="selectedcandidateAssetCategory"
                        [options]="candidateAssetCategoryList"
                        (onChange)="updateCandidateAssetTableColumns()"
                      ></p-selectButton>
                    </div>
                  </div>
                  <div class="form-group central-right-part">
                    <i class="form-label" *ngIf="quantityInMovement > 0">
                      {{ quantityInMovement | formatNumber }}
                      {{ getComponentName() + ".quantityInMovement" | translate }}
                    </i>
                    <button
                      type="button"
                      mat-raised-button
                      (click)="openCreateTransferDialog()"
                      *ngIf="selectedcandidateAssetCategory === candidateAssetCategory.GLOBAL && remainingQuantity > 0"
                    >
                      {{ getComponentName() + ".createTransfer" | translate }}
                    </button>
                  </div>
                </div>

                <p-table
                  [resizableColumns]="true"
                  #ptableResults
                  class="aw-table2"
                  [columns]="materialProposedTableCols"
                  [value]="candidateAssets"
                  [scrollable]="true"
                >
                  <ng-template pTemplate="emptymessage">
                    <span *ngIf="!iscandidateAssetsLoading"> &nbsp;</span>

                    <div *ngIf="iscandidateAssetsLoading" class="aw-table-loading-indicator">
                      <div class="loading-message">{{ "table.loadingData" | translate }}</div>
                      <div class="lds-hourglass"></div>
                    </div>
                  </ng-template>

                  <ng-template pTemplate="caption">
                    <div class="aw-table-header">
                      <div class="aw-table-global-filter">
                        <label class="aw-table-global-filter-label">
                          <i class="fa fa-fw fa-search" aria-hidden="true"></i>
                        </label>

                        <input
                          #ptableResultsGlobalFilter
                          class="aw-table-global-filter-input"
                          type="text"
                          placeholder="{{ 'table.globalFilterText' | translate }}"
                          (input)="ptableResults.filterGlobal($event.target.value, 'contains')"
                        />
                      </div>

                      <div class="table-actions">
                        <!-- Temporary until more info pn 3490
                          <p-splitButton
                          *ngIf="potentialUnitList && potentialUnitList.length > 0"
                          class="aw-split-btn"
                          label="{{ getComponentName() + '.potentialUnit' | translate }} ({{ potentialUnitSelected }})"
                          [model]="potentialUnitList"
                        ></p-splitButton>-->

                        <div class="aw-table-icon-actions" style="margin-left: 0px;">
                          <i
                            class="fa fa-fw fa-filter aw-icon aw-icon-with-border aw-icon-with-overlay"
                            aria-hidden="true"
                            [ngClass]="{ active: filtersVisible }"
                            (click)="opFilters.toggle($event)"
                          ></i>
                        </div>
                      </div>
                    </div>
                  </ng-template>

                  <ng-template pTemplate="colgroup" let-columns>
                    <colgroup>
                      <col *ngFor="let col of columns" [ngStyle]="{ width: col.width }" />
                      <col
                        *ngIf="selectedcandidateAssetCategory != candidateAssetCategory.GLOBAL"
                        [ngStyle]="{ width: '10%' }"
                      />
                    </colgroup>
                  </ng-template>

                  <ng-template pTemplate="header" let-columns>
                    <tr>
                      <th
                        pResizableColumn
                        *ngFor="let col of columns"
                        [ngStyle]="{ 'text-align': col.alignment }"
                        [ngSwitch]="col.field"
                      >
                        <ng-container *ngSwitchCase="'sn'">
                          <ng-container
                            *ngIf="
                              procurementRequestItem?.birePn?.traceability ==
                                aWPropertiesConstants.PN_TRACEABILITY_BY_SN ||
                              procurementRequestItem?.birePn?.traceability ==
                                aWPropertiesConstants.PN_TRACEABILITY_BY_PACKAGING_BATCH_AND_SN
                            "
                          >
                            {{ getComponentName() + ".sn" | translate }}
                          </ng-container>
                          <ng-container
                            *ngIf="
                              procurementRequestItem?.birePn?.traceability ==
                              aWPropertiesConstants.PN_TRACEABILITY_BY_BATCH
                            "
                          >
                            {{ getComponentName() + ".manufacturingBatch" | translate }}
                          </ng-container>
                        </ng-container>

                        <ng-container *ngSwitchDefault>
                          {{ getComponentName() + "." + col.field | translate }}
                        </ng-container>
                      </th>

                      <th
                        *ngIf="selectedcandidateAssetCategory != candidateAssetCategory.GLOBAL"
                        style="text-align: center;"
                      >
                        Action
                      </th>
                    </tr>
                  </ng-template>

                  <ng-template pTemplate="body" let-rowData let-columns="columns" let-rowIndex="rowIndex">
                    <tr [pSelectableRow]="rowData" [pSelectableRowIndex]="rowIndex">
                      <td
                        *ngFor="let col of columns"
                        [ngSwitch]="col.field"
                        [ngStyle]="{ 'text-align': col.alignment }"
                      >
                        <div *ngSwitchCase="'msn'">
                          <div class="row">
                            <a class="font-bold" (click)="openEquipment(rowData['topEquipment'])">{{
                              rowData["topEquipment"]?.sn
                            }}</a>
                          </div>

                          <div class="row">
                            {{ formatEquipmentStatus(rowData["topEquipment"]?.equipmentDesignation) }}
                          </div>
                        </div>

                        <div *ngSwitchCase="'locationForPicking'">
                          {{
                            rowData["currentBidmProject"]
                              ? formatSite(rowData["currentBidmProject"].bireRepairCenterCode)
                              : rowData["topEquipmentLocation"]
                          }}
                        </div>

                        <div *ngSwitchCase="'material'">
                          <div class="row">
                            <a class="font-bold" (click)="openPart(rowData)">{{ rowData["pn"]?.pnCode }}</a>
                          </div>

                          <div class="row">
                            <span class="italic">{{ rowData["equipment"]?.equipmentDesignation }}</span>
                          </div>
                        </div>

                        <div *ngSwitchCase="'sn'">
                          <div class="row">
                            <a
                              class="font-bold"
                              (click)="openEquipment(rowData['equipment'])"
                              *ngIf="rowData['equipment'].sn && !rowData['stockInformation']?.manufacturingBatchNumber"
                            >
                              {{ rowData["equipment"]?.sn }}
                            </a>
                            <a
                              class="bold"
                              (click)="openManufacturingBatch(rowData['stockInformation'].manufacturingBatchNumber)"
                              *ngIf="!rowData['equipment'].sn && rowData['stockInformation']?.manufacturingBatchNumber"
                            >
                              {{ rowData["stockInformation"].manufacturingBatchNumber }}
                            </a>
                          </div>

                          <div class="row" *ngIf="!rowData['equipment'].batchNumber">
                            <span class="italic">{{
                              formatEquipmentStatus(rowData["equipment"]?.operationalStatus)
                            }}</span>
                          </div>
                        </div>

                        <div *ngSwitchCase="'snBatch'">
                          <div class="row">
                            <a
                              class="font-bold"
                              (click)="openEquipment(rowData['equipment'])"
                              *ngIf="rowData['equipment'].sn && !rowData['stockInformation']?.manufacturingBatchNumber"
                            >
                              {{ rowData["equipment"]?.sn }}
                            </a>
                            <a
                              class="bold"
                              (click)="openManufacturingBatch(rowData['stockInformation'].manufacturingBatchNumber)"
                              *ngIf="!rowData['equipment'].sn && rowData['stockInformation']?.manufacturingBatchNumber"
                            >
                              {{ rowData["stockInformation"].manufacturingBatchNumber }}
                            </a>
                          </div>

                          <div class="row" *ngIf="!rowData['equipment'].batchNumber">
                            <span class="italic">{{
                              formatEquipmentStatus(rowData["equipment"]?.operationalStatus)
                            }}</span>
                          </div>
                        </div>

                        <div *ngSwitchCase="'quantity'">
                          {{ rowData["equipment"]?.quantity | formatNumber }}
                          <ng-container *ngIf="rowData['stockInformation'].stockMvtUnit">
                            {{ rowData["stockInformation"].stockMvtUnit }}
                          </ng-container>
                        </div>

                        <div *ngSwitchCase="'batch'">
                          <div class="row">
                            <a
                              class="font-bold"
                              (click)="
                                rowData['equipment']?.sn
                                  ? openEquipment(rowData['equipment'])
                                  : openBatch(rowData['equipment'].equipmentCode)
                              "
                              *ngIf="rowData['equipment']"
                            >
                              {{ rowData["equipment"].batchNumber }}
                            </a>
                          </div>

                          <div class="row" *ngIf="rowData['equipment'].batchNumber">
                            <span class="italic">{{
                              formatEquipmentStatus(rowData["equipment"]?.operationalStatus)
                            }}</span>
                          </div>
                        </div>

                        <div *ngSwitchCase="'location'">
                          <div class="row" *ngIf="rowData['siteReceipt']?.siteName">
                            <span class="font-bold">{{ rowData["siteReceipt"]?.siteName }}</span>
                          </div>

                          <div class="row">
                            <span class="italic">{{ rowData["warehouseReceipt"]?.whName }}</span>
                          </div>
                        </div>

                        <div *ngSwitchCase="'technicalData'">
                          <div class="row" *ngIf="rowData['potentialValue']">
                            <span style="width: 5rem;">{{ getComponentName() + ".potential" | translate }}</span>
                            <span class="font-bold"
                              >{{ formatPotential(rowData["potentialValue"]) }} {{ rowData["potentialUnit"] }}</span
                            >
                          </div>

                          <div class="row" *ngIf="rowData['calendarPotential']">
                            <span style="width: 5rem;">{{ getComponentName() + ".expiration" | translate }}</span>
                            <span class="font-bold">{{
                              rowData["calendarPotential"] | date: "yyyy/MM/dd":"":translateService.currentLang
                            }}</span>
                          </div>
                        </div>

                        <div *ngSwitchCase="'availabilityAtDate'">
                          <div class="row">
                            <span *ngIf="isCandidateAssetServed(rowData)" class="font-bold">
                              {{ getComponentName() + ".served" | translate }}
                            </span>

                            <span
                              class="font-bold"
                              [ngClass]="{
                                green:
                                  !rowData['bookingProcurementRequest'] ||
                                  rowData['bookingProcurementRequest'].id === procurementRequest.id,
                                yellow:
                                  rowData['bookingProcurementRequest'] &&
                                  rowData['bookingProcurementRequest'].id !== procurementRequest.id
                              }"
                              *ngIf="isAvailableAtDate(rowData) && !isCandidateAssetServed(rowData)"
                            >
                              {{ "yes" | translate }}
                              <span *ngIf="rowData['plannedAvailabilityDate']">
                                ({{
                                  rowData["plannedAvailabilityDate"]
                                    | date: "yyyy/MM/dd":"":translateService.currentLang
                                }})
                              </span>
                            </span>
                            <span class="font-bold red" *ngIf="!isAvailableAtDate(rowData)">
                              {{ "no" | translate }}
                              <span *ngIf="rowData['plannedAvailabilityDate']">
                                ({{
                                  rowData["plannedAvailabilityDate"]
                                    | date: "yyyy/MM/dd":"":translateService.currentLang
                                }})
                              </span>
                            </span>
                          </div>

                          <div class="row">
                            <span
                              *ngIf="
                                rowData['bookingProcurementRequest'] &&
                                rowData['bookingProcurementRequest'].id === procurementRequest.id
                              "
                              style="font-style: italic;"
                              class="green"
                            >
                              <ng-container
                                *ngIf="
                                  rowData['bookingProcurementRequest']?.procStatus ==
                                    aWPropertiesConstants.PROCUREMENT_REQUEST_STATUS_SIMULATED ||
                                  rowData['bookingProcurementRequest']?.procStatus ==
                                    aWPropertiesConstants.PROCUREMENT_REQUEST_STATUS_PLANNED ||
                                  rowData['bookingProcurementRequest']?.procStatus ==
                                    aWPropertiesConstants.PROCUREMENT_REQUEST_STATUS_DRAFT
                                "
                              >
                                {{ getBookedQty(rowData) | formatNumber }}
                                {{ getComponentName() + ".selectedBy" | translate }}
                              </ng-container>
                              <ng-container
                                *ngIf="
                                  rowData['bookingProcurementRequest']?.procStatus !=
                                    aWPropertiesConstants.PROCUREMENT_REQUEST_STATUS_SIMULATED &&
                                  rowData['bookingProcurementRequest']?.procStatus !=
                                    aWPropertiesConstants.PROCUREMENT_REQUEST_STATUS_PLANNED &&
                                  rowData['bookingProcurementRequest']?.procStatus !=
                                    aWPropertiesConstants.PROCUREMENT_REQUEST_STATUS_DRAFT
                                "
                              >
                                {{ getBookedQty(rowData) | formatNumber }}
                                {{ getComponentName() + ".bookedBy" | translate }}
                              </ng-container>

                              <a (click)="openTransferOrder(rowData['transferOrder'])">{{
                                rowData["transferOrder"]?.torCode
                              }}</a>
                            </span>

                            <span
                              *ngIf="
                                rowData['bookingProcurementRequest'] &&
                                rowData['bookingProcurementRequest'].id !== procurementRequest.id &&
                                (!rowData['warehouseReceipt'] ||
                                  rowData['warehouseReceipt'] !==
                                    aWPropertiesConstants.MM_WAREHOUSE_TYPE_DEPLOYEMENT_BATCH)
                              "
                              style="font-style: italic;"
                              class="yellow"
                            >
                              <ng-container
                                *ngIf="
                                  rowData['bookingProcurementRequest']?.procStatus ==
                                    aWPropertiesConstants.PROCUREMENT_REQUEST_STATUS_SIMULATED ||
                                  rowData['bookingProcurementRequest']?.procStatus ==
                                    aWPropertiesConstants.PROCUREMENT_REQUEST_STATUS_PLANNED ||
                                  rowData['bookingProcurementRequest']?.procStatus ==
                                    aWPropertiesConstants.PROCUREMENT_REQUEST_STATUS_DRAFT
                                "
                              >
                                {{ getComponentName() + ".selectedFor" | translate }}
                              </ng-container>
                              <ng-container
                                *ngIf="
                                  rowData['bookingProcurementRequest']?.procStatus !=
                                    aWPropertiesConstants.PROCUREMENT_REQUEST_STATUS_SIMULATED &&
                                  rowData['bookingProcurementRequest']?.procStatus !=
                                    aWPropertiesConstants.PROCUREMENT_REQUEST_STATUS_PLANNED &&
                                  rowData['bookingProcurementRequest']?.procStatus !=
                                    aWPropertiesConstants.PROCUREMENT_REQUEST_STATUS_DRAFT
                                "
                              >
                                {{ getComponentName() + ".bookedFor" | translate }}
                              </ng-container>

                              <a (click)="openProcurementRequest(rowData['bookingProcurementRequest'])">
                                {{ rowData["bookingProcurementRequest"].procCode }}
                              </a>
                            </span>

                            <span
                              *ngIf="
                                rowData['bookingProcurementRequest'] &&
                                rowData['bookingProcurementRequest'].id !== procurementRequest.id &&
                                rowData['warehouseReceipt'] ===
                                  aWPropertiesConstants.MM_WAREHOUSE_TYPE_DEPLOYEMENT_BATCH
                              "
                              style="font-style: italic;"
                              class="yellow"
                            >
                              {{ getComponentName() + ".bookedForDeploymentBatch" | translate }}
                            </span>
                          </div>
                        </div>

                        <div *ngSwitchCase="'satisfactionRate'">
                          <div class="row" *ngIf="!isCandidateAssetServed(rowData)">
                            <div style="width: 100%; cursor: pointer;">
                              <p-progressBar
                                [ngClass]="{
                                  green: calculateSatisfactionRate(rowData) == 100,
                                  yellow: calculateSatisfactionRate(rowData) < 100,
                                  red: calculateSatisfactionRate(rowData) < 40
                                }"
                                [value]="calculateSatisfactionRate(rowData)"
                                (click)="openSatisfactionRateDetails(rowData)"
                              ></p-progressBar>
                            </div>
                          </div>
                        </div>
                      </td>

                      <td
                        *ngIf="selectedcandidateAssetCategory != candidateAssetCategory.GLOBAL"
                        style="text-align: center;"
                      >
                        <button
                          style="margin: 0 auto"
                          type="button"
                          class="btn-with-spinner"
                          mat-raised-button
                          (click)="bookCandidateAsset(rowData)"
                          *ngIf="
                            !rowData['bookingProcurementRequest'] &&
                            isSelectBtnVisible() &&
                            !isCandidateAssetServed(rowData) &&
                            selectedcandidateAssetCategory != candidateAssetCategory.PICKING
                          "
                        >
                          <span class="lds-hourglass" *ngIf="rowData['_bookCandidateAssetLoading']"></span>
                          {{ getComponentName() + ".select" | translate }}
                        </button>

                        <button
                          style="margin: 0 auto"
                          type="button"
                          (click)="cancelBooking(rowData)"
                          *ngIf="
                            rowData['bookingProcurementRequest'] &&
                            rowData['bookingProcurementRequest'].id == procurementRequest.id &&
                            selectedcandidateAssetCategory != candidateAssetCategory.PICKING &&
                            isCancelBookingBtnVisible(rowData)
                          "
                          mat-raised-button
                          color="warn"
                        >
                          {{ getComponentName() + ".cancel" | translate }}
                        </button>

                        <button
                          style="margin: 0 auto"
                          type="button"
                          (click)="cancelPicking(rowData)"
                          *ngIf="
                            rowData['currentBidmProject'] &&
                            selectedcandidateAssetCategory == candidateAssetCategory.PICKING
                          "
                          mat-raised-button
                          color="warn"
                        >
                          {{ getComponentName() + ".cancel" | translate }}
                        </button>

                        <button
                          style="margin: 0 auto"
                          type="button"
                          class="btn-with-spinner"
                          mat-raised-button
                          (click)="pick(rowData)"
                          *ngIf="
                            !rowData['currentBidmProject'] &&
                            selectedcandidateAssetCategory == candidateAssetCategory.PICKING
                          "
                        >
                          <span class="lds-hourglass" *ngIf="saving"></span>
                          {{ getComponentName() + ".pick" | translate }}
                        </button>

                        <button
                          style="margin: 0 auto"
                          type="button"
                          mat-raised-button
                          color="accent"
                          *ngIf="
                            rowData['bookingProcurementRequest'] &&
                            rowData['bookingProcurementRequest'].id != procurementRequest.id &&
                            (rowData['bookingProcurementRequest'].procStatus ==
                              aWPropertiesConstants.PROCUREMENT_REQUEST_STATUS_RELEASED ||
                              rowData['bookingProcurementRequest'].procStatus ==
                                aWPropertiesConstants.PROCUREMENT_REQUEST_STATUS_ONGOING) &&
                            rowData['_hasPreemptionRight'] &&
                            isSelectBtnVisible()
                          "
                          (click)="confirmPreemptCandidateAsset(rowData)"
                        >
                          {{ getComponentName() + ".preempter" | translate }}
                        </button>

                        <button
                          style="margin: 0 auto"
                          type="button"
                          mat-raised-button
                          *ngIf="
                            rowData['bookingProcurementRequest'] &&
                            rowData['bookingProcurementRequest'].id != procurementRequest.id &&
                            rowData['bookingProcurementRequest'].procStatus !=
                              aWPropertiesConstants.PROCUREMENT_REQUEST_STATUS_RELEASED &&
                            rowData['bookingProcurementRequest'].procStatus !=
                              aWPropertiesConstants.PROCUREMENT_REQUEST_STATUS_ONGOING &&
                            isSelectBtnVisible()
                          "
                          (click)="preemptCandidateAsset(rowData)"
                        >
                          {{ getComponentName() + ".preempter" | translate }}
                        </button>
                      </td>
                    </tr>
                  </ng-template>
                </p-table>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- <aw-dialog-image *ngIf="openImageDialog" [imgSrc]="dialogImgSrc"></aw-dialog-image> -->
  <aw-change-customer-popup-form
    [(display)]="openChangeCustomerDialog"
    *ngIf="openChangeCustomerDialog"
    [procurementRequest]="procurementRequest"
  ></aw-change-customer-popup-form>

  <aw-dialog-satisfaction-rate
    [(display)]="showSatisfactionRateDialog"
    *ngIf="showSatisfactionRateDialog"
    [procurementRequest]="procurementRequest"
    [candidateAsset]="selectedCandidateAsset"
  ></aw-dialog-satisfaction-rate>

  <aw-change-warehouse-and-quantity-popup-form
    [(display)]="showChangeSupplierAndQuantityDialog"
    *ngIf="showChangeSupplierAndQuantityDialog"
    [procurementRequest]="procurementRequest"
    [procurementRequestItem]="procurementRequestItem"
    [oldQuantity]="notServedNb"
    [totalQuantity]="notServedNb + bookedNb + servedNb"
    (onValidated)="reload()"
  ></aw-change-warehouse-and-quantity-popup-form>

  <aw-transfer-order-popup
    *ngIf="showCreateTransferOrderDialog"
    [(display)]="showCreateTransferOrderDialog"
    [pn]="procurementRequestItem.birePn"
    [createTransferOrderInput]="this.createTransferOrderInput"
    (onValidate)="onCreateTransferOrder()"
  >
  </aw-transfer-order-popup>
</div>
<p-overlayPanel #opFilters class="aw-overlay" (onShow)="filtersVisible = true" (onHide)="filtersVisible = false">
  <div class="grid-cell-content grid-cell-content-with-section">
    <div class="col">
      <div class="section">
        <h4 class="section-title">{{ getComponentName() + ".location" | translate }}</h4>

        <div class="section-content">
          <div class="row">
            <div class="form-group" style="min-width: 350px;">
              <label class="form-label"> {{ getComponentName() + ".site" | translate }} </label>
              <div class="form-control">
                <p-dropdown
                  class="aw-dropdown fixed-width"
                  placeholder="&nbsp;"
                  [showClear]="true"
                  [(ngModel)]="searchFilterObject.site"
                  [options]="siteList"
                  (onChange)="loadLocationWarehouses()"
                ></p-dropdown>
              </div>
            </div>

            <div class="form-group">
              <label
                class="form-label"
                *ngIf="locationWarehouseType === aWPropertiesConstants.WAREHOUSE_CATEGORY_WAREHOUSE"
              >
                {{ componentData.componentId + ".warehouse" | translate }}
              </label>
              <label
                class="form-label"
                *ngIf="locationWarehouseType === aWPropertiesConstants.WAREHOUSE_CATEGORY_WORKSHOP"
              >
                {{ componentData.componentId + ".workshop" | translate }}
              </label>

              <div class="form-control ">
                <p-selectButton
                  [options]="logisticsTypeList"
                  [(ngModel)]="locationWarehouseType"
                  (onChange)="loadLocationWarehouses()"
                ></p-selectButton>
              </div>
            </div>
            <div class="form-group" style="min-width: 400px;">
              <label class="form-label">&nbsp;</label>
              <div class="form-control">
                <p-dropdown
                  class="aw-dropdown fixed-width"
                  placeholder="&nbsp;"
                  [showClear]="true"
                  [(ngModel)]="searchFilterObject.warehouse"
                  [options]="warehouseList"
                ></p-dropdown>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="section">
        <div class="section-content">
          <div class="row">
            <div class="form-group">
              <label class="form-label"> {{ getComponentName() + ".snFilter" | translate }} </label>
              <div class="form-control">
                <input class="aw-input" name="sn" type="text" [(ngModel)]="searchFilterObject.sn" />
              </div>
            </div>
            <div class="form-group">
              <label class="form-label"> {{ getComponentName() + ".status" | translate }} </label>
              <div class="form-control">
                <p-dropdown
                  class="aw-dropdown fixed-width"
                  [options]="equipmentStatusListFilter"
                  [showClear]="true"
                  placeholder="&nbsp;"
                  [(ngModel)]="searchFilterObject.status"
                >
                </p-dropdown>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="section">
        <h4 class="section-title">{{ getComponentName() + ".satisfactionRate" | translate }}</h4>
        <div class="section-content">
          <div class="form-group">
            <div class="row" style="padding-bottom: 5px;">
              <div class="flex--2">
                <div class="form-control">
                  <label class="form-label"> {{ getComponentName() + ".sameSiteFilter" | translate }} </label>
                </div>
              </div>
              <div class="flex--1">
                <div class="form-control aw-selectbutton-wrapper">
                  <p-selectButton
                    [(ngModel)]="searchFilterObject.sameSite"
                    [options]="satifactionRateStatus"
                  ></p-selectButton>
                </div>
              </div>
            </div>
            <div class="row" style="padding-bottom: 5px;">
              <div class="flex--2">
                <div class="form-control">
                  <label class="form-label"> {{ getComponentName() + ".bookingStatusFilter" | translate }} </label>
                </div>
              </div>
              <div class="flex--1">
                <div class="form-control aw-selectbutton-wrapper">
                  <p-selectButton
                    [(ngModel)]="searchFilterObject.bookingStatus"
                    [options]="satifactionRateStatus"
                  ></p-selectButton>
                </div>
              </div>
            </div>
            <div class="row" style="padding-bottom: 5px;">
              <div class="flex--2">
                <div class="form-control">
                  <label class="form-label"> {{ getComponentName() + ".availableAtDateFilter" | translate }} </label>
                </div>
              </div>
              <div class="flex--1">
                <div class="form-control aw-selectbutton-wrapper">
                  <p-selectButton
                    [(ngModel)]="searchFilterObject.availableAtDate"
                    [options]="satifactionRateStatus"
                  ></p-selectButton>
                </div>
              </div>
            </div>
            <div class="row" style="padding-bottom: 5px;">
              <div class="flex--2">
                <div class="form-control">
                  <label class="form-label"> {{ getComponentName() + ".potentialFilter" | translate }} </label>
                </div>
              </div>
              <div class="flex--1">
                <div class="form-control aw-selectbutton-wrapper">
                  <p-selectButton
                    [(ngModel)]="searchFilterObject.potential"
                    [options]="satifactionRateStatus"
                  ></p-selectButton>
                </div>
              </div>
            </div>
            <div class="row" style="padding-bottom: 5px;">
              <div class="flex--2">
                <div class="form-control">
                  <label class="form-label"> {{ getComponentName() + ".calendarPotentialFilter" | translate }} </label>
                </div>
              </div>
              <div class="flex--1">
                <div class="form-control aw-selectbutton-wrapper">
                  <p-selectButton
                    [(ngModel)]="searchFilterObject.calendarPotential"
                    [options]="satifactionRateStatus"
                  ></p-selectButton>
                </div>
              </div>
            </div>
            <div class="row" style="padding-bottom: 5px;">
              <div class="flex--2">
                <div class="form-control">
                  <label class="form-label">
                    {{ getComponentName() + ".noUnconfirmedFailureFilter" | translate }}
                  </label>
                </div>
              </div>
              <div class="flex--1">
                <div class="form-control aw-selectbutton-wrapper">
                  <p-selectButton
                    [(ngModel)]="searchFilterObject.noUnconfirmedFailure"
                    [options]="satifactionRateStatus"
                  ></p-selectButton>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="row action-list" style="justify-content: flex-end;">
      <button type="button" mat-raised-button (click)="opFilters.hide(); filtersVisible = false; resetFilters()">
        {{ "global.reset" | translate }}
      </button>

      <button
        type="button"
        mat-raised-button
        (click)="opFilters.hide(); filtersVisible = false; filterSearchResult()"
        color="primary"
        style="margin-left: 8px;"
      >
        {{ "global.filter" | translate }}
      </button>
    </div>
  </div>
</p-overlayPanel>
