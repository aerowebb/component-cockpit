<div class="page-header">
  <div class="page-info">
    <div>
      <div class="page-title">
        {{ "transaction." + componentData.componentId | translate }}
      </div>

      <div class="page-subtitle">
        <div *ngIf="!isCreateOpenMode && componentData && componentData.objectId" class="page-subtitle">
          - {{ subTitle }}
        </div>
      </div>
    </div>
  </div>

  <div class="page-actions" *ngIf="!isFromWorkPackage">
    <button
      type="button"
      *ngIf="!isReadOpenMode && !isCreateOpenMode && !isStatusClose"
      mat-raised-button
      (click)="close()"
    >
      {{ getComponentName() + ".close" | translate }}
    </button>
    <button
      type="button"
      *ngIf="!isReadOpenMode && !isCreateOpenMode && isStatusClose"
      mat-raised-button
      (click)="reopen()"
    >
      {{ getComponentName() + ".reopen" | translate }}
    </button>

    <button *ngIf="isReadOpenMode" type="button" mat-raised-button (click)="edit()">
      {{ "global.edit" | translate }}
    </button>

    <button
      *ngIf="!isReadOpenMode && !isCreateOpenMode"
      type="button"
      color="warn"
      mat-raised-button
      (click)="cancel()"
    >
      {{ "global.cancel" | translate }}
    </button>
    <button
      *ngIf="!isReadOpenMode"
      class="btn-with-spinner"
      color="primary"
      type="button"
      mat-raised-button
      (click)="save()"
    >
      <span class="lds-hourglass" *ngIf="showSaveSpinner"></span>
      <span *ngIf="isCreateOpenMode">{{ "global.save" | translate }}</span>
      <span *ngIf="!isCreateOpenMode">{{ "global.update" | translate }}</span>
    </button>

    <button
      id="actions"
      mat-icon-button
      class="mat-elevation-z1"
      matTooltip="{{ 'global.showAllActionTooltip' | translate }}"
      matTooltipPosition="above"
      aria-label="Show all actions"
      [matMenuTriggerFor]="actions"
    >
      <mat-icon>more_horiz</mat-icon>
    </button>

    <mat-menu #actions="matMenu">
      <button type="button" *ngIf="isReadOpenMode" mat-menu-item (click)="search()">
        {{ "global.refresh" | translate }}
      </button>
      <button id="favorites" mat-menu-item (click)="updateFavoriteState()">
        {{ (isFavoriteEntry ? "page.removeFromFavorites" : "page.addToFavorites") | translate }}
      </button>
    </mat-menu>
  </div>
</div>

<div class="page-wrapper">
  <div class="page-container search-page-container">
    <div class="page-content">
      <div class="grid-row">
        <div class="grid-cell--8">
          <div class="grid-cell grid-cell--container">
            <div class="grid-cell-header">
              <div class="grid-cell-title-container loading-indicator">
                <h3 class="grid-cell-title">
                  {{ getComponentName() + ".projectHeader" | translate }}
                  <div *ngIf="panelLoading" class="lds-hourglass"></div>
                </h3>
              </div>
            </div>

            <div class="grid-cell-content">
              <div class="column">
                <div class="row">
                  <div class="form-group">
                    <label class="form-label"> {{ componentData.componentId + ".familyVariant" | translate }}</label>
                    <div class="form-control">
                      <p-dropdown
                        class="aw-dropdown fixed-width"
                        placeholder="&nbsp;"
                        [showClear]="true"
                        [disabled]="isReadOpenMode"
                        [options]="familyVariants"
                        [(ngModel)]="selectedFamilyVariant"
                      ></p-dropdown>
                    </div>
                  </div>
                  <div class="form-group" [ngClass]="{ required: !isReadOpenMode }">
                    <label class="form-label">{{ getComponentName() + ".pn" | translate }}</label>
                    <div class="form-control" *ngIf="!isReadOpenMode">
                      <input type="text" class="aw-input" [(ngModel)]="bsdeProjectDTO.projectPn" />
                    </div>
                    <div class="form-control" *ngIf="isReadOpenMode">
                      <div class="form-control-generic">
                        <a (click)="openPartNumberLink()"> {{ bsdeProjectDTO.projectPn }} </a>
                      </div>
                    </div>
                    <div class="custom-padding">
                      <i>{{ partNumberDTO.description }}</i>
                    </div>
                  </div>
                  <div class="form-group" [ngClass]="{ required: !isReadOpenMode }">
                    <label class="form-label">
                      {{ componentData.componentId + ".sn" | translate }}
                    </label>

                    <div class="form-control" *ngIf="!isReadOpenMode">
                      <input type="text" class="aw-input" [(ngModel)]="bsdeProjectDTO.projectSn" />
                    </div>
                    <div class="form-control" *ngIf="isReadOpenMode">
                      <div class="form-control-generic">
                        <a (click)="openSNLink()"> {{ bsdeProjectDTO.projectSn }} </a>
                      </div>
                    </div>
                  </div>
                </div>
                <div class="row">
                  <div class="form-group">
                    <label class="form-label"> {{ componentData.componentId + ".mroCenter" | translate }}</label>
                    <div class="form-control">
                      <p-dropdown
                        class="aw-dropdown fixed-width"
                        placeholder="&nbsp;"
                        [showClear]="true"
                        [disabled]="isReadOpenMode"
                        [options]="mroCenters"
                        [(ngModel)]="bsdeProjectDTO.repairCenterCode"
                      ></p-dropdown>
                    </div>
                  </div>
                  <div class="form-group">
                    <label class="form-label"> {{ componentData.componentId + ".customer" | translate }}</label>
                    <div class="form-control">
                      <p-dropdown
                        class="aw-dropdown fixed-width"
                        placeholder="&nbsp;"
                        [showClear]="true"
                        [disabled]="isReadOpenMode"
                        [options]="customerList"
                        [(ngModel)]="bsdeProjectDTO.customerCode"
                      ></p-dropdown>
                    </div>
                  </div>
                  <div class="form-group">
                    <label class="form-label">{{ getComponentName() + ".startDate" | translate }}</label>
                    <div class="form-control">
                      <p-calendar
                        showButtonBar="true"
                        [monthNavigator]="true"
                        [yearNavigator]="true"
                        [yearRange]="sessionService.calendarYearRange"
                        class="aw-calendar"
                        [dateFormat]="sessionService.dateFormatPrimeNG"
                        [locale]="sessionService.calendarFormat"
                        [(ngModel)]="bsdeProjectDTO.projectStartDate"
                        [disabled]="isReadOpenMode"
                      ></p-calendar>
                    </div>
                  </div>
                  <div class="form-group">
                    <label class="form-label">{{ getComponentName() + ".endDate" | translate }}</label>
                    <div class="form-control">
                      <p-calendar
                        showButtonBar="true"
                        [monthNavigator]="true"
                        [yearNavigator]="true"
                        [yearRange]="sessionService.calendarYearRange"
                        class="aw-calendar"
                        [dateFormat]="sessionService.dateFormatPrimeNG"
                        [locale]="sessionService.calendarFormat"
                        [(ngModel)]="bsdeProjectDTO.projectEndDate"
                        [disabled]="isReadOpenMode"
                      ></p-calendar>
                    </div>
                  </div>
                </div>
                <div class="row">
                  <div class="form-group flex--2">
                    <label class="form-label">
                      {{ componentData.componentId + ".projectName" | translate }}
                    </label>

                    <div class="form-control">
                      <input
                        type="text"
                        class="aw-input"
                        [disabled]="isReadOpenMode"
                        [(ngModel)]="bsdeProjectDTO.projectName"
                      />
                    </div>
                  </div>
                  <div class="form-group flex--2">
                    <label class="form-label">{{ getComponentName() + ".descripton" | translate }}</label>
                    <div class="form-control">
                      <textarea
                        class="aw-textarea"
                        [rows]="1"
                        pInputTextarea
                        [disabled]="isReadOpenMode"
                        [(ngModel)]="bsdeProjectDTO.projectDescription"
                      ></textarea>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="grid-cell--4">
          <div class="grid-cell grid-cell--container">
            <div class="grid-cell-header">
              <div class="grid-cell-title-container">
                <h3 class="grid-cell-title">
                  {{ componentData.componentId + ".attributes" | translate }}
                  ({{ attributesTableDataSource ? attributesTableDataSource.dataCount : 0 }})
                </h3>
              </div>
            </div>

            <div class="grid-cell-content">
              <div class="column">
                <div class="row">
                  <a-table [dataSource]="attributesTableDataSource">
                    <ng-template tableActionsDef>
                      <button
                        *ngIf="!isReadOpenMode && attributesTableDataSource.hasDataSelection"
                        type="button"
                        mat-raised-button
                        color="warn"
                        (click)="deleteAttribute()"
                      >
                        {{ "global.delete" | translate }}
                      </button>

                      <button
                        *ngIf="!isReadOpenMode && attributesTableDataSource.dataSelectionCount === 1"
                        type="button"
                        mat-raised-button
                        (click)="editAttributeDialog()"
                      >
                        {{ "global.edit" | translate }}
                      </button>
                      <button
                        *ngIf="!isReadOpenMode && attributesTableDataSource.dataSelectionCount === 0"
                        type="button"
                        mat-raised-button
                        (click)="openAttributeDialog()"
                      >
                        {{ "global.add" | translate }}
                      </button>
                    </ng-template>
                  </a-table>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="grid-row" *ngIf="!isCreateOpenMode">
        <div class="grid-cell--4">
          <div class="grid-cell-content">
            <div class="column">
              <div class="row">
                <div class="grid-cell grid-cell--container grid-cell-scope">
                  <div class="grid-cell-header">
                    <div class="grid-cell-title-container  loading-indicator">
                      <h3 class="grid-cell-title">
                        {{ getComponentName() + ".workscopeInformation" | translate }}
                        <div *ngIf="workscopePanelLoading" class="lds-hourglass"></div>
                      </h3>
                    </div>
                  </div>

                  <div class="grid-cell-content custom-height">
                    <div class="column">
                      <div class="row">
                        <div class="form-group">
                          <label class="form-label">{{ getComponentName() + ".version" | translate }}</label>
                          <div class="form-control">
                            <input
                              type="text"
                              class="aw-input"
                              [disabled]="true"
                              [(ngModel)]="workscopeInformationObject.versionNumber"
                            />
                          </div>
                        </div>
                        <div class="form-group">
                          <label class="form-label">{{ getComponentName() + ".status" | translate }}</label>
                          <div class="form-control">
                            <input
                              type="text"
                              class="aw-input"
                              [disabled]="true"
                              [(ngModel)]="workscopeInformationObject.status"
                            />
                          </div>
                        </div>
                        <div class="form-group">
                          <label class="form-label">{{ getComponentName() + ".lastUpdate" | translate }}</label>
                          <div class="form-control">
                            <input
                              type="text"
                              class="aw-input"
                              [disabled]="true"
                              [(ngModel)]="workscopeInformationObject.lastUpdate"
                              title="{{ workscopeInformationObject.lastUpdate }}"
                            />
                            <span *ngIf="!!workscopeInformationObject.lastUpdateDate">
                              ({{ workscopeInformationObject.lastUpdateDate | date: "yyyy/MM/dd" }})
                            </span>
                          </div>
                        </div>
                      </div>
                      <div class="row">
                        <div class="form-group">
                          <label class="form-label">{{ getComponentName() + ".approvedItems" | translate }}</label>
                          <div class="form-control">
                            <input
                              type="text"
                              class="aw-input"
                              [disabled]="true"
                              [(ngModel)]="workscopeInformationObject.approveItem"
                            />
                          </div>
                        </div>
                        <div class="form-group">
                          <label class="form-label">{{ getComponentName() + ".draftItems" | translate }}</label>
                          <div class="form-control">
                            <input
                              type="text"
                              class="aw-input"
                              [disabled]="true"
                              [(ngModel)]="workscopeInformationObject.draftItem"
                            />
                          </div>
                        </div>
                        <div class="form-group">
                          <label class="form-label">{{ getComponentName() + ".removedItems" | translate }}</label>
                          <div class="form-control">
                            <input
                              type="text"
                              class="aw-input"
                              [disabled]="true"
                              [(ngModel)]="workscopeInformationObject.removeItem"
                            />
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                  <div class="row search-criteria-footer">
                    <div class="search-actions">
                      <button type="button" mat-raised-button (click)="openWorkscopeForm()">
                        {{ "global.open" | translate }}
                      </button>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="grid-cell--4">
          <div class="grid-cell grid-cell--container grid-cell-scope">
            <div class="grid-cell-header">
              <div class="grid-cell-title-container  loading-indicator">
                <h3 class="grid-cell-title">
                  {{ getComponentName() + ".progress" | translate }}
                  <div *ngIf="chartContentReady" class="lds-hourglass"></div>
                </h3>
              </div>
            </div>

            <div class="grid-cell-content custom-height">
              <div class="column">
                <div class="chart-container">
                  <div class="chart-wrapper">
                    <p-chart
                      [type]="chartType"
                      [data]="chartData"
                      [options]="chartOptions"
                      height="100%"
                      width="100%"
                    ></p-chart>
                  </div>

                  <div class="chart-legend">
                    <div class="chart-legend-label">
                      <div class="chart-legend-label-color completed"></div>
                      {{ chartData.labels[0] }}
                      <span class="chart-value">{{ progressChart.completed }} </span>
                    </div>

                    <div class="chart-legend-label">
                      <div class="chart-legend-label-color not-completed"></div>
                      {{ chartData.labels[1] }}
                      <span class="chart-value">{{ progressChart.notCompleted }} </span>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <div class="row search-criteria-footer">
              <div class="search-actions">
                <button type="button" mat-raised-button (click)="openInspectionForm()">
                  {{ "global.open" | translate }}
                </button>
              </div>
            </div>
          </div>
        </div>

        <div class="grid-cell--4">
          <div class="grid-cell grid-cell--container">
            <div class="grid-cell-header">
              <div class="grid-cell-title-container  loading-indicator">
                <h3 class="grid-cell-title">
                  {{ getComponentName() + ".configureProgress" | translate }}
                  <div *ngIf="chartContentReady" class="lds-hourglass"></div>
                </h3>
              </div>
            </div>
            <!-- TODO:Replace the chart binding if API is completed for Outgoing configuration Progress-->
            <div class="grid-cell-content custom-height">
              <div class="column">
                <div class="chart-container">
                  <div class="chart-wrapper">
                    <p-chart
                      [type]="chartType"
                      [data]="chartData"
                      [options]="chartOptions"
                      height="100%"
                      width="100%"
                    ></p-chart>
                  </div>

                  <div class="chart-legend">
                    <div class="chart-legend-label">
                      <div class="chart-legend-label-color completed"></div>
                      {{ chartData.labels[0] }}
                      <span class="chart-value">{{ progressChart.completed }} </span>
                    </div>

                    <div class="chart-legend-label">
                      <div class="chart-legend-label-color not-completed"></div>
                      {{ chartData.labels[1] }}
                      <span class="chart-value">{{ progressChart.notCompleted }} </span>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <div class="row search-criteria-footer">
              <div class="search-actions">
                <button type="button" mat-raised-button (click)="openInspectionForm()">
                  {{ "global.open" | translate }}
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<aw-dialog-attribute
  *ngIf="displayAttributeDialog"
  [(display)]="displayAttributeDialog"
  [attributeList]="attributeList"
  [attribute]="attributesTableDataSource.dataSelection[0]"
  [isEditMode]="isEditMode"
  (addEditAttribute)="addEditAttribute($event)"
></aw-dialog-attribute>

<aw-dialog-item-selection
  *ngIf="showItemSelectionDialog"
  [(display)]="showItemSelectionDialog"
  [pn]="bsdeProjectDTO.projectPn"
  [bireItemDTOList]="bireItemDTOList"
  (addBireItem)="addBireItem($event)"
></aw-dialog-item-selection>
