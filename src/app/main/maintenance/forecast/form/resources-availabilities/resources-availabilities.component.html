<a-modal class="aw-modal" [(visible)]="display" [width]="50">
  <a-header>
    <div class="modal-title">{{ getComponentName() + ".title" | translate }}</div>
  </a-header>

  <a-content>
    <p-table
      [resizableColumns]="true"
      #ptableAssets
      class="aw-table2"
      [columns]="resourcesTableColList"
      [value]="resourcesTable"
      [(selection)]="resourcesTableSelection"
      [scrollable]="true"
    >
      <ng-template pTemplate="caption">
        <div class="aw-table-header" [ngClass]="{ 'rows-selected': resourcesTableSelection.length > 0 }">
          <div class="aw-table-global-filter">
            <label class="aw-table-global-filter-label">
              <i class="fa fa-fw fa-search" aria-hidden="true"></i>
            </label>

            <input
              class="aw-table-global-filter-input"
              type="text"
              placeholder="{{ 'table.globalFilterText' | translate }}"
              (input)="ptableAssets.filterGlobal($event.target.value, 'contains')"
            />
          </div>

          <div class="aw-table-actions">
            <button
              type="button"
              mat-raised-button
              (click)="synchronizeData()"
              title="{{ getComponentName() + '.synchronizeDataTooltip' | translate }}"
            >
              {{ getComponentName() + ".synchronizeData" | translate }}
            </button>
            <button
              type="button"
              *ngIf="resourcesTableSelection.length > 0"
              mat-raised-button
              color="warn"
              (click)="deleteSelectedRows()"
            >
              {{ "global.delete" | translate }}
            </button>
            <button
              type="button"
              *ngIf="resourcesTableSelection.length === 0"
              mat-raised-button
              (click)="addAvailabilities()"
            >
              {{ "global.add" | translate }}
            </button>
          </div>
        </div>
      </ng-template>

      <ng-template pTemplate="colgroup" let-columns>
        <colgroup>
          <col class="aw-table-checkbox-wrapper" />
          <col *ngFor="let col of columns" [ngStyle]="{ width: col.width }" />
        </colgroup>
      </ng-template>

      <ng-template pTemplate="header" let-columns>
        <tr>
          <th class="aw-table-checkbox-wrapper">
            <p-tableHeaderCheckbox class="aw-table-checkbox"></p-tableHeaderCheckbox>
          </th>
          <th pResizableColumn *ngFor="let col of columns" [ngStyle]="{ 'text-align': col.alignment }">
            <span *ngIf="col.field !== 'number'">
              {{ getComponentName() + "." + col.field | translate }}
            </span>
            <span *ngIf="col.field === 'number'">
              #
            </span>
          </th>
        </tr>
      </ng-template>

      <ng-template pTemplate="body" let-rowData let-columns="columns" let-rowIndex="rowIndex">
        <tr [pSelectableRow]="rowData" [pSelectableRowIndex]="rowIndex">
          <td class="aw-table-checkbox-wrapper">
            <p-tableCheckbox class="aw-table-checkbox" [value]="rowData"></p-tableCheckbox>
          </td>
          <td
            *ngFor="let col of columns"
            pEditableColumn
            [ngSwitch]="col.field"
            [ngStyle]="{ 'text-align': col.alignment }"
          >
            <span *ngSwitchCase="'availabilityStartDate'">
              <p-cellEditor>
                <ng-template pTemplate="input">
                  <p-calendar
                    showButtonBar="true"
                    [monthNavigator]="true"
                    [yearNavigator]="true"
                    [yearRange]="sessionService.calendarYearRange"
                    class="aw-calendar"
                    [dateFormat]="sessionService.dateFormatPrimeNG"
                    [locale]="sessionService.calendarFormat"
                    [(ngModel)]="rowData[col.field]"
                    appendTo="body"
                  ></p-calendar>
                </ng-template>
                <ng-template pTemplate="output">
                  <p-calendar
                    showButtonBar="true"
                    [monthNavigator]="true"
                    [yearNavigator]="true"
                    [yearRange]="sessionService.calendarYearRange"
                    class="aw-calendar"
                    [dateFormat]="sessionService.dateFormatPrimeNG"
                    [locale]="sessionService.calendarFormat"
                    [(ngModel)]="rowData[col.field]"
                    appendTo="body"
                    disabled
                  ></p-calendar>
                </ng-template>
              </p-cellEditor>
            </span>
            <span *ngSwitchCase="'availabilityEndDate'">
              <p-cellEditor>
                <ng-template pTemplate="input">
                  <p-calendar
                    showButtonBar="true"
                    [monthNavigator]="true"
                    [yearNavigator]="true"
                    [yearRange]="sessionService.calendarYearRange"
                    class="aw-calendar"
                    [dateFormat]="sessionService.dateFormatPrimeNG"
                    [locale]="sessionService.calendarFormat"
                    [(ngModel)]="rowData[col.field]"
                    appendTo="body"
                    disabled
                  ></p-calendar>
                </ng-template>
                <ng-template pTemplate="output">
                  <p-calendar
                    showButtonBar="true"
                    [monthNavigator]="true"
                    [yearNavigator]="true"
                    [yearRange]="sessionService.calendarYearRange"
                    class="aw-calendar"
                    [dateFormat]="sessionService.dateFormatPrimeNG"
                    [locale]="sessionService.calendarFormat"
                    [(ngModel)]="rowData[col.field]"
                    appendTo="body"
                    disabled
                  ></p-calendar>
                </ng-template>
              </p-cellEditor>
            </span>
            <span *ngSwitchCase="'availabilityCode'">
              <p-cellEditor>
                <ng-template pTemplate="input">
                  <p-dropdown
                    class="aw-dropdown fixed-width"
                    [options]="qualificationList"
                    [(ngModel)]="rowData[col.field]"
                    placeholder="&nbsp;"
                    [style]="{ width: '100%' }"
                    appendTo="body"
                  ></p-dropdown>
                </ng-template>
                <ng-template pTemplate="output">
                  <p-dropdown
                    class="aw-dropdown fixed-width"
                    [options]="qualificationList"
                    [(ngModel)]="rowData[col.field]"
                    [disabled]="true"
                    placeholder="&nbsp;"
                  ></p-dropdown>
                </ng-template>
              </p-cellEditor>
            </span>
            <span *ngSwitchCase="'availabilityPerWeek'">
              <p-cellEditor>
                <ng-template pTemplate="input">
                  <input pInputText type="text" [(ngModel)]="rowData[col.field]" required />
                </ng-template>
                <ng-template pTemplate="output">
                  {{ rowData[col.field] }}
                </ng-template>
              </p-cellEditor>
            </span>
            <span *ngSwitchCase="'availabilityPerWeekEnd'">
              <p-cellEditor>
                <ng-template pTemplate="input">
                  <input pInputText type="text" [(ngModel)]="rowData[col.field]" required />
                </ng-template>
                <ng-template pTemplate="output">
                  {{ rowData[col.field] }}
                </ng-template>
              </p-cellEditor>
            </span>
            <span *ngSwitchDefault> {{ rowData[col.field] }} </span>
          </td>
        </tr>
      </ng-template>
    </p-table>
  </a-content>

  <a-footer>
    <button type="button" mat-raised-button (click)="closeDialog()">
      {{ "cancel" | translate }}
    </button>

    <button type="button" class="btn-with-spinner" color="primary" mat-raised-button (click)="validate()">
      <span class="lds-hourglass" *ngIf="saveSpinner"></span>
      {{ "validate" | translate }}
    </button>
  </a-footer>
</a-modal>
