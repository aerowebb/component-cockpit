<div class="page-header">
  <div class="page-info">
    <div>
      <div class="page-title">
        {{ "transaction." + componentData.componentId | translate }}
      </div>

      <div class="page-subtitle">
        <div class="page-subtitle">- {{ componentContext }}</div>
      </div>
    </div>
  </div>

  <div class="page-actions">
    <button
      *ngIf="workPackageMovementsUpdated"
      type="button"
      mat-raised-button
      (click)="cancelAllWorkPackageMovement()"
    >
      {{ getComponentName() + ".cancel" | translate }}
    </button>

    <button
      *ngIf="!workPackageMovementsUpdated"
      type="button"
      mat-raised-button
      (click)="confirmAllWorkPackageMovement()"
    >
      {{ getComponentName() + ".confirm" | translate }}
    </button>

    <button
      mat-icon-button
      class="mat-elevation-z1"
      matTooltip="{{ 'global.showAllActionTooltip' | translate }}"
      matTooltipPosition="above"
      aria-label="Show all actions"
      [matMenuTriggerFor]="actions"
    >
      <mat-icon>more_horiz</mat-icon>
    </button>
    <mat-menu #actions="matMenu">
      <button mat-menu-item [matMenuTriggerFor]="navigations">
        {{ "global.goTo" | translate }}
      </button>

      <button mat-menu-item (click)="onReload()">{{ "global.refresh" | translate }}</button>
      <button mat-menu-item (click)="updateFavoriteState()">
        {{ (isFavoriteEntry ? "page.removeFromFavorites" : "page.addToFavorites") | translate }}
      </button>
    </mat-menu>
    <mat-menu #navigations="matMenu">
      <button *ngIf="!isCreateOpenMode" type="button" mat-menu-item (click)="navigationLinkList[0].command()">
        {{ navigationLinkList[0].label | translate }}
      </button>
      <button
        *ngIf="!isCreateOpenMode && !isGroundEquipment"
        type="button"
        mat-menu-item
        (click)="navigationLinkList[1].command()"
      >
        {{ navigationLinkList[1].label | translate }}
      </button>
      <button
        *ngIf="!isCreateOpenMode && !isGroundEquipment"
        type="button"
        mat-menu-item
        (click)="navigationLinkList[2].command()"
      >
        {{ navigationLinkList[2].label | translate }}
      </button>
      <button
        *ngIf="!isCreateOpenMode && !isGroundEquipment"
        type="button"
        mat-menu-item
        (click)="navigationLinkList[3].command()"
      >
        {{ navigationLinkList[3].label | translate }}
      </button>
    </mat-menu>
  </div>
</div>

<div class="page-wrapper">
  <div class="page-container">
    <div class="page-content">
      <div class="grid-row">
        <div class="grid-cell--6">
          <div class="grid-cell grid-cell--container grid-cell-scope">
            <aw-configuration-control-asset-view-scope
              [alert]="globalStatus"
              [asset]="asset"
              [isGroundEquipment]="isGroundEquipment"
              [isAssetAircraft]="isTopAssetAircraft"
              [isAssetEngine]="isTopAssetEngine"
              [isAssetEquipment]="isTopAssetEquipment"
            ></aw-configuration-control-asset-view-scope>
          </div>
        </div>

        <div class="grid-cell--6">
          <div class="grid-cell grid-cell--container grid-cell-summary">
            <div class="grid-cell-header">
              <div class="grid-cell-title-container loading-indicator">
                <div class="grid-cell-title">
                  <span>{{ getComponentName() + ".summary" | translate }}</span>
                  <div *ngIf="assetStructureLoading" class="lds-hourglass"></div>
                </div>
              </div>
            </div>

            <div class="grid-cell-content grid-cell-content-with-section">
              <div class="section">
                <div class="section-content">
                  <div class="table-summary-wrapper" [ngClass]="{ 'visibility--hidden': assetStructureLoading }">
                    <p-table
                      [resizableColumns]="true"
                      class="aw-table-control-summary"
                      [columns]="summaryTableColList"
                      [value]="summaryTable"
                    >
                      <ng-template pTemplate="colgroup" let-columns>
                        <colgroup>
                          <col *ngFor="let col of columns" [ngStyle]="{ width: col.width }" />
                        </colgroup>
                      </ng-template>

                      <ng-template pTemplate="header" let-columns>
                        <tr>
                          <th
                            pResizableColumn
                            *ngFor="let col of columns"
                            [ngSwitch]="col.field"
                            [ngStyle]="{ 'text-align': col.alignment }"
                          >
                            <span *ngSwitchCase="'category'"> </span>

                            <span *ngSwitchDefault> {{ getComponentName() + "." + col.field | translate }} </span>
                          </th>
                        </tr>
                      </ng-template>

                      <ng-template pTemplate="body" let-columns="columns" let-rowData>
                        <tr>
                          <td
                            *ngFor="let col of columns"
                            [ngSwitch]="col.field"
                            [ngStyle]="{ 'text-align': col.alignment }"
                          >
                            <span *ngSwitchCase="'nok'" class="control-result" [ngClass]="{ nok: rowData['nok'] > 0 }">
                              {{ rowData[col.field] }}
                            </span>

                            <span
                              *ngSwitchCase="'warning'"
                              class="control-result"
                              [ngClass]="{ warning: rowData['nok'] == 0 && rowData['warning'] > 0 }"
                            >
                              {{ rowData[col.field] }}
                            </span>

                            <span
                              *ngSwitchCase="'ok'"
                              class="control-result"
                              [ngClass]="{ ok: rowData['nok'] == 0 && rowData['warning'] == 0 && rowData['ok'] >= 0 }"
                            >
                              {{ rowData[col.field] }}
                            </span>

                            <span *ngSwitchCase="'category'">
                              {{ getComponentName() + "." + rowData[col.field] | translate }}
                            </span>
                          </td>
                        </tr>
                      </ng-template>
                    </p-table>
                  </div>
                </div>
              </div>

              <div
                *ngIf="workPackageMovementsVisible"
                class="section"
                [ngClass]="{ 'visibility--hidden': assetStructureLoading }"
              >
                <h4 class="section-title">
                  {{ getComponentName() + ".workPackageMovements" | translate }}
                </h4>

                <div class="section-content">
                  <div class="row">
                    <div class="form-group">
                      <label class="form-label"> {{ getComponentName() + ".confirmedRemovals" | translate }} </label>

                      <div class="form-control">
                        <div class="form-control-generic">
                          <span *ngIf="workPackageRemovals === workPackageConfirmedRemovals" class="alert alert--ok">
                            {{ workPackageConfirmedRemovals }} / {{ workPackageRemovals }}
                          </span>

                          <span
                            *ngIf="workPackageRemovals !== workPackageConfirmedRemovals"
                            class="alert alert--warning"
                          >
                            {{ workPackageConfirmedRemovals }} / {{ workPackageRemovals }}
                          </span>
                        </div>
                      </div>
                    </div>

                    <div class="form-group">
                      <label class="form-label">
                        {{ getComponentName() + ".confirmedInstallations" | translate }}
                      </label>

                      <div class="form-control">
                        <div class="form-control-generic">
                          <span
                            *ngIf="workPackageInstallations === workPackageConfirmedInstallations"
                            class="alert alert--ok"
                          >
                            {{ workPackageConfirmedInstallations }} / {{ workPackageInstallations }}
                          </span>

                          <span
                            *ngIf="workPackageInstallations !== workPackageConfirmedInstallations"
                            class="alert alert--warning"
                          >
                            {{ workPackageConfirmedInstallations }} / {{ workPackageInstallations }}
                          </span>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="grid-row">
        <div #configurationControlAnchor class="grid-cell--12">
          <div class="grid-cell grid-cell--container grid-cell-configuration-control">
            <div class="grid-cell-header">
              <div class="grid-cell-title-container loading-indicator">
                <div class="grid-cell-title">
                  <a class="header-link" (click)="scrollToAnchor(configurationControlEltRef)">
                    <i class="material-icons">link</i>
                  </a>
                  {{ getComponentName() + ".configurationControl" | translate }}
                  <div *ngIf="assetStructureLoading" class="lds-hourglass"></div>
                </div>
              </div>
            </div>

            <div class="grid-cell-content">
              <div *ngIf="!assetStructureLoading" class="column">
                <div class="list-with-details">
                  <div class="list">
                    <p-treeTable
                      #ptable
                      class="aw-tree-table2"
                      [value]="assetStructure"
                      selectionMode="single"
                      [(selection)]="assetStructureSelection"
                      [scrollable]="true"
                      (onNodeSelect)="selectAssetStructureNode()"
                      (onNodeUnselect)="selectAssetStructureNode()"
                      [resizableColumns]="true"
                    >
                      <ng-template pTemplate="emptymessage">
                        <span *ngIf="!maintenancePlanTableLoading"> &nbsp;</span>

                        <div *ngIf="maintenancePlanTableLoading" class="aw-table-loading-indicator">
                          <div class="loading-message">{{ "table.loadingData" | translate }}</div>
                          <div class="lds-hourglass"></div>
                        </div>
                      </ng-template>

                      <ng-template pTemplate="caption">
                        <div class="aw-table-header">
                          <div class="aw-table-global-filter">
                            <label class="aw-table-global-filter-label">
                              <i class="fa fa-fw fa-search" aria-hidden="true"></i>
                            </label>

                            <input
                              class="aw-table-global-filter-input"
                              type="text"
                              placeholder="{{ 'table.globalFilterText' | translate }}"
                              [(ngModel)]="searchAssetStructureGlobalFilter"
                              (keyup)="filterAssetStructureWithGlobalFilter(searchAssetStructureGlobalFilter)"
                            />
                          </div>

                          <div class="aw-table-icon-actions">
                            <i
                              class="fa fa-fw fa-long-arrow-right aw-icon aw-icon-with-border"
                              [ngClass]="{ active: assetStructureFilterRemovalVisible }"
                              aria-hidden="true"
                              pTooltip="{{ getComponentName() + '.showRemoval' | translate }}"
                              tooltipPosition="top"
                              (click)="showRemovals()"
                              *ngIf="workPackageCode"
                            ></i>

                            <i
                              class="fa fa-fw fa-long-arrow-left aw-icon aw-icon-with-border"
                              [ngClass]="{ active: assetStructureFilterInstallationVisible }"
                              aria-hidden="true"
                              pTooltip="{{ getComponentName() + '.showInstallation' | translate }}"
                              tooltipPosition="top"
                              (click)="showInstallations()"
                              *ngIf="workPackageCode"
                            ></i>

                            <i
                              class="fa fa-fw fa-filter aw-icon aw-icon-with-border aw-icon-with-overlay"
                              aria-hidden="true"
                              pTooltip="{{
                                getComponentName() + (assetStructureFiltersVisible ? '.hideFilters' : '.showFilters')
                                  | translate
                              }}"
                              tooltipPosition="top"
                              [ngClass]="{ active: assetStructureFiltersVisible }"
                              (click)="opFilters.toggle($event)"
                            ></i>
                            <i
                              class="fa fa-fw fa-question aw-icon aw-icon-with-border aw-icon-with-overlay"
                              aria-hidden="true"
                              (click)="openHelpDialog()"
                              pTooltip="{{ 'leftsidebar.help' | translate }}"
                              tooltipPosition="bottom"
                            ></i>
                          </div>
                        </div>
                      </ng-template>

                      <ng-template pTemplate="colgroup">
                        <colgroup>
                          <col style="width: 20%" />
                          <col style="width: 80%" />
                        </colgroup>
                      </ng-template>

                      <ng-template pTemplate="header">
                        <tr>
                          <th ttResizableColumn style="text-align: center">
                            {{ getComponentName() + ".control" | translate }}
                          </th>

                          <th ttResizableColumn style="text-align: left">
                            {{ getComponentName() + ".designation" | translate }}
                          </th>
                        </tr>
                      </ng-template>

                      <ng-template pTemplate="body" let-rowNode let-rowData="rowData">
                        <tr [ttSelectableRow]="rowNode">
                          <td style="text-align: center">
                            <span
                              *ngIf="rowData.checkGlobalResult === controlConfigConstants.ICON_GREEN"
                              class="alert alert--ok"
                            >
                              {{ getComponentName() + ".ok" | translate }}
                            </span>
                            <span
                              *ngIf="rowData.checkGlobalResult === controlConfigConstants.ICON_RED"
                              class="alert alert--nok"
                            >
                              {{ getComponentName() + ".nok" | translate }}
                            </span>
                            <span
                              *ngIf="rowData.checkGlobalResult === controlConfigConstants.ICON_YELLOW"
                              class="alert alert--warning"
                            >
                              {{ getComponentName() + ".warning" | translate }}
                            </span>
                          </td>

                          <td style="text-align: left">
                            <div class="display--flex-row flex-row--align-start">
                              <p-treeTableToggler [rowNode]="rowNode"></p-treeTableToggler>

                              <div>
                                <ng-container *ngIf="rowData.bidoEquipment">
                                  <div>
                                    <i class="fa fa-fw" aria-hidden="true" style="visibility: hidden"></i>
                                    <span class="node">{{ rowData.structure }}</span>
                                  </div>

                                  <ng-container *ngIf="rowData.installedStockMvtData && rowData.removedStockMvtData">
                                    <div
                                      *ngIf="rowData.asset"
                                      [ngClass]="{
                                        'issue-asset': !rowData.installedStockMvtData.bidoNotificationNotificationCode,
                                        'issue-asset-validated':
                                          rowData.installedStockMvtData.bidoNotificationNotificationCode
                                      }"
                                    >
                                      <i class="fa fa-fw" aria-hidden="true" style="visibility: hidden"></i>
                                      <i class="fa fa-fw fa-long-arrow-left" aria-hidden="true"></i>
                                      <ng-container
                                        *ngTemplateOutlet="equipmentlink; context: { equipment: rowData.bidoEquipment }"
                                      ></ng-container>
                                    </div>

                                    <div
                                      *ngIf="rowData.replacedAsset"
                                      [ngClass]="{
                                        'receipt-asset': !rowData.removedStockMvtData.bidoNotificationNotificationCode,
                                        'receipt-asset-validated':
                                          rowData.removedStockMvtData.bidoNotificationNotificationCode
                                      }"
                                    >
                                      <i class="fa fa-fw" aria-hidden="true" style="visibility: hidden"></i>
                                      <i class="fa fa-fw fa-long-arrow-right" aria-hidden="true"></i>
                                      <ng-container
                                        *ngTemplateOutlet="
                                          equipmentlink;
                                          context: { equipment: rowData.replacedBidoEquipment }
                                        "
                                      ></ng-container>
                                    </div>
                                  </ng-container>

                                  <ng-container *ngIf="rowData.installedStockMvtData && !rowData.removedStockMvtData">
                                    <div
                                      *ngIf="rowData.asset"
                                      [ngClass]="{
                                        'issue-asset': !rowData.installedStockMvtData.bidoNotificationNotificationCode,
                                        'issue-asset-validated':
                                          rowData.installedStockMvtData.bidoNotificationNotificationCode
                                      }"
                                    >
                                      <i class="fa fa-fw" aria-hidden="true" style="visibility: hidden"></i>
                                      <i class="fa fa-fw fa-long-arrow-left" aria-hidden="true"></i>
                                      <ng-container
                                        *ngTemplateOutlet="equipmentlink; context: { equipment: rowData.bidoEquipment }"
                                      ></ng-container>
                                    </div>
                                  </ng-container>

                                  <ng-container *ngIf="!rowData.installedStockMvtData && rowData.removedStockMvtData">
                                    <div
                                      *ngIf="rowData.asset || rowData.replacedAsset"
                                      [ngClass]="{
                                        'receipt-asset': !rowData.removedStockMvtData.bidoNotificationNotificationCode,
                                        'receipt-asset-validated':
                                          rowData.removedStockMvtData.bidoNotificationNotificationCode
                                      }"
                                    >
                                      <i class="fa fa-fw" aria-hidden="true" style="visibility: hidden"></i>
                                      <i class="fa fa-fw fa-long-arrow-right" aria-hidden="true"></i>
                                      <ng-container
                                        *ngTemplateOutlet="
                                          equipmentlink;
                                          context: { equipment: rowData.bidoEquipment || rowData.replacedBidoEquipment }
                                        "
                                      ></ng-container>
                                    </div>
                                  </ng-container>

                                  <ng-container *ngIf="!rowData.installedStockMvtData && !rowData.removedStockMvtData">
                                    <div *ngIf="rowData.asset">
                                      <i class="fa fa-fw" aria-hidden="true" style="visibility: hidden"></i>
                                      <ng-container
                                        *ngTemplateOutlet="equipmentlink; context: { equipment: rowData.bidoEquipment }"
                                      ></ng-container>
                                    </div>
                                  </ng-container>
                                </ng-container>

                                <ng-container *ngIf="rowData.bidoFl">
                                  <i
                                    *ngIf="isFlAircraft(rowData.bidoFl)"
                                    class="fa fa-fw fa-plane"
                                    aria-hidden="true"
                                  ></i>
                                  <i *ngIf="isFlEngine(rowData.bidoFl)" class="fa fa-fw fa-cog" aria-hidden="true"></i>
                                  <i
                                    *ngIf="!isFlAircraft(rowData.bidoFl) && !isFlEngine(rowData.bidoFl)"
                                    class="fa fa-fw fa-cogs"
                                    aria-hidden="true"
                                  ></i>
                                  <span class="node fl-node">{{ rowData.structure }}</span>
                                  <span *ngIf="rowData.bidoEquipment" class="asset">
                                    <ng-container
                                      *ngTemplateOutlet="equipmentlink; context: { equipment: rowData.bidoEquipment }"
                                    ></ng-container>
                                  </span>
                                </ng-container>

                                <ng-container *ngIf="rowData.bireItem">
                                  <i
                                    *ngIf="isItemAircraft(rowData.bireItem)"
                                    class="fa fa-fw fa-plane"
                                    aria-hidden="true"
                                  ></i>
                                  <i
                                    *ngIf="isItemEngine(rowData.bireItem)"
                                    class="fa fa-fw fa-cog"
                                    aria-hidden="true"
                                  ></i>
                                  <i
                                    *ngIf="!isItemAircraft(rowData.bireItem) && !isItemEngine(rowData.bireItem)"
                                    class="fa fa-fw fa-cogs"
                                    aria-hidden="true"
                                  ></i>
                                  <span class="node item-node">
                                    <span class="chapter">{{ rowData.bireItem.chapter }}</span>
                                    -
                                    <span class="section">{{ rowData.bireItem.section }}</span>
                                    -
                                    <span class="subject">{{ rowData.bireItem.subject }}</span>
                                    -
                                    <span class="sheet">{{ rowData.bireItem.sheet }}</span>
                                    -
                                    <span class="marks">{{ rowData.bireItem.marks }}</span>
                                  </span>
                                  <div class="node asset">{{ rowData.bireItem.name }}</div>

                                  <div *ngIf="!rowData.uniqueBidoEquipmentChild" class="node asset">
                                    <span
                                      [ngClass]="{
                                        alert: true,
                                        'alert--mandatory': rowData.itemMandatory,
                                        'alert--not-mandatory': !rowData.itemMandatory
                                      }"
                                    >
                                      <span *ngIf="rowData.equipmentAssetCount == 0">{{
                                        getComponentName() + ".empty" | translate
                                      }}</span>
                                      <span *ngIf="rowData.equipmentAssetCount > 1">{{
                                        getComponentName() + ".several" | translate
                                      }}</span>
                                    </span>
                                  </div>

                                  <div *ngIf="rowData.uniqueBidoEquipmentChild" class="asset">
                                    <ng-container
                                      *ngTemplateOutlet="
                                        equipmentlink;
                                        context: { equipment: rowData.uniqueBidoEquipmentChild }
                                      "
                                    ></ng-container>
                                  </div>
                                </ng-container>

                                <ng-container *ngIf="rowData.functionCode">
                                  <span class="node function-code-node">{{ rowData.structure }}</span>
                                  <span class="node asset">{{ rowData.asset }}</span>
                                </ng-container>
                              </div>
                            </div>
                          </td>
                        </tr>
                      </ng-template>
                    </p-treeTable>
                  </div>

                  <div class="details">
                    <div
                      class="column"
                      [ngClass]="{
                        'visibility--hidden': assetStructureLoading || !assetStructureSelection
                      }"
                    >
                      <div class="section">
                        <div class="section-content">
                          <div class="row configuration-control-node-action-list">
                            <button
                              *ngIf="
                                asset &&
                                assetStructureSelection &&
                                assetStructureSelection.data &&
                                assetStructureSelection.data.bidoEquipment &&
                                asset.equipmentCode === assetStructureSelection.data.bidoEquipment.equipmentCode
                              "
                              type="button"
                              mat-raised-button
                              (click)="openFunctionalLocationAssignment(asset)"
                            >
                              {{ "assignFunctionalLocation" | translate }}
                            </button>

                            <button
                              *ngIf="
                                workPackageCode &&
                                assetStructureSelection &&
                                assetStructureSelection.data &&
                                assetStructureSelection.data.bidoEquipment &&
                                assetStructureSelection.data.bidoEquipment.equipmentFunction !==
                                  awPropertiesConstants.FAMILY_FUNCTION_AIRCRAFT_KEY
                              "
                              type="button"
                              mat-raised-button
                              class="btn-with-spinner"
                              (click)="generateFormFAA8130(assetStructureSelection.data.bidoEquipment)"
                              [disabled]="showLoaderGenerateFormFAA8130"
                            >
                              <span class="lds-hourglass" *ngIf="showLoaderGenerateFormFAA8130"></span>
                              {{ "formFAA8130" | translate }}
                            </button>

                            <button
                              *ngIf="
                                workPackageCode &&
                                assetStructureSelection &&
                                assetStructureSelection.data &&
                                assetStructureSelection.data.bidoEquipment &&
                                assetStructureSelection.data.bidoEquipment.equipmentFunction !==
                                  awPropertiesConstants.FAMILY_FUNCTION_AIRCRAFT_KEY
                              "
                              type="button"
                              class="btn-with-spinner"
                              mat-raised-button
                              (click)="generateFormEASA1(assetStructureSelection.data.bidoEquipment)"
                              [disabled]="showLoaderGenerateFormEASA1"
                            >
                              <span class="lds-hourglass" *ngIf="showLoaderGenerateFormEASA1"></span>
                              {{ "formEASA1" | translate }}
                            </button>

                            <button
                              *ngIf="
                                assetStructureSelection &&
                                assetStructureSelection.data &&
                                assetStructureSelection.data.bidoEquipment &&
                                assetStructureSelection.data.bidoEquipment.equipmentFunction !==
                                  awPropertiesConstants.FAMILY_FUNCTION_AIRCRAFT_KEY &&
                                !assetStructureSelection.data.installedStockMvtData &&
                                !assetStructureSelection.data.removedStockMvtData
                              "
                              type="button"
                              mat-raised-button
                              (click)="removeEquipment()"
                            >
                              {{ getComponentName() + ".remove" | translate }}
                            </button>

                            <button
                              *ngIf="
                                assetStructureSelection &&
                                assetStructureSelection.data &&
                                assetStructureSelection.data.bidoEquipment &&
                                !assetStructureSelection.data.installedStockMvtData &&
                                !assetStructureSelection.data.removedStockMvtData
                              "
                              type="button"
                              mat-raised-button
                              (click)="installEquipment()"
                            >
                              {{ getComponentName() + ".install" | translate }}
                            </button>

                            <p-splitButton
                              *ngIf="
                                assetStructureSelection &&
                                assetStructureSelection.data &&
                                assetStructureSelection.data.bireItem &&
                                assetStructureSelection.data.uniqueBidoEquipmentChild &&
                                assetStructureSelection.data.uniqueBidoEquipmentChild.equipmentFunction !==
                                  awPropertiesConstants.FAMILY_FUNCTION_AIRCRAFT_KEY
                              "
                              class="aw-split-btn aw-table-action"
                              appendTo="body"
                              label="{{ getComponentName() + '.removeByWo' | translate }}"
                              (onClick)="removeEquipmentFromWP()"
                              [model]="removeItems"
                            ></p-splitButton>

                            <p-splitButton
                              *ngIf="
                                assetStructureSelection &&
                                assetStructureSelection.data &&
                                assetStructureSelection.data.bireItem &&
                                !assetStructureSelection.data.installedStockMvtData &&
                                !assetStructureSelection.data.removedStockMvtData
                              "
                              class="aw-split-btn aw-table-action"
                              appendTo="body"
                              label="{{ getComponentName() + '.installByWo' | translate }}"
                              (onClick)="installEquipmentFromWP()"
                              [model]="installItems"
                            ></p-splitButton>

                            <button
                              *ngIf="
                                assetStructureSelection &&
                                assetStructureSelection.data &&
                                assetStructureSelection.data.bidoFl
                              "
                              type="button"
                              mat-raised-button
                              (click)="openFl()"
                            >
                              {{ getComponentName() + ".open" | translate }}
                            </button>
                          </div>
                        </div>
                      </div>

                      <div class="section">
                        <div class="grid-cell-content">
                          <div class="column">
                            <div class="row">
                              <div class="form-group" *ngIf="assetStructureSelection.data.bireItem">
                                <label class="form-label"> {{ getComponentName() + ".item" | translate }} </label>

                                <div class="form-control">
                                  <input
                                    type="text"
                                    class="aw-input"
                                    value="{{ getItemKey(assetStructureSelection.data.bireItem) }}"
                                    [disabled]="true"
                                  />
                                  <div class="asset">
                                    <i>{{ assetStructureSelection.data.bireItem.name }}</i>
                                  </div>
                                </div>
                              </div>
                              <div
                                class="form-group"
                                *ngIf="
                                  !assetStructureSelection.data.bireItem &&
                                  ((assetStructureSelection.data.bidoEquipment &&
                                    assetStructureSelection.data.bidoEquipment.equipmentDesignation) ||
                                    (assetStructureSelection.data.uniqueBidoEquipmentChild &&
                                      assetStructureSelection.data.uniqueBidoEquipmentChild.equipmentDesignation))
                                "
                              >
                                <label class="form-label">
                                  {{ getComponentName() + ".designation" | translate }}
                                </label>

                                <div class="form-control">
                                  <input
                                    *ngIf="assetStructureSelection.data.bidoEquipment"
                                    type="text"
                                    class="aw-input"
                                    [(ngModel)]="assetStructureSelection.data.bidoEquipment.equipmentDesignation"
                                    [disabled]="true"
                                  />
                                  <input
                                    *ngIf="assetStructureSelection.data.uniqueBidoEquipmentChild"
                                    type="text"
                                    class="aw-input"
                                    [(ngModel)]="
                                      assetStructureSelection.data.uniqueBidoEquipmentChild.equipmentDesignation
                                    "
                                    [disabled]="true"
                                  />
                                </div>
                              </div>
                              <div class="form-group" *ngIf="assetStructureSelection.data.bidoFl">
                                <label class="form-label">
                                  {{ getComponentName() + ".functionLocation" | translate }}
                                </label>

                                <div class="form-control">
                                  <input
                                    type="text"
                                    class="aw-input"
                                    [(ngModel)]="assetStructureSelection.data.structure"
                                    [disabled]="true"
                                  />
                                </div>
                              </div>
                              <div
                                class="form-group"
                                *ngIf="
                                  (assetStructureSelection.data.bidoEquipment &&
                                    !isAssetEngine(assetStructureSelection.data.bidoEquipment) &&
                                    assetStructureSelection.data.bidoEquipment.pnCode) ||
                                  (assetStructureSelection.data.uniqueBidoEquipmentChild &&
                                    !isAssetEngine(assetStructureSelection.data.uniqueBidoEquipmentChild) &&
                                    assetStructureSelection.data.uniqueBidoEquipmentChild.pnCode)
                                "
                              >
                                <label class="form-label">P/N</label>
                                <div class="form-control">
                                  <input
                                    *ngIf="assetStructureSelection.data.bidoEquipment"
                                    type="text"
                                    class="aw-input"
                                    [(ngModel)]="assetStructureSelection.data.bidoEquipment.pnCode"
                                    [disabled]="true"
                                  />
                                  <input
                                    *ngIf="assetStructureSelection.data.uniqueBidoEquipmentChild"
                                    type="text"
                                    class="aw-input"
                                    [(ngModel)]="assetStructureSelection.data.uniqueBidoEquipmentChild.pnCode"
                                    [disabled]="true"
                                  />
                                </div>
                              </div>
                              <div
                                class="form-group"
                                *ngIf="
                                  (assetStructureSelection.data.bidoEquipment &&
                                    assetStructureSelection.data.bidoEquipment.sn) ||
                                  (assetStructureSelection.data.uniqueBidoEquipmentChild &&
                                    assetStructureSelection.data.uniqueBidoEquipmentChild.sn)
                                "
                              >
                                <label
                                  class="form-label"
                                  *ngIf="
                                    isAssetAircraft(
                                      assetStructureSelection.data.bidoEquipment ||
                                        assetStructureSelection.data.uniqueBidoEquipmentChild
                                    )
                                  "
                                  >MSN</label
                                >
                                <label
                                  class="form-label"
                                  *ngIf="
                                    isAssetEngine(
                                      assetStructureSelection.data.bidoEquipment ||
                                        assetStructureSelection.data.uniqueBidoEquipmentChild
                                    )
                                  "
                                  >ESN</label
                                >
                                <label
                                  class="form-label"
                                  *ngIf="
                                    isAssetEquipment(
                                      assetStructureSelection.data.bidoEquipment ||
                                        assetStructureSelection.data.uniqueBidoEquipmentChild
                                    )
                                  "
                                  >S/N</label
                                >
                                <div class="form-control">
                                  <input
                                    *ngIf="assetStructureSelection.data.bidoEquipment"
                                    type="text"
                                    class="aw-input"
                                    [(ngModel)]="assetStructureSelection.data.bidoEquipment.sn"
                                    [disabled]="true"
                                  />
                                  <input
                                    *ngIf="assetStructureSelection.data.uniqueBidoEquipmentChild"
                                    type="text"
                                    class="aw-input"
                                    [(ngModel)]="assetStructureSelection.data.uniqueBidoEquipmentChild.sn"
                                    [disabled]="true"
                                  />
                                </div>
                              </div>
                            </div>
                          </div>
                        </div>
                        <h4 class="section-title">
                          {{ getComponentName() + ".controls" | translate }}
                          ({{ controlTable ? controlTable.length : 0 }})
                        </h4>

                        <div class="section-content">
                          <p-table
                            [resizableColumns]="true"
                            class="aw-table2"
                            [columns]="controlTableColList"
                            [value]="controlTable"
                            [scrollable]="true"
                            dataKey="_id"
                          >
                            <ng-template pTemplate="colgroup" let-columns>
                              <colgroup>
                                <col *ngFor="let col of columns" [ngStyle]="{ width: col.width }" />
                                <col class="row-expand-wrapper" />
                              </colgroup>
                            </ng-template>

                            <ng-template pTemplate="header" let-columns>
                              <tr>
                                <th
                                  pResizableColumn
                                  *ngFor="let col of columns"
                                  [ngStyle]="{ 'text-align': col.alignment }"
                                >
                                  {{ getComponentName() + "." + col.field | translate }}
                                </th>

                                <th class="row-expand-wrapper"></th>
                              </tr>
                            </ng-template>

                            <ng-template pTemplate="body" let-columns="columns" let-rowData let-expanded="expanded">
                              <tr>
                                <td
                                  *ngFor="let col of columns"
                                  [ngSwitch]="col.field"
                                  [ngStyle]="{ 'text-align': col.alignment }"
                                >
                                  <span *ngSwitchCase="'causeIdList'">
                                    {{ rowData[col.field] }}
                                  </span>

                                  <span *ngSwitchCase="'control'">
                                    <span
                                      *ngIf="rowData[col.field] === controlConfigConstants.ICON_GREEN"
                                      class="configuration-control-alert configuration-control-alert--ok"
                                    >
                                      {{ getComponentName() + ".ok" | translate }}
                                    </span>
                                    <span
                                      *ngIf="rowData[col.field] === controlConfigConstants.ICON_RED"
                                      class="configuration-control-alert configuration-control-alert--nok"
                                    >
                                      {{ getComponentName() + ".nok" | translate }}
                                    </span>
                                    <span
                                      *ngIf="rowData[col.field] === controlConfigConstants.ICON_YELLOW"
                                      class="configuration-control-alert configuration-control-alert--warning"
                                    >
                                      {{ getComponentName() + ".warning" | translate }}
                                    </span>
                                  </span>

                                  <span *ngSwitchCase="'category'">
                                    <span
                                      *ngIf="
                                        !!assetStructureSelection &&
                                        !!assetStructureSelection.data &&
                                        !!assetStructureSelection.data.bidoEquipment
                                      "
                                    >
                                      <a
                                        *ngIf="
                                          rowData[col.field] ===
                                          component.SUMMARY_TABLE_AIRWORTHINESS_DOCUMENT_COMPLIANCE_LABEL
                                        "
                                        (click)="openAirworthinessDocumentComplianceTable()"
                                        >{{ getComponentName() + "." + rowData[col.field] | translate }}</a
                                      >
                                      <a
                                        *ngIf="rowData[col.field] === component.SUMMARY_TABLE_LLP_POTENTIAL_LABEL"
                                        (click)="openLLPPotentialTable()"
                                        >{{ getComponentName() + "." + rowData[col.field] | translate }}</a
                                      >
                                      <span
                                        *ngIf="
                                          rowData[col.field] ===
                                          component.SUMMARY_TABLE_APPLICABLE_CONFIGURATION_COMPLIANCE_LABEL
                                        "
                                        >{{ getComponentName() + "." + rowData[col.field] | translate }}</span
                                      >
                                    </span>
                                    <span
                                      *ngIf="
                                        !!assetStructureSelection &&
                                        !!assetStructureSelection.data &&
                                        assetStructureSelection.data.bidoEquipment === null
                                      "
                                    >
                                      {{ getComponentName() + "." + rowData[col.field] | translate }}
                                    </span>
                                    <!-- {{ getComponentName() + "." + rowData[col.field] | translate }} -->
                                  </span>
                                  <span *ngSwitchDefault> {{ rowData[col.field] }} </span>
                                </td>

                                <td class="row-expand-wrapper" [pRowToggler]="rowData">
                                  <i
                                    class="fa fa-fw aw-icon aw-icon-with-border"
                                    [ngClass]="{
                                      'fa-minus': expanded,
                                      'fa-plus': !expanded,
                                      'visibility--hidden': rowData['causeList'].length === 0
                                    }"
                                    aria-hidden="true"
                                    pTooltip="{{ 'global.showTableRowDetails' | translate }}"
                                    tooltipPosition="left"
                                    (click)="toggleControlsTableRowDetailsVisibility(rowData)"
                                  ></i>
                                </td>
                              </tr>
                            </ng-template>

                            <ng-template pTemplate="rowexpansion" let-rowData let-columns="columns">
                              <tr class="row-expanded overflow">
                                <td [attr.colspan]="columns.length + 1">
                                  <div *ngFor="let cause of rowData['causeList']">
                                    {{ cause }}
                                  </div>
                                </td>
                              </tr>
                            </ng-template>
                          </p-table>
                        </div>
                      </div>

                      <div class="section">
                        <aw-removal-equipment
                          *ngIf="
                            asset.familyVariantCode &&
                            assetStructureSelection &&
                            assetStructureSelection.data.removedStockMvtData &&
                            equipmentCode &&
                            workPackage
                          "
                          [(assetStructureSelection)]="assetStructureSelection.data"
                          [equipmentCode]="equipmentCode"
                          [familyVariantCode]="asset.familyVariantCode"
                          [workPackage]="workPackage"
                          [isGroundEquipment]="isGroundEquipment"
                        ></aw-removal-equipment>
                      </div>
                      <div class="section">
                        <aw-installation-equipment
                          *ngIf="
                            asset.familyVariantCode &&
                            assetStructureSelection &&
                            assetStructureSelection.data.installedStockMvtData &&
                            equipmentCode &&
                            workPackage
                          "
                          [(assetStructureSelection)]="assetStructureSelection.data"
                          [equipmentCode]="equipmentCode"
                          [familyVariantCode]="asset.familyVariantCode"
                          [workPackage]="workPackage"
                          [isGroundEquipment]="isGroundEquipment"
                        ></aw-installation-equipment>
                      </div>

                      <div *ngIf="showLLPPotentialSection" class="section">
                        <h4 class="section-title">
                          {{ getComponentName() + ".llpPotential" | translate }} ({{
                            llpPotentialTable ? llpPotentialTable.length : 0
                          }})
                        </h4>

                        <div class="section-content">
                          <p-table
                            [resizableColumns]="true"
                            #ptableLLP
                            class="aw-table2"
                            [columns]="llpPotentialTableCols"
                            [value]="llpPotentialTable"
                            [scrollable]="true"
                          >
                            <ng-template pTemplate="emptymessage">
                              <span *ngIf="!llpTableLoading"> &nbsp;</span>

                              <div *ngIf="llpTableLoading" class="aw-table-loading-indicator">
                                <div class="loading-message">{{ "table.loadingData" | translate }}</div>
                                <div class="lds-hourglass"></div>
                              </div>
                            </ng-template>

                            <ng-template pTemplate="colgroup" let-columns>
                              <colgroup>
                                <col *ngFor="let col of columns" [ngStyle]="{ width: col.width }" />
                              </colgroup>
                            </ng-template>

                            <ng-template pTemplate="header" let-columns>
                              <tr>
                                <th
                                  pResizableColumn
                                  *ngFor="let col of columns"
                                  [ngStyle]="{ 'text-align': col.alignment }"
                                >
                                  {{ componentData.componentId + "." + col.field | translate }}
                                </th>
                              </tr>
                            </ng-template>

                            <ng-template pTemplate="body" let-rowData let-columns="columns" let-rowIndex="rowIndex">
                              <tr [pSelectableRow]="rowData" [pSelectableRowIndex]="rowIndex">
                                <td
                                  *ngFor="let col of columns"
                                  [ngStyle]="{ 'text-align': col.alignment }"
                                  [ngSwitch]="col.field"
                                >
                                  <span class="control-result" *ngSwitchCase="'control'">
                                    <span
                                      *ngIf="rowData[col.field] === 'ok'"
                                      class="configuration-control-alert configuration-control-alert--ok"
                                      >{{ componentData.componentId + "." + rowData[col.field] | translate }}</span
                                    >
                                    <span
                                      *ngIf="rowData[col.field] === 'nok'"
                                      class="configuration-control-alert configuration-control-alert--nok"
                                      >{{ componentData.componentId + "." + rowData[col.field] | translate }}</span
                                    >
                                    <span
                                      *ngIf="rowData[col.field] === 'warning'"
                                      class="configuration-control-alert configuration-control-alert--warning"
                                      >{{ componentData.componentId + "." + rowData[col.field] | translate }}</span
                                    >
                                  </span>
                                  <span *ngSwitchDefault>
                                    {{ rowData[col.field] }}
                                  </span>
                                </td>
                              </tr>
                            </ng-template>
                          </p-table>
                        </div>
                      </div>

                      <div *ngIf="showAirworthinessDocumentSection" class="section">
                        <h4 class="section-title">
                          {{ getComponentName() + ".airworthinessDocuments" | translate }} ({{
                            airworthinessDocumentsTable ? airworthinessDocumentsTable.length : 0
                          }})
                        </h4>

                        <div class="section-content">
                          <p-table
                            [resizableColumns]="true"
                            #ptableAW
                            class="aw-table2"
                            [columns]="airworthinessDocumentsTableCols"
                            [value]="airworthinessDocumentsTable"
                            [scrollable]="true"
                            dataKey="_id"
                          >
                            <ng-template pTemplate="emptymessage">
                              <span *ngIf="!airworthinessDocumentsTableLoading"> &nbsp;</span>

                              <div *ngIf="airworthinessDocumentsTableLoading" class="aw-table-loading-indicator">
                                <div class="loading-message">{{ "table.loadingData" | translate }}</div>
                                <div class="lds-hourglass"></div>
                              </div>
                            </ng-template>

                            <ng-template pTemplate="colgroup" let-columns>
                              <colgroup>
                                <col *ngFor="let col of columns" [ngStyle]="{ width: col.width }" />
                                <col class="row-expand-wrapper" />
                              </colgroup>
                            </ng-template>

                            <ng-template pTemplate="header" let-columns>
                              <tr>
                                <th
                                  pResizableColumn
                                  *ngFor="let col of columns"
                                  [ngStyle]="{ 'text-align': col.alignment }"
                                >
                                  {{ componentData.componentId + "." + col.field | translate }}
                                </th>

                                <th class="row-expand-wrapper"></th>
                              </tr>
                            </ng-template>

                            <ng-template pTemplate="body" let-rowData let-columns="columns" let-rowIndex="rowIndex">
                              <tr [pSelectableRow]="rowData" [pSelectableRowIndex]="rowIndex">
                                <td
                                  *ngFor="let col of columns"
                                  [ngStyle]="{ 'text-align': col.alignment }"
                                  [ngSwitch]="col.field"
                                >
                                  <span class="control-result" *ngSwitchCase="'control'">
                                    <span
                                      *ngIf="rowData[col.field] === 'POSITIVE'"
                                      class="configuration-control-alert configuration-control-alert--ok"
                                      >{{ componentData.componentId + ".ok" | translate }}</span
                                    >
                                    <span
                                      *ngIf="rowData[col.field] === 'NEGATIVE'"
                                      class="configuration-control-alert configuration-control-alert--nok"
                                      >{{ componentData.componentId + ".nok" | translate }}</span
                                    >
                                    <!-- <span
                                      *ngIf="rowData[col.field] === 'warning'"
                                      class="configuration-control-alert configuration-control-alert--warning"
                                      >{{ componentData.componentId + "." + rowData[col.field] | translate }}</span
                                    > -->
                                  </span>

                                  <span *ngSwitchCase="'document'">
                                    <a (click)="openEvolution(rowData)">{{ rowData[col.field] }}</a>
                                  </span>

                                  <span *ngSwitchDefault>
                                    {{ rowData[col.field] }}
                                  </span>
                                </td>

                                <td class="row-expand-wrapper" [pRowToggler]="rowData">
                                  <i
                                    class="fa fa-fw aw-icon aw-icon-with-border"
                                    [ngClass]="{
                                      'fa-minus': rowData.expanded,
                                      'fa-plus': !rowData.expanded,
                                      'visibility--hidden': rowData.control === 'POSITIVE'
                                    }"
                                    aria-hidden="true"
                                    pTooltip="{{ 'global.showTableRowDetails' | translate }}"
                                    tooltipPosition="left"
                                    (click)="toggleADTableRowDetailsVisibility(rowData)"
                                  ></i>
                                </td>
                              </tr>
                            </ng-template>

                            <ng-template pTemplate="rowexpansion" let-rowData let-columns="columns">
                              <tr class="row-expanded">
                                <td [attr.colspan]="columns.length + 1">
                                  <span *ngIf="rowData.message === 'D' || rowData.message === 'T'; else otherMessage">{{
                                    getTranslatedText(rowData.message)
                                  }}</span>
                                  <ng-template>
                                    <span #otherMessage>
                                      {{ rowData.message }}
                                    </span>
                                  </ng-template>
                                </td>
                              </tr>
                            </ng-template>
                          </p-table>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <p-overlayPanel
    #opFilters
    class="aw-overlay"
    (onShow)="assetStructureFiltersVisible = true"
    (onHide)="assetStructureFiltersVisible = false"
  >
    <div class="row">
      <div class="form-group flex--auto">
        <label class="form-label"> &nbsp; </label>

        <div class="form-control aw-selectbutton-wrapper">
          <p-selectButton
            [(ngModel)]="selectedControlList"
            [options]="searchControlList"
            multiple="multiple"
          ></p-selectButton>
        </div>
      </div>
    </div>

    <div class="row action-list">
      <button type="button" mat-raised-button (click)="resetAssetStructureCriteria()">
        {{ getComponentName() + ".reset" | translate }}
      </button>

      <button
        type="button"
        mat-raised-button
        (click)="opFilters.hide(); assetStructureFiltersVisible = false; filterAssetStrucreWithCriteria()"
      >
        {{ getComponentName() + ".filter" | translate }}
      </button>
    </div>
  </p-overlayPanel>

  <aw-dialog-search-equipment
    *ngIf="dialogSearchAssetVisible"
    [(display)]="dialogSearchAssetVisible"
    (onSelected)="onSelectedAsset($event)"
  ></aw-dialog-search-equipment>

  <aw-dialog-help *ngIf="showHelpDialog" [(display)]="showHelpDialog"></aw-dialog-help>

  <aw-dialog-work-order-creation
    *ngIf="showInstallByWorkPackageDialog"
    [(display)]="showInstallByWorkPackageDialog"
    [(mvtWay)]="mvtWay"
    [(woPn)]="woPn"
    [(woSn)]="woSn"
    [(woAssetDesignation)]="woAssetDesignation"
    [(woAssetFunction)]="woAssetFunction"
    [(woFunctionCode)]="woFunctionCode"
    [(woItemPk)]="woItemPk"
    [(topAssetDTOId)]="topAssetDTOId"
    [displayDescription]="true"
    [displayOperation]="true"
    [displayStatus]="false"
    [displayWorkCenter]="false"
    (onValidated)="onCreateWorkPackage($event)"
  ></aw-dialog-work-order-creation>
</div>

<ng-template #equipmentlink let-equipment="equipment">
  <a (click)="openSelectedAsset(equipment)" class="asset">
    <i *ngIf="isAssetAircraft(equipment) || isAssetEngine(equipment)">
      <b>{{ equipment.familyVariantCode }}</b
      >&nbsp;|
    </i>
    <i *ngIf="equipment.pnCode && !isAssetEngine(equipment)"
      >P/N&nbsp;
      <b>{{ equipment.pnCode }}</b>
      &nbsp;&nbsp;|&nbsp;&nbsp;
    </i>
    <i *ngIf="isAssetAircraft(equipment)"
      >MSN&nbsp;
      <b>{{ equipment.sn }}</b>
      <i *ngIf="equipment.registration"
        >&nbsp;|&nbsp;
        <b>{{ equipment.registration }}</b>
      </i>
    </i>
    <i *ngIf="isAssetEngine(equipment)"
      >ESN&nbsp;
      <b>{{ equipment.sn }}</b>
    </i>
    <i *ngIf="!isAssetAircraft(equipment) && !isAssetEngine(equipment)"
      >S/N&nbsp;
      <b>{{ equipment.sn }}</b>
    </i>
  </a>
</ng-template>
