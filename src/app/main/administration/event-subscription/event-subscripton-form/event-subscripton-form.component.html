<div class="page-header">
  <div class="page-info">
    <div>
      <div class="page-title">
        {{ "transaction." + componentData.componentId | translate }}
      </div>

      <div class="page-subtitle">
        <div *ngIf="!isCreateOpenMode && componentData && componentData.objectId" class="page-subtitle">
          - {{ serializationService.deserialize(componentData.objectId)["subscriptionName"] }}
        </div>
      </div>
    </div>
  </div>

  <div class="page-actions">
    <button *ngIf="isReadOpenMode && hasUpdateAccessRight" type="button" mat-raised-button (click)="editSubscription()">
      {{ "global.edit" | translate }}
    </button>

    <button
      *ngIf="!isReadOpenMode && !isCreateOpenMode"
      type="button"
      color="warn"
      mat-raised-button
      (click)="cancelSubscription()"
    >
      {{ "global.cancel" | translate }}
    </button>

    <button
      *ngIf="!isReadOpenMode"
      class="btn-with-spinner"
      color="primary"
      type="button"
      mat-raised-button
      (click)="saveSubscription()"
    >
      <span class="lds-hourglass" *ngIf="showSaveSpinner"></span>
      {{ "global.save" | translate }}
    </button>

    <button
      mat-icon-button
      class="mat-elevation-z1"
      matTooltip="{{ 'global.showAllActionTooltip' | translate }}"
      matTooltipPosition="above"
      aria-label="Show all actions"
      [matMenuTriggerFor]="actions"
    >
      <mat-icon>more_horiz</mat-icon>
    </button>
    <mat-menu #actions="matMenu">
      <button mat-menu-item (click)="reloadSubscription()">{{ "global.refresh" | translate }}</button>
      <button mat-menu-item (click)="updateFavoriteState()">
        {{ (isFavoriteEntry ? "page.removeFromFavorites" : "page.addToFavorites") | translate }}
      </button>
    </mat-menu>
  </div>
</div>

<div class="page-wrapper">
  <div class="page-container search-page-container">
    <div class="page-content">
      <div class="grid-row">
        <div class="grid-cell--12">
          <div class="grid-cell grid-cell--container">
            <div class="grid-cell-header">
              <div class="grid-cell-title-container">
                <div class="grid-cell-title">
                  <span>{{ "page.mainData" | translate }}</span>
                </div>
              </div>
            </div>
            <div class="grid-cell-content">
              <div class="grid-cell--12">
                <div class="grid-row">
                  <div class="form-group required">
                    <label class="form-label">{{ componentData.componentId + ".subscriptionName" | translate }} </label>
                    <div class="form-control">
                      <input
                        type="text"
                        class="aw-input"
                        [(ngModel)]="subscription.subscriptionName"
                        [disabled]="isReadOpenMode || !isCreateOpenMode"
                        maxlength="100"
                      />
                    </div>
                  </div>

                  <div class="form-group">
                    <label class="form-label">{{ componentData.componentId + ".eventType" | translate }} </label>
                    <div class="form-control">
                      <p-dropdown
                        class="aw-dropdown fixed-width"
                        [options]="eventTypes"
                        [(ngModel)]="subscription.eventType"
                        [showClear]="true"
                        placeholder="&nbsp;"
                        [disabled]="isReadOpenMode"
                      ></p-dropdown>
                    </div>
                  </div>

                  <div class="form-group">
                    <label class="form-label"
                      >{{ componentData.componentId + ".familyVariantCode" | translate }}
                    </label>
                    <div class="form-control">
                      <p-dropdown
                        class="aw-dropdown fixed-width"
                        [options]="familyVariants"
                        [(ngModel)]="subscription.familyVariantCode"
                        [showClear]="true"
                        placeholder="&nbsp;"
                        [disabled]="isReadOpenMode"
                      ></p-dropdown>
                    </div>
                  </div>
                </div>
              </div>
              <div class="grid-cell--12">
                <div class="grid-row">
                  <div class="form-group">
                    <label class="form-label">{{ componentData.componentId + ".operatorCode" | translate }}</label>
                    <div class="form-control">
                      <input
                        type="submit"
                        (click)="quickSearchBusinessPartner()"
                        style="width: 40%; text-align: left"
                        class="aw-input"
                        [(ngModel)]="subscription.operatorCode"
                        [disabled]="isReadOpenMode"
                      />&nbsp;&nbsp;
                      <i
                        *ngIf="!isReadOpenMode"
                        class="fa fa-fw fa-search"
                        aria-hidden="true"
                        (click)="quickSearchBusinessPartner()"
                      ></i
                      >&nbsp;&nbsp;
                      <input
                        type="submit"
                        style="width: 40%; text-align: left"
                        class="aw-input"
                        [(ngModel)]="operatorName"
                        [disabled]="isReadOpenMode"
                        maxlength="50"
                      />
                    </div>
                  </div>

                  <div class="form-group">
                    <label class="form-label">{{ componentData.componentId + ".eventPriority" | translate }} </label>
                    <div class="form-control">
                      <p-dropdown
                        class="aw-dropdown fixed-width"
                        [options]="eventPriorities"
                        [(ngModel)]="subscription.eventPriority"
                        [showClear]="true"
                        placeholder="&nbsp;"
                        [disabled]="isReadOpenMode"
                      ></p-dropdown>
                    </div>
                  </div>

                  <div class="form-group">
                    <label class="form-label">{{ componentData.componentId + ".chapter" | translate }}</label>
                    <div class="form-control">
                      <input
                        type="text"
                        class="aw-input"
                        [(ngModel)]="subscription.chapter"
                        [disabled]="isReadOpenMode"
                        maxlength="2"
                        style="width:30%"
                      />
                      &nbsp;&nbsp;
                      <input
                        type="text"
                        class="aw-input"
                        [(ngModel)]="subscription.section"
                        [disabled]="isReadOpenMode"
                        maxlength="2"
                        style="width:30%"
                      />
                    </div>
                  </div>
                </div>
              </div>
              <div class="grid-cell--12">
                <div class="grid-row">
                  <div class="form-group">
                    <label class="form-label">{{ componentData.componentId + ".newEventsOnly" | translate }}</label>
                    <div class="form-control">
                      <p-checkbox
                        class="aw-checkbox"
                        binary="true"
                        [(ngModel)]="subscription.newEventsOnly"
                        [disabled]="isReadOpenMode"
                      ></p-checkbox>
                    </div>
                  </div>

                  <div class="form-group">
                    <label class="form-label">{{
                      componentData.componentId + ".doNotNotifyOnForms" | translate
                    }}</label>
                    <div class="form-control">
                      <p-checkbox
                        class="aw-checkbox"
                        binary="true"
                        [(ngModel)]="subscription.doNotNotifyOnForms"
                        [disabled]="isReadOpenMode"
                      ></p-checkbox>
                    </div>
                  </div>
                  <div class="form-group"></div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Contacts table -->

      <div class="grid-row">
        <div class="grid-cell--12">
          <div class="grid-cell grid-cell--container">
            <div class="grid-cell-header">
              <div class="grid-cell-title-container">
                <h3 class="grid-cell-title">{{ componentData.componentId + ".contacts" | translate }}</h3>
              </div>
            </div>

            <div class="grid-cell-content  grid-cell-content-with-section">
              <div class="section">
                <h4 class="section-title">
                  {{ componentData.componentId + ".contactsLinkedToSubscription" | translate }}
                </h4>

                <div class="section-content">
                  <a-table [dataSource]="contactsTableDataSource">
                    <ng-template tableActionsDef>
                      <button
                        *ngIf="!isReadOpenMode && !contactsTableDataSource.hasDataSelection"
                        type="button"
                        mat-raised-button
                        (click)="addNewContact()"
                      >
                        {{ "global.add" | translate }}
                      </button>

                      <button
                        *ngIf="!isReadOpenMode && contactsTableDataSource.hasDataSelection"
                        type="button"
                        color="warn"
                        mat-raised-button
                        (click)="deleteContact()"
                      >
                        {{ "global.delete" | translate }}
                      </button>
                    </ng-template>

                    <ng-template columnDef="opeCode" let-rowData="rowData">
                      <a (click)="openOperationForm(rowData)">{{ rowData.opeCode }}</a>
                    </ng-template>
                  </a-table>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- POPUP ZONE -->
<aw-dialog-search-customer
  *ngIf="showQuickSearchBusinessPartnerPopup"
  [(display)]="showQuickSearchBusinessPartnerPopup"
  [customer-code]="subscription.operatorCode"
  (onSelected)="setSelectedBusinessPartner($event)"
>
</aw-dialog-search-customer>

<aw-contacts-popup
  *ngIf="showContactsPopup"
  [(display)]="showContactsPopup"
  [contact]="currentContact"
  (onCreate)="createContact($event)"
></aw-contacts-popup>
