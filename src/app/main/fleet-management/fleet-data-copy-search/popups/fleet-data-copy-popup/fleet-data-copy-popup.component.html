<a-modal class="aw-modal" [(visible)]="display">
  <a-header>
    <div *ngIf="!showReport" class="modal-title">{{ getComponentName() + ".title" | translate }}</div>
    <div *ngIf="showReport" class="modal-title">{{ getComponentName() + ".reportTitle" | translate }}</div>
  </a-header>

  <a-content>
    <div class="search-dialog-container">
      <div *ngIf="!showReport" class="section search-criteria-section">
        <div class="grid-row">
          <div class="grid-cell--12">
            <p-selectButton [options]="types" [(ngModel)]="selectedType" (onChange)="setType()"></p-selectButton>
          </div>
        </div>

        <div *ngIf="selectedType === 'asset'" class="grid-row">
          <div class="grid-cell--3">
            <div class="form-group required">
              <label class="form-label">{{ getComponentName() + ".sourceAsset" | translate }}</label>

              <div class="form-control form-control-with-modal" [ngClass]="{ disabled: showReport }">
                <div class="form-control-data" (click)="!showReport ? openAssetPopup() : ''">
                  {{ dataToCopy.sourceAssetCode }}
                </div>
                <div class="btn-search-wrapper">
                  <i
                    *ngIf="!showReport"
                    class="fa fa-fw fa-search aw-icon aw-icon-with-border"
                    aria-hidden="true"
                    pTooltip="{{ 'global.search' | translate }}"
                    tooltipPosition="top"
                    (click)="openAssetPopup()"
                  ></i>
                </div>
              </div>
            </div>
          </div>
          <div class="grid-cell--6">
            <div class="section">
              <h4 class="section-title">
                {{ getComponentName() + ".dataToCopy" | translate
                }}<span style="color: #a82525; font-size: 1.5rem;">*</span>
              </h4>

              <div class="section-content">
                <div class="grid-row">
                  <div class="form-group">
                    <label class="form-label"> {{ getComponentName() + ".maintenancePlan" | translate }} </label>

                    <div class="form-control">
                      <p-checkbox
                        binary="true"
                        class="aw-checkbox"
                        [(ngModel)]="dataToCopy.maintenancePlan"
                        [disabled]="isReadOpenMode"
                      ></p-checkbox>
                    </div>
                  </div>

                  <div class="form-group">
                    <label class="form-label"> {{ getComponentName() + ".lifeLimits" | translate }} </label>

                    <div class="form-control">
                      <p-checkbox
                        binary="true"
                        class="aw-checkbox"
                        [(ngModel)]="dataToCopy.lifeLimits"
                        [disabled]="isReadOpenMode"
                      ></p-checkbox>
                    </div>
                  </div>

                  <div class="form-group">
                    <label class="form-label"> {{ getComponentName() + ".usage" | translate }} </label>

                    <div class="form-control">
                      <p-checkbox
                        binary="true"
                        class="aw-checkbox"
                        [(ngModel)]="dataToCopy.usage"
                        [disabled]="isReadOpenMode"
                      ></p-checkbox>
                    </div>
                  </div>

                  <div class="form-group">
                    <label class="form-label"> {{ getComponentName() + ".attributes" | translate }} </label>

                    <div class="form-control">
                      <p-checkbox
                        binary="true"
                        class="aw-checkbox"
                        [(ngModel)]="dataToCopy.attributes"
                        [disabled]="isReadOpenMode"
                      ></p-checkbox>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div *ngIf="selectedType === 'evolution'" class="grid-row">
          <div class="form-group required">
            <label class="form-label">{{ getComponentName() + ".sourceEvolution" | translate }}</label>

            <div class="form-control form-control-with-modal" [ngClass]="{ disabled: showReport }">
              <div class="form-control-data" (click)="!showReport ? openEvolutionPopup() : ''">
                {{ dataToCopy.evolutionAssetCode }}
              </div>
              <div class="btn-search-wrapper">
                <i
                  *ngIf="!showReport"
                  class="fa fa-fw fa-search aw-icon aw-icon-with-border"
                  aria-hidden="true"
                  pTooltip="{{ 'global.search' | translate }}"
                  tooltipPosition="top"
                  (click)="openEvolutionPopup()"
                ></i>
              </div>
              <div class="btn-search-wrapper">{{ getComponentName() + ".sb182" | translate }}</div>
            </div>
          </div>
          <div class="form-group">
            <label class="form-label">{{ getComponentName() + ".applicationDate" | translate }}</label>
            <div class="form-control">
              <p-calendar
                showButtonBar="true"
                [monthNavigator]="true"
                [yearNavigator]="true"
                [yearRange]="sessionService.calendarYearRange"
                name="date"
                class="aw-calendar"
                [dateFormat]="sessionService.dateFormatPrimeNG"
                [locale]="sessionService.calendarFormat"
                [(ngModel)]="dataToCopy.applicationDate"
                [disabled]="isReadOnlyForm"
                appendTo="body"
                [maxDate]="maxDate"
              ></p-calendar>
            </div>
          </div>
          <div class="form-group">
            <label class="form-label">{{ getComponentName() + ".isPartiallyApplied" | translate }}</label>
            <div class="form-control">
              <p-checkbox
                binary="true"
                class="aw-checkbox"
                [(ngModel)]="dataToCopy.isPartiallyApplied"
                [disabled]="isReadOpenMode"
              ></p-checkbox>
            </div>
          </div>
          <div class="form-group"></div>
        </div>
      </div>
      <div class="section results-section">
        <h4 class="section-title">
          {{ getComponentName() + ".targetAssetsTitle" | translate }} ({{ resultsTable ? resultsTable.length : 0 }})
        </h4>

        <div class="section-content">
          <p-table
            [resizableColumns]="true"
            #tableAssets
            class="aw-table2"
            [columns]="resultsTableCols"
            [value]="resultsTable"
            [(selection)]="selectedAssets"
            [scrollable]="true"
          >
            <ng-template pTemplate="emptymessage">
              <span *ngIf="!isLoading"> &nbsp;</span>

              <div *ngIf="isLoading" class="aw-table-loading-indicator">
                <div class="loading-message">{{ "table.loadingData" | translate }}</div>
                <div class="lds-hourglass"></div>
              </div>
            </ng-template>

            <ng-template pTemplate="colgroup" let-columns>
              <colgroup>
                <col *ngFor="let col of columns" [ngStyle]="{ width: col.width }" />
              </colgroup>
            </ng-template>

            <ng-template pTemplate="header" let-columns>
              <tr>
                <th pResizableColumn *ngFor="let col of columns" [ngStyle]="{ 'text-align': col.alignment }">
                  {{ getComponentName() + "." + col.field | translate }}
                </th>
              </tr>
            </ng-template>

            <ng-template pTemplate="body" let-rowData let-columns="columns" let-rowIndex="rowIndex">
              <tr [pSelectableRow]="rowData" [pSelectableRowIndex]="rowIndex">
                <td *ngFor="let col of columns" [ngStyle]="{ 'text-align': col.alignment }">
                  <span [ngSwitch]="col.field">
                    <div *ngSwitchCase="'report'">
                      <i
                        *ngIf="rowData['report'] === false"
                        class="fa fa-times fa-lg"
                        aria-hidden="true"
                        pTooltip="{{ rowData['reportMessage'] }}"
                        tooltipPosition="top"
                        style="color:red"
                      ></i>
                      <i
                        *ngIf="rowData['report'] === true"
                        class="fa fa-check fa-lg"
                        aria-hidden="true"
                        pTooltip="{{ rowData['reportMessage'] }}"
                        tooltipPosition="top"
                        style="color:green"
                      ></i>
                    </div>
                    <div *ngSwitchDefault>{{ rowData[col.field] }}</div>
                  </span>
                </td>
              </tr>
            </ng-template>
          </p-table>
        </div>
      </div>
    </div>
  </a-content>

  <a-footer>
    <button type="button" mat-raised-button (click)="closeDialog()">
      <span>{{ "global.cancel" | translate }}</span>
    </button>

    <button
      *ngIf="!showReport && selectedType === 'asset'"
      type="button"
      color="primary"
      mat-raised-button
      (click)="validate()"
      [disabled]="
        dataToCopy.sourceAssetCode === null ||
        dataToCopy.sourceAssetCode === undefined ||
        dataToCopy.sourceAssetCode.trim() === '' ||
        (!dataToCopy.maintenancePlan && !dataToCopy.lifeLimits && !dataToCopy.usage && !dataToCopy.attributes)
      "
    >
      {{ "global.save" | translate }}
    </button>
    <button
      *ngIf="!showReport && selectedType === 'evolution'"
      type="button"
      color="primary"
      mat-raised-button
      (click)="validate()"
      [disabled]="
        dataToCopy.evolutionAssetCode === null ||
        dataToCopy.evolutionAssetCode === undefined ||
        dataToCopy.evolutionAssetCode.trim() === ''
      "
    >
      {{ "global.save" | translate }}
    </button>

    <button
      *ngIf="showReport"
      type="button"
      mat-raised-button
      (click)="report()"
      [disabled]="reportText === null || reportText === ''"
    >
      {{ getComponentName() + ".report" | translate }}
    </button>
  </a-footer>
</a-modal>

<aw-dialog-search-equipment
  *ngIf="showAssetPopup"
  [(display)]="showAssetPopup"
  [equipment-code]="dataToCopy.sourceAssetCode"
  [family-variant]=""
  (onSelected)="setSelectedAsset($event)"
></aw-dialog-search-equipment>

<aw-dialog-search-evolution
  *ngIf="showEvolutionPopup"
  [(display)]="showEvolutionPopup"
  [evolutionNumber]="dataToCopy.evolutionAssetCode"
  (onSelected)="setSelectedCode($event)"
></aw-dialog-search-evolution>

<aw-fleet-data-copy-report-popup
  *ngIf="showReportPopup"
  [reportContent]="reportText"
  [(display)]="showReportPopup"
></aw-fleet-data-copy-report-popup>
